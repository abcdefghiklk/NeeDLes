public void set extends string value deprecated use link set extends string deprecated public void set extends string value suppress warnings unused node page directive xtends value	page info set extends value
while has next char	has next char has next char has next char	string trimmed id trim int result reserved words compare trimmed	test public void test ternary01 throws jasper exception do test parser true true false test public void test ternary02 throws jasper exception do test parser true false test public void test ternary03 throws jasper exception do test parser eq1 true false test public void test ternary04 throws jasper exception do test parser eq true false test public void test ternary05 throws jasper exception note invalid el do test parser aeq1 true false test public void test ternary06 throws jasper exception do test parser do eq1 true false test public void test ternary07 throws jasper exception do test parser do eq true false
class loader get parent null get system class loader parent class loader string class get class loader null get system class loader while get parent null get parent j2se class loader security manager system get security manager	class loader get parent null get system class loader parent class loader string class get class loader null get system class loader while get parent null get parent j2se class loader security manager system get security manager	protected final class loader parent bootstrap class loader used load j2se classes some class loader always code null null those cases link class loader get parent called recursively system class loader last non null result used protected final class loader j2se class loader	webapp class loader result new webapp class loader get parent	url parent get resource name	url parent get resource name	stream parent get resource stream name	stream parent get resource stream name	j2se class loader get resource resource name null clazz j2se class loader load class name	clazz class name name false parent	clazz class name name false parent
sub protocol sec get configurator get negotiated subprotocol sec get subprotocols sub protocols	endpoint ep try class clazz sec get endpoint class endpoint class assignable from clazz ep endpoint sec get configurator get endpoint instance clazz else ep new pojo endpoint server catch exception throw new servlet exception
buffer size jsp writer default buffer buffer size constants default buffer size	test public void test default buffer size throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home context ctx tomcat add webapp null test app dir get absolute path add servlet tomcat add servlet ctx bug56010 new bug56010 ctx add servlet mapping bug56010 bug56010 tomcat start byte chunk res get url http localhost get port test bug56010 string result res string assert assert true result contains ok public static class bug56010 extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception page context page context jsp factory get default factory get page context req resp null false jsp writer default buffer true jsp writer out page context get out constants default buffer size out get buffer size resp get writer println ok else resp get writer println fail
public void access async timeouts based time between call start async complete dispatch so don update last access time drives timeout every read write when using async processing async access system current time millis
string webapp path tld resource path get webapp path webapp path null webapp path null jars containing tlds class path part web application url url servlet context get resource tld resource path get webapp path conn url open connection result conn get last modified file equals url get protocol reading last modified time opens input stream so we need make sure closed again otherwise tld file locked until gc runs conn get input stream close licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license abstract valve interface generates web server access log detailed line contents matching configurable pattern syntax available patterns similar supported href http httpd apache org apache http server code mod log config code module patterns logged message may include constant text any following replacement strings which information from specified response substituted ul li remote ip address li local ip address li bytes sent excluding http headers bytes were sent li bytes sent excluding http headers li remote host name ip address code enable lookups code connector false li request protocol li remote logical username from identd always returns li request method li local port li query string prepended exists otherwise empty string li first line request li http status code response li user session id li date time common log format format li format date time any format supported simple date format li remote user li requested url path li local server name li time taken process request millis li time taken process request seconds li current request thread name can compare later stacktraces ul addition caller can specify one following aliases commonly utilized patterns ul li common code code li combined code referer user agent code ul also support write information from cookie incoming header session something else servlet request br modeled after href http httpd apache org apache http server log syntax ul li code xxx code incoming headers li code xxx code outgoing response headers li code xxx code specific cookie li code xxx code xxx attribute servlet request li code xxx code xxx attribute http session li code xxx code xxx enhanced simple date format pattern see reference document details supported time patterns ul conditional logging also supported can done code condition unless code code condition code properties value returned from servlet request get attribute condition unless yields non null value logging skipped value returned from servlet request get attribute condition yields null value logging skipped code condition code attribute synonym code condition unless code provided backwards extended attributes coming from get attribute call you ensure newline control characters author craig mc clanahan author jason brittain author remy maucherat author takayuki kaneko author peter rossbach version id private static final log log log factory get log abstract access log valve class constructor public abstract access log valve super true instance variables enabled component protected boolean enabled true pattern used format our access log lines protected string pattern null size our global date format cache private static final int global cache size 300 size our thread local date format cache private static final int local cache size 60 cache structure formatted timestamps based seconds cache consists entries consecutive range seconds length range configurable implemented based cyclic buffer new entries shift range one cache clf format access log standard format hash map caches additional formats used simple date format although cache supports specifying locale when retrieving formatted timestamp each format always use locale given when format first used new locales can only used new formats clf format always formatted using locale code en us code cache threadsafe can used without via thread local instances global cache cache can created parent cache build cache hierarchy access parent cache threadsafe class uses small thread local first level cache bigger synchronized global second level cache protected static class date format cache protected class cache clf log format private static final string lfformat dd mmm yyyy hh mm ss second used retrieve clf format most recent invocation private long previous seconds long min value value clf format retrieved most recent invocation private string previous format first second contained cache private long first long min value last second contained cache private long last long min value index first cyclic cache private int offset helper object able call simple date format format private final date current date new date protected final string cache private simple date format formatter private boolean clf false private cache parent null private cache cache parent null parent private cache string format cache parent format null parent private cache string format locale loc cache parent cache new string cache size int cache size cache null loc null loc cache default locale format null clf true format lfformat formatter new simple date format format locale us else formatter new simple date format format loc formatter set time zone time zone get default parent parent private string get format internal long time long seconds time 1000 first step we have seen timestamp during previous call we need clf return previous value seconds previous seconds return previous format second step try locate cache previous seconds seconds int index offset int seconds first cache size index index cache size seconds first seconds last cache index null found so remember next call return previous format cache index return previous format third step found cache adjust cache add item else seconds last cache size seconds first cache size first seconds last first cache size index offset int cache size cache null else seconds last int seconds last cache index cache size cache size null first seconds cache size last seconds offset index cache size else seconds first int first seconds cache index cache size null first seconds last seconds cache size offset index last step format new timestamp either using parent cache locally parent null synchronized parent previous format parent get format internal time else current date set time time previous format formatter format current date clf string builder current new string builder 32 current append current append previous format current append previous format current string cache index previous format return previous format number cached entries private int cache size private final locale cache default locale private final date format cache parent protected final cache lfcache private final hash map string cache format cache new hash map protected date format cache int size locale loc date format cache parent cache size size cache default locale loc parent parent cache parent cache null parent null synchronized parent parent cache parent get cache null null lfcache new cache parent cache private cache get cache string format locale loc cache cache format null cache lfcache else cache format cache get format cache null cache parent cache null parent null synchronized parent parent cache parent get cache format loc cache new cache format loc parent cache format cache put format cache return cache public string get format long time return lfcache get format internal time public string get format string format locale loc long time return get cache format loc get format internal time global date format cache private static final date format cache global date cache new date format cache global cache size locale get default null thread local date format cache private static final thread local date format cache local date cache new thread local date format cache override protected date format cache initial value return new date format cache local cache size locale get default global date cache system time when we last updated date valve uses log lines private static final thread local date local date new thread local date override protected date initial value return new date list our format types private static enum format type clf sec msec msec frac sdf we doing conditional logging default null value code condition unless code property protected string condition null we doing conditional logging default null value code condition code property protected string condition null name locale used format timestamps log entries log file name suffix protected string locale name locale get default string locale used format timestamps log entries log file name suffix protected locale locale locale get default array access log element used make log message protected access log element log elements null see set request attributes enabled boolean protected boolean request attributes enabled false buffer pool used log message generation pool used reduce garbage generation private synchronized stack char array writer char array writers new synchronized stack log message buffers usually recycled re used prevent excessive memory usage buffer grows beyond size discarded default 256 characters should set larger than typical access log message size private int max log message buffer size 256 properties inherit doc override public void set request attributes enabled boolean request attributes enabled request attributes enabled request attributes enabled inherit doc override public boolean get request attributes enabled return request attributes enabled return returns enabled public boolean get enabled return enabled param enabled enabled set public void set enabled boolean enabled enabled enabled return format pattern public string get pattern return pattern set format pattern first translating any recognized alias param pattern new pattern public void set pattern string pattern pattern null pattern else pattern equals constants access log common alias pattern constants access log common pattern else pattern equals constants access log combined alias pattern constants access log combined pattern else pattern pattern log elements create log elements return whether attribute name look when performing conditional logging null every request logged public string get condition return condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition string condition condition condition return whether attribute name look when performing conditional logging null every request logged public string get condition unless return get condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition unless string condition set condition condition return whether attribute name look when performing conditional logging null every request logged public string get condition return condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition string condition condition condition return locale used format timestamps log entries log file name suffix public string get locale return locale name set locale used format timestamps log entries log file name suffix changing locale only supported long access log valve has logged anything changing locale later can lead inconsistent formatting param locale name locale use public void set locale string locale name locale name locale name locale find locale locale name locale public methods log message summarizing specified request response according format specified code pattern code property param request request being processed param response response being processed exception ioexception input output error has occurred exception servlet exception servlet error has occurred override public void invoke request request response response throws ioexception servlet exception get next invoke request response override public void log request request response response long time get state available get enabled log elements null condition null null request get request get attribute condition condition null null request get request get attribute condition return xxx bit silly we want have start stop time duration consistent would better keep start stop simply request response object remove time duration from interface long start request get coyote request get start time date date get date start time char array writer result char array writers pop result null result new char array writer 128 int log elements length log elements add element result date request response time log result result size max log message buffer size result reset char array writers push result protected methods log specified message param message message logged object recycled calling method protected abstract void log char array writer message private methods method returns date object accurate within one second thread calls method get date been less than second since new date created method simply gives out same date again so system doesn spend time creating date objects return date private static date get date long systime date date local date get date set time systime return date find locale name protected static locale find locale string name locale fallback name null name empty return locale get default else locale locale get available locales name equals string return log error sm get string access log valve invalid locale name return fallback start component implement requirements link org apache catalina util lifecycle base start internal exception lifecycle exception component detects fatal error prevents component from being used override protected synchronized void start internal throws lifecycle exception set state lifecycle state starting stop component implement requirements link org apache catalina util lifecycle base stop internal exception lifecycle exception component detects fatal error prevents component from being used override protected synchronized void stop internal throws lifecycle exception set state lifecycle state stopping access log element writes partial message buffer protected interface access log element public void add element char array writer buf date date request request response response long time write thread name protected static class thread name element implements access log element override public void add element char array writer buf date date request request response response long time request info info request get coyote request get request processor info null buf append info get worker thread name else buf append write local ip address protected static class local addr element implements access log element private static final string local addr value static string init try init inet address get local host get host address catch throwable exception utils handle throwable init 127 local addr value init override public void add element char array writer buf date date request request response response long time buf append local addr value write remote ip address protected class remote addr element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object addr request get attribute remote addr attribute addr null buf append request get remote addr else buf append addr string else buf append request get remote addr write remote host name protected class host element implements access log element override public void add element char array writer buf date date request request response response long time string value null request attributes enabled object host request get attribute remote host attribute host null value host string value null value length value request get remote host value null value length value buf append value write remote logical username from identd always returns protected static class logical user name element implements access log element override public void add element char array writer buf date date request request response response long time buf append write request protocol protected class protocol element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object proto request get attribute protocol attribute proto null buf append request get protocol else buf append proto string else buf append request get protocol write remote user any else protected static class user element implements access log element override public void add element char array writer buf date date request request response response long time request null string value request get remote user value null buf append value else buf append else buf append write date time configurable format default clf format protected class date time element implements access log element format prefix specifying request start time private static final string request start prefix begin format prefix specifying response end time private static final string response end prefix end separator between optional prefix rest format private static final string prefix separator special format seconds since epoch private static final string sec format sec special format milliseconds since epoch private static final string msec format msec special format millisecond part timestamp private static final string msec fraction format msec frac patterns we use replace sss millisecond formatting simple date format our own handling private static final string msec pattern private static final string tripple msec pattern msec pattern msec pattern msec pattern our format description string null clf private final string format whether use begin request end response timestamp private final boolean uses begin format type private final format type type whether we need postprocess adding milliseconds private boolean uses msecs false protected date time element null replace millisecond formatting character some dummy characters order make resulting formatted time stamps cacheable we replace dummy chars later actual milliseconds because relatively cheap private string tidy format string format boolean escape false string builder result new string builder int len format length char int len format char escape result append else result append msec pattern uses msecs true escape escape return result string protected date time element string header string format header boolean uses begin false format type type format type clf format null format equals request start prefix uses begin true format else format starts request start prefix prefix separator uses begin true format format substring else format equals response end prefix uses begin false format else format starts response end prefix prefix separator uses begin false format format substring format length type format type clf else format equals sec format type format type sec else format equals msec format type format type msec else format equals msec fraction format type format type msec frac else type format type sdf format tidy format format format format uses begin uses begin type type override public void add element char array writer buf date date request request response response long time long timestamp date get time long frac uses begin timestamp time switch type case clf buf append local date cache get get format timestamp break case sec buf append long string timestamp 1000 break case msec buf append long string timestamp break case msec frac frac timestamp 1000 frac 100 frac 10 buf append buf append else buf append buf append long string frac break case sdf string temp local date cache get get format format locale timestamp uses msecs frac timestamp 1000 string builder tripple msec new string builder frac 100 frac 10 tripple msec append tripple msec append else tripple msec append tripple msec append frac temp temp replace tripple msec pattern tripple msec temp temp replace msec pattern long string frac buf append temp break write first line request method request uri protected static class request element implements access log element override public void add element char array writer buf date date request request response response long time request null string method request get method method null method means request line buf append else buf append request get method buf append buf append request get request uri request get query string null buf append buf append request get query string buf append buf append request get protocol else buf append write http status code response protected static class http status code element implements access log element override public void add element char array writer buf date date request request response response long time response null approach used reduce gc from string conversion int status response get status 100 status status 1000 buf append char status 100 append char status 10 10 append char status 10 else buf append integer string status else buf append write local port which request received protected class local port element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object port request get attribute server port attribute port null buf append integer string request get server port else buf append port string else buf append integer string request get server port write bytes sent excluding http headers protected static class byte sent element implements access log element private final boolean conversion conversion true write instead public byte sent element boolean conversion conversion conversion override public void add element char array writer buf date date request request response response long time don need flush since trigger log message after response has been committed long length response get bytes written false length protect against nulls unexpected types values may set untrusted applications object start request get attribute globals sendfile file start attr start instanceof long object end request get attribute globals sendfile file end attr end instanceof long length long end long value long start long value length conversion buf append else buf append long string length write request method get post etc protected static class method element implements access log element override public void add element char array writer buf date date request request response response long time request null buf append request get method write time taken process request protected static class elapsed time element implements access log element private final boolean millis millis true write time millis millis false write time seconds public elapsed time element boolean millis millis millis override public void add element char array writer buf date date request request response response long time millis buf append long string time else second buf append long string time 1000 buf append int remains int time 1000 buf append long string remains 100 remains remains 100 buf append long string remains 10 buf append long string remains 10 write time until first byte written commit time millis protected static class first byte time element implements access log element override public void add element char array writer buf date date request request response response long time long commit time response get coyote response get commit time commit time buf append else long delta commit time request get coyote request get start time buf append long string delta write query string prepended exists protected static class query element implements access log element override public void add element char array writer buf date date request request response response long time string query null request null query request get query string query null buf append buf append query write user session id protected static class session id element implements access log element override public void add element char array writer buf date date request request response response long time request null buf append else session session request get session internal false session null buf append else buf append session get id internal write requested url path protected static class request urielement implements access log element override public void add element char array writer buf date date request request response response long time request null buf append request get request uri else buf append write local server name protected static class local server name element implements access log element override public void add element char array writer buf date date request request response response long time buf append request get server name write any string protected static class string element implements access log element private final string str public string element string str str str override public void add element char array writer buf date date request request response response long time buf append str write incoming headers xxx protected static class header element implements access log element private final string header public header element string header header header override public void add element char array writer buf date date request request response response long time enumeration string iter request get headers header iter has more elements buf append iter next element while iter has more elements buf append append iter next element return buf append write specific cookie xxx protected static class cookie element implements access log element private final string header public cookie element string header header header override public void add element char array writer buf date date request request response response long time string value cookie request get cookies null int length header equals get name value get value break buf append value write specific response header xxx protected static class response header element implements access log element private final string header public response header element string header header header override public void add element char array writer buf date date request request response response long time null response iterator string iter response get headers header iterator iter has next buf append iter next while iter has next buf append append iter next return buf append write attribute servlet request xxx protected static class request attribute element implements access log element private final string header public request attribute element string header header header override public void add element char array writer buf date date request request response response long time object value null request null value request get attribute header else value value null value instanceof string buf append string value else buf append value string else buf append write attribute http session xxx protected static class session attribute element implements access log element private final string header public session attribute element string header header header override public void add element char array writer buf date date request request response response long time object value null null request http session sess request get session false null sess value sess get attribute header else value value null value instanceof string buf append string value else buf append value string else buf append parse pattern string create array access log element protected access log element create log elements list access log element list new array list boolean replace false string builder buf new string builder int pattern length char ch pattern char replace code processes behavior do encounter closing ignore ch string builder name new string builder int pattern length pattern char name append pattern char pattern length account which we increment now list add create access log element name string pattern char since we walked more than one character else oh end string pretend we never did do processing old way list add create access log element ch else list add create access log element ch replace false else ch replace true list add new string element buf string buf new string builder else buf append ch buf length list add new string element buf string return list array new access log element create access log element which needs header string protected access log element create access log element string header char pattern switch pattern case return new header element header case return new cookie element header case return new response header element header case return new request attribute element header case return new session attribute element header case return new date time element header default return new string element create access log element protected access log element create access log element char pattern switch pattern case return new remote addr element case return new local addr element case return new byte sent element true case return new byte sent element false case return new elapsed time element true case return new first byte time element case return new host element case return new protocol element case return new logical user name element case return new method element case return new local port element case return new query element case return new request element case return new http status code element case return new session id element case return new date time element case return new elapsed time element false case return new user element case return new request urielement case return new local server name element case return new thread name element default return new string element pattern
concrete link abstract access log valve outputs access log file features include li automatic date based rollover log files li li optional log file rotation li	super	override	super start internal	super stop internal
processor upgrade state processor upgrade dispatch next dispatch get socket status else state processor async dispatch next dispatch get socket status	private final abstract servlet output stream upgrade servlet output stream abstract servlet output stream upgrade servlet output stream	protected final socket wrapper socket wrapper	public abstract servlet output stream socket wrapper socket wrapper socket wrapper socket wrapper	container responsible first call write possible only need do setting listener first time rather than changing synchronized fire listener lock fire listener true socket wrapper add dispatch dispatch type non blocking write	buffer null write internal buffer buffer length	make sure ready write possible have consistent view buffer fire listener when determining listener should fire	public apr servlet output stream socket wrapper long socket wrapper super socket wrapper socket socket wrapper get socket long value	lock read lock socket wrapper get blocking status read lock write lock write lock socket wrapper get blocking status write lock socket wrapper get blocking status block	socket wrapper set blocking status block	integer value written long value socket socket wrapper	public bio servlet output stream socket wrapper socket socket wrapper super socket wrapper os socket wrapper get socket get output stream	socket wrapper nio channel socket wrapper nio selector pool pool super socket wrapper channel socket wrapper get socket	test public void test first call write possible throws exception do test fixed response fixed response non blocking class	private void do test fixed response class extends http upgrade handler upgrade handler class throws exception upgrade connection conn do upgrade upgrade handler class reader conn get reader int read assert assert equals fixed response non blocking fixed response	public static class fixed response non blocking implements http upgrade handler public static final char fixed response private servlet input stream sis private servlet output stream sos override public void init web connection connection try sis connection get input stream sos connection get output stream catch ioexception ioe throw new illegal state exception ioe sis set read listener new op read listener sos set write listener new fixed response write listener override public void destroy op private class fixed response write listener extends op write listener override public void write possible try sos write fixed response sos flush catch ioexception ioe throw new illegal state exception ioe
open socket keep alive	socket wrapper get socket get poller process sendfile key key attachment socket wrapper true sendfile progress true else write failed log debug enabled log debug sm get string sendfile error error true
private final list saxparse exception errors new array list private final list saxparse exception warnings new array list	public list saxparse exception get errors public list saxparse exception get warnings
filter out non jar resources int jar count jar count jar has been added	jar count jar modification times size log info sm get string webapp class loader jars removed resources get context get name return true
two thoroughly exercised two other unit test classes test basic auth parser test non login basic class mainly examines way single sign valve interacts two webapps when second cannot directly needs inherit its via other when server client can both use cookies preserved through exchange cookie which different individual unique jsessionid cookies assigned separately two webapp sessions other situation examined where server returns cookies client configured ignore them tomcat clearly states sso requires client support cookies so access resources other webapp containers receives sso assistance protected static final boolean use cookies true protected static final boolean cookies use cookies private static final string nice method basic	session expiry web xml defined minutes private static final int short session timeout mins private static final int long session timeout mins we don change expiry scan interval just iteration count private static final int manager scan interval secs 10 private static final int manager expire sessions fast now compute some delays beware units private static final int extra delay secs private static final long reasonable msecs expiry manager scan interval secs manager expire sessions fast extra delay secs 1000 private static final string client auth header private static final string server auth header www authenticate private static final string server cookie header set cookie private static final string client cookie header cookie private static final string encode session param jsessionid private static final string encode ssosession param private static final test ssonon login basic basic credentials credentials null private static final test ssonon login basic basic credentials good credentials new test ssonon login basic basic credentials nice method user pwd private tomcat tomcat private context basic context private context nonlogin context private string encoded url run some sanity checks without established sso session make sure test environment correct public void test essential environment throws exception should permitted access unprotected resource use cookies http servlet response sc ok should permitted access protected resource two used remaining tests do test non login context path nologin uri protected use cookies http servlet response sc forbidden do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized public void test essential environment without cookies throws exception should permitted access unprotected resource do test non login context path nologin uri public cookies http servlet response sc ok should permitted access protected resource two used remaining tests cookies http servlet response sc forbidden do test basic context path login uri protected credentials cookies http servlet response sc unauthorized resource should rejected sc forbidden 401 status note test run slightly more than minute public void test basic access session timeout throws exception set rapid session timeout detection do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized do test basic context path login uri protected good credentials use cookies http servlet response sc ok verify ssoid exists cookie do test basic context path login uri protected good credentials use cookies http servlet response sc ok make session time out lose do imminent session timeout basic context do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized webapp while providing sso session cookie received from first webapp should successful sc ok 200 status public void test basic login accept cookies throws exception do test basic context path login uri protected credentials cookies http servlet response sc unauthorized do test basic context path login uri protected good credentials use cookies http servlet response sc ok send cookie which proves we have sso session use cookies http servlet response sc ok webapp without sending sso session cookie should rejected sc forbidden 403 status public void test basic login reject without cookie throws exception do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized do test basic context path login uri protected good credentials use cookies http servlet response sc ok fail send cookie other webapp cookies http servlet response sc forbidden logon access protected resource using basic which establish sso session try access protected resource non login webapp sending jsessionid from redirect header access request should rejected because basic webapp session id valid any other container test public void test basic access accept auth uri throws exception set always use session first fail access protected resource without credentials do test basic context path login uri protected credentials cookies http servlet response sc unauthorized now access protected resource good credentials establish session do test basic context path login uri protected good credentials cookies http servlet response sc ok next access again harvest session id url parameter string forward param next url context path login uri protected do test basic context path login uri protected forward param good credentials cookies http servlet response sc ok verify session id encoded absolute url string first encoded url encoded url assert true first encoded url contains encode session param access protected resource encoded url session id do test basic first encoded url forward param credentials cookies http servlet response sc ok verify session id has changed verify sso session id encoded string second encoded url encoded url assert equals first encoded url second encoded url assert false first encoded url contains encode ssosession param extract first container session id int ix second encoded url index encode session param string session id second encoded url substring ix expect fail using session id different container do test non login context path nologin uri protected session id cookies http servlet response sc forbidden webapp while providing sso session cookie received from first webapp should successful sc ok 200 status has expired should successful sc ok 200 status note test run slightly more than minutes set rapid session timeout detection begin repeat test basic login accept protected cookies do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized do test basic context path login uri protected good credentials use cookies http servlet response sc ok use cookies http servlet response sc ok long enough non login session expiry do imminent session timeout basic context successful non login access should replenish individual session expiry time keep sso session alive use cookies http servlet response sc ok wait long enough non login session expire which also tear down sso session same time do imminent session timeout nonlogin context do test non login context path nologin uri protected use cookies http servlet response sc forbidden do test basic context path login uri protected credentials use cookies http servlet response sc unauthorized public void do test non login string uri boolean use cookie int expected rc throws exception use cookie cookies null req headers put client cookie header cookies expected rc http servlet response sc ok private void do test basic string uri test ssonon login basic basic credentials credentials boolean use cookie int expected rc throws exception map string list string req headers new hash map map string list string resp headers new hash map use cookie cookies null req headers put client cookie header cookies credentials null list string auth new array list auth add credentials get credentials req headers put client auth header auth byte chunk bc new byte chunk int rc get url http prefix get port uri bc req headers resp headers assert equals unexpected return code expected rc rc expected rc http servlet response sc ok assert true bc get length expected rc http servlet response sc unauthorized server should identify acceptable method boolean method found false list string auth headers resp headers get server auth header string auth header auth headers auth header index nice method method found true break assert true method found string page bc string assert null page assert true page starts ok use cookie list string new cookies resp headers get server cookie header new cookies null harvest cookies whenever server sends some new ones cookies new cookies else encoded url final string start href final string end int start page index start int end start start start length end page index end start end encoded url page substring start end setup two webapps every test note super class tear down method stop tomcat tomcat get tomcat instance	set up non login set up login override public void tear down throws exception tomcat stop private void set up non login throws exception nonlogin context tomcat add context context path nologin nonlogin context set session timeout long session timeout mins add protected servlet context tomcat add servlet nonlogin context tester servlet1 new tester servlet encode url nonlogin context add servlet mapping uri protected tester servlet1 nonlogin context add constraint sc1 add unprotected servlet context tomcat add servlet nonlogin context tester servlet2 new tester servlet encode url nonlogin context add servlet mapping uri public tester servlet2 nonlogin context add constraint sc2 nonlogin context set login config lc base nonlogin new non login nonlogin context get pipeline add valve nonlogin private void set up login throws exception basic context tomcat add context context path login basic context set session timeout short session timeout mins add protected servlet context tomcat add servlet basic context tester servlet3 new tester servlet encode url basic context add servlet mapping uri protected tester servlet3 basic context add constraint sc add unprotected servlet context tomcat add servlet basic context tester servlet4 new tester servlet encode url basic context add servlet mapping uri public tester servlet4 security collection collection2 new security collection collection2 add pattern uri public security constraint sc2 new security constraint do add role which signals access permitted without one sc2 add collection collection2 basic context add constraint sc2 configure inherit realm from engine basic context set login config lc base basic new basic basic context get pipeline add valve basic	cookies resp headers get server cookie header	req headers put client cookie header cookies force non default behaviour both session id regenerated after which less secure needed browsers handle cookies private void set always use session base basic context get set always use session true base nonlogin context get set always use session true force faster timeout active container than can defined web xml getting active session we can choose seconds instead minutes note shamelessly cloned from manager base beware synch issues underlying sessions private void do imminent session timeout context active context manager base manager manager base active context get manager session sessions manager find sessions int sessions length sessions null sessions valid sessions set max inactive interval extra delay secs leave expired manager try thread sleep reasonable msecs expiry catch interrupted exception ie ignored paranoid verification active sessions have now gone sessions manager find sessions assert true sessions length force rapid timeout scanning both webapps standard manager default service cycle time 10 seconds session expiry scan every cycles private void set rapid session timeout detection manager base basic context get manager set process expires frequency manager expire sessions fast manager base nonlogin context get manager set process expires frequency manager expire sessions fast encapsulate logic generate http header basic note only used internally so need validate arguments private static final class basic credentials private final string method private final string username private final string password private final string credentials private basic credentials string method string username string password method method username username password password string user credentials username password byte credentials bytes user credentials get bytes standard charsets iso 8859 string base64auth base64 encode base64string credentials bytes credentials method base64auth private string get credentials return credentials	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test servlet always encode url case client requires session persistence configured support cookies private static final long serial version uid 1l almost minimal processing servlet param next url url caller would like go next supplied put encoded url returned html page hyperlink override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain print writer out resp get writer out print ok string param req get parameter next url param null append encoded url carry sessionids string target url resp encode url param out print you want go href out print target url out print here next
context name cn new context name get name false	context name cn new context name deploy war get name true	context name cn new context name remove war get name true	context name cn new context name filename true	context name cn new context name context get name false	context name cn new context name context get name false	context name cn new context name context get name false	context name cn new context name context get name false	context name cn new context name get name false	context name cn new context name name false	context name cn new context name files true	context name cn new context name files true	context name cn new context name files false	context name previous new context name iter next false context name current new context name iter next false	context name cn new context name context get name false	param strip file extension war xml file extension present end provided name should removed public context name string name boolean strip file extension	strip file extension tmp1 lower case locale english ends war tmp1 lower case locale english ends xml	private static final context name app name new context name myapp false	private context name cn21 private context name cn22	cn11 new context name root false cn12 new context name foo false cn13 new context name foo bar false cn14 new context name root false cn15 new context name foo false cn16 new context name foo bar false cn18 new context name root bar false cn19 new context name root bar false cn20 new context name root false cn21 new context name foo war false cn22 new context name foo war true	assert equals foo war cn21 get base name assert equals foo cn22 get base name	assert equals foo war cn21 get path assert equals foo cn22 get path	assert equals cn21 get version assert equals cn22 get version	assert equals foo war cn21 get name assert equals foo cn22 get name	assert equals foo war cn21 get display name assert equals foo cn22 get display name	do test constructor string cn21 do test constructor string cn22 do compare src new context name src get base name false do compare src new context name src get display name false do compare src new context name src get name false
path should never null root path null equals path root equals path	private context name cn17 private context name cn18 private context name cn19 private context name cn20	cn17 new context name root null cn18 new context name root bar cn19 new context name root bar cn20 new context name root	assert equals root cn17 get base name assert equals root bar cn18 get base name assert equals root bar cn19 get base name assert equals root cn20 get base name	assert equals cn17 get path assert equals root bar cn18 get path assert equals root bar cn19 get path assert equals cn20 get path	assert equals cn17 get version assert equals cn18 get version assert equals cn19 get version assert equals cn20 get version	assert equals cn17 get name assert equals root bar cn18 get name assert equals root bar cn19 get name assert equals cn20 get name	assert equals cn17 get display name assert equals root bar cn18 get display name assert equals root bar cn19 get display name assert equals cn20 get display name	do test constructor string cn17 do test constructor string cn18 do test constructor string cn19 do test constructor string cn20
servlet non blocking write listener fire listener false registered write false
url null tld resource path tld resource path resource path ends jar path points jar file tld presumed inside meta inf taglib tld tld resource path new tld resource path url resource path meta inf taglib tld else tld resource path new tld resource path url resource path parse tld store using uri supplied descriptor taglib xml tld tld parser parse tld resource path uri tld resource path map put taglib uri tld resource path tld resource path taglib xml map put tld resource path tld tld get listeners null listeners add all tld get listeners log warn localizer get message msg webxml fail path does exist resource path taglib uri continue
int urls length tomcat can use urls other than file urls however protocol other than file generate bad file system path so only add file protocol urls classpath urls get protocol equals file try need decode url primarily convert 20 sequences back spaces string decoded urldecoder decode urls get path utf cpath append decoded sep catch unsupported encoding exception all jres required support utf
td 10 192 168 169 254 127 172 172 172 br default 10 192 168 16 169 254 16 127 172 16 12 allowed td	127 172 172 172	td 10 192 168 169 254 127 172 172 172 br default 10 192 168 16 169 254 16 127 172 16 12 allowed td	127 172 172 172 10 192 168 169 254 127 172 172 172 10 192 168 169 254 127 172 172 172
map string web xml fragments process jars web fragments web xml	protected map string web xml process jars web fragments web xml application boolean parse required true set string absolute order application get absolute ordering absolute order null absolute order empty context get xml validation skip parsing when empty absolute ordering validation enabled parse required false new fragment jar scanner callback web xml parser delegate parse required	empty absolute ordering element present fragment processing may skipped set string absolute ordering web xml get absolute ordering absolute ordering null absolute ordering empty return web xml	fragment jar scanner callback callback new fragment jar scanner callback web xml parser false true	private final boolean parse required public fragment jar scanner callback web xml parser web xml parser boolean delegate boolean parse required parse required parse required	files web fragment xml files don need parsed never going used webapp parse required
property name set configure used sslcontext value should instance sslcontext property present ssl truststore properties ignored public static final string ssl context property org apache tomcat websocket ssl context	see custom sslcontext has been provided sslcontext ssl context sslcontext user properties get ssl context property ssl context null create ssl context ssl context sslcontext get instance tls trust store string ssl trust store value string user properties get ssl truststore property ssl trust store value null string ssl trust store pwd value string user properties get ssl truststore pwd property ssl trust store pwd value null ssl trust store pwd value ssl truststore pwd default file key store file new file ssl trust store value key store ks key store get instance jks try input stream new file input stream key store file ks load ssl trust store pwd value char array trust manager factory tmf trust manager factory get instance trust manager factory get default algorithm tmf init ks ssl context init null tmf get trust managers null else ssl context init null null null li code org apache tomcat websocket ssl context code li code org apache tomcat websocket ssl context code property set code org apache tomcat websocket ssl truststore code code org apache tomcat websocket ssl truststore pwd code properties ignored
out token subject do lc get subject new accept action gss context decoded	class gets gss credential via privileged action private static class accept action implements privileged exception action byte gsscontext gss context byte decoded accept action gsscontext context byte decoded token gss context context decoded decoded token override public byte run throws gssexception return gss context accept sec context decoded decoded length
bb get buffer length bb get end bb get length bb get limit need expand output buffer bb make space output char chunk get length else bb flush buffer	make space len chars len small allocate reserve space too never grow bigger than limit public void make space int count
file file path substring web app mount length false exists return new empty resource root path	private final file file root web app path null public empty resource web resource root root string web app path file file file file	file null return null else try return file get canonical path catch ioexception return null	web resource main empty null	virtual null result virtual virtual result else main equals web resource set main empty result	return main empty	get canonical path test public final void test get canonical path exists web resource exists resource root get resource get mount d1 d1 f1 txt string exists canonical path exists get canonical path url exists url exists get url file equals exists url get protocol should have canonical path assert assert null exists canonical path else assert assert null exists canonical path test public final void test get canonical path does exist web resource exists resource root get resource get mount d1 d1 f1 txt web resource does exist resource root get resource get mount d1 dummy txt string does exist canonical path does exist get canonical path url exists url exists get url file equals exists url get protocol should possible construct canonical path resource doesn exist given resource does exist same directory has url file protocol assert assert null does exist canonical path else assert assert null does exist canonical path
gss credential tomcat principal user principal get gss credential gss credential null int left try left gss credential get remaining lifetime catch gssexception log warn sm get string coyote request gss lifetime fail user principal get name left gss credential has expired need re authenticate try logout catch servlet exception should never happen code called logout throws servlet exception return null
log error sm get string memory user database file found file get absolute path
qop should used connection ldap server after value used set code javax security sasl qop code environment property ldap connection protected string spengo delegation qop auth conf	public string get spengo delegation qop return spengo delegation qop public void set spengo delegation qop string spengo delegation qop spengo delegation qop spengo delegation qop	javax security sasl qop spengo delegation qop attribute mame spengo delegation qop requireed false when jndi realm used spnego code use delegated credential code code true code attribute controls qop should used connection ldap server after value used set code javax security sasl qop code environment property ldap connection attribute should comma separated list values selected from code auth conf code code auth int code code auth code default value code auth conf code attribute when jndirealm used spnego delegated
private string list string path boolean validate validate path validate path	path validate path	path validate path	path validate path	private web resource get resource string path boolean validate validate path validate path	ensures object valid state serve resources checks path string starts checks path can normalized without stepping outside root param path return normlized path private string validate string path get state available throw new illegal state exception sm get string standard root check state started return request util normalize path	path validate path	private web resource list resources string path boolean validate validate path validate path
atomic boolean error new atomic boolean false res action action code error error comet async error get	has processor been placed error state note response may have appropriate error code set error	else action code action code error atomic boolean param set error	else action code action code error atomic boolean param set error	else action code action code error atomic boolean param set error	private static count down latch new count down latch private static count down latch new count down latch private static count down latch new count down latch private static boolean bug55772is second request false private static boolean state leaked false test public void test bug55772 throws exception tomcat tomcat get tomcat instance tomcat get connector set property processor cache tomcat get connector set property max threads must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt async new ctxt add servlet mapping async tomcat start string request1 get async http host localhost get port connection keep alive cache control max age accept text html application xhtml xml application xml image webp user agent request1 accept encoding gzip deflate sdch accept language en us en fr es cookie something should leak true string request2 get async http host localhost get port connection keep alive cache control max age accept text html application xhtml xml application xml image webp user agent request2 accept encoding gzip deflate sdch accept language en us en fr es try final socket connection new socket localhost get port connection set so linger true writer writer new output stream writer connection get output stream b2cconverter get charset us ascii writer write request1 writer flush await connection close await bug55772is second request true try final socket connection new socket localhost get port connection set so linger true writer writer new output stream writer connection get output stream b2cconverter get charset us ascii writer write request2 writer flush connection get input stream read await state leaked assert fail state leaked between requests private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception bug55772is second request cookie cookies req get cookies cookies null cookies length cookie cookie req get cookies cookie get name equals ignore case something should leak state leaked true count down else req get cookies we have do so tomcat actually parse cookies from request req set attribute org apache catalina async supported boolean true async context async context req start async async context set timeout 5000 count down print writer writer async context get response get writer writer print writer flush count down
-1
try ssl context sslcontext make root pool value ssl ssl mode server catch exception ssl engine disabled apr lifecycle listener exception here way check apr lifecycle listener settings from here throw new exception sm get string endpoint apr fail ssl context make
get root xml syntax non el elements need xml escaped xml escape non elvisitor new xml escape non elvisitor el visit result new node jsp attribute tai name uri local name get text false el dynamic else result new node jsp attribute tai name uri local name value false el dynamic	private static class xml escape non elvisitor extends elparser text builder override public void visit text throws jasper exception output append xml escape get text	protected static string xml escape string null return null int len length look any bad characters escape bad character found ascii 34 38 39 60 62 int len char char need escape them quote whole string string builder sb new string builder int len sb append int pos int len char pos sb append pos sb append lt pos else pos sb append pos sb append gt pos else pos sb append pos sb append 039 apos pos else pos sb append pos sb append amp pos else pos sb append pos sb append 034 quot pos pos len sb append pos len return sb string return	assert assert true result contains quot 1foo1 quot result contains 034 1foo1 034 assert assert true result contains quot 2bar2 quot result contains 034 2bar2 034 assert assert true result contains quot 3a amp b3 quot result contains 034 3a amp b3 034 assert assert true result contains quot quot result contains 034 034 assert assert true result contains quot apos quot result contains 034 apos 034	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license performance tests link validator private static string bug53867test data new string hello world meta http equiv content language connection has limited network connectivity please use web page access file server resources test public void test bug53867 int 10 do test bug53867 private static void do test bug53867 int count 100000 int bug53867test data length assert assert equals do test bug53867old version bug53867test data validator xml escape bug53867test data int 100 int bug53867test data length do test bug53867old version bug53867test data int 100 int bug53867test data length validator xml escape bug53867test data long start system current time millis int count int bug53867test data length do test bug53867old version bug53867test data system out println old escape system current time millis start start system current time millis int count int bug53867test data length validator xml escape bug53867test data system out println new escape system current time millis start private static string do test bug53867old version string null return null string builder sb new string builder int length char char sb append lt else sb append gt else sb append 039 apos else sb append amp else sb append 034 quot else sb append return sb string
executor public static final string executor core size init param org apache tomcat websocket executor core size public static final string executor max size init param org apache tomcat websocket executor max size public static final string executor seconds init param org apache tomcat websocket executor keep alive time seconds	ws server container obj shutdown executor	triggered poller so isn same thread triggered write so need dispatch ws remote endpoint server write possible false	private static final queue result runnable result runnables new concurrent linked queue private final executor service executor service	executor service server container get executor service	definitely same thread triggered write so dispatch required write possible true public void write possible boolean use dispatch	clear handler null use dispatch	clear handler ioe use dispatch	close can triggered wide range scenarios far simpler just always use dispatch try track whether method called same thread triggered write clear handler new eofexception true	currently only called from background thread so we could just call clear handler use dispatch false method parameter added case other callers started use method make sure those callers think through what correct value use dispatch them protected void timeout boolean use dispatch clear handler new socket timeout exception use dispatch param throwable associated any error occurred param use dispatch should link send handler result send result called from new thread keeping mind requirements link javax websocket remote endpoint async private void clear handler throwable boolean use dispatch	use dispatch result runnable result runnables poll null new result runnable result runnables init sh executor service null executor service shutdown can use executor so call runnable directly may strictly compliant all cases during shutdown only close messages going sent so should issue nested calls leading stack overflow described bug 55715 issues nested calls reason separate thread requirement run else executor service execute else null sh result new send result else sh result new send result private static class result runnable implements runnable private final queue result runnable queue private volatile send handler sh private volatile throwable private result runnable queue result runnable queue queue queue private void init send handler sh throwable sh sh override public void run null sh null return runnable queue when has been finished note method takes age finish shouldn any thread safety issues fields cleared above queue add	private final executor service executor service	executor config int executor core size int executor max size 10 long executor keep alive time seconds 60 value servlet context get init parameter constants executor core size init param value null executor core size integer parse int value value servlet context get init parameter constants executor max size init param value null executor max size integer parse int value value servlet context get init parameter constants executor seconds init param value null executor keep alive time seconds long parse long value	use per web application executor any threads web socket server code needs create group all threads under single thread group string buffer thread group name new string buffer web socket server thread group name append servlet context get virtual server name thread group name append equals servlet context get context path thread group name append root else thread group name append servlet context get context path thread group thread group new thread group thread group name string ws thread factory ws thread factory new ws thread factory thread group executor service new thread pool executor executor core size executor max size executor keep alive time seconds time unit seconds new linked blocking queue runnable ws thread factory	executor service get executor service return executor service void shutdown executor executor service shutdown try executor service await termination 10 time unit seconds catch interrupted exception ignore interruption carry	private static class ws thread factory implements thread factory private final thread group tg private final atomic long count new atomic long private ws thread factory thread group tg tg tg override public thread new thread runnable thread new thread tg set name tg get name count increment get return	background thread thread triggered write so need use dispatch endpoint timeout false asynchronous writes performed different thread thread initiated write since container thread pool exposed via servlet api web socket has provide its own thread pool thread pool controlled following servlet context parameters ul li code org apache tomcat websocket executor core size code core size executor thread pool set default zero used li li code org apache tomcat websocket executor max size code maximum permitted size executor thread pool set default 10 used li li code org apache tomcat websocket executor keep alive time seconds code maximum time idle thread remain executor thread pool until terminated specified default 60 seconds used li ul
private input stream get resource stream string uri string uri string starts file uri uri try uri new uri uri string catch urisyntax exception file found exception fnfe new file found exception get message fnfe init cause throw fnfe return new file input stream new file uri string real ctxt get real path uri string return ctxt get resource stream uri string return ctxt get resource stream uri string
try while tg get parent null tg tg get parent catch security exception se string msg sm get string webapp class loader get thread group error tg get name log debug enabled log debug msg se else log warn msg
value null util assignable from value get class base get class get component type	static boolean assignable from class src class target	tests setting arrays primitives https issues apache org bugzilla show bug cgi id 55691 test public void test set value08 array elresolver resolver new array elresolver elcontext context new standard elcontext elmanager get expression factory int base new int resolver set value context base new integer integer value assert assert equals integer value base integer value
message handler listener endpoint config endpoint config session session	get message method listener session	get message method listener session	get message method listener session	new pojo message handler whole binary listener session	new pojo message handler whole text listener session	util get message handlers listener endpoint config
public static class get decoder type class extends decoder decoder return class util get generic type decoder class decoder	else arg type instanceof type return type arg type get raw type	test public void test get encoder type simple generic type assert assert equals list class util get encoder type simple encoder generic type class	private static class simple encoder generic type implements encoder text list string override public void init endpoint config endpoint config op override public void destroy op override public string encode list string object throws encode exception return null	private static final string path generics ep echo generics ep	test public void test generics coders throws exception set up utility classes generics server server new generics server singleton configurator set instance server server config listener set pojo clazz generics server class tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener new application listener server config listener class get name false tomcat add servlet ctx default new default servlet ctx add servlet mapping default web socket container ws container container provider get web socket container tomcat start generics client client new generics client uri uri new uri ws localhost get port path generics ep session session ws container connect server client uri array list string list new array list list add str1 list add str2 session get basic remote send object list should take very long int while 20 server received size client received size break thread sleep 100 check messages were received assert assert equals server received size assert assert equals server received peek string str1 str2 assert assert equals client received size assert assert equals client received peek string str1 str2 session close	client endpoint decoders list string decoder class encoders list string encoder class public static class generics client private queue object received new concurrent linked queue message public void rx list string received add	server endpoint value path generics ep decoders list string decoder class encoders list string encoder class configurator singleton configurator class public static class generics server private queue object received new concurrent linked queue message public list string rx list string received add echo message back return	public static class list string encoder implements encoder text list string override public void init endpoint config endpoint config server add life cycle event get class get name init override public void destroy server add life cycle event get class get name destroy override public string encode list string str throws encode exception string buffer sbuf new string buffer sbuf append string str sbuf append append sbuf delete char sbuf last index append return sbuf string public static class list string decoder implements decoder text list string override public void init endpoint config endpoint config server add life cycle event get class get name init override public void destroy server add life cycle event get class get name destroy override public list string decode string str throws decode exception list string lst new array list str str substring str length string strings str split string strings lst add return lst override public boolean decode string str return str starts str ends
digester set use context class loader true	digester set use context class loader true	init param param name gzip param name param value true param value init param
should serve gzip versions files default set true protected boolean gzip true	get servlet config get init parameter gzip null gzip boolean parse boolean get servlet config get init parameter gzip	serve gzipped version file present gzip check gzip request resource file path ends gz web resource gzip resource resources get resource path gz gzip resource exists gzip resource file gzip resource set mime type content type response add header content encoding gzip resource gzip resource	check user agent supports gzip encoding param request servlet request we processing return boolean true user agent supports gzip encoding false user agent does support gzip encoding protected boolean check gzip http servlet request request enumeration string headers request get headers accept encoding while headers has more elements string header headers next element header index gzip return true return false	verify serving gzipped resources from context root test public void test gzipped file throws exception tomcat tomcat get tomcat instance file app dir new file test webapp file gzip index new file app dir index html gz long gzip size gzip index length file index new file app dir index html long index size index length app dir relative server home tomcat add webapp null app dir get absolute path tomcat start test gzip client gzip client new test gzip client get port gzip client reset gzip client set request new string get index html http crlf host localhost crlf connection close crlf accept encoding gzip crlf crlf gzip client connect gzip client process request assert true gzip client response200 list string response headers gzip client get response headers assert true response headers contains content length gzip size gzip client reset gzip client set request new string get index html http crlf host localhost crlf connection close crlf crlf gzip client connect gzip client process request assert true gzip client response200 response headers gzip client get response headers assert true response headers contains content type text html assert false response headers contains content encoding gzip assert true response headers contains content length index size	private static class test gzip client extends simple http client public test gzip client int port set port port override public boolean response body ok return true add bug 54095 bug add support default servlet serving gzipped versions static resources directly from disk alternative tomcat compressing them each request patch philippe marschall markt add property name gzip gzipped version file exists file code gz code appended file name located alongside original file tomcat serve gzipped file user agent supports gzip option enabled true property
protected void init web xml throws jasper exception	throw new jasper exception ioe fix bug 55251 bug do allow jsp task fail silently web xml web xml fragment can generated markt fix
return expression el null named attribute	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test jsp attribute literal throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null app dir get absolute path tomcat start byte chunk res get url http localhost get port bug5nnnn bug55642a jsp string result res string system out println result assert assert true result index bug5nnnn bug55642b jsp foo bar	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license jsp param name value jsp param name value	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
private static volatile tomcat urlstream handler factory instance null obtain reference singleton instance recommended callers check value link registered before using returned instance get instance internal true private static tomcat urlstream handler factory get instance internal boolean register double checked locking ok because instance volatile instance null synchronized tomcat urlstream handler factory class instance null instance new tomcat urlstream handler factory register return instance private final boolean registered returns code true code factory already registered jvm successfully registered result call code false code factory disabled prior call public static boolean register return get instance internal true registered prevent factory from registering jvm may called more than once returns code true code factory already disabled successfully disabled result call code false code factory already registered prior call public static boolean disable return get instance internal false registered	private tomcat urlstream handler factory boolean register registered register register url set urlstream handler factory public boolean registered return registered since jvm only allows single call link url set urlstream handler factory urlstream handler factory tomcat needs register handler provide mechanism allow applications register own handlers public void add user factory urlstream handler factory factory user factories add factory
unregister mbean server string str type mbean server delegate object name object name try object name new object name str bean server remove notification listener object name null null catch exception print stack trace
strong note strong class loader implements link class loader permitting web application classes instrument other classes same web application does permit system container classes classes other web apps implements lifecycle class loader	private static final string class file suffix class	holds class file transformers decorating class loader copy write array list thread safe expensive writes those should rare very fast reads since actually used importantly class loader never block iterating over transformers while loading class private final list class file transformer transformers new copy write array list	adds specified class file transformer class loader transformer able modify bytecode any classes loaded class loader after invocation method param transformer transformer add class loader override public void add transformer class file transformer transformer transformer null throw new illegal argument exception sm get string webapp class loader add transformer illegal argument get context name transformers contains transformer same instance transformer already added bail out log warn sm get string webapp class loader add transformer duplicate transformer get context name return transformers add transformer log info sm get string webapp class loader add transformer transformer get context name removes specified class file transformer from class loader longer able modify byte code any classes loaded class loader after invocation method however any classes already modified transformer remain transformed param transformer transformer remove override public void remove transformer class file transformer transformer transformer null return transformers remove transformer log info sm get string webapp class loader remove transformer transformer get context name return returns copy class loader without any class file transformers tool often used java persistence api providers inspect entity classes absence any something can guaranteed within context link class file transformer link class file transformer transform class loader string class protection domain byte transform method returned class loader resource cache have been cleared so classes already instrumented retained returned return transformer free copy class loader override public webapp class loader copy without transformers webapp class loader loader new webapp class loader parent loader anti jarlocking anti jarlocking loader resources resources loader delegate delegate loader last jar accessed last jar accessed loader repository path repository path loader repository repository loader jar path jar path loader loader dir loader dir loader canonical loader dir canonical loader dir loader started started loader need convert need convert loader clear references static clear references static loader clear references stop threads clear references stop threads loader clear references stop timer threads clear references stop timer threads loader clear references log factory release clear references log factory release loader clear references http client keep alive thread clear references http client keep alive thread loader repository urls repository urls clone loader jar files jar files clone loader jar real files jar real files clone loader jar names jar names clone loader last modified dates last modified dates clone loader paths paths clone loader found resources put all found resources loader permission list add all permission list loader loader pc put all loader pc return loader	transformers size sb append class file transformers class file transformer transformer transformers sb append transformer append	name ends class file suffix	string class path temp path class file suffix	protected resource entry find resource internal final string name final string path	boolean class resource path ends class file suffix	anti jarlocking path ends class file suffix	class file suffix	class resource entry binary content null transformers size resource class just being loaded decorate any attached transformers string class name name ends class file suffix name substring name length class file suffix length name string internal name class name replace class file transformer transformer transformers try byte transformed transformer transform internal name null null entry binary content transformed null entry binary content transformed catch illegal class format exception log error sm get string webapp class loader transform error name return null	string name triggers replace class file suffix	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license specifies class loader capable being decorated link class file transformer transformers can instrument weave byte code classes loaded through class loader alter behavior currently only link org apache catalina loader webapp class loader implements interface allows web application frameworks jpa providers bundled web application instrument web application classes necessary you should always program against methods interface whether using reflection otherwise methods code webapp class loader protected default security manager one use since 44 adds specified class file transformer class loader transformer able instrument bytecode any classes loaded class loader after invocation method param class file transformer transformer add class loader throws illegal argument exception literal transformer null void add transformer class file transformer transformer removes specified class file transformer from class loader longer able instrument byte code any classes loaded class loader after invocation method however any classes already instrumented transformer before method call remain instramented state param class file transformer transformer remove void remove transformer class file transformer transformer returns copy class loader without any class file transformers tool often used java persistence api providers inspect entity classes absence any something can guaranteed within context link class file transformer link class file transformer transform class loader string class java security protection domain byte transform method returned class loader resource cache have been cleared so classes already instrumented retained returned return transformer free copy class loader class loader copy without transformers	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final string package prefix org apache catalina loader private static string webapp doc base before class public static void set up class throws exception webapp doc base system get property java io tmpdir test webapp class loader weaving file classes new file webapp doc base web inf classes package prefix classes mkdirs copy resource package prefix tester never weaved class class new file classes tester never weaved class class copy resource package prefix tester unweaved class class new file classes tester unweaved class class after class public static void tear down class throws exception file utils delete directory new file webapp doc base private tomcat tomcat private context context private webapp class loader loader before override public void set up throws exception super set up tomcat get tomcat instance context tomcat add context weaving webapp doc base tomcat start class loader loader context get loader get class loader assert null class loader should null loader assert same class loader correct webapp class loader class loader get class loader webapp class loader loader after override public void tear down throws exception try loader null context stop tomcat get host remove child context context null finally super tear down test public void test weaving throws exception string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello unweaved world result test public void test adding null transformer throws exception throws exception try loader add transformer null fail expected exception illegal argument exception got exception catch illegal argument exception ignore good class loading should still work weaving string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello unweaved world result test public void test added transformer instruments class1 throws exception loader add transformer new replacement transformer weaved replacement string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test added transformer instruments class2 throws exception loader add transformer new replacement transformer weaved replacement string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test transformers execute order added1 throws exception loader add transformer new replacement transformer weaved replacement loader add transformer new replacement transformer weaved replacement string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test transformers execute order added2 throws exception loader add transformer new replacement transformer weaved replacement loader add transformer new replacement transformer weaved replacement string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test removed transformer longer instruments1 throws exception replacement transformer removed new replacement transformer weaved replacement loader add transformer removed loader remove transformer removed string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello unweaved world result test public void test removed transformer longer instruments2 throws exception loader add transformer new replacement transformer weaved replacement replacement transformer removed new replacement transformer weaved replacement loader add transformer removed loader remove transformer removed string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test removed transformer longer instruments3 throws exception loader add transformer new replacement transformer weaved replacement replacement transformer removed new replacement transformer weaved replacement loader add transformer removed loader remove transformer removed string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result test public void test copied class loader excludes resources transformers throws exception loader add transformer new replacement transformer weaved replacement loader add transformer new replacement transformer weaved replacement string result invoke do method class loader tester never weaved class assert equals first result correct never weaved result result invoke do method class loader tester unweaved class assert equals second result correct hello weaver result webapp class loader copied loader loader copy without transformers result invoke do method class copied loader tester never weaved class assert equals third result correct never weaved result result invoke do method class copied loader tester unweaved class assert equals fourth result correct hello unweaved world result assert equals get anti jarlocking did match boolean value loader get anti jarlocking boolean value copied loader get anti jarlocking assert equals get clear references http client keep alive thread did match boolean value loader get clear references http client keep alive thread boolean value copied loader get clear references http client keep alive thread assert equals get clear references log factory release did match boolean value loader get clear references log factory release boolean value copied loader get clear references log factory release assert equals get clear references static did match boolean value loader get clear references static boolean value copied loader get clear references static assert equals get clear references stop threads did match boolean value loader get clear references stop threads boolean value copied loader get clear references stop threads assert equals get clear references stop timer threads did match boolean value loader get clear references stop timer threads boolean value copied loader get clear references stop timer threads assert equals get context name did match loader get context name copied loader get context name assert equals get delegate did match boolean value loader get delegate boolean value copied loader get delegate assert equals get jar path did match loader get jar path copied loader get jar path assert equals get urls did match loader get urls length copied loader get urls length assert same get parent did match loader get parent copied loader get parent private static void copy resource string name file file throws exception input stream test webapp class loader weaving class get class loader get resource stream name null throw new ioexception resource name found classpath file output stream os new file output stream file try int read read os write finally close os close private static string invoke do method class webapp class loader loader string class name throws exception class loader find class org apache catalina loader class name assert null loaded class should null method get method do method object new instance return string invoke private static class replacement transformer implements class file transformer private static final string class weave package prefix tester unweaved class private final byte replacement replacement transformer byte replacement replacement replacement override public byte transform class loader loader string class name class protection domain byte class weave equals class name return replacement return null compiled version org apache catalina loader tester unweaved class except do method method returns hello weaver compiled oracle java 51 private static final byte weaved replacement new byte 54 70 66 50 17 10 13 14 15 16 60 105 110 105 116 62 40 41 86 67 111 100 101 15 76 105 110 101 78 117 109 98 101 114 84 97 98 108 101 100 111 77 101 116 104 111 100 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 10 83 111 117 114 99 101 70 105 108 101 24 84 101 115 116 101 114 85 110 119 101 97 118 101 100 67 108 97 115 115 46 106 97 118 97 12 17 72 101 108 108 111 44 32 87 101 97 118 101 114 32 35 49 33 46 111 114 103 47 97 112 97 99 104 101 47 99 97 116 97 108 105 110 97 47 108 111 97 100 101 114 47 84 101 115 116 101 114 85 110 119 101 97 118 101 100 67 108 97 115 115 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 33 29 42 73 79 19 10 27 18 80 22 11 12 compiled version org apache catalina loader tester unweaved class except do method method returns hello weaver compiled oracle java 51 private static final byte weaved replacement new byte 54 70 66 50 17 10 13 14 15 16 60 105 110 105 116 62 40 41 86 67 111 100 101 15 76 105 110 101 78 117 109 98 101 114 84 97 98 108 101 100 111 77 101 116 104 111 100 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 10 83 111 117 114 99 101 70 105 108 101 24 84 101 115 116 101 114 85 110 119 101 97 118 101 100 67 108 97 115 115 46 106 97 118 97 12 17 72 101 108 108 111 44 32 87 101 97 118 101 114 32 35 50 33 46 111 114 103 47 97 112 97 99 104 101 47 99 97 116 97 108 105 110 97 47 108 111 97 100 101 114 47 84 101 115 116 101 114 85 110 119 101 97 118 101 100 67 108 97 115 115 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 33 29 42 73 79 19 10 27 18 80 22 11 12 weaved replacement weaved replacement field contents generated using following code regenerate them alter tester unweaved class code desired recompile run main method public static void main string arguments throws exception input stream input test webapp class loader weaving class get class loader get resource stream org apache catalina loader tester unweaved class class string builder builder new string builder builder append system out println private static final byte weaved replacement new byte try int input read input read string value byte builder length value length 97 builder append system out println builder string builder new string builder builder append append value else builder append builder append value system out println builder string finally input close system out println	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public string do method return never weaved	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public string do method return hello unweaved world add bug 55317 bug facilitate weaving allowing class file transformer added webpp class loader patch nick williams markt add
private final map string array list string param hash values new linked hash map
jsp servlet wrapper wrapper rctxt get wrapper wrapper uri
log debug sm get string spnego ticket validate fail log error sm get string spnego service login fail
serve resource request response true file encoding	serve resource request response false file encoding	param request servlet request we processing param content should content included param encoding encoding use necessary access source characters rather than bytes boolean content string encoding	copy resource render result writer encoding	param encoding encoding use when reading source input stream protected void copy web resource resource input stream print writer writer string encoding throws ioexception	encoding null reader new input stream reader resource input stream encoding update bug 46727 bug refactor default servlet make easier sub class implement finer grained control file encoding based patch fred toth markt update
connection list list connection list session get attribute comet requests attribute request requests null list null requests list get new connection list requests	session set attribute comet requests attribute new connection list new requests	connection list list connection list session get attribute comet requests attribute list null reqs list get	new connection list new connection infos	connection list list connection list se get session get attribute comet requests attribute request reqs null list null reqs list get	private static class connection list implements serializable private static final long serial version uid 1l private transient request connection list null private connection list request connection list connection list connection list public request get return connection list bug 52558 bug refactor code comet connection manager valve code so does prevent session from being serialized when running cluster markt fix fix
string return type expected type get canonical name string target type return type return type boolean class get name return type byte class get name return type character class get name return type short class get name return type integer class get name return type long class get name return type float class get name return type double class get name	return type attribute name validation query timeout required false int timeout seconds before connection validation queries fail works calling code java sql statement set query timeout seconds code statement executes code validation query code pool itself doesn timeout query still up jdbc driver enforce query timeouts value less than equal zero disable feature default value code code attribute
throw new sqlexception validation query failed enable log validation errors more details	protected static final string prop timeout validation query timeout	prop timeout	value properties get property prop timeout value null pool properties set validation query timeout integer parse int value	inherit doc override public void set validation query timeout int validation query timeout pool properties set validation query timeout validation query timeout	override public int get validation query timeout return get pool properties get validation query timeout inherit doc	timeout seconds before connection validation queries fail value less than equal zero disable feature defaults return timeout value seconds public int get validation query timeout timeout seconds before connection validation queries fail value less than equal zero disable feature defaults public void set validation query timeout int validation query timeout	private volatile int validation query timeout	override public int get validation query timeout return validation query timeout inherit doc override public void set validation query timeout int validation query timeout validation query timeout validation query timeout inherit doc	int validation query timeout pool properties get validation query timeout validation query timeout stmt set query timeout validation query timeout	override public int get validation query timeout return get pool properties get validation query timeout	override public void set validation query timeout int validation query timeout get pool properties set validation query timeout validation query timeout attribute name validation query timeout description timeout seconds before connection validation queries fail type java lang integer writeable false private static int timeout 10 private static boolean timeout set private static final string long query select from test test test test test before public void set up throws sqlexception driver manager register driver new mock driver use our mock driver datasource set driver class name mock driver class get name datasource set url mock driver url required trigger validation query execution datasource set initial size datasource set test borrow true datasource set validation interval datasource set validation query select datasource set validation query timeout timeout timeout 10 timeout set false after public void tear down throws sqlexception driver manager deregister driver new mock driver test public void test validation query timeout enabled throws exception because test borrow true triggers validation query datasource get connection assert assert true timeout set test public void test validation query timeout disabled throws exception datasource set validation query timeout because test borrow true triggers validation query datasource get connection assert assert false timeout set test public void test validation query timeout query timeout interceptor throws exception int interceptor timeout 30 datasource set jdbc interceptors query timeout interceptor class get name query timeout interceptor timeout because test borrow true triggers validation query connection con datasource get connection assert assert true timeout set increase expected timeout 30 which what we set interceptor timeout 30 now create statement make sure query timeout set interceptor statement st con create statement assert assert equals interceptor timeout st get query timeout st close st con prepare statement assert assert equals interceptor timeout st get query timeout st close st con prepare call assert assert equals interceptor timeout st get query timeout st close con close pull another connection check timeout 10 timeout set false datasource get connection assert assert true timeout set test depends execution time validation query specifically needs run longer than second pass fails test expected sqlexception class public void test validation query timeout connection throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test connect true datasource set validation interval datasource set validation query long query datasource set validation query timeout datasource get connection test expected sqlexception class public void test validation invalid connection throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test borrow true datasource set initial size datasource set test connect true datasource set validation interval datasource set validation query select datasource set validation query timeout datasource get connection test public void test long validation query time throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false connection con datasource get connection statement stmt null long start end try stmt con create statement set query timeout sec keeps test from slowing things down too much stmt set query timeout assert our long query takes longer than one second run requirement other tests run properly start system current time millis stmt execute long query catch sqlexception ex finally end system current time millis stmt null stmt close con null con close assert assert true start end assert assert true end start 1000 test public void test validation query timeout borrow throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test borrow true datasource set validation interval datasource set validation query long query datasource set validation query timeout assert even though validation query times out we still get connection connection con datasource get connection assert assert null con statement st con create statement result set rs st execute query select rs close st close con close mock driver connection statement use verify set query timeout called public static class mock driver implements java sql driver public static final string url jdbc tomcat mock public mock driver override public boolean accepts url string url throws sqlexception return url null url equals mock driver url override public connection connect string url properties info throws sqlexception return new mock connection info override public int get major version return override public int get minor version return override public driver property info get property info string url properties info throws sqlexception return null override public boolean jdbc compliant return false override public logger get parent logger throws sqlfeature supported exception return null public static class mock connection extends org apache tomcat jdbc test driver connection public mock connection properties info super info override public statement create statement throws sqlexception return new mock statement public static class mock statement extends org apache tomcat jdbc test driver statement override public void set query timeout int seconds throws sqlexception super set query timeout seconds assert assert equals timeout seconds timeout set true
expiring return true	check see session has already been invalidated do check expiring point expire should return until valid false valid synchronized check again now we inside sync so code only runs once double check locking valid needs volatile valid return manager null return mark session being expired flag unset call super expire notify expiring true string expired id get id internal notify cluster expired id null manager instanceof delta manager delta manager dmanager delta manager manager catalina cluster cluster dmanager get cluster cluster message msg dmanager request completed expired id true msg null cluster send msg super expire notify notify cluster log debug enabled log debug sm get string delta session notifying cluster manager manager get name boolean value primary session expired id manager instanceof delta manager delta manager manager session expired expired id	expiring return true	return valid	check see session has already been invalidated do check expiring point expire should return until valid false valid double check locking valid needs volatile valid	set valid false	return valid
jks equals keystore type attribute name ignore exception pre load required false boolean flag whether ignore error connection creation while initializing pool set true you want ignore error connection creation while initializing pool set false you want fail pool throwing exception default value code false code attribute
log error unable create initial connections pool pool properties ignore exception pre load jmx pool null jmx pool notify org apache tomcat jdbc pool jmx connection pool notify init get stack trace close true throw	protected static final string prop ignore exception pre load	prop prop	value properties get property prop value null pool properties set ignore exception pre load boolean parse boolean value	inherit doc override public boolean ignore exception pre load return get pool properties ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load get pool properties set ignore exception pre load ignore exception pre load	set true you want ignore error connection creation while initializing pool set false you want fail pool throwing exception param ignore exception pre load set true you want ignore error connection creation while initializing pool public void set ignore exception pre load boolean ignore exception pre load see pool set ignore exception pre load boolean public boolean ignore exception pre load	private volatile boolean ignore exception pre load false	inherit doc override public boolean ignore exception pre load return ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load ignore exception pre load ignore exception pre load	public boolean ignore exception pre load return get pool properties ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load get pool properties set ignore exception pre load ignore exception pre load inherit doc override
-1
else action code action code async settimeout param null return long timeout long param long value socket wrapper set timeout timeout	reset timeouts	methods called async dispatch provides mechanism those connector currently only nio need reset timeouts from async timeouts standard http timeouts once async processing completes protected abstract void reset timeouts methods called prepare response protected abstract void output byte src int offset int length throws ioexception	protected void reset timeouts op ajp apr native connector only uses timeout value time socket wrapper async timeouts override	protected void reset timeouts nio connector uses timeout configured wrapper poller therefore needs reset once asycn processing has finished final nio endpoint key attachment attach nio endpoint key attachment socket wrapper get socket get attachment false error attach null async state machine async dispatching long so timeout endpoint get so timeout reset timeout keep alive timeout attach set timeout keep alive timeout else attach set timeout so timeout override	protected void reset timeouts op ajp bio connector only uses timeout value socket wrapper async timeouts override
container log info sm get string jndi realm exception retry	container log info sm get string jndi realm exception retry	container log info sm get string jndi realm exception retry	container log info sm get string jndi realm exception retry	container log info sm get string jndi realm exception retry	container log info sm get string jndi realm exception retry
should any response body swallowed sent client private boolean swallow response false	swallow response false	responses certain status codes permitted include response body int status code response get status status code 200 status code 204 status code 205 status code 304 entity body swallow response true responses head requests permitted incude response body message bytes method mb request method method mb equals head entity body swallow response true response message append int status code	swallow response int len chunk get length hardcoded byte marshaling overhead adjust allowed size packet size default constants max packet size int chunk size constants max send size packet size constants max packet size int off while len int time len time chunk size time chunk size len time response message reset response message append byte constants jk ajp13 send body chunk response message append bytes chunk get bytes chunk get offset off time response message end output response message get buffer response message get len off time bytes written chunk get length	bug 55453 test public void test304with body throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug55453 new body servlet ctx add servlet mapping bug55453 tomcat start simple ajp client ajp client new simple ajp client ajp client set port get port ajp client connect validate cpong ajp client cping tester ajp message forward message ajp client create forward message forward message end tester ajp message response headers ajp client send message forward message null expect messages headers end validate response headers response headers 304 validate response end ajp client read message true double check connection still open validate cpong ajp client cping ajp client disconnect	private static class body servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status 304 resp get writer print body permitted 304 response
web application any web inf web xml meta inf context xml packaged application processed normally normal web fragment	ctx set config file get webapp config file path url	logger get logger get logger name host ctx set level level warning private string get logger name host host string ctx string logger name org apache catalina core container base default logger name get host get name logger name host get name logger name logger name ctx logger name return logger name	protected url get webapp config file string path string url file doc base new file path doc base directory return get webapp config file from directory doc base url else return get webapp config file from jar doc base url private url get webapp config file from directory file doc base string url url result null file web app context xml new file doc base constants application context xml web app context xml exists try result web app context xml uri url catch malformed urlexception logger get logger get logger name get host url log level warning unable determine web application context xml doc base return result private url get webapp config file from jar file doc base string url url result null jar file jar null try jar new jar file doc base jar entry entry jar get jar entry constants application context xml entry null result new url jar doc base uri string constants application context xml catch ioexception logger get logger get logger name get host url log level warning unable determine web application context xml doc base finally jar null try jar close catch ioexception ignore return result	test public void test get webapp config file from directory tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment dir context test public void test get webapp config file from directory negative tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment dir context test public void test get webapp config file from jar tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment context war test public void test get webapp config file from jar negative tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment context war test public void test bug51526 throws exception tomcat tomcat get tomcat instance file app file new file test deployment context war standard context context standard context tomcat add webapp null test app file get absolute path tomcat start assert equals war context context get session cookie name
td tr
string value value read token quoted string input true attribute null	test public void test bug55454 throws ioexception string input text html charset utf string reader sr new string reader input media type http parser parse media type sr assert equals text get type assert equals html get subtype assert true get parameter count assert equals utf get parameter value charset assert equals utf get charset assert equals text html charset utf string
call constructor static method obj ctx get import handler resolve class local name obj null return ctx get elresolver invoke ctx new elclass class obj init null ast method parameters children get parameters ctx obj ctx get import handler resolve static local name obj null return ctx get elresolver invoke ctx new elclass class obj local name null ast method parameters children get parameters ctx	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test import01 elprocessor processor new elprocessor object result processor get value integer 1000 integer class assert assert equals integer value 1000 result test public void test import02 elprocessor processor new elprocessor processor get elmanager get elcontext get import handler import static java lang integer value object result processor get value value 1000 integer class assert assert equals integer value 1000 result
coyote request finished ready return coyote request finished	return coyote request finished	public boolean finished atomic boolean result new atomic boolean false action action code request body fully read result return result get input buffer	servlet wlistener error invoked servlet rlistener error invoked	test public void test bug55438non blocking read write empty read throws exception tomcat tomcat get tomcat instance must have real doc base just use temp standard context ctx standard context tomcat add context system get property java io tmpdir nbread write servlet servlet new nbread write servlet string servlet name nbread write servlet class get name tomcat add servlet ctx servlet name servlet ctx add servlet mapping servlet name tomcat start map string list string res headers new hash map int rc post url false new bytes streamer override public byte next return new byte override public int get length return override public int available return http localhost get port new byte chunk res headers null assert assert equals http servlet response sc ok rc	web servlet async supported true public class nbread write servlet extends tester servlet private static final long serial version uid 1l public volatile test read write listener rwlistener override protected void service http servlet request req http servlet response resp throws servlet exception ioexception step start async async context actx req start async actx set timeout long max value step notify read servlet input stream req get input stream rwlistener new test read write listener actx set read listener rwlistener public volatile boolean error invoked false	error invoked true	private class test read write listener implements read listener async context ctx private final string builder body new string builder public test read write listener async context ctx ctx ctx override public void data available throws ioexception servlet input stream ctx get request get input stream string byte new byte 8192 int read do read read read break new string read while ready log info read body append override public void all data read throws ioexception log info all data read servlet output stream output ctx get response get output stream output set write listener new write listener override public void write possible throws ioexception servlet output stream output ctx get response get output stream output ready log info writing body string output write body string get bytes utf ctx complete override public void error throwable throwable log info read write listener error throwable print stack trace override public void error throwable throwable log info read listener error throwable print stack trace
private final list segment segments new array list	set string param names new hash set	param names add segment throw new illegal argument exception sm get string uri template duplicate parameter segment	segments add new segment index segment	candidate get segments iterator iterator segment target segments segments iterator	private list segment get segments method name test duplicate01 bug pattern dls dead local store		public void test duplicate01 throws exception test public void test duplicate02 throws exception uri template new uri template map string string result match new uri template assert assert equals result size assert assert equals result get assert assert equals result get
hashtable preserved environment null preserve current context environment parameters preserved environment context get environment	restore environment parameter context context security preserved environment restore environment parameter context javax security sasl server preserved environment restore environment parameter context javax security sasl qop preserved environment	private void restore environment parameter dir context context string parameter name hashtable preserved environment try context remove from environment parameter name preserved environment null preserved environment contains key parameter name context add environment parameter name preserved environment get parameter name catch naming exception ignore
class loader old thread context cl thread current thread get context class loader	class loader null thread current thread set context class loader class loader else standard session session standard session manager create empty session session read object data ois session set manager manager return session	ois null close input stream try ois close catch ioexception ignore thread current thread set context class loader old thread context cl	class loader old thread context cl thread current thread get context class loader	thread current thread set context class loader class loader	thread current thread set context class loader old thread context cl
filter registration dynamic fr servlet context add filter fr set async supported true
log warn sm get string context config role auth roles	log warn sm get string context config role runas run log warn sm get string context config role link link
set formatter new one line formatter set formatter new one line formatter update bug 52092 bug juli now uses code one line formatter code code async file handler code default markt update
web resources api expects all paths start special case consistency earlier tomcat versions equals path path
db connection commit
log debug enabled log debug sm get string ws session send close fail ioe
process scan type callback url true	class path entry cpe new class path entry urls jars scanned unless filter says directories scanned pluggability scans scan all directories enabled unless filter says cpe jar scan type jar scan type pluggability scan all directories jar scan filter check scan type cpe get name log debug sm get string jar scan classloader jar scan urls process scan type callback urls webapp jar scan classloader fail urls ioe jar directory has been skipped log trace sm get string jar scan classloader jar scan urls	private void process jar scan type scan type jar scanner callback callback url url boolean webapp throws ioexception	else directory scan type jar scan type pluggability else file metainf new file get absolute file file separator meta inf metainf directory callback scan webapp	private static class class path entry private final boolean jar private final string name public class path entry url url string path url get path int end path index constants jar ext end jar true int start path last index end name path substring start end else jar false path ends path path substring path length int start path last index name path substring start public boolean jar return jar public string get name return name comma separated list jar file directory name patterns skip when scanning tlds specified default obtained from code tomcat util scan standard jar scan filter jars skip code system property comma separated list jar file directory name patterns scan when scanning tlds specified default obtained from code tomcat util scan standard jar scan filter jars scan code system property comma separated list jar file directory name patterns skip when scanning pluggable features specified default obtained from comma separated list jar file directory name patterns scan when scanning pluggable features specified default obtained from used scan web application jar files directories class files typically used during web application start identify files tlds web fragment xml files must processed part web application expanded jar files default code false code tomcat directory assumed expanded jar file note scans matches code handles types code annotations all directories scanned irrespective presence meta inf sub directory
page visit new node visitor page info	private void invoke plugin node custom tag page info page info	private static class node visitor extends node visitor private tag plugin manager manager private page info page info public node visitor tag plugin manager manager page info page info manager manager page info page info override public void visit node custom tag throws jasper exception manager invoke plugin page info visit body
process servlet container initializers context get servlet context	protected void process servlet container initializers servlet context servlet context collection servlet container initializer detected scis try webapp service loader servlet container initializer loader new webapp service loader servlet context detected scis loader load servlet container initializer class catch ioexception log error sm get string context config servlet container initializer fail context get name ok false return servlet container initializer sci detected scis initializer class map put sci new hash set class handles types ht ht sci get class get annotation handles types class catch exception log debug enabled log info sm get string context config sci debug sci get class get name else log info sm get string context config sci info sci get class get name continue ht null class types ht value types null continue class type types type annotation handles types annotations true else handles types non annotations true set servlet container initializer scis type initializer map get type scis null scis new hash set type initializer map put type scis scis add sci	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license variation java jar service loader respects exclusion rules web applications primarily intended use loading servlet container initializers defined servlet does attempt lazy loading container required introspect all discovered servlet context defines ordered libs only jars web inf lib named set included search provider files ordered libs defined all jars searched provider files providers defined resources parent class loader always returned provider classes loaded using context class loader see javax servlet servlet container initializer see java util service loader private static final string lib web inf lib private static final string services meta inf services private static final charset utf8 charset name utf private final servlet context context construct loader load services from servlet context param context context use public webapp service loader servlet context context context context load providers service type param service type type service load return unmodifiable collection service providers throws ioexception problem loading any service public collection load class service type throws ioexception string config file services service type get name set string services found new hash set class loader loader context get class loader servlet context has ordered libs use specify set jars from web inf lib should used loading services suppress warnings unchecked list string ordered libs list string context get attribute servlet context ordered libs ordered libs null handle ordered libs directly string lib ordered libs url jar url context get resource lib lib jar url null should happen just ignore continue string base jar url external form url url base ends url new url base config file else url new url jar base config file try parse config file services found url catch file found exception provider file found ok parent class loader all others loader loader get parent enumeration url resources loader null resources class loader get system resources config file else resources loader get resources config file while resources has more elements parse config file services found resources next element load discovered services services found empty return collections empty list return load services service type services found private void parse config file set string services found url url throws ioexception try input stream url open stream buffered reader reader new buffered reader new input stream reader utf8 string line while line reader read line null int line index line line substring line line trim line length continue services found contains line continue services found add line private collection load services class service type set string services found throws ioexception class loader loader context get class loader list services new array list services found size string service class services found try class clazz class name service class true loader services add service type cast clazz new instance catch class found exception exception illegal access exception class cast exception throw new ioexception return collections unmodifiable collection services	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test webapp throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments empty absolute ordering standard context ctxt standard context tomcat add context null test app dir get absolute path ctxt add lifecycle listener new context config tomcat start webapp service loader servlet container initializer loader new webapp service loader ctxt get servlet context collection servlet container initializer initializers loader load servlet container initializer class
long write timeout att get write timeout	long write timeout att get write timeout	long write timeout att get write timeout	long write timeout att get write timeout	set write timeout so timeout	public void set write timeout long write timeout write timeout write timeout public long get write timeout return write timeout private long write timeout
ws sessions null
private final collection string include codas new array list public collection string get include codas return include codas private final collection string include preludes new array list public collection string get include preludes return include preludes	test public void test bug55262 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res get url http localhost get port test bug5nnnn bug55262 jsp string result res string pattern prelude pattern compile prelude pattern multiline pattern dotall pattern coda pattern compile coda pattern multiline pattern dotall assert true prelude matcher result matches assert true coda matcher result matches	assert assert equals property groups size iterator jsp property group descriptor group iterator property groups iterator jsp property group descriptor group descriptor group descriptor group iterator next	group descriptor group iterator next assert assert equals group descriptor get include preludes size assert assert equals group descriptor get include codas size	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private jsp property group group new jsp property group test public void test bug55262 group add include prelude prelude group add include prelude prelude group add include coda coda group add include coda coda assert assert equals group get include preludes size assert assert equals group get include codas size jsp property group url pattern bug5nnnn bug55262 jsp url pattern include prelude bug5nnnn bug55262 prelude jspf include prelude include prelude bug5nnnn bug55262 prelude jspf include prelude include coda bug5nnnn bug55262 coda jspf include coda include coda bug5nnnn bug55262 coda jspf include coda default content type text plain default content type jsp property group licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
vector string include preludes new vector include preludes add all jsp property group get include preludes vector string include codas new vector include codas add all jsp property group get include codas jsp property property new jsp property jsp property group get xml jsp property group get el ignored jsp property group get scripting invalid jsp property group get page encoding include preludes include codas jsp property group get deferred syntax allowed literal jsp property group get trim directive whitespaces jsp property group get default content type jsp property group get buffer jsp property group get error undeclared namespace	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private jsp jspc private file output dir before public void init jspc new jsp output dir new file output jspc test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out private void verify file webapp out now just check some expected files exist assert assert true new file webapp out generated web xml exists assert assert true new file webapp out org apache jsp el 002das 002dliteral jsp java exists assert assert true new file webapp out org apache jsp tld 002dversions jsp java exists private void precompile file app dir file webapp out throws ioexception remove webapp out webapp out mkdirs jspc set uriroot app dir string jspc set output dir webapp out string jspc set validate xml false jspc set web xml new file webapp out generated web xml string jspc execute private void remove file base throws ioexception base exists return files walk file tree base path new simple file visitor path override public file visit result visit file path file basic file attributes attrs throws ioexception files delete file return file visit result continue override public file visit result post visit directory path dir ioexception exc throws ioexception files delete dir return file visit result continue add create test cases jsp patch jeremy boynes markt add
-1
tld locations cache tld locations cache get instance context
use class classloader ant have set tccl its own web xml parser set class loader get class get class loader	sets class loader used creating descriptor objects param class loader class loader used creating descriptor objects public void set class loader class loader class loader web digester set class loader class loader web fragment digester set class loader class loader
protected abstract log get log	else status socket status stop try upgrade servlet input stream close catch ioexception ioe get log debug sm get string abstract processor close fail ioe try upgrade servlet output stream close catch ioexception ioe get log debug sm get string abstract processor os close fail ioe return socket state closed	private static final log log log factory get log apr processor class override protected log get log return log	private static final log log log factory get log bio processor class override protected log get log return log	private static final log log log factory get log nio processor class override protected log get log return log	stop point trying handshake poller has been stopped socket handshake complete status socket status stop
handler null clear handler new socket timeout exception	sh null null sh result new send result else sh result new send result
add date header unless application has already set one caching filter headers get value date null headers set value date set string fast http date format get current date
current instanceof node jsp text
ctxt get effective major version ctxt get effective major version ctxt get effective minor version ctxt get effective minor version
return xml identifiers web 22 public equals public id	version null return switch version case major version minor version break case major version minor version break case major version break case major version minor version break default log warn sm get string web xml version unknown version return switch public id case xml identifiers web 22 public major version minor version public id public id break case xml identifiers web 23 public major version minor version public id public id break default log warn sm get string web xml unrecognised public id public id break	reader set property http xml org sax properties lexical handler	public input source resolve entity string name string public id string base uri string system id throws saxexception ioexception sax log debug resolve entity public id system id base uri	log debug trying resolve using system id system id resolve system id against base uri absolute base uri null try uri uri new uri system id uri absolute entity url new uri base uri resolve uri string catch urisyntax exception log debug enabled log debug invalid uri base uri system id	lexical handler methods override public void start dtd string name string public id string system id throws saxexception set public id public id error handler methods	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version assert assert equals xml identifiers web 22 public desc get public id test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version assert assert equals xml identifiers web 23 public desc get public id test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version	unknown input should ignored assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get minor version	webxml set public id xml identifiers web 22 public	webxml set public id xml identifiers web 23 public public void test parse version24 webxml set version public void test parse version25 webxml set version public void test parse version30 webxml set version public void test parse version31 webxml set version licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license resolver locally cached xml resources private final class base private final map string string public ids private final map string string system ids constructor providing mappings public system identifiers local resources each map contains mapping from well known identifier resource path further resolved using base class using class get resource string param base class use locate local copies param public ids mapping public identifiers local resources param system ids mapping system identifiers local resources public local resolver class base map string string public ids map string string system ids base base public ids public ids system ids system ids override public input source resolve entity string public id string system id throws saxexception ioexception return resolve entity null public id null system id override public input source resolve entity string name string public id string base uri string system id throws saxexception ioexception string resolved resolve public id system id base uri resolved null return null url url base get resource resolved url null resolved url external form input source new input source resolved set public id public id return override public input source get external subset string name string base uri throws saxexception ioexception return null private string resolve string public id string system id string base uri try resolving using public id string resolved public ids get public id resolved null return resolved try resolving using system id system id null return null system id resolve base uri system id resolved system ids get system id resolved null return resolved fall back supplied system id return system id private static string resolve string base uri string system id try base uri null return system id uri system uri new uri system id system uri absolute return system id return new uri base uri resolve system uri string catch urisyntax exception return system id licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license defines constants well known public system identifiers documented servlet jsp from w3c public static final string xml 2001 xsd http www w3 org 2001 xml xsd public static final string datatypes public datatypes public static final string xsd 10 public w3c dtd xmlschema 200102 en from j2ee public static final string web 22 public sun microsystems inc dtd web application en public static final string web 22 system http java sun com dtd web app dtd public static final string tld 11 public sun microsystems inc dtd jsp tag library en public static final string tld 11 system http java sun com dtd web dtd from j2ee public static final string web 23 public sun microsystems inc dtd web application en public static final string web 23 system http java sun com dtd web app dtd public static final string tld 12 public sun microsystems inc dtd jsp tag library en public static final string tld 12 system http java sun com dtd web dtd from j2ee public static final string web 24 xsd http java sun com xml ns j2ee web app xsd public static final string tld 20 xsd http java sun com xml ns j2ee web xsd public static final string webservices 11 xsd http www ibm com webservices xsd j2ee web services xsd from java ee public static final string web 25 xsd http java sun com xml ns javaee web app xsd public static final string tld 21 xsd http java sun com xml ns javaee web xsd public static final string webservices 12 xsd http java sun com xml ns javaee javaee web services xsd from java ee public static final string web 30 xsd http java sun com xml ns javaee web app xsd public static final string web fragment 30 xsd http java sun com xml ns javaee web fragment xsd public static final string webservices 13 xsd http java sun com xml ns javaee javaee web services xsd from java ee public static final string web 31 xsd http xmlns jcp org xml ns javaee web app xsd public static final string web fragment 31 xsd http xmlns jcp org xml ns javaee web fragment xsd public static final string webservices 14 xsd http xmlns jcp org xml ns javaee javaee web services xsd private xml identifiers licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private final map string string public ids new hash map private final map string string system ids new hash map private local resolver resolver new local resolver servlet context class public ids system ids private string web 22 local private string web 31 local private string webcommon 31 local before public void init public ids put xml identifiers web 22 public javax servlet resources web app dtd system ids put xml identifiers web 31 xsd javax servlet resources web app xsd web 22 local get class get resource javax servlet resources web app dtd external form web 31 local get class get resource javax servlet resources web app xsd external form webcommon 31 local get class get resource javax servlet resources web common xsd external form test public void unknown null id null throws ioexception saxexception assert assert null resolver resolve entity null null test public void unknown public id null throws ioexception saxexception assert assert null resolver resolve entity unknown null test public void unknown system id returned throws ioexception saxexception input source source resolver resolve entity null unknown assert assert equals null source get public id assert assert equals unknown source get system id test public void unknown system id resolved against base uri throws ioexception saxexception input source source resolver resolve entity null null http example com home html unknown assert assert equals null source get public id assert assert equals http example com unknown source get system id test public void public id resolved throws ioexception saxexception input source source resolver resolve entity xml identifiers web 22 public xml identifiers web 22 system assert assert equals xml identifiers web 22 public source get public id assert assert equals web 22 local source get system id test public void system id ignored when public id resolved throws ioexception saxexception input source source resolver resolve entity xml identifiers web 22 public unknown assert assert equals xml identifiers web 22 public source get public id assert assert equals web 22 local source get system id test public void system id resolved throws ioexception saxexception input source source resolver resolve entity null xml identifiers web 31 xsd assert assert equals null source get public id assert assert equals web 31 local source get system id test public void relative system id resolved against base uri throws ioexception saxexception input source source resolver resolve entity null null web 31 local web common xsd assert assert equals null source get public id assert assert equals webcommon 31 local source get system id test public void absolute system id overrides base uri throws ioexception saxexception input source source resolver resolve entity null null http example com home html xml identifiers web 31 xsd assert assert equals null source get public id assert assert equals web 31 local source get system id manifest tomcat manifests jsp api jar manifest licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license target namespace http java sun com xml ns j2ee xmlns j2ee http java sun com xml ns j2ee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd jsp xsds 17 03 18 03 xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web app xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all j2ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location j2ee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type j2ee taglib type min occurs max occurs unbounded xsd element name jsp property group type j2ee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base j2ee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name url pattern type j2ee url pattern type max occurs unbounded xsd element name el ignored type j2ee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type j2ee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type j2ee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type j2ee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type j2ee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type j2ee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type j2ee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type j2ee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license actual sun xsd stripped down xsd can found http java sun com xml ns javaee jsp xsd xsd contains only functional elements programatic use target namespace http java sun com xml ns javaee xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd include schema location javaee xsd xsd complex type name jsp config type xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd element name page encoding type javaee string min occurs xsd element name scripting invalid type javaee true false type min occurs xsd element name xml type javaee true false type min occurs xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd element name include coda type javaee path type min occurs max occurs unbounded xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd element name trim directive whitespaces type javaee true false type min occurs xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd sequence xsd element name taglib uri type javaee string xsd element name taglib location type javaee path type xsd sequence xsd attribute name id type xsd id xsd complex type target namespace http java sun com xml ns javaee xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd id xsd xsd annotation xsd annotation xsd do alter remove copyright notices header copyright 2003 2009 sun microsystems inc all rights reserved contents file subject terms either gnu general public license version only gpl common development distribution license cddl collectively license you may use file except compliance license you can obtain copy license https glassfish dev java net public cddl gpl html glassfish bootstrap legal license txt see license specific language governing permissions limitations under license when distributing software include license header notice each file include license file glassfish bootstrap legal license txt sun designates particular file subject classpath exception provided sun gpl version section license file accompanied code applicable add following below license header fields enclosed brackets replaced your own identifying information portions copyrighted year name copyright owner contributor you wish your version file governed only cddl only gpl version indicate your decision adding contributor elects include software distribution under cddl gpl version license you don indicate single choice license recipient has option distribute your version file under either cddl gpl version extend choice license its licensees provided above however you add gpl version code therefore elected gpl version license option applies only new code made subject option copyright holder xsd xsd annotation xsd annotation xsd apache software foundation elects include software under cddl license xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web common xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all java ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location javaee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes control whether character sequence allowed when used string literal control whether template text containing only whitespaces must removed from response output indicate default content type information indicate default buffering model jsp writer control whether error should raised use undeclared namespaces jsp page xsd xsd annotation xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type javaee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type javaee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type javaee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type javaee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd annotation xsd character sequence reserved el expressions consequently translation error occurs character sequence used string literal unless element enabled true disabled false default xsd xsd annotation xsd element xsd element name trim directive whitespaces type javaee true false type min occurs xsd annotation xsd indicates template text containing only whitespaces must removed from response output has effect jsp documents xml syntax disabled false default xsd xsd annotation xsd element xsd element name default content type type javaee string min occurs xsd annotation xsd valid values default content type those content type page directive specifies default response content type page directive does include content type attribute xsd xsd annotation xsd element xsd element name buffer type javaee string min occurs xsd annotation xsd valid values buffer those buffer page directive specifies buffering should used output response so size buffer use xsd xsd annotation xsd element xsd element name error undeclared namespace type javaee true false type min occurs xsd annotation xsd default behavior when tag unknown namespace used jsp page regular syntax silently ignore set true error must raised during translation time when undeclared tag used jsp page disabled false default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type javaee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type javaee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type target namespace http xmlns jcp org xml ns javaee xmlns javaee http xmlns jcp org xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd do alter remove copyright notices header copyright 2009 2013 oracle its affiliates all rights reserved contents file subject terms either gnu general public license version only gpl common development distribution license cddl collectively license you may use file except compliance license you can obtain copy license https glassfish dev java net public cddl gpl html packager legal license txt see license specific language governing permissions limitations under license when distributing software include license header notice each file include license file packager legal license txt gpl classpath exception oracle designates particular file subject classpath exception provided oracle gpl version section license file accompanied code applicable add following below license header fields enclosed brackets replaced your own identifying information portions copyright year name copyright owner contributor you wish your version file governed only cddl only gpl version indicate your decision adding contributor elects include software distribution under cddl gpl version license you don indicate single choice license recipient has option distribute your version file under either cddl gpl version extend choice license its licensees provided above however you add gpl version code therefore elected gpl version license option applies only new code made subject option copyright holder xsd xsd annotation xsd annotation xsd apache software foundation elects include software under cddl license xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web common xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all java ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location javaee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes control whether character sequence allowed when used string literal control whether template text containing only whitespaces must removed from response output indicate default content type information indicate default buffering model jsp writer control whether error should raised use undeclared namespaces jsp page xsd xsd annotation xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type javaee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type javaee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type javaee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type javaee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd annotation xsd character sequence reserved el expressions consequently translation error occurs character sequence used string literal unless element enabled true disabled false default xsd xsd annotation xsd element xsd element name trim directive whitespaces type javaee true false type min occurs xsd annotation xsd indicates template text containing only whitespaces must removed from response output has effect jsp documents xml syntax disabled false default xsd xsd annotation xsd element xsd element name default content type type javaee string min occurs xsd annotation xsd valid values default content type those content type page directive specifies default response content type page directive does include content type attribute xsd xsd annotation xsd element xsd element name buffer type javaee string min occurs xsd annotation xsd valid values buffer those buffer page directive specifies buffering should used output response so size buffer use xsd xsd annotation xsd element xsd element name error undeclared namespace type javaee true false type min occurs xsd annotation xsd default behavior when tag unknown namespace used jsp page regular syntax silently ignore set true error must raised during translation time when undeclared tag used jsp page disabled false default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type javaee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type javaee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license dtd defining java server pages tag library descriptor tld xml file format syntax tag library jar file containing valid instance tag library descriptor taglib tld file meta inf subdirectory along appropriate implementing classes other resources required implement tags defined therein use subject license terms jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives should user discernable xmlns cdata fixed http java sun com j2ee dtds web dtd itself most likely different langage embedded sql statements scriptlet expression optional licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license dtd defining java server pages tag library descriptor tld xml file format syntax tag library jar file containing valid instance tag library descriptor taglib tld file meta inf subdirectory along appropriate implementing classes other resources required implement tags defined therein use subject license terms sun microsystems inc dtd jsp tag library en doctype taglib public sun microsystems inc dtd jsp tag library en http java sun com dtd web dtd jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives intended displayed tools should user discernable display name small icon large icon description validator listener tag xmlns cdata fixed http java sun com jsp tag library descriptor javax servlet jsp tagext tag javax servlet jsp tagext tag extra info tools use tag small icon large icon description variable attribute example itself most likely different langage embedded sql statements time value give name variable one name given name from attribute required java lang string default true default defined nested default declare scope description scriptlet expression optional scriptlet expression optional licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license target namespace http java sun com xml ns j2ee xmlns j2ee http java sun com xml ns j2ee xmlns xsd http www w3 org 2001 xmlschema xmlns xml http www w3 org xml 1998 namespace element form default qualified attribute form default unqualified version xsd annotation xsd xsd xsd annotation xsd annotation xsd cdata xml schema jsp taglibrary descriptor all taglibrary descriptors must indicate tag library schema using taglibrary namespace http java sun com xml ns j2ee indicating version schema using version element shown below taglib xmlns http java sun com xml ns j2ee xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location version taglib instance documents may indicate published version schema using xsi schema location attribute j2ee namespace following location http java sun com xml ns j2ee web xsd xsd xsd annotation xsd include schema location j2ee xsd xsd element name taglib type j2ee tld taglib type xsd annotation xsd taglib tag document root definition taglib provided tld taglib type xsd xsd annotation xsd unique name tag name uniqueness xsd annotation xsd taglib element contains among other things tag tag file elements name subelements elements must each unique xsd xsd annotation xsd selector xpath j2ee tag j2ee tag file xsd field xpath j2ee name xsd unique xsd unique name function name uniqueness xsd annotation xsd taglib element contains function elements name subelements elements must each unique xsd xsd annotation xsd selector xpath j2ee function xsd field xpath j2ee name xsd unique xsd element xsd complex type name body content type xsd annotation xsd specifies type body valid tag value used jsp container validate tag invocation has correct body syntax page composition tools assist page author providing valid tag body currently four values specified tagdependent body tag interpreted tag itself most likely different language embedded sql statements jsp body tag contains nested jsp syntax empty body must empty scriptless body accepts only template text el expressions jsp action elements scripting elements allowed xsd xsd annotation xsd simple content xsd restriction base j2ee string xsd enumeration value tagdependent xsd enumeration value jsp xsd enumeration value empty xsd enumeration value scriptless xsd restriction xsd simple content xsd complex type xsd complex type name extensible type abstract true xsd annotation xsd extensible type abstract base type used define type extension elements instance documents must substitute known type define extension using xsi type attribute define actual type extension elements xsd xsd annotation xsd attribute name id type xsd id xsd complex type xsd complex type name function type xsd annotation xsd function element used provide information each function tag library exposed el function element may have several subelements defining description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique name function function class provides name java class implements function function signature provides signature java language java method used implement function example optional informal description example use function function extension zero more extensions provide extra information about function tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd annotation xsd unique name function xsd xsd annotation xsd element xsd element name function class type j2ee fully qualified class type xsd annotation xsd provides fully qualified class name java class containing static method implements function xsd xsd annotation xsd element xsd element name function signature type j2ee string xsd annotation xsd provides signature static java method used implement function syntax function signature element follows function signature return type method name parameters return type type method name identifier parameters parameter parameter parameters parameter type where type basic type fully qualified java class name including package name per type production java language second edition chapter 18 identifier java identifier per identifier production java language second edition chapter 18 example java lang string nick name java lang string int xsd xsd annotation xsd element xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use function xsd xsd annotation xsd element xsd element name function extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd function extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag file type xsd annotation xsd defines action tag library implemented tag file tag file element has two required subelements description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique action name path where find tag file implementing action relative root web application root jar file tag library packaged jar must begin web inf tags tag file resides war meta inf tags tag file resides jar example optional informal description example use tag tag extension zero more extensions provide extra information about tag tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd element name path type j2ee path type xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use tag xsd xsd annotation xsd element xsd element name tag extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd tag extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag type xsd annotation xsd tag defines unique tag tag library has one attribute id tag element may have several subelements defining description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique action name tag class tag handler class implementing javax servlet jsp tagext jsp tag tei class optional subclass javax servlet jsp tagext tag extra info body content body content type variable optional scripting variable information attribute all attributes action evaluated prior invocation dynamic attributes whether tag supports additional attributes dynamic names true tag class must implement javax servlet jsp tagext dynamic attributes interface defaults false example optional informal description example use tag tag extension zero more extensions provide extra information about tag tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd element name tag class type j2ee fully qualified class type xsd annotation xsd defines subclass javax serlvet jsp tagext jsp tag implements request time semantics tag required xsd xsd annotation xsd element xsd element name tei class type j2ee fully qualified class type min occurs xsd annotation xsd defines subclass javax servlet jsp tagext tag extra info tag optional given class consulted translation time xsd xsd annotation xsd element xsd element name body content type j2ee body content type xsd annotation xsd specifies format body tag default jsp jsp because invalid setting simple tag handlers longer default jsp reasonable default simple tag handlers scriptless tag can have body xsd xsd annotation xsd element xsd element name variable type j2ee variable type min occurs max occurs unbounded xsd element name attribute type j2ee tld attribute type min occurs max occurs unbounded xsd element name dynamic attributes type j2ee generic boolean type min occurs xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use tag xsd xsd annotation xsd element xsd element name tag extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd tag extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld attribute type xsd annotation xsd attribute element defines attribute nesting tag attributre element may have several subelements defining description description attribute name name attribute required whether attribute required optional rtexprvalue whether attribute runtime attribute type type attributes fragment whether attribute fragment xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd element name name type j2ee java identifier type xsd element name required type j2ee generic boolean type min occurs xsd annotation xsd defines nesting attribute required optional present default false attribute optional xsd xsd annotation xsd element xsd choice xsd sequence xsd element name rtexprvalue type j2ee generic boolean type min occurs xsd annotation xsd defines nesting attribute can have scriptlet expressions value value attribute may dynamically calculated request time opposed static value determined translation time present default false attribute has static value xsd xsd annotation xsd element xsd element name type type j2ee fully qualified class type min occurs xsd annotation xsd defines java type attributes value static values those determined translation time type always java lang string xsd xsd annotation xsd element xsd sequence xsd element name fragment type j2ee generic boolean type min occurs xsd annotation xsd true attribute type javax jsp tagext jsp fragment representing dynamic content can re evaluated many times needed tag handler omitted false default still type java lang string xsd xsd annotation xsd element xsd choice xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld canonical name type xsd annotation xsd defines canonical name tag attribute being defined name must conform lexical rules nmtoken xsd xsd annotation xsd simple content xsd restriction base j2ee xsd nmtokentype xsd simple content xsd complex type xsd complex type name tld extension type xsd annotation xsd tld extension type used indicate extensions specific tld element used elements designate extension block targeted specific extension designated set extension elements declared namespace namespace identifies extension tool processes extension type extension element abstract therefore concrete type must specified tld using xsi type attribute each extension element xsd xsd annotation xsd sequence xsd element name extension element type j2ee extensible type max occurs unbounded xsd sequence xsd attribute name namespace use required type xsd any uri xsd attribute name id type xsd id xsd complex type xsd complex type name tld taglib type xsd annotation xsd taglib tag document root defines description simple string describing use taglib should user discernable display name display name element contains short name intended displayed tools icon optional icon can used tools tlib version version tag library short name simple default short name could used jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives uri uri uniquely identifying taglib validator optional tag library validator information listener optional event listener tag tags tag library tag file tag files tag library function zero more el functions defined tag library taglib extension zero more extensions provide extra information about taglib tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name tlib version type j2ee dewey version type xsd annotation xsd describes version number taglibrary described dewey decimal xsd xsd annotation xsd element xsd element name short name type j2ee tld canonical name type xsd annotation xsd defines simple default name could used jsp authoring tool create names example may used preferred prefix value taglib directives do use white space do start digits underscore xsd xsd annotation xsd element xsd element name uri type j2ee xsd any uritype min occurs xsd annotation xsd defines public uri uniquely identifies version taglibrary leave empty does apply xsd xsd annotation xsd element xsd element name validator type j2ee validator type min occurs xsd element xsd element name listener type j2ee listener type min occurs max occurs unbounded xsd element xsd element name tag type j2ee tag type min occurs max occurs unbounded xsd element name tag file type j2ee tag file type min occurs max occurs unbounded xsd element name function type j2ee function type min occurs max occurs unbounded xsd element name taglib extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd taglib extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name version type j2ee dewey version type fixed use required xsd annotation xsd describes jsp version number taglibrary requires order function dewey decimal xsd xsd annotation xsd attribute xsd attribute name id type xsd id xsd complex type xsd complex type name validator type xsd annotation xsd validator can used validate conformance jsp page using tag library defined validator type xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd element name validator class type j2ee fully qualified class type xsd annotation xsd defines tag library validator class can used validate conformance jsp page using tag library xsd xsd annotation xsd element xsd element name init param type j2ee param value type min occurs max occurs unbounded xsd annotation xsd init param element contains name value pair param xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name variable scope type xsd annotation xsd type defines scope scripting variable see tag extra info details allowed values nested begin end xsd xsd annotation xsd simple content xsd restriction base j2ee string xsd enumeration value nested xsd enumeration value begin xsd enumeration value end xsd restriction xsd simple content xsd complex type xsd complex type name variable type xsd annotation xsd variable type provides information scripting variables defined using tag translation time error tag has one more variable subelements have tag extra info class returns non null value from call get variable info subelements variable type form description optional description variable name given variable name constant name from attribute name attribute whose translation time value give name variable one name given name from attribute required variable class name class variable java lang string default declare whether variable declared true default scope scope scripting varaible defined nested default xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd choice xsd element name name given type j2ee java identifier type xsd annotation xsd name scripting variable xsd xsd annotation xsd element xsd element name name from attribute type j2ee java identifier type xsd annotation xsd name attribute whose translation time value give name variable xsd xsd annotation xsd element xsd choice xsd element name variable class type j2ee fully qualified class type min occurs xsd annotation xsd optional name class scripting variable default java lang string xsd xsd annotation xsd element xsd element name declare type j2ee generic boolean type min occurs xsd annotation xsd whether scripting variable defined see tag extra info details element optional true default xsd xsd annotation xsd element xsd element name scope type j2ee variable scope type min occurs xsd annotation xsd element optional nested default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xsd contains only programatic elements required xsd from sun includes other copyrighted information please refer http java sun com xml ns javaee web xsd fully documented latest xsd xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd include schema location javaee xsd xsd element name taglib type javaee tld taglib type xsd unique name tag name uniqueness xsd selector xpath javaee tag javaee tag file xsd field xpath javaee name xsd unique xsd unique name function name uniqueness xsd selector xpath javaee function xsd field xpath javaee name xsd unique xsd element xsd complex type name body content type xsd simple content xsd restriction base javaee string xsd enumeration value tagdependent xsd enumeration value jsp xsd enumeration value empty xsd enumeration value scriptless xsd restriction xsd simple content xsd complex type xsd complex type name extensible type abstract true xsd attribute name id type xsd id xsd complex type xsd complex type name function type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element xsd element name function class type javaee fully qualified class type xsd element xsd element name function signature type javaee string xsd element xsd element name example type javaee xsd string type min occurs xsd element xsd element name function extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag file type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element name path type javaee path type xsd element name example type javaee xsd string type min occurs xsd element xsd element name tag extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element name tag class type javaee fully qualified class type xsd element xsd element name tei class type javaee fully qualified class type min occurs xsd element xsd element name body content type javaee body content type xsd element xsd element name variable type javaee variable type min occurs max occurs unbounded xsd element name attribute type javaee tld attribute type min occurs max occurs unbounded xsd element name dynamic attributes type javaee generic boolean type min occurs xsd element name example type javaee xsd string type min occurs xsd element name tag extension type javaee tld extension type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld attribute type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd element name name type javaee java identifier type xsd element name required type javaee generic boolean type min occurs xsd element xsd choice xsd sequence xsd sequence min occurs xsd element name rtexprvalue type javaee generic boolean type xsd element xsd element name type type javaee fully qualified class type min occurs xsd element xsd sequence xsd choice xsd element name deferred value type javaee tld deferred value type min occurs xsd element xsd element name deferred method type javaee tld deferred method type min occurs xsd element xsd choice xsd sequence xsd element name fragment type javaee generic boolean type min occurs xsd element xsd choice xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld canonical name type xsd simple content xsd restriction base javaee xsd nmtokentype xsd simple content xsd complex type xsd complex type name tld deferred method type xsd sequence xsd element name method signature type javaee string min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld deferred value type xsd sequence xsd element name type type javaee fully qualified class type min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld extension type xsd sequence xsd element name extension element type javaee extensible type max occurs unbounded xsd sequence xsd attribute name namespace use required type xsd any uri xsd attribute name id type xsd id xsd complex type xsd complex type name tld taglib type xsd sequence xsd group ref javaee description group xsd element name tlib version type javaee dewey version type xsd element xsd element name short name type javaee tld canonical name type xsd element xsd element name uri type javaee xsd any uritype min occurs xsd element xsd element name validator type javaee validator type min occurs xsd element xsd element name listener type javaee listener type min occurs max occurs unbounded xsd element xsd element name tag type javaee tag type min occurs max occurs unbounded xsd element name tag file type javaee tag file type min occurs max occurs unbounded xsd element name function type javaee function type min occurs max occurs unbounded xsd element name taglib extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name version type javaee dewey version type fixed use required xsd attribute xsd attribute name id type xsd id xsd complex type xsd complex type name validator type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd element name validator class type javaee fully qualified class type xsd element xsd element name init param type javaee param value type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name variable scope type xsd simple content xsd restriction base javaee string xsd enumeration value nested xsd enumeration value begin xsd enumeration value end xsd restriction xsd simple content xsd complex type xsd complex type name variable type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd choice xsd element name name given type javaee java identifier type xsd element xsd element name name from attribute type javaee java identifier type xsd element xsd choice xsd element name variable class type javaee fully qualified class type min occurs xsd element xsd element name declare type javaee generic boolean type min occurs xsd element xsd element name scope type javaee variable scope type min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type
-1
javax servlet resources jsp xsd javax servlet resources jsp xsd javax servlet resources jsp xsd javax servlet resources jsp xsd name apache license version name url http www apache org licenses license txt url javaee xsd javaee xsd javaee xsd javaee web services xsd javaee web services client xsd javaee web services xsd javaee web services client xsd javaee web services xsd javaee web services client xsd jsp xsd jsp xsd web app xsd web common xsd web fragment xsd web app xsd web common xsd web fragment xsd which cddl version applies fix bug 55166 bug move jsp descriptor tag library descriptor schema defintion files from jsp api jar servlet api jar so relative includes between j2ee servlet jsp schemas correctly resolved markt fix
list servlet container initializer detected scis null	detected scis get servlet container initializers	detected scis null servlet container initializer sci detected scis initializer class map put sci new hash set class handles types ht null try ht sci get class get annotation handles types class catch exception log debug enabled log info sm get string context config sci debug url else log info sm get string context config sci info url ht null class types ht value types null class type types type annotation handles types annotations true else handles types non annotations true set servlet container initializer scis type initializer map get type scis null scis new hash set type initializer map put type scis scis add sci protected list servlet container initializer get servlet container initializers list servlet container initializer initializers new array list buffered reader br new buffered reader new input stream reader utf while line br read line null line line trim line length int line index continue line line substring trim initializers add get servlet container initializer line	return initializers protected servlet container initializer get servlet container initializer string class name throws ioexception class clazz class name class name true context get loader get class loader sci servlet container initializer clazz new instance
int write bytes produced while write future integer socket channel write socket write buffer integer socket write get write socket write int value
local name mb recycle
else decoder match null decoder match has matches
public static final string ws protocol header name lower ws protocol header name lower case locale english	header names always stored lower case constants ws protocol header name lower	header names case insensitive so always use lower case	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test ws subprotocols throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener new application listener config class get name false tomcat add servlet ctx default new default servlet ctx add servlet mapping default tomcat start web socket container ws container container provider get web socket container tomcat start session ws session ws container connect server tester programmatic endpoint class client endpoint config builder create preferred subprotocols arrays list sp3 build new uri ws localhost get port sub protocols endpoint path basic assert assert true ws session open ws session get negotiated subprotocol null assert assert true ws session get negotiated subprotocol empty ws session close ws session ws container connect server tester programmatic endpoint class client endpoint config builder create preferred subprotocols arrays list sp2 build new uri ws localhost get port sub protocols endpoint path basic assert assert true ws session open assert assert equals sp2 ws session get negotiated subprotocol assert assert array equals new string sp1 sp2 sub protocols endpoint subprotocols array new string ws session close server endpoint value echo subprotocols sp1 sp2 public static class sub protocols endpoint public static string path basic echo public static list string subprotocols open public void process open suppress warnings unused session session endpoint config epc subprotocols server endpoint config epc get subprotocols public static class config extends ws listener override public void context initialized servlet context event sce super context initialized sce server container sc server container sce get servlet context get attribute constants server container servlet context attribute try sc add endpoint sub protocols endpoint class catch deployment exception throw new illegal state exception
subprotocols arrays list annotation subprotocols
byte dst new byte application data limit application data get dst application data byte buffer wrap dst	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license byte buffer application data byte buffer wrap new string mydata get bytes test public void test ping pong messages throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener new application listener tester echo server config class get name false tomcat add servlet ctx default new default servlet ctx add servlet mapping default tomcat start web socket container ws container container provider get web socket container tomcat start session ws session ws container connect server tester programmatic endpoint class client endpoint config builder create build new uri ws localhost get port tester echo server config path async count down latch latch new count down latch tester endpoint tep tester endpoint ws session get user properties get endpoint tep set latch latch pong message handler handler new pong message handler latch ws session add message handler handler ws session get basic remote send ping application data boolean latch result handler get latch await 10 time unit seconds assert assert true latch result assert assert array equals application data array handler get messages get get application data array public static class pong message handler extends tester single message client basic handler pong message public pong message handler count down latch latch super latch override public void message pong message message get messages add message get latch null get latch count down
endpoint get so timeout set socket timeout endpoint get so timeout else set socket timeout
try mh pong message new ws pong message control buffer binary catch throwable exception utils handle throwable ws session get local error ws session finally control buffer binary clear	try mh instanceof message handler partial message handler partial string mh message message buffer text string last else caller ensures last true branch used message handler whole string mh message message buffer text string catch throwable exception utils handle throwable ws session get local error ws session finally message buffer text clear	try mh instanceof message handler partial message handler partial byte buffer mh message msg last else caller ensures last true branch used message handler whole byte buffer mh message msg catch throwable exception utils handle throwable ws session get local error ws session
td proxies header td	proxies header forwarded	proxies header forwarded	proxies header forwarded	proxies header forwarded
endpoint get so timeout set socket timeout endpoint get so timeout else set socket timeout
protected boolean use context class loader true path find jaas file set global jvm jaas used protected string config file protected jaas protected volatile boolean jaas loaded false getter code configfile code member variable public string get config file return config file setter code configfile code member variable public void set config file string config file config file config file	config get config login context new login context app name null callback handler config	load custom jaas protected get config try jaas loaded return jaas synchronized config file null jaas loaded true return null url resource thread current thread get context class loader get resource config file uri uri resource uri class sun config file class class name com sun security auth login config file constructor constructor sun config file get constructor uri class config constructor new instance uri jaas config jaas loaded true return jaas catch urisyntax exception ex throw new runtime exception ex catch method exception ex throw new runtime exception ex catch security exception ex throw new runtime exception ex catch exception ex throw new runtime exception ex catch illegal access exception ex throw new runtime exception ex catch illegal argument exception ex throw new runtime exception ex catch invocation target exception ex throw new runtime exception ex get cause catch class found exception ex throw new runtime exception ex attribute name config file required false name jaas file use realm searched using code class loader get resource string code so possible bundled within web application specified default jvm global jaas willbe used attribute
nio endpoint key attachment att nio endpoint key attachment socket get attachment false att null throw new ioexception key must cancelled read pool read socket get buf handler get read buffer socket selector socket get iochannel socket get so timeout
int special attributes length break
int elements length break
protected string rmi bind address null	get inet address which platform rmi server exported return textual inet address public string get rmi bind address return rmi bind address set inet address which platform rmi server exported param rmi bind address textual inet address public void set rmi bind address string rmi bind address rmi bind address rmi bind address	rmi bind address null throw new illegal state exception sm get string jmx remote lifecycle listener ssl rmi bind address force server bind address required rmi bind address null try ssf new rmi server bind socket factory inet address get name rmi bind address catch unknown host exception log error sm get string jmx remote lifecycle listener invalid rmi bind address rmi bind address	rmi server port platform env csf ssf	hash map string object env rmiclient socket factory csf rmiserver socket factory ssf mbean server mbean server locate registry create registry rmi registry port csf ssf	implements rmiclient socket factory serializable	public static class rmi server bind socket factory implements rmiserver socket factory private final inet address bind address public rmi server bind socket factory inet address address bind address address override public server socket create server socket int port throws ioexception return new server socket port bind address attribute name rmi bind address required false address interface used jmx rmi server setting option code true code incompatible setting system property code com sun management jmxremote ssl code code true code attribute
new string msg byte client received peek get data	msg byte msg new msg byte msg set data message one get bytes	reply flip
write time until first byte written commit time millis protected static class first byte time element implements access log element override public void add element char array writer buf date date request request response response long time long commit time response get coyote response get commit time commit time buf append else long delta commit time request get coyote request get start time buf append long string delta	case return new first byte time element	private long commit time	commited commit time system current time millis return time response committed based system current time millis return time response committed public long get commit time return commit time	set committed true	commit time li time taken commit response millis li
server failed start mapper listener won have been started mapper listener get state lifecycle state initialized mapper listener stop	log fatal sm get string catalina server start fail try get server destroy catch lifecycle exception e1 log debug destroy failed failed server e1 return
protected void set encoders endpoint config endpoint config class extends encoder encoder clazz endpoint config get encoders instance init endpoint config	protected final void close encoder entry entry encoder entries entry get encoder destroy do close protected abstract void do close	protected void do close	boolean secure endpoint config endpoint config	ws remote endpoint set encoders endpoint config user properties put all endpoint config get user properties	client endpoint	path parameters secure endpoint config	protected void do close	session close thread sleep 100 assert assert true server life cycle event called msg string encoder class get name init assert assert true server life cycle event called msg string decoder class get name init assert assert true server life cycle event called msg byte encoder class get name init assert assert true server life cycle event called msg byte decoder class get name init assert assert true server life cycle event called msg string encoder class get name destroy assert assert true server life cycle event called msg string decoder class get name destroy assert assert true server life cycle event called msg byte encoder class get name destroy assert assert true server life cycle event called msg byte decoder class get name destroy	static hash map string boolean life cycles called new hash map	public static void add life cycle event string event life cycles called put event boolean true public static boolean life cycle event called string event boolean called life cycles called get event return called null false called boolean value	server add life cycle event get class get name init server add life cycle event get class get name destroy	server add life cycle event get class get name init server add life cycle event get class get name destroy	server add life cycle event get class get name init server add life cycle event get class get name destroy	server add life cycle event get class get name init server add life cycle event get class get name destroy
boolean found binary decoder match false boolean found text decoder match false	found binary decoder match index byte buffer index byte buffer found binary decoder match true else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get declaring class get name found text decoder match index string index string found text decoder match true else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get declaring class get name
basic credentials credentials null try credentials new basic credentials bc string username credentials get username string password credentials get password principal context get realm authenticate username password principal null register request response principal http servlet request basic auth username password return true catch illegal argument exception iae log debug enabled log debug invalid iae get message request could so reissue challenge	parser http header basic per rfc 2617 section base64 encoded credentials per rfc 2045 section protected static class basic credentials only method supported parser note we include single white space its delimiter private static final string method basic private byte chunk private int initial offset private int base64blob offset private int base64blob length private string username null private string password null parse http header basic per rfc 2617 section base64 encoded credentials per rfc 2045 section param input header value parse place throws illegal argument exception header does conform rfc 2617 public basic credentials byte chunk input throws illegal argument exception input initial offset input get offset parse method byte decoded parse base64 parse credentials decoded trivial accessor return decoded username token string which never code null code can empty public string get username return username trivial accessor return decoded password token string code null code password found credentials public string get password return password method string case insensitive must hae least one space character delimiter private void parse method throws illegal argument exception starts ignore case method step past auth method name base64blob offset initial offset method length base64blob length get length method length else possible permitted throw new illegal argument exception header method basic decode base64 user pass token which rfc 2617 states can longer than 76 characters per line limit defined rfc 2045 base64 decoder ignore embedded line break characters well surplus surrounding white space private byte parse base64 throws illegal argument exception byte decoded base64 decode base64 get buffer base64blob offset base64blob length restore original offset set offset initial offset decoded null throw new illegal argument exception basic credentials base64 return decoded extract mandatory username token separate from optional password token tolerate surplus surrounding white space private void parse credentials byte decoded throws illegal argument exception int colon int decoded length decoded colon break colon username new string decoded b2cconverter iso 8859 password remain null else username new string decoded colon b2cconverter iso 8859 password new string decoded colon decoded length colon b2cconverter iso 8859 tolerate surplus white space around credentials password length password password trim tolerate surplus white space around credentials username length username username trim	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test basic basic credentials inner class associated base64 decoder private static final string nice method basic private static final string user name userid private static final string password secret test cases good basic auth credentials base64 strings can have zero one two trailing pad characters test public void test good credentials throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password test public void test good credentials password throws exception final basic auth header auth header new basic auth header nice method user name null basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert null credentials get password test public void test good crib throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password test public void test good crib user only throws exception final string base64 crib xnlcmlk final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert null credentials get password test public void test good crib one pad throws exception final string password1 secrets final string base64 crib xnlcmlk nl y3jld hm final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password1 credentials get password rfc 2045 says base64 encoded string should represented lines more than 76 characters however rfc 2617 says base64 user pass token limited 76 char line also says all line breaks including mandatory ones should ignored during decoding test case has line break base64 string see also test good crib base64big below test public void test good crib line wrap throws exception final string user long aaaabbbbcccc dddd 80 characters final string base64 crib qujdrevgr0h jskt wvph ym nk zwzna glqa2xtbm9wc xjzd hv2d3h5ej ax mj m0 nty3odkr l0fbqufcqk final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user long credentials get username rfc 2045 says base64 encoded string should represented lines more than 76 characters however rfc 2617 says base64 user pass token limited 76 char line test public void test good crib base64big throws exception our decoder accepts long token without complaint final string user long aaaabbbbcccc dddd 80 characters final string base64 crib qujdrevgr0h jskt wvph ym nk zwzna glqa2xtbm9wc xjzd hv2d3h5ej ax mj m0 nty3odkr l0fbqufcqk new line final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user long credentials get username verify parser follows rfc2617 treating auth scheme token case insensitive test public void test auth method case basic throws exception final string method ic final basic auth header auth header new basic auth header method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser rejects invalid method test public void test auth method bad method throws exception final string method bad method final basic auth header auth header new basic auth header method user name password suppress warnings unused basic basic credentials credentials null try credentials new basic basic credentials auth header get header assert fail illegal argument exception expected catch exception assert assert true instanceof illegal argument exception assert assert true get message contains header method confirm basic parser tolerates excess white space after method rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat tolerates any amount white within limits http header sizes test public void test auth method extra leading space throws exception final basic auth header auth header new basic auth header nice method user name password final basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password invalid decoded credentials cases test public void test wrong password throws exception final string pwd wrong wrong final basic auth header auth header new basic auth header nice method user name pwd wrong basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password test public void test missing username throws exception final string empty user name final basic auth header auth header new basic auth header nice method empty user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals empty user name credentials get username assert assert equals password credentials get password test public void test short username throws exception final string short user name final basic auth header auth header new basic auth header nice method short user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals short user name credentials get username assert assert equals password credentials get password test public void test short password throws exception final string short password final basic auth header auth header new basic auth header nice method user name short password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals short password credentials get password test public void test password has space embedded throws exception final string password space abc def final basic auth header auth header new basic auth header nice method user name password space basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password space credentials get password test public void test password has colon embedded throws exception final string password colon abc def final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password test public void test password has colon leading throws exception final string password colon abcdef final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password test public void test password has colon trailing throws exception final string password colon abcdef final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password confirm basic parser tolerates excess white space after base64 blob rfc2617 does define case asks servers tolerant kind client deviation test public void test auth method extra trailing space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser tolerates excess white space around username inside base64 blob rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space test public void test user extra space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser tolerates excess white space around username within base64 blob rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space test public void test password extra space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password invalid base64 string tests refer rfc2045 section non trailing should trigger premature termination decoder returning truncated string eventually result assert failure test public void test bad base64inline equals throws exception final string base64 crib xnlcmlk nl y3j ao final string truncated pwd secr final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password assert assert equals truncated pwd credentials get password legal base64 character rfc says must ignored decoder scramble decoded string eventually result assert failure test public void test bad base64char throws exception final string base64 crib xnlcmlk nl 3jld hm final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password legal base64 character rfc says must ignored decoder very strange case because next character pad which terminates string normally likely certain decoded password damaged subsequent fail test public void test bad base64last char throws exception final string base64 crib xnlcmlk nl y3jld final string possibly damaged pwd secret final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals possibly damaged pwd credentials get password trailing third illegal however rfc says decoder must terminate soon first pad detected so error detected unless payload has been damaged some way test public void test bad base64too many equals throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password should multiple encoded characters however rfc says decoder should pad input string zero bits out next boundary error detected unless payload has been damaged some way particular crib has damage test public void test bad base64bad length throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password encapsulate logic generate http header basic note only used internally so need validate arguments private final class basic auth header private final string http auth private final byte header http auth get bytes b2cconverter iso 8859 private byte chunk auth header private int initial offset method creates valid base64 blob private basic auth header string method string username string password method username password null method creates valid base64 blobs optional trailing data private basic auth header string method string username string password string extra blob prefix method string user credentials password null password length username username password byte credentials bytes user credentials get bytes b2cconverter iso 8859 string base64auth base64 encode base64string credentials bytes byte base64bytes base64auth get bytes b2cconverter iso 8859 byte extra bytes extra blob null extra blob length null extra blob get bytes b2cconverter iso 8859 try auth header append base64bytes base64bytes length extra bytes null auth header append extra bytes extra bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message emulate tomcat server offset points method header auth header set offset initial offset method allows injection cribbed base64 blobs without any validation contents private basic auth header string method string fake base64 prefix method byte fake bytes fake base64 get bytes b2cconverter iso 8859 try auth header append fake bytes fake bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message emulate tomcat server offset points method header auth header set offset initial offset construct common header private void prefix string method auth header new byte chunk auth header set bytes header header length initial offset header length string method method byte method bytes method get bytes b2cconverter iso 8859 try auth header append method bytes method bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message private byte chunk get header return auth header	using white space around username credential request accepted cookies http servlet response sc ok using white space around password credential request accepted cookies http servlet response sc ok fix bug 55101 bug make basic more tolerant whitespace patch provided brian burch markt fix
url str starts file url str starts jndi url str starts http url str starts https
check constraints uncovered http methods needs after scis listeners may change constraints ok check constraints uncovered methods	private void check constraints uncovered methods todo add option lower log level any uncovered method warnings debug todo implement adding constraints deny uncovered methods set string covered patterns new hash set map string set string url method map new hash map map string set string url omitted method map new hash map first build lists covered patterns those patterns might uncovered security constraint constraint constraints security collection collections constraint find collections security collection collection collections string patterns collection find patterns string methods collection find methods string omitted methods collection find omitted methods simple case methods methods length omitted methods length string pattern patterns covered patterns add pattern continue pre calculate so we don do every iteration following loop list string om new null omitted methods length om new arrays list omitted methods only need process uncovered patterns string pattern patterns covered patterns contains pattern methods length build interset omitted methods pattern set string om url omitted method map get pattern om null om new hash set url method map put pattern om om retain all om new else build union methods pattern set string url method map get pattern null new hash set url method map put pattern string method methods add method now check potentially uncovered patterns map entry string set string entry url method map entry set string pattern entry get key covered patterns contains pattern fully covered ignore any partial coverage url omitted method map remove pattern continue set string omitted methods url omitted method map get pattern set string methods entry get value omitted methods null string builder msg new string builder string method methods msg append method msg append log error sm get string standard context uncovered http method pattern msg string trim continue long every omitted method method pattern fully covered omitted methods remove all methods omitted methods size string builder msg new string builder string method omitted methods msg append method msg append log error sm get string standard context uncovered http omitted method pattern msg string trim
break break
int mbrs length include
header index token break	header index token break
break	break
string result null prefix defined look prefixed property first result find property prefix name prefix property match prefix try just name result null result find property name simple property replacement mostly folder names result null result replace result return result private string find property string name class loader class loader thread current thread get context class loader	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link filter enable client side cross origin requests implementing w3c cors ross rigin esource haring resources each link http servlet request request inspected per appropriate response headers added link http servlet response default also sets following request attributes help determine nature request downstream ul li cors cors request flag determine request cors request set code true code cors request code false code otherwise li li cors request origin origin url url page from where request originated li li cors request type type request possible values ul li simple request which preceded pre flight request li li actual request which preceded pre flight request li li pre flight pre flight request li li cors normal same origin request li li invalid cors cross origin request which invalid li ul li li cors request headers request headers sent access control request headers header pre flight request li ul see href http www w3 org tr cors cors private static final log log log factory get log cors filter class private static final string manager sm string manager get manager constants package link collection origins consisting zero more origins allowed access resource private final collection string allowed origins determines any origin allowed make request private boolean any origin allowed link collection methods consisting zero more methods supported resource private final collection string allowed http methods link collection headers consisting zero more header field names supported resource private final collection string allowed http headers link collection exposed headers consisting zero more header field names headers other than simple response headers resource might use can exposed private final collection string exposed headers supports credentials flag indicates whether resource supports user credentials request true when resource does false otherwise private boolean supports credentials indicates seconds how long results pre flight request can cached pre flight result cache private long preflight max age determines request should decorated private boolean decorate request public cors filter allowed origins new hash set allowed http methods new hash set allowed http headers new hash set exposed headers new hash set override public void do filter final servlet request servlet request final servlet response servlet response final filter chain filter chain throws ioexception servlet exception servlet request instanceof http servlet request servlet response instanceof http servlet response throw new servlet exception sm get string cors filter only http safe downcast point http servlet request request http servlet request servlet request http servlet response response http servlet response servlet response determines cors request type cors filter corsrequest type request type check request type request adds cors specific attributes request decorate request cors filter decorate request request type switch request type case simple handles simple cors request handle simple cors request response filter chain break case actual handles actual cors request handle simple cors request response filter chain break case pre flight handles pre flight cors request handle preflight cors request response filter chain break case cors handles normal request cross origin request handle non cors request response filter chain break default handles cors request violates handle invalid cors request response filter chain break override public void init final filter config filter config throws servlet exception initialize defaults parse store default allowed origins default allowed http methods default allowed http headers default exposed headers default supports credentials default preflight maxage default decorate request filter config null string config allowed origins filter config get init parameter param cors allowed origins string config allowed http methods filter config get init parameter param cors allowed methods string config allowed http headers filter config get init parameter param cors allowed headers string config exposed headers filter config get init parameter param cors exposed headers string config supports credentials filter config get init parameter param cors support credentials string config preflight max age filter config get init parameter param cors preflight maxage string config decorate request filter config get init parameter param cors request decorate parse store config allowed origins config allowed http methods config allowed http headers config exposed headers config supports credentials config preflight max age config decorate request handles cors request type link corsrequest type simple param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception see href http www w3 org tr cors resource requests simple cross origin request actual request redirects protected void handle simple cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception cors filter corsrequest type request type check request type request request type cors filter corsrequest type simple request type cors filter corsrequest type actual throw new illegal argument exception sm get string cors filter wrong type2 cors filter corsrequest type simple cors filter corsrequest type actual final string origin request get header cors filter request header origin final string method request get method section origin allowed origin handle invalid cors request response filter chain return allowed http methods contains method handle invalid cors request response filter chain return section add single access control allow origin header any origin allowed supports credentials resource doesn support credentials any origin allowed make cors request return header response add header cors filter response header access control allow origin else resource supports credentials add single access control allow origin header value origin header value response add header cors filter response header access control allow origin origin section resource supports credentials add single access control allow credentials header case sensitive string true value supports credentials response add header cors filter response header access control allow credentials true section list exposed headers empty add one more access control expose headers headers values header field names given list exposed headers exposed headers null exposed headers size string exposed headers string join exposed headers response add header cors filter response header access control expose headers exposed headers string forward request down filter chain filter chain do filter request response handles cors pre flight request param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception protected void handle preflight cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception corsrequest type request type check request type request request type corsrequest type pre flight throw new illegal argument exception sm get string cors filter wrong type1 corsrequest type pre flight name lower case final string origin request get header cors filter request header origin section origin allowed origin handle invalid cors request response filter chain return section string access control request method request get header cors filter request header access control request method access control request method null http methods contains access control request method trim handle invalid cors request response filter chain return else access control request method access control request method trim section string access control request headers header request get header cors filter request header access control request headers list string access control request headers new linked list access control request headers header null access control request headers header trim empty string headers access control request headers header trim split string header headers access control request headers add header trim lower case section allowed http methods contains access control request method handle invalid cors request response filter chain return section access control request headers empty string header access control request headers allowed http headers contains header handle invalid cors request response filter chain return section supports credentials response add header cors filter response header access control allow origin origin response add header cors filter response header access control allow credentials true else any origin allowed response add header cors filter response header access control allow origin else response add header cors filter response header access control allow origin origin section preflight max age response add header cors filter response header access control max age string value preflight max age section response add header cors filter response header access control allow methods access control request method section 10 allowed http headers null allowed http headers empty response add header cors filter response header access control allow headers join allowed http headers do forward request down filter chain handles request cors request valid request cross origin request just forwards request down filter chain param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception private void handle non cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception let request pass filter chain do filter request response handles cors request violates param request link http servlet request object param response link http servlet response object param filter chain link filter chain object private void handle invalid cors final http servlet request request final http servlet response response final filter chain filter chain string origin request get header cors filter request header origin string method request get method string access control request headers request get header request header access control request headers response set content type text plain response set status http servlet response sc forbidden response reset buffer log debug enabled debug so need i18n string builder message new string builder invalid cors request origin message append origin message append method message append method access control request headers null message append access control request headers message append access control request headers log debug message string override public void destroy noop decorates link http servlet request cors attributes ul li cors cors request flag determine request cors request set code true code cors request code false code otherwise li li cors request origin origin url li li cors request type type request values code simple code code preflight code code cors code code invalid cors code li li cors request headers request headers sent access control request headers header pre flight request li ul param request link http servlet request object param cors request type link corsrequest type object protected static void decorate final http servlet request request final corsrequest type cors request type request null throw new illegal argument exception sm get string cors filter null request cors request type null throw new illegal argument exception sm get string cors filter null request type switch cors request type case simple request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case break case actual request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case break case pre flight request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case string headers request get header request header access control request headers headers null headers request set attribute cors filter http request attribute request headers headers break case cors request set attribute cors filter http request attribute cors request boolean false break default don set any attributes break joins elements link set string where each element separated provided separator param elements link set containing elements join together param join separator character used separating elements return joined link string code null code elements link set null protected static string join final collection string elements final string join separator string separator elements null return null join separator null separator join separator string builder buffer new string builder boolean first true string element elements first buffer append separator else first false element null buffer append element return buffer string determines request type param request protected corsrequest type check request type final http servlet request request corsrequest type request type corsrequest type invalid cors request null throw new illegal argument exception sm get string cors filter null request string origin header request get header request header origin section section origin header null origin header empty request type corsrequest type invalid cors else valid origin origin header request type corsrequest type invalid cors else string method request get method method null http methods contains method options equals method string access control request method header request get header request header access control request method access control request method header null access control request method header empty request type corsrequest type pre flight else access control request method header null access control request method header empty request type corsrequest type invalid cors else request type corsrequest type actual else get equals method head equals method request type corsrequest type simple else post equals method string content type request get content type content type null content type content type lower case trim simple http request content type values contains content type request type corsrequest type simple else request type corsrequest type actual else complex http methods contains method request type corsrequest type actual else request type corsrequest type cors return request type checks origin allowed make cors request param origin origin return code true code origin allowed code false code otherwise private boolean origin allowed final string origin any origin allowed return true origin header case sensitive match any allowed origins return true else return false return allowed origins contains origin parses each param value populates variables param provided overrides default param allowed origins link string comma separated origins param allowed http methods link string comma separated http methods param allowed http headers link string comma separated http headers param exposed headers link string comma separated headers needs exposed param supports credentials true support credentials needs enabled param preflight max age amount seconds user agent allowed cache result pre flight request throws servlet exception private void parse store final string allowed origins final string allowed http methods final string allowed http headers final string exposed headers final string supports credentials final string preflight max age final string decorate request throws servlet exception allowed origins null allowed origins trim equals any origin allowed true else any origin allowed false set string set allowed origins parse string set allowed origins allowed origins clear allowed origins add all set allowed origins allowed http methods null set string set allowed http methods parse string set allowed http methods allowed http methods clear allowed http methods add all set allowed http methods allowed http headers null set string set allowed http headers parse string set allowed http headers set string lower case headers new hash set string header set allowed http headers string lower case header lower case lower case headers add lower case allowed http headers clear allowed http headers add all lower case headers exposed headers null set string set exposed headers parse string set exposed headers exposed headers clear exposed headers add all set exposed headers supports credentials null any value other true false supports credentials boolean parse boolean supports credentials preflight max age null try preflight max age empty preflight max age long parse long preflight max age else preflight max age 0l catch number format exception throw new servlet exception sm get string cors filter invalid pre flight max age decorate request null any value other true false decorate request boolean parse boolean decorate request takes comma separated list returns set string param data comma separated list strings return set string private set string parse string set final string data string splits data null data length splits data split else splits new string set string set new hash set splits length string split splits set add split trim return set checks given origin valid criteria ul li encoded character present origin valid li li origin should valid link uri li ul param origin see href http tools ietf org html rfc952 rfc952 protected static boolean valid origin string origin checks encoded characters helps prevent crlf injection origin contains return false uri origin uri try origin uri new uri origin catch urisyntax exception return false scheme uri null return false return true otherwise return origin uri get scheme null determines any origin allowed make cors request return code true code enabled false otherwise public boolean any origin allowed return any origin allowed returns link set headers should exposed browser public collection string get exposed headers return exposed headers determines supports credentials enabled public boolean supports credentials return supports credentials returns preflight response cache time seconds return time cache seconds public long get preflight max age return preflight max age returns link set allowed origins allowed make requests return link set public collection string get allowed origins return allowed origins returns link set http methods allowed make requests return link set public collection string get allowed http methods return allowed http methods returns link set headers support resource return link set public collection string get allowed http headers return allowed http headers cors response headers access control allow origin header indicates whether resource can shared based returning value origin request header response public static final string response header access control allow origin access control allow origin access control allow credentials header indicates whether response request can exposed when omit credentials flag unset when part response preflight request indicates actual request can include user credentials public static final string response header access control allow credentials access control allow credentials access control expose headers header indicates which headers safe expose api cors api public static final string response header access control expose headers access control expose headers access control max age header indicates how long results preflight request can cached preflight result cache public static final string response header access control max age access control max age access control allow methods header indicates part response preflight request which methods can used during actual request public static final string response header access control allow methods access control allow methods access control allow headers header indicates part response preflight request which header field names can used during actual request public static final string response header access control allow headers access control allow headers cors request headers origin header indicates where cross origin request preflight request originates from public static final string request header origin origin access control request method header indicates which method used actual request part preflight request public static final string request header access control request method access control request method access control request headers header indicates which headers used actual request part preflight request public static final string request header access control request headers access control request headers request attributes prefix cors request attribute public static final string http request attribute prefix cors attribute contains origin request public static final string http request attribute origin http request attribute prefix request origin boolean value suggesting request cors request public static final string http request attribute cors request http request attribute prefix cors request type cors request type link corsrequest type public static final string http request attribute request type http request attribute prefix request type request headers sent access control request headers header pre flight request public static final string http request attribute request headers http request attribute prefix request headers constants enumerates varies types cors requests also provides utility methods determine request type protected static enum corsrequest type simple http request shouldn pre flighted simple http request needs pre flighted actual pre flight cors request get meta information before non simple http request sent pre flight cors request normal request cors invalid cors request qualifies cors request fails valid one invalid cors link collection http methods case sensitive see href http tools ietf org html rfc2616 section http tools ietf org html rfc2616 section public static final collection string http methods new hash set arrays list options get head post put delete trace connect link collection non simple http methods case sensitive public static final collection string complex http methods new hash set arrays list put delete trace connect link collection simple http methods case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http methods new hash set arrays list get post head link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http request headers new hash set arrays list accept accept language content language link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http response headers new hash set arrays list cache control content language content type expires last modified pragma link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http request content type values new hash set arrays list application www form urlencoded multipart form data text plain defaults default all origins allowed make requests public static final string default allowed origins default following methods supported get post head options public static final string default allowed http methods get post head options default time duration cache pre flight response 30 mins public static final string default preflight maxage 1800 default support credentials turned public static final string default supports credentials true default following headers supported origin accept requested content type access control request method access control request headers public static final string default allowed http headers origin accept requested content type access control request method access control request headers default none headers exposed response public static final string default exposed headers default request decorated cors attributes public static final string default decorate request true filter config init param name key retrieve allowed origins from link filter config public static final string param cors allowed origins cors allowed origins key retrieve support credentials from link filter config public static final string param cors support credentials cors support credentials key retrieve exposed headers from link filter config public static final string param cors exposed headers cors exposed headers key retrieve allowed headers from link filter config public static final string param cors allowed headers cors allowed headers key retrieve allowed methods from link filter config public static final string param cors allowed methods cors allowed methods key retrieve preflight max age from link filter config public static final string param cors preflight maxage cors preflight maxage key determine request should decorated public static final string param cors request decorate cors request decorate licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private filter chain filter chain new tester filter chain tests get request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple get throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests post request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple post throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set content type text plain request set method post tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests head request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple head throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method head tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case test presence specific origin response when used throws ioexception throws servlet exception test public void test do filter simple specific header throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests prsence origin response when supports credentials enabled alongwith any origin throws ioexception throws servlet exception test public void test do filter simple any origin supports credentials throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true response get header cors filter response header access control allow credentials equals true assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests presence origin response when supports credentials enabled alongwith any origin throws ioexception throws servlet exception test public void test do filter simple any origin supports credentials disabled throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs any origin assert assert null response get header cors filter response header access control allow credentials assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests presence exposed headers response configured throws ioexception throws servlet exception test public void test do filter simple exposed headers throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config exposed headers cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true response get header cors filter response header access control expose headers equals tester filter configs exposed headers assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case checks options request processed pre flight throws ioexception throws servlet exception test public void test do filter preflight throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type checks options request processed pre flight where any origin enabled throws ioexception throws servlet exception test public void test do filter preflight any origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type checks options request processed pre flight throws ioexception throws servlet exception test public void test do filter preflight invalid origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www example com request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals response get status http servlet response sc forbidden test public void test do filter preflight negative max age throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config negative max age cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert null response get header cors filter response header access control max age assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type test public void test do filter preflight credentials throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true response get header cors filter response header access control allow credentials equals true assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type test public void test do filter preflight without credentials specific origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config specific origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert null response get header cors filter response header access control allow credentials assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type negative test when cors request arrives null origin test public void test do filter null origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type cors request type cors filter do filter request response filter chain assert assert false boolean request get attribute cors filter http request attribute cors request boolean value test public void test do filter invalid corsorigin allowed throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin www google com request set method post tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status test expected servlet exception class public void test do filter null request null response throws ioexception servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter null null filter chain test expected servlet exception class public void test do filter null request response throws ioexception servlet exception tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter null response filter chain test expected servlet exception class public void test do filter request null response throws ioexception servlet exception tester http servlet request request new tester http servlet request cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request null filter chain test public void test init default filter config throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init null cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case test expected servlet exception class public void test init invalid filter config throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get filter config invalid max preflight age we don get exception point all mocked objects worked expected tests non simple request given simple request handler throws ioexception throws servlet exception test expected illegal argument exception class public void test simple throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter handle simple cors request response filter chain when non preflight request given pre flight request handler throws ioexception throws servlet exception test expected illegal argument exception class public void test preflight throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter handle preflight cors request response filter chain test expected illegal argument exception class public void test decorate null request null corsrequest type cors filter decorate null null test expected illegal argument exception class public void test decorate null request valid corsrequest type cors filter decorate null cors filter corsrequest type simple test expected illegal argument exception class public void test decorate valid request null request type tester http servlet request request new tester http servlet request cors filter decorate request null test public void test decorate corsrequest type cors tester http servlet request request new tester http servlet request cors filter decorate request cors filter corsrequest type cors assert assert false boolean request get attribute cors filter http request attribute cors request boolean value test public void test decorate corsrequest type invalid cors tester http servlet request request new tester http servlet request cors filter decorate request cors filter corsrequest type invalid cors assert assert null request get attribute cors filter http request attribute cors request test public void test check simple request type any origin throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type simple request type happy path test when valid cors simple request arrives throws servlet exception test public void test check simple request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type simple request type happy path test when valid cors simple request arrives throws servlet exception test public void test check actual request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method put cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type happy path test when valid cors simple request arrives throws servlet exception test public void test check actual request type method postnot simple headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method post request set content type application json cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type when valid cors pre flight request arrives access control request method throws servlet exception throws ioexception test public void test check pre flight request type acrm throws servlet exception ioexception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type when valid cors pre flight request arrives empty access control request method throws servlet exception throws ioexception test public void test check pre flight request type empty acrm throws servlet exception ioexception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type section throws servlet exception throws ioexception test public void test check pre flight request type invalid request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method polite request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type unsupported request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method trace request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type unsupported request headers throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers answer request set method options cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type any origin credentials throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers origin request set method options cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals assert assert null response get header cors filter response header access control allow credentials test public void test check pre flight request type origin allowed throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin www ebay com request set header cors filter request header access control request method put request set method options cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type empty headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type negative test when cors request arrives empty origin throws servlet exception test public void test check corsrequest type empty origin throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type tests failure when different domain used allowed list origins throws servlet exception throws ioexception test public void test check invalid origin throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin www example com request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status tests failure when different sub domain used allowed list origins throws servlet exception throws ioexception test public void test check invalid origin allowed subdomain throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http commons apache org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status put allowed request method throws servlet exception throws ioexception test public void test check invalid request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http tomcat apache org request set method put cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status when request method null throws servlet exception test public void test check null request method throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http tomcat apache org request set method null cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type http tomcat apache org allowed origin https tomcat apache org because scheme doesn match throws servlet exception test public void test check scheme variance throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin https tomcat apache org request set method post cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type http tomcat apache org allowed origin http tomcat apache org 8080 because ports doesn match throws servlet exception throws ioexception test public void test check port variance throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http tomcat apache org 8080 request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status tests failure when invalid link http servlet request encountered throws servlet exception test expected illegal argument exception class public void test check request type null throws servlet exception http servlet request request null cors filter cors filter new cors filter cors filter check request type request test public void test join set string elements new linked hash set string separator elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test join single element set string elements new linked hash set string separator elements add world string join cors filter join elements separator assert assert true world equals join test public void test join sep null set string elements new linked hash set string separator null elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test join elements null set string elements null string separator string join cors filter join elements separator assert assert null join test public void test join one null element set string elements new linked hash set string separator elements add null elements add peace string join cors filter join elements separator assert assert true peace equals join test public void test join all null elements set string elements new linked hash set string separator elements add null elements add null string join cors filter join elements separator assert assert true equals join test public void test join all empty elements set string elements new linked hash set string separator elements add elements add string join cors filter join elements separator assert assert true equals join test public void test join pipe separator set string elements new linked hash set string separator elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test filter config throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get default filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter any origin allowed assert assert true cors filter get exposed headers size assert assert true cors filter supports credentials assert assert true cors filter get preflight max age 1800 test expected servlet exception class public void test filter config invalid preflight age throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get filter config invalid max preflight age test public void test string parser empty throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get empty filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter get exposed headers size assert assert false cors filter supports credentials assert assert true cors filter get preflight max age init param null default value used throws servlet exception test public void test string parser null throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get null filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter any origin allowed assert assert true cors filter get exposed headers size assert assert true cors filter supports credentials assert assert true cors filter get preflight max age 1800 test public void test valid origin assert assert true cors filter valid origin http www w3 org test public void test valid origin crlf assert assert false cors filter valid origin http www w3 org test public void test valid origin encoded crlf1 assert assert false cors filter valid origin http www w3 org 0d 0a test public void test valid origin encoded crlf2 assert assert false cors filter valid origin http www w3 org 0d 0a test public void test valid origin encoded crlf3 assert assert false cors filter valid origin http www w3 org 0d 0ad 0d 0aa test public void test check invalid crlf1 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf2 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf3 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org 0d 0a request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf4 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org 0d 0a request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test decorate request disabled throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config decorate request disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert null request get attribute cors filter http request attribute cors request assert assert null request get attribute cors filter http request attribute origin assert assert null request get attribute cors filter http request attribute request headers assert assert null request get attribute cors filter http request attribute request type test public void test destroy nothing test op licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license override public void do filter servlet request request servlet response response throws ioexception servlet exception op licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final string https www apache org https www apache org public static final string http tomcat apache org http tomcat apache org public static final string exposed headers custom header any origin public static final string any origin public static final tester servlet context mock servlet context new tester servlet context public static filter config get default filter config final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config any origin supports credentials final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials true final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config any origin supports credentials disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials false final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config specific origin supports credentials disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins http tomcat apache org https www apache org final string exposed headers cors filter default exposed headers final string support credentials false final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config exposed headers final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get secure filter config final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins https www apache org final string exposed headers cors filter default exposed headers final string support credentials true final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get null filter config return generate filter config null null null null null null null public static filter config get specific origin filter config final string allowed origins https www apache org http tomcat apache org final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get specific origin filter config negative max age final string allowed origins https www apache org http tomcat apache org final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config invalid max preflight age final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age abc final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get empty filter config final string allowed http headers final string allowed http methods final string allowed origins final string exposed headers final string support credentials final string preflight max age final string decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config decorate request disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request false return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request private static filter config generate filter config final string allowed http headers final string allowed http methods final string allowed origins final string exposed headers final string support credentials final string preflight max age final string decorate request filter config filter config new filter config override public string get filter name return cors filter override public servlet context get servlet context return mock servlet context override public string get init parameter string name cors filter param cors allowed headers equals ignore case name return allowed http headers else cors filter param cors allowed methods equals ignore case name return allowed http methods else cors filter param cors allowed origins equals ignore case name return allowed origins else cors filter param cors exposed headers equals ignore case name return exposed headers else cors filter param cors support credentials equals ignore case name return support credentials else cors filter param cors preflight maxage equals ignore case name return preflight max age else cors filter param cors request decorate equals ignore case name return decorate request return null override public enumeration string get init parameter names return null return filter config licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private map string object attributes new hash map private map string list string headers new hash map private string method private string content type override public object get attribute string name return attributes get name override public enumeration string get attribute names return collections enumeration attributes key set override public string get character encoding throw new runtime exception implemented override public void set character encoding string env throws unsupported encoding exception override public int get content length throw new runtime exception implemented override public string get content type return content type public void set content type string content type content type content type override public servlet input stream get input stream throws ioexception throw new runtime exception implemented override public string get parameter string name throw new runtime exception implemented override public enumeration string get parameter names throw new runtime exception implemented override public string get parameter values string name throw new runtime exception implemented override public map string string get parameter map throw new runtime exception implemented override public string get protocol throw new runtime exception implemented override public string get scheme throw new runtime exception implemented override public string get server name throw new runtime exception implemented override public int get server port throw new runtime exception implemented override public buffered reader get reader throws ioexception throw new runtime exception implemented override public string get remote addr throw new runtime exception implemented override public string get remote host throw new runtime exception implemented override public void set attribute string name object attributes put name override public void remove attribute string name attributes remove name override public locale get locale throw new runtime exception implemented override public enumeration locale get locales throw new runtime exception implemented override public boolean secure throw new runtime exception implemented override public request dispatcher get request dispatcher string path throw new runtime exception implemented override public string get real path string path throw new runtime exception implemented override public int get remote port throw new runtime exception implemented override public string get local name throw new runtime exception implemented override public string get local addr throw new runtime exception implemented override public int get local port throw new runtime exception implemented override public string get auth type throw new runtime exception implemented override public cookie get cookies throw new runtime exception implemented override public long get date header string name throw new runtime exception implemented override public string get header string name list string list headers get name list null return list get return cors filter join new hash set list return null public void set header string name string value list string values new array list values add value headers put name values override public enumeration string get headers string name throw new runtime exception implemented override public enumeration string get header names return collections enumeration headers key set override public int get int header string name throw new runtime exception implemented override public string get method return method public void set method string method method method override public string get path info throw new runtime exception implemented override public string get path translated throw new runtime exception implemented override public string get context path throw new runtime exception implemented override public string get query string throw new runtime exception implemented override public string get remote user throw new runtime exception implemented override public boolean user role string role throw new runtime exception implemented override public principal get user principal throw new runtime exception implemented override public string get requested session id throw new runtime exception implemented override public string get request uri throw new runtime exception implemented override public string buffer get request url throw new runtime exception implemented override public string get servlet path throw new runtime exception implemented override public http session get session boolean create throw new runtime exception implemented override public http session get session throw new runtime exception implemented override public boolean requested session id valid throw new runtime exception implemented override public boolean requested session id from cookie throw new runtime exception implemented override public boolean requested session id from url throw new runtime exception implemented override public boolean requested session id from url throw new runtime exception implemented override public long get content length long throw new runtime exception implemented override public servlet context get servlet context throw new runtime exception implemented override public async context start async throws illegal state exception throw new runtime exception implemented override public async context start async servlet request servlet request servlet response servlet response throws illegal state exception throw new runtime exception implemented override public boolean async started throw new runtime exception implemented override public boolean async supported throw new runtime exception implemented override public async context get async context throw new runtime exception implemented override public dispatcher type get dispatcher type throw new runtime exception implemented override public string change session id throw new runtime exception implemented override public boolean authenticate http servlet response response throws ioexception servlet exception throw new runtime exception implemented override public void login string username string password throws servlet exception throw new runtime exception implemented override public void logout throws servlet exception throw new runtime exception implemented override public collection part get parts throws ioexception servlet exception throw new runtime exception implemented override public part get part string name throws ioexception servlet exception throw new runtime exception implemented override public extends http upgrade handler upgrade class http upgrade handler class throws ioexception throw new runtime exception implemented
private print writer pw private list string header names new array list private list string header values new array list private int status override public print writer get writer throws ioexception pw null pw new print writer new string writer return pw override public string get header string name int index header names index name index return header values get index return null override public void set header string name string value int index header names index name index header values set index value else header names add name header values add value override public void add header string name string value header names add name header values add value override public int get status return status override public void set status int status status status	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license override public string get context path throw new runtime exception implemented override public servlet context get context string uripath throw new runtime exception implemented override public int get major version throw new runtime exception implemented override public int get minor version throw new runtime exception implemented override public string get mime type string file throw new runtime exception implemented override public set string get resource paths string path throw new runtime exception implemented override public url get resource string path throws malformed urlexception throw new runtime exception implemented override public input stream get resource stream string path throw new runtime exception implemented override public request dispatcher get request dispatcher string path throw new runtime exception implemented override public request dispatcher get named dispatcher string name throw new runtime exception implemented override public servlet get servlet string name throws servlet exception throw new runtime exception implemented override public enumeration servlet get servlets throw new runtime exception implemented override public enumeration string get servlet names throw new runtime exception implemented override public void log string msg noop override public void log exception exception string msg noop override public void log string message throwable throwable noop override public string get real path string path throw new runtime exception implemented override public string get server info throw new runtime exception implemented override public string get init parameter string name throw new runtime exception implemented override public enumeration string get init parameter names throw new runtime exception implemented override public object get attribute string name throw new runtime exception implemented override public enumeration string get attribute names throw new runtime exception implemented override public void set attribute string name object object throw new runtime exception implemented override public void remove attribute string name throw new runtime exception implemented override public string get servlet context name throw new runtime exception implemented override public int get effective major version throw new runtime exception implemented override public int get effective minor version throw new runtime exception implemented override public boolean set init parameter string name string value throw new runtime exception implemented override public dynamic add servlet string servlet name string class name throw new runtime exception implemented override public dynamic add servlet string servlet name servlet servlet throw new runtime exception implemented override public dynamic add servlet string servlet name class extends servlet servlet class throw new runtime exception implemented override public extends servlet create servlet class throws servlet exception throw new runtime exception implemented override public servlet registration get servlet registration string servlet name throw new runtime exception implemented override public map string extends servlet registration get servlet throw new runtime exception implemented override public javax servlet filter registration dynamic add filter string filter name string class name throw new runtime exception implemented override public javax servlet filter registration dynamic add filter string filter name filter filter throw new runtime exception implemented override public javax servlet filter registration dynamic add filter string filter name class extends filter filter class throw new runtime exception implemented override public extends filter create filter class throws servlet exception throw new runtime exception implemented override public filter registration get filter registration string filter name throw new runtime exception implemented override public map string extends filter registration get filter throw new runtime exception implemented override public session cookie config get session cookie config throw new runtime exception implemented override public void set session tracking modes set session tracking mode session tracking modes throw new runtime exception implemented override public set session tracking mode get default session tracking modes throw new runtime exception implemented override public set session tracking mode get effective session tracking modes throw new runtime exception implemented override public void add listener string class name throw new runtime exception implemented override public extends event listener void add listener throw new runtime exception implemented override public void add listener class extends event listener listener class throw new runtime exception implemented override public extends event listener create listener class throws servlet exception throw new runtime exception implemented override public jsp config descriptor get jsp config descriptor throw new runtime exception implemented override public class loader get class loader throw new runtime exception implemented override public void declare roles string role names throw new runtime exception implemented override public string get virtual server name throw new runtime exception implemented subsection name introduction filter w3c cors cross origin resource sharing href http www w3 org tr cors which mechanism enables cross origin requests filter works adding required code access control code headers http servlet response object filter also protects against http response splitting request invalid permitted request rejected http status code 403 forbidden href images cors flowchart png flowchart demonstrates request processing filter available minimal required use filter source lt filter name gt corsfilter lt filter name gt lt filter class gt org apache catalina filters corsfilter lt filter class gt lt filter name corsfilter lt filter name gt lt url pattern lt url pattern gt source subsection subsection name filter class name filter class name cors filter strong code org apache catalina filters corsfilter code strong subsection subsection name parameters cors filter supports following parameters attributes attribute name cors allowed origins required false list href http tools ietf org html rfc6454 origins allowed access resource code code can specified enable access resource from any origin otherwise whitelist comma separated origins can provided eg http www w3 org https www apache org strong defaults strong code code any origin allowed access resource attribute attribute name cors allowed methods required false comma separated list http methods can used access resource using cross origin requests methods which also included part access control allow methods header pre flight response eg code get post code strong defaults strong code get post head options code attribute attribute name cors allowed headers required false comma separated list request headers can used when making actual request header also returned part code access control allow headers code header pre flight response eg code origin accept code strong defaults strong code origin accept requested content type access control request method access control request headers code attribute attribute name cors exposed headers required false comma separated list headers other than simple response headers browsers allowed access headers which also included part access control expose headers header pre flight response eg code custom header ping custom header pong code strong default strong none non simple headers exposed default attribute attribute name cors preflight maxage required false amount seconds browser allowed cache result pre flight request included part code access control max age code header pre flight response negative value prevent cors filter from adding response header from pre flight response strong defaults strong code 1800 code attribute attribute name cors support credentials required false flag indicates whether resource supports user credentials flag exposed part code access control allow credentials code header pre flight response helps browser determine whether actual request can made using credentials strong defaults strong code true code attribute attribute name cors request decorate required false flag control cors specific attributes should added http servlet request object strong defaults strong code true code attribute attributes here example more advanced overrides defaults source lt filter name gt corsfilter lt filter name gt lt filter class gt org apache catalina filters corsfilter lt filter class gt lt init param gt lt param name gt cors allowed origins lt param name gt lt param value gt lt param value gt lt init param gt lt init param gt lt param name gt cors allowed methods lt param name gt lt param value gt get post head options put lt param value gt lt init param gt lt init param gt lt param name gt cors allowed headers lt param name gt lt param value gt content type requested accept origin access control request method access control request headers lt param value gt lt init param gt lt init param gt lt param name gt cors exposed headers lt param name gt lt param value gt access control allow origin access control allow credentials lt param value gt lt init param gt lt init param gt lt param name gt cors support credentials lt param name gt lt param value gt true lt param value gt lt init param gt lt init param gt lt param name gt cors preflight maxage lt param name gt lt param value gt 10 lt param value gt lt init param gt lt filter name gt cors filter lt filter name gt lt url pattern gt lt url pattern gt source subsection subsection name cors filter http servlet request attributes cors filter adds information about request http servlet request object consumption downstream following attributes set code cors request decorate code parameter code true code ul li strong cors cors request strong flag determine request cors request li li strong cors request origin strong origin url url page from where request originated li li strong cors request type strong type cors request possible values ul li code simple code request which preceded pre flight request li li code actual code request which preceded pre flight request li li code pre flight code pre flight request li li code cors code normal same origin request li li code invalid cors code cross origin request which invalid li ul li li strong cors request headers strong request headers sent access control request headers header pre flight request li ul subsection subsection name introduction filter triggers parameters parsing request rejects request some parameters were skipped during parameter parsing because parsing errors request size limitations code max parameter count code attribute href http html connector filter can used ensure none parameter values submitted client lost note parameter parsing may consume body http request so caution needed servlet protected filter uses code request get input stream code code request get reader code calls general risk breaking web application adding filter so high because parameter parsing does check content type request before consuming request body note post requests parsed correctly code set character encoding filter code filter must configured above one see character encoding page faq details request rejected http status code 400 bad request subsection subsection name filter class name filter class name failed request filter strong code org apache catalina filters failed request filter code strong subsection subsection name parameters failed request filter does support any parameters subsection
string builder sb create query string deploy
request remove note constants req ssoid note
private handshake status handshake status private status result status	handshake status ssl engine get handshake status result status status ok	check result true	socket read buffer position result status status buffer underflow	check result false	private void check result sslengine result result boolean wrap throws sslexception handshake status result get handshake status result status result get status result status status ok wrap result status status buffer underflow
application part part new application part item location	private final file location public application part file item file item file location location location	file new file location file name
class plugin class ctxt get class loader load class plugin class str
-1
private boolean compress false	spdy context set tls comprression false compress	public boolean compress return compress public void set compress boolean compress compress compress add experimental support sdpy includes from sheldon shao costin add
mark current buffer position parsing request line phase	public static final string cr public static final string lf public static final string crlf cr lf	test case https issues apache org bugzilla show bug cgi id 54947 test public void test bug54947 client new client do request assert true client response200 assert true client response body ok bug 54947 test client private class extends simple http client private exception do request tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root bug54947 new tester servlet root add servlet mapping test bug54947 try tomcat start set port tomcat get connector get local port open connection connect string request new string request get http localhost 8080 test http cr request lf connection close crlf crlf set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok get response body null return false get response body contains ok return false return true
test form sessions do do use cookies client can accept respond set cookie jsessionid able maintain its session matter whether session id changed once many times all client cannot accept cookies only able maintain persistent session server sends correct current jsessionid path parameter appended all urls within its response achievable servlets jsps jstl all which which can ask encoded url inserted dynamic web page cannot work static html note test class uses tomcat somaple jsps which conform therefore any webapp might need authenticate client does accept cookies must generate every protected resource url dynamically so include current session id any webapp cannot satify case must turn off change session id its context thus degrade session fixation protection all its clients note from mark sure agree urls aren being encoded session going break regardless whether session id changes unlike proper browser unit test class does quite lot screen scraping cheating headers urls very elegant makes claims generality should really singletons type safe we unit test don need paranoid protected static final boolean use 100 continue true protected static final boolean 100 continue use 100 continue protected static final boolean client use cookies true protected static final boolean client cookies client use cookies protected static final boolean server use cookies true protected static final boolean server cookies server use cookies protected static final boolean server change sessid true protected static final boolean server freeze sessid server change sessid minimum session timeout private static final int timeout mins private static final long timeout delay msecs timeout mins 60 10 1000 private form auth client client first set tests where server uses cookie carry current session id during after client prepared return cookies each request public void test get cookies throws exception do test get get 100 continue client use cookies server use cookies server change sessid public void test post continue cookies throws exception do test post get 100 continue client use cookies server use cookies server change sessid public void test post continue cookies throws exception do test post get use 100 continue client use cookies server use cookies server change sessid public void test post continue post redirect cookies throws exception do test post post 100 continue client use cookies server use cookies server change sessid public void test post continue post redirect cookies throws exception do test post post use 100 continue client use cookies server use cookies server change sessid next set tests where server context configured never use cookies session id only carried url path parameter bug 53584 test public void test get server cookies throws exception do test get get 100 continue client cookies server cookies server change sessid test public void test post continue server cookies throws exception do test post get 100 continue client use cookies server cookies server change sessid test public void test post continue server cookies throws exception do test post get use 100 continue client use cookies server cookies server change sessid variant bug 49779 test public void test post continue post redirect server cookies throws exception do test post post 100 continue client use cookies server cookies server change sessid variant bug 49779 test public void test post continue post redirect server cookies throws exception do test post post use 100 continue client use cookies server cookies server change sessid next set tests where server context uses cookies client refuses return them tries use session id carried url path parameter test public void test get client cookies throws exception do test get get 100 continue client cookies server use cookies server change sessid test public void test post continue client cookies throws exception do test post get 100 continue client cookies server use cookies server change sessid test public void test post continue client cookies throws exception do test post get use 100 continue client cookies server use cookies server change sessid variant bug 49779 test public void test post continue post redirect client cookies throws exception do test post post 100 continue client cookies server use cookies server change sessid variant bug 49779 test public void test post continue post redirect client cookies throws exception do test post post use 100 continue client cookies server use cookies server change sessid finally set tests explore quirky situations need replicate all scenarios above test public void test changed sessid cookies throws exception do test get get 100 continue client use cookies server use cookies server freeze sessid test public void test changed sessid without cookies throws exception do test get get 100 continue client cookies server use cookies server freeze sessid test public void test timeout without cookies throws exception string protected uri do test get get 100 continue client cookies server use cookies server freeze sessid wait long enough my session expire thread sleep timeout delay msecs try continue using expired session get protected resource once more should get login challenge timeout status 408 do test protected get protected uri 100 continue form auth client login required choreograph steps test dialogue server while try access protected resource respond login challenge good credentials after successful login follow redirect original page repeatedly access protected resource demonstrate persistence session param resource method http method accessing protected resource param redirect method http method login form reply param use continue whether http client should expect 100 continue param client should use cookies whether client should send cookies param server use cookies whether server should send cookies private string do test string resource method string redirect method boolean use continue boolean client should use cookies boolean server use cookies boolean server change sessid throws exception client new form auth client client should use cookies server use cookies server change sessid first request protected resource gets login page client do resource request resource method false null null string login uri client extract body uri form auth client login param tag form auth client login resource string original session id null server use cookies client should use cookies original session id client get session id else original session id client extract path session id login uri second request replies login challenge client do login request login uri assert true login failed client get response line client response302 string redirect uri client get redirect uri third request login successful so follow redirect protected resource client do resource request redirect method true redirect uri null string protected uri client extract body uri form auth client resource param tag form auth client protected resource string new session id null server use cookies client should use cookies new session id client get session id else new session id client extract path session id protected uri boolean session id changed original session id equals new session id assert true session id changed server change sessid subsequent requests keep accessing protected resource do test protected resource method protected uri use continue form auth client login successful return protected uri case more requests issued repeatedly access protected resource after client has successfully logged webapp current session attributes used cannot changed after successful login follow redirect original page repeatedly access protected resource demonstrate persistence session param resource method http method accessing protected resource param protected uri access withour sessionid param use continue whether http client should expect 100 continue param client should use cookies whether client should send cookies param server use cookies whether server should send cookies private void do test protected string resource method string protected uri boolean use continue int phase int repeat count throws exception subsequent requests keep accessing protected resource int repeat count client do resource request resource method false protected uri null assert true client response body ok phase encapsulate logic needed run suitably configured tomcat instance send http request process server response protected static final string login param tag action protected static final string login resource security check protected static final string login reply username tomcat password tomcat protected static final string protected relative path examples jsp security protected protected static final string protected resource index jsp private static final string protected resource url protected relative path protected resource protected static final string resource param tag href private static final char param delim primitive tracking test phases verify html body protected static final int login required protected static final int redirecting protected static final int login successful todo forgot change making up again protected final string session parameter start session parameter name private form auth client boolean client should use cookies boolean server should use cookies boolean server should change sessid throws exception set use cookies client should use cookies ctx set cookies server should use cookies	perhaps does work until tomcat has started ctx set session timeout timeout mins valve pipeline only established after tomcat starts valve valves ctx get pipeline get valves valve valve valves valve instanceof base base valve set change session id server should change sessid break private void do login request string login uri throws exception do resource request post true protected relative path login uri login reply prepare resource request http headers issue request three kinds uri supported fully qualified uri minimal uri without webapp path null use default protected resource cookies sent available supported test otherwise caller expected have provided session id path parameter private void do resource request string method boolean full qual uri string resource uri string request tail throws exception build http request while assembling uri request head append method append full qual uri request head append resource uri else resource uri null default relative url request head append protected resource url else request head append protected relative path append resource uri get equals method request head append role bar next add constant http headers any optional http headers get use cookies string session id get session id session id null request head append cookie append session cookie name append append session id append crlf finally posts only deal request content request tail null request tail role bar calculate post data length string len integer string request tail length request head append content length append len append crlf always put empty line after headers request request tail verify server response html body page we expect based dialogue position within do test return response body ok request count verify server response html body page we expect based dialogue position given caller public boolean response body ok int test phase switch test phase case login required first request should return login page assert contains get response body title login page examples title return true case redirecting second request should result redirect without body return true default subsequent requests should return protected page our role parameter should appear page string body get response body assert contains body title protected page examples title assert contains body input type text name role value bar return true scan server response body extract given url including any path elements private string extract body uri string param tag string resource extract uri elements list string elements get response body uri elements string full path null string element elements int ix element index param tag ix ix param tag length char delim element char ix int iy element index resource ix iy int last char ix element index delim iy full path element substring iy last char ix remove any trailing parameters int param delim full path index param delim param delim full path full path substring param delim break return full path extract session id path element exists given url private string extract path session id string url string session id null int start url index session parameter start start start session parameter start length string remainder url substring start string tokenizer parser new string tokenizer remainder session path parameter tails parser has more elements session id parser next token else session id url substring start return session id fail response number request count body check failure
public abstract output buffer cause loading constants int foo constants http 11 bytes
enc null encoding parameters default encoding else encoding enc	http conn get connection http localhost get port	http conn get connection http localhost get port	test public void test bug54984 throws exception tomcat tomcat get tomcat instance context root tomcat add context system get property java io tmpdir root set allow casual multipart parsing true tomcat add servlet root bug54984 new root add servlet mapping bug54984 tomcat start http conn get connection http localhost get port parse parameters before parse parts prepare request bug54984 conn check response bug54984 conn conn disconnect conn get connection http localhost get port prepare request bug54984 conn check response bug54984 conn conn disconnect	private http get connection string query throws ioexception	private static class extends http servlet private static final long serial version uid 1l override protected void do post http servlet request req http servlet response resp throws servlet exception ioexception req set character encoding utf req get request uri ends parse parameters before parse parts req get parameter names req get part part resp get writer println part req get parameter part private void prepare request bug54984 http conn throws exception string boundary system current time millis conn set request property content type multipart form data boundary boundary print writer writer null try writer new print writer new output stream writer conn get output stream utf true writer append boundary append writer append content disposition form data name part writer append content type text plain charset utf writer append writer append append writer flush writer append writer flush writer append boundary append finally writer null writer close private void check response bug54984 http conn throws exception list string response new array list int status conn get response code status http http ok buffered reader reader null try reader new buffered reader new input stream reader conn get input stream string line null while line reader read line null response add line assert true response contains part catch exception reader null reader close else fail ok status expected status
test public void test bug54928 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async servlet servlet new async servlet wrapper tomcat add servlet ctx async servlet set async supported true ctx add servlet mapping async async tomcat start simple http client client new simple http client override public boolean response body ok return true string request get async http simple http client crlf host simple http client crlf simple http client crlf client set port get port client set request new string request client connect client send request int 10 system out println client read line client disconnect wait server thread stop while servlet get thread alive thread sleep 250 private static class async servlet extends http servlet private static final long serial version uid 1l hack won work generally servlets expected handle more than one request private thread public thread get thread return override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp set character encoding utf final output stream os resp get output stream final async context async ctxt req start async async ctxt set timeout 3000 new thread new runnable override public void run while true try os write test get bytes b2cconverter utf os flush thread sleep 1000 catch exception async ctxt complete break set name test bug54928 start
string name path length special case context root mapping which treated exact match name else name path
jsp config descriptor jsp config descriptor context get jsp config descriptor jsp config descriptor get jsp property groups empty jsp config descriptor get taglibs empty return null else return jsp config descriptor	test public void test get jsp config descriptor throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context standard context standard context tomcat add webapp null test app dir get absolute path servlet context servlet context standard context get servlet context assert assert null servlet context get jsp config descriptor tomcat start assert assert null servlet context get jsp config descriptor
session cookie config new application session cookie config context	private session cookie config session cookie config	string manager package private static final string manager sm string manager get manager constants package	private standard context context public application session cookie config standard context context context context	context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise comment context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise domain name context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise http only context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise max age context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise name context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise path context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise secure context get path licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private application session cookie config application session cookie config private final custom context context new custom context before public void set up throws exception application session cookie config new application session cookie config context test public void test set comment init phase context set state lifecycle state starting prep application session cookie config set comment test assert true application session cookie config get comment equals test test expected illegal state exception class public void test set comment init phase context set state lifecycle state started application session cookie config set comment test test public void test set domain init phase context set state lifecycle state starting prep application session cookie config set domain test assert true application session cookie config get domain equals test test expected illegal state exception class public void test set domain init phase context set state lifecycle state started application session cookie config set domain test test public void test set http only init phase context set state lifecycle state starting prep application session cookie config set http only true assert true application session cookie config http only test expected illegal state exception class public void test set http only init phase context set state lifecycle state started application session cookie config set http only true test public void test set max age init phase context set state lifecycle state starting prep application session cookie config set max age assert true application session cookie config get max age test expected illegal state exception class public void test set max age init phase context set state lifecycle state started application session cookie config set max age test public void test set name init phase context set state lifecycle state starting prep application session cookie config set name test assert true application session cookie config get name equals test test expected illegal state exception class public void test set name init phase context set state lifecycle state started application session cookie config set name test test public void test set path init phase context set state lifecycle state starting prep application session cookie config set path test assert true application session cookie config get path equals test test expected illegal state exception class public void test set path init phase context set state lifecycle state started application session cookie config set path test test public void test set secure init phase context set state lifecycle state starting prep application session cookie config set secure true assert true application session cookie config secure test expected illegal state exception class public void test set secure init phase context set state lifecycle state started application session cookie config set secure true private static class custom context extends standard context private lifecycle state state override public lifecycle state get state return state override public synchronized void set state lifecycle state state state state
skip any lws return next char private static int skip lws string reader input boolean reset throws ioexception reset input mark while 32 10 13 reset input mark reset input reset return private static skip constant result skip constant string reader input string constant throws ioexception int len constant length int skip lws input false	int skip lws input false	int skip lws input false	go back so first non lws character available read again int skip lws input true	int skip lws input false	int skip lws input false	private static final string lws values new string	string lws lws values do test lws parameters private void do test string lws parameter parameters throws ioexception sb append string lws	return string public string string string lws sb append lws sb append lws sb append lws sb append lws sb append lws
try while iter has next object entry iter next loaded child entry return true catch concurrent modification exception log warn sm get string webapp class loader clazz get name get context name
check see web socket has matching mapping ws server container sc ws server container get server container string path string path info req get path info path info null path req get servlet path else path req get servlet path path info ws mapping result mapping result sc find mapping path mapping result null endpoint registered requested path let application handle might redirect forward example chain do filter request response return validate rest headers reject request validation fails
string ctxt generate java source else items instanceof string ctxt generate java source iter iterator new string tokenizer string items	test public void test bug54888 throws exception byte chunk res new byte chunk int rc get url http localhost get port test bug5nnnn bug54888 jsp res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok assert assert true body contains ok assert assert true body contains ok	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license page encoding iso 8859 session true import java io reader java io string reader body each items var foo ok foo each body
tag dependent nesting page info elignored current instanceof node scripting element	assert assert equals http servlet response sc internal server error rc	assert assert null test public void test bug54801 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug5nnnn bug54801a jspx bc null assert assert equals http servlet response sc ok rc bc recycle rc get url http localhost get port test bug5nnnn bug54801b jspx bc null assert assert equals http servlet response sc ok rc test public void test bug54821 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug5nnnn bug54821a jspx bc null assert assert equals http servlet response sc ok rc bc recycle rc get url http localhost get port test bug5nnnn bug54821b jspx bc null assert assert equals http servlet response sc ok rc	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license foo out println hello world	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license foo out println hello world	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
catch throwable exception utils handle throwable listener get class get name	catch throwable exception utils handle throwable listener get class get name	catch throwable exception utils handle throwable listener get class get name	catch throwable t2 exception utils handle throwable listener get class get name t2	private int status	test public void test bug54178 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path new wrapper wrapper tomcat add servlet ctx wrapper set async supported true ctx add servlet mapping new tomcat add servlet ctx ctx add servlet mapping tomcat start byte chunk body new byte chunk int rc try rc get url http localhost get port param name bar body null catch ioexception ioe may happen test fails output exception case useful let asserts handle failure ioe print stack trace assert equals http servlet response sc ok rc body recycle rc get url http localhost get port body null assert equals http servlet response sc ok rc assert equals ok body string private static class extends http servlet public static final string param name foo private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception req get parameter param name async context actxt req start async actxt add listener new listener actxt complete private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain print writer pw resp get writer string result req get parameter param name result null pw write ok else pw write fail private static class listener implements async listener override public void complete async event event throws ioexception throw new runtime exception testing bug54178 override public void timeout async event event throws ioexception op override public void error async event event throws ioexception op override public void start async async event event throws ioexception op
string temp get base name
http request includes valid upgrade request	mapping result null endpoint registered requested path let application handle might redirect forward example chain do filter request response return	enum set dispatcher type types enum set dispatcher type request dispatcher type forward fr add mapping url patterns types false	template matches null templates equal number segments so matches return null
-1
private static final asynchronous channel group asynchronous channel group static asynchronous channel group result null need do right thread context class loader else first web app call trigger leak class loader original thread current thread get context class loader try thread current thread set context class loader async iothread factory class get class loader same settings default asynchronous channel group int initial size runtime get runtime available processors executor service executor service new thread pool executor integer max value long max value time unit milliseconds new synchronous queue runnable new async iothread factory try result asynchronous channel group cached thread pool executor service initial size catch ioexception good reason happen throw new illegal state exception sm get string ws web socket container asynchronous channel group fail finally thread current thread set context class loader original asynchronous channel group result	socket channel asynchronous socket channel open asynchronous channel group throw new deployment exception sm get string ws web socket container asynchronous socket channel fail ioe	throw new deployment exception sm get string ws web socket container ssl engine fail	create threads async io have right context class loader prevent memory leaks private static class async iothread factory implements thread factory private atomic integer count new atomic integer override public thread new thread runnable thread new thread set name web socket client async io count increment get set context class loader get class get class loader set daemon true return
template matches new tree set template path match comparator get instance	template matches new tree set template path match comparator get instance	comparator thread safe so only create single instance private static final template path match comparator instance new template path match comparator public static template path match comparator get instance return instance private template path match comparator hide default constructor	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test bug54807 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener class get name tomcat add servlet ctx default new default servlet ctx add servlet mapping default tomcat start assert assert equals lifecycle state started ctx get state public static class extends ws listener override public void context initialized servlet context event sce super context initialized sce ws server container sc ws server container get server container server endpoint config sec server endpoint config builder create tester echo server basic class param build try sc add endpoint sec catch deployment exception throw new runtime exception
request unparsed uri set bytes frame data frame off value len int question pos int end frame off value len int frame off end frame data question pos question pos request query string set bytes frame data question pos end question pos request request uri set bytes frame data frame off question pos frame off else request request uri set bytes frame data frame off value len
else web xml normal folder impact fragment set true
ep endpoint sec get configurator get endpoint instance sec get endpoint class catch exception
private volatile boolean open true	close frame has been received further data should have seen open throw new ioexception sm get string ws frame closed	open false	protected boolean open return open	open channel read response null handler	while open sis ready
closed true delegate null	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interceptor counts opened statements used tests private final atomic integer count open new atomic integer private final atomic integer count closed new atomic integer public int get active count return count open get count closed get override protected object create decorator object proxy method method object args object statement constructor constructor string sql throws exception illegal access exception invocation target exception object result statement proxy statement proxy new statement proxy statement statement sql result constructor new instance new object statement proxy statement proxy set actual proxy result statement proxy set connection proxy statement proxy set constructor constructor count open increment get return result private class statement proxy extends statement decorator interceptor statement proxy statement public statement proxy statement delegate string sql super delegate sql override public void close invoked count closed increment get super close invoked	public void test statement close1 throws exception init datasource set jdbc interceptors test statement cache interceptor class get name prepared true callable false max statement counter interceptor class get name connection con datasource get connection statement counter interceptor counter find interceptor con statement counter interceptor class prepared statement ps1 ps2 ps1 con prepare statement select assert assert equals counter get active count ps1 close assert assert equals statement goes cache closed counter get active count ps1 con prepare statement select assert assert equals reusing statement from cache counter get active count ps2 con prepare statement select assert assert equals reusing statement from cache counter get active count ps2 close assert assert equals statement goes cache closed counter get active count ps1 close cache has max following tests bz 54732 assert assert equals statement does go cache closed counter get active count con close assert assert equals connection returned pool statement cache counter get active count datasource close assert assert equals pool cleared all statements cache closed counter get active count test public void test statement close2 throws exception init datasource set jdbc interceptors test statement cache interceptor class get name prepared false callable false max 10 statement counter interceptor class get name connection con datasource get connection statement counter interceptor counter find interceptor con statement counter interceptor class prepared statement ps1 con prepare statement select assert assert equals counter get active count ps1 close assert assert equals statement pooled closes immediately counter get active count test	helper method finds interceptor instance interceptor chain proxied class param proxy proxy class param clazz interceptor class we looking return instance code clazz code private static extends jdbc interceptor find interceptor object proxy class clazz jdbc interceptor interceptor jdbc interceptor proxy get invocation handler proxy while interceptor null clazz instance interceptor return clazz cast interceptor interceptor interceptor get next return null
string field fields string name prefix field substring upper case locale english field substring buf append field data source factory prop password equals field buf append else buf append invoke new object shouldn happen log debug string call failed
check state	check state	check state	check state	check state check state check state check state	check state check state check state check state check state check state check state check state check state	fire endpoint close close reason	fire endpoint close close reason	private void fire endpoint close close reason close reason fire close event thread thread current thread class loader cl get context class loader set context class loader application class loader try local endpoint close close reason finally set context class loader cl	check state check state check state check state check state	check state	private void check state open throw new illegal state exception sm get string ws session closed	boolean open true while open count open false session session set session open open true open session session set session open system err println session id session get id open assert fail were open sessions	assert assert equals expected get open count set while get open count set expected count assert assert equals get open count set private int get open count set session sessions int result session session sessions session open result return result
try writer get send writer encoder text stream encoder encode obj completion result new send result try output stream os get send stream encoder binary stream encoder encode obj os completion result new send result
method mapping get close args path parameters session close reason	protected final boolean convert session session object params int index payload boolean convert convert convert	boolean convert int index boolean int index session super pojo method session params index payload convert	convert	session session object params int index payload boolean convert super pojo method session params index payload convert index boolean	session session object params int index payload boolean convert super pojo method session params index payload convert index boolean	boolean convert int index session super pojo method session params index payload convert	decoded convert required convert payload convert message	protected object convert message return message	private final boolean input stream int index payload boolean convert int index session boolean input stream super pojo method session params index payload convert index session else binary stream class assignable from decoder clazz	input stream input stream	protected object convert byte buffer message byte array new byte message remaining message get array input stream return new byte array input stream array else return array override	session session object params int index payload boolean convert super pojo method session params index payload convert index session	int index payload boolean convert int index session super pojo method session params index payload convert	else text stream class assignable from decoder clazz	protected object convert string message return new string reader message override	open params get path params open false false close params get path params close false true error params get path params error true false	return build args open params path parameters session null null	session session close reason close reason return build args close params path parameters session null close reason	return build args error params path parameters session throwable null	private static pojo path param get path params method boolean error boolean close	else close type equals close reason class result new pojo path param type null	throwable throwable close reason close reason	else type equals close reason class result close reason	private int index input stream private int index reader	else types reader class index reader index reader else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name	else types input stream class index input stream index input stream else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name	index reader index payload throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name else index payload index reader	index input stream index payload throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name else index payload index input stream	index reader index boolean throw new illegal argument exception sm get string pojo method mapping partial reader get name get class get name index input stream index boolean throw new illegal argument exception sm get string pojo method mapping partial input stream get name get class get name	config params index byte array true index session false index session false else index input stream mh new pojo message handler whole binary pojo session config params index input stream true index session true else index reader mh new pojo message handler whole text pojo session config params index reader true index session
ws equals ignore case scheme wss equals ignore case scheme	ws equals ignore case scheme	uri uri new uri ws localhost get port	new uri ws localhost get port	new uri ws tester echo server config path async	new uri ws localhost get port	new uri ws localhost get port blocking config path	new uri ws localhost get port	new uri ws localhost get port	uri uri new uri ws localhost get port	uri uri new uri ws localhost get port param one
uriencoding lower uriencoding lower case locale english	charset name lower case locale english charset alias lower case locale english charset	string lower case enc enc lower case locale english	integer type field types get field lower case locale english	parameters put attribute lower case locale english value parameters put attribute lower case locale english	return parameters get parameter lower case locale english	string name prefix fields substring upper case locale english	session cookie name lower case locale english licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final string param one abcde private static final string param two 12345 private static final string param three true test public void test throws exception set up utility classes server server new server singleton configurator set instance server server config listener set pojo clazz server class tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener server config listener class get name web socket container ws container container provider get web socket container tomcat start client client new client uri uri new uri http localhost get port param one param two param three session session ws container connect server client uri session get basic remote send text op session close give server 5s close int count while count 50 server closed break count thread sleep 100 count 50 assert fail server did process close event within seconds client sending close message check errors list string errors server get errors string error errors system err println error assert assert equals found errors errors size client endpoint public static final class client server endpoint value one two three configurator singleton configurator class public static final class server private final list string errors new array list private volatile boolean closed open public void open path param one string p1 path param two int p2 path param three boolean p3 check params open p1 p2 p3 message public void message suppress warnings unused string msg path param one string p1 path param two int p2 path param three boolean p3 check params message p1 p2 p3 close public void close path param one string p1 path param two int p2 path param three boolean p3 check params close p1 p2 p3 closed true public list string get errors return errors public boolean closed return closed private void check params string method string p1 int p2 boolean p3 check param method param one p1 check param method param two integer string p2 check param method param three boolean string p3 private void check param string method string expected string actual expected equals actual errors add method method expected expected actual
-1
parses given source stores parsed data given web xml byte stream closed end parse operation param source input source containing xml data parsed param dest object common elements web xml web fragment xml param fragment specifies whether source web fragment xml web xml	input stream source get byte stream null try close catch throwable exception utils handle throwable
part represents uploaded file gets file name submitted upload returns code null file name available part file upload return submitted file name code null public string get submitted file name	part get submitted file name null	calls link get submitted file name deprecated use link get submitted file name from servlet instead deprecated public string get filename return get submitted file name override public string get submitted file name	filename war part get submitted file name
string new format file date format null new format else new format file date format file date format new format synchronized file date formatter new simple date format new format locale us file date formatter set time zone time zone get default	rotate log file necessary public void rotate rotatable only do logfile switch check once second max long systime system current time millis systime rotation last checked 1000 synchronized systime rotation last checked 1000 rotation last checked systime string ts date check change date ts date file date formatter format new date systime date has changed switch log files date stamp equals ts date close true date stamp ts date open	rotate
private static final string default server protocols private static final string deafult server cipher suites	string ciphers null string protocols null string supported ciphers ssf get supported cipher suites string cipher supported ciphers api obtain default server protocols cipher suites having inspected open jdk code same results can achieved via standard api guarantee every jvm determines defaults same way therefore defaults determined creating server socket requested configured values sslserver socket socket sslserver socket ssf create server socket ciphers socket get enabled cipher suites protocols socket get enabled protocols catch ioexception unable determine default ciphers protocols so use none deafult server cipher suites ciphers default server protocols protocols	return deafult server cipher suites	return deafult server cipher suites	return default server protocols
public static server container get server container
output stream write buffer array buffer array offset buffer limit
swallow any request body since we replacing need do before headers restored ajp connector uses content length header determine how much data needs read request body byte buffer new byte 4096 input stream request create input stream while read buffer ignore request body
send any partial data we have do flush false	closed throw new ioexception sm get string outbound closed
writer write usage used usage get used
delegate loader null skip webapp loader now delegation enabled loader loader get parent	delegate delegation enabled go back add webapp paths loader get class loader loader null build class path servlet context classpath loader
else conv recycle
class represents part uploaded server part code multipart form data code request body part may represent either uploaded file form data obtain code input stream code can used retrieve contents file obtain content type passed browser code null code defined obtain name field multipart form part obtain size part convenience method write uploaded part disk client code concerned whether part stored memory disk temporary location just want write uploaded part file method guaranteed succeed called more than once same part allows particular use example file renaming where possible rather than copying all underlying data thus gaining significant performance benefit param file name location which uploaded part should stored relative locations relative link javax servlet multipart config element get location deletes underlying storage part including deleting any associated temporary disk file although storage deleted when part instance garbage collected method can used ensure done earlier time thus preserving system resources obtains value specified part header string multiple headers same name method returns first header part header name case insensitive param name header name return header value code null code header present obtain all values specified part header part did include any headers specified name method returns empty collection header name case insensitive returns collection all header names provided part
changes session id session associated request method does create new session object only changes id current session return new session id allocated session see http session id listener since servlet public string change session id	default behavior method call change session id wrapped request object override public string change session id return get http servlet request change session id	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface notified when link http session id changes receive notification events class must configured deployment descriptor web application annotated link javax servlet annotation web listener registered calling add listener method link javax servlet servlet context see http session event see http servlet request change session id since servlet notification session id has been changed param se notification event param old session id old session id public void session id changed http session event se string old session id	changes session id session associated request return old session id before changed see javax servlet http http session id listener since servlet override public string change session id session session get session internal false session null throw new illegal state exception sm get string coyote request change session id manager manager get context get manager manager change session id session string new session id session get id change session id new session id return new session id	override public string change session id request null throw new illegal state exception sm get string request facade null request return request change session id	instanceof http session id listener	listener instanceof http session id listener	results instanceof http session id listener	notify session listeners replication object listeners get context get application event listeners listeners null listeners length http session event event new http session event session get session object listener listeners listener instanceof http session id listener continue http session id listener id listener http session id listener listener try id listener session id changed event msg get session id catch throwable log error sm get string standard session session event	object listeners context get application event listeners listeners null listeners length http session event event new http session event session get session object listener listeners listener instanceof http session id listener continue http session id listener id listener http session id listener listener try id listener session id changed event old id catch throwable log error sm get string standard session session event	public string change session id return get request change session id override add bug 54552 bug servlet implement code http session id listener code code http servlet request change session id code patch provided nick williams markt add
do nothing report specified status code error message provided	message length return else report sm get string error report valve description	custom error status codes should result blank response test public void test bug54536 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54536 new ctx add servlet mapping bug54536 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert equals error status rc string body res string assert assert null body assert assert true body body contains error message private static final class extends http servlet private static final long serial version uid 1l private static final int error status 999 private static final string error message sky falling override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp send error error status error message licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license defines interface expression language interpreter allows users provide custom el interpreter can optimise el processing application example performing code generation simple expressions returns string representing code inserted servlet generated jsp default creates call link org apache jasper runtime page context impl proprietary evaluate string class javax servlet jsp page context org apache jasper runtime protected function mapper boolean other may produce more optimised code param expression string containing zero more expressions param expected type expected type interpreted result param fnmapvar variable pointing function map param xml escape true result should do xml escaping return string representing call el interpreter public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides link instances jsp compilation search order follows ol li instance class name provided servlet context attribute li li class named servlet context parameter li li default li ol public static final string el interpreter class name class get name private static final default instance new default obtain correct el interpreter given web application public static get servlet context context throws exception result null search servlet context attribute set application cached previous call method object attribute context get attribute el interpreter class name attribute instanceof return attribute else attribute instanceof string result create instance context string attribute servlet context init parameter result null string class name context get init parameter el interpreter class name class name null result create instance context class name default result null result default instance cache result next time context set attribute el interpreter class name result return result private static create instance servlet context context string class name throws exception return context get class loader load class class name new instance private factory utility class hide default constructor public static class default implements override public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape return jsp util interpreter call tag file expression expected type fnmapvar xml escape
private final el interpreter	el interpreter interpreter call ctxt tag file expected type attr get el get map name false	el interpreter interpreter call ctxt tag file get type get text string class get el get map name false	attr value el interpreter interpreter call ctxt tag file attr value map name false	generator servlet writer out compiler compiler throws jasper exception	el interpreter null try el interpreter factory get compiler get compilation context get servlet context catch exception err jsp error jsp error el interpreter class get message el interpreter el interpreter licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static class simple implements override public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape return expression test public void test bug54239 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp context ctx tomcat add webapp null test app dir get absolute path tomcat start servlet context context ctx get servlet context interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof default context remove attribute class get name context set attribute class get name simple class get name interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple context remove attribute class get name simple simple interpreter new simple context set attribute class get name simple interpreter interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple assert assert true interpreter simple interpreter context remove attribute class get name context set init parameter class get name simple class get name interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple context remove attribute class get name
read bytes throw new ioexception unexpected end stream whilst reading request body	handle optional trailer headers
last timestamp used generate nonce each nonce should get unique timestamp protected long last timestamp protected final object last timestamp lock new object	synchronized last timestamp lock current time last timestamp last timestamp current time else current time last timestamp	test public void bug54521 throws lifecycle exception digest digest new digest digest set container new tester context digest start request request new tester request final int count 1000 set string nonces new hash set int count nonces add digest generate nonce request assert assert equals count nonces size	private static class tester request extends request override public string get remote addr return 127
make sure servlet loaded right class loader class loader old thread current thread get context class loader class loader webapp class loader context get parent get loader get class loader thread current thread set context class loader webapp class loader finally thread current thread set context class loader old return single thread model
socket poller protected async timeout async timeout null public async timeout get async timeout return async timeout	async timeout new async timeout thread timeout thread new thread async timeout	poller stop async timeout stop	private volatile boolean async timeout running true	while async timeout running	while paused async timeout running	protected void stop async timeout running false	private volatile boolean poller running true	protected void stop poller running false	notify	destroy socket desc true	while poller running	while poller running connection count add list size get so timeout poller running	get so timeout maintain 1000 poller running	private volatile boolean sendfile running true	sendfile running false	while sendfile running	maintain time 1000000l sendfile running
catch throwable exception utils handle throwable log warn sm get string webapp class loader check thread locals leaks fail get context name
string builder buf new string builder get class get name buf append get name append
private servlet context servlet context null private elcontext el context null private page context root jsp ctxt jsp context instanceof jsp context wrapper root jsp ctxt jsp context wrapper jsp context root jsp ctxt else root jsp ctxt invoking jsp ctxt	return root jsp ctxt get attribute name scope	root jsp ctxt set attribute name value scope	root jsp ctxt get attribute name request scope root jsp ctxt get attribute name session scope root jsp ctxt get attribute name application scope	root jsp ctxt remove attribute name request scope root jsp ctxt remove attribute name session scope root jsp ctxt remove attribute name application scope	root jsp ctxt remove attribute name scope	return root jsp ctxt get attributes scope name	return root jsp ctxt get attribute names scope scope	return root jsp ctxt get out return root jsp ctxt get session	return root jsp ctxt get response	servlet context null servlet context root jsp ctxt get servlet context return servlet context	el context null el context root jsp ctxt get elcontext return el context
param destination member destination length	param destination member destination length
integer value details get java line number details get java file name
username	username	sm get string data source realm get roles exception username	username
injections get field name continue	public void test throws exception	assert page contains test test servlet env entry1 env entry2 env entry3 33 env entry4	private int env entry1 private int env entry2 private int env entry3 private int env entry4 resp get writer print env entry1 env entry1 resp get writer print env entry2 env entry2 resp get writer print env entry3 env entry3 resp get writer print env entry4 env entry4 public void set env entry2 int env entry2 env entry2 env entry2 resource mapped name public void set env entry3 int env entry3 env entry3 env entry3 resource mapped name public void set env entry4 int env entry4 env entry4 env entry4 env entry env entry name env entry2 env entry name env entry type java lang integer env entry type env entry value env entry value injection target injection target class org apache catalina startup tester servlet annotations injection target class injection target name env entry2 injection target name injection target env entry env entry env entry name env entry3 env entry name env entry type java lang integer env entry type env entry value 33 env entry value injection target injection target class org apache catalina startup tester servlet annotations injection target class injection target name env entry3 injection target name injection target env entry
target type convert primitive type target type	class default type field get type	class default type method get parameter types	string default name class default type	private static string get type resource annotation class default type class type annotation type type null type equals object class return convert primitive type type get canonical name	converts primitive type its wrapper param clazz class evaluated return parameter primitive type returns its wrapper otherwise returns same class public static class convert primitive type class clazz clazz equals char class return character class else clazz equals int class return integer class else clazz equals boolean class return boolean class else clazz equals double class return double class else clazz equals byte class return byte class else clazz equals short class return short class else clazz equals long class return long class else clazz equals float class return float class else return clazz	test public void test bug54448 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments context context tomcat add webapp null test app dir get absolute path tomcat add servlet context test servlet org apache catalina startup tester servlet annotations context add servlet mapping test servlet test servlet tomcat enable naming tomcat start assert page contains test test servlet env entry	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l resource mapped name private int env entry override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print env entry env entry
disable ssl compression public boolean get ssldisable compression return apr endpoint endpoint get ssldisable compression public void set ssldisable compression boolean disable apr endpoint endpoint set ssldisable compression disable	don use compression even supported public static final int ssl op compression 0x00020000	return true all requested ssl op supported open ssl note versions tcnative lt 25 method return code true code only code op code link ssl op allow unsafe legacy tcnative supports flag param bitwise all ssl op test return true all ssl op supported open ssl library	disables compression ssl stream thwarts crime attack possibly improves performance compressing content jpeg etc protected boolean ssldisable compression false set code true code disable ssl compression thwarts crime attack public void set ssldisable compression boolean ssldisable compression ssldisable compression ssldisable compression public boolean get ssldisable compression return ssldisable compression	disable compression requested ssldisable compression boolean disable compression supported false try disable compression supported ssl has op ssl ssl op compression disable compression supported sslcontext set options ssl context ssl ssl op compression catch unsatisfied link error ignore disable compression supported open ssl does support ciphers ordering log warn sm get string endpoint warn disable compression ssl version string attribute name ssldisable compression required false disables compression set code true code open ssl supports disabling comprssion default code false code which inherits default compression setting open ssl attribute
string md5a1 get digest username realm md5a1 md5a1 lower case locale english
context set class loader loader	web application class loader private class loader loader constructors	return loader public void set class loader class loader loader loader loader
private string enabled ciphers private string enabled protocols	return enabled ciphers	determine which cipher suites protocols enable enabled ciphers ssl util get enableable ciphers ssl context enabled protocols ssl util get enableable protocols ssl context	engine set enabled cipher suites enabled ciphers engine set enabled protocols enabled protocols	determines ssl cipher suites can enabled based endpoint ciphers supported ssl param context initialized context obtain supported ciphers from return array ssl cipher suites may enabled which may empty none specified ciphers supported defaults underlying ssl endpoint does specify any ciphers public string get enableable ciphers sslcontext context determines ssl protocol variants can enabled based endpoint ciphers supported ssl param context initialized context obtain supported protocols from return array ssl protocol variants may enabled which may empty none specified protocols supported defaults underlying ssl endpoint does specify any protocols public string get enableable protocols sslcontext context	protected string enabled protocols	override public string get enableable ciphers sslcontext context string requested ciphers str endpoint get ciphers allow all supported ciphers equals requested ciphers str return context get supported get cipher suites requested ciphers str null requested ciphers str trim length return context get default get cipher suites list string requested ciphers new array list string string rc requested ciphers str split final string cipher rc trim cipher length requested ciphers add cipher requested ciphers empty return context get default get cipher suites list string ciphers new array list string requested ciphers ciphers retain all arrays list context get supported get cipher suites ciphers empty log warn sm get string jsse requested ciphers supported requested ciphers str log debug enabled log debug sm get string jsse enableable ciphers ciphers ciphers size requested ciphers size list string skipped new array list string requested ciphers skipped remove all ciphers log debug sm get string jsse unsupported ciphers skipped return ciphers array new string ciphers size	enabled ciphers get enableable ciphers context enabled protocols get enableable protocols context	override public string get enableable protocols sslcontext context string requested protocols endpoint get ssl enabled protocols array requested protocols null requested protocols length return context get default get protocols list string protocols new array list string arrays list requested protocols protocols retain all arrays list context get supported get protocols protocols empty log warn sm get string jsse requested protocols supported arrays list requested protocols log debug enabled log debug sm get string jsse enableable protocols protocols protocols size requested protocols length list string skipped new array list string arrays list requested protocols skipped remove all protocols log debug sm get string jsse unsupported protocols skipped return protocols array new string protocols size	socket set enabled cipher suites enabled ciphers socket set enabled protocols enabled protocols comma separated list encryption ciphers support https connections specified only ciphers listed supported ssl used default default ciphers jvm used note usually means weak export grade ciphers included list available ciphers ciphers specified using jsse cipher naming convention special value code all code enable all supported ciphers include many secure code all code intended testing purposes only connections specified only protocols listed supported ssl enabled specified jvm default used permitted values may obtained from jvm allowed values
string old servlet name servlet mappings put url pattern servlet name old servlet name null duplicate mapping per from servlet eg deployment should fail throw new illegal argument exception sm get string web xml duplicate servlet mapping old servlet name servlet name url pattern	test expected illegal argument exception class public void test bug54387a multiple servlets may mapped same url pattern web xml webxml new web xml webxml add servlet mapping foo webxml add servlet mapping foo test expected illegal argument exception class public void test bug54387b multiple servlets may mapped same url pattern web xml webxml new web xml web xml f1 new web xml web xml f2 new web xml hash set web xml fragments new hash set fragments add f1 fragments add f2 f1 add servlet mapping foo f2 add servlet mapping foo webxml merge fragments test public void test bug54387c multiple servlets may mapped same url pattern main web xml takes priority web xml webxml new web xml web xml f1 new web xml web xml f2 new web xml hash set web xml fragments new hash set fragments add f1 fragments add f2 f1 add servlet mapping foo f2 add servlet mapping foo webxml add servlet mapping foo main webxml merge fragments
add post construct method definition given class existing definition specified class illegal argument exception thrown param clazz fully qualified class name param method post construct method name throws illegal argument exception fully qualified class name method name code null code already post construct method definition given class public void add post construct method string clazz string method add pre destroy method definition given class existing definition specified class illegal argument exception thrown param clazz fully qualified class name param method post construct method name throws illegal argument exception fully qualified class name method name code null code already pre destroy method definition given class public void add pre destroy method string clazz string method removes post construct method definition given class exists otherwise action taken param clazz fully qualified class name public void remove post construct method string clazz removes pre destroy method definition given class exists otherwise action taken param clazz fully qualified class name public void remove pre destroy method string clazz returns method name specified post construct method given class exists otherwise code null code returned param clazz fully qualified class name return method name specified post construct method given class exists otherwise code null code returned public string find post construct method string clazz returns method name specified pre destroy method given class exists otherwise code null code returned param clazz fully qualified class name return method name specified pre destroy method given class exists otherwise code null code returned public string find pre destroy method string clazz returns map keys fully qualified class names classes have post construct methods values method names classes empty map returned return map keys fully qualified class names classes have post construct methods values method names public map string string find post construct methods returns map keys fully qualified class names classes have pre destroy methods values method names classes empty map returned return map keys fully qualified class names classes have pre destroy methods values method names public map string string find pre destroy methods	private final map string string post construct methods private final map string string pre destroy methods	post construct methods catalina context find post construct methods pre destroy methods catalina context find pre destroy methods	string post construct from xml post construct methods get clazz get name string pre destroy from xml pre destroy methods get clazz get name	post construct find post construct post construct post construct from xml method pre destroy find pre destroy pre destroy pre destroy from xml method else post construct from xml null throw new illegal argument exception post construct method post construct from xml class clazz get name declared deployment descriptor cannot found else pre destroy from xml null throw new illegal argument exception pre destroy method pre destroy from xml class clazz get name declared deployment descriptor cannot found	private static method find post construct method current post construct string post construct from xml method method return find lifecycle callback current post construct post construct from xml method post construct class private static method find pre destroy method current pre destroy string pre destroy from xml method method return find lifecycle callback current pre destroy pre destroy from xml method pre destroy class private static method find lifecycle callback method current method string method name from xml method method class extends annotation annotation method result current method method name from xml null method get name equals method name from xml valid lifecycle callback method throw new illegal argument exception invalid annotation get name annotation result method else method annotation present annotation current method null valid lifecycle callback method throw new illegal argument exception invalid annotation get name annotation result method return result	private map string string post construct methods new hash map private map string string pre destroy methods new hash map	override public void add post construct method string clazz string method clazz null method null throw new illegal argument exception sm get string standard context required post construct methods get clazz null throw new illegal argument exception sm get string standard context duplicate clazz post construct methods put clazz method fire container event add post construct method clazz override public void remove post construct method string clazz post construct methods remove clazz fire container event remove post construct method clazz override public void add pre destroy method string clazz string method clazz null method null throw new illegal argument exception sm get string standard context predestroy required pre destroy methods get clazz null throw new illegal argument exception sm get string standard context predestroy duplicate clazz pre destroy methods put clazz method fire container event add pre destroy method clazz override public void remove pre destroy method string clazz pre destroy methods remove clazz fire container event remove pre destroy method clazz override public string find post construct method string clazz return post construct methods get clazz override public string find pre destroy method string clazz return pre destroy methods get clazz override public map string string find post construct methods return post construct methods override public map string string find pre destroy methods return pre destroy methods	post construct elements private map string string post construct methods new hash map public void add post construct methods string clazz string method post construct methods contains key clazz post construct methods put clazz method public map string string get post construct methods return post construct methods pre destroy elements private map string string pre destroy methods new hash map public void add pre destroy methods string clazz string method pre destroy methods contains key clazz pre destroy methods put clazz method public map string string get pre destroy methods return pre destroy methods	post construct methods empty entry string string entry post construct methods entry set sb append post construct append element sb indent4 lifecycle callback class entry get key append element sb indent4 lifecycle callback method entry get value sb append post construct sb append pre destroy methods empty entry string string entry pre destroy methods entry set sb append pre destroy append element sb indent4 lifecycle callback class entry get key append element sb indent4 lifecycle callback method entry get value sb append pre destroy sb append	entry string string entry post construct methods entry set context add post construct method entry get key entry get value entry string string entry pre destroy methods entry set context add pre destroy method entry get key entry get value	post construct methods empty web xml fragment fragments merge lifecycle callback fragment get post construct methods temp get post construct methods fragment post construct methods return false post construct methods put all temp get post construct methods pre destroy methods empty web xml fragment fragments merge lifecycle callback fragment get pre destroy methods temp get pre destroy methods fragment pre destroy methods return false pre destroy methods put all temp get pre destroy methods	private static boolean merge lifecycle callback map string string fragment map map string string temp map web xml fragment string map name entry string string entry fragment map entry set final string key entry get key final string value entry get value temp map contains key key value null value equals temp map get key log error sm get string web xml merge conflict string map name key fragment get name fragment get url return false else temp map put key value return true	override public void add post construct method string clazz string method op override public void add pre destroy method string clazz string method op override public void remove post construct method string clazz op override public void remove pre destroy method string clazz op override public string find post construct method string clazz return null override public string find pre destroy method string clazz return null override public map string string find post construct methods return null override public map string string find pre destroy methods return null	digester add rule full prefix post construct new lifecycle callback rule add post construct methods true digester add call param full prefix post construct lifecycle callback class digester add call param full prefix post construct lifecycle callback method digester add rule full prefix pre destroy new lifecycle callback rule add pre destroy methods false digester add call param full prefix pre destroy lifecycle callback class digester add call param full prefix pre destroy lifecycle callback method	rule fails more than one post construct pre destroy methods configured per class private final boolean post construct public lifecycle callback rule string method name int param count boolean post construct super method name param count post construct post construct override public void end string namespace string name throws exception object params object digester peek params params null params length web xml web xml web xml digester peek post construct web xml get post construct methods contains key params throw new illegal argument exception web rule set sm get string web rule set duplicate params else web xml get pre destroy methods contains key params throw new illegal argument exception web rule set sm get string web rule set predestroy duplicate params super end namespace name	determines method valid lifecycle callback method param method method test return code true code method valid lifecycle callback method else code false code public static boolean valid lifecycle callback method method method get parameter types length modifier static method get modifiers method get exception types length method get return type get name equals void return false return true	test expected illegal argument exception class public void test add post construct method null class name new standard context add post construct method null test expected illegal argument exception class public void test add post construct method null method name new standard context add post construct method null test expected illegal argument exception class public void test add post construct method conflicts standard context standard context new standard context standard context add post construct method standard context add post construct method test expected illegal argument exception class public void test add pre destroy method null class name new standard context add pre destroy method null test expected illegal argument exception class public void test add pre destroy method null method name new standard context add pre destroy method null test expected illegal argument exception class public void test add pre destroy method conflicts standard context standard context new standard context standard context add pre destroy method standard context add pre destroy method	override public void add post construct method string clazz string method op override public void add pre destroy method string clazz string method op override public void remove post construct method string clazz op override public void remove pre destroy method string clazz op override public string find post construct method string clazz return null override public string find pre destroy method string clazz return null override public map string string find post construct methods return null override public map string string find pre destroy methods return null	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals 500 webxml get minor version	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get version	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get version	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get version	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get version	assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get version test public void test lifecycle methods web xml web xml webxml new web xml webxml add post construct methods webxml add pre destroy methods web xml fragment new web xml fragment add post construct methods fragment add pre destroy methods set web xml fragments new hash set fragments add fragment webxml merge fragments map string string post construct methods webxml get post construct methods map string string pre destroy methods webxml get pre destroy methods assert assert equals post construct methods size assert assert equals pre destroy methods size assert assert equals post construct methods get assert assert equals pre destroy methods get test public void test lifecycle methods web fragments web xml webxml new web xml web xml fragment1 new web xml fragment1 add post construct methods fragment1 add pre destroy methods web xml fragment2 new web xml fragment2 add post construct methods fragment2 add pre destroy methods set web xml fragments new hash set fragments add fragment1 fragments add fragment2 webxml merge fragments map string string post construct methods webxml get post construct methods map string string pre destroy methods webxml get pre destroy methods assert assert equals post construct methods size assert assert equals pre destroy methods size assert assert equals post construct methods get assert assert equals post construct methods get assert assert equals pre destroy methods get assert assert equals pre destroy methods get test public void test lifecycle methods web fragments conflicts web xml webxml new web xml web xml fragment1 new web xml fragment1 add post construct methods fragment1 add pre destroy methods web xml fragment2 new web xml fragment2 add post construct methods set web xml fragments new hash set fragments add fragment1 fragments add fragment2 assert assert false webxml merge fragments assert assert equals webxml get post construct methods size web xml fragment3 new web xml fragment3 add pre destroy methods fragments remove fragment2 fragments add fragment3 assert assert false webxml merge fragments assert assert equals webxml get pre destroy methods size	test public void test bug54379 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments context context tomcat add webapp null test app dir get absolute path tomcat add servlet context test servlet org apache catalina startup tester servlet life cycle methods context add servlet mapping test servlet test servlet tomcat enable naming tomcat start assert page contains test test servlet post construct1	test public void test lifecycle methods definitions throws exception post construct pre destroy parse new web xml web xml false true conflicting post construct definitions parse new web xml web xml false false	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l private string result override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print result post construct protected void post construct result post construct pre destroy protected void pre destroy result pre destroy protected void post construct1 result post construct1 protected void pre destroy1 result pre destroy1	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete true post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct lifecycle callback method post construct pre destroy lifecycle callback class test test servlet lifecycle callback class lifecycle callback method pre destroy lifecycle callback method pre destroy	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete true post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct1 lifecycle callback method post construct post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct2 lifecycle callback method post construct post construct lifecycle callback class org apache catalina startup tester servlet life cycle methods lifecycle callback class lifecycle callback method post construct1 lifecycle callback method post construct pre destroy lifecycle callback class org apache catalina startup tester servlet life cycle methods lifecycle callback class lifecycle callback method pre destroy1 lifecycle callback method pre destroy
first letter return else return cmd substring first letter last letter
do pong frame get pay load	private void do pong byte buffer payload need call pong using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try pong payload finally set context class loader cl	intended overridden sub classes wish notified when pong received default op param payload payload included pong protected void pong byte buffer payload op
request get remote addr request get remote host request get protocol integer value request get server port	get coyote request get attributes put name value override public object get attribute string name return get coyote request get attributes get name	test public void test request attributes access log throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto filter def add init parameter remote ip header my forwarded filter def add init parameter http server port 8080 mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set header my forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify assert assert equals org apache catalina access log server port integer value 8080 actual request get attribute access log server port attribute assert assert equals org apache catalina access log remote addr 140 211 11 130 actual request get attribute access log remote addr attribute assert assert equals org apache catalina access log remote host 140 211 11 130 actual request get attribute access log remote host attribute	get coyote request get attributes put name value override public object get attribute string name return get coyote request get attribute name	test public void test request attributes access log throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new mock request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol request set server port 8080 request get coyote request scheme set string http test remote ip valve invoke request null verify assert assert equals org apache catalina access log server port integer value 8080 request get attribute access log server port attribute assert assert equals org apache catalina access log remote addr 140 211 11 130 request get attribute access log remote addr attribute assert assert equals org apache catalina access log remote host 140 211 11 130 request get attribute access log remote host attribute
wrapper wrapper obj only context has started has have its own after start event later get parent get state available register wrapper context context obj only host has started has have its own after start event later get parent get state available register context
private charset decoder decoder	decoder reset	public void reset throws ioexception re create reader iis iis new intermediate input stream decoder get charset encoding new decoder conv new read convertor iis decoder	public read convertor intermediate input stream charset decoder decoder super decoder	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final byte utf16 message new byte 65 66 67 test public void test single message throws exception test messages test public void test two message throws exception test messages test public void test many message throws exception test messages 10 private void test messages int msg count throws exception b2cconverter conv new b2cconverter utf 16 byte chunk bc new byte chunk char chunk cc new char chunk int msg count bc append utf16 message utf16 message length note limit number characters read conv convert bc cc assert assert equals abc cc string bc recycle cc recycle conv recycle system out println cc
filter name null filter name equals throw new illegal argument exception sm get string application context invalid filter name filter name	servlet name null servlet name equals throw new illegal argument exception sm get string application context invalid servlet name servlet name	private static final string manager sm string manager get manager constants package	filter name null filter name equals throw new illegal argument exception sm get string filter def invalid filter name filter name	private static final string manager sm string manager get manager constants package	servlet name null servlet name equals throw new illegal argument exception sm get string servlet def invalid servlet name servlet name	test expected illegal argument exception class public void test add filter filter name null get servlet context add filter null filter null test expected illegal argument exception class public void test add filter filter name empty string get servlet context add filter filter null test expected illegal argument exception class public void test add servlet servlet name null get servlet context add servlet null servlet null test expected illegal argument exception class public void test add servlet servlet name empty string get servlet context add servlet servlet null private servlet context get servlet context tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context standard context standard context tomcat add webapp null test app dir get absolute path return standard context get servlet context	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test case link filter def test expected illegal argument exception class public void test set filter name null new filter def set filter name null test expected illegal argument exception class public void test set filter name empty string new filter def set filter name test public void test set filter name filter def filter def new filter def filter def set filter name test assert assert equals test expected filter name test filter def get filter name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test case link servlet def test expected illegal argument exception class public void test set servlet name null new servlet def set servlet name null test expected illegal argument exception class public void test set servlet name empty string new servlet def set servlet name test public void test set servlet name servlet def servlet def new servlet def servlet def set servlet name test assert assert equals test expected servlet name test servlet def get servlet name
public void create absolute ordering public void add absolute ordering string fragment name create absolute ordering create absolute ordering	web xml web xml web xml digester peek web xml create absolute ordering digester get logger debug enabled digester get logger debug web xml get class get name set absolute ordering	assert page contains test ok custom default servlet	assert page contains test bug51396 jsp ok	assert page contains test bug53574 ok test public void test bug54262 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments empty absolute ordering tomcat add webapp null test app dir get absolute path tomcat start assert page contains test resource jsp resource jsp resources jar assert page contains test resources hello world example null http servlet response sc found	private void assert page contains string page url string expected body throws ioexception assert page contains page url expected body http servlet response sc ok private void assert page contains string page url string expected body int expected status throws ioexception byte chunk res new byte chunk int sc get url http localhost get port page url res null assert assert equals expected status sc expected status http servlet response sc ok string result res string assert assert true result result index expected body	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete false display name tomcat test application display name description used part tomcat unit tests when full web application required description absolute ordering
non match class null null always ambiguous return null	short cut null always assignable object el null can always coerced valid value primitive src null return true	types null sb append null else sb append types get name append	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final tester base new tester expect failure possible identify which method named test intended test expected method found exception class public void test bug54370a reflection util get method base test new class null string class new object null expect failure possible identify which method named test intended note el null can always coerced valid value primative test expected method found exception class public void test bug54370b reflection util get method base test new class null string class new object null test public void test bug54370c reflection util get method base test new class null new object null test public void test bug54370d reflection util get method base test new class null new object null	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license suppress warnings unused public void test input stream param1 string param2 op suppress warnings unused public void test long param1 string param2 op suppress warnings unused public void test input stream param1 string param2 op suppress warnings unused public void test long param1 string param2 op suppress warnings unused public void test long param1 op suppress warnings unused public void test string param1 op
element null element get valid
primarily used error reporting string jar name null jar name jar get name jar name lower case locale english ends jar manifest resource mre new manifest resource jar name jmanifest manifest resource application catch ioexception ioe throw new ioexception jar jar name ioe
else when running service call stop new thread so make sure correct class loader used prevent range class found exceptions thread current thread set context class loader daemon catalina loader
licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void bug54241a throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug5nnnn bug54241a jsp res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains 01 null assert assert true body contains 02 null test public void bug54241b throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug5nnnn bug54241b jsp res null assert assert equals res string http servlet response sc internal server error rc	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body string null string null jsp writer print object obj defined print string value obj which null obj null 01 object null jsp writer print string defined print null null string 02 null string body	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license class bug54241 public string string return null body bug54241 bug54241 new bug54241 jsp writer print object obj defined print string value obj which obj string obj non null obj string null trigger null pointer exception 01 bug54241 body
jmx enabled oname create object name name oname null register jmx
jdbc interceptor interceptor proxies get interceptor class new instance interceptor set properties proxies get properties interceptor pool closed
status code 400 response get content written response error	test public void test bug54220do set found throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54220 new false ctx add servlet mapping bug54220 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert null res string assert assert equals http servlet response sc ok rc test public void test bug54220set found throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54220 new true ctx add servlet mapping bug54220 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert null res string assert assert equals http servlet response sc found rc private static final class extends http servlet private static final long serial version uid 1l private boolean set found private boolean set found set found set found override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception set found resp set status http servlet response sc found
protected static class pool cleaner extends timer task protected weak reference connection pool pool pool new weak reference pool	connection pool pool pool get pool null stop running else pool closed system current time millis last run sleep time
java naming factory url pkgs org apache naming property
sends error response client using specified status code clears output buffer server defaults creating response look like html formatted server error page containing specified message setting content type text html leaving cookies other headers unmodified error page declaration has been made web application status code passed served back preference suggested msg parameter	clears buffer equivalent calling link send error int string same status code code null code message
string result escape xml buffer char array buffer length result null return buffer else return result suppress warnings null escaped buffer cannot null public static string escape xml char array buffer int length	return null	string str object name ctxt get temporary variable name ctxt generate java source object str object name ctxt generate java source ctxt generate java source string str val name null ctxt generate java source str object name instanceof reader str object name null ctxt generate java source str val name str object name string ctxt generate java source string str def name null	str object name str val name str def name str escape xml name public static boolean output jsp writer out object input string value string default value boolean escape xml throws ioexception input instanceof reader char buffer new char 8096 int read while read read reader input read buffer read escape xml string escaped util escape xml buffer read escaped null out write buffer read else out print escaped else out write buffer read string value null value default value null escape xml util escape xml out write return true else return false	assert assert true body contains ok page encoding iso 8859 session true import java io reader java io string reader use body default value out value session scope does exist ok out out value session scope does exist ok out special handling reader objects reader new string reader ok session set attribute reader out value session scope reader
sorted map string memory pool mxbean memory pool mbeans new tree map memory pool mxbean mbean management factory get memory pool mxbeans string sort key mbean get type mbean get name memory pool mbeans put sort key mbean	writer write table border thead tr th memory pool th th type th th initial th th total th th maximum th th used th tr thead tbody memory pool mxbean memory pool mbean memory pool mbeans values memory usage usage memory pool mbean get usage writer write tr td writer print memory pool mbean get name writer write td td writer print memory pool mbean get type writer write td td writer print format size long value usage get init true writer write td td writer print format size long value usage get committed true writer write td td writer print format size long value usage get max true writer write td td writer print format size long value usage get used true usage get max writer write usage get used 100 usage get max writer write td tr writer write tbody table	memory pool mxbean memory pool mbean memory pool mbeans values memory usage usage memory pool mbean get usage writer write memorypool writer write name memory pool mbean get name writer write type memory pool mbean get type writer write usage init usage get init writer write usage committed usage get committed writer write usage max usage get max writer write usage used usage get init memory pools br xsl apply templates select memorypool hr xsl template match memorypool table tr td name xsl value select name td td type xsl value select type td td initial xsl value select usage init td td committed xsl value select usage committed td td maximum xsl value select usage max td td used xsl value select usage used td tr table xsl template
private static final int max nested realm levels integer get integer org apache catalina startup realm rule set max nested realm levels int value	string pattern prefix int max nested realm levels pattern pattern realm digester add object create pattern null must specified element class name digester add set properties pattern digester add set next pattern set realm org apache catalina realm else digester add set next pattern add realm org apache catalina realm property name org apache catalina startup realm rule set max nested realm levels combined realm allows nested realms property controls maximum permitted number levels nesting specified default value code code used property
long modified since try modified since req get date header header ifmodsince catch illegal argument exception iae invalid date header proceed none set modified since
expect server reply 100 continue interim response	public list string get response body uri elements return body uri elments	send component parts request tolerant simply skip null entries request part null first first false else thread sleep request pause writer write request part writer flush
request set attribute async request uri request get request uri request set attribute async path info request get path info
listeners trigger error handling return false	srv search error dispatch servlet response instanceof http servlet response http servlet response servlet response set status http servlet response sc internal server error host host host context get parent valve std host valve host get pipeline get basic std host valve instanceof standard host valve standard host valve std host valve throwable request request get response started request async dispatching complete	async error page may dispatch another resource flag helps ensure infinite error handling loop entered boolean error start response error	error start container get logger error exception processing request get request uri else request set attribute request dispatcher error exception throwable request response request async async start request get attribute request dispatcher error exception null protect against npes context destroyed during long running request error start error page processing response set suspended false throwable throwable request get attribute request dispatcher error exception null throwable request response else status request response	protected void throwable request request response response	state async state timing out state async state error	alv validate access log 500	do test timeout boolean true null do test timeout boolean false null do test timeout boolean true nonasync do test timeout boolean false nonasync test public void test timeout listener throws exception should work do test timeout null null private void do test timeout boolean complete timeout string dispatch url	new timeout servlet complete timeout dispatch url	expected append timeout servlet get complete timeout null expected append request destroyed else complete timeout boolean value expected append timeout	expected append timeout	complete timeout null alv global validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time alv validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time else complete timeout boolean value dispatch url null	private final boolean complete timeout public timeout servlet boolean complete timeout string dispatch url	complete timeout null ac add listener new tracking listener false complete timeout boolean value dispatch url	timeout servlet timeout new timeout servlet boolean true null	test public void test timeout error dispatch none throws exception do test timeout error dispatch null null test public void test timeout error dispatch non async throws exception do test timeout error dispatch boolean false null test public void test timeout error dispatch async start throws exception do test timeout error dispatch boolean true error page async mode complete test public void test timeout error dispatch async complete throws exception do test timeout error dispatch boolean true error page async mode complete test public void test timeout error dispatch async dispatch throws exception do test timeout error dispatch boolean true error page async mode dispatch private void do test timeout error dispatch boolean async error error page async mode mode throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path timeout servlet timeout new timeout servlet null null wrapper w1 tomcat add servlet ctx time timeout w1 set async supported true ctx add servlet mapping async time non async servlet non async new non async servlet wrapper w2 tomcat add servlet ctx non async non async w2 set async supported true ctx add servlet mapping error nonasync non async async error page async error page new async error page mode wrapper w3 tomcat add servlet ctx async error page async error page w3 set async supported true ctx add servlet mapping error async async error page async error null error page ep new error page ep set error code 500 async error boolean value ep set location error async else ep set location error nonasync ctx add error page ep ctx add application listener tracking request listener class get name tester access log valve alv new tester access log valve ctx get pipeline add valve alv tester access log valve alv global new tester access log valve tomcat get host get pipeline add valve alv global tomcat start byte chunk res new byte chunk try get url http localhost get port async res null catch ioexception ioe ignore expected some error conditions string builder expected new string builder async error null error handler just get 500 response expected append request initialized timeout servlet get note error handler response reset lost async error null async error boolean value expected append async error page get mode error page async mode complete expected append op else mode error page async mode complete expected append complete else mode error page async mode dispatch expected append dispatch non async servlet get else expected append non async servlet get expected append request destroyed assert assert equals expected string res string check access log alv global validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time alv validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time private static enum error page async mode complete complete dispatch private static class async error page extends http servlet private static final long serial version uid 1l private final error page async mode mode public async error page error page async mode mode mode mode override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception print writer writer resp get writer writer write async error page get resp flush buffer final async context ctxt req get async context switch mode case complete writer write complete ctxt complete break case dispatch writer write dispatch ctxt dispatch error nonasync break case complete writer write op break default impossible break
send control message data constants opcode pong send ping message client param data optional message throws ioexception error occurs writing client public synchronized void ping byte buffer data throws ioexception send control message data constants opcode ping generic function send either ping pong param data optional message param opcode byte include opcode throws ioexception error occurs writing client private synchronized void send control message byte buffer data byte opcode throws ioexception	upgrade outbound write 0x80 opcode
value construct env entry env get type env get value value null logger error sm get string naming invalid env entry type env get name	private object construct env entry string type string value try class clazz class name type constructor null try clazz get constructor string class return new instance value catch method exception ignore value length return null try clazz get constructor char class return new instance character value value char catch method exception ignore catch exception ignore return null	private static final string bug49132 name test name private static final string bug49132 value test value private static final string bug54096 name env private static final string bug54096 value value private static final string bug54096 name env private static final string bug54096 value	environment set type bug49132 value get class get name environment set name bug49132 name environment set value bug49132 value	string value string env ctx lookup bug49132 name bug49132 value equals value	test public void test bug54096 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir enable jndi disabled default tomcat enable naming context environment environment new context environment environment set type bug54096env class get name environment set name bug54096 name environment set value bug54096 value ctx get naming resources add environment environment context environment environment new context environment environment set type bug54096env class get name environment set name bug54096 name environment set value bug54096 value ctx get naming resources add environment environment ctx add application listener class get name tomcat start assert equals lifecycle state started ctx get state public static class bug54096env private final string value public bug54096env string value value value public string get value return value public static class bug54096env private final char value public bug54096env char value value value public char get value return value public static final class implements servlet context listener override public void context destroyed servlet context event sce noop override public void context initialized servlet context event sce javax naming context init ctx try init ctx new initial context javax naming context env ctx javax naming context init ctx lookup java comp env validate entry bug54096env value bug54096env env ctx lookup bug54096 name bug54096 value equals value get value throw new runtime exception validate entry bug54096env value bug54096env env ctx lookup bug54096 name bug54096 value char value get value throw new runtime exception catch naming exception throw new runtime exception
private pattern keep alive user agents null public string get keep alive user agents pattern keep alive user agents null return null else return pattern public void set keep alive user agents string keep alive user agents keep alive user agents null keep alive user agents length keep alive user agents null else keep alive user agents pattern compile keep alive user agents	pattern keep alive user agents null message bytes ua request get coyote request get mime headers get value user agent ua null matcher ua string matches response set header connection close attribute name always use session required false should session always used once user may offer some performance benefits since session can used cache principal hence removing need authenticate user every request also help clients assume server cache user however also performance cost creating gc ing session alternative solution see code keep alive user agents code set default value code false code used attribute attribute name keep alive user agents required false some clients most browsers expect server cache user information connection do resend credentials every request tomcat do unless http session available session availble either application creates one code always use session code enabled alternative creating session attribute may used define user agents which http keep alive disabled means connection only used single request hence ability cache user information per connection performance cost disabling http keep alive attribute should regular expression matches entire user agent string code chrome code specified regular expression defined user agents have http keep alive disabled attribute
stage make all dependencies bi directional makes next stage simpler before equals order others fragments get before add after ordering fragment get name after equals order others fragments get after add before ordering fragment get name stage make all fragments implicitly before after others explicitly so iterative so next stage doesn have fragment get before ordering contains order others make before others explicit fragment get after ordering fragments fragment get after ordering contains order others make after others explicit fragment get before ordering fragments stage separate three groups set web xml before set new hash set set web xml others set new hash set set web xml after set new hash set web xml fragment fragments values fragment get before ordering contains order others before set add fragment fragment get before ordering remove order others else fragment get after ordering contains order others after set add fragment fragment get after ordering remove order others else others set add fragment stage decouple groups so ordering requirements each fragment group only refer other fragments group ordering requirements outside group handled processing groups order note only after ordering requirements considered ok because processing stage decouple other groups before set decouple other groups others set decouple other groups after set stage order each group note only after ordering requirements considered ok because processing stage order fragments ordered fragments before set order fragments ordered fragments others set order fragments ordered fragments after set private static void decouple other groups set web xml group set string names new hash set web xml fragment group names add fragment get name web xml fragment group iterator string after fragment get after ordering iterator while after has next string entry after next names contains entry after remove private static void order fragments set web xml ordered fragments set web xml unordered set web xml added round new hash set set web xml added last round new hash set while unordered size iterator web xml source unordered iterator while source has next web xml fragment source next web xml remove added last round fragment get after ordering remove remove get name fragment get after ordering empty added round add fragment ordered fragments add fragment source remove added round size circular throw new illegal argument exception sm get string web xml merge conflict order added last round clear added last round add all added round added round clear private static void make before others explicit set string before ordering map string web xml fragments string before before ordering before equals order others web xml web xml fragments get before web xml get before ordering contains order others web xml add before ordering others make before others explicit web xml get after ordering fragments private static void make after others explicit set string after ordering map string web xml fragments string after after ordering after equals order others web xml web xml fragments get after web xml get after ordering contains order others web xml add after ordering others make after others explicit web xml get before ordering fragments	private int pos private int pos private int pos private int pos private int pos private int pos public void set up	control input order fragments new linked hash map	private void do relative ordering test relative ordering test runner runner confirm we have all 720 possible input orders set string orders new hash set test all possible input orders since some bugs were discovered depended input order int int int int int set up runner init array list web xml source new array list source add all fragments values map string web xml input new linked hash map web xml one source remove input put one get name one web xml two source remove input put two get name two web xml three source remove input put three get name three web xml four source remove input put four get name four web xml five source remove input put five get name five web xml six source remove input put six get name six string order one get name two get name three get name four get name five get name six get name orders add order set web xml ordered web xml order web fragments app input populate positions ordered runner validate get order ordered system out println orders size private string get order set web xml ordered string builder sb new string builder ordered size web xml web xml ordered sb append web xml get name return sb string private void populate positions set web xml ordered list web xml indexed new array list indexed add all ordered pos indexed index pos indexed index pos indexed index pos indexed index pos indexed index pos indexed index do relative ordering test new relative test runner1 do relative ordering test new relative test runner2 test public void test order web fragments relative3 third example from spec added do relative ordering test new relative test runner3 test public void test order web fragments simple sequence failed some inputs do relative ordering test new relative test runner4 public void test order web fragments simple sequence failed some inputs do relative ordering test new relative test runner5 test public void test order web fragments simple sequence failed some inputs do relative ordering test new relative test runner6 test public void test order web fragments relative7 reference loop circular dependencies do relative ordering test new relative test runner7 test public void test order web fragments relative8 more complex trying break algorithm do relative ordering test new relative test runner8 public void test order web fragments relative9 variation bug 54068 do relative ordering test new relative test runner9 test public void test order web fragments relative10 variation bug 54068 do relative ordering test new relative test runner10 test expected illegal argument exception class public void test order web circular1 web xml order web fragments app fragments test expected illegal argument exception class public void test order web circular2 add before ordering others add after ordering others add before ordering add after ordering web xml order web fragments app fragments private interface relative ordering test runner void init void validate string order private class relative test runner1 implements relative ordering test runner override public void init add after ordering others add after ordering add before ordering others add after ordering others add before ordering others add before ordering override public void validate string order some duplication tests below easier check tests complete way add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add after ordering assert true order pos pos add before ordering others assert true order pos pos add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add before ordering assert true order pos pos private class relative test runner2 implements relative ordering test runner override public void init add after ordering others add before ordering add before ordering others add after ordering others add before ordering others override public void validate string order some duplication tests below easier check tests complete way add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos add before ordering assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos private class relative test runner3 implements relative ordering test runner override public void init add after ordering add before ordering others override public void validate string order some duplication tests below easier check tests complete way add after ordering assert true order pos pos add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos private class relative test runner4 implements relative ordering test runner override public void init add after ordering add after ordering override public void validate string order some duplication tests below easier check tests complete way add after ordering assert true order pos pos add after ordering assert true order pos pos private class relative test runner5 implements relative ordering test runner override public void init add before ordering add before ordering override public void validate string order some duplication tests below easier check tests complete way add before ordering assert true order pos pos add before ordering assert true order pos pos private class relative test runner6 implements relative ordering test runner override public void init add before ordering add after ordering override public void validate string order some duplication tests below easier check tests complete way add before ordering assert true order pos pos add after ordering assert true order pos pos private class relative test runner7 implements relative ordering test runner override public void init add before ordering add before ordering add after ordering override public void validate string order some duplication tests below easier check tests complete way add before ordering assert true order pos pos add before ordering assert true order pos pos add after ordering assert true order pos pos private class relative test runner8 implements relative ordering test runner override public void init add before ordering others add before ordering add before ordering others add after ordering add after ordering add after ordering others add after ordering others add after ordering override public void validate string order some duplication tests below easier check tests complete way add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add before ordering assert true order pos pos add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add after ordering assert true order pos pos add after ordering assert true order pos pos add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos assert true order pos pos add after ordering assert true order pos pos private class relative test runner9 implements relative ordering test runner override public void init add before ordering others add before ordering add before ordering override public void validate string order some duplication tests below easier check tests complete way add before ordering others assert true order pos pos assert true order pos pos assert true order pos pos add before ordering assert true order pos pos add before ordering assert true order pos pos private class relative test runner10 implements relative ordering test runner override public void init add after ordering others add after ordering add after ordering override public void validate string order some duplication tests below easier check tests complete way add after ordering others assert true order pos pos assert true order pos pos assert true order pos pos add after ordering assert true order pos pos add after ordering assert true order pos pos
status code 200 status code 204 status code 205 status code 304
protected static string xml escape string null int len length look any bad characters escape bad character found ascii 34 38 39 60 62 int len need escape them quote whole string string builder sb new string builder int len sb append int pos int len char pos sb append pos sb append lt pos else pos sb append pos sb append gt pos else pos sb append pos sb append 039 apos pos else pos sb append pos sb append amp pos else pos sb append pos sb append 034 quot pos pos len sb append pos len return sb string return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license performance tests link page context impl private static string bug53867test data new string hello world meta http equiv content language connection has limited network connectivity please use web page access file server resources test public void test bug53867 int 10 do test bug53867 private static void do test bug53867 int count 100000 int bug53867test data length assert assert equals do test bug53867old version bug53867test data page context impl xml escape bug53867test data int 100 int bug53867test data length do test bug53867old version bug53867test data int 100 int bug53867test data length page context impl xml escape bug53867test data long start system current time millis int count int bug53867test data length do test bug53867old version bug53867test data system out println old escape system current time millis start start system current time millis int count int bug53867test data length page context impl xml escape bug53867test data system out println new escape system current time millis start private static string do test bug53867old version string null return null string builder sb new string builder int length char char sb append lt else sb append gt else sb append 039 apos else sb append amp else sb append 034 quot else sb append return sb string
private final hashtable string string shell env new hashtable
status socket status disconnect processor comet do nothing here just wait get recycled don do comet we need generate end event see bz 54022 else processor async state socket state async end
return quoted
err dispatcher ctxt get jsp file ctxt tag file	private boolean tag file false page info bean repository bean repository string jsp file boolean tag file tag file tag file	public boolean tag file return tag file	override public boolean tag file return page info tag file	tag being used inside tag file boolean tag file	string jsp ctxt null ctxt tag file jsp ctxt get jsp context else jsp ctxt jspx page context ctxt generate java source jsp ctxt set attribute str var result name scope ctxt generate java source jsp ctxt remove attribute str var scope ctxt generate java source jsp ctxt remove attribute str var
member instanceof static member add suspects put member long value system current time millis	members instanceof static member add suspects put members long value system current time millis	add suspects contains key members membership get member members null avoid temporary adding member continue
fix bug 54010 bug remove some unnecessary code duplicate calls configure scheme https ajp requests originally received over https markt fix
request null buf append else session session request get session internal false session null else buf append session get id internal
current init restart single file	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test bug53986 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null app dir get absolute path tomcat start byte chunk res get url http localhost get port bug53986 jsp assert assert true res string contains ok	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body
public final naming enumeration name class pair list name name	public final naming enumeration name class pair list string name throws naming exception aliases empty alias result result find alias name result dir context null return result dir context list result alias name next do standard lookup list naming entry bindings do list bindings name check alternate locations list naming entry alt bindings null dir context alt dir context alt dir contexts alt dir context instanceof base dir context alt bindings base dir context alt dir context do list bindings meta inf resources name alt bindings null bindings null bindings alt bindings else bindings add all alt bindings bindings null return new naming context enumeration bindings iterator really found throw new name found exception sm get string resources found name
servlet set overridable true servlet set overridable true
returns true host configured undeploy old versions applications deployed using parallel deployment only takes effect link get auto deploy also returns true public boolean get undeploy old versions set true host should undeploy old versions applications deployed using parallel deployment only takes effect link get auto deploy returns true public void set undeploy old versions boolean undeploy old versions	private boolean undeploy old versions false public boolean get undeploy old versions return undeploy old versions override public void set undeploy old versions boolean undeploy old versions undeploy old versions undeploy old versions override attribute name undeploy old versions description determines old versions applications deployed using parallel deployment undeployed when longer used requires auto deploy enabled type boolean	delete redeploy resources app resources false	delete redeploy resources app resources true	private void delete redeploy resources deployed application app string resources int boolean delete reload resources delete redeploy resources log info enabled log info sm get string host config undeploy app name container context host find child app name try host remove child context catch throwable exception utils handle throwable log warn sm get string host config context remove app name delete other redeploy resources int resources length try file current new file resources current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name delete reload resources remove any remaining xml descriptor delete reload resources string resources2 app reload resources key set array new string int resources2 length try file current new file resources2 current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path current get absolute path ends xml log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name deployed remove app name	check old versions applications can now undeployed host get undeploy old versions check undeploy	check old versions applications using parallel deployment now unused have active sessions undeploy any found public void check undeploy need ordered set names sorted set string sorted app names new tree set sorted app names add all deployed key set sorted app names size return iterator string iter sorted app names iterator context name previous new context name iter next do context name current new context name iter next current get path equals previous get path current previous same version current always later version context context context host find child previous get name context null manager manager context get manager manager null manager get active sessions log info enabled log info sm get string host config undeploy version previous get name deployed application app deployed get previous get name string resources app redeploy resources key set array new string version unused undeploy completely trick ensure all redeploy resources removed delete redeploy resources app resources true previous current while iter has next operation name check undeploy description undeploy any old versions applications deployed using parallel deployment have active sessions impact action return type void operation href host html host may configured via code undeploy old versions code remove old versions deployed way once longer use attribute name undeploy old versions required false flag determines tomcat part auto deployment process check old unused versions web applications deployed using parallel deployment any found remove them flag only applies code auto deploy code true specified default value false used attribute
faster approach than calling link mark link next char however approach only safe mark only used within jsp reader private int next char mark mark throws jasper exception has more input return int ch current stream current cursor mark init current single file current cursor ch current line current col else current col return ch search given character found mark current cursor cursor point next character private boolean index char mark mark throws jasper exception has more input return null int end current stream length int ch int line current line int col current col int current cursor end ch current stream ch mark update line col ch line col else col ch current update line col return boolean true current update line col return boolean false	while mark equals stop set current oldstart	method avoids call link mark when doing comparison private boolean mark equals mark another return another equals current similar link reset mark new mark created therefore parameter mark must used other places private void set current mark mark current mark	int len string length int cursor current cursor int stream size current stream length cursor len stream size try scan memory int line current line int col current col int ch int len ch current stream cursor string char ch return false ch line col else col current update cursor line col else mark mark mark int ch int do ch next char char ch string char set current mark return false while len return true	set current mark	set current mark	set current mark	mark ret mark char first char limit char boolean result null mark restart null while result index first char ret null result boolean value restart null restart init current single file else restart mark int limlen peek char limit char next char else set current restart continue skip return ret	mark ret mark char first char limit char ch next char ret ch prev ch ch next char ret else ch first char prev	set current mark set current mark	init other false void update int cursor int line int col cursor cursor line line col col void init mark other boolean single file single file reader other reader ctxt other ctxt stream other stream file id other file id file name other file name base dir other base dir encoding other encoding include stack null include stack new stack else include stack clear int other include stack size include stack add element other include stack element
do close constants status close normal
found false found true	results null results size
temp context set doc base current file get path
args href url encoder encode context path
int char value hex utils get dec buf pos char value result char value	10 11 12 13 14 15	fast correct values slower incorrect ones try return dec index catch array index out bounds exception ex return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test cases link hex utils test public void test get dec assert equals hex utils get dec assert equals hex utils get dec assert equals 10 hex utils get dec assert equals 15 hex utils get dec assert equals 10 hex utils get dec assert equals 15 hex utils get dec assert equals hex utils get dec assert equals hex utils get dec assert equals hex utils get dec 255 assert equals hex utils get dec 60
jar next entry string entry name jar get entry name while entry name null entry name starts meta inf resources context add resource jar url url break jar next entry entry name jar get entry name
else context add filter map before filter map	else context add filter map before filter map
while def needs input
public static final string default jars skip tomcat util scan default jar scanner jars skip public static final string pluggability jars skip org apache catalina startup context config jars skip public static final string tld jars skip org apache catalina startup tld config jars skip	list jars skipped when scanning web application jars means jar scanned web fragments scis annotations classes match handles types private static final set string pluggability jars skip new hash set	load list jars skip add jars skip constants default jars skip add jars skip constants pluggability jars skip private static void add jars skip string system property name string jar list system get property system property name jar list null string tokenizer tokenizer new string tokenizer jar list while tokenizer has more elements pluggability jars skip add tokenizer next token	context get loader get class loader callback pluggability jars skip	static set default list jars skip tlds string builder jar list new string builder system get property constants default jars skip string tld jars system get property constants tld jars skip tld jars length jar list length jar list append jar list append tld jars jar list length set tld jars jar list string sets list jars known contain any tlds param jar names list comma separated names jar files known contain any tlds public static synchronized void set tld jars string jar names jar names null tld jars null else tld jars null tld jars new hash set else tld jars clear string tokenizer tokenizer new string tokenizer jar names while tokenizer has more elements tld jars add tokenizer next token	name system property containing default list jars skip when scanning jars elements tlds public static final string default jar skip prop tomcat util scan default jar scanner jars skip name system property containing additional list jars skip when scanning tlds public static final string tld jar skip prop org apache catalina startup tld config jars skip	static set default list jars skip tlds set default list jars skip tlds string builder jar list new string builder system get property constants default jar skip prop string tld jars system get property constants tld jar skip prop tld jars length jar list length jar list append jar list append tld jars jar list length set tld jars jar list string	public static synchronized void set tld jars string jar names tld jars new hash set	mapping global tag library uri location resource path tld associated tag library location returned string array location location jar file location tld private hashtable string tld location mappings private volatile boolean initialized private servlet context ctxt constructor param ctxt servlet context web application which jasper running public tld locations cache servlet context ctxt ctxt ctxt mappings new hashtable string tld location initialized false property name tomcat util scan default jar scanner jars skip comma separated list filenames jars tomcat scan information when using href jar scanner html jar scanner note additional system properties enable jars excluded from specific scans rather than all scans coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property property name org apache catalina startup context config jars skip comma separated list additional filenames jars tomcat scan servlet pluggability features coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property property name org apache catalina startup tld config jars skip comma separated list additional filenames jars tomcat scan tlds coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property
comet false
return jsp property group get url patterns	private set string url pattern new hash set public void add url pattern string url pattern url pattern add url pattern public set string get url patterns return url pattern	string url pattern jpg get url patterns append element sb indent6 url pattern url pattern	string url pattern jsp property group get url patterns context add servlet mapping url pattern jsp servlet name true log debug enabled string url pattern jsp property group get url patterns log debug skiping url pattern servlet jsp servlet name	add url pattern
key starts jar key starts file
state state new state request response false	wrequest set context path context get path
see java lang exception exception string throwable	see java lang exception exception throwable	throws java util concurrent rejected execution exception task	deprecated use link set context context method removed	param context newly associated context	see channel send member java io serializable int error handler see channel send member java io serializable int error handler	exception javax naming directory invalid attributes exception object did	exception javax naming directory invalid attributes exception object did	exception javax naming directory invalid attributes exception object did	exception javax naming directory invalid attributes exception object did	exception javax naming directory invalid attributes exception creation	exception javax naming directory invalid attributes exception creation	parse request request context you may	param response wrapper associated response wrapper param original output output stream
-1
convert jsps web xml	test public void test bug53574 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53574 res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body servlet servlet name bug53574 servlet name jsp file web inf jsp bug53574 jsp jsp file servlet servlet mapping servlet name bug53574 servlet name url pattern bug53574 url pattern servlet mapping
base out clear	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test do forward throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53545 jsp res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok assert assert false body contains fail	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l	xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns j2ee http java sun com xml ns j2ee web xsd version tlib version tlib version short name bug53545 short name tag name test name tag class org apache tomcat unittest tags bug53545 tag class body content scriptless body content tag	body ok body	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license page encoding iso 8859 body fail bug53545 test fail bug53545 test fail jsp forward page bug53545 html fail bug53545 test fail bug53545 test fail body
override protected string do get real path string path file file file path null file return file get absolute path else return null
ssl honor cipher order set code true code enforce server cipher order instead default which allow client choose preferred cipher public boolean get sslhonor cipher order return apr endpoint endpoint get sslhonor cipher order public void set sslhonor cipher order boolean sslhonor cipher order apr endpoint endpoint set sslhonor cipher order sslhonor cipher order	protected boolean sslhonor cipher order false set code true code enforce server cipher order instead default which allow client choose preferred cipher public void set sslhonor cipher order boolean sslhonor cipher order sslhonor cipher order sslhonor cipher order public boolean get sslhonor cipher order return sslhonor cipher order	set cipher order client default server sslhonor cipher order boolean order ciphers supported false try order ciphers supported ssl has op ssl ssl op cipher server preference order ciphers supported sslcontext set options ssl context ssl ssl op cipher server preference catch unsatisfied link error ignore order ciphers supported open ssl does support ciphers ordering log warn sm get string endpoint warn honor cipher order ssl version string attribute name sslhonor cipher order required false set code true code enforce server cipher order from code sslcipher suite code setting instead allowing client choose cipher which default attribute
sec web socket protocol
data set message new xbyte buffer tcp ping data false
tcp failure detector tcp failure detector failure detector null failure detector get null tcp failure detector null tcp failure detector check members true static membership interceptor smi static only static members null static members get null smi null
string super class name cache entry get superclass name	public final string superclass name public final string interface names superclass name java class get superclass name interface names java class get interface names public string get superclass name return superclass name public string get interface names return interface names
string absolute try absolute absolute url catch illegal argument exception iae relative url return url	can go above server root	add query string fragment present back	test public void test bug53469a throws exception request req new tester mock request response resp new response resp set request req string result resp encode url bar html assert assert equals bar html result test public void test bug53469b throws exception request req new tester mock request response resp new response resp set request req string result resp encode url bar html assert assert equals bar html result
ignore probably triggered call stop heartbeat highly unlikely event different trigger simply ignore continue	catch interrupted exception thread current thread interrupt string msg id null coord msg received get thread interrupted msg election abandoned waiting interrupted else msg election abandoned waiting timed out msg election abandoned received message fire interceptor event new coordination event coordination event evt elect abandoned msg	ignore probably triggered call stop highly unlikely event different trigger simply ignore continue	error counter do run receiver log warn error receiving mcast package sleeping 500ms else log debug enabled log debug error receiving mcast package do run receiver sleeping 500ms do run receiver try thread sleep 500 catch exception ignore error counter recovery counter error counter recovery thread recover mcast service impl	allow thread interrupted back out publish operation further action required	catch interrupted exception ignore attempt interrupt thread catch exception	ignore	catch interrupted exception ignore ignore	catch interrupted exception ignore ignore	fix bug 53529 bug clean up handling code interrupted exception code throughout code base markt fix
boolean false equals con get pool properties get default auto commit
parameter only looked link get default auto commit returns false	parameter only looked link get default auto commit returns false
int send options channel send options msg instanceof session message session message msg get event type session message evt all session data send options channel send options synchronized ack channel send options use ack channel send new member dest msg send options channel send destmembers msg send options
private final concurrent hash map string string parameters	read only attributes contains key name value attributes remove name value null	return parameters put absent name value null	object obj tomcat attributes get name obj null else return obj note extensions always matched case insensitive manner
mime mappings put extension lower case locale english mime type	return mime mappings get extension lower case locale english add bug 45995 bug align tomcat apache httpd perform mime type mapping based file extension case insensitive manner markt add
http status code integer note status code zero used default error page	error page null look default error page error page context find error page	error status code which error page active note status code used default error page	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test error page handling throws exception set up container tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path add error page tomcat add servlet ctx error new error servlet ctx add servlet mapping error error add error handling page tomcat add servlet ctx report new report servlet ctx add servlet mapping report report handling 500 responses error page error page500 new error page error page500 set error code response sc internal server error error page500 set location report 500 ctx add error page error page500 default error handling error page error page default new error page error page default set location report default ctx add error page error page default tomcat start do test error page handling 500 500 do test error page handling 501 default private void do test error page handling int error string report throws exception request page triggers error byte chunk bc new byte chunk int rc get url http localhost get port error error code error bc null assert assert equals error rc assert assert equals report bc string private static class error servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception int error integer value req get parameter error code int value resp send error error private static class report servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception string path info req get path info resp set content type text plain resp get writer print path info
uri uri new uri jndi null get jndiuri host name full path null null	test public void test bug53467 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53467 jsp res null assert assert equals http servlet response sc ok rc assert assert true res string contains ok	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body
original get key property path null properties get context null ensures registration came from tomcat we re losing unique domain putting engine attribute
digester add rule full prefix ejb local ref mapped name new mapped name rule	digester add rule full prefix ejb ref mapped name new mapped name rule	digester add rule full prefix env entry mapped name new mapped name rule	digester add rule full prefix resource env ref mapped name new mapped name rule	digester add rule full prefix message destination mapped name new mapped name rule	digester add rule full prefix message destination ref mapped name new mapped name rule	digester add rule full prefix resource ref mapped name new mapped name rule	digester add rule full prefix service ref mapped name new mapped name rule	rule sets mapped name resource base public mapped name rule op process body text element param namespace namespace uri matching element empty string parser namespace aware element has namespace param name local name parser namespace aware just element name otherwise param text body text element override public void body string namespace string name string text throws exception resource base resource base resource base digester peek resource base set property mapped name text trim	test public void test bug53465 throws exception tomcat tomcat get tomcat instance tomcat enable naming file app dir new file test webapp app dir relative server home org apache catalina context ctxt tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug53465 jsp bc null assert assert equals http servlet response sc ok rc assert assert true bc string contains 10 context environment ce ctxt get naming resources find environment bug53465 assert assert equals name ce get property mapped name env entry description resource testing bug 53465 description env entry name bug53465 env entry name env entry value 10 env entry value env entry type java lang integer env entry type mapped name name mapped name env entry
out printil else throw new servlet exception	ex instanceof runtime exception throw runtime exception ex attribute name object name required false string define valid code javax management object name code string used register object platform mbean server default value code null code object registered using tomcat jdbc type org apache tomcat jdbc pool interceptor slow query report jmx name name pool attribute
default domain objects registering mbean server public static final string pool jmx domain tomcat jdbc public static final string pool jmx type prefix pool jmx domain type	string domain connection pool pool jmx domain	public static final string object name attribute object name	public object name get object name class clazz string pool name throws malformed object name exception object name oname null get properties contains key object name attribute oname new object name get properties get object name attribute get value else oname new object name connection pool pool jmx type prefix clazz get name name pool name	new slow query report jmx get object name slow query report jmx class pool get name
protocol handler apr required apr lifecycle listener apr available throw new lifecycle exception sm get string coyote connector protocol handler apr get protocol handler class name	override public boolean apr required return false	requires apr native library public boolean apr required	override public boolean apr required override since protocol requires apr native library return true constructor	override public boolean apr required override since protocol requires apr native library return true
owner get name descriptor get name	owner get name descriptor get name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test bug53421 expression factory factory expression factory new instance elcontext context new elcontext impl bean bean new bean value expression var bean factory create value expression bean bean class context get variable mapper set variable bean var bean value expression ve factory create value expression context bean value string class exception null try ve get value context catch property found exception pnfe pnfe assert assert true wrong exception type instanceof property found exception string type bean class get name suppress warnings null assert above prevents msg being null string msg get message assert assert true reference type type where property cannot found msg msg contains type private static class bean suppress warnings unused public void set value string value noop
container event listeners container implemented copy write array list since listeners may invoke methods add remove tmeselves other listeners read write lock would trigger deadlock protected list container listener listeners new copy write array list container listener	listeners add listener	container listener results new container listener return listeners array results	listeners remove listener	listeners size return container event event new container event type data note each uses iterator internally so safe container listener listener listeners listener container event event
error status socket status stop	error status socket status stop
some clients older android use absolute uri digest relative uri request line request fixed android version string host request get header host string scheme request get scheme host null uri query starts scheme string builder absolute new string builder absolute append scheme absolute append absolute append host absolute append uri query uri equals absolute string return false else return false	rfc 2617 says nc must digits long older android clients use fixed android version nc length nc length
handles types ht null try ht sci get class get annotation handles types class catch exception log debug enabled log info sm get string context config sci debug url else log info sm get string context config sci info url
writer write request bytes received received next stage br parse prepare requst xs attribute name request bytes received type xs long use required
private final thread group group private final atomic integer thread number new atomic integer private final string name prefix
protected static final string prop commit return protected static final string prop rollback return protected static final string prop use disposable connection facade protected static final string prop log validation errors protected static final string prop propagate interrupt state	prop alternate username allowed prop prop prop prop prop	value properties get property prop value null pool properties set commit return boolean parse boolean value value properties get property prop value null pool properties set rollback return boolean parse boolean value value properties get property prop value null pool properties set use disposable connection facade boolean parse boolean value value properties get property prop value null pool properties set log validation errors boolean parse boolean value value properties get property prop value null pool properties set propagate interrupt state boolean parse boolean value
skip blanks introduced regexp split poor input kvp kvp trim kvp length continue kv length throw new illegal argument exception sm get string resources invalid alias mapping kvp trim whitespace from key value kv kv trim kv kv trim kv length kv length	recursively deletes directory its contents private boolean rmdir file dir dir exists return false dir directory return false file files dir list files null files int files length files directory rmdir files return false else files delete return false return dir delete test public void test aliases throws exception some sample text string fox text quick brown fox jumps over lazy dog string lorem ipsum lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua set up temporary doc base some alternates we can set up aliases file tmp dir new file system get property java io tmpdir tomcat unit test test naming context class get name tmp dir exists remove any old test files tmp dir directory rmdir tmp dir throw new ioexception could delete old temp directory tmp dir else tmp dir delete throw new ioexception could delete old temp file tmp dir file doc base new file tmp dir doc base file alternate1 new file tmp dir alternate1 file alternate2 new file tmp dir alternate2 tmp dir mkdirs throw new ioexception could create temp directory tmp dir doc base mkdir throw new ioexception could create temp directory doc base alternate1 mkdir throw new ioexception could create temp directory alternate1 alternate2 mkdir throw new ioexception could create temp directory alternate2 create file each alternate directory we can attempt access file output stream fos new file output stream new file alternate1 test1 txt fos write fox text get bytes utf fos flush fos close fos new file output stream new file alternate2 test2 txt fos write lorem ipsum get bytes utf fos flush fos close finally create context file dir context ctx new file dir context ctx set doc base doc base get canonical path ctx set aliases a1 alternate1 get canonical path a2 alternate2 get canonical path check first alias object file ctx lookup a1 test1 txt assert assert null file assert assert true file instanceof resource byte buffer new byte 4096 resource res resource file int len res stream content read buffer string contents new string buffer len utf assert equals fox text contents check second alias file ctx lookup a2 test2 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals lorem ipsum contents test aliases spaces around separators ctx set aliases a1 alternate1 get canonical path a2 alternate2 get canonical path check first alias file ctx lookup a1 test1 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals fox text contents check second alias file ctx lookup a2 test2 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals lorem ipsum contents clean up rmdir tmp dir throw new ioexception could clean up temp directory tmp dir whitespace permitted around both code code code code delimiters trimmed therefore aliases attribute value code alias path1 doc base1 br alias path2 doc base2 code equivalent code alias path1 doc base1 alias path2 doc base2 code
try con connect catch exception release con set null true instanceof sqlexception throw sqlexception else sqlexception ex new sqlexception get message ex init cause throw ex	driver null log debug enabled log debug driver using class pool properties get driver class name url pool properties get url
catch build exception je system err println je jspc die level die level system exit jspc die level	override public void execute	throw new build exception ioe	throw new build exception je
throw new too many active sessions exception sm get string manager base create session ise max active sessions	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license exception indicates maximum number active sessions has been reached server refusing create any new sessions extends illegal state exception private static final long serial version uid 1l maximum number active sessions server tolerate private final int max active sessions creates new too many active sessions exception param message description exception param max active maximum number active sessions allowed session manager public too many active sessions exception string message int max active super message max active sessions max active gets maximum number sessions allowed session manager return maximum number sessions allowed session manager public int get max active sessions return max active sessions
boolean servlet names set false	servlet names set servlet names length	url patterns set servlet names set filter map set filter name filter name fragment add filter mapping filter map
private final class loader application class loader public stream inbound application class loader thread current thread get context class loader	do binary data ws do text data	private void do binary data input stream throws ioexception need call close using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try binary data finally set context class loader cl private void do text data reader throws ioexception need call close using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try text data finally set context class loader cl do close status	do close constants opcode close private void do close int status need call close using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try close status finally set context class loader cl public final void upgrade complete need call open using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try open outbound finally set context class loader cl	test public void test bug53339 throws exception tomcat tomcat get tomcat instance tomcat enable naming must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug53339 new ctx add servlet mapping bug53339 create resource context environment env new context environment env set name bug53339ws inbound jndi name env set type string class get name env set value bug53339ws inbound test message ctx get naming resources add environment env tomcat start web socket client client new web socket client get port send web socket handshake client writer write get http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection upgrade crlf client writer write sec web socket version 13 crlf client writer write sec web socket key todo crlf client writer write crlf client writer flush make sure we got upgrade response string response line client reader read line assert true response line starts http 101 swallow headers string response header line client reader read line while response header line equals response header line client reader read line now we can do web socket string msg client read message assert equals bug53339ws inbound test message msg finished socket client close private static class extends web socket servlet private static final long serial version uid 1l override protected stream inbound create web socket inbound string sub protocol return new bug53339ws inbound private static class bug53339ws inbound extends message inbound public static final string test message test message public static final string jndi name override protected void open ws outbound outbound string msg error try javax naming context init ctx new initial context msg string init ctx lookup java comp env jndi name catch naming exception ignore test checks message sent print stack trace debug purposes test fails char buffer cb char buffer wrap msg try outbound write text message cb catch ioexception ignore test checks message sent override protected void binary message byte buffer message throws ioexception ignore override protected void text message char buffer message throws ioexception ignore
false false 200 false 200	false true 401 false 200 try access protected resource webapp has basic login method defined verify server prepared accept non standard case auth scheme access should challenged permitted test public void test auth method case basic throws exception do test basic user pwd context path login uri protected true true 401 false 200	false true 401 false 200 false true 401 false 200	false true 401 false 200	boolean verify auth scheme case	string auth scheme verify auth scheme case ic basic string auth line auth scheme base64auth
request get async context null async request started during forward don close response may written during async handling return	test public void test bug53337 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path wrapper tomcat add servlet ctx servlet new set async supported true wrapper tomcat add servlet ctx servlet new set async supported true tomcat add servlet ctx servlet new ctx add servlet mapping servlet servlet ctx add servlet mapping servlet servlet ctx add servlet mapping servlet servlet tomcat start string builder url new string builder 48 url append http localhost url append get port url append servlet byte chunk body new byte chunk int rc get url url string body null assert equals http servlet response sc ok rc assert equals ok body string private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception request dispatcher rd req get request dispatcher servlet rd forward req resp private static class extends http servlet private static final long serial version uid 1l override protected void do get final http servlet request req final http servlet response resp throws servlet exception ioexception final async context async req start async just debugging async set timeout 100000 executor service executor executors new single thread executor executor submit new runnable override public void run async dispatch servlet executor shutdown private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print ok
instance initialized instance initialized true	simple servlet test servlet instances private static class init count extends http servlet private static final long serial version uid 1l private atomic integer call count new atomic integer override public void init throws servlet exception super init call count increment get override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print ok public int get call count return call count int value	test public void test bug53301 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir init count init count new init count tomcat add servlet ctx init count init count ctx add servlet mapping init count tomcat start byte chunk res get url http localhost get port assert equals ok res string assert equals init count get call count
deprecated deprecated	digester add object create full prefix servlet security role ref org apache catalina deploy security role ref digester add set next full prefix servlet security role ref add security role ref org apache catalina deploy security role ref digester add call method full prefix servlet security role ref role link set link digester add call method full prefix servlet security role ref role name set name
start stop queue new start stop thread factory get name start stop	private static class start stop thread factory implements thread factory private thread group group private atomic integer thread number new atomic integer private string name prefix public start stop thread factory string name prefix security manager system get security manager group null get thread group thread current thread get thread group name prefix name prefix override public thread new thread runnable thread thread new thread group name prefix thread number get increment thread set daemon true return thread
jar conn set use caches false
message bytes connection value mb headers get value constants connection	boolean connection close present false response code supports entity body we re http we chunk unless we have connection close header connection close present connection close headers entity body http11 connection close present	avoid adding close header twice connection close present headers add value constants connection set string constants close	private boolean connection close mime headers headers message bytes connection headers get value constants connection connection null return false return connection equals constants close	test public void test chunking11no content length throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt content length flushing servlet new content length flushing servlet ctxt add servlet mapping test content length flushing servlet tomcat start byte chunk response body new byte chunk map string list string response headers new hash map string list string int rc get url http localhost get port test response body response headers assert equals http servlet response sc ok rc assert true response headers contains key transfer encoding list string encodings response headers get transfer encoding assert equals encodings size assert equals chunked encodings get test public void test chunking11no content length connection close throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt content length connection close flushing servlet new content length connection close flushing servlet ctxt add servlet mapping test content length connection close flushing servlet tomcat start byte chunk response body new byte chunk map string list string response headers new hash map string list string int rc get url http localhost get port test response body response headers assert equals http servlet response sc ok rc assert true response headers contains key connection list string connections response headers get connection assert equals connections size assert equals close connections get assert false response headers contains key transfer encoding assert equals ok response body string flushes content length set should result chunking http private static final class content length flushing servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status http servlet response sc ok resp set content type text plain resp get writer write ok resp flush buffer flushes content length set sets connection close header should result chunking http private static final class content length connection close flushing servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status http servlet response sc ok resp set content type text event stream resp add header connection close resp flush buffer resp get writer write ok resp flush buffer
string field name get name method	note method signature has already been checked correctness method name always starts set return introspector decapitalize setter get name substring
injections null method name starts set method name length method get parameter types length method get return type get name equals void
boolean class resource path ends class	only cache binary content some content available either class file since binary content only cached until class has been loaded file needs conversion address encoding issues see below all other cases do cache content prevent excessive memory usage large resources present see https issues apache org bugzilla show bug cgi id 53081 binary stream null class resource file need convert	else try return entry source open stream catch ioexception ioe ignore return null
map string string injections assemble injections from class hierarchy clazz	private map string string assemble injections from class hierarchy class clazz map string string injections new hash map string string map string string current injections null while clazz null current injections injection map get clazz get name current injections null injections put all current injections clazz clazz get superclass return injections
default sets read timeout infinite expects web socket application close connection when longer required applications wishing set explicit timeout may override method return value choice return read timeout milliseconds infinite override public int get read timeout return	socket get socket long value proto endpoint get keep alive timeout	socket get socket long value proto endpoint get keep alive timeout	socket get socket long value proto endpoint get so timeout socket get socket long value processor get upgrade inbound get read timeout	socket timeout set wrapper get socket long value upgrade inbound get read timeout	int timeout upgrade inbound get read timeout timeout timeout wrapper get socket set so timeout timeout	allow upgraded protocol define read timeout used upgraded connection return read timeout milliseconds infinite int get read timeout	wrapper set timeout upgrade inbound get read timeout	add specified socket associated pool poller socket added temporary array polled first after maximum amount time equal poll time most cases latency much lower however param socket add poller param timeout read timeout milliseconds use socket use infinite timeout public void add long socket int timeout	add socket timeout add count timeout	int timeout add socket timeout timeout convert milliseconds microseconds timeout timeout 1000 poll apr pollin timeout	get poller add state socket get keep alive timeout	get poller add socket get socket long value get so timeout
private atomic long pool version new atomic long long min value	idle new linked transfer queue pooled connection idle new array blocking queue pooled connection properties get max active false	con get connection version get pool version return true	check idle false public void check idle boolean ignore min size while ignore min size idle size get pool properties get min idle unlocked has next	should release idle now con time	protected boolean should release idle long now pooled connection con long time con get connection version get pool version return true else return con get release time now time con get release time get size get pool properties get min idle	purges all connections pool connections currently use connections purged when returned pool call also purges connections idle pool only purge used active connections see link purge return public void purge purge return check idle true purges connections when returned from pool call does purge idle connections until used purge idle connections see link purge public void purge return pool version increment get	public long get pool version return pool version get	inherit doc public void purge try create pool purge catch sqlexception log error unable purge pool inherit doc public void purge return try create pool purge return catch sqlexception log error unable purge pool	private volatile long connection version	connection version parent get pool version public long get connection version return connection version	inherit doc override public void purge pool purge inherit doc override public void purge return pool purge return	purges all connections pool connections currently use connections purged when returned pool call also purges connections idle pool only purge used active connections see link purge return public void purge purges connections when returned from pool call does purge idle connections until used purge idle connections see link purge public void purge return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public pool purge test string name super name static final int expected size override public org apache tomcat jdbc pool data source create default data source todo auto generated method stub org apache tomcat jdbc pool data source ds super create default data source ds get pool properties set driver class name driver class get name ds get pool properties set url driver url ds get pool properties set initial size expected size ds get pool properties set max idle expected size ds get pool properties set min idle expected size ds get pool properties set max active expected size ds get pool properties set time between eviction runs millis 30000 ds get pool properties set max age long max value return ds override protected void tear down throws exception driver reset super tear down public void test pool purge throws exception init datasource get connection close assert equals nr connections should expected size expected size datasource get size datasource purge assert equals nr connections should datasource get size tear down public void test pool purge active throws exception init java sql connection con datasource get connection assert equals nr connections should expected size expected size datasource get size datasource purge assert equals nr connections should expected size expected size datasource get size con close assert equals nr connections should datasource get size tear down public void test pool purge return throws exception init java sql connection con datasource get connection assert equals nr connections should expected size expected size datasource get size datasource purge return assert equals nr connections should expected size expected size datasource get size con close assert equals nr connections should expected size expected size datasource get size tear down
small hack until servlet api provides way do servlet request inner req unwrap request while inner instanceof servlet request wrapper inner servlet request wrapper inner get request inner instanceof request facade request facade req do upgrade inbound else resp send error http servlet response sc internal server error
return get max threads executor running protected int get max threads executor boolean use executor use executor executor null	set max connections get max threads executor true strong max threads strong unless href executir html executor used which case default value max threads from executor nio default code 10000 code strong max threads strong unless href executir html executor used which case default value max threads from executor nio default code 10000 code
returns true replicate object has been accessed return boolean override public boolean access replicate long repl delta system current time millis get last time replicated max inactive interval repl delta max inactive interval 1000 return true return false access existing object override public void access entry access set primary session false end access	override public long get last time replicated	override public void set last time replicated long last time replicated	check see we need replicate object dirty complete access replicate boolean dirty value instanceof replicated map entry replicated map entry value dirty boolean access value instanceof replicated map entry replicated map entry value access replicate boolean repl complete dirty access	boolean diff value instanceof replicated map entry replicated map entry value diffable diff dirty	msg null access construct access message msg new map message map context name map message msg access false serializable entry get key null null entry get primary entry get backup nodes	entry get value instanceof replicated map entry replicated map entry entry get value set last time replicated system current time millis	mapmsg get msg type map message msg access map entry entry inner map get mapmsg get key entry null entry set backup nodes mapmsg get backup nodes entry set primary mapmsg get primary entry get value instanceof replicated map entry replicated map entry entry get value access entry	public static final int msg access 11	case msg access return msg access	return last replicate time return public long get last time replicated set last replicate time param last time replicated public void set last time replicated long last time replicated returns true replicate object has been accessed return boolean public boolean access replicate access existing object public void access entry
minor patch library apr major version library apr minor version library apr patch version
initialize pool cleaner properties	public void initialize pool cleaner pool properties evictor thread supposed run start now properties pool sweeper enabled pool cleaner new pool cleaner properties get time between eviction runs millis pool cleaner start end	private volatile properties db properties new properties private volatile string url null private volatile string driver class name null private volatile boolean default auto commit null private volatile boolean default read only null private volatile int default transaction isolation data source factory unknown private volatile string default catalog null private volatile string connection properties private volatile int initial size 10 private volatile int max active default max active private volatile int max idle max active private volatile int min idle initial size private volatile int max wait 30000 private volatile string validation query private volatile string validator class name private volatile validator validator private volatile boolean test borrow false private volatile boolean test return false private volatile boolean test while idle false private volatile int time between eviction runs millis 5000 private volatile int num tests per eviction run private volatile int min evictable idle time millis 60000 private volatile boolean access underlying connection allowed true private volatile boolean remove abandoned false private volatile int remove abandoned timeout 60 private volatile boolean log abandoned false private volatile string name tomcat connection pool pool counter add get system identity hash code pool properties class private volatile string password private volatile string username private volatile long validation interval 30000 private volatile boolean jmx enabled true private volatile string init sql private volatile boolean test connect false private volatile string jdbc interceptors null private volatile boolean fair queue true private volatile boolean use equals true private volatile int abandon when percentage full private volatile long max age private volatile boolean use lock false private volatile interceptor definition interceptors null private volatile int suspect timeout private volatile object data source null private volatile string data source jndi null private volatile boolean alternate username allowed false private volatile boolean commit return false private volatile boolean rollback return false private volatile boolean use disposable connection facade true private volatile boolean log validation errors false private volatile boolean propagate interrupt state false	noop pool already running throw new unsupported operation exception get pool properties set init sql init sql noop pool already running throw new unsupported operation exception noop pool already running obviously jmx enabled throw new unsupported operation exception get pool properties set log abandoned log abandoned get pool properties set max active max active get pool properties set max idle max idle get pool properties set max wait max wait boolean enabled get pool properties pool sweeper enabled get pool properties set min evictable idle time millis min evictable idle time millis boolean should enabled get pool properties pool sweeper enabled make sure pool cleaner starts when should enabled should enabled pool initialize pool cleaner get pool properties get pool properties set min idle min idle get pool properties set num tests per eviction run num tests per eviction run get pool properties set password password boolean enabled get pool properties pool sweeper enabled get pool properties set remove abandoned remove abandoned boolean should enabled get pool properties pool sweeper enabled make sure pool cleaner starts when should enabled should enabled pool initialize pool cleaner get pool properties boolean enabled get pool properties pool sweeper enabled get pool properties set remove abandoned timeout remove abandoned timeout boolean should enabled get pool properties pool sweeper enabled make sure pool cleaner starts when should enabled should enabled pool initialize pool cleaner get pool properties get pool properties set test borrow test borrow get pool properties set test connect test connect get pool properties set test return test return boolean enabled get pool properties pool sweeper enabled get pool properties set test while idle test while idle boolean should enabled get pool properties pool sweeper enabled make sure pool cleaner starts when should enabled should enabled pool initialize pool cleaner get pool properties boolean enabled get pool properties pool sweeper enabled get pool properties set time between eviction runs millis time between eviction runs millis boolean should enabled get pool properties pool sweeper enabled make sure pool cleaner starts when should enabled should enabled pool initialize pool cleaner get pool properties get pool properties set url url get pool properties set use equals use equals get pool properties set use lock use lock get pool properties set username username get pool properties set validation interval validation interval get pool properties set validation query validation query	get pool properties set suspect timeout seconds	get pool properties set data source jndi jndi ds	get pool properties set alternate username allowed alternate username allowed	get pool properties set validator validator
private static final cache value null tccl factory new cache value private static concurrent map cache key cache value factory cache new concurrent hash map cache key cache value	cache value cache value class clazz tccl null cache value null tccl factory else cache key key new cache key tccl cache value factory cache get key cache value null cache value new cache value new cache value cache value factory cache put absent key new cache value cache value null cache value new cache value final lock read lock cache value get lock read lock read lock lock clazz cache value get factory class finally read lock unlock clazz null string class name null try final lock write lock cache value get lock write lock write lock lock try class name cache value get factory class name class name null class name discover class name tccl cache value set factory class name class name tccl null clazz class name class name else clazz tccl load class class name cache value set factory class clazz finally write lock unlock catch class found exception throw new elexception unable find expression factory type class name try	unable create expression factory type clazz get name unable create expression factory type clazz get name unable create expression factory type clazz get name	unable create expression factory type clazz get name	key used cache expression factory discovery information per class loader class loader reference never code null because code null tccl handled separately private static class cache key private final int hash private final weak reference class loader ref public cache key class loader cl hash cl hash code ref new weak reference class loader cl override public int hash code return hash override public boolean equals object obj obj return true obj instanceof cache key return false class loader cl ref get cl null return false return cl cache key obj ref get private static class cache value private final read write lock lock new reentrant read write lock private string class name private weak reference class ref public cache value public read write lock get lock return lock public string get factory class name return class name public void set factory class name string class name class name class name public class get factory class return ref null ref get null public void set factory class class clazz ref new weak reference class clazz licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void bug53001 expression factory factory expression factory new instance elcontext context new elcontext impl resource bundle rb new tester resource bundle value expression var factory create value expression rb resource bundle class context get variable mapper set variable rb var value expression ve factory create value expression context rb keys string class method expression me factory create method expression context rb get keys enumeration class null ensure we compliant string result1 string ve get value context assert assert equals keys result1 check method expression does return keys object result2 me invoke context null assert assert true result2 instanceof enumeration suppress warnings unchecked enumeration string enumeration string result2 assert assert true has more elements assert assert equals key2 next element assert assert true has more elements assert assert equals key1 next element assert assert false has more elements private static class tester resource bundle extends list resource bundle override protected object get contents return contents private static final object contents key1 value1 key2 value2
-1
private static final string separator	class class class null class class load class context application listeners class class null continue load class annotation context class class load fields annotation context class class load methods annotation context class class	class class class null class class load class context filter defs get filter class class class null continue load class annotation context class class load fields annotation context class class load methods annotation context class class	class class load class context wrapper get servlet class load class annotation context class class load fields annotation context class class load methods annotation context class class	protected static void load class annotation context context class class class	protected static void load fields annotation context context class class class initialize annotations field fields get declared fields class class fields null fields length field field fields field annotation present resource class resource annotation field get annotation resource class string default name class class get name separator field get name string default type field get type get canonical name add resource context annotation default name default type protected static void load methods annotation context context class class class initialize annotations method methods get declared methods class class methods null methods length method method methods method annotation present resource class resource annotation method get annotation resource class check bean naming conventions method string default name class class get name separator default instance manager get name method string default type method get parameter types get canonical name add resource context annotation default name default type	add resource context annotation null null protected static void add resource context context resource annotation string default name string default type string name get name annotation default name string type get type annotation default type type equals java lang string type equals java lang character type equals java lang integer type equals java lang boolean type equals java lang double type equals java lang byte type equals java lang short type equals java lang long type equals java lang float resource set name name resource set type type	else type equals javax xml rpc service service set name name service set type type else type equals javax sql data source type equals javax jms connection factory type equals javax jms queue connection factory type equals javax jms topic connection factory type equals javax mail session type equals java net url type equals javax resource cci connection factory type equals org omg corba orb type ends connection factory resource set name name resource set type type	else type equals javax jms queue type equals javax jms topic resource set name name resource set type type else type equals javax resource cci interaction spec type equals javax transaction user transaction resource set name name resource set type type	private static void check bean naming conventions method method method get name starts set method get name length method get parameter types length method get return type get name equals void throw new illegal argument exception invalid method resource injection annotation private static string get type resource annotation string default type string type annotation type get canonical name type null type equals java lang object default type null type default type return type private static string get name resource annotation string default name string name annotation name name null name equals default name null name default name return name private static field get declared fields class class class field fields null globals security enabled final class clazz class class fields access controller do privileged new privileged action field override public field run return clazz get declared fields else fields class class get declared fields return fields private static method get declared methods class class class method methods null globals security enabled final class clazz class class methods access controller do privileged new privileged action method override public method run return clazz get declared methods else methods class class get declared methods return methods private static class load class context context string file string class loader class loader context get loader get class loader class class class null try class class class loader load class file string catch class found exception we do nothing catch class def found error we do nothing return class class
class loader cl get catalina get parent class loader while cl null cl class loader get system class loader attribute name propagate interrupt state required false boolean set true propagate interrupt state thread has been interrupted clearing interrupt state default value code false code backwards attribute
get pool properties get propagate interrupt state thread interrupted	get pool properties get propagate interrupt state thread interrupted	inherit doc override public boolean get propagate interrupt state return get pool properties get propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state get pool properties set propagate interrupt state propagate interrupt state	returns true pool configured propagate interrupt state thread thread waiting connection can have its wait interrupted default clear interrupt flag throw link pool exhausted exception return true pool configured propagate clear thread interrupt state public boolean get propagate interrupt state configure pool propagate interrupt state interrupted threads waiting connection thread waiting connection can have its wait interrupted default clear interrupt flag throw link pool exhausted exception set true behavior change while link pool exhausted exception still thrown threads interrupted state still set param propagate interrupt state set true clear propagate threads interrupted state public void set propagate interrupt state boolean propagate interrupt state	protected boolean propagate interrupt state false	inherit doc override public boolean get propagate interrupt state return propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state propagate interrupt state propagate interrupt state	inherit doc override public boolean get propagate interrupt state return get pool properties get propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state get pool properties set propagate interrupt state propagate interrupt state
valve instanceof lifecycle stop valve necessary get state available try lifecycle valve destroy catch lifecycle exception log error standard pipeline remove valve destroy licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test digest non login when single sign valve active absence sso support webapp using non login simply cannot access protected resources tests exercise way successfully different webapp under digest triggers additional sso logic both webapps note tests intended exercise sso logic test all its logic paths non sso test suite private static final string user user private static final string pwd pwd private static final string role role private static final string http prefix http localhost private static final string context path nologin nologin private static final string context path digest digest private static final string uri protected protected private static final string uri public anyone can access private static final int short timeout secs private static final long short timeout delay msecs short timeout secs 1000 private static final int long timeout secs 10 private static final long long timeout delay msecs long timeout secs 1000 private static final string client auth header private static final string opaque opaque private static final string nonce nonce private static final string realm realm private static final string cnonce cnonce private static string nc1 00000001 private static string nc2 00000002 private static string qop auth private static string server cookies set cookie private static string browser cookies cookie private list string cookies try access unprotected resource without established sso session should permitted test public void test accept public non login throws exception do test non login context path nologin uri public true false 200 try access protected resource without established sso session should rejected sc forbidden 403 status test public void test reject protected non login throws exception do test non login context path nologin uri protected false true 403 logon access protected resource using digest which establish sso session wait until sso session times out try re access resource should rejected sc forbidden 401 status which followed successful re test public void test digest login session timeout throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true wait long enough my session expire thread sleep long timeout delay msecs must change client nonce succeed do test digest user pwd context path digest uri protected true 401 true true nc2 cnonce qop true logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp without sending sso session cookie should rejected sc forbidden 403 status test public void test digest login reject protected without cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected false true 403 logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp while sending sso session cookie provided first webapp should successful sc ok 200 status test public void test digest login accept protected cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected true false 200 logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp while sending sso session cookie provided first webapp should successful sc ok 200 status wait long enough digest session expire sso session should remain active because non login session has yet expired try access protected resource again before sso session has expired should successful sc ok 200 status finally wait non login session expire try again should rejected sc forbidden 403 status see bugfix https issues apache org bugzilla show bug cgi id 52303 test public void test digest expired accept protected cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected true false 200 wait long enough basic session expire long enough non login session expiry thread sleep short timeout delay msecs do test non login context path nologin uri protected true false 200 wait long enough my non login session expire tear down sso session same time thread sleep long timeout delay msecs do test non login context path nologin uri protected false true 403 public void do test non login string uri boolean add cookies boolean expected reject int expected rc throws exception map string list string req headers new hash map string list string map string list string resp headers new hash map string list string byte chunk bc new byte chunk add cookies add cookies req headers int rc get url http prefix get port uri bc req headers resp headers expected reject assert equals expected rc rc assert true bc get length else assert equals 200 rc assert equals ok bc string save cookies resp headers public void do test digest string user string pwd string uri boolean expected reject1 int expected rc1 boolean use server nonce boolean use server opaque string nc1 string cnonce string qop boolean throws exception string digest uri uri list string auth new array list string map string list string req headers1 new hash map string list string map string list string resp headers1 new hash map string list string first access attempt should challenged auth add build digest response user pwd digest uri realm null null nc1 cnonce qop req headers1 put client auth header auth byte chunk bc new byte chunk int rc get url http prefix get port uri bc req headers1 resp headers1 expected reject1 assert equals expected rc1 rc assert true bc get length else assert equals 200 rc assert equals ok bc string save cookies resp headers1 return second request should succeed we use server nonce map string list string req headers2 new hash map string list string map string list string resp headers2 new hash map string list string auth clear use server nonce use server opaque auth add build digest response user pwd digest uri get auth token resp headers1 realm get auth token resp headers1 nonce get auth token resp headers1 opaque nc1 cnonce qop else auth add build digest response user pwd digest uri get auth token resp headers1 realm get auth token resp headers1 nonce null nc1 cnonce qop else auth add build digest response user pwd digest uri get auth token resp headers2 realm null get auth token resp headers1 opaque nc1 cnonce qop req headers2 put client auth header auth bc recycle rc get url http prefix get port uri bc req headers2 resp headers2 assert equals 200 rc assert equals ok bc string save cookies resp headers2 else assert equals 401 rc assert true bc get length override public void set up throws exception super set up create tomcat server using default memory realm tomcat tomcat get tomcat instance associate singe sign valve before contexts single sign sso new single sign tomcat get host get pipeline add valve sso add test user role realm tomcat add user user pwd tomcat add role user role setup both non login login digest webapps set up non login tomcat set up digest tomcat tomcat start private void set up non login tomcat tomcat throws exception must have real doc base webapps just use temp context ctxt tomcat add context context path nologin system get property java io tmpdir ctxt set session timeout long timeout secs add protected servlet tomcat add servlet ctxt tester servlet1 new tester servlet ctxt add servlet mapping uri protected tester servlet1 security collection collection1 new security collection collection1 add pattern uri protected security constraint sc1 new security constraint sc1 add auth role role sc1 add collection collection1 ctxt add constraint sc1 add unprotected servlet tomcat add servlet ctxt tester servlet2 new tester servlet ctxt add servlet mapping uri public tester servlet2 security collection collection2 new security collection collection2 add pattern uri public security constraint sc2 new security constraint do add role which signals access permitted without one sc2 add collection collection2 ctxt add constraint sc2 configure appropriate login config lc new login config lc set auth method none ctxt set login config lc ctxt get pipeline add valve new non login private void set up digest tomcat tomcat throws exception must have real doc base webapps just use temp context ctxt tomcat add context context path digest system get property java io tmpdir ctxt set session timeout short timeout secs add protected servlet tomcat add servlet ctxt tester servlet3 new tester servlet ctxt add servlet mapping uri protected tester servlet3 security collection collection new security collection collection add pattern uri protected security constraint sc new security constraint sc add auth role role sc add collection collection ctxt add constraint sc configure appropriate login config lc new login config lc set auth method digest ctxt set login config lc ctxt get pipeline add valve new digest protected static string get auth token map string list string resp headers string token final string auth prefix final string auth suffix list string auth headers resp headers get base auth header name assume only one string auth header auth headers iterator next string search token auth prefix int start auth header index search search length int end auth header index auth suffix start return auth header substring start end notes from rfc2617 data md5 data kd secret data concat secret data a1 unq username value unq realm value passwd a2 method digest uri value request digest kd a1 unq nonce value nc value unq cnonce value unq qop value a2 private static string build digest response string user string pwd string uri string realm string nonce string opaque string nc string cnonce string qop throws algorithm exception string a1 user realm pwd string a2 get uri string md5a1 digest a1 string md5a2 digest a2 string response qop null response md5a1 nonce md5a2 else response md5a1 nonce nc cnonce qop md5a2 string md5response digest response string builder auth new string builder auth append digest username auth append user auth append realm auth append realm auth append nonce auth append nonce auth append uri auth append uri auth append opaque auth append opaque auth append response auth append md5response auth append qop null auth append qop auth append qop auth append nc null auth append nc auth append nc auth append cnonce null auth append cnonce auth append cnonce auth append return auth string private static string digest string input throws algorithm exception slow should ok only test message digest md5 message digest get instance md5 md5encoder encoder new md5encoder md5 update input get bytes return encoder encode md5 digest extract save server cookies from incoming response protected void save cookies map string list string resp headers we only save cookie values header prefix cookies resp headers get server cookies add all saved cookies outgoing request protected void add cookies map string list string req headers cookies null cookies size req headers put browser cookies cookies
-1
inherit doc override public void set log validation errors boolean log validation errors get pool properties set log validation errors log validation errors inherit doc override public boolean get log validation errors return get pool properties get log validation errors	set true you wish errors from validation should logged error messages param log validation errors set true log validation errors public void set log validation errors boolean log validation errors returns true errors happen during validation logged return true errors happen during validation logged public boolean get log validation errors	protected boolean use disposable connection facade false protected boolean log validation errors false	inherit doc override public void set log validation errors boolean log validation errors log validation errors log validation errors inherit doc override public boolean get log validation errors return log validation errors	get pool properties get log validation errors log error custom validation through pool properties get validator failed	catch exception ex get pool properties get log validation errors log warn sql validation error ex else log debug enabled log debug unable validate object ex	inherit doc override public void set log validation errors boolean log validation errors get pool properties set log validation errors log validation errors inherit doc override public boolean get log validation errors return get pool properties get log validation errors
jmx pool null jmx pool notify org apache tomcat jdbc pool jmx connection pool pool empty pool empty wait throw new pool exhausted exception thread current thread get name jmx pool null jmx pool notify org apache tomcat jdbc pool jmx connection pool pool empty pool empty timeout throw new pool exhausted exception thread current thread get name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public pool exhausted exception public pool exhausted exception string reason super reason public pool exhausted exception throwable cause super cause public pool exhausted exception string reason string sqlstate super reason sqlstate public pool exhausted exception string reason throwable cause super reason cause public pool exhausted exception string reason string sqlstate int vendor code super reason sqlstate vendor code public pool exhausted exception string reason string sql state throwable cause super reason sql state cause public pool exhausted exception string reason string sql state int vendor code throwable cause super reason sql state vendor code cause	public static final string pool empty pool empty
log warn enabled log warn failed query report sql sql time delta ms	log warn enabled log warn slow query report sql sql time delta ms
attachment null return false
buffered output stream bos null boolean error false bos new buffered output stream fos oos new object output stream bos error true throw finally error oos null try oos close catch ioexception ioe ignore bos null try bos close catch ioexception ioe ignore fos null try fos close catch ioexception ioe ignore
thread get class get name starts java util timer	field target field null try target field thread get class get declared field target catch field exception nfe target field thread get class get declared field runnable null target field target field set accessible true object target target field get thread target null target get class get canonical name null target get class get canonical name equals java util concurrent thread pool executor worker field executor field target get class get declared field executor field set accessible true object executor executor field get target executor instanceof thread pool executor thread pool executor executor shutdown now	try field new tasks may scheduled field thread get class get declared field new tasks may scheduled new tasks may scheduled field set accessible true field queue field thread get class get declared field queue queue field set accessible true object queue queue field get thread method clear method queue get class get declared method clear clear method set accessible true synchronized queue new tasks may scheduled field set boolean thread false clear method invoke queue queue notify case queue already empty catch field exception nfe method cancel method thread get class get declared method cancel null cancel method synchronized thread cancel method set accessible true cancel method invoke thread	class tlm class class name java lang thread local thread local map method expunge stale entries method tlm class get declared method expunge stale entries expunge stale entries method set accessible true null thread local map expunge stale entries method invoke thread local map check thread local map leaks thread local map table field thread local map inheritable thread locals field get threads null thread local map expunge stale entries method invoke thread local map check thread local map leaks thread local map table field	catch invocation target exception log warn sm get string webapp class loader check thread locals leaks fail context name catch method exception log warn sm get string webapp class loader check thread locals leaks fail context name	cl	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test timer thread leak throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx instanceof standard context standard context ctx set clear references stop threads true tomcat add servlet ctx task servlet new executor servlet ctx add servlet mapping task servlet tomcat start trigger timer thread creation get url http localhost get port stop context ctx stop thread still exists we have thread memory leak try thread sleep 1000 catch interrupted exception ie ignore assert assert true executor servlet tpe shutdown assert assert true executor servlet tpe terminated static class executor servlet extends http servlet private static final long serial version uid 1l int tasks long 1000l int tp size 10 public static thread pool executor tpe override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp get writer println current thread served servlet tpe new thread pool executor tp size tp size 50000l time unit milliseconds new linked blocking queue runnable task tasks new task tasks int tasks tasks new task task tpe execute tasks resp get writer println started tasks never ending tasks using thread pool executor resp get writer flush class task implements runnable string id public task string id id id override public void run try while thread current thread interrupted thread sleep 20000 system out println thread current thread get class thread current thread get name executing id catch interrupted exception system out println thread current thread get class thread current thread get name exiting	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test thread local leak throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx leak servlet new leaking servlet ctx add servlet mapping leak1 leak servlet tomcat add servlet ctx leak servlet2 new leaking servlet2 ctx add servlet mapping leak2 leak servlet2 tomcat start trigger timer thread creation byte chunk chunk get url http localhost get port leak1 system out print first threadlocal test response chunk string chunk get url http localhost get port leak2 system out print second threadlocal test response chunk string stop context ctx stop thread still exists we have thread memory leak try thread sleep 1000 catch interrupted exception ie ignore class leaking servlet extends http servlet private static final long serial version uid 1l private thread local my counter my thread local new thread local my counter override protected void do get http servlet request request http servlet response response throws servlet exception ioexception my counter counter my thread local get counter null counter new my counter my thread local set counter response get writer println current thread served servlet counter get count times counter increment override public void destroy super destroy normally needed just make my point my thread local null class leaking servlet2 extends http servlet private static final long serial version uid 1l override protected void do get http servlet request request http servlet response response throws servlet exception ioexception list my counter counter list thread scoped holder get from holder my counter counter counter list null counter new my counter thread scoped holder save holder arrays list counter else counter counter list get response get writer println current thread served servlet counter get count times counter increment static class thread scoped holder private final static thread local list my counter thread local new thread local list my counter public static void save holder list my counter thread local set public static list my counter get from holder return thread local get class my counter private int count public void increment count public int get count return count
out printil object jspx saved jsp context jsp context get elcontext get context javax servlet jsp jsp context class	restore nested jsp context elcontext out printil jsp context get elcontext put context javax servlet jsp jsp context class jspx saved jsp context
name class use retrieving user names from x509 certificates protected string x509username retriever class name object extract user names from x509 client certificates protected x509username retriever x509username retriever	gets name class used extract user names from x509 client certificates return name class used extract user names from x509 client certificates public string get x509username retriever class name return x509username retriever class name sets name class used extract user names from x509 client certificates class must implement see x509username retriever param class name name class used extract user names from x509 client certificates public void set x509username retriever class name string class name x509username retriever class name class name	x509username retriever create username retriever x509username retriever class name	string username x509username retriever get username usercert log debug enabled log debug sm get string realm base got x509username username return get principal username	private static x509username retriever create username retriever string class name throws lifecycle exception null class name equals class name trim return new x509subject dn retriever try suppress warnings unchecked class extends x509username retriever clazz class extends x509username retriever class name class name return x509username retriever clazz new instance catch class found exception throw new lifecycle exception sm get string realm base create username retriever class found exception class name catch exception throw new lifecycle exception sm get string realm base create username retriever exception class name catch illegal access exception throw new lifecycle exception sm get string realm base create username retriever illegal access exception class name catch class cast exception throw new lifecycle exception sm get string realm base create username retriever class cast exception class name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license x509username retriever returns certificate entire subject dn username implements x509username retriever public string get username client cert return client cert get subject dn get name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides interface retrieving user name from gets user name from param cert certificate containing user name return appropriate user name obtained from one more fields certificate public string get username client cert attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute
param file jar file checked protected boolean validate jar file file file jar file jar file null try jar file new jar file file int triggers length class clazz null try parent null clazz parent load class triggers else clazz class name triggers catch exception clazz null clazz null continue string name triggers replace class log debug enabled log debug checking name jar entry jar entry jar file get jar entry name jar entry null log info validate jar file file jar loaded see servlet spec section offending class name return false return true finally jar file null try jar file close catch ioexception ioe ignore
sm get string naming context name bound name name get	sm get string naming context name bound name name get	sm get string naming context name bound name name get	sm get string naming context name bound name name get	sm get string naming context name bound name name get	throw new name found exception sm get string naming context name bound name name get
file uri root new file uri root uri root directory throw new jasper exception localizer get message jsp error jspc uriroot dir context null scan files uri root
write timeout att await write latch long max value time unit milliseconds else att await write latch write timeout time unit milliseconds
when tomcat started database connection created used all log activity when tomcat shutdown database connection closed	fix bug 52767 bug remove reference my sql specific auto reconnect property code jdbcaccess log valve code markt fix
principal principal request get principal
input stream reader isr null isr new input stream reader utf br new buffered reader isr	isr null isr close catch ioexception ioe ignore try
input stream reader isr null isr new input stream reader ctxt get options get java encoding reader new buffered reader isr	isr null try isr close catch ioexception ioe ignore
comet event impl comet event request get event finally try comet event close catch ioexception container get logger warn sm get string comet connection manager valve event
file output stream fos null	fos new file output stream xml ostream new buffered output stream fos 1024	catch ioexception ioe ignore fos null try fos close catch ioexception ioe ignore fos null catch ioexception ioe ignore	catch ioexception ioe ignore
file input stream fis null fis new file input stream file finally fis null try fis close catch ioexception ioe ignore
class name constants tag file package name web	string builder base new string builder constants tag file package name meta
file input stream fis null fis new file input stream file finally fis null try fis close catch ioexception ignore	get port socket socket null output stream stream null try socket new socket get address get port stream socket get output stream catch ioexception log error catalina stop finally stream null try stream close catch ioexception ignore socket null try socket close catch ioexception ignore else log error sm get string catalina stop server	finally try input stream close catch ioexception ignore
-1
lt param name gt expires type application javascript lt param name gt	application javascript expires starting point access time duration 10 minute lt param name gt expires type application javascript lt param name gt
suppress warnings unused new method added interface later jdt versions public boolean ignore optional problems return false
else cause instanceof null pointer exception log debug error getting attribute oname att name rme
servlet context context context get servlet context	hack required eclipse serve modules without publishing feature since backs web inf classes multiple locations rather than one	file web inf class dir new file process annotations file web inf class dir web xml else string resource web inf classes binding get name try url url context get resource resource process annotations url url web xml catch malformed urlexception log error sm get string context config webinf classes url resource	context set attribute merged web xml
else big decimal op obj0 obj1 else double op obj0 obj1 else big integer op obj0 obj1 else long op obj0 obj1 else obj0 instanceof boolean obj1 instanceof boolean return coerce boolean obj0 equals coerce boolean obj1 else obj0 get class enum return obj0 equals coerce enum obj1 obj0 get class else obj1 get class enum return obj1 equals coerce enum obj0 obj1 get class else obj0 instanceof string obj1 instanceof string int lex compare coerce string obj0 compare coerce string obj1 return lex compare true false	public void test equals assert true elsupport equals 01 long value test
populate extension validator jars from common shared class loaders get catalina null class loader cl get catalina get parent class loader walk class loader hierarchy stop system class loader add shared present common class loaders while cl class loader get system class loader cl instanceof urlclass loader url urls urlclass loader cl get urls url url urls url get protocol equals file try file new file url uri file get name ends jar extension validator add system resource catch urisyntax exception ignore catch ioexception ignore cl cl get parent
end stream false
catch jmruntime exception rme throwable cause rme get cause cause instanceof unsupported operation exception log debug error getting attribute oname att name rme else log error error getting attribute oname att name rme continue att name
-1
reset false public void reset boolean reset writer stream flags	reset writer stream flags got enc false enc null	output buffer reset reset writer stream flags	test public void test bug52577 throws exception tomcat tomcat get tomcat instance context root tomcat add context temp dir bug52577 new tomcat add servlet root bug52577 bug52577 root add servlet mapping bug52577 tomcat start byte chunk bc new byte chunk int rc get url http localhost get port bc null null assert equals http servlet response sc ok rc assert equals ok bc string	private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception writer resp get writer write ok resp reset buffer write ok
override protected void init internal throws lifecycle exception ensure realm present before any attempt made start one create default null realm necessary get realm super init internal
new linked hash map servlet container initializer set class new hash map class set servlet container initializer cache java class objects byte code fully qualified class name only populated necessary scan super types interfaces part processing link handles types protected final map string java class cache entry java class cache new hash map string java class cache entry flag indicates least one link handles types entry present represents annotation protected boolean handles types annotations false flag indicates least one link handles types entry present represents non annotation protected boolean handles types non annotations false	cache used longer required so clear java class cache clear	type annotation handles types annotations true else handles types non annotations true	handles types non annotations might match handles type populate java class cache class name java class java class cache entry entry java class cache get class name entry get sci set null populate scis cache entry entry entry get sci set size need try load class clazz load class class name clazz null can load class so point continuing return servlet container initializer sci entry get sci set set class classes initializer class map get sci classes null classes new hash set class initializer class map put sci classes classes add clazz handles types annotations map entry class set servlet container initializer entry type initializer map entry set entry get key annotation annotation entry annotation entries java class get annotation entries annotation entry annotation entry annotation entries entry get key get name equals get class name annotation entry get annotation type clazz null clazz load class class name clazz null can load class so point continuing return servlet container initializer sci entry get value initializer class map get sci add clazz break private void populate java class cache string class name java class java class java class cache contains key class name return add class cache java class cache put class name new java class cache entry java class populate java class cache java class get superclass name string iterface java class get interface names populate java class cache iterface private void populate java class cache string class name java class cache contains key class name string name class name replace class input stream context get loader get class loader get resource stream name class parser parser new class parser null try java class clazz parser parse populate java class cache clazz get class name clazz catch class format exception log debug sm get string context config invalid sci handles types class name catch ioexception log debug sm get string context config invalid sci handles types class name private void populate scis cache entry java class cache entry cache entry set servlet container initializer result new hash set servlet container initializer java class java class cache entry get java class super class string super class name java class get superclass name java class cache entry super class cache entry java class cache get super class name avoid infinite loop java lang object cache entry equals super class cache entry cache entry set sci set new hash set servlet container initializer return may null class present could loaded super class cache entry null super class cache entry get sci set null populate scis cache entry super class cache entry result add all super class cache entry get sci set result add all get scis class super class name interfaces string interface name java class get interface names java class cache entry interface entry java class cache get interface name null could mean class present application nothing interest either way nothing do here so move along interface entry null interface entry get sci set null populate scis cache entry interface entry result add all interface entry get sci set result add all get scis class interface name cache entry set sci set result private set servlet container initializer get scis class string class name map entry class set servlet container initializer entry type initializer map entry set class clazz entry get key clazz annotation clazz get name equals class name return entry get value return collections empty set private class load class string class name class clazz null return null return null return null return null return clazz	private static class java class cache entry private final java class java class private set servlet container initializer sci set null public java class cache entry java class java class java class java class public java class get java class return java class public set servlet container initializer get sci set return sci set public void set sci set set servlet container initializer sci set sci set sci set	return names implemented interfaces public string get interface names return interface names returns super class name class case class java lang object return itself java lang object probably incorrect isn fixed time break existing clients return superclass name public string get superclass name return superclass name	config handles types annotations true config handles types non annotations true
byte count
check length before write length	check length before write end start	check length before write length	check length before write len	checks see enough space buffer write requested number bytes private void check length before write int length throws illegal state exception pos length buf length throw new illegal state exception sm get string iob error
naming enumeration binding list bindings null try list bindings context get resources list bindings web inf classes catch name found exception ignore safe ignore while list bindings null list bindings has more elements file web inf class dir new file metadata complete false
tld config add application listener text trim
base64 encode input get bytes b2cconverter iso 8859	ip time key get bytes b2cconverter iso 8859	server ip time key get bytes b2cconverter iso 8859	buffer md5helper digest a2 get bytes b2cconverter iso 8859	md update credentials get bytes b2cconverter iso 8859	md update credentials get bytes b2cconverter iso 8859 pwbc append password get bytes b2cconverter iso 8859	return b2cconverter iso 8859	lock token str get bytes b2cconverter iso 8859	encoding specified use iso 8859 bytes str get bytes b2cconverter iso 8859	charset b2cconverter iso 8859	strcerts get bytes b2cconverter iso 8859	encoding set bytes encoding name get bytes b2cconverter iso 8859	encoding set bytes encoding name get bytes b2cconverter iso 8859	encoding set bytes encoding name get bytes b2cconverter iso 8859	encoding set bytes encoding name get bytes b2cconverter iso 8859	retain reference default character set so we don have look up public static final charset iso 8859 charset name iso 8859	smap get bytes constants iso 8859	retain reference default character set so we don have look up public static final charset iso 8859 charset name iso 8859	object string get bytes constants iso 8859	object string get bytes constants iso 8859	object string get bytes constants iso 8859	byte bb str value get bytes b2cconverter iso 8859
repository utf8decode repository substring repository utf8decode repository substring	private string utf8decode string input string result null try result urldecoder decode input utf catch unsupported encoding exception uee impossible all jvms required support utf return result
qry request get parameter invoke qry null string op name request get parameter op string ps request get parameter ps string values str ps null values str new string else values str request get parameter ps split invoke operation writer qry op name values str return	writer println error ex print stack trace writer	writer println error ex print stack trace writer	catch exception ex writer println error ex print stack trace writer	private void invoke operation print writer writer string oname str string op string values str try object name oname new object name oname str mbean operation info method info registry get method info oname op mbean parameter info signature method info get signature string signature types new string signature length object values new object signature length int signature length mbean parameter info pi signature signature types pi get type values registry convert value pi get type values str object ret val bean server invoke oname op values signature types writer println ok operation op returned output writer ret val catch exception ex writer println error ex print stack trace writer private void output string indent print writer writer object result result instanceof object object obj object result output indent writer obj else writer println indent result string subsection name jmx invoke command code invoke code command enables methods called mbeans general form command exmaple call code find connectors code method strong service strong use subsection
url url new url global web xml get system id global time stamp url open connection get last modified catch malformed urlexception global time stamp catch ioexception url url new url host web xml get system id host time stamp url open connection get last modified catch malformed urlexception host time stamp catch ioexception
values ast method parameters jjt get child jjt get num children get parameters ctx	assumption method parameters present last child int len children length len jjt get child len instanceof ast method parameters return true	test public void test bug52445a method expression me factory create method expression context bean set bean bean bb null new class tester bean class me invoke context null method expression me1 factory create method expression context bean bean say hello null null string actual string me1 invoke context null assert equals hello from bb actual
behavior pre add webapp pre methods you may want call two methods class link default web xml path link get default web xml listener	engine set realm create default realm	create memory realm you can replace contexts real one realm created here added engine default may replaced engine level over ridden per normal tomcat behaviour host context level protected realm create default realm return new realm base	tomcat type realm realm path realm0
javax servlet servlet javax el expression servlet api	name starts javax el must never load javax el classes return false
override public value reference get value reference evaluation context ctx variable mapper var mapper ctx get variable mapper var mapper null return null value expression expr var mapper resolve variable image expr null return null return expr get value reference ctx	public void test get value reference variable expression factory factory expression factory new instance elcontext context new elcontext impl tester bean bean new tester bean bean set name tomcat value expression var factory create value expression bean tester bean class context get variable mapper set variable bean var value expression var2 factory create value expression context bean name string class context get variable mapper set variable foo var2 value expression ve factory create value expression context foo value expression class now check value reference value reference vr ve get value reference context assert null vr assert equals bean vr get base assert equals name vr get property test
flush convertor one use got enc conv null conv flush buffer	writer wasbeing used may unflushed bytes convertor got enc conv null conv recycle
silence host context path	silence host url	private void silence host host string ctx base host get name
log debug sm get string context config invalid sci handles types log debug sm get string context config invalid sci handles types log debug sm get string context config invalid sci handles types
length protect against nulls unexpected types values may set untrusted applications object start request get attribute org apache tomcat sendfile start start instanceof long object end request get attribute org apache tomcat sendfile end end instanceof long length long end long value long start long value sendfile used response bytes written separate thread access log valve know how many bytes were actually written case number bytes passed sendfile thread writing recorded access log valve
authenticate user making request based fact code login config code has been defined container means login user even though self contained way establish security principal user method called base super class establish principal user before container security constraints examined yet known whether user eventually permitted access requested resource therefore necessary always return code true code indicate user has failed two cases without single signon session instance does yet exist code auth method code authenticate user so leave request principal null note base later examine security constraints determine whether resource accessible user without security principal role single signon user has already via another container using its own login associate session ssoentry so inherits already established security principal associated roles note particular session become full member single sign entry session collection so potentially keep ssoe alive even all other properly sessions expire first until expires too param request request we processing param response response we creating param config login describing how should performed return boolean indicate whether user	principal principal request get user principal principal null excellent we have already client somehow probably from another container has login config container log debug enabled container log debug already principal get name create new session only necessary session session request get session internal true save inherited principal necessary session so can remain until expires session set principal principal session set note constants form principal note principal sso session cookie string sso id string request get note constants req ssoid note sso id null container log debug enabled container log debug user existing sso associate session existing sso id necessary associate sso id session user already without cookie return true principal means user already so assigned any roles safe say user now because access protected resources only allowed matching role sc forbidden 403 status generated later container log debug enabled container log debug user without any roles return true return method which vendor specific defined http servlet request
value start log debug enabled log debug sm get string parameters empty chunk do flag error continue foo	value start tmp value set bytes bytes value start value end value start else tmp value set bytes bytes	value start orig value append bytes value start value end value start else orig value append bytes	value start decode value url decode tmp value tmp value set charset charset value tmp value string else value
private volatile int size
private volatile boolean check lock false flags used detect unexpected state private volatile boolean add false private volatile boolean remove false private volatile boolean mutex false
private volatile boolean enabled true	enable
original doc base lower case locale english ends war
new linked hash set jsp property group descriptor	new linked hash set jsp property group
avoid npes selector set null stop selector selector selector	iterator selection key selector selected keys iterator	remove
protected int port	return port number which connector configured listen requests special value means select random free port when socket bound	return port number which connector listening requests special value link port zero used method report actual port bound public int get local port return integer get property local port int value	int port get port port sb append get port else sb append auto sb append get property name index	get port	int port get port port sb append get port else sb append auto sb append get property name index attribute name local port description port number which connector listening requests special value port zero used method report actual port bound type int description port number which connector configured listen requests special value means select random free port when socket bound	counter used generate unique jmx names connectors using automatic port binding private static final atomic integer name counter new atomic integer	unique id connector only used connector configured use random port port change stop start called private int name index	public int get local port return endpoint get local port	public synchronized int get name index name index name index name counter increment get return name index	int port get local port port name append port else name append auto name append get name index	int port get port port name append get port else name append auto name append get name index	public abstract int get local port	port use override public int get local port long server sock return else long sa try sa address get socket apr local sockaddr addr address get info sa return addr port catch exception return public methods	port use override public int get local port server socket server socket null return else return get local port	port use override public int get local port server socket channel ssc server sock ssc null return else server socket ssc socket null return else return get local port	port only known after tomcat starts set port get port	test public void test port throws exception tomcat tomcat get tomcat instance connector connector1 tomcat get connector connector1 set port connector connector2 new connector connector2 set port tomcat get service add connector connector2 tomcat start int local port1 connector1 get local port int local port2 connector2 get local port assert true local port1 assert true local port2	set port tomcat get connector get local port	set port tomcat get connector get local port	client new tomcat get connector get local port	public int port set port port	set port tomcat get connector get local port	set port tomcat get connector get local port	set port tomcat get connector get local port	http localhost tomcat get connector get local port	http http http new url http localhost tomcat get connector get local port test open connection	expected add all arrays list connector mbean names auto protocol	test custom error client client new test custom error client tomcat get connector get local port	test custom error client client new test custom error client tomcat get connector get local port	public test custom error client int port set port port	protected void set port int port	return tomcat get connector get local port	use random free port connector set port	client client new client tomcat get connector get local port	client client new client tomcat get connector get local port	client client new client tomcat get connector get local port	client client new client tomcat get connector get local port	client client new client tomcat get connector get local port	final client client new client tomcat get connector get local port	public client int port set port port	set port tomcat get connector get local port	set port tomcat get connector get local port	trailer client client new trailer client tomcat get connector get local port	trailer client client new trailer client tomcat get connector get local port	trailer client client new trailer client tomcat get connector get local port	public trailer client int port set port port	set port tomcat get connector get local port	set port tomcat get connector get local port	set port tomcat get connector get local port	set port tomcat get connector get local port	int port get port particular port number particular ip address special value zero used tomcat select free port random use connector typically only useful embedded testing applications particular port number particular ip address special value zero used tomcat select free port random use connector typically only useful embedded testing applications
new host object real host object	mapper add host alias alias	check we have right number added 17 including one host alias one duplicate assert equals 16 mapper hosts length final int iow pos assert equals blah7 mapper hosts iow pos object	check host alias has same data mapper host host mapper hosts iow pos mapper host alias mapper hosts iow pos assert equals host name assert equals alias alias name assert equals host context list alias context list assert equals host object alias object	message bytes alias message bytes new instance alias set string alias	mapping data recycle uri set string foo bar bla bobou foo uri chars uri get char chunk set limit mapper map alias uri null mapping data assert equals blah7 mapping data host assert equals context3 mapping data context assert equals wrapper7 mapping data wrapper assert equals foo bar bla mapping data context path string assert equals bobou mapping data wrapper path string assert equals foo mapping data path info string assert true mapping data redirect path null
strong note strong default class loader follows delegation model required system class from webapp repositories code delegate code property allows application modify behavior move parent class loader ahead local repositories	found locally note default code false code behavior called servlet	flag true class loader delegates parent class loader strong before strong searching its own repositories ordinary non servlet chain java class loaders set code false code default class loader search its own repositories first delegate parent only class resource found locally per servlet
protected static string fipsmode off default off valid only when sslengine protected static boolean fips mode active false	log error sm get string apr listener ssl init	fips mode active false	equals ignore case apr lifecycle listener fipsmode log info sm get string apr listener initializing fips int result ssl fips mode set success defined return value result fips mode active true log info sm get string apr listener initialize fipssuccess else case should handled native method we ll make absolutely sure here log error sm get string apr listener initialize fipsfailed throw new illegal state exception sm get string apr listener initialize fipsfailed	ensure sslengine consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late sslengine	ensure random seed consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late sslrandom seed public void set fipsmode string fipsmode ensure fips mode consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late fipsmode apr lifecycle listener fipsmode fipsmode public boolean fipsmode active return fips mode active	enable disable fips mode param mode enable disable return fips mode set return code public static native int fips mode set int mode
resources lookup norm path
config file file context set config file config file uri url
catch file found exception fnfe re throw let caller handle result 404 throw fnfe	throw new file found exception localizer get message jsp error file found fname	throw new file found exception localizer get message jsp error file found fname
context request get mapping data context log access request response system current time millis req get start time false	post parse success request get mapping data context null context null start comet request failed has already been logged	do simple comet test null test public void test simple comet client begin fail throws exception do simple comet test simple comet servlet fail begin test public void test simple comet client read fail throws exception do simple comet test simple comet servlet fail read test public void test simple comet client end fail throws exception do simple comet test simple comet servlet fail end private void do simple comet test string init param throws exception	wrapper tomcat add servlet root comet new simple comet servlet init param null add init parameter init param true tester access log valve alv new tester access log valve root get pipeline add valve alv	init param null normal response expected validate response assert equals http 200 ok response assert equals server apache coyote response assert true response starts set cookie jsessionid assert equals content type text plain charset iso 8859 response assert equals transfer encoding chunked response assert true response starts date assert equals response assert equals response assert equals begin response assert equals response assert equals 17 response 10 assert equals client read bytes response 11 assert equals response 12 assert equals 17 response 13 assert equals client read bytes response 14 assert equals response 15 assert equals 17 response 16 assert equals client read bytes response 17 assert equals response 18 assert equals 17 response 19 assert equals client read bytes response 20 assert equals response 21 assert equals response 22 assert equals client end response 23 assert equals response 24 assert equals response 25 expect 26 lines assert equals 26 response length else failure expected only expected fail begin failure any later stage reponse headers including 200 response code already have been sent client init param simple comet servlet fail begin assert equals http 500 internal server error response alv validate access log 500 1000 else assert equals http 200 ok response alv validate access log 200 5000	public static final string fail begin fail begin public static final string fail read fail read public static final string fail end fail end private boolean fail begin false private boolean fail read false private boolean fail end false override public void init throws servlet exception fail begin boolean value get servlet config get init parameter fail begin boolean value fail read boolean value get servlet config get init parameter fail read boolean value fail end boolean value get servlet config get init parameter fail end boolean value	fail begin throw new ioexception fail begin fail read throw new ioexception fail read	fail end throw new ioexception fail end
location starts scheme relative redirect urlcc recycle add scheme string scheme request get scheme try redirect urlcc append scheme scheme length redirect urlcc append redirect urlcc append location location length return redirect urlcc string catch ioexception illegal argument exception iae new illegal argument exception location iae init cause throw iae else leading slash has scheme location
configures response body included when redirect response sent client public void set send redirect body boolean enable dtermines context configured included response body part redirect response public boolean get send redirect body	get context get send redirect body print writer writer get writer writer print sm get string coyote response send redirect note request util filter absolute flush buffer	private boolean send redirect body false override public boolean get send redirect body return send redirect body override public void set send redirect body boolean send redirect body send redirect body send redirect body attribute name send redirect body required false code true code redirect responses include short response body includes details redirect recommended rfc 2616 disabled default since including response body may cause problems some application component compression filters attribute
process comet event event get http servlet request get remote addr
-1
wrapper null context has been shutdown nothing do here return
long system current time millis 10000 while acceptors alive server sock
finally	error adapter log request response	error cping endpoint paused	error cping endpoint paused	error cping endpoint paused	error adapter log request response	can add 500 access log since has already been written adapter service method licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l private final random random new random override public string get algorithm return insecure override public synchronized void set seed byte seed implemented override public synchronized void set seed long seed super class constructor calls method earlier than our fields initialized ignore call random null return random set seed seed override public synchronized void next bytes byte bytes random next bytes bytes override public byte generate seed int num bytes byte value new byte num bytes next bytes value return value
tomcat new tomcat fast session ids	private static class tomcat fast session ids extends tomcat override public void start throws lifecycle exception use fats insecure session id generation all tests server server get server service service server find services container service get container container find children container find children standard manager standard manager get manager null new standard manager set secure random class org apache catalina startup fast non secure random set manager super start
super	param key type ignored param issuers ignored param socket ignored	choose alias authenticate client side secure socket given public key type list certificate issuer authorities recognized peer any param key type key algorithm type name ordered most preferred key type first param issuers list acceptable ca issuer subject names null does matter which issuers used param engine ignored return alias name desired key null matches override public string choose engine client alias string key type principal issuers sslengine engine return delegate choose client alias key type issuers null returns key manager server key alias provided constructor param key type ignored param issuers ignored param engine ignored return alias name desired key override public string choose engine server alias string key type principal issuers sslengine engine return server key alias
var args method name equals get name param count get parameter types length	int var arg index last parameter varargs final object varargs array new instance var arg class param count var arg index array set varargs var arg index parameters var arg index varargs	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static class foo public string join delimited string delim string strings string builder result new string builder strings null string strings delim null result length result append delim result append return result string public string join string strings return join delimited null strings private foo foo private elcontext el context private bean elresolver bean elresolver before public void setup foo new foo bean elresolver new bean elresolver el context new elcontext private variable mapper variable mapper new variable mapper private map string value expression vars new hash map string value expression override public value expression set variable string arg0 value expression arg1 return vars put arg0 arg1 override public value expression resolve variable string arg0 return vars get arg0 private function mapper function mapper new function mapper override public method resolve function string arg0 string arg1 return null override public variable mapper get variable mapper return variable mapper override public function mapper get function mapper return function mapper override public elresolver get elresolver return bean elresolver tests varargs come after opening argument test public void test join delimited assert assert equals foo join delimited foo bar baz bean elresolver invoke el context foo join delimited null new object foo bar baz tests varargs constitute method only parameters well bogus results due improper matching any vararg method depending order which reflected methods encountered test public void test join assert assert equals foo join foo bar baz bean elresolver invoke el context foo join null new object foo bar baz
null input throw new zip exception sm get string expand war missing jar entry jar entry get name
protect against memory leak caused when code sun java2d disposer code class loaded web application defaults code false code because new thread launched private boolean java2d disposer protection false public boolean protection return java2d disposer protection public void set protection boolean java2d disposer protection java2d disposer protection java2d disposer protection	trigger creation java2d disposer thread see https issues apache org bugzilla show bug cgi id 51687 java2d disposer protection try class name sun java2d disposer catch class found exception cnfe ignore case we must running non sun based jre attribute name protection required false enables protection so loading code sun java2d disposer code class web application does result memory leak defaults code false code because thread launched attribute
private string ssl name null public string get ssl name return ssl name public void set ssl name string ssl name	ssl get instance ssl name	connector set property ssl name attribute name ssl name required false
wakeup counter get set else
swallow unread body packet present first request get content length long receive	unexpected packet type unread body packets should have been swallowed finish log debug enabled log debug unexpected message type error true break	unexpected packet type unread body packets should have been swallowed finish log debug enabled log debug unexpected message type error true break	unexpected packet type unread body packets should have been swallowed finish log debug enabled log debug unexpected message type error true break
saved set method get	saved set method get
-1
timeout rpc messages private long rpc timeout default repl timeout	rpc timeout	public void set rpc timeout long rpc timeout rpc timeout rpc timeout public long get rpc timeout return rpc timeout	result rpc timeout rpc timeout attribute name rpc timeout description timeout rpc messages how long we wait reply type long	destination channel get members length return resp length int resp length map member added resp get source message received resp get message resp get source else log warn broadcast replies probably timeout attribute name rpc timeout required false timeout rpc message used broadcast transfer state from another map default value code 15000 code milliseconds attribute
dir mkdirs dir directory	file parent file resource file get parent file parent file mkdirs parent file exists ignore error like ioexceptions below	class repository mkdirs class repository directory throw new ioexception sm get string webapp loader mkdir failure	dest dir mkdirs dest dir directory throw new ioexception sm get string webapp loader mkdir failure	deployed path mkdirs deployed path directory	config base mkdirs config base directory	app base file mkdirs app base file directory writer println sm client get string host manager servlet app base create fail app base file string name return	config base mkdirs config base directory return null	dir mkdirs dir directory debug log expand cgiscript failed create directories dir get absolute path	private file directory throws ioexception	file delete file exists throw new ioexception sm get string file store delete failed file file mkdirs file directory throw new ioexception sm get string file store create failed file	private file file string id throws ioexception	parent mkdirs parent directory throw new ioexception sm get string expand war create failed parent	dirs mkdirs dirs directory	dir mkdirs dir directory log error sm get string access log valve open dir fail dir	parent mkdirs parent directory log error sm get string access log valve open dir fail parent	return out dir file mkdirs out dir file directory	dir mkdirs dir directory	parent mkdirs parent directory report error unable create parent null error manager open failure writer null return	foo mkdirs foo directory	foo mkdirs foo directory	doc base mkdirs doc base directory	web inf mkdirs web inf directory	web inf mkdirs web inf directory	temp dir mkdirs temp dir directory
simple servlet test line registration	simple servlet test default session manager public static class hello world session extends http servlet private static final long serial version uid 1l override public void do get http servlet request req http servlet response res throws ioexception http session req get session true get id res get writer write hello world	public void test session throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir you can customize context calling its api tomcat add servlet ctx my servlet new hello world session ctx add servlet mapping my servlet tomcat start byte chunk res get url http localhost get port assert equals hello world res string test
log error sm get string coyote connector protocol handler failed
protect against memory leak caused when first call code java awt toolkit get default toolkit code triggered web application defaults code false code because new thread launched private boolean awt thread protection false public boolean awtthread protection return awt thread protection public void set awtthread protection boolean awt thread protection awt thread protection awt thread protection	trigger creation awt awt windows awt xawt etc thread awt thread protection java awt toolkit get default toolkit attribute name awtthread protection required false enables protection so calls code java awt toolkit get default toolkit code triggered web application do result memory leak defaults code false code because awt thread launched attribute
socket get socket long value true	socket get socket long value true	socket get socket long value false	need two pollsets since socket timeout keep alive timeout can have different values private long connection pollset private long keep alive pollset private long pool private long desc private long add socket private boolean add socket keep alive private volatile int add count private boolean comet true private boolean separate keep alive false	create poller some versions apr maximum poller size 62 recompiling apr necessary remove limitation int keep alive timeout get keep alive timeout int socket timeout socket properties get so timeout keep alive timeout comet separate keep alive true connection pollset allocate poller size pool socket timeout separate keep alive keep alive pollset allocate poller size pool keep alive timeout connection pollset size 1024 connection pollset allocate poller size pool socket timeout separate keep alive keep alive pollset allocate poller size pool keep alive timeout connection pollset connection pollset allocate poller size pool socket timeout separate keep alive keep alive pollset allocate poller size pool keep alive timeout add socket new long size add socket keep alive new boolean size	process socket add socket socket status stop destroy socket add socket close all sockets still pollers close pollset connection pollset separate keep alive close pollset keep alive pollset	private void close pollset long pollset int rv poll pollset pollset desc rv int rv comet process socket desc socket status stop else destroy socket desc	public void add long socket boolean keep alive add count add socket length	add socket add count socket add socket keep alive add count keep alive	int rv separate keep alive add socket keep alive rv poll add keep alive pollset add socket poll apr pollin else rv poll add connection pollset add socket poll apr pollin process socket add socket socket status error destroy socket add socket	poll specified interval do poll connection pollset continue separate keep alive do poll keep alive pollset continue check timeouts much less frequently polling maintain time 1000000l running socket properties get so timeout do timeout connection pollset separate keep alive do timeout keep alive pollset	private boolean do poll long pollset int rv poll poll pollset poll time desc true rv keep alive count rv int rv check failed sockets hand socket off worker desc poll apr pollhup poll apr pollhup desc poll apr pollerr poll apr pollerr comet process socket desc socket status open comet process socket desc close socket clear pool comet process socket desc socket status disconnect else destroy socket desc return true else rv int errn rv any non timeup interrupted error critical errn status timeup errn status eintr errn status apr os start usererr errn status apr os start usererr log error sm get string endpoint poll fail errn error strerror errn handle poll critical failure synchronized destroy init return true return false private void do timeout long pollset int rv poll maintain pollset desc true rv keep alive count rv int rv close socket clear pool comet process socket desc socket status timeout else destroy socket desc	get poller add state socket true	get poller add socket get socket long value false
host request mapping data host log access
app base directory log error sm get string host config app base host get name app base get path host set deploy startup false host set auto deploy false
param encoding encoding use encoding must null unsupported encoding specified parameters	given string so encoding lost bytes data get bytes b2cconverter get charset encoding
buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append constants newline buf append stacktrace	err msg buf append constants newline
strip off hostname contextpath note context path may contain context instanceof proxy dir context string cp proxy dir context context get context path string proxy dir context context get host name equals cp start length else start length cp length else
code com sun jndi ldap ldap pool manager code class spawns thread when initialized system property	first access link driver manager trigger loading all link java sql driver current class loader web application level memory leak protection can take care most cases triggering loading here has fewer side effects private boolean driver manager protection true public boolean driver manager protection return driver manager protection public void set driver manager protection boolean driver manager protection driver manager protection driver manager protection	first call loads all drivers current class loader driver manager protection driver manager get drivers attribute name driver manager protection required false first use code java sql driver manager code trigger loading jdbnc driver current class loader web application level memory leak protection can take care most cases triggering loading here has fewer side effects default code true code attribute
http11nio processor processor connections remove socket get socket
connection driver connect driver url properties
catch throwable exception utils handle throwable throw new lifecycle exception sm get string lifecycle base init fail string	catch throwable exception utils handle throwable throw new lifecycle exception sm get string lifecycle base start fail string	catch throwable exception utils handle throwable throw new lifecycle exception sm get string lifecycle base stop fail string	catch throwable exception utils handle throwable throw new lifecycle exception sm get string lifecycle base destroy fail string bug 51610 bug unchecked exception occurs during lifecycle transition web application start ensure component put failed state markt fix fix
manager instanceof persistent manager base loaded persistent manager base manager loaded keys else try manager find session keys null loaded true catch ioexception ioe ignore session expired fix bug 51614 bug avoid two times calls store load session expire persistent manager kfujino fix
protected access log element create access log element string header char pattern	protected access log element create access log element char pattern fix bug 51588 bug make easier extend access log valve add support custom elements markt fix
catch throwable exception utils handle throwable log warn sm get string context config invalid sci handles types class name return fix bug 51586 bug expand error handling cover anything recoverable might recoverable when loading classes during handles types processing markt fix
protected static final boolean http token char new boolean 128	static int 128 32 http token char false else 127 http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char false else http token char true	public abstract boolean parse request line boolean use available data only throws ioexception public abstract boolean parse headers throws ioexception protected abstract boolean fill boolean block throws ioexception	private static final log log log factory get log internal apr input buffer class	else http token char buf pos non token header detected skip line ignore header skip line start return true	private void skip line int start throws ioexception boolean eol false int last real byte start pos start last real byte pos while eol read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants cr skip else buf pos constants lf eol true else last real byte pos pos log debug enabled log debug sm get string iib new string buf start last real byte start charset name iso 8859	private static final log log log factory get log internal input buffer class	else http token char buf pos non token header detected skip line ignore header skip line start return true	private void skip line int start throws ioexception boolean eol false int last real byte start pos start last real byte pos while eol read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants cr skip else buf pos constants lf eol true else last real byte pos pos log debug enabled log debug sm get string iib new string buf start last real byte start charset name iso 8859	enum header parse position header start header name header value header multi line header skipline	else http token char buf pos non token header detected skip line ignore header return skip line	while header parse pos header parse position header skipline return skip line	private header parse status skip line throws ioexception header parse pos header parse position header skipline boolean eol false reading bytes until end line while eol read new bytes needed pos last valid fill true false return header parse status need more data buf pos constants cr skip else buf pos constants lf eol true else header data last significant char pos pos log debug enabled log debug sm get string iib new string buf header data start header data last significant char header data start default charset header parse pos header parse position header start return header parse status have more headers	test public void test bug51557no colon client new bug51557no colon client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test throws exception char http separators new char char http separators do test bug51557char tear down set up test public void test bug51557ctl throws exception int 31 do test bug51557char char tear down set up do test bug51557char char 127 test public void test client new bug 51557no colon foo simple http client crlf bar client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test start client new bug51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test end client new bug51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok private void do test bug51557char char client new bug 51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok bug 51557 test client private class extends simple http client private string header name private string header line public string header name header name header name header line header name public string header name string header value header name header name header line header name header value private exception do request tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root bug51557 new header name root add servlet mapping test bug51557 try tomcat start open connection connect string request new string request get http localhost 8080 test http crlf header line crlf bug51557 abcd crlf connection close crlf crlf set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok get response body null return false get response body contains abcd return false return true private static class extends http servlet private static final long serial version uid 1l private string invalid header name param invalid header name header name should invalid therefore ignored header parsing code public string invalid header name invalid header name invalid header name only interested request headers from get request override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception just echo header value back plain text resp set content type text plain print writer out resp get writer process headers invalid header name req out process headers bug51557 req out private void process headers string header http servlet request req print writer out enumeration string values req get headers header while values has more elements out println values next element fix bug 51557 bug ignore http headers do comply rfc 2616 use header names tokens markt fix
li code threadname code current request thread name can compare later stacktraces li	threadname equals token return new thread name element move set character encoding filter from examples web application add add threadname pattern format token extended access log valve log current request thread name based patch from felix schumacher timw add li current request thread name can compare later stacktraces li li threadname current request thread name can compare later stacktraces li
start init new initializing auto start auto auto stop initialized starting prep starting started destroy auto auto must stop auto auto start stopping prep stopping stopped stop auto must destroy auto destroy destroy failed destroying destroy auto	todo all components may transition from stopped starting prep components should use must destroy signal	state equals lifecycle state new state equals lifecycle state initialized fix bug 51555 bug allow destroy called lifecycle components initialized state markt fix
sm get string coyote response set buffer size ise	sm get string coyote response reset buffer ise	sm get string coyote response reset ise	sm get string coyote response send error ise	sm get string coyote response send error ise	sm get string coyote response send redirect ise bug 41709 bug provide exception messages where message provided currently illegal state excpetions triggered calling http servlet response methods when reponse committed markt fix fix
public static final int ssl protocol all ssl protocol sslv3 ssl protocol tlsv1
string key include get key url include url key starts jar include url new url key else include url ctxt get resource include get key subsection name jasper changelog fix bug 51532 bug jsp files dependencies jars were recompiled every access leading poor performance markt fix changelog subsection
synchronized cache cache put key null synchronized cache return cache contains key key	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license when test fails tends enter long running loop eventually finish after 70s core windows box public void test lru cache concurrency throws exception int thread count long iteration count 100000l assert true thread count lru cache string cache new lru cache string thread count lru test thread threads new lru test thread thread count int thread count threads new lru test thread cache iteration count int thread count threads start int thread count threads join int thread count assert true threads get result private static class lru test thread extends thread private final lru cache string cache private long iteration count private volatile boolean result false public lru test thread lru cache string cache long iteration count cache cache iteration count iteration count public boolean get result return result override public void run string test get name try long iteration count cache add test cache contains test expected catch exception print stack trace return result true bug 51509 bug fix potential concurrency issue csrf prevention filter may lead some requests failing should markt fix fix
digester add call method full prefix absolute ordering others fix bug 51518 bug correct error web xml parsing rules lt others gt tag when using absolute ordering markt fix
socket ref socket sendbb socket ref output buffer position explicit finished socket ref
validate settings before starting get port throw new lifecycle exception sm get string coyote connector invalid port integer value get port tomcat port shutdown message box mb mb ok shutdown port may empty abort config right goto exit end tomcat port http message box mb mb ok http port may empty abort config right goto exit end tomcat port ajp message box mb mb ok ajp port may empty abort config right goto exit end fix bug 51503 bug add additional validation prevents connector from starting does have port markt fix changelog subsection subsection changelog fix bug 51503 bug add additional validation windows installer ensure shutdown port http port ajp port all specified during install process markt fix
tcn full version public static int tcn full version	tcn full version tcn major version 1000 tcn minor version 100 tcn patch version	int value branch can removed once required version least 21 library tcn full version 1120 value ssl ssl protocol all sslv2 equals ignore case sslprotocol value ssl ssl protocol sslv2 else sslv3 equals ignore case sslprotocol value ssl ssl protocol sslv3 else tlsv1 equals ignore case sslprotocol value ssl ssl protocol tlsv1 else sslv2 sslv3 equals ignore case sslprotocol value ssl ssl protocol sslv2 ssl ssl protocol sslv3 else all equals ignore case sslprotocol sslprotocol null sslprotocol length noop use default defined above else protocol recognized fail start safer than continuing default which might enable more than required throw new exception sm get string endpoint apr invalid ssl protocol sslprotocol value ssl ssl protocol none sslprotocol null sslprotocol length value ssl ssl protocol all else string protocol sslprotocol split protocol protocol trim sslv2 equals ignore case protocol value ssl ssl protocol sslv2 else sslv3 equals ignore case protocol value ssl ssl protocol sslv3 else tlsv1 equals ignore case protocol value ssl ssl protocol tlsv1 else all equals ignore case protocol value ssl ssl protocol all else protocol recognized fail start safer than continuing default which might enable more than required throw new exception sm get string endpoint apr invalid ssl protocol sslprotocol bug 51477 bug support all ssl protocol combinations apr native connector only works when using native library version 21 later which yet released rjung update update library apr native connector used native library apr native connector has different settings https than value code all code other acceptable values being code sslv2 code code sslv3 code code tlsv1 code code sslv2 sslv3 code starting version 21 tomcat native library any combination three protocols concatenated plus sign supported note protocol code sslv2 code inherently unsafe
character set used log file code null code system default character set used empty string treated code null code when property assigned protected string encoding null	return character set name used write log file return character set name code null code system default character set used public string get encoding return encoding set character set used write log file param encoding name character set public void set encoding string encoding encoding null encoding length encoding encoding else encoding null	charset charset null encoding null try charset b2cconverter get charset encoding catch unsupported encoding exception ex log error sm get string access log valve unsupported encoding encoding ex charset null charset charset default charset writer new print writer new buffered writer new output stream writer new file output stream pathname true charset 128000 false add bug 46252 bug allow specify character set used write access log access log valve kkolinko add attribute name encoding required false character set used write log file empty string means use system default character set default value use system default character set attribute
protect against npes context destroyed during long running request standard context context null get state available context fire request destroy event request fix bug 51494 bug prevent npe when long running request completes associated web application destroyed while request processing markt fix
param data data decompress return decompressed data byte array output stream bout new byte array output stream int length while length bout write tmp length length gin read tmp return bout byte array	public void test smaller than buffer size throws exception do compress decompress gzip interceptor default buffer size public void test just smaller than buffer size throws exception do compress decompress gzip interceptor default buffer size public void test exact buffer size throws exception do compress decompress gzip interceptor default buffer size public void test just larger than buffer size throws exception do compress decompress gzip interceptor default buffer size public void test size throws exception do compress decompress gzip interceptor default buffer size public void test size throws exception do compress decompress gzip interceptor default buffer size public void test much larger than buffer size throws exception do compress decompress gzip interceptor default buffer size 10 1000 private void do compress decompress int size throws exception byte data new byte size arrays fill data byte
fix me package javax removed prevent hot spot fatal internal errors	package list length definition definition package list else definition package list security set property properties definition fix bug 51473 bug fix values code security config set security property code kkolinko fix
start fix bug 51467 bug invoke thread start rather than thread run so listeners filters stopped separate thread rather than current thread patch provided felix schumacher markt fix
don start host already started	stop host specified name	prevent stopping our own host don stop host already stopped fix bug 51466 bug correct comment typos host manager servlet patch provided felix schumacher markt fix
auth required context get preemptive auth required context get preemptive fix bug 51453 bug fix regression preemptive support enhancement bug 12428 bug could trigger even preemptive disabled markt fix
catch exception throw new elexception message factory get error parse fail expr add broaden exception handling el parser so more failures parse expression include failed expression exception message hopefully help track down cause bug 51088 bug markt add
error response http servlet response sc found	error response http servlet response sc found error response http servlet response sc found acknowledge request try response send catch ioexception ioe container get logger error sm get string standard context valve acknowledge exception ioe request set attribute request dispatcher error exception ioe error response http servlet response sc internal server error return	report error specified resource fixme we private void error http servlet response response int status response send error status	fix bug 51436 bug send 100 continue response earlier enable servlet request listener read request body based patch simon olofsson markt fix
protected static final string manager sm string manager get manager constants package	check	check	check	check	check check	check check	check	check	context null dispatch null event null has original request response true instance manager null listeners clear request null	check	check check	private void check request null async context has been recycled should being used throw new illegal state exception sm get string async context impl request ended
string manager sm client list session sessions get sessions name cn sm client sessions null sessions empty return null session session sessions session get id equals id return session return null fix bug 51447 bug viewing back up session html manager web application longer changes session primary session based patch provided eiji takahashi markt fix
variety add methods configure servlets webapps methods default create simple memory security realm apply you need more complex security processing you can define subclass class class provides set convenience methods configuring webapp contexts all overloads method pre add webapp pre methods create webapp context configure add link host do use global default web xml rather add lifecycle listener adds standard default servlet jsp processing welcome files complex cases you may prefer use ordinary tomcat api create webapp contexts example you might need install custom loader before call link host add child container replicate basic behavior pre add webapp pre methods you may want call three methods class link get default realm link default web xml path link get default web xml listener link get default realm returns simple security realm link get default web xml listener returns link lifecycle listener adds standard default servlet jsp processing welcome files you add listener you must prevent tomcat from applying any standard global web xml link default web xml path returns dummy pathname configure prevent link context config from trying apply global web xml file	private map string list string user roles new hash map string list string private map string principal user principals new hash map string principal	return listener provides required items jsp processing from standard tomcat global web xml pass link context add lifecycle listener lifecycle listener pass result link default web xml path link context config set default web xml string return listener object configures default jsp processing public lifecycle listener get default web xml listener return new default web xml listener return pathname pass link context config set default web xml string when using link get default web xml listener public string default web xml path return org apache catalin startup default xml complex accessor allows callers class obtain simple realm created default return simple memory realm created default public realm get default realm default realm null init simple auth return default realm add bug 51418 bug provide more control over context creation when embedding tomcat based patch benson margulies markt add
ignore fallback defaults set formatter new simple formatter add bug 51403 bug avoid npe juli file handler formatter kkolinko add
protected set session config session config new set session config protected set login config login config new set login config protected set jsp config jsp config new set jsp config	fix bug 51401 bug correctly initialise shared web rule set instance used digesters parse web xml prevent incorrect warnings about multiple occurrences elements only allowed appear once web xml web fragment xml kfujino fix
map string string jsp init params jsp servlet null jsp init params new hash map string string wrapper wrapper context find child jsp null string params find init parameters string param params jsp init params put param find init parameter param else jsp init params jsp servlet get parameter map convert jsp servlet def jsp init params private void convert jsp servlet def servlet def map string string jsp init params	map entry string string init param jsp init params entry set	public void test bug51396 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug51396 jsp bc null assert equals http servlet response sc ok rc assert true bc string contains ok bug 51396 servlet servlet name bug51396 servlet name jsp file bug51396 jsp jsp file servlet licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body fix bug 51396 bug correctly handle jsp file entries web xml when jsp servlet has been configured via code when embedding tomcat markt fix
li format date time any format supported simple date format	org apache catalina valves access log valve	size our global date format cache private static final int global cache size 300 size our thread local date format cache private static final int local cache size 60 cache structure formatted timestamps based seconds cache consists entries consecutive range seconds length range configurable implemented based cyclic buffer new entries shift range one cache clf format access log standard format hash map caches additional formats used simple date format cache threadsafe can used without via thread local instances global cache class uses small thread local first level cache bigger synchronized global second level cache private static class date format cache private class cache clf log format private static final string lfformat dd mmm yyy hh mm ss second used retrieve clf format most recent invocation private long previous seconds 0l value clf format retrieved most recent invocation private string previous format first second contained cache private long first 0l last second contained cache private long last 0l index first cyclic cache private int offset helper object able call simple date format format private final date current date new date private string cache private simple date format formatter private boolean clf false private cache parent null private cache string format cache parent cache new string cache size int cache size cache null format null clf true format lfformat formatter new simple date format format formatter set time zone time zone get default parent parent private string get format long time long seconds time 1000 first step we have seen timestamp during previous call we need clf return previous value seconds previous seconds return previous format second step try locate cache previous seconds seconds int index offset int seconds first cache size index index cache size seconds first seconds last cache index null found so remember next call return previous format cache index return previous format third step found cache adjust cache add item else seconds last cache size seconds first cache size first seconds last first cache size index offset int cache size cache null else seconds last int seconds last cache index cache size cache size null first seconds cache size last seconds else seconds first int first seconds cache index cache size null first seconds last seconds cache size last step format new timestamp either using parent cache locally parent null synchronized parent previous format parent get format time else current date set time time previous format formatter format current date clf string builder current new string builder 32 current append current append previous format current append current append get time zone current date current append previous format current string cache index previous format return previous format private string type number cached entries private int cache size private date format cache parent private cache lfcache private hash map string cache format cache new hash map string cache private date format cache int size date format cache parent parent null type main else type child cache size size parent parent cache parent cache null parent null synchronized parent parent cache parent get cache null lfcache new cache null parent cache private cache get cache string format cache cache format null cache lfcache else cache format cache get format cache null cache parent cache null parent null synchronized parent parent cache parent get cache format cache new cache format parent cache format cache put format cache return cache public string get format string format long time return get cache format get format time global date format cache private static final date format cache global date cache new date format cache global cache size null thread local date format cache private static final thread local date format cache local date cache new thread local date format cache protected date format cache initial value return new date format cache local cache size global date cache private static final thread local date local date new thread local date protected date initial value return new date list our format types private static enum format type clf sec msec msec frac sdf	xxx bit silly we want have start stop time duration consistent would better keep start stop simply request response object remove time duration from interface long start request get coyote request get start time date date get date start time	private static date get date long systime date date local date get date set time systime return date	date stamp file date formatter format new date system current time millis	write date time configurable format default clf format format prefix specifying request start time private static final string request start prefix begin format prefix specifying response end time private static final string response end prefix end separator between optional prefix rest format private static final string prefix separator special format seconds since epoch private static final string sec format sec special format milliseconds since epoch private static final string msec format msec special format millisecond part timestamp private static final string msec fraction format msec frac pattern we use replace millisecond formatting simple date format our own handling private static final string msec pattern our format description string null clf private string format null whether use begin request end response timestamp private boolean uses begin false format type private format type type format type clf whether we need postprocess adding milliseconds private boolean uses msecs false protected date time element null replace millisecond formatting character some dummy characters order make resulting formatted time stamps cacheable we replace dummy chars later actual milliseconds because relatively cheap private void tidy format boolean escape false string builder result new string builder int len format length char int len format char escape result append else result append msec pattern uses msecs true escape escape format result string protected date time element string header format header format null format equals request start prefix uses begin true format else format starts request start prefix prefix separator uses begin true format format substring else format equals response end prefix uses begin false format else format starts response end prefix prefix separator uses begin false format format substring format length type format type clf else format equals sec format type format type sec else format equals msec format type format type msec else format equals msec fraction format type format type msec frac else type format type sdf tidy format long timestamp date get time uses begin timestamp time switch type case clf buf append local date cache get get format null timestamp break case sec buf append timestamp 1000 break case msec buf append timestamp break case msec frac long frac timestamp 1000 frac 100 frac 10 buf append 00 else buf append buf append frac break case sdf string temp local date cache get get format format timestamp uses msecs string msec long string timestamp 1000 temp temp replace msec pattern msec buf append temp break	case return new date time element header fix bug 49165 bug allow any time stamp formats supported simple date format access log valve support logging begin end request rjung fix
match false	public void test check handle types throws exception context config config new context config need context loader class loader check handle types standard context context new standard context context set loader new tester loader config context context add sci has interest any type sci sci none new sci config initializer class map put sci none new hash set class add sci interest servlets sci sci servlet new sci config initializer class map put sci servlet new hash set class config type initializer map put servlet class new hash set servlet container initializer config type initializer map get servlet class add sci servlet add sci interest objects everything sci sci object new sci config initializer class map put sci object new hash set class config type initializer map put object class new hash set servlet container initializer config type initializer map get object class add sci object scan servlet filter servlet listener web xml ignore new web xml file file param class resource org apache catalina startup param servlet config process annotations file file ignore file param class resource org apache catalina startup param filter config process annotations file file ignore file param class resource org apache catalina startup tester servlet config process annotations file file ignore file param class resource org apache catalina startup test listener config process annotations file file ignore check right number classes were noted handled assert equals config initializer class map get sci none size assert equals config initializer class map get sci servlet size assert equals config initializer class map get sci object size private static final class sci implements servlet container initializer override public void startup set class servlet context ctx throws servlet exception op just need class implements sci private static final class tester loader implements loader override public void background process override public class loader get class loader return get class get class loader override public container get container return null override public void set container container container override public boolean get delegate return false override public void set delegate boolean delegate override public string get info return null override public boolean get reloadable return false override public void set reloadable boolean reloadable override public void add property change listener property change listener override public void add repository string repository override public string find repositories return null override public boolean modified return false override public void remove property change listener property change listener fix bug 51386 bug correct code processing handles types annotations so only types interest reported servlet container initializer markt fix
int val2len val2 length val2len val2 char val2 char val2len treat regular expression string expr val2 substring val2len pattern pattern pattern compile expr regular expressions only ever used equal node so return zero equal non zero equal pattern matcher val1 find return else return bug 48956 bug add regular expression support ssi markt add add
td colspan class title td	td class header center small small td td class header center small small td	td class row center small small td td class row center small small td	args new object	args sm get string html manager servlet server hostname args sm get string html manager servlet server ipaddress args new object try inet address address inet address get local host args address get host name args address get host address catch unknown host exception args args	args new object	args sm get string html manager servlet server hostname args sm get string html manager servlet server ipaddress args new object try inet address address inet address get local host args address get host name args address get host address catch unknown host exception args args add bug 43538 bug add host name ip address html manager application patch dennis lundberg markt add
session set max inactive interval get max inactive interval false	notify cluster expired id null manager null subsection name cluster changelog fix bug 51306 bug avoid npe when handle session expired processed while handle session created being processed kfujino fix changelog subsection
renew null least one tokens locks must have been given token list renew tokens elements while token list has more elements string token token list next element header index token renew expires lock expires lock renew fix prevent possible npe when processing web dav locks markt fix
bug 51249 bug further improve system property replacement code class loader log manager tomcat juli cover some corner cases kkolinko fix fix bug 51344 bug fix problem lifecycle re factoring deprecated embedded class prevented events being triggered markt
web rule set rule set rule set web fragment rule set rule set web rule set sync rule set since same rule set shared across all four digesters synchronized rule set	rule set recycle fix bug 51340 bug fix thread safety issue when parsing multiple web xml files parallel apache tomcat does do products embed may markt fix
do flush false	try do flush true initial coyote response send headers initial false bb get length bb flush buffer finally do flush false subsection name catalina changelog fix bug 51324 bug improve handling exceptions when flushing response buffer ensure do flush flag does get stuck enabled state patch provided jeremy norris markt fix changelog subsection licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license abstract catalina task context path web application we managing protected string path null public string get path return path public void set path string path path path context version web application we managing protected string version null public string get version return version public void set version string version version version public methods create query string specified command param command command executed exception build exception error occurs public string builder create query string string command throws build exception string builder buffer new string builder try buffer append command path null throw new build exception must specify path attribute else buffer append path buffer append urlencoder encode path get charset version null buffer append version buffer append urlencoder encode version get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset return buffer
execute create query string reload string	protected string idle null public string get idle return idle public void set idle string idle idle idle override public string builder create query string string command string builder buffer super create query string command path null idle null buffer append idle buffer append idle return buffer	execute create query string sessions string	execute create query string start string	execute create query string stop string	execute create query string undeploy string bug 51251 bug add web application version support ant tasks based patch provided eiji takahashi markt fix fix
jar jar null jar jar factory new instance url jar get input stream sci location	jar null jar close	jar jar null jar jar factory new instance url jar entry exists meta inf resources	jar null jar close	jar jar null input stream jar jar factory new instance url jar next entry string entry name jar get entry name while entry name null null jar get entry input stream process annotations stream fragment finally null try close catch ioexception ioe ignore jar next entry entry name jar get entry name jar null jar close	url url jar conn get url jar jar null input stream null jar jar factory new instance url jar get input stream fragment location null source set byte stream null close catch ioexception ioe ignore jar null jar close fragment set url url	jar jar null input stream jar jar factory new instance jar conn get url jar next entry string entry name jar get entry name while entry name null entry name starts meta inf entry name ends tld null try jar get entry input stream xml error handler handler tld scan stream handler log findings log jar conn get url entry name finally null try close catch ioexception ioe ignore jar next entry entry name jar get entry name log warn sm get string tld config jar fail jar conn get url ioe jar null jar close	jar jar null input stream boolean found tld false jar jar factory new instance jar conn get url jar next entry string entry name jar get entry name while entry name null entry name starts meta inf entry name ends tld null try jar get entry input stream found tld true tld scan stream resource path entry name finally null try close catch ioexception ioe ignore jar next entry entry name jar get entry name jar null jar close	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link jar optimised file based jar urls urls form jar file private jar file jar file private enumeration jar entry entries private jar entry entry null public file url jar url url throws ioexception jar jar conn jar url open connection jar file jar conn get jar file override public boolean entry exists string name zip entry entry jar file get entry name return entry null override public input stream get input stream string name throws ioexception zip entry entry jar file get entry name entry null return null else return jar file get input stream entry override public void close jar file null try jar file close catch ioexception ignore override public void next entry entries null entries jar file entries entries has more elements entry entries next element else entry null override public string get entry name entry null return null else return entry get name override public input stream get entry input stream throws ioexception entry null return null else return jar file get input stream entry override public void reset throws ioexception entries null entry null	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides abstraction use various classes need scan jars classes provided jre accessing jars link jar file link jar input stream have different performance depending form url used access jar file based jar link url link jar file faster non file based link url link jar file creates copy jar temporary directory so link jar input stream faster determines specific entry exists within jar param name entry look return code true code specified entry exists else code false code boolean entry exists string name throws ioexception obtain link input stream given entry jar caller responsible closing stream param name entry obtain link input stream return link input stream specified entry null entry does exist input stream get input stream string name throws ioexception close any resources associated jar void close moves internal pointer next entry jar void next entry obtains name current entry return entry name string get entry name obtains input stream current entry return input stream throws ioexception stream cannot obtained input stream get entry input stream throws ioexception resets internal pointer used track jar entries beginning jar throws ioexception pointer cannot reset void reset throws ioexception	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provide mechanism obtain objects implement link jar private jar factory factory class hide public constructor public static jar new instance url url throws ioexception string jar url url string jar url starts jar file return new file url jar url else return new url jar url	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link jar optimised non file based jar urls jndi based urls form jar jndi private non closing jar input stream jar input stream null private url url null private jar entry entry null public url jar url url throws ioexception url url jar input stream create jar input stream override public boolean entry exists string name throws ioexception jar entry entry jar input stream get next jar entry while entry null name equals entry get name break entry jar input stream get next jar entry return entry null override public input stream get input stream string name throws ioexception jar entry entry jar input stream get next jar entry while entry null name equals entry get name break entry jar input stream get next jar entry entry null return null else return jar input stream override public void close jar input stream null try jar input stream really close catch ioexception ioe ignore private non closing jar input stream create jar input stream throws ioexception jar jar conn jar url open connection url resource url jar conn get jar file url resource conn resource url open connection resource conn set use caches false return new non closing jar input stream resource conn get input stream override public void next entry try entry jar input stream get next jar entry catch ioexception ioe entry null override public string get entry name entry null return null else return entry get name override public input stream get entry input stream throws ioexception return jar input stream override public void reset throws ioexception close jar input stream create jar input stream bug 51276 bug provide abstraction accessing content jars so most efficient method can selected depending type url used identify jar improves startup time when jars located catalina base lib mark fix fix
string login page config get login page login page null login page length string msg sm get string form login page context get name log warn msg response send error http servlet response sc internal server error msg return context get servlet context get request dispatcher login page	string error page config get error page error page null error page length string msg sm get string form error page context get name log warn msg response send error http servlet response sc internal server error msg return fix bug 51277 bug improve error message application deployed incomplete form markt fix
private volatile limit latch connection limit latch null	public void set max connections int max con max connections max con limit latch latch connection limit latch update latch enforces latch set limit max con	protected limit latch initialize connection latch connection limit latch null connection limit latch new limit latch get max connections return connection limit latch limit latch latch connection limit latch connection limit latch null protected void count up await connection throws interrupted exception limit latch latch connection limit latch latch null latch count up await limit latch latch connection limit latch	count up await connection	count up await connection	count up await connection	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license shared latch allows latch acquired limited number times after which all subsequent requests acquire latch placed fifo queue until one shares returned private class sync extends abstract queued synchronizer private static final long serial version uid 1l public sync override protected int try acquire shared int ignored long new count count increment get released new count limit limit exceeded count decrement get return else return override protected boolean try release shared int arg count decrement get return true private final sync sync private final atomic long count private volatile long limit private volatile boolean released false instantiates limit latch object initial limit param limit maximum number concurrent acquisitions latch public limit latch long limit limit limit count new atomic long sync new sync obtain current limit public long get limit return limit sets new limit limit decreased may period where more shares latch acquired than limit case more shares latch issued until sufficient shares have been returned reduce number acquired shares latch below new limit limit increased threads currently queue may issued one newly available shares until next request made latch param limit new limit public void set limit long limit limit limit acquires shared latch one available waits one shared latch current available public void count up await throws interrupted exception sync acquire shared releases shared latch making available another thread use return previous counter value public long count down sync release shared return count get releases all waiting threads causes link limit ignored until link reset called public boolean release all released true return sync release shared resets latch initializes shared acquisition counter zero see release all public void reset count set released false returns code true code least one thread waiting acquire shared lock otherwise returns code false code public boolean has queued threads return sync has queued threads provide access list threads waiting acquire limited shared latch public collection thread get queued threads return sync get queued threads	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private volatile limit latch latch null override public void tear down limit latch temp latch temp null temp release all latch null public void test threads throws exception latch new limit latch assert equals threads should waiting false latch has queued threads public void test one thread wait throws exception latch new limit latch assert equals threads should waiting false latch has queued threads thread test thread new test thread test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch count up await thread sleep 50 assert equals threads should waiting false latch has queued threads public void test one thread wait count up throws exception latch new limit latch assert equals threads should waiting false latch has queued threads thread test thread new test thread latch count up await test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch count down thread sleep 50 assert equals threads should waiting false latch has queued threads public void test one release throws exception latch new limit latch assert equals threads should waiting false latch has queued threads thread test thread new test thread latch count up await test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch release all thread sleep 50 assert equals threads should waiting false latch has queued threads public void test ten wait throws exception latch new limit latch 10 assert equals threads should waiting false latch has queued threads thread test thread new test thread 30 int 30 test thread new test thread 1000 test thread start thread sleep 50 assert equals 20 threads should waiting 20 latch get queued threads size thread sleep 1000 assert equals 10 threads should waiting 10 latch get queued threads size thread sleep 1000 assert equals threads should waiting false latch has queued threads private class test thread extends thread private int hold time public test thread 100 public test thread int hold time hold time hold time override public void run try latch count up await thread sleep hold time latch count down catch interrupted exception print stack trace fix bug 51240 bug ensure max connections limit enforced when multiple acceptor threads configured markt fix licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license ant task implements code findleaks code command supported tomcat manager application private boolean status line true sets status line parameter controls response includes status line public void set status line boolean status line status line status line returns status line parameter controls response includes status line public boolean get status line return status line execute requested operation exception build exception error occurs override public void execute throws build exception super execute execute findleaks status line boolean string status line
super findleaks false print writer sm client string writer text string writer string writer text length writer text starts fail msg append sm client get string html manager servlet findleaks list msg append writer text	boolean status line false true equals request get parameter status line status line true	findleaks status line writer sm client	protected void findleaks boolean status line print writer writer string manager sm client	results length status line writer println sm client get string manager servlet findleaks list string result results equals result result writer println result else status line writer println sm client get string manager servlet findleaks none lt taskdef name findleaks classname org apache catalina ant find leaks task gt
ie protected boolean secure pages pragma false	request secure note can cause problems downloading files ie bug 27122 bug remove workaround very old since fixed mozilla bug change default value secure pages pragma attribute valves false changes should reduce likelihood issues when downloading files ie markt fix fix set default value code false code used set default value code false code used set default value code false code used set default value code false code used set default value code false code used
public connection pool create pool throws sqlexception pool null return pool else return create pool sets up connection pool creating pooling driver return driver throws sqlexception private synchronized connection pool create pool throws sqlexception
dirs directory dirs mkdirs bug 35054 bug check file specified host apos app base log error markt fix fix
private static final boolean pool tags extends boolean get boolean org apache jasper compiler generator var	page info get extends false null pool tags extends subsection name jasper changelog add bug 51220 bug add system property enable tag pooling jsps use custom base class based patch dan mikusa markt add changelog subsection property name org apache jasper compiler generator pool tags extends default jsps use own base class via extends attribute page directive have tag pooling disabled since jasper cannot guarantee necessary have taken place can have negative impact performance providing alternative base class calls jsp init from servlet init setting property code true code enable pooling alternative base class alternative base class does call jsp init property code true code npes occur when attempting use tags specified default value code false code used property fix bug 51229 bug fix bugs servlet asynchronous examples patch provided eiji takahashi markt fix
req get async context complete href response encode url examples async stockticker stock ticker
private volatile int nr invocations private volatile long max invocation time long min value private volatile long max invocation date private volatile long min invocation time long max value private volatile long min invocation date private volatile long total invocation time private volatile long failures private volatile int prepare count private volatile long prepare time
definitions add property new interceptor property prop name prop value
td class row left bgcolor 13	tr tr td class row left bgcolor 13 form method post action small nbsp input type submit value nbsp 10 nbsp input type text name idle size value 11 nbsp 12 nbsp small form td tr fix bug 51156 bug ensure session expiration option available manager application running web applications were defined server xml markt fix
deprecated jsp replaced javax el elexception	deprecated jsp replaced javax el elexception	deprecated jsp replaced javax el value expression	deprecated jsp replaced javax el expression factory	deprecated jsp replaced javax el function mapper	deprecated jsp replaced javax el elresolver fix bug 51155 bug add comments deprecated tags have none patch provided sebb markt fix
fix bug 51154 bug remove duplicate deprecated tags servlet context javadoc patch provided sebb markt fix
add delta request delta request null exclude name delta request set attribute name value	add delta request delta request null exclude name delta request remove attribute name subsection name cluster changelog fix bug 50950 bug correct possible serializable exception session when running security manager markt fix changelog subsection
lc new login context get login config name	final gssmanager manager gssmanager get instance final privileged exception action action new privileged exception action override public run throws gssexception return manager create credential null default lifetime new oid accept only gss context manager create context subject do lc get subject action	store delegated credential	catch privileged action exception log error sm get string spnego service login fail response set header www authenticate negotiate response send error http servlet response sc unauthorized return false fix bug 51099 bug correctly implement non default login configured via login config name attribute spnego fhanik markt fix
protected string login module name null	login module name system get property com sun management jmxremote login config	env put jmx remote login config login module name bug 51119 bug add jaas support jmxremote lifecycle listener patch provided neil laurance markt add add
cb new char constants default tag buffer size buffer size cb length	cb new char constants default tag buffer size buffer size cb length	char tmp new char cb length len buffer size cb length add bug 51124 bug refactor body content impl assist determining root cause bug based patch ramiro markt add
return add context host context path context path dir public context add context host host string context path string context name string dir ctx set name context name ctx set path context path	return add webapp host url url path public context add webapp host host string url string name string path ctx set name name ctx set path url add bug 51136 bug provide methods enable name context context creation when using tomcat embedded scenario based patch provided david calavera markt add
return fix bug 51095 bug don apos trigger null pointer exception when ssl handshake fails http apr connector patch provided mike glazer markt fix
else all equals ignore case sslprotocol sslprotocol null sslprotocol length noop use default defined above else protocol recognized fail start safer than continuing default which might enable more than required throw new exception sm get string endpoint apr invalid ssl protocol sslprotocol fix bug 51073 bug throw exception do start apr connector configured ssl invalid value provided sslprotocol markt fix
set session identifier session notifies any associated listeners new session has been created	set session identifier session optionally notifies any associated listeners new session has been created param id new session identifier param notify should any associated listeners notified new session has been created public void set id string id boolean notify	session set id msg get session id notify session listeners replication	session set id new session id notify listeners replication	inherit doc override public void set id string id boolean notify super set id id notify	catalina session set id new session id false	public void set id string id boolean notify session id id ignore notify override	session set id generate session id false	set id id true inherit doc override public void set id string id boolean notify	notify tell new fix bug 51042 bug don apos trigger session creation listeners when session id changed part process markt fix
context request get mapping data context log access request response system current time millis req get start time false	time request process need allow threads start etc private static final long request time 500 timeout thread where used checks timeout every second private static final long timeout margin 1000	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries assert equals 200 entry get status assert true entry string entry get time async start complete servlet async timeout assert true entry string entry get time async start complete servlet async timeout timeout margin request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time request time	public static final long thread sleep time 1000	thread sleep thread sleep time	public static final long thread sleep time 1000	thread sleep thread sleep time	public static final long async timeout 1000	actxt set timeout async timeout	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time timeout servlet async timeout assert true entry string entry get time timeout servlet async timeout timeout margin request time	public static final long async timeout 3000	ac set timeout async timeout	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time assert true entry string entry get time request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time timeout servlet async timeout assert true entry string entry get time timeout servlet async timeout timeout margin request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time assert true entry string entry get time request time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time async start runnable thread sleep time assert true entry string entry get time async start runnable thread sleep time request time public static final long thread sleep time 3000	thread sleep thread sleep time	tester access log valve alv new tester access log valve ctx get pipeline add valve alv	check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time public static final long thread sleep time 5000	thread sleep thread sleep time	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private list entry entries new array list entry public tester access log valve async requests supported super true override public void log request request response response long time entries add new entry request get request uri response get status time override public void set request attributes enabled boolean request attributes enabled noop test code override public boolean get request attributes enabled always false test code return false override public void invoke request request response response throws ioexception servlet exception just invoke next access logging happens via log method get next invoke request response public list entry get entries return entries public static class entry private string uri private int status private long time public entry string uri int status long time uri uri status status time time public string get uri return uri public int get status return status public long get time return time override public string string return uri uri status status time time fix bug 51038 bug ensure asynchronous requests included access logs markt fix
web xml fragment new web xml	fragment set url file uri url fragment get name null fragment set name fragment get url string fragments put fragment get name fragment	else scan all directories int start path last index name path substring start fix bug 50997 bug relax requirement directories must have name ending code jar code treated expanded jar file default jar scanner based patch rodion zhitomirsky markt fix
file null required throw new exception sm get string endpoint apr ssl cert file bug 50927 bug improve error message when file specified when using apr ssl based patch provided sebb markt fix fix
throw new illegal argument exception get message	throw new illegal argument exception get message	throw new runtime exception get message	throw new runtime exception get message	throw new runtime exception get message	throw new runtime exception get message	throw new runtime exception get message	throw new sqlexception get message	throw new sqlexception get message	throw new ioexception get message	throw new saxexception get message	throw new saxexception get message	throw new saxexception get message	throw new saxexception get message fix bug 50929 bug when wrapping exception include root cause patch provided sebb markt fix
endpoint paused 503 service unavailable response set status 503 adapter log request response error true	endpoint paused 503 service unavailable response set status 503 adapter log request response error true else break endpoint paused request set start time system current time millis kept alive true disable upload timeout socket timeout set socket ref connection upload timeout 1000 input buffer parse headers	endpoint paused 503 service unavailable response set status 503 adapter log request response error true else break endpoint paused kept alive true input buffer parse headers we ve read part request don recycle instead associate socket open socket true recycle false break request set start time system current time millis disable upload timeout only body request headers socket get iochannel socket set so timeout connection upload timeout	endpoint paused 503 service unavailable response set status 503 adapter log request response error true request set start time system current time millis kept alive true disable upload timeout socket get socket set so timeout so timeout else socket get socket set so timeout connection upload timeout input buffer parse headers	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test cases link connector public void test stop throws exception tomcat tomcat get tomcat instance context root tomcat add context temp dir wrapper tomcat add servlet root tester new tester servlet set async supported true root add servlet mapping tester connector connector tomcat get connector tomcat start byte chunk bc new byte chunk int rc get url http localhost get port bc null null assert equals 200 rc assert equals ok bc string rc bc recycle connector stop rc get url http localhost get port bc 1000 null null assert equals 503 rc	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain print writer out resp get writer out print ok	public static final string temp dir system get property java io tmpdir	return get url path out 1000000 req head res head public static int get url string path byte chunk out int read timeout map string list string req head map string list string res head throws ioexception connection set use caches false connection set read timeout read timeout fix bug 50903 bug when connector stopped ensure requests currently keep alive state waiting client data processed requests where processing has started continue completion markt fix
private static final log log log factory get log sslvalve class	string provider name string request get connector get property client cert provider certificate factory cf provider name null cf certificate factory get instance 509 else cf certificate factory get instance 509 provider name catch provider exception log error sm get string ssl valve invalid provider provider name	when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider	when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider	certificate factory cf client cert provider null cf certificate factory get instance 509 else cf certificate factory get instance 509 client cert provider	catch provider exception get log error sm get string ajpprocessor certs fail return	processor set client cert provider proto get client cert provider	processor set client cert provider proto get client cert provider	when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider	certificate factory cf client cert provider null cf certificate factory get instance 509 else cf certificate factory get instance 509 client cert provider	processor set client cert provider proto get client cert provider subsection name coyote changelog add bug 50887 bug add support configuring jsse provider used convert client certificates based patch pknopp markt add changelog subsection attribute name client cert provider required false when client certificate information presented form other than instances code java security cert code needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors href http html http apr connector href valve html ssl valve org apache catalina valves sslvalve specified default provider used attribute attribute name client cert provider required false when client certificate information presented form other than instances code java security cert code needs converted before can used property controls which jsse provider used perform conversion example used href ajp html ajp connectors http apr connector href valve html ssl valve org apache catalina valves sslvalve specified default provider used attribute
clazz class name class name false tccl fix bug 50895 bug don apos initialize classes created during compilation stage markt fix
binding thread class loader old ccl bind thread	clean up close those resources explicit close may help clean up faster private void clean up resources size return javax naming context ctxt try container instanceof server ctxt server container get global naming context else ctxt context bindings get class loader ctxt javax naming context ctxt lookup comp env catch naming exception log warn sm get string naming resources cleanup context container return context resource cr resources values data source class get name equals cr get type string name cr get name data source ds try ds data source ctxt lookup name catch naming exception log warn sm get string naming resources cleanup resource cr get name container continue clean up ds name closing database connection pool close open connections happen gc leaves db connections open may cause issues param ds data source close private void clean up data source ds string name look zero arg close method method null try ds get class get method close class null catch security exception log debug sm get string naming resources cleanup close security name container return catch method exception log debug sm get string naming resources cleanup close name container return null try invoke ds object null catch illegal argument exception log warn sm get string naming resources cleanup close failed name container catch illegal access exception log warn sm get string naming resources cleanup close failed name container catch invocation target exception log warn sm get string naming resources cleanup close failed name container add bug 25060 bug close apache commons dbcp datasources when associated jndi naming context stopped non global data source resource web application reload close remaining database connections immediately rather than waiting garbage collection markt add add add add add
dir context urlstream handler factory get instance	factory stream handlers jndi directory context also supports users specifying additional stream handler implements urlstream handler factory singleton private static dir context urlstream handler factory instance new dir context urlstream handler factory public static dir context urlstream handler factory get instance return instance public static void add user factory urlstream handler factory factory instance user factories add factory private list urlstream handler factory user factories new copy write array list urlstream handler factory private dir context urlstream handler factory hide default constructor	urlstream handler factory factory user factories urlstream handler handler factory create urlstream handler protocol handler null return handler	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test user supplied factory throws exception url url null initially unknown try url new url foo www apache org catch malformed urlexception ignore ignore assert null url set factory url set urlstream handler factory dir context urlstream handler factory get instance still unknown try url new url foo www apache org catch malformed urlexception ignore ignore assert null url register user factory dir context urlstream handler factory add user factory new foo urlstream handler factory now works try url new url foo www apache org catch malformed urlexception ignore ignore assert null url public static class foo urlstream handler factory implements urlstream handler factory override public urlstream handler create urlstream handler string protocol foo equals protocol good enough test actual use return new dir context urlstream handler else return null bug 26701 bug provide mechanism users register own code urlstream handler factory code objects markt fix fix
log debug enabled string name principal null none principal get name log debug name type auth type subsection name catalina changelog fix bug 50855 bug fix npe http servlet request logout when debug logging enabled markt fix changelog subsection
try pooled connection pc borrow connection null null pc null return new connection future pc catch sqlexception get message index wait throw
throw new file found exception get url null null get url string	throw new file found exception get url null null get url string	throw new file found exception get url null null get url string	throw new file found exception get url null null get url string bug 27988 bug improve reporting missing files markt fix fix
bean bean try execute jmxproxy get urlencoder encode bean get charset att urlencoder encode attribute get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset	string query string query null query string else try query string qry urlencoder encode query get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset	try execute jmxproxy set urlencoder encode bean get charset att urlencoder encode attribute get charset val urlencoder encode value get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset	try execute resources type urlencoder encode type get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset	try execute undeploy path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset subsection name catalina changelog fix bug 28852 bug add url encoding where missing parameters urls presented ant tasks manager application based patch stephane bailliez mark fix changelog subsection
remove leading trailing whitespace can lead hard diagnose failures system set property name trim value trim bug 31027 bug trim whitespace from names values obtained from code catalina base conf catalina properties code avoid hard diagnose errors startup markt fix fix
valid state transitions components support link lifecycle	stop must destroy	get life cycle listeners associated life cycle component has listeners registered zero length array returned	prepare beginning active use public methods other than property getters setters life cycle methods component method should called before any public methods other than property getters setters life cycle methods component utilized following link lifecycle event fired following order	public methods other than property getters setters life cycle methods may used li	gracefully terminate active use public methods other than property getters setters life cycle methods component once stop event fired public methods other than property getters setters life cycle methods should used following link lifecycle event fired following order	public methods other than property getters setters life cycle methods may longer used li note from link lifecycle state failed three events above fired component transition directly from link lifecycle state failed link lifecycle state stopping bypassing link lifecycle state stopping prep	lifecycle interface listener fired after associated state change has taken place	must destroy false null	may public methods other than property getters setters lifecycle methods called component state returns code true code any component any following states ul li link starting li li link started li li link stopping prep li li link must stop li ul	state equals lifecycle state failed don transition stopping prep would briefly mark component available do ensure before stop event fired fire lifecycle event before stop event null else set state internal lifecycle state stopping prep null false	stop internal permits stopping prep stopping failed stopping state lifecycle state stopping state lifecycle state failed fix bug 50836 bug better meaning code lifecycle available code correct couple cases where could incorrectly return true markt fix
secure nio channel ssl channel secure nio channel socket sslengine engine ssl channel get ssl engine engine get need client auth engine get want client auth need re negotiate ssl connection engine set need client auth true try ssl channel rehandshake ssl support new jssefactory get sslsupport engine get session catch ioexception ioe log warn sm get string socket sslreneg ioe use force false since re negotiation handled above op nio anyway object ssl ssl support get peer certificate chain false	public boolean handshake complete	protected boolean handshake complete false protected handshake status handshake status gets set begin handshake	handshake complete false handshake status ssl engine get handshake status	handshake complete return we have done our initial handshake while handshake complete switch handshake status handshake complete net out buffer has remaining return handshake complete selection key op write handshake status handshake status need task handshake status tasks handshake status handshake status need unwrap flush net out buffer	handshake status handshake status need task handshake status tasks throw new ioexception invalid handshake status handshake status during handshake unwrap handshake status tasks default throw new illegal state exception invalid handshake status handshake status return handshake complete selection key op write selection key op read	handshake status result get handshake status	handshake status result get handshake status handshake status tasks handshake status handshake status need unwrap public void rehandshake throws ioexception int read buf limit get buf handler get read buffer limit try expand read buffer maximum allow handshaking take place get buf handler get read buffer limit get buf handler get read buffer capacity ssl engine get session invalidate ssl engine begin handshake handshake complete false handshake status ssl engine get handshake status while handshake complete handshake true true handshake status handshake status need unwrap handshake unwrap true finally restore pre handshak value get buf handler get read buffer limit read buf limit	handshake complete throw new illegal state exception handshake incomplete you must complete handshake before reading data	public boolean handshake complete return handshake complete add bug 49284 bug add ssl re negotiation support http nio connector markt add
state new when destroy called object name never have been set so notification can created get object name null send j2ee object deleted notification notification notification new notification j2ee object deleted get object name sequence number get increment broadcaster send notification notification	public void test bug50826 throws exception tomcat tomcat get tomcat instance string context path examples file app dir new file get build directory webapps context path app dir relative server home tomcat add webapp null examples app dir get absolute path exception null try tomcat destroy catch exception ex ex print stack trace ex assert null new crawler session manager valve ensures crawlers fix bug 50826 bug avoid code illegal argument exception code embedded tomcat instance includes least one context destroyed without ever being started markt fix
code role base code protected message format role base format null message format object associated current	role base null role base format null else role base format new message format role base	string base null role base format null name parser np context get name parser name name np parse dn string name parts new string name size int name size name parts name get base role base format format name parts results context search base filter controls add bug 21669 bug add ability specify role base jndi realm relative users dn based patch art markt add base directory entry performing role searches specified top level element directory context used specified may optionally include pattern replacements quot quot quot quot name parts user name returned code javax naming name get code
when searching user roles should search performed user currently being false link connection name link connection password used specified else anonymous connection used protected boolean role search user false	naming enumeration search result results null try role search user user credentials add context dn user get password results context search role base filter controls finally role search user user credentials remove context add bug 19444 bug add option jndi realm allow role searches performed user markt add attribute name role search user required false when searching user roles should search performed user currently being false code connection name code code connection password code used specified else anonymous specified default value code false code used attribute
request should have been completely read time response closed further reads input pointless really confuse ajp bug 50189 so close input buffer prevent them request req request coyote response get request get note coyote adapter adapter notes req input buffer close bug 50189 bug once application has finished writing response prevent further reads from request since causes various problems connectors which do expect markt fix fix
list naming entry bindings do list bindings name list naming entry alt bindings null alt dir context instanceof base dir context alt bindings base dir context alt dir context do list bindings alt bindings null bindings null bindings alt bindings else bindings add all alt bindings bindings null return new naming context bindings enumeration bindings iterator	protected abstract list naming entry do list bindings string name	protected list naming entry do list bindings string name	return list file	protected list naming entry list file file list naming entry entries new array list naming entry	protected list naming entry list file file list naming entry entries super list file	protected list naming entry do list bindings string str name return list entries return list entry fix bug 50802 bug ensure code servlet context get resource paths code includes static resources packaged jar files its output markt fix
subsection name coyote changelog fix bug 50780 bug fix memory leak apr ajp connector introduced refactoring bug 49884 bug markt fix changelog subsection
configure whether requests listeners fired forwards context public void set fire request listeners forwards boolean enable determine whether requests listeners fired forwards context public boolean get fire request listeners forwards	boolean do invoke true context get fire request listeners forwards context fire request init event request do invoke false do invoke dis int dispatcher type error state outer request set attribute application filter factory dispatcher request path attr get combined path state outer request set attribute application filter factory dispatcher type attr dispatcher type forward invoke state outer request response state else invoke state outer request response state context get fire request listeners forwards context fire request destroy event request	private boolean fire request listeners forwards false override public void set fire request listeners forwards boolean enable fire request listeners forwards enable override public boolean get fire request listeners forwards return fire request listeners forwards bug 50789 bug provide option enable servlet request listeners forwards required some cdi frameworks markt fix fix attribute name fire request listeners forwards required false set code true code fire any configured servlet request listeners when tomcat forwards request primarily use users cdi frameworks use servlet request listeners configure necessary environment request specified default value code false code used attribute
method name equals get name get parameter types length param count	base resolver invoke ctx base suffix null mps get parameters ctx	public void test bug50790a throws exception value expression ve factory create value expression context bean aa name contains bean name java lang boolean class boolean actual boolean ve get value context assert equals boolean true actual public void test bug50790b throws exception value expression ve factory create value expression context bean name contains bean aa name java lang boolean class boolean actual boolean ve get value context assert equals boolean false actual fix bug 50790 bug improve method resolution el expressions markt fix
request async comet error timeout need tell listeners request over have test first since state may change while method only required entering methos state context ctxt context request get mapping data context ctxt null ctxt fire request destroy event request	servlet request event event new servlet request event get servlet context request int instances length instances null continue instances instanceof servlet request listener continue servlet request listener listener servlet request listener instances try listener request initialized event catch throwable exception utils handle throwable get logger error sm get string standard context request listener request init instances get class get name request set attribute request dispatcher error exception return false	servlet request event event new servlet request event get servlet context request int instances length int instances length instances null continue instances instanceof servlet request listener continue servlet request listener listener servlet request listener instances try listener request destroyed event catch throwable exception utils handle throwable get logger error sm get string standard context request listener request init instances get class get name request set attribute request dispatcher error exception return false	don fire listeners during async processing boolean async start request async async start context fire request init event request request async start error occurred async error handling kick fire request destroyed event after error handling has taken place request async async start request get attribute request dispatcher error exception null context fire request destroy event request	ctx add application listener tracking request listener class get name string builder expected new string builder request initialized	expected append request destroyed	ctx add application listener tracking request listener class get name	string builder expected new string builder request initialized expected append request destroyed	public static class tracking request listener implements servlet request listener override public void request destroyed servlet request event sre need response isn available via servlet api request request sre get servlet request try get response get writer print request destroyed catch ioexception test fail happens print stack trace override public void request initialized servlet request event sre need response isn available via servlet api request request sre get servlet request try get response get writer print request initialized catch ioexception test fail happens print stack trace	ctx add application listener tracking request listener class get name	string builder expected new string builder request initialized	expected append error servlet get error complete request destroyed fix bug 50793 bug when processing servlet async requests ensure request initialized request destroyed events only fired once per request correct times markt fix
subsection name wep applications changelog fix bug 50713 bug remove roles command from manager application markt fix changelog subsection rev 1068549 rev bug 50667 bug allow rpc callers get confirmation when sending reply fhanik
map string string merged params new hash map string string merged params put names find parameter names merged params get params get name null merged params put params get name merged params put params get name params get value servlet context sc get servlet context map entry string string entry merged params entry set sc set init parameter entry get key entry get value bug 50700 bug ensure override attribute context parameters correctly followed markt fix fix
public static final int type authtype	public static final string name authtype set authtype	public void set auth type string auth type int action auth type null action remove action set add action type authtype action name authtype auth type	case type authtype string auth type null info get action action set auth type string info get value session set auth type auth type false break case	set type used authenticate our cached principal any param auth type new cached type override public void set auth type string auth type set auth type auth type true public void set auth type string auth type boolean add delta request try lock super set auth type auth type add delta request delta request null delta request set auth type auth type finally unlock subsection name cluster changelog fix bug 50771 bug ensure http servlet request get auth type returns name scheme request has already been kfujino fix changelog subsection
utf up bytes per character string constants limited 64k bytes limit string constants here 16k characters int text index int text length text length while text index text length int len text length text index 16384 len 16384 else len text length text index string output text substring text index text index len string char array name text map get output char array name null char array name jspx char array char array count text map put output char array name ca out printin static char ca out print char array name ca out print ca out print quote output ca out println char array set begin java line out get java line out printil out write char array name set end java line out get java line text index text index len fix bug 50726 bug ensure use gen string char array does result string constants too long valid java code markt fix
pool properties get validator validate connection validate action last validated now return true else return false
attributes requested need look them attr ids null attr ids length return new user username dn null null bug 50751 bug when jndi realm only attempt read user attributes from directory attributes required markt fix fix
log debug initial context factory already set value fix bug 50752 bug fix typo debug message deprecated embedded class markt fix
private input stream stream private input source source	source new input source new string reader web xml source null	stream uri open stream source new input source stream	source null stream uri open stream source new input source stream source null source set system id system id	return source stream null stream close subsection name jasper changelog fix bug 50720 bug ensure use non iso 8859 character sets web xml does trigger error when jasper parses web xml file markt fix changelog subsection
ix len	public void test urldecode string invalid	public void test urldecode string valid string result request util urldecode 41xxxx iso 8859 assert equals axxxx result public void test urldecode string valid string result request util urldecode xx 41xx iso 8859 assert equals xx axx result public void test urldecode string valid iso88591end string result request util urldecode xxxx 41 iso 8859 assert equals xxxx result public void test urldecode string valid utf8start string result request util urldecode c3 aaxxxx utf assert equals u00eaxxxx result public void test urldecode string valid utf8middle string result request util urldecode xx c3 aaxx utf assert equals xx u00eaxx result public void test urldecode string valid utf8end string result request util urldecode xxxx c3 aa utf assert equals xxxx u00ea result bug 50721 bug correctly handle url decoding where url ends nn patch provided christof marti markt fix fix point response committed when writer being used markt
fix bug 50709 bug make code application context facade code non final enable extension markt fix
private volatile boolean stop await false thread currently inside our await method private volatile thread await thread null server socket used wait shutdown command private volatile server socket await socket null	thread await thread null server socket await socket null await socket null try close catch ioexception ignored interrupt try join 1000 catch interrupted exception ignored	try await thread thread current thread while stop await try thread sleep 10000 catch interrupted exception ex finally await thread null return await socket new server socket port inet address get name address return try await thread thread current thread loop waiting connection valid command while stop await server socket server socket await socket server socket null break wait next connection socket socket null string builder command new string builder input stream stream try socket server socket accept socket set so timeout 10 1000 ten seconds stream socket get input stream catch access control exception ace log warn standard server accept security exception ace get message ace continue catch ioexception stop await wait aborted socket close break log error standard server await accept break read set characters from socket int expected 1024 cut off avoid do attack while expected shutdown length random null random new random expected random next int 1024 while expected int ch try ch stream read catch ioexception log warn standard server await read ch ch 32 control character eof terminates loop break command append char ch expected finally close socket now we done try socket null socket close catch ioexception ignore match against our command string boolean match command string equals shutdown match log info sm get string standard server shutdown via port else log warn standard server await invalid command command string received finally server socket server socket await socket await thread null await socket null close server socket return server socket null try server socket close catch ioexception ignore	await thread null	server get server null	try stop catch lifecycle exception log error catalina stop return get server get port socket socket new socket get address get port	server get server lifecycle state state get state lifecycle state stopping prep compare state lifecycle state destroyed compare state nothing do stop already called else stop bug 50673 bug improve catalina shutdown when running service do call system exit kkolinko fix fix bug 50683 bug ensure annotations scanned when code unpack wars code set code false code host where web application deployed markt
header buffer size header buffer size	maximum allowed size http request line plus headers private final int header buffer size known size nio channel read buffer private int socket read buffer size additional size we allocate buffer more effective when skipping empty lines may precede request private static final int skip blank lines size 1024 how many bytes buffer occupied skipped blank lines precede request private int skip blank lines bytes	socket read buffer size socket get buf handler get read buffer capacity int buf length skip blank lines size header buffer size socket read buffer size buf null buf length buf length buf new byte buf length	ignore bytes were read pos last valid pos skip blank lines size move data have enough space further reading headers body system arraycopy buf pos buf last valid pos last valid pos pos skip blank lines bytes pos parsing request line start pos	parsing header throw new illegal argument exception sm get string iib error should happen log warn expanding buffer size old size buf length new size newsize new exception	checking headers plus request line size does exceed its limit enough bytes avoid expanding buffer when reading body technically technical limitation logical limitation enforce meaning header buffer size from way how buf allocated how blank lines being read should enough check only end skip blank lines bytes header buffer size buf length end socket read buffer size throw new illegal argument exception sm get string iib error	last valid pos end fix bug 50631 bug internal nio input buffer should honor code max http head size code kkolinko fix
private static final org apache juli logging log log org apache juli logging log factory get log jssesocket factory class private static final boolean rfc 5746 supported private static final string default protocol tls private static final string default keystore type jks	static boolean result false sslcontext context try context sslcontext get instance tls context init null null new secure random sslserver socket factory ssf context get server socket factory string ciphers ssf get supported cipher suites string cipher ciphers tls empty info scsv equals cipher result true break catch algorithm exception assume rfc 5746 support catch key management exception assume rfc 5746 support rfc 5746 supported result	allow unsafe legacy rfc 5746 supported prevent further handshakes removing all cipher suites bug 50325 bug when jvm indicates support rfc 5746 disable tomcat apos code allow unsafe legacy code attribute use jvm control markt fix fix request specified default code false code used attribute only has effect jvm does support rfc 5746 indicated presence pseudo ciphersuite tls empty info scsv available jre jdk update 22 onwards where rfc 5746 supported including support unsafe legacy controlled jvm
else attrs set collection true fix bug 50683 bug ensure annotations scanned when upack wars set code false code host where web application deployed markt fix
return boolean parse boolean return byte parse byte	return double parse double return float parse float return integer parse int return short parse short return long parse long	return byte value byte return byte value return character value char return character value char return double value return double value return float value return float value return integer value return integer value return short value short return short value return long value return long value	return byte value return length character value char null return short value return integer value return float value return long value return double value	return byte string return boolean string return short string return integer string return float string return long string return double string return character string	tmpval character value values char	method invoke bean new object integer value value	method invoke bean new object short value value	method invoke bean new object long value value	method invoke bean new object double value value	method invoke bean new object float value value	method invoke bean new object character value value	method invoke bean new object byte value value fix bug 46819 bug remove redundant object jsp runtime library patch provided anthony whitford markt fix
jar resource null add tld page info add dependant jar resource get entry location get name string add tag page info add dependant jar resource get entry tag file path substring string else page info add dependant tag file path fix bug 50680 bug prevent npe when using tag files from exploded jar file from within ide patch provided larry isaacs markt fix
members cluster specified context name param context name context name which application should param wepapp war file unpacked directory structure containing web application installed exception illegal argument exception specified context name malformed exception illegal state exception specified context name public void install string context name file webapp throws ioexception name application successfully removed param context name context name application removed exception illegal argument exception specified context name malformed exception illegal argument exception specified context name does public void remove string context name boolean undeploy throws ioexception	applications war from within cluster	fmsg get context name fmsg get file name	string context name fmsg get context name serviced context name add serviced context name remove context name check context name remove serviced context name farm war deployer deploy end context name farm war deployer servicing deploy context name name	string context name umsg get context name context name serviced context name add serviced context name remove context name remove serviced context name farm war deployer undeploy end context name farm war deployer servicing uneploy context name	file write file new file get temp dir msg get file name	cluster specified context name param context name context name which application should installed param webapp war file unpacked directory structure containing web application installed specified context name malformed specified context name already deployed public void install string context name file webapp throws ioexception file message factory factory file message factory get instance webapp false file message msg new file message local member webapp get name context name log debug sm get string farm war deployer send start context name webapp context name webapp members farm war deployer send end context name webapp name application successfully removed container event param context name context name application removed specified context name malformed specified context name does identify public void remove string context name boolean undeploy log info sm get string farm war deployer remove start context name current time millis undeploy context name system current time millis context name undeploy log debug sm get string farm war deployer remove tx msg context name serviced context name add serviced context name remove context name remove serviced context name context name context name ex	context name cn new context name deploy war get name log info sm get string farm war deployer mod install cn get name deploy war get absolute path remove cn get name false install cn get name deploy war	context name cn new context name remove war get name cn get name remove cn get name true	protected void remove string context name throws exception context context context host find child context name log debug sm get string farm war deployer undeploy local context name	check context name	private string context name string context name context name context name	public string get context name return context name	log warn receive message again sender act timeout too short name msg get context name	log warn receive message again sender act timeout too short name msg get context name	private string context name	string context name context name context name	public string get context name return context name public void set context path string context name context name context name fix bug 50679 bug update farm war deployer support parallel deployment markt fix
http client keep alive timer thread has been started web application still running should tomcat change context class loader from current link webapp class loader link webapp class loader parent prevent memory leak note keep alive timer thread stop its own once keep alives all expire however busy system might happen some time private boolean clear references http client keep alive thread true	return clear references http client keep alive thread flag context public boolean get clear references http client keep alive thread return clear references http client keep alive thread set clear references http client keep alive thread feature context param clear references http client keep alive thread new flag value public void set clear references http client keep alive thread boolean clear references http client keep alive thread clear references http client keep alive thread clear references http client keep alive thread	private static final string jvn thread group system system jvm thread group names add jvn thread group system	http client keep alive timer thread has been started web application still running should tomcat change context class loader from current link webapp class loader link webapp class loader parent prevent memory leak note keep alive timer thread stop its own once keep alives all expire however busy system might happen some time private boolean clear references http client keep alive thread true	return clear references http client keep alive thread flag context public boolean get clear references http client keep alive thread return clear references http client keep alive thread set clear references http client keep alive thread feature context param clear references http client keep alive thread new flag value public void set clear references http client keep alive thread boolean clear references http client keep alive thread clear references http client keep alive thread clear references http client keep alive thread	jvm controlled threads http client keep alive threads clear references http client keep alive thread thread get name equals keep alive timer thread set context class loader parent log debug sm get string webapp class loader check threads http client don warn about remaining jvm controlled threads	class loader set clear references http client keep alive thread standard context container get clear references http client keep alive thread fix bug 50642 bug move http client keep alive thread memory leak protection from jre memory leak prevention listener webapp class loader since thread triggers memory leak created demand markt fix attribute name clear references http client keep alive thread required false code true code http client keep alive timer thread has been started web application still running tomcat change context class loader thread from current code webapp class loader code code webapp class loader parent code prevent memory leak note keep alive timer thread stop its own once keep alives all expire however busy system might happen some time specified default value code true code used attribute
read fully message fix bug 50646 bug ensure larger tribes messages fully read patch provided olivier costet markt fix
protected class loader bind thread	protected void unbind thread class loader old context class loader fix bug 50629 bug make code standard context bind thread code code standard context unbind thread code protected allow use sub classes markt fix
private static final log log log factory get log connector class	try session end access catch throwable exception utils handle throwable log warn sm get string coyote request session end access fail
additional arguments executable private list string cgi executable args null	get servlet config get init parameter executable arg null list string args new array list string int string arg get servlet config get init parameter executable arg arg null break args add arg cgi executable args args	list string cmd args new array list string cgi executable length cmd args add cgi executable cgi executable args null cmd args add all cgi executable args cmd args add command cmd args add all params proc rt exec cmd args array new string cmd args size hash string array env wd fix bug 50606 bug improve cgiservlet provide support specifying empty value code executable code init param provide support explicit additional arguments executable those were broken when implementing fix bug bug 49657 bug kkolinko fix
idle offer create true	pooled connection con create false	protected pooled connection create boolean increment counter increment counter size increment get	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author jeremy norris https issues apache org bugzilla show bug cgi id 50613 protected volatile data source ds null public test size preservation private void init simple pool properties pool new default properties ds new org apache tomcat jdbc pool data source ds set pool properties ds get pool properties set driver class name driver class get name ds get pool properties set url driver url ds get pool properties set fair queue true ds get pool properties set jmx enabled false ds get pool properties set test while idle true ds get pool properties set test borrow false ds get pool properties set test return false ds get pool properties set validation interval 30000 ds get pool properties set time between eviction runs millis 30000 ds get pool properties set initial size 100 ds get pool properties set max active 100 ds get pool properties set min idle ds get pool properties set max idle ds get pool properties set max wait 10000 ds get pool properties set remove abandoned timeout 10 ds get pool properties set min evictable idle time millis 10000 ds get pool properties set log abandoned false ds get pool properties set remove abandoned false ds get pool properties set use lock true private void init evicting pool init simple pool properties ds get pool properties set time between eviction runs millis 25 ds get pool properties set min evictable idle time millis 750 ds get pool properties set remove abandoned true ds get pool properties set remove abandoned timeout public void test simple throws exception init simple pool properties common ds close true driver reset public void test evicting throws exception init evicting pool common ds close true driver reset private void common throws exception ds get connection close final int iterations 1000 final atomic integer loopcount new atomic integer final runnable run new runnable public void run try while loopcount increment get iterations connection ds get connection thread sleep 1000 close catch exception print stack trace thread threads new thread 200 int threads length threads new thread run int threads length threads start try while loopcount get iterations thread sleep 250 catch exception loopcount set iterations stops test print stack trace int threads length threads join system out println pool size ds get pool get size assert true size validity check ds get pool get size
obj instanceof naming entry	fix bug 50601 bug code clean up patch provided sebb markt fix
protected string url http localhost 8080 manager text code http localhost 8080 manager text code which corresponds standard installation tomcat property name url value http localhost 8080 manager text property name manager url value http localhost 8080 manager text fix bug 50598 bug correct url manager text interface markt fix code http localhost 8080 manager text code
allocate new filter instance necessary filter def get filter null get filter fix bug 50597 bug don apos instantiate new instance filter instance provided via code servlet context add filter string filter code method patch provided ismael juma markt fix
remove fix bug 50600 bug prevent code concurrent modification exception code when removing war file via farm war deployer markt fix
context request get mapping data context log access request response system current time millis req get start time false	boolean create false create true	create request recycle response recycle	get next invoke request response get state available get enabled log elements null condition null	don need flush since trigger log message after response has been committed long length response get bytes written false	public void invoke request request response response throws ioexception servlet exception get state available return	byte count	fix bug 50582 bug refactor access logging so chunked encoding forced all requests bytes sent logged markt fix
pattern filter return null matcher uri matches fix bug 50591 bug fix npe replication valve kkolinko fix
groupname null groupname length string msg sm get string memory user database null group log warn msg throw new illegal argument exception msg	rolename null rolename length string msg sm get string memory user database null role log warn msg throw new illegal argument exception msg	username null username length string msg sm get string memory user database null user log warn msg throw new illegal argument exception msg	new memory group creation factory true new memory role creation factory true new memory user creation factory true add bug 18797 bug provide protection against code null code zero length names being provided users roles groups code memory realm code code user database realm code markt add
system set out new system log handler system out system set err new system log handler system err	system set out new system log handler system out system set err new system log handler system err fix bug 18462 bug don apos merge code stdout code code stderr code internally so users retain option treat separately markt fix
out printil public java lang string get servlet info	out printil private void jsp init javax servlet servlet config config	out printil private static final javax servlet jsp jsp factory jspx factory out printil javax servlet jsp jsp factory get default factory out printil private static java util list java lang string jspx dependants out printin jspx dependants new java util array list java lang string	out printil public java util list java lang string get dependants	out printin javax servlet single thread model	out println final javax servlet http http servlet request request final javax servlet http http servlet response response out println throws java io ioexception javax servlet servlet exception out printil final javax servlet jsp page context page context out printil javax servlet http http session session null out printil java lang throwable exception org apache jasper runtime jsp runtime library get throwable request out printil response set status javax servlet http http servlet response sc internal server error out printil final javax servlet servlet context application out printil final javax servlet servlet config config out printil javax servlet jsp jsp writer out null out printil final java lang object page out printil javax servlet jsp jsp writer jspx out null out printil javax servlet jsp page context jspx page context null	out printil throw new javax servlet jsp skip page exception	string scopename javax servlet jsp page context page scope default page scopename javax servlet jsp page context request scope scopename javax servlet jsp page context session scope scopename javax servlet jsp page context application scope	out printil catch java lang class found exception exc out printil catch java lang exception exc out printin throw new javax servlet servlet exception	out print javax servlet jsp page context jspx page context out printil throws java lang throwable out printil javax servlet jsp page context page context jspx page context out printil javax servlet jsp jsp writer out jspx page context get out	nvp java lang boolean value omit	out printil jsp context get elcontext put context javax servlet jsp jsp context class get jsp context	out printil jsp context get elcontext put context javax servlet jsp jsp context class get jsp context	out printil throw new javax servlet jsp skip page exception	out printil catch java lang throwable jspx exception	sb append new java lang class	string scope name javax servlet jsp page context page scope default page scope name javax servlet jsp page context request scope scope name javax servlet jsp page context session scope scope name javax servlet jsp page context application scope	out printil java lang string	out printil java lang string var name out printil java lang string var name	out printil javax servlet http http session session jspx page context get session out printil javax servlet servlet context application jspx page context get servlet context out printil javax servlet http http servlet request request javax servlet http http servlet request jspx page context get request out printil javax servlet http http servlet response response javax servlet http http servlet response jspx page context get response	out printil catch java lang throwable out printil instanceof javax servlet jsp skip page exception	out printil private javax servlet jsp jsp context jsp context	out printil public void do tag throws javax servlet jsp jsp exception java io ioexception	out printil javax servlet jsp page context jspx page context javax servlet jsp page context jsp context out printil javax servlet http http servlet request request javax servlet http http servlet request jspx page context get request out printil javax servlet http http servlet response response javax servlet http http servlet response jspx page context get response out printil javax servlet http http session session jspx page context get session out printil javax servlet servlet context application jspx page context get servlet context out printil javax servlet servlet config config jspx page context get servlet config out printil javax servlet jsp jsp writer out jsp context get out out printil jsp context get elcontext put context javax servlet jsp jsp context class jsp context	out printil catch java lang throwable out printil instanceof javax servlet jsp skip page exception out printil throw javax servlet jsp skip page exception out printil instanceof java lang illegal state exception out printil throw java lang illegal state exception out printil instanceof javax servlet jsp jsp exception out printil throw javax servlet jsp jsp exception out printil throw new javax servlet jsp jsp exception	out printil jsp context get elcontext put context javax servlet jsp jsp context class super get jsp context	out printil public void set jsp context javax servlet jsp jsp context ctx java util map alias map out printil public void set jsp context javax servlet jsp jsp context ctx	out printil public javax servlet jsp jsp context get jsp context	out printil public void set dynamic attribute java lang string uri java lang string local name java lang object value throws javax servlet jsp jsp exception	int javax servlet jsp jsp context jsp context	out println result get id javax servlet jsp jsp writer out out printil throws java lang throwable	out printil throws javax servlet jsp jsp exception out printil javax servlet jsp jsp writer out null	out printil jsp context get elcontext put context javax servlet jsp jsp context class jsp context	out printil catch java lang throwable out printil instanceof javax servlet jsp skip page exception out printil throw javax servlet jsp skip page exception out printil throw new javax servlet jsp jsp exception	class javax servlet jsp page context jsp ctxt	return java lang boolean org apache jasper runtime jsp runtime library coerce java lang boolean class return new java lang boolean false return new java lang boolean boolean value string	return java lang byte org apache jasper runtime jsp runtime library coerce java lang byte class return new java lang byte byte return new java lang byte byte byte value string	return java lang character org apache jasper runtime jsp runtime library coerce java lang character class return new java lang character char return new java lang character char int ch	return java lang double org apache jasper runtime jsp runtime library coerce return new java lang double return new java lang double double value string	return java lang float org apache jasper runtime jsp runtime library coerce java lang float class return new java lang float return new java lang float float value string	return java lang integer org apache jasper runtime jsp runtime library coerce java lang integer class return new java lang integer return new java lang integer integer value string	return java lang short org apache jasper runtime jsp runtime library coerce java lang short class return new java lang short short return new java lang short short value string	return java lang long org apache jasper runtime jsp runtime library coerce java lang long class return new java lang long return new java lang long long value string	return java lang void type update bug 15688 bug use fully qualified class names generated jsp files avoid naming conflicts user imports markt update
properties get max active log warn max active smaller than setting max active pool properties default max active properties set max active pool properties default max active	public static final int default max active 100	protected int max active default max active
override	override override	override	override fix bug 21157 bug ensure cookies written before response commited cookie example patch provided stefan radzom markt fix
string cookie name request get parameter cookiename string cookie value request get parameter cookievalue cookie cookie null cookie name null cookie value null cookie new cookie cookie name cookie value response add cookie cookie	cookie null
redirect output redirect out print stream null fix bug 50552 bug avoid npe hides error message when using ant tasks schultz fix
suppress warnings unchecked override	suppress warnings unchecked override	synchronized java urlcontext factory class match class name org apache naming java java urlcontext factory bug code nm match fix bug 50554 bug code clean up markt fix
pooled connection pc borrow connection null null pc null return new connection future pc	volatile pooled connection pc null public connection future pooled connection pc pc pc pc null return false else cancelled get cancelled compare set false true	pooled connection pc pc null pc pc future get timeout unit	return pc null pc future cancelled cancelled get return pc null pc future done	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public async0idle test bug50477 string name super name public void test throws exception system out println test pool async starting fairness tomcat jdbc fair async init datasource get pool properties set max active 10 datasource get pool properties set fair queue true datasource get pool properties set initial size try future connection cf data source proxy datasource get connection async connection con cf get time unit seconds finally tear down licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license object factory resource links shared data sources author filip hanik version id resource link factory java 939311 2010 04 29 14 01 02z kkolinko implements object factory object factory methods create new data source instance param obj reference object describing data source public object get object instance object obj name name context name ctx hashtable environment throws naming exception object result super get object instance obj name name ctx environment can we process request result null reference ref reference obj ref addr user attr ref get username ref addr pass attr ref get password user attr get content null pass attr get content null result wrap data source result user attr get content string pass attr get content string return result protected object wrap data source object datasource string username string password throws naming exception try class proxy class proxy get proxy class datasource get class get class loader datasource get class get interfaces constructor proxy constructor proxy class get constructor new class invocation handler class data source handler handler new data source handler data source datasource username password return proxy constructor new instance handler catch exception instanceof naming exception throw naming exception else naming exception nx new naming exception get message nx init cause throw nx simple wrapper class allow user configure resource link data source so when link javax sql data source get connection called invoke link javax sql data source get connection string string username password public static class data source handler implements invocation handler data source ds string username string password public data source handler data source ds string username string password ds ds username username password password public object invoke object proxy method method object args throws throwable get connection equals method get name args length args new string username password else unwrap equals method get name return unwrap class args try return method invoke ds args catch throwable instanceof invocation target exception invocation target exception invocation target exception throw get cause null get cause else throw public object unwrap class iface throws sqlexception iface data source class return ds else throw new sqlexception wrapper iface get name fix bug 49543 bug allow tomcat use shared data sources per application credentials fhanik fix attribute name factory required false fully qualified java class name class creating objects class should implement code javax naming spi object factory code interface attribute when attribute code factory quot org apache naming factory data source link factory quot code resource link can used two additional attributes allow shared data source used different credentials when two additional attributes used combination code javax sql data source code type different contexts can share global data source different credentials under hood what happens call href http download oracle com javase docs api javax sql data source html get connection code get connection code simply translated call href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code get connection username password code global data source easy way get code transparent what schemas being used yet able control connections pools global attributes attribute name username required false attribute attribute name password required false attribute attributes shared data source example lt resource name quot shared data source quot global quot shared data source quot type quot javax sql data source quot username quot bar quot password quot barpass quot lt resource link name quot app data source quot global quot shared data source quot type quot javax sql data source quot factory quot org apache naming factory data source link factory quot username quot foo quot password quot foopass quot lt resource link name quot app data source quot global quot shared data source quot type quot javax sql data source quot when request code get connection code made code foo code context request translated code get connection quot foo quot quot foopass quot code while request code bar code gets passed straight through
-1
boolean result cache unload name ensure correct operation particularly web dav unload resource without trailing name ends cache unload name substring name length else cache unload name return result fix bug 50550 bug when new directory created via web dav ensure subsequent request directory does result 404 response markt fix
remote host null remote host address getip sa fix bug 47319 bug return client apos ip address rather than null calls code get remote host code when apr connector used code enable lookups quot true quot code ip address resolveable markt fix
msg set timestamp system current time millis	msg set timestamp system current time millis fix bug 50547 bug add time stamp change session id message session expired message kfujino fix
string buffer concat remote ip header value new string buffer enumeration string request get headers remote ip header has more elements concat remote ip header value length concat remote ip header value append concat remote ip header value append next element string remote ip header value comma delimited list string array concat remote ip header value string	concat remote ip header value original protocol header request get header remote ip header new proxies header request get header proxies header	string buffer concat remote ip header value new string buffer enumeration string request get headers remote ip header has more elements concat remote ip header value length concat remote ip header value append concat remote ip header value append next element string remote ip header value comma delimited list string array concat remote ip header value string	public void add header string name string value get coyote request get mime headers add value name set string value	request add header forwarded 140 211 11 130 192 168 10 192 168 11	request add header forwarded 140 211 11 130 request add header forwarded proxy1 request add header forwarded proxy2	request get coyote request get mime headers add value forwarded set string 140 211 11 130 request get coyote request get mime headers add value forwarded set string proxy1 request get coyote request get mime headers add value forwarded set string proxy2 fix bug 50453 bug correctly handle multiple code forwarded code headers remote ip filter remote ip valve patch provided jim riggs markt fix
attachment may null another thread has called cancelled key attachment null iterator remove else attachment access iterator remove process key sk attachment fix bug 50467 bug protected against npe triggered race condition causes nio poller fail preventing processing further requests markt fix
size limit also known count limit use when realm configured link user search zero limit protected long size limit time limit milliseconds use when realm configured link user search zero limit protected int time limit	public long get size limit return size limit public void set size limit long size limit size limit size limit public int get time limit return time limit public void set time limit int time limit time limit time limit	constraints set count limit size limit constraints set time limit time limit add bug 50541 bug add support setting size limit time limit ldap seaches when using jndi realm code user search code markt add attribute name size limit required false specifies maximum number records return when using code user search code attribute specified default code code used which indicates limit attribute attribute name time limit required false specifies time milliseconds wait records returned when using code user search code attribute specified default code code used which indicates limit attribute
else double matches obj0 obj1 biginteger matches obj0 obj1 delegate bigdecimal else delegate double else biginteger matches obj0 obj1	delegate double	else double matches obj0 obj1 biginteger matches obj0 obj1 delegate bigdecimal else delegate double else biginteger matches obj0 obj1	else double matches obj0 obj1 biginteger matches obj0 obj1 delegate bigdecimal else delegate double else biginteger matches obj0 obj1	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private final string private final big integer new big integer public void test add throws exception assert equals string value elarithmetic add public void test subtract throws exception assert equals string value elarithmetic subtract public void test multiply throws exception assert equals string value elarithmetic multiply public void test divide throws exception assert equals string value elarithmetic divide public void test mod throws exception assert equals string value elarithmetic mod fix bug 50500 bug use correct coercions per el spec arithmetic operations involving string values containing apos apos apos apos apos apos based patch brian weisleder markt fix attribute name alternate username allowed required false boolean default jdbc pool ignore href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code data source get connection username password code call simply return previously pooled connection under globally configured properties code username code code password code performance reasons pool can however used different credentials each time connection used should you request connection credentials user1 password1 connection previously connected using user2 password2 connection closed reopened requested credentials way pool size still managed global level per schema level enable described href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code data source get connection username password code call simply set property code alternate username allowed code true br default value code false code br property added enhancement href https issues apache org bugzilla show bug cgi id 50025 bug 50025 attribute
pooled connection con borrow connection null null borrows connection from pool connection available idle queue pool has reached link pool properties max active max active connections connection returned immediately connection available pool attempt fetch connection link pool properties max wait max wait milliseconds return connection java sql connection javax sql pooled connection reflection proxy wrapping underlying object throws sqlexception wait times out failure occurs creating connection public connection get connection string username string password throws sqlexception check out connection pooled connection con borrow connection username password return setup connection con	initial pool borrow connection null null don wait should contention	private pooled connection borrow connection int wait string username string password throws sqlexception	pooled connection result borrow connection now con username password	return create connection now con username password	protected pooled connection create connection long now pooled connection used string username string password throws sqlexception username null con get attributes put con prop user username password null con get attributes put con prop password password	protected pooled connection borrow connection long now pooled connection con string username string password throws sqlexception boolean usercheck con check user username password	usercheck con discarded con validate pooled connection validate borrow set timestamp con set timestamp now get pool properties log abandoned set stack trace pool con set stack trace get thread dump busy offer con log debug connection doesn fit busy array connection traceable return con either has another principal discarded validation failed	pc borrow connection system current time millis pc null null	protected static final string prop alternate username allowed alternate username allowed	prop alternate username allowed	value properties get property prop alternate username allowed value null pool properties set alternate username allowed boolean parse boolean value	get pool properties alternate username allowed pool null return create pool get connection username password return pool get connection username password else return get connection	inherit doc public boolean alternate username allowed return get pool properties alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed get pool properties set alternate username allowed alternate username allowed	returns true call link data source get connection string string get connection username password allowed used when pool used application accessing multiple schemas performance impact turning option return true link data source get connection string string get connection username password honored false ignored public boolean alternate username allowed set true call link data source get connection string string get connection username password allowed honored used when pool used application accessing multiple schemas performance impact turning option even when used due username checks param alternate username allowed set true link data source get connection string string get connection username password honored false ignored public void set alternate username allowed boolean alternate username allowed	protected boolean alternate username allowed false	inherit doc public boolean alternate username allowed return alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed alternate username allowed alternate username allowed	public static final string prop user user public static final string prop password password	public boolean check user string username string password get pool properties alternate username allowed return true username null username pool properties get username password null password pool properties get password string stored usr string get attributes get prop user string stored pwd string get attributes get prop password boolean result username null stored usr null result result username null username equals stored usr result result password null stored pwd null password null password equals stored pwd username null get attributes remove prop user else get attributes put prop user username password null get attributes remove prop password else get attributes put prop password password return result	string usr null string pwd null get attributes contains key prop user usr string get attributes get prop user else usr pool properties get username get attributes put prop user usr get attributes contains key prop password pwd string get attributes get prop password else pwd pool properties get password get attributes put prop password pwd usr null pwd null xa connection xds get xaconnection usr pwd	usr null pwd null connection ds get connection usr pwd usr null pwd null connection ds get pooled connection usr pwd get connection	string usr null string pwd null get attributes contains key prop user usr string get attributes get prop user else usr pool properties get username get attributes put prop user usr get attributes contains key prop password pwd string get attributes get prop password else pwd pool properties get password get attributes put prop password pwd properties properties clone pool properties get db properties usr null properties set property prop user usr pwd null properties set property prop password pwd connection connection driver connect driver url properties	private properties clone properties properties new properties put all return	inherit doc public boolean alternate username allowed return get pool properties alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed noop	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final int iterations new random system current time millis next int 100000 1000 public alternate username test string name super name public void test generic throws exception init datasource set driver class name driver class get name datasource set url jdbc tomcat test datasource set alternate username allowed true datasource get connection close int withoutuser 10 int withuser withoutuser test runner runners new test runner withuser withoutuser int withuser test runner new test runner foo bar datasource get pool properties get username datasource get pool properties get password test runner without new test runner null null datasource get pool properties get username datasource get pool properties get password runners runners withuser without executor service svc executors new fixed thread pool withuser withoutuser list future test result results svc invoke all arrays list runners int failures int total int withuser failures results get get failures total results get get iterations failures results get withuser get failures total results get withuser get iterations assert equals nr failures failures failures svc shutdown now datasource close system out println nr connect calls driver connect count get system out println nr disconnect calls driver disconnect count get system out println nr iterations total public static class test result public int iterations public int failures public string last message public class test runner implements callable test result string username string password volatile boolean done false test result result null boolean useuser true public test runner string user string pass string guser string gpass username user null guser user password pass null gpass pass useuser user null public test result call test result test new test result pooled connection pcon null int done iterations test iterations try pcon useuser pooled connection alternate username test datasource get connection username password pooled connection alternate username test datasource get connection connection con connection pcon get connection assert true username mismatch requested user username actual user con get username con get username equals username assert true password mismatch requested password password actual password con get password con get password equals password catch sqlexception test failures test last message get message done true print stack trace catch exception test failures test last message get message print stack trace finally pcon null try pcon close catch exception ignore pcon null done true result test return result	properties info public connection properties info info info public string get username return info get property pooled connection prop user public string get password return info get property pooled connection prop password	return new org apache tomcat jdbc test driver connection info
host null host instanceof host cluster name null cluster name starts host get name fix bug 50503 bug when web application has version engine level clustering works correctly kfujino fix
out println final http servlet request request final http servlet response response out printil final page context page context	out printil final servlet context application out printil final servlet config config out printil final object page	out printil page context jspx factory get page context request response add bug 13731 bug make variables code jsp service code method final where possible markt add
catch saxparse exception spe log warn catalina start using get config file spe get message return log warn catalina start using get config file	locator get column number message	real class name null throw new null pointer exception class name specified namespace name bug 10972 bug improve error message class name attribute missing element server xml where required markt update update
should session always used once user may offer some performance benefits since session can used cache principal hence removing need authenticate user via realm every request may help combinations basic used jndirealm data source realms however also performance cost creating gc ing session default session created protected boolean always use session false	session null change session id manager manager request get context get manager manager change session id session request change session id session get id else always use session session request get session internal true add bug 10526 bug add option code code force creation session which may offer some performance benefits markt add attribute name always use session required false should session always used once user may offer some performance benefits since session can used cache principal hence removing need authenticate user via realm every request may help combinations basic used jndirealm data source realms however also performance cost creating gc ing session set default value code false code used attribute
log debug message msg data hex utils hex string msg get data	log debug msg hex utils hex string buf pos len	table byte hex string translation private static final char hex char array	public static string hex string byte bytes null bytes return null string builder sb new string builder bytes length int bytes length sb append hex bytes 0xf0 append hex bytes 0x0f return sb string
fatal error new enable exception jsp error enable dtd validation null	override public synchronized throwable fill stack trace class does provide stack trace return	override public synchronized throwable fill stack trace class does provide stack trace return
return creation time session bypassing session validity checks public long get creation time internal	public long get creation time internal return override	int time alive int time now session get creation time internal 1000	return time when session created milliseconds since midnight january 1970 gmt bypassing session validation checks override public long get creation time internal return creation time fix bug 50448 bug fix possible code illegal state exception code caused recent session management refactoring markt fix
resolvers instanceof scoped attribute elresolver special case since always return object class object value resolvers get value context base property value null return value get class	public void test bug50408 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context ctxt standard context tomcat add webapp null test app dir get absolute path test needs jstl libraries file lib new file webapps examples web inf lib ctxt set aliases web inf lib lib get canonical path tomcat start int rc get url http localhost get port test bug50408 jsp new byte chunk null assert equals http servlet response sc ok rc	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body each items page context response header names var name each items page context response get headers name var value name value each each body subsection name jasper changelog fix bug 50408 bug fix code method exception code when using scoped variables el method invocation markt fix changelog subsection
coyote connector	protected string parse body methods post protected hash set parse body methods set	public string get parse body methods return parse body methods public void set parse body methods string methods hash set method set new hash set null methods method set add all arrays list methods split method set contains trace throw new illegal argument exception trace method must include entity see rfc 2616 section parse body methods methods parse body methods set method set public boolean parse body method string method return parse body methods set contains method	make sure parse body methods set has default null parse body methods set set parse body methods get parse body methods	get connector parse body method get method	test case https issues apache org bugzilla show bug cgi id 48692 put requests should able fetch request parameters coming from request body when properly configured using new parse body method setting public void test bug48692 client new client set port get port make sure get works properly client do request get foo bar null null false assert true non 200 response get request client response200 assert equals incorrect response get request foo bar client get response body client reset make sure post works properly post separate get post parameters client do request post foo bar application www form urlencoded bar baz true assert true non 200 response post request client response200 assert equals incorrect response post request bar baz foo bar client get response body client reset post overlapping get post parameters client do request post foo bar bar foo application www form urlencoded bar baz foo baz true assert true non 200 response post request client response200 assert equals incorrect response post request bar baz bar foo foo bar foo baz client get response body client reset put without post style parsing client do request put foo bar bar foo application www form urlencoded bar baz foo baz false assert true non 200 response put noparse request client response200 assert equals incorrect response put request bar foo foo bar client get response body client reset put post style parsing client do request put foo bar bar foo application www form urlencoded bar baz foo baz true assert true non 200 response put request client response200 assert equals incorrect response put parse request bar baz bar foo foo bar foo baz client get response body client reset private exception do request string method string query string string content type string request body boolean allow body private static class echo parameters servlet extends http servlet private static final long serial version uid 1l only interested parameters values requests note echos parameters alphabetical order override protected void service http servlet request req http servlet response resp throws servlet exception ioexception just echo parameters values back plain text resp set content type text plain resp set character encoding utf print writer out resp get writer tree map string string parameters new tree map string string req get parameter map boolean first true string name parameters key set string values req get parameter values name java util arrays sort values int values length first first false else out print out print name values bug 48692 test client test allowing put request bodies private class extends simple http client private boolean init private synchronized void init throws exception init return tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root echo parameters new echo parameters servlet root add servlet mapping echo echo parameters tomcat start init true private exception do request string method string query string string content type string request body boolean allow body tomcat tomcat get tomcat instance try init allow body tomcat get connector set parse body methods method else tomcat get connector set parse body methods never parse open connection connect re encode request body so bytes characters null request body request body new string request body get bytes utf ascii send specified request body using method string request method http localhost get port echo null query string query string http crlf host localhost crlf null content type content type content type crlf connection close crlf null request body content length request body length crlf crlf null request body request body set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok return false don care author email schultz apache org christopher schultz author update bug 48692 bug provide option parse code application www form urlencoded code put requests schultz update attribute name parse body methods required false comma separated list http methods which request bodies parsed request parameters identically post useful restful applications want support post style semantics put requests note any setting other than code post code causes tomcat behave way violates servlet http method trace specifically forbidden here accordance http default code post code attribute attribute name parse body methods required false comma separated list http methods which request bodies parsed request parameters identically post useful restful applications want support post style semantics put requests note any setting other than code post code causes tomcat behave way violates servlet http method trace specifically forbidden here accordance http default code post code attribute
set state lifecycle state stopping fix bug 50358 bug set correct lifecycle state when stopping instances deprecated embedded class markt fix
private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l name which object being bound unbound	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l constructors destructors	private static final long serial version uid 1l	private static final long serial version uid 1l constructors	private static final long serial version uid 1l	private static final long serial version uid 1l	extends saxparse exception private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	public static class simple table demo extends jpanel implements action listener private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l	private static final long serial version uid 1l
ccl	equals key loaded web app class loader key	equals value loaded web app class loader value args get pretty class name key get class	args get pretty class name value get class	private string get pretty class name class clazz string name clazz get canonical name name null name clazz get name return name param object test return code true code has been loaded current classloader one its descendants private boolean loaded web app class loader object null return false class loader cl get class get class loader while cl null cl return true cl cl get parent return false add bug 48837 bug extend thread local memory leak detection include classes loaded subordinate class loaders web application apos class loader jasper class loader based patch sylvain laurent markt add
public int get min spare threads return endpoint get min spare threads public void set min spare threads int min spare threads endpoint set min spare threads min spare threads	public int get min spare threads return endpoint get min spare threads public void set min spare threads int min spare threads endpoint set min spare threads min spare threads subsection name coyote changelog add bug 50108 bug add get set methods connector property min spare threads patch provided eiji takahashi markt add changelog subsection
state socket state open state socket state closed processor async att set async true re enable timeouts else comet log debug enabled log debug keeping processor processor add correct poller events here based comet stuff socket get poller add socket att get comet ops state socket state async end further work required	else ka interest ops selection key op read selection key op read	else ka async ka get comet fix bug 50207 bug ensure comet timeout events triggered bug regression triggered fix bug 49884 bug markt fix
seconds buff append seconds seconds	string builder buff new string builder bytes buff append bytes bytes buff append mbytes append rest 10 buff append buff append rest append mb return buff string fix bug 50316 bug fix display negative values manager application kkolinko fix
else state async state started state async state timing out	do test timeout true null do test timeout false null public void test timeout listener dispatch throws exception do test timeout true nonasync private void do test timeout boolean complete timeout string dispatch url throws exception	timeout servlet timeout new timeout servlet complete timeout dispatch url dispatch url null non async servlet non async new non async servlet tomcat add servlet ctx nonasync non async ctx add servlet mapping dispatch url nonasync	dispatch url null expected append complete else expected append non async servlet get	private string dispatch url public timeout servlet boolean complete timeout string dispatch url dispatch url dispatch url	ac add listener new tracking listener false complete timeout dispatch url	new tracking listener complete error true null	timeout servlet timeout new timeout servlet true null	tracking listener listener new tracking listener false true null	private string dispatch url boolean complete timeout string dispatch url dispatch url dispatch url	dispatch url null event get async context complete else event get async context dispatch dispatch url fix bug 50308 bug allow asynchronous request processing call code async context dispatch code once asynchronous request has timed out markt fix
string builder key properties new string builder web module fix bug 50310 bug fix display servlet information manager application markt fix
resolvers new elresolver fix bug 50293 bug increase size internal elresolver array from since typical usage least resolvers based patch robert goff markt fix
private function mapper function mapper null function mapper	private final static elresolver default resolver constants security enabled default resolver null else default resolver new composite elresolver composite elresolver default resolver add new map elresolver composite elresolver default resolver add new resource bundle elresolver composite elresolver default resolver add new list elresolver composite elresolver default resolver add new array elresolver composite elresolver default resolver add new bean elresolver private final elresolver el resolver el resolver get default resolver	return el resolver get value context base property	return el resolver get type context base property	el resolver set value context base property value	return el resolver read only context base property return el resolver get feature descriptors context base	return el resolver get common property type context base fix bug 50192 bug improve performance el when running under security manager based patch robert goff markt fix licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface implemented session managers do keep complete copy all sessions local node do know where every session backup manager example manager sessions can primary master copy node backup backup copy node proxy only session id node identity primary backup nodes known all sessions including proxy sessions returns total session count primary backup proxy return total session count across cluster public int get active sessions full returns list all sessions ids primary backup proxy return complete set sessions ids across cluster public set string get session ids full
implements map owner distributed manager	override override	manager instanceof distributed manager show proxy sessions distributed manager manager get active sessions full	manager instanceof distributed manager show proxy sessions distributed manager manager get session ids full fix bug 50230 bug add new distributed manager interface implemented backup manager remove circular dependency between tomcat catalina ha tomcat catalina modules also allows third party distributed manager report full session information through html manager markt fix
entry value instanceof resource ref boolean singleton boolean parse boolean string resource ref entry value get singleton get content singleton entry type naming entry entry entry value obj fix bug 50252 bug prevent class cast exception when using lt resource link gt patch provided eiji takahashi markt fix
get executor execute task	log error unable service bio socket	bug 50183 bug bio sender scheduling tasks executor during normal operation patch provided ariel markt fix fix markt
get state equals lifecycle state started fire container event add welcome file event name	get state equals lifecycle state started fire container event remove welcome file event name	parent get state equals lifecycle state started fire container event add mapping event mapping	parent get state equals lifecycle state started fire container event remove mapping event mapping fix bug 50169 bug ensure when container started doesn apos try register mapper unless its parent has already started patch provided eiji takahashi markt fix
class loader loader thread current thread get context class loader try use system classloader victim all class loader pinning we re about do thread current thread set context class loader class loader get system class loader several components end up calling sun awt app context get app context those libraries components known trigger memory leaks due eventual calls get app context google web toolkit via its use javax imageio tomcat via its use java beans introspector flush caches 15 onwards others tbd trigger call sun awt app context get app context pin system class loader memory shouldn issue app context protection image io get cache directory several components end up calling sun misc gc request latency long those libraries components known trigger memory leaks due eventual calls request latency long javax management remote rmi rmiconnector server start gc daemon protection try class clazz class name sun misc gc method method clazz get declared method request latency new class long class method invoke null long value 3600000 catch class found exception system get property java vendor starts sun log error sm get string jre leak listener gc daemon fail else log debug sm get string jre leak listener gc daemon fail catch security exception log error sm get string jre leak listener gc daemon fail catch method exception log error sm get string jre leak listener gc daemon fail catch illegal argument exception log error sm get string jre leak listener gc daemon fail catch illegal access exception log error sm get string jre leak listener gc daemon fail catch invocation target exception log error sm get string jre leak listener gc daemon fail when servlet opens connection using url use sun net www http http client which keeps static reference keep alive cache which loaded using web application class loader keep alive protection try class name sun net www http http client catch class found exception system get property java vendor starts sun log error sm get string jre leak listener keep alive fail else log debug sm get string jre leak listener keep alive fail calling get policy retains static reference context class loader security policy protection try policy get policy class policy class class name javax security auth policy method method policy class get method get policy method invoke null catch class found exception ignore class deprecated catch security exception ignore don need call get policy successful just need trigger static initializer catch method exception log warn sm get string jre leak listener auth policy fail catch illegal argument exception log warn sm get string jre leak listener auth policy fail catch illegal access exception log warn sm get string jre leak listener auth policy fail catch invocation target exception log warn sm get string jre leak listener auth policy fail creating message digest during web application startup initializes java cryptography architecture under certain conditions starts token poller thread tccl equal web application class loader instead we initialize jca right now token poller protection java security security get providers several components end up opening jar without first disabling caching effectively locks file whilst more noticeable harder ignore windows affects all operating systems those libraries components known trigger issue include log4j versions 15 earlier javax xml bind jaxbcontext new instance set default url caching policy cache url cache protection try doesn matter jar doesn exist just long url well formed url url new url jar file dummy jar conn url open connection conn set default use caches false catch malformed urlexception log error sm get string jre leak listener jar url conn cache fail catch ioexception log error sm get string jre leak listener jar url conn cache fail haven got root what going leak web app first make calls below web application class loader pinned memory xml parsing protection document builder factory factory document builder factory new instance try factory new document builder catch parser exception log error sm get string jre leak listener xml parse fail finally thread current thread set context class loader loader add bug 50222 bug modify memory leak prevention code so pins system class loader memory rather than than common class loader which better embedded systems patch provided christopher schultz markt add
private int reply message options	channel send new member sender rmsg reply message options channel send options synchronized ack	public int get reply message options return reply message options public void set reply message options int reply message options reply message options reply message options fix bug 50184 bug add option rpc channel enable channel send options set reply message based patch ariel markt fix
boolean loaded false try manager find session keys null loaded true catch ioexception ioe ignore session expired loaded fix bug 50232 bug remove dependency between store base persistent manager associated code clean up patch provided tiago batista markt fix
failed destroying destroy auto destroyed	lifecycle event type component after destroy event public static final string after destroy event after destroy lifecycle event type component before destroy event public static final string before destroy event before destroy	destroying false lifecycle before destroy event destroyed false lifecycle after destroy event	else lifecycle after destroy event equals event get type	child destroy may have already been called which would have triggered call case need destroy child again lifecycle state destroying equals child get state child destroy	else event get type equals lifecycle after destroy event	lifecycle state destroying equals state lifecycle state destroyed equals state	invalid transition lifecycle before destroy event set state lifecycle state destroying fix bug 50168 bug separate code lifecycle destroy event code code lifecycle before destroy event code code lifecycle after destroy event code use additional state ensure code context code objects only destroyed once markt fix
op	override	override	override	override	override	public void set manager class name suppress warnings unused string manager class name log warn set manager class name deprecated use nested manager element inside cluster element instead request ignored	override	override	override	override	override	override override	override	override	override	override	override	override	override	override override	override	override	override	override	override	override	valve set cluster	utils call method get container remove valve new object valve new class org apache catalina valve class valve set cluster	override	override	override	override	override override	iterator cluster listener iter cluster listeners iterator iter has next accepted notify lifecycle listener failure log debug enabled log debug message message string from type message get class get name transfered listener registered override	override op override
determines whether logfile rotatable private boolean rotatable true	rotatable date equals ts date	rotatable boolean parse boolean get property class name rotatable true	prefix rotatable date suffix
add listeners engine	override add listeners child child started too late life cycle listener register child so register here child get state available child instanceof host register host host child else child instanceof context register context context child else child instanceof wrapper register wrapper wrapper child need unregister life cycle listener handle when child stops	default host connector	log debug sm get string mapper listener register host host get name domain connector	domain connector	string wrapper name wrapper get name	log debug enabled log debug sm get string mapper listener unregister wrapper wrapper name context name connector	log debug sm get string mapper listener register context context name connector	log debug sm get string mapper listener unregister context context name connector	wrapper name context name connector	add mapper container all child containers param container private void add listeners container container container add container listener container add lifecycle listener container child container find children add listeners child operation name find container listener names description return set container listener class names configured application impact info return type ljava lang string operation operation name find lifecycle listener names description return set lifecycle listener class names configured application impact info return type ljava lang string operation	list class name each lifecycle listeners added container public string find lifecycle listener names throws mbean exception container base container null list string result new array list string try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception lifecycle listener listeners container find lifecycle listeners lifecycle listener listener listeners result add listener get class get name return result array new string result size list class name each container listeners added container public string find container listener names throws mbean exception container base container null list string result new array list string try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception container listener listeners container find container listeners container listener listener listeners result add listener get class get name return result array new string result size fix bug 50157 bug ensure mapper listener only added container object once markt fix add improve debug logging mapper listener registration markt add add expose names lifecycle listeners container listers standard context via jmx markt add
boolean web xmlservlet def servlet def null web xmlservlet def false else web xmlservlet def true	url patterns null	boolean web xmlfilter def filter def null web xmlfilter def false else web xmlfilter def true	url patterns set url patterns length	dispatch types set dispatcher types length
private static final map object method object cache new concurrent hash map object method	method methods cache object cache get target object methods cache null method create method cache methods cache method name target object target type else method null	method methods cache object cache get target object methods cache null method create method cache methods cache method name target object target type else method null	override fix bug 50138 bug fix threading issues code org apache catalina security security util code markt fix
engine remove child host subsection name catalina changelog fix bug 50107 bug when removing host via jmx do attempt destroy host apos pipeline twice patch provided eiji takahashi markt fix changelog subsection fix bug 50105 bug when processing composite el expressions use code enum name code rather than code enum string code required el markt fix
sb append elsupport coerce string obj	public void test bug50105 expression factory factory expression factory new instance elcontext context new elcontext impl tester enum test enum tester enum apple value expression var factory create value expression test enum tester enum class context get variable mapper set variable test enum var when coercing enum string name should always used value expression ve1 factory create value expression context test enum string class string result1 string ve1 get value context assert equals apple result1 value expression ve2 factory create value expression context foo test enum bar string class string result2 string ve2 get value context assert equals foo applebar result2	apple orange override public string string return name subsection name jasper changelog bug 50105 bug when processing composite el expressions use code enum name code rather than code enum string code required el markt changelog subsection
string manager sm client get string manager request	do sessions path request response sm client message sm client get string manager servlet exception	sm client get string manager servlet post command command sm client get string manager servlet unknown command command list request response message sm client	string manager sm client get string manager request	message upload request sm client message deploy internal deploy config deploy path deploy war sm client message reload path sm client message undeploy path sm client message expire sessions path request sm client message start path sm client message stop path sm client message findleaks sm client list request response message sm client	protected string upload http servlet request request string manager sm client	message sm client get string html manager servlet deploy upload file message sm client get string	message sm client get string	message sm client get string	message sm client get string	protected string deploy internal string config string path string war string manager sm client super deploy print writer config path war false sm client	string message string manager sm client throws ioexception	args sm client get string html manager servlet title args sm client get string html manager servlet message label	args sm client get string html manager servlet manager args sm client get string html manager servlet list sm client get string html manager servlet help html manager file args sm client get string html manager servlet help html manager sm client get string html manager servlet help manager file args sm client get string html manager servlet help manager args sm client get string status servlet title args sm client get string html manager servlet apps title args sm client get string html manager servlet apps path args sm client get string html manager servlet apps name args sm client get string html manager servlet apps available args sm client get string html manager servlet apps sessions args sm client get string html manager servlet apps tasks	string apps start sm client get string html manager servlet apps start string apps stop sm client get string html manager servlet apps stop string apps reload sm client get string html manager servlet apps reload string apps undeploy sm client get string html manager servlet apps undeploy string apps expire sm client get string html manager servlet apps expire	args 10 sm client get string html manager servlet expire explain args 11 sm client get string html manager servlet manager args 12 sm client get string html manager servlet expire unit	args sm client get string html manager servlet deploy title args sm client get string html manager servlet deploy server args sm client get string html manager servlet deploy path args sm client get string html manager servlet deploy config args sm client get string html manager servlet deploy war args sm client get string html manager servlet deploy button args sm client get string html manager servlet deploy upload args sm client get string html manager servlet deploy upload file args sm client get string html manager servlet deploy button args sm client get string html manager servlet diagnostics title args sm client get string html manager servlet diagnostics leak args sm client get string html manager servlet diagnostics leak warning args sm client get string html manager servlet diagnostics leak button args sm client get string html manager servlet server title args sm client get string html manager servlet server version args sm client get string html manager servlet server jvmversion args sm client get string html manager servlet server jvmvendor args sm client get string html manager servlet server osname args sm client get string html manager servlet server osversion args sm client get string html manager servlet server osarch	protected string reload string path string manager sm client super reload print writer path sm client	protected string undeploy string path string manager sm client super undeploy print writer path sm client	public string sessions string path int idle string manager sm client super sessions print writer path idle sm client	public string sessions string path string manager sm client return sessions path sm client	public string start string path string manager sm client super start print writer path sm client	protected string stop string path string manager sm client super stop print writer path sm client	protected string findleaks string manager sm client super findleaks print writer sm client msg append sm client get string html manager servlet findleaks list msg append sm client get string html manager servlet findleaks none	protected string expire sessions string path http servlet request req string manager sm client	return sessions path idle sm client	protected void do sessions string path http servlet request req http servlet response resp string manager sm client throws servlet exception ioexception	display session detail page req resp path session id sm client int invalidate sessions path session ids sm client boolean removed remove session attribute path session id name sm client display sessions list page path req resp sm client protected list session get sessions path string path string manager sm client throw new illegal argument exception sm client get string manager servlet invalid path request util filter path throw new illegal argument exception sm client get string manager servlet context request util filter path	protected session get session path id string path string id string manager sm client throws ioexception throw new illegal argument exception sm client get string manager servlet invalid path request util filter path throw new illegal argument exception sm client get string manager servlet context request util filter path	protected void display sessions list page string path http servlet request req http servlet response resp string manager sm client throws servlet exception ioexception list session sessions get sessions path path sm client	protected void display session detail page http servlet request req http servlet response resp string path string session id string manager sm client throws servlet exception ioexception session session get session path id path session id sm client	public int invalidate sessions string path string session ids string manager sm client throws ioexception http session session get session path id path session id sm client get session	public boolean remove session attribute string path string session id string attribute name string manager sm client throws ioexception http session session get session path id path session id sm client get session	public int set session max inactive interval string path string session id int max inactive interval string manager sm client throws ioexception http session session get session path id path session id sm client get session	string manager sm client get string manager request	writer println sm client get string manager servlet command deploy writer config path war update sm client deploy writer path tag sm client list writer sm client reload writer path sm client resources writer type sm client roles writer sm client save writer path sm client serverinfo writer sm client expire sessions writer path request sm client expire sessions writer path request sm client start writer path sm client stop writer path sm client undeploy writer path sm client findleaks writer sm client writer println sm client get string manager servlet unknown command command	string manager sm client get string manager request	writer println sm client get string manager servlet command deploy writer path tag update request sm client writer println sm client get string manager servlet unknown command command	throw new unavailable exception sm get string manager servlet wrapper	protected void findleaks print writer writer string manager sm client writer println sm client get string manager servlet findleaks fail	protected synchronized void save print writer writer string path string manager sm client writer println sm client get string manager servlet save fail server writer println sm client get string manager servlet saved writer println sm client get string manager servlet exception string	writer println sm client get string manager servlet context path writer println sm client get string manager servlet saved context path writer println sm client get string manager servlet exception string	string tag boolean update http servlet request request string manager sm client	writer println sm client get string manager servlet invalid path path	undeploy writer display path sm client writer println sm client get string manager servlet already context display path	writer println sm client get string manager servlet exception string writer println sm client get string manager servlet deployed display path writer println sm client get string manager servlet deploy failed display path	protected void deploy print writer writer string path string tag string manager sm client writer println sm client get string manager servlet invalid path path	undeploy writer display path sm client	writer println sm client get string manager servlet exception string writer println sm client get string manager servlet deployed display path writer println sm client get string manager servlet deploy failed display path	string path string war boolean update string manager sm client	writer println sm client get string manager servlet invalid path request util filter path	undeploy writer display path sm client writer println sm client get string manager servlet already context	writer println sm client get string manager servlet deployed display path writer println sm client get string manager servlet deployed started display path writer println sm client get string manager servlet deploy failed display path writer println sm client get string manager servlet exception	protected void list print writer writer string manager sm client writer println sm client get string manager servlet listed	writer println sm client get string manager servlet listitem display path running context get manager find sessions length context get doc base writer println sm client get string manager servlet listitem display path stopped context get doc base	protected void reload print writer writer string path string manager sm client writer println sm client get string manager servlet invalid path request util filter path	writer println sm client get string manager servlet context request util filter display path writer println sm client get string manager servlet self sm client get string manager servlet reloaded display path writer println sm client get string manager servlet exception string	protected void resources print writer writer string type string manager sm client	writer println sm client get string manager servlet global writer println sm client get string manager servlet resources type type writer println sm client get string manager servlet resources all	writer println sm client get string manager servlet exception string print resources writer global type clazz sm client	string type class clazz string manager sm client	javax naming context item get object type clazz sm client	writer println sm client get string manager servlet exception string	protected void roles print writer writer string manager sm client	writer println sm client get string manager servlet user database error writer println sm client get string manager servlet user database missing writer println sm client get string manager servlet roles list	protected void serverinfo print writer writer string manager sm client	writer println sm client get string manager servlet exception string	protected void sessions print writer writer string path int idle string manager sm client	writer println sm client get string manager servlet invalid path request util filter path	writer println sm client get string manager servlet context request util filter display path writer println sm client get string manager servlet manager	writer println sm client get string manager servlet sessions display path writer println sm client get string manager servlet max inactive interval	writer println sm client get string manager servlet histo interval timeout writer println sm client get string manager servlet histo interval histo interval timeout writer println sm client get string manager servlet max count histo interval timeout max count writer println sm client get string manager servlet unlimited notimeout writer println sm client get string manager servlet expired idle expired writer println sm client get string manager servlet exception string	protected void sessions print writer writer string path string manager sm client sessions writer path sm client	protected void expire sessions print writer writer string path http servlet request req string manager sm client	sessions writer path idle sm client	protected void start print writer writer string path string manager sm client writer println sm client get string manager servlet invalid path request util filter path	writer println sm client get string manager servlet context request util filter display path writer println sm client get string manager servlet started display path writer println sm client get string manager servlet start failed display path get servlet context log sm get string manager servlet start failed display path writer println sm client get string manager servlet start failed display path writer println sm client get string manager servlet exception string	protected void stop print writer writer string path string manager sm client writer println sm client get string manager servlet invalid path request util filter path	writer println sm client get string manager servlet context request util filter display path writer println sm client get string manager servlet self writer println sm client get string manager servlet stopped display path writer println sm client get string manager servlet exception string	protected void undeploy print writer writer string path string manager sm client writer println sm client get string manager servlet invalid path request util filter path	writer println sm client get string manager servlet context request util filter display path writer println sm client get string manager servlet deployed	writer println sm client get string manager servlet undeployed display path writer println sm client get string manager servlet exception string	protected string manager get string manager http servlet request req enumeration locale requested locales req get locales while requested locales has more elements locale locale requested locales next element string manager result string manager get manager constants package locale result get locale equals locale return result return default return sm	private string manager string package name locale locale bnd resource bundle get bundle bundle name locale	bnd resource bundle get bundle bundle name locale cl	locale bundle get locale locale null	str cannot find message associated key key due mre	identify locale string manager associated public locale get locale return locale private static final map string map locale string manager managers new hashtable string map locale string manager	public synchronized static final string manager get manager string package name return get manager package name locale get default get string manager particular package locale manager package locale combination already exists reused else new string manager created returned param package name package name param locale locale public synchronized static final string manager get manager string package name locale locale map locale string manager map managers get package name map null map new hashtable locale string manager managers put package name map string manager mgr map get locale mgr new string manager package name locale map put locale mgr
catch class format error log warn sm get string context config invalid sci handles types class name return fix bug 50087 bug catch class format errors when scanning annotations markt fix
use same classloader classpath compiling tag files temp wrapper get jsp engine context set class loader ctxt get class loader temp wrapper get jsp engine context set class path ctxt get class path fix bug 50066 bug fix building recursive tag files when file depends jar file patch provided sylvain laurent markt fix
web xml configure context context fix bug 500063 bug correct regression fix bug 50059 bug causes applications marked meta data complete return 404s all requests patch provided heyoulin markt fix
set from server xml get object key properties name only trigger npe initial registration takes place init get state lifecycle state new unregister oname naming resources oname naming resources register naming resources type naming resources get object key properties name only bug 50027 bug avoid npe start when context defined server xml one more jndi resources markt fix fix
web xml version	only need process fragments annotations metadata complete set web xml ordered fragments null web xml metadata complete step order fragments ordered fragments web xml order web fragments web xml fragments step look servlet container initializer ok process servlet container initializers ordered fragments step process web inf classes annotations add any matching classes type initializer map ok url webinf classes try webinf classes context get servlet context get resource web inf classes process annotations url webinf classes web xml catch malformed urlexception log error sm get string context config webinf classes url step process jars annotations only need process those fragments we going use add any matching classes type initializer map ok process annotations ordered fragments step merge web fragment xml files main web xml file ok ok web xml merge ordered fragments step convert explicitly mentioned jsps servlets false convert jsps web xml step apply merged web xml context ok web xml configure context context step 7a make merged web xml available other components specifically jasper save those components from having re generate todo use servlet container initializer jasper string merged web xml web xml xml context get servlet context set attribute org apache tomcat util scan constants merged web xml merged web xml context get log effective web xml log info web xml merged web xml else ok true always need look static resources ordered fragments null web xml fragment ordered fragments resource jars add fragment	only look servlet container initializer metadata complete web xml metadata complete step apply servlet container initializer config context ok map entry servlet container initializer set class entry initializer class map entry set entry get value empty context add servlet container initializer entry get key null else context add servlet container initializer entry get key entry get value fix bug 50059 bug jars should always searched static resources even web application marked meta data complete markt fix
private final object base private final object property	private final async context context private final servlet request request private final servlet response response private final throwable throwable request null response null throwable null	throwable null request null response null	private final empty role semantic empty role semantic empty role semantic permit private final transport guarantee transport guarantee transport guarantee none private final string roles allowed new string empty role semantic empty role semantic permit transport guarantee transport guarantee none roles allowed new string	transport guarantee transport guarantee none roles allowed new string	empty role semantic empty role semantic permit	private final string method name	private final string location private final long max file size private final long max request size private final int file size threshold else location max file size max request size file size threshold	else location	private final string name private final object value	private final string name private final object value	private final servlet request request	private final map string http method constraint element method constraints	private final servlet servlet what unavailable private final boolean permanent needs admin action private final int seconds estimate	seconds	seconds servlet null	servlet null	private final string name private final object value	value null	private final throwable throwable private final int status code private final string uri private final string servlet name	private final jsp writer enclosing writer	private final string name private final string function class private final string function signature	name required type req time false	name required type req time fragment null false false null null	name name required required type type req time req time fragment fragment	private final string name private final string type private final boolean req time private final boolean required private final boolean fragment private final string description private final boolean deferred value private final boolean deferred method private final string expected type name private final string method signature	private final hashtable string object attributes tagname value map	private tag info tag info	private final string name private final string path private final tag info tag info	private final string name given name given private final string name from attribute name from attribute private final string class name class private final boolean declare declare private final int scope scope	private final string id private final string message	private final string var name private final string class name private final boolean declare private final int scope update bug 50017 bug code clean up functional change patch provided sebb markt update
public void login string user name string password request request throws servlet exception public void logout request request throws servlet exception	param wrapper wrapper context evaluating role public boolean has role wrapper wrapper principal principal string role	public void login string username string password request request throws servlet exception principal principal do login request username password register request request get response principal get auth method username password protected abstract string get auth method protected principal do login request request string username string password throws servlet exception principal context get realm authenticate username password null throw new servlet exception sm get string login fail return public void logout request request throws servlet exception register request request get response null null null null	override protected string get auth method return constants basic method	override protected string get auth method return constants digest method	override protected string get auth method return constants form method	override protected string get auth method return none	override protected string get auth method return constants cert method	return realm has role wrapper user principal role	context get null throw new servlet exception context get login username password	context get logout	has role null principal roles	override public boolean has role wrapper wrapper principal principal string role check role alias defined security role ref element wrapper null string real role wrapper find security reference role real role null role real role	public boolean has role wrapper wrapper principal principal string role check role alias defined security role ref element wrapper null string real role wrapper find security reference role real role null role real role	return super has role null principal role fix bug 50016 bug re factor code user role code code login logout code methods support jacc improve patch provided david jencks markt fix
private map string string parameters new concurrent hash map string string	set up context init params merge parameters	merge context parameters specified application deployment descriptor application parameters described server respecting code override code property application parameters private void merge parameters servlet context sc get servlet context string names find parameters int names length sc set init parameter names find parameter names application parameter params find application parameters int params length params get override sc get init parameter params get name null sc set init parameter params get name params get value else sc set init parameter params get name params get value fix bug 49987 bug fix thread safety issue population servlet context parameters markt fix
whether servlet needs reloading next access private volatile boolean reload true timestamp last time servlet resource modified private volatile long servlet class last modified time	dcl reload requires reload volatile also forces read memory barrier ensuring new servlet object read consistently	final servlet servlet	volatile reload forces order write servlet new servlet object	dcl requires servlet class last modified time volatile force read write barriers access set get atomic write long
private static final int cache size private static final simple date format format private static final simple date format formats private static final time zone gmt zone time zone get time zone gmt	private static volatile long current date generated 0l private static string current date null private static final concurrent hash map long string format cache private static final concurrent hash map string long parse cache	current date generated now licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license string manager package protected static final string manager sm string manager get manager constants package protected abstract log get log protected object name tp oname null protected object name rg oname null protected abstract endpoint endpoint null adapter used call connector protected adapter adapter protected hash map string object attributes new hash map string object pass config info override public void set attribute string name object value get log trace enabled get log trace sm get string ajpprotocol setattribute name value attributes put name value override public object get attribute string key get log trace enabled get log trace sm get string ajpprotocol getattribute key return attributes get key override public iterator string get attribute names return attributes key set iterator set property public boolean set property string name string value set attribute name value store all settings name null name starts socket name starts selector pool return endpoint set property name value else return endpoint set property name value make sure we least try set all properties get property public string get property string name return string get attribute name adapter used call connector override public void set adapter adapter adapter adapter adapter override public adapter get adapter return adapter override public void pause throws exception try endpoint pause catch exception ex get log error sm get string ajpprotocol endpoint pauseerror ex throw ex get log info enabled get log info sm get string ajpprotocol pause get name override public void resume throws exception try endpoint resume catch exception ex get log error sm get string ajpprotocol endpoint resumeerror ex throw ex get log info enabled get log info sm get string ajpprotocol resume get name override public void stop throws exception try endpoint stop catch exception ex get log error sm get string ajpprotocol endpoint stoperror ex throw ex get log info enabled get log info sm get string ajpprotocol stop get name override public void destroy throws exception get log info enabled get log info sm get string ajpprotocol destroy get name endpoint destroy tp oname null registry get registry null null unregister component tp oname rg oname null registry get registry null null unregister component rg oname public string get name string encoded addr get address null encoded addr get address encoded addr starts encoded addr encoded addr substring encoded addr urlencoder encode encoded addr return ajp encoded addr endpoint get port processor cache protected int processor cache public int get processor cache return processor cache public void set processor cache int processor cache processor cache processor cache override public executor get executor return endpoint get executor public void set executor executor executor endpoint set executor executor public int get max threads return endpoint get max threads public void set max threads int max threads endpoint set max threads max threads public int get thread priority return endpoint get thread priority public void set thread priority int thread priority endpoint set thread priority thread priority public int get backlog return endpoint get backlog public void set backlog int backlog endpoint set backlog backlog public int get port return endpoint get port public void set port int port endpoint set port port public inet address get address return endpoint get address public void set address inet address ia endpoint set address ia public boolean get tcp delay return endpoint get tcp delay public void set tcp delay boolean tcp delay endpoint set tcp delay tcp delay public int get so linger return endpoint get so linger public void set so linger int so linger endpoint set so linger so linger public int get so timeout return endpoint get so timeout public void set so timeout int so timeout endpoint set so timeout so timeout should done native webserver layer servlet container protected boolean tomcat true public boolean get tomcat return tomcat public void set tomcat boolean tomcat tomcat tomcat required secret protected string required secret null public void set required secret string required secret required secret required secret ajp packet size protected int packet size constants max packet size public int get packet size return packet size public void set packet size int packet size packet size constants max packet size packet size constants max packet size else packet size packet size number seconds tomcat wait subsequent request before closing connection protected int keep alive timeout public int get keep alive timeout return keep alive timeout public void set keep alive timeout int timeout keep alive timeout timeout jmx related methods protected string domain protected object name oname protected mbean server mserver public object name get object name return oname public string get domain return domain override public object name pre register mbean server server object name name throws exception oname name mserver server domain name get domain return name override public void post register boolean registration done noop override public void pre deregister throws exception noop override public void post deregister noop
override protected log get log return log endpoint new apr endpoint	apr endpoint endpoint set handler handler apr endpoint endpoint set use sendfile false	public int get poll time return apr endpoint endpoint get poll time public void set poll time int poll time apr endpoint endpoint set poll time poll time public void set poller size int poller size apr endpoint endpoint set poller size poller size public int get poller size return apr endpoint endpoint get poller size	apr endpoint proto endpoint get poller add socket get socket long value	ajp apr processor processor new ajp apr processor proto packet size apr endpoint proto endpoint	override protected log get log return log endpoint new jio endpoint	jio endpoint endpoint set handler handler	ajp processor processor new ajp processor proto packet size jio endpoint proto endpoint	fix bug 50054 bug correctly handle setting min spare threads ajp connector kfujino fix
string normalized name normalize name normalized name null normalized name length lookedup resource context lookup normalized name	string normalized name normalize name normalized name null normalized name length lookedup resource context lookup normalized name	private static string normalize string jndi name jndi name null jndi name starts java comp env return jndi name substring 14 return jndi name fix bug 49956 bug handle case when resource annotation uses full jndi name resource based patch gurkan erdogdu markt fix
listeners may have been added servlet context initializers put them after ones we know about object event listener get application event listeners event listeners add event listener object lifecycle listener get application lifecycle listeners lifecycle listeners add lifecycle listener	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license check servlet container initializer can install link servlet context listener gets initialized throws exception public void test servlet container initializer throws exception tomcat tomcat get tomcat instance context context tomcat add context system get property java io tmpdir context add servlet container initializer new sci null tomcat start assert true scl initialized check link servlet context listener cannot install link servlet context initializer throws exception public void test servlet context listener throws exception tomcat tomcat get tomcat instance context context tomcat add context system get property java io tmpdir scl2 pretends web xml tries install servlet context initializer context add application listener scl2 class get name tomcat start check servlet context initializer wasn initialized assert false scl3 initialized public static class sci implements servlet container initializer override public void startup set class servlet context ctx throws servlet exception ctx add listener new scl public static class scl implements servlet context listener static boolean initialized false override public void context initialized servlet context event sce initialized true override public void context destroyed servlet context event sce noop public static class scl2 implements servlet context listener override public void context initialized servlet context event sce servlet context sc sce get servlet context sc add listener scl3 class get name override public void context destroyed servlet context event sce noop public static class scl3 implements servlet context listener static boolean initialized false override public void context initialized servlet context event sce initialized true override public void context destroyed servlet context event sce noop fix bug 49952 bug allow servlet container initializers add listeners web application patch provided david jencks markt fix
private volatile instance manager instance manager	suppress warnings unchecked listener get instance manager new instance clazz get name clazz get class loader catch invocation target exception servlet exception se new servlet exception throw se catch naming exception servlet exception se new servlet exception throw se catch class found exception servlet exception se new servlet exception throw se	private instance manager get instance manager instance manager null context instanceof standard context instance manager standard context context get instance manager else instance manager new default instance manager null new hash map string map string string context get class get class loader return instance manager filter matches more than one url pattern servlet name markt fix fix bug 49937 bug use instance manager when creating async listener through async context ensure annotations processed based patch david jencks markt
private volatile number number	private volatile number number	private volatile string string fix bug 49985 bug fix thread safety issue el parser markt fix
exception javax management instance found exception managed resource object cannot found exception javax management mbean exception initializer object throws exception persistence supported exception javax management runtime operations exception exception reported persistence mechanism object name sname new object name catalina type store config mserver invoke sname store config null null bug 49915 bug make error more obvious particularly when accessed via jconsole standard server store config called when store config present markt fix fix
executor new thread pool executor max spare threads max threads keep alive time time unit milliseconds new tccl thread factory	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license thread factory creates threads thread context class loader set class loader loaded factory intended used when tasks may passed executors when web application class loader set thread context class loader async session replication private static final atomic integer pool number new atomic integer private static final boolean security enabled system get security manager null private final thread group group private final atomic integer thread number new atomic integer private final string name prefix public tccl thread factory security manager system get security manager group null get thread group thread current thread get thread group name prefix pool pool number get increment thread override public thread new thread runnable final thread new thread group name prefix thread number get increment security enabled access controller do privileged new privileged action void override public void run set context class loader get class get class loader return null else set context class loader get class get class loader return
private static final int jvm bug threshold 16 private volatile int jvm bug count	long before system current time millis long after system current time millis key count after before selector timeout jvm bug count jvm bug count jvm bug threshold log error sm get string endpoint err jvmbug sylvain laurent markt add bug 49890 bug detect when nio connector encounters known jvm bug linux log error help determine bug still present ort jvm bug should fixed kernels 0u18 jvms later markt add
integer string rmi registry port integer string rmi server port server name subsection name extras changelog fix bug 49861 bug don apos log rmi ports formatted commas jmx remote listener markt fix changelog subsection
driver manager get drivers has nasty side effect registering drivers visible class loader haven yet been loaded therefore first call method gets list originally loaded drivers triggers unwanted side effect second call gets complete list drivers ensuring both original drivers any loaded result side effects all de registered hash set driver original drivers new hash set driver original drivers add drivers next element drivers driver manager get drivers while drivers has more elements only report drivers were originally registered skip any were registered side effect code original drivers contains driver driver names add driver get class get canonical name bug 49667 bug ensure using jdbc driver memory leak prevention code does cause one memory leaks meant avoid markt fix fix
public string get executor name object obj protocol handler get executor obj instanceof org apache catalina executor return org apache catalina executor obj get name return internal attribute name executor name description name executor any associated connector type java lang string writeable false bug 49856 bug add executor name attribute connectors so possible trace thread pool connector executor via jmx interface markt fix fix
parent get submitted count parent get pool size return super offer	link get submitted count method used properly handle work queue	number tasks submitted yet finished includes tasks queue tasks have been handed worker thread latter did start executing task yet number always greater equal link get active count private final atomic integer submitted count new atomic integer	submitted count decrement get public int get submitted count return submitted count get	submitted count increment get	submitted count decrement get submitted count decrement get submitted count decrement get bug 49730 bug fix race condition standard thread exector can cause requests experience large delays patch provided sylvain laurent markt fix fix
handle throwable	handle throwable	handle throwable	copied from exception utils since class visible during start private static void handle throwable throwable instanceof thread death throw thread death instanceof virtual machine error throw virtual machine error all other instances throwable silently swallowed fix bug 50021 bug correct regression fix bug 46844 bug may have caused additional problems during failure start up markt fix
param jar resource jar file from which read included resource	param jar resource location tag file	param jar resource jar file from which read jsp page tag file	param jar resource jar resource containing tag file fix bug 50018 bug fix some minor javadoc errors jasper source based patch sebb timw fix
else server object already present must running service shutdown hook take care clean up system exit bug 49195 bug don report error when shutting down windows service tomcat instance has disabled shutdown port markt fix fix
string builder msg new string builder msg append file msg append get start msg append jsp get property bean name	err null	page info prefix uri location err reader mark	public tag library info impl jsp compilation context ctxt parser controller pc page info pi string prefix string uri tld location location error dispatcher err mark mark	err jsp error mark jsp error file found tld name	err jsp error mark jsp error tld unable read jar resource get url bug 49665 bug provide better information including jsp file name location when missing file detected during tld handling patch provided ted leung markt fix fix
check resource could compressed client supports private boolean compressable check content already gzipped message bytes content encoding mb response get mime headers get value content encoding content encoding mb null content encoding mb index gzip return false force mode always compress test purposes only compression level return true check sufficient length trigger compression long content length response get content length long content length content length compression min size check compatible mime type compressable mime types null return starts string array compressable mime types response get content type return false check compression should used resource already checked resource could compressed client supports private boolean use compression	return true	boolean compressable false compressable compressable compressable use compression use compression	might compressed set vary header compressable bug 49625 bug ensure vary header set response may compressed rather than only setting compressed markt fix fix
class bytes offset get class get protection domain
string method name constants get method code method code	name constants get header code id	string method name constants get method code method code	name constants get header code id	private static final string method trans array	converts ajp coded http method method name param code coded value return string value method	private static final string header trans array	converts ajp coded http request header header name param code coded value return string value header name private static final string response trans array	converts ajp coded response header name http response header name param code coded value return string value header	response trans hash put get response header code
classes from j2se java most classes servlet api	need careful order here name null can load class without name name starts java must never load java classes name starts javax servlet jsp jstl ok web apps package jstl return true name starts javax servlet web apps should never package any other servlet jsp classes assume everything else ok fix bug 49909 bug fix regression introduced fix bug 47950 bug prevented jstl classes being loaded markt fix
session set primary session true	entry get value null entry get value instanceof replicated map entry replicated map entry val replicated map entry entry get value val set owner get map owner get map owner object made primay key entry get value	fix bug 49924 bug when non primary node changes primary node make sure primary session changed true kfujino fix
return parent class loader public class loader get parent class loader return outer catalina startup shutdown component present public catalina get catalina set outer catalina startup shutdown component present public void set catalina catalina catalina	return parent class loader public class loader get parent class loader	return parent class loader component override public class loader get parent class loader parent class loader null return parent class loader service null return service get parent class loader return class loader get system class loader	private catalina catalina null	return outer catalina startup shutdown component present override public catalina get catalina return catalina set outer catalina startup shutdown component present override public void set catalina catalina catalina catalina catalina	return parent class loader component override public class loader get parent class loader catalina null return catalina get parent class loader return class loader get system class loader	return parent class loader component override public class loader get parent class loader server null return server get parent class loader return class loader get system class loader type org apache catalina core standard context class name org apache catalina mbeans context mbean operation name add application listener description add new listener class name set listeners configured application impact action return type void parameter name listener description java class name listener class type java lang string operation operation name add application parameter description add new application parameter application impact action return type void parameter name listener description java class name listener class type java lang string operation operation name add child description add child context impact action return type void parameter name type description type classname new child added type java lang string parameter name name description name child added type java lang string operation operation name add instance listener description add classname instance listener added each wrapper appended context impact action return type void parameter name listener description java class name instance listener class type java lang string operation operation name add lifecycle listener description add lifecycle listener context impact action return type void parameter name type description type classname new lifecycle listener added type java lang string operation operation name add locale encoding mapping parameter description add locale encoding mapping impact action return type void parameter name locale description locale map encoding type java lang string parameter name encoding description encoding used give locale type java lang string operation operation name add mime mapping description add new mime mapping replacing any existing mapping specified extension impact action return type void parameter name extension description filename extension being mapped type java lang string parameter name mime type description mime type type java lang string operation operation name add parameter description add new context parameter replacing any existing value specified name impact action return type void parameter name name description name new parameter type java lang string parameter name value description value new parameter type java lang string operation operation name add role mapping description add security role reference web application impact action return type void parameter name role description security role used application type java lang string parameter name link description actual security role check type java lang string operation operation name add security role description add new security role web application impact action return type void parameter name role description new security role type java lang string operation operation name add servlet mapping description add new servlet mapping replacing any existing mapping specified pattern impact action return type void parameter name pattern description url pattern mapped type java lang string parameter name name description name servlet execute type java lang string operation operation name add servlet mapping description add new servlet mapping replacing any existing mapping specified pattern impact action return type void parameter name pattern description url pattern mapped type java lang string parameter name name description name servlet execute type java lang string parameter name jsp wildcard description true name identifies jsp servlet pattern contains wildcard false otherwise type boolean operation return type java lang string parameter name valve type description type classname new valve added type java lang string operation operation name add watched resource description add resource which watched reloading host auto deployer impact action parameter name name description path resource relative doc base type java lang string operation name add welcome file description add new welcome file set recognized context parameter name name description new welcome file name type java lang string operation name add wrapper lifecycle description add classname lifecycle listener added each wrapper appended context description java class name lifecycle listener class type java lang string operation name add wrapper listener description add classname container listener added each wrapper appended context description java class name container listener class type java lang string operation name destroy description destroy context operation name find application listeners description return set application listener class names configured application impact info return type ljava lang string operation operation name find application parameters description return set application parameters application impact info return type java lang string operation operation name find constraints description return set security constraints web application none zero length array returned impact info return type java lang string operation operation name find error page description return error page entry specified http error code any otherwise return null impact action return type java lang string parameter name error code description error code look up type int operation operation name find error page description return error page entry specified java exception type any otherwise return null impact action return type java lang string parameter name exception type description exception type look up type java lang string operation operation name find error pages description return set defined error pages all specified error codes exception types impact info return type ljava lang string operation operation name find filter def description return filter definition specified filter name any otherwise return null impact action return type java lang string parameter name exception type description exception type look up type java lang string operation operation name find filter defs description return set defined filters context impact info return type ljava lang string operation operation name find filter maps description return set filter mappings context impact info return type ljava lang string operation operation name find instance listeners description return set instance listener classes added newly created wrappers impact info return type ljava lang string operation operation name find mime mapping description return mime type which specified extension mapped any otherwise return null impact action return type java lang string parameter name extension description extension map mime type type java lang string operation operation name find mime mappings description return extensions which mime mappings defined impact action return type ljava lang string operation operation name find parameter description return value specified context parameter name any otherwise return null impact action return type java lang string parameter name name description name parameter return type java lang string operation operation name find parameters description return names all defined context parameters context impact action return type ljava lang string operation operation name find role mapping description given security role used application return role name defined underlying realm one otherwise return specified role unchanged impact action return type java lang string parameter name role description security role map type java lang string operation operation name find security role description return true specified security role defined application otherwise return false impact action return type boolean parameter name role description security role verify type java lang string operation operation name find security roles description return security roles defined application impact action return type ljava lang string operation operation name find servlet mapping description return servlet name mapped specified pattern impact action return type java lang string parameter name pattern description pattern which mapping requested type java lang string operation operation name find servlet mappings description return patterns all defined servlet mappings context impact action return type ljava lang string operation operation name find status page description return context relative uri error page specified http status code impact action return type java lang string parameter name status description http status code look up type int operation operation name find status pages description return set http status codes which error pages have been specified impact action return type lint operation operation name find watched resources description return set watched resources context impact action return type ljava lang string operation operation name find welcome file description return true specified welcome file defined context otherwise return false impact action return type boolean parameter name name description welcome file verify type java lang string operation operation name find welcome files description return set welcome files defined context impact action return type ljava lang string operation operation name find wrapper lifecycles description return set lifecycle listener classes added newly created wrappers impact action return type ljava lang string operation operation name find wrapper listeners description return set container listener classes added newly created wrappers impact action return type ljava lang string operation operation name reload description reload operation name remove application listener description remove specified application listener class from set listeners application impact action return type void parameter name listener description java class name listener removed type java lang string operation operation name remove application parameter description remove application parameter specified name from set application impact action return type void parameter name name description name application parameter remove type java lang string operation operation name remove child description remove child from context impact action return type void parameter name name description name existing child container removed type java lang string operation operation name remove instance listener description remove application parameter specified name from set application impact action return type void parameter name listener description class name instance listener class removed type java lang string operation operation name remove lifecycle listeners description removes lifecycle listeners given class type from context impact action return type void parameter name listener description type classname lifecycle listeners removed type java lang string operation operation name remove mime mapping description remove mime mapping specified extension exists otherwise action taken impact action return type void parameter name extension description extension remove mapping type java lang string operation operation name remove parameter description remove context parameter specified name exists otherwise action taken impact action return type void parameter name name description name parameter remove type java lang string operation operation name remove role mapping description remove any security role reference specified name impact action return type void parameter name role description security role used application remove type java lang string operation operation name remove security role description remove any security role specified name impact action return type void parameter name role description security role remove type java lang string operation operation name remove servlet mapping description remove any servlet mapping specified pattern exists otherwise action taken impact action return type void parameter name pattern description url pattern mapping remove type java lang string operation operation name remove valve description remove valve from context impact action return type void parameter name valve name description objectname valve removed type java lang string operation operation name remove watched resource description remove specified watched resource name from list associated context impact action return type void parameter name name description name watched resource removed type java lang string operation operation name remove welcome file description remove specified welcome file name from list recognized context impact action return type void parameter name name description name welcome file removed type java lang string operation operation name remove wrapper lifecycle description remove class name from set lifecycle listener classes added newly created wrappers impact action return type void parameter name listener description class name lifecycle listener class removed type java lang string operation operation name remove wrapper listener description remove class name from set container listener classes added newly created wrappers impact action return type void parameter name listener description class name container listener class removed type java lang string operation name start description start impact action return type void operation name stop description stop impact action return type void group engine class name org apache catalina mbeans container mbean writeable false parameter name type description type classname new child added type java lang string parameter name name description name child added type java lang string operation operation name add lifecycle listener description add lifecycle listener engine impact action return type void parameter name type description type classname new lifecycle listener added type java lang string operation operation name add valve description add valve engine impact action return type java lang string parameter name valve type description type classname new valve added type java lang string operation operation name destroy description destroy impact action return type void operation name init description init impact action return type void operation name remove child description remove child host from engine impact action return type void parameter name name description name existing child container removed type java lang string operation name remove lifecycle listeners description removes lifecycle listeners given class type from engine impact action return type void parameter name listener description type classname lifecycle listeners removed type java lang string operation operation name remove valve description remove valve from engine impact action return type void parameter name valve name description objectname valve removed type java lang string operation operation name start description start impact action return type void operation name stop description stop impact action return type void type org apache catalina core standard host class name org apache catalina mbeans container mbean type boolean operation name add child description add child context host impact action return type void parameter name type description type classname new child added type java lang string parameter name name description name child added type java lang string operation operation name add lifecycle listener description add lifecycle listener host impact action return type void parameter name type description type classname new lifecycle listener added type java lang string operation operation name add valve description add valve host impact action return type java lang string parameter name valve type description type classname new valve added type java lang string operation operation name destroy description destroy impact action return type void operation name find reloaded context memory leaks description provide list contexts have leaked memory reload attempt force full garbage collection use extreme caution production systems impact action return type ljava lang string operation name init description init impact action return type void operation name remove child description remove child context from host impact action return type void parameter name name description name existing child container removed type java lang string operation operation name remove lifecycle listeners description removes lifecycle listeners given class type from host return type void parameter name listener description type classname lifecycle listeners removed type java lang string operation operation name remove valve description remove valve from host impact action return type void parameter name valve name description objectname valve removed type java lang string operation operation name start description start impact action return type void operation name stop description stop impact action return type void type org apache catalina core standard service class name org apache catalina mbeans service mbean attribute name managed resource description managed resource mbean associated type java lang object attribute name name description unique name service type java lang string parameter name address description ip address which bind type java lang string parameter name port description tcp port number listen type int parameter name ajp description create ajp connector type boolean parameter name ssl description create secure connector type boolean operation name add executor description adds named executor service impact action return type void parameter name type description classname executor added type java lang string operation operation name find connectors description find return set connectors associated service impact action return type ljava lang string operation operation name find executors description retrieves all executors impact action return type ljava lang string operation operation name get executor description retrieves executor name impact action return type java lang string parameter name name description name executor retrieved type java lang string operation operation name start description start impact action return type void operation name stop description stop impact action return type void type org apache catalina core standard wrapper class name org apache catalina mbeans container mbean operation name add init parameter description add valve wrapper impact action return type void parameter name name description name parameter add type java lang string parameter name value description value parameter add type java lang string operation operation name add lifecycle listener description add lifecycle listener wrapper impact action return type void parameter name type description type classname new lifecycle listener added type java lang string operation operation name add mapping description add mapping associated wrapper impact action return type void parameter name mapping description new wrapper mapping type java lang string operation operation name add security reference description add new security role reference record set records servlet impact action return type void parameter name name description role name used within servlet type java lang string parameter name link description role name used within web application type java lang string operation operation name add valve description add valve wrapper impact action return type java lang string parameter name valve type description type classname new valve added type java lang string operation operation name find init parameter description add mapping associated wrapper impact action return type void parameter name mapping description new wrapper mapping type java lang string operation operation name find init parameters description return names all defined parameters servlet impact info return type ljava lang string operation operation name find security reference description return security role link specified security role reference name impact action return type java lang string parameter name name description security role reference used within servle type java lang string operation operation name find security references description return set security role reference names associated servlet impact info return type ljava lang string operation operation name remove init parameter description remove specified parameter from servlet parameter name name description name parameter remove type java lang string operation name remove lifecycle listeners description removes lifecycle listeners given class type from wrapper description type classname lifecycle listeners removed type java lang string operation operation name remove mapping description remove mapping associated wrapper impact action return type void parameter name mapping description pattern remove type java lang string operation operation name remove security reference description remove any security role reference specified role name impact action return type void parameter name name description security role used within servlet removeds type java lang string operation name remove valve description remove valve from wrapper impact action return type void parameter name valve name description objectname valve removed type java lang string operation licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license construct code model mbean code default code model mbean info code information exception mbean exception initializer object throws exception exception runtime operations exception illegal argument exception occurs public container mbean throws mbean exception runtime operations exception super add new child container those associated container supported won start child yet has started call start method after necessary done param type class name child added param name name child added exception mbean exception child cannot added public void add child string type string name throws mbean exception container contained null try contained container class name type new instance contained set name name contained instanceof standard host host config config new host config contained add lifecycle listener config else contained instanceof standard context context config config new context config contained add lifecycle listener config catch exception throw new mbean exception catch illegal access exception throw new mbean exception catch class found exception throw new mbean exception boolean old value true container base container null try container container base get managed resource old value container get start children container set start children false container add child contained contained init catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception catch lifecycle exception throw new mbean exception finally container null container set start children old value remove existing child container from association parent container param name name existing child container removed public void remove child string name throws mbean exception name null try container container container get managed resource container contained container find child name container remove child contained catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception adds valve container instance param valve type class name valve added exception mbean exception component cannot removed public string add valve string valve type throws mbean exception valve valve null try valve valve class name valve type new instance catch exception throw new mbean exception catch illegal access exception throw new mbean exception catch class found exception throw new mbean exception valve null return null try container base container container base get managed resource container add valve valve catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception return lifecycle mbean base valve get object name string remove existing valve param name mbean name component remove exception mbean exception component cannot removed public void remove valve string valve name throws mbean exception container base container null try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception object name oname try oname new object name valve name catch malformed object name exception throw new mbean exception catch null pointer exception throw new mbean exception container null valve valves container get pipeline get valves int valves length object name voname valve base valves get object name voname equals oname container get pipeline remove valve valves add lifecycle event listener component param type class name listener add public void add life cycle listener string type throws mbean exception lifecycle listener listener null try listener lifecycle listener class name type new instance catch exception throw new mbean exception catch illegal access exception throw new mbean exception catch class found exception throw new mbean exception listener null try container base container container base get managed resource container add lifecycle listener listener catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception remove lifecycle event listeners from component param listener class name listeners removed note all listeners having given class name removed public void remove life cycle listeners string type throws mbean exception container base container null try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception lifecycle listener listeners container find lifecycle listeners lifecycle listener listener listeners listener get class equals type container remove lifecycle listener listener licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public context mbean throws mbean exception runtime operations exception super return set application parameters application public string find application parameters throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception application parameter params context find application parameters string string params new string params length int counter counter params length counter string params counter params counter string return string params return security constraints web application none zero length array returned public string find constraints throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception security constraint constraints context find constraints string string constraints new string constraints length int counter counter constraints length counter string constraints counter constraints counter string return string constraints return error page entry specified http error code any otherwise return code null code param error code error code look up public string find error page int error code throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception return context find error page error code string return error page entry specified java exception type any otherwise return code null code param exception type exception type look up public string find error page string exception type throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception return context find error page exception type string return set defined error pages all specified error codes exception types public string find error pages throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception error page pages context find error pages string string pages new string pages length int counter counter pages length counter string pages counter pages counter string return string pages return filter definition specified filter name any otherwise return code null code param filter name filter name look up public string find filter def string name throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception filter def filter def context find filter def name return filter def string return set defined filters context public string find filter defs throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception application parameter params context find application parameters string string params new string params length int counter counter params length counter string params counter params counter string return string params return set filter mappings context public string find filter maps throws mbean exception context context try context context get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception filter map maps context find filter maps string string maps new string maps length int counter counter maps length counter string maps counter maps counter string return string maps licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public service mbean throws mbean exception runtime operations exception super add new connector set defined connectors associate service container param address ip address which bind param port tcp port number listen param ajp create ajp connector param ssl create secure connector throws mbean exception public void add connector string address int port boolean ajp boolean ssl throws mbean exception service service try service service get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception connector connector new connector address null address length connector set property address address connector set port port connector set protocol ajp ajp http connector set secure ssl connector set scheme ssl https http service add connector connector adds named executor service param type classname executor added throws mbean exception public void add executor string type throws mbean exception service service try service service get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception executor executor try executor executor class name type new instance catch exception throw new mbean exception catch illegal access exception throw new mbean exception catch class found exception throw new mbean exception service add executor executor find return set connectors associated service throws mbean exception public string find connectors throws mbean exception service service try service service get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception connector connectors service find connectors string str new string connectors length int connectors length str connectors string return str retrieves all executors throws mbean exception public string find executors throws mbean exception service service try service service get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception executor executors service find executors string str new string executors length int executors length str executors string return str retrieves executor name param name name executor retrieved throws mbean exception public string get executor string name throws mbean exception service service try service service get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception executor executor service get executor name return executor string	public class loader get parent class loader return parent class loader	get server set catalina fix gsoc 2010 enable creation services engines connectors hosts contexts via jmx from minimal server xml contains only server element based patch chamith buddhika markt fix
method get name length	clazz get name get name method	public static string get name method setter string builder name new string builder setter get name remove set name delete lowercase first char name set char character lower case name char return name string
xa connection null connection close else xa connection close
descriptive information about realm protected static final string name combined realm	return name fix bug 49883 bug ensure combined realm returns name use log messages rather than throwing code unsupported operation exception code markt fix
try protocol handler stop catch exception throw new lifecycle exception sm get string coyote connector protocol handler stop failed	param executor name string public executor get executor string executor name executor name equals executor get name	pause connectors first	now stop connectors lifecycle state started equals connectors only need stopping currently started may have failed start may have been stopped via jmx call	stop protocol public void stop throws exception	while started error endpoint paused	error endpoint paused async error endpoint paused	public void stop throws exception try endpoint stop catch exception ex log error sm get string ajpprotocol endpoint stoperror ex throw ex public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name	while started error endpoint paused	async error endpoint paused	public void stop throws exception try endpoint stop catch exception ex log error sm get string ajpprotocol endpoint stoperror ex throw ex public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name	public void stop throws exception try endpoint stop catch exception ex get log error sm get string endpoint stoperror ex throw ex override public void destroy throws exception get log info enabled get log info sm get string destroy get name	while error keep alive comet async endpoint paused	error endpoint paused input buffer next request output buffer next request recycle return socket state closed else comet async return socket state long	while error keep alive comet async endpoint paused	error endpoint paused recycle return socket state closed else comet async return socket state long recycle	while started error keep alive endpoint paused	error endpoint paused	public abstract void init throws exception pause endpoint which stop accepting new connections public void pause running paused paused true unlock accept heuristic sleep while ensure pause endpoint try thread sleep 1000 catch interrupted exception ignore resume endpoint which make start accepting new connections again public void resume running paused false public abstract void stop throws exception	paused pause	during shutdown executor may null avoid npe running get executor execute new socket options processor socket	paused pause	during shutdown executor may null avoid npe running get executor execute new socket processor wrapper	paused pause fix bug 49802 bug re factor connector pause stop destroy methods so calling any those methods has expected results markt fix
private list element value pair element value pairs	annotation entry element value pairs new array list element value pair	return element value pairs array new element value pair element value pairs size	element value pair envp element value pairs get	private static final map string attribute reader readers new hash map string attribute reader	attribute reader readers get name	implements cloneable comparable java class	list annotation entry accumulated annotations new array list annotation entry	annotations accumulated annotations array new annotation entry accumulated annotations size	public int compare java class obj return get class name compare obj get class name	private static final map string unknown unknown attributes new hash map string unknown	private static int unwrap thread local integer tl return tl get int value private static void wrap thread local integer tl int value private static thread local integer consumed chars new thread local integer protected integer initial value fix bug 49876 bug fix generics warnings copied apache jakarta bcel code based patch gbor markt fix
construct new class loader defined repositories given param parent our parent class loader
name system property containing tomcat product installation path public static final string catalina home prop catalina home name system property containing tomcat instance installation path public static final string catalina base prop catalina base	system get property globals catalina base prop	string base system get property globals catalina base prop	new file system get property globals catalina base prop conf	config base new file system get property globals catalina base prop conf	file new file system get property globals catalina base prop host	deployed new file system get property globals catalina base prop config base new file system get property globals catalina base prop conf	file new file system get property globals catalina base prop	file new file system get property globals catalina base prop file get path	new file system get property globals catalina base prop conf	file new file system get property globals catalina base prop pathname	file new file system get property globals catalina base prop pathname	protected static final string catalina home token globals catalina home prop protected static final string catalina base token globals catalina base prop	system set property globals catalina home prop system set property globals catalina base prop	system get property globals catalina base prop null system get property globals catalina home prop null system set property globals catalina base prop system get property globals catalina home prop system set property globals catalina base prop	system get property globals catalina home prop null globals catalina home prop system set property globals catalina home prop system set property globals catalina home prop	return system get property globals catalina home prop	return system get property globals catalina base prop get catalina home	file new file system get property globals catalina base prop config file	string catalina home system get property globals catalina home prop else system get property globals catalina base prop null catalina home system get property globals catalina base prop globals catalina home prop globals catalina base prop catalina jar tomcat install globals catalina home prop tomcat jar	system set property globals catalina home prop catalina home system get property globals catalina base prop null system set property globals catalina base prop string catalina base system get property globals catalina base prop	system set property globals catalina base prop catalina base	class loader cl catalina properties class get class loader system err println catalina proprties cl cl string cl cl get parent null system err println catalina proprties parent cl cl string	return system get property globals catalina home prop	return system get property globals catalina base prop get catalina home	public void set catalina home string system set property globals catalina home prop public void set catalina base string system set property globals catalina base prop return system get property globals catalina home prop return system get property globals catalina base prop	string catalina home system get property globals catalina home prop else system get property globals catalina base prop null catalina home system get property globals catalina base prop globals catalina home prop globals catalina base prop catalina jar tomcat install globals catalina home prop tomcat jar	system set property globals catalina home prop catalina home system get property globals catalina base prop null system set property globals catalina base prop string catalina base system get property globals catalina base prop	system set property globals catalina base prop catalina base	app base new file system get property globals catalina base prop	app base new file system get property globals catalina base prop	file base new file system get property globals catalina base prop	basedir system get property globals catalina base prop basedir system get property globals catalina home prop	system set property globals catalina home prop basedir system set property globals catalina base prop basedir	private static string catalina home system get property globals catalina home prop	log error must set globals catalina home prop system property	file new file system get property globals catalina base prop	file new file system get property globals catalina base prop	new file system get property globals catalina base prop pathname new	new file system get property globals catalina base prop pathname old new file system get property globals catalina base prop pathname	dir new file system get property globals catalina base prop directory	system get property globals catalina home prop null project set basedir system get property globals catalina home prop	string file adjust relative path system get property globals catalina base prop	string file adjust relative path system get property globals catalina base prop	key store file new file system get property globals catalina base prop	crl file new file system get property globals catalina base prop crlf update bug 48967 bug replace strings catalina base catalina home globally defined constants patch provided marc guillemot rjung update
configure http only sso cookie using same rules session cookies request get servlet context get session cookie config http only request get context get use http only cookie set http only true bug 49749 bug single sign cookies should have http only flag set using same rules session cookies markt fix fix bug 49750 bug align code webapp class loader validate code
logger protected static org apache juli logging log log org apache juli logging log factory get log abstract output buffer class	go through filters gzip filter invoke flush int last active filter active filters instanceof gzip output filter log debug enabled log debug flushing gzip filter position filter chain gzip output filter active filters flush break	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license extension link gzipoutput stream workaround couple long standing jdk bugs href http bugs sun com bugdatabase view bug do bug id 4255743 bug 4255743 href http bugs sun com bugdatabase view bug do bug id 4813885 bug 4813885 so gzip output can flushed public flushable gzipoutput stream output stream os throws ioexception super os private static final byte new byte private boolean has data false here we make sure we have received data so header has been sure written output stream already override public synchronized void write byte bytes int int i1 throws ioexception super write bytes i1 has data true override public synchronized void write int throws ioexception super write has data true override public synchronized void write byte bytes throws ioexception super write bytes has data true override public synchronized void flush throws ioexception has data return do allow gzip header flushed its own trick deflater flush now tricky we force deflater flush its data switching compression level yet perplexingly simple workaround http developer java sun com developer bug parade bugs 4255743 html def finished def set input def set level deflater compression deflate def set level deflater default compression deflate out flush has data false more data flush keep calling deflate until runs dry default only does once can therefore hold onto data when need flushed out override protected void deflate throws ioexception int len do len def deflate buf buf length len out write buf len while len	logger protected static org apache juli logging log log org apache juli logging log factory get log gzip output filter class	compression stream new flushable gzipoutput stream fake output stream	added allow flushing happen gzip ed outputstream public void flush compression stream null try log debug enabled log debug flushing compression stream compression stream flush catch ioexception log debug enabled log debug ignored exception while flushing gzip filter	compression stream new flushable gzipoutput stream fake output stream	test case demonstrate interaction between gzip flushing output filter test interaction betwen gzip flushing idea create internal output buffer response attach active output buffer set output stream internal buffer byte array output stream so we can inspect output bytes write chunk out using invoke flush internal output buffer read from byte array output stream find out what being written out flushed find out what expected wrting gzipoutput stream close force flushing compare size two arrays should close instead one being much shorter than other one throws exception public void test flushing gzip throws exception set up response internal output buffer byte array output stream response res new response internal output buffer iob new internal output buffer res byte array output stream bos new byte array output stream iob set output stream bos res set output buffer iob set up gzip output filter attach internal output buffer gzip output filter gf new gzip output filter iob add filter gf iob add active filter gf write chunk out byte chunk chunk new byte chunk 1024 byte hello tomcat developers bug jdk get bytes chunk append length iob do write chunk res flush internal output buffer iob flush read from byte array output stream find out what being written out flushed byte data found bos byte array find out what expected wrting gzipoutput stream close force flushing byte array output stream gbos new byte array output stream 1024 gzipoutput stream gos new gzipoutput stream gbos gos write gos close read expected data byte data expected gbos byte array most data should have been flushed out assert true data found length data expected length 20 bug 48738 bug workaround couple long standing jdk bugs enable gzip compressed output streams flushed based patch provided jiong wang markt fix fix
valve valves parent get pipeline get valves bug 49670 bug restore sso broken lifecycle refactoring markt fix fix
spec does define order use ordered jars followed remaining jars set web xml resource jars new linked hash set web xml web xml fragment ordered fragments resource jars add fragment web xml fragment fragments values resource jars contains fragment resource jars add fragment process resource jars resource jars
default content type processing deferred until after page has been parsed	leave until now since can only set once bug 49726 page info get content type null jsp property get default content type null page info set content type jsp property get default content type	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test bug49726a throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk map string list string headers new hash map string list string get url http localhost get port test bug49726a jsp res headers check request completed string result res string assert echo result ok check content type assert true headers get content type get starts text html public void test bug49726b throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk map string list string headers new hash map string list string get url http localhost get port test bug49726b jsp res headers check request completed string result res string assert echo result ok check content type assert true headers get content type get starts text plain assertion text printed tags echo private static void assert echo string result string expected assert true result index expected jsp config jsp property group default content type text plain default content type url pattern bug49726a jsp url pattern url pattern bug49726b jsp url pattern jsp property group jsp config licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license head title bug 49726 test case title head body ok body licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license head title bug 49726 test case title head body ok body subsection name jasper changelog fix bug 49726 bug specifying default content type via jsp property group should prevent page from setting some other content type markt fix changelog subsection
name starts javax servlet return false bug 47950 bug align code webapp class loader validate code javadoc ensure code javax servlet code classes can loaded code webapp class loader code instance patch provided pid markt fix fix
suppress warnings rawtypes can use class because api needs match	suppress warnings rawtypes can use class because api needs match	public suppress warnings rawtypes class get property type	public object get context suppress warnings rawtypes class key	public void put context suppress warnings rawtypes class key	public suppress warnings unchecked rawtypes iterator get feature descriptors	public boolean wrapper suppress warnings rawtypes class wrapped type	public boolean wrapper suppress warnings rawtypes class wrapped type	suppress warnings rawtypes tck signature fails generics	suppress warnings rawtypes tck signature fails generics	suppress warnings unchecked rawtypes tck signature test fails generics	suppress warnings rawtypes	suppress warnings rawtypes can use class because api needs match suppress warnings rawtypes can use class because api needs match	public object get context suppress warnings rawtypes class key	public void put context suppress warnings rawtypes class key	suppress warnings rawtypes class param types	suppress warnings rawtypes class param types	suppress warnings rawtypes can use class because api needs match super class	suppress warnings rawtypes can use class because api needs match super class	suppress warnings rawtypes api does use generics	suppress warnings rawtypes api does use generics	suppress warnings rawtypes overridden method uses raw type class fix bug 49758 bug fix generics warnings exposed fix eclipse patch provided sebb markt fix
private static final long serial version uid 1l instance variables public methods	class value get class	override	override	override	override	override override	override	public static class map entry implements map entry object object	override override override fix bug 49757 bug correct some generics warnings based patch provided gbor markt fix
impact annotations set true fix bug 49714 bug annotation process jar doesn influence element web xml kfujino fix
also tested implicitly numerous places elsewhere class public void test bug49655 throws exception call failed method expression me factory create method expression context bean set name new value null null rest check worked correctly me invoke context null value expression ve factory create value expression context bean name java lang string class assert equals new value ve get value context
int size get active sessions	get active sessions max active sessions	entry null entry active value equals entry get value return true	entry null entry active	entry null entry active set add key	entry null entry active entry get value null counter	entry null entry active entry get value null values add entry get value	return proxy backup public boolean active return proxy bug 49407 bug change backup manager so consistent delta manager reports both primary backup sessions when active sessions requested markt fix fix
flag indicates ssl attributes have been parsed improve performance applications usually frameworks make multiple calls link request get attribute names protected boolean ssl attributes parsed false	ssl attributes parsed false	ssl attributes parsed true	secure ssl attributes parsed fix bug 49613 bug improve performance when using ssl applications make multiple class code request get attribute names code patch provided sampo savolainen markt fix
status socket status error status socket status disconnect	started started dispatching dispatched completing timing out error dispatching	state get async state started todo servlet3 async set context class loader when running task final servlet context sctx get servlet request get servlet context todo use container thread without creating memory leak execute runnable using container thread from connector thread pool request get connector get protocol handler get executor execute run thread new thread run start	state get async state dispatching	listener invoked listener should have called complete state get async state started http servlet response servlet response set status 500 do internal complete true else listeners container calls complete do internal complete false	recycle	byte chunk bc get url http localhost get port assert equals ok bc string assert equals servlet get result public void test bug49567 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir servlet new wrapper wrapper tomcat add servlet ctx servlet servlet wrapper set async supported true ctx add servlet mapping servlet tomcat start call servlet once byte chunk bc get url http localhost get port assert equals ok bc string public void test async start complete throws exception setup tomcat instance tomcat tomcat get tomcat instance minimise pauses during test tomcat get connector set attribute connection timeout integer value 3000 must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async start complete servlet servlet new async start complete servlet wrapper wrapper tomcat add servlet ctx servlet servlet wrapper set async supported true ctx add servlet mapping servlet tomcat start call servlet first time byte chunk bc1 get url http localhost get port echo run1 assert equals ok run1 bc1 string call servlet second time request parameter byte chunk bc2 get url http localhost get port echo run2 assert equals ok run2 bc2 string public void test async start complete throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async start complete servlet servlet new async start complete servlet wrapper wrapper tomcat add servlet ctx servlet servlet wrapper set async supported true ctx add servlet mapping servlet tomcat start call servlet once byte chunk bc get url http localhost get port assert equals ok bc string	resp set content type text plain resp get writer print ok result append catch ioexception result append	private static class extends http servlet private static final long serial version uid 1l private string builder result new string builder public string get result return result string override protected void do get final http servlet request req final http servlet response resp throws servlet exception ioexception result append result append req async started req start async result append result append req async started req get async context start new runnable override public void run thread new thread new runnable override public void run try result append result append req async started thread sleep 1000 result append result append req async started resp set content type text plain resp get writer print ok req get async context complete result append result append req async started catch interrupted exception result append catch ioexception result append start pointless method call so somewhere put break point when debugging req get method private static class async start complete servlet extends http servlet private static final long serial version uid 1l override protected void do get final http servlet request req final http servlet response resp throws servlet exception ioexception string echo req get parameter echo async context actxt req start async resp set content type text plain resp get writer print ok echo null resp get writer print echo speed up test reducing timeout actxt set timeout 1000 private static class async start complete servlet extends http servlet private static final long serial version uid 1l override protected void do get final http servlet request req final http servlet response resp throws servlet exception ioexception async context actxt req start async resp set content type text plain resp get writer print ok actxt complete bug 49528 bug bug 49567 bug ensure code async context async started code returns correct value after code async context start code code async context complete code called separate thread handled correctly markt
h2 parameters h2	li tt content type tt response matches one types	bug 48998 bug bug 49617 bug add expires filter port httpd mod expires module patch provided cyrille le clerc markt li tt content type tt response matches one types overrides specified mime type only any sample log message expiration date expiration date copyright 2008 2009 original author authors licensed under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license expires filter java servlet api port href http httpd apache org docs mod mod expires html apache mod expires add tt expires tt tt cache control max age tt headers http response according its tt content type tt following inspired tt mod expires tt h1 summary h1 filter controls setting tt expires tt http header tt max age tt directive tt cache control tt http header server responses expiration date can set relative either time source file last modified time client access http headers instruction client about document x27 validity persistence cached document may fetched from cache rather than from source until time has passed after cache copy considered quot expired quot invalid new copy must obtained from source modify tt cache control tt directives other than tt max age tt see href http www w3 org protocols rfc2616 rfc2616 sec14 html sec14 rfc 2616 section 14 you can use other servlet filters href http httpd apache org docs mod mod headers html apache httpd mod headers module h1 filter h1 h2 basic add x27 tt expires tt x27 x27 tt cache control max age tt x27 headers images css javascript h2 code pre lt web app gt lt filter gt lt filter name gt expires filter lt filter name gt lt filter class gt org apache catalina filters expires filter lt filter class gt lt init param gt lt param name gt expires type image lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text css lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text javascript lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt filter gt lt filter mapping gt lt filter name gt expires filter lt filter name gt lt url pattern gt lt url pattern gt lt dispatcher gt request lt dispatcher gt lt filter mapping gt lt web app gt pre code h2 parameters h2 h3 tt expires active tt h3 directive enables disables generation tt expires tt tt cache control tt headers tt expires filter tt set tt off tt headers generated any http response set tt tt tt true tt headers added served http responses according criteria defined tt expires type lt content type gt tt tt expires default tt directives note directive does guarantee tt expires tt tt cache control tt header generated criteria aren x27 met header sent effect though directive wasn x27 even specified parameter optional default value tt true tt enable filter code pre lt init param gt lt supports case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt lt param value gt lt init param gt pre code disable filter code pre lt init param gt lt supports anything different from case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt off lt param value gt lt init param gt pre code h3 tt expires type lt content type gt tt h3 directive defines value tt expires tt header tt max age tt directive tt cache control tt header generated documents specified type tt text html tt second argument sets number seconds added base time construct expiration date tt cache control max age tt calculated subtracting request time from expiration date expressing result seconds base time either last modification time file time client x27 access document which should used specified tt lt code gt tt field tt tt means file x27 last modification time should used base time tt tt means client x27 access time should used duration expressed seconds tt a2592000 tt stands tt access plus 30 days tt alternate syntax difference effect subtle tt tt tt modification tt alternate syntax used all current copies document all caches expire same time which can good something like weekly notice x27 always found same url tt tt tt access tt tt now tt alternate syntax used date expiration different each client can good image files don x27 change very often particularly set related documents all refer same images images accessed repeatedly within relatively short timespan strong example strong code pre lt init param gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt init param gt lt init param gt lt 2592000 seconds 30 days gt lt param name gt expires type image gif lt param name gt lt param value gt a2592000 lt param value gt lt init param gt pre code note directive only has effect tt expires active tt has been specified overrides specified mime type only any expiration date set tt expires default tt directive you can also specify expiration time calculation using alternate syntax described earlier document h3 tt expires excluded response status codes tt h3 directive defines http response status codes which tt expires filter tt generate expiration headers default tt 304 tt status code quot tt modified tt quot skipped value comma separated list http status codes directive useful ease usage tt expires default tt directive indeed behavior tt 304 modified tt which does specify tt content type tt header combined tt expires tt tt cache control max age tt headers can tricky understand sample code pre lt init param gt lt param name gt expires excluded response status codes lt param name gt lt param value gt 302 500 503 lt param value gt lt init param gt pre code h3 expires default h3 directive sets default algorithm calculating expiration time all documents affected realm can overridden type type basis tt expires type tt directive see description directive details about syntax argument alternate syntax description well h1 alternate syntax h1 tt expires default tt tt expires type tt directives can also defined more readable syntax form code pre lt init param gt lt param name gt expires default lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt init param gt lt init param gt lt param name gt expires type type encoding lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt init param gt pre code where tt lt base gt tt one ul li tt access tt li li tt now tt equivalent x27 tt access tt x27 li li tt modification tt li ul tt plus tt keyword optional tt lt num gt tt should integer value acceptable tt integer parse int tt tt lt type gt tt one ul li tt years tt li li tt months tt li li tt weeks tt li li tt days tt li li tt hours tt li li tt minutes tt li li tt seconds tt li ul example any following directives can used make documents expire month after being accessed default code pre lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus month lt param value gt lt init param gt lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus weeks lt param value gt lt init param gt lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus 30 days lt param value gt lt init param gt pre code expiry time can fine tuned adding several x27 tt lt num gt lt type gt tt x27 clauses code pre lt init param gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt init param gt lt init param gt lt param name gt expires type image gif lt param name gt lt param value gt modification plus hours minutes lt param value gt lt init param gt pre code note you use modification date based setting tt expires tt header strong strong added content does come from file disk due fact modification time content h1 expiration headers generation eligibility h1 response eligible enriched tt expires filter tt ol li expiration header defined tt expires tt header tt max age tt directive tt cache control tt header li li response status code excluded directive tt expires excluded response status codes tt li li tt content type tt response matches one types defined tt expires type tt directives tt expires default tt directive defined li ol note ul li tt cache control tt header contains other directives than tt max age tt concatenated tt max age tt directive added tt expires filter tt li ul h1 expiration selection h1 expiration elected according following algorithm ol li tt expires type tt matching exact content type returned tt http servlet response get content type tt possibly including charset x27 tt text xml charset utf tt x27 li li tt expires type tt matching content type without charset tt http servlet response get content type tt contains charset x27 tt text xml charset utf tt x27 gt x27 tt text xml tt x27 li li tt expires type tt matching major type substring before x27 tt tt x27 tt http servlet response get content type tt x27 tt text xml charset utf tt x27 gt x27 tt text tt x27 li li tt expires default tt li ol h1 details h1 h2 when write expiration headers h2 tt expires filter tt traps x27 before write response body x27 event decide whether should generate expiration headers trap x27 before write response body x27 event tt expires filter tt wraps http servlet response x27 writer output stream intercept calls methods tt write tt tt print tt tt close tt tt flush tt empty response body empty files tt write tt tt print tt tt close tt tt flush tt methods called handle case tt expires filter tt end its tt do filter tt method manually triggers tt before write response body tt method h2 syntax h2 tt expires filter tt supports same syntax apache httpd mod expires challenge has been choose name tt lt param name gt tt associated tt expires type tt tt lt filter gt tt declaration indeed several tt expires type tt directives can declared when tt web xml tt syntax does allow declare several tt lt init param gt tt same name workaround has been declare content type tt lt param name gt tt rather than tt lt param value gt tt h2 designed extension open close principle h2 tt expires filter tt has been designed extension following open close principle key methods override extension ul li link eligible expiration header generation http servlet request xhttp servlet response li li link get expiration date http servlet request xhttp servlet response li ul h1 h1 troubleshoot enable logging tt org apache catalina filters expires filter tt extract logging properties code pre org apache catalina filters expires filter level fine pre code sample log message code pre mar 26 2010 01 41 pm org apache catalina filters expires filter init fine filter initialized expires filter active true excluded response status code 304 default null type image expires starting point access time duration 10 minute text css expires starting point access time duration 10 minute text javascript expires starting point access time duration 10 minute pre code sample per request log message where tt expires filter tt adds expiration date code pre mar 26 2010 09 47 pm org apache catalina filters expires filter before write response body fine request tomcat gif response status 200 content type image gif set expiration date 26 10 19 pm pre code sample per request log message where tt expires filter tt does add expiration date code pre mar 26 2010 10 27 pm org apache catalina filters expires filter before write response body fine request docs config manager html response status 200 content type text html expiration configured pre code duration composed link amount link unit protected static class duration public static duration minutes int amount return new duration amount duration unit minute public static duration seconds int amount return new duration amount duration unit second final protected int amount final protected duration unit unit public duration int amount duration unit unit super amount amount unit unit public int get amount return amount public duration unit get unit return unit override public string string return amount unit duration unit protected enum duration unit day calendar day year hour calendar hour minute calendar minute month calendar month second calendar second week calendar week year year calendar year private final int calendard field private duration unit int calendard field calendard field calendard field public int get calendard field return calendard field main piece filter can expressed like tt access plus month 15 days hours tt protected static class expires list duration elements private list duration durations starting point elaspse set response private starting point starting point public expires starting point starting point duration durations starting point arrays list durations public expires starting point starting point list duration durations super starting point starting point durations durations public list duration get durations return durations public starting point get starting point return starting point override public string string return expires starting point starting point duration durations expiration starting point either time html page servlet response served link starting point access time last time html page servlet response modified link starting point last modification time protected enum starting point access time last modification time wrapping extension link http servlet response yrap start write response body event performance optimization extended response holds link last modified header link cache control header values access slow link get header string spare tt string tt tt date tt tt long tt conversion public class xhttp servlet response extends http servlet response wrapper value tt cache control tt http response header has been set private string cache control header value tt last modified tt http response header has been set private long last modified header private boolean last modified header set private print writer print writer private http servlet request request private servlet output stream servlet output stream indicates whether calls write methods tt write tt tt print tt etc response body have been called private boolean write response body started public xhttp servlet response http servlet request request http servlet response response super response request request override public void add date header string name long date super add date header name date last modified header set last modified header date last modified header set true override public void add header string name string value super add header name value header cache control equals ignore case name cache control header null cache control header value public string get cache control header return cache control header public long get last modified header return last modified header override public servlet output stream get output stream throws ioexception servlet output stream null servlet output stream new xservlet output stream super get output stream request return servlet output stream override public print writer get writer throws ioexception print writer null print writer new xprint writer super get writer request return print writer public boolean last modified header set return last modified header set public boolean write response body started return write response body started override public void reset super reset last modified header last modified header set false cache control header null override public void set date header string name long date super set date header name date header last modified equals ignore case name last modified header date last modified header set true override public void set header string name string value super set header name value header cache control equals ignore case name cache control header value public void set write response body started boolean write response body started write response body started write response body started wrapping extension link print writer trap start write response body event public class xprint writer extends print writer private print writer out private http servlet request request private xhttp servlet response response public xprint writer print writer out http servlet request request xhttp servlet response response super out out out request request response response override public print writer append char fire before write response body event return out append override public print writer append char sequence csq fire before write response body event return out append csq override public print writer append char sequence csq int start int end fire before write response body event return out append csq start end override public void close fire before write response body event out close private void fire before write response body event response write response body started response set write response body started true before write response body request response override public void flush fire before write response body event out flush override public void print boolean fire before write response body event out print override public void print char fire before write response body event out print override public void print char fire before write response body event out print override public void print double fire before write response body event out print override public void print float fire before write response body event out print override public void print int fire before write response body event out print override public void print long fire before write response body event out print override public void print object obj fire before write response body event out print obj override public void print string fire before write response body event out print override public print writer printf locale string format object args fire before write response body event return out printf format args override public print writer printf string format object args fire before write response body event return out printf format args override public void println fire before write response body event out println override public void println boolean fire before write response body event out println override public void println char fire before write response body event out println override public void println char fire before write response body event out println override public void println double fire before write response body event out println override public void println float fire before write response body event out println override public void println int fire before write response body event out println override public void println long fire before write response body event out println override public void println object fire before write response body event out println override public void println string fire before write response body event out println override public void write char buf fire before write response body event out write buf override public void write char buf int off int len fire before write response body event out write buf off len override public void write int fire before write response body event out write override public void write string fire before write response body event out write override public void write string int off int len fire before write response body event out write off len wrapping extension link servlet output stream trap start write response body event public class xservlet output stream extends servlet output stream private http servlet request request private xhttp servlet response response private servlet output stream servlet output stream public xservlet output stream servlet output stream servlet output stream http servlet request request xhttp servlet response response super servlet output stream servlet output stream response response request request override public void close throws ioexception fire before write response body event servlet output stream close private void fire before write response body event response write response body started response set write response body started true before write response body request response override public void flush throws ioexception fire before write response body event servlet output stream flush override public void print boolean throws ioexception fire before write response body event servlet output stream print override public void print char throws ioexception fire before write response body event servlet output stream print override public void print double throws ioexception fire before write response body event servlet output stream print override public void print float throws ioexception fire before write response body event servlet output stream print override public void print int throws ioexception fire before write response body event servlet output stream print override public void print long throws ioexception fire before write response body event servlet output stream print override public void print string throws ioexception fire before write response body event servlet output stream print override public void println throws ioexception fire before write response body event servlet output stream println override public void println boolean throws ioexception fire before write response body event servlet output stream println override public void println char throws ioexception fire before write response body event servlet output stream println override public void println double throws ioexception fire before write response body event servlet output stream println override public void println float throws ioexception fire before write response body event servlet output stream println override public void println int throws ioexception fire before write response body event servlet output stream println override public void println long throws ioexception fire before write response body event servlet output stream println override public void println string throws ioexception fire before write response body event servlet output stream println override public void write byte throws ioexception fire before write response body event servlet output stream write override public void write byte int off int len throws ioexception fire before write response body event servlet output stream write off len override public void write int throws ioexception fire before write response body event servlet output stream write link pattern comma delimited string support whitespace characters private static final pattern comma separated values pattern pattern compile private static final string header cache control cache control private static final string header expires expires private static final string header last modified last modified private static final log log log factory get log expires filter class private static final string parameter expires active expires active private static final string parameter expires type expires type private static final string parameter expires default expires default private static final string parameter expires excluded response status codes expires excluded response status codes convert comma delimited list numbers tt int tt param comma delimited ints can code null code return never code null code array protected static int comma delimited list int array string comma delimited ints string ints strings comma delimited list string array comma delimited ints int ints new int ints strings length int ints strings length string int string ints strings try ints integer parse int int string catch number format exception throw new runtime exception exception parsing number zero based comma delimited list comma delimited ints return ints convert given comma delimited list strings array string return array patterns non code null code protected static string comma delimited list string array string comma delimited strings return comma delimited strings null comma delimited strings length new string comma separated values pattern split comma delimited strings return code true code given code str code contains given code search str code protected static boolean contains string str string search str str null search str null return false return str index search str convert array ints comma delimited string protected static string ints comma delimited string int ints ints null return string builder result new string builder int ints length result append ints ints length result append return result string return code true code given code str code code null code has zero characters length protected static boolean empty string str return str null str length return code true code given code str code has least one character can withespace protected static boolean empty string str return empty str return code true code given code string code starts given code prefix code ignoring case param string can code null code param prefix can code null code protected static boolean starts ignore case string string string prefix string null prefix null return string null prefix null prefix length string length return false return string region matches true prefix prefix length return subset given code str code before first occurence given code separator code return code null code given code str code given code separator code null return empty string code separator code empty param str can code null code param separator can code null code return protected static string substring before string str string separator str null str empty separator null return null separator empty return int separator index str index separator separator index return str return str substring separator index see active private boolean active true default expires private expires default expires list response status code which link expires filter generate expiration headers private int excluded response status codes new int http servlet response sc modified expires content type visible test private map string expires expires content type new linked hash map string expires public void do filter servlet request request servlet response response filter chain chain throws ioexception servlet exception request instanceof http servlet request response instanceof http servlet response http servlet request http request http servlet request request http servlet response http response http servlet response response response committed log debug enabled log debug sm get string expires filter response already commited http request get request url chain do filter request response else active xhttp servlet response response new xhttp servlet response http request http response chain do filter request response response write response body started empty response manually trigger before write response body before write response body http request response else log debug enabled log debug sm get string expires filter filter active http request get request url chain do filter request response else chain do filter request response public expires get default expires return default expires public string get excluded response status codes return ints comma delimited string excluded response status codes public int get excluded response status codes ints return excluded response status codes returns expiration date given link xhttp servlet response code null code expiration date has been configured declared content type code protected code extension see http servlet response get content type protected date get expiration date xhttp servlet response response string content type response get content type lookup exact content type match text html charset iso 8859 expires expires content type get content type null date result get expiration date response log error enabled log error sm get string expires filter use matching content type content type result return result contains content type lookup content type without charset match text html string content type without charset substring before content type trim expires content type get content type without charset null date result get expiration date response log error enabled log error sm get string expires filter use matching content type without charset content type result return result contains content type lookup major type match text string major type substring before content type expires content type get major type null date result get expiration date response log error enabled log error sm get string expires filter use matching major type content type result return result default expires null date result get expiration date default expires response log error enabled log error sm get string expires filter use default default expires content type result return result log error enabled log error sm get string expires filter expiration configured content type content type return null returns expiration date given link expires link http servlet request link xhttp servlet response code protected code extension protected date get expiration date expires xhttp servlet response response calendar calendar switch get starting point case access time calendar calendar get instance break case last modification time response last modified header set try long last modified response get last modified header calendar calendar get instance calendar set time millis last modified catch number format exception default now calendar calendar get instance else last modified header found use now calendar calendar get instance break default throw new illegal state exception sm get string expires filter unsupported starting point get starting point duration duration get durations calendar add duration get unit get calendard field duration get amount return calendar get time public map string expires get expires content type return expires content type override protected log get logger return log override public void init filter config filter config throws servlet exception enumeration string names filter config get init parameter names names has more elements string name names next element string value filter config get init parameter name try name starts parameter expires type string content type name substring parameter expires type length trim expires expires parse expires value expires content type put content type expires else name equals ignore case parameter expires default expires expires parse expires value default expires expires else name equals ignore case parameter expires active active equals ignore case value boolean value value boolean value else name equals ignore case parameter expires excluded response status codes excluded response status codes comma delimited list int array value else log warn sm get string expires filter unknown parameter ignored name value catch runtime exception throw new servlet exception sm get string expires filter exception processing parameter name value log debug sm get string expires filter filter initialized string indicates filter active code false code filter pass through default code true code public boolean active return active code protected code extension protected boolean eligible expiration header generation http servlet request request xhttp servlet response response boolean expiration header has been set response contains header header expires contains response get cache control header max age expiration header has been set log debug enabled log debug sm get string expires filter expiration header already defined request get request uri integer value response get status response get content type return false int skipped status code excluded response status codes response get status skipped status code log debug enabled log debug sm get string expires filter skipped status code request get request uri integer value response get status response get content type return false return true expiration header has been set servlet expiration has been defined link expires filter sets tt expires tt header attribute tt max age tt tt cache control tt header must called start write response body event invocations tt logger debug tt guarded link logger debug enabled because link http servlet request get request uri link http servlet response get content type costs tt string tt objects tomcat public void before write response body http servlet request request xhttp servlet response response eligible expiration header generation request response return date expiration date get expiration date response expiration date null log debug enabled log debug sm get string expires filter expiration configured request get request uri integer value response get status response get content type else log debug enabled log debug sm get string expires filter set expiration date request get request uri integer value response get status response get content type expiration date string max age directive max age expiration date get time system current time millis 1000 string cache control header response get cache control header string new cache control header cache control header null max age directive cache control header max age directive response set header header cache control new cache control header response set date header header expires expiration date get time parse lines like tt access plus month 15 days hours tt tt modification day hours seconds tt param input line protected expires parse expires string input line string line input line trim string tokenizer tokenizer new string tokenizer line string current token try current token tokenizer next token catch element exception throw new illegal state exception sm get string expires filter starting point found line starting point starting point access equals ignore case current token now equals ignore case current token starting point starting point access time else modification equals ignore case current token starting point starting point last modification time else tokenizer has more tokens starts ignore case current token starting point starting point access time trick convert duration from old new style tokenizer new string tokenizer current token substring seconds else tokenizer has more tokens starts ignore case current token starting point starting point last modification time trick convert duration from old new style tokenizer new string tokenizer current token substring seconds else throw new illegal state exception sm get string expires filter starting point invalid current token line try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration found directive line plus equals ignore case current token skip try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration found directive line list duration durations new array list duration while current token null int amount try amount integer parse int current token catch number format exception throw new illegal state exception sm get string invalid duration number directive current token line try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration unit found after amount directive integer value amount line duration unit duration unit years equals ignore case current token duration unit duration unit year else month equals ignore case current token months equals ignore case current token duration unit duration unit month else week equals ignore case current token weeks equals ignore case current token duration unit duration unit week else day equals ignore case current token days equals ignore case current token duration unit duration unit day else hour equals ignore case current token hours equals ignore case current token duration unit duration unit hour else minute equals ignore case current token minutes equals ignore case current token duration unit duration unit minute else second equals ignore case current token seconds equals ignore case current token duration unit duration unit second else throw new illegal state exception sm get string invalid duration unit years months weeks days hours minutes seconds directive current token line duration duration new duration amount duration unit durations add duration tokenizer has more tokens current token tokenizer next token else current token null return new expires starting point durations public void set active boolean active active active public void set default expires expires default expires default expires default expires public void set excluded response status codes int excluded response status codes excluded response status codes excluded response status codes public void set expires content type map string expires expires content type expires content type expires content type override public string string return get class get simple name active active excluded response status code ints comma delimited string excluded response status codes default default expires type expires content type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final string temp dir system get property java io tmpdir public void test throws exception tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def add init parameter expires default access plus month filter def add init parameter expires type text html access plus month 15 days hours filter def add init parameter expires type image gif modification plus hours minutes filter def add init parameter expires type image jpg a10000 filter def add init parameter expires type video mpeg m20000 filter def add init parameter expires active off filter def add init parameter expires excluded response status codes 304 503 expires filter expires filter new expires filter filter def set filter expires filter filter def set filter class expires filter class get name filter def set filter name expires filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name expires filter class get name filter map add urlpattern tomcat start try assert assert equals false expires filter active verify excluded response status codes int excluded response status codes expires filter get excluded response status codes ints assert assert equals excluded response status codes length assert assert equals 304 excluded response status codes assert assert equals 503 excluded response status codes verify default expires expires expires filter get default expires assert assert equals starting point access time expires get starting point assert assert equals expires get durations size assert assert equals duration unit month expires get durations get get unit assert assert equals expires get durations get get amount verify text html expires expires expires filter get expires content type get text html assert assert equals starting point access time expires get starting point assert assert equals expires get durations size duration one month expires get durations get assert assert equals duration unit month one month get unit assert assert equals one month get amount duration fifteen days expires get durations get assert assert equals duration unit day fifteen days get unit assert assert equals 15 fifteen days get amount duration two hours expires get durations get assert assert equals duration unit hour two hours get unit assert assert equals two hours get amount verify image gif expires expires expires filter get expires content type get image gif assert assert equals starting point last modification time expires get starting point assert assert equals expires get durations size duration five hours expires get durations get assert assert equals duration unit hour five hours get unit assert assert equals five hours get amount duration three minutes expires get durations get assert assert equals duration unit minute three minutes get unit assert assert equals three minutes get amount verify image jpg expires expires expires filter get expires content type get image jpg assert assert equals starting point access time expires get starting point assert assert equals expires get durations size duration ten thousand seconds expires get durations get assert assert equals duration unit second ten thousand seconds get unit assert assert equals 10000 ten thousand seconds get amount verify video mpeg expires expires expires filter get expires content type get video mpeg assert assert equals starting point last modification time expires get starting point assert assert equals expires get durations size duration twenty thousand seconds expires get durations get assert assert equals duration unit second twenty thousand seconds get unit assert assert equals 20000 twenty thousand seconds get amount finally tomcat stop test resource empty content also processed public void test empty content throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text plain content written response validate servlet integer value 60 public void test parse expires combined duration expires filter expires filter new expires filter expires actual expires filter parse expires access plus month 15 days hours assert assert equals starting point access time actual get starting point assert assert equals actual get durations size public void test parse expires mono duration expires filter expires filter new expires filter expires actual expires filter parse expires access plus hours assert assert equals starting point access time actual get starting point assert assert equals actual get durations size assert assert equals actual get durations get get amount assert assert equals duration unit hour actual get durations get get unit public void test skip because cache control max age defined throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response add header cache control private max age 232 response get writer print hello world validate servlet integer value 232 public void test excluded response status code throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set status http servlet response sc modified response add header etag 1934 response add date header date system current time millis validate servlet null http servlet response sc modified public void test null content type throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type null validate servlet integer value 60 public void test skip because expires defined throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response add date header expires system current time millis response get writer print hello world validate servlet null public void test use content type expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response get writer print hello world validate servlet integer value 60 public void test use content type without charset expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset iso 8859 response get writer print hello world validate servlet integer value 60 public void test use default throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type image jpeg response get writer print hello world validate servlet integer value 60 public void test use default throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type image jpeg response add header cache control private response get writer print hello world validate servlet integer value 60 public void test use major type expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text json charset iso 8859 response get writer print hello world validate servlet integer value 60 protected void validate http servlet servlet integer expected max age seconds throws exception validate servlet expected max age seconds http http ok protected void validate http servlet servlet integer expected max age seconds int expected response status code throws exception setup tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def add init parameter expires default access plus minute filter def add init parameter expires type text xml charset utf access plus minutes filter def add init parameter expires type text xml access plus minutes filter def add init parameter expires type text access plus minutes filter def add init parameter expires excluded response status codes 304 503 filter def set filter class expires filter class get name filter def set filter name expires filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name expires filter class get name filter map add urlpattern root add filter map filter map tomcat add servlet root servlet get class get name servlet root add servlet mapping test servlet get class get name tomcat start try calendar get instance time zone get time zone gmt long time before millis system current time millis test http http http new url http localhost tomcat get connector get port test open connection validate assert assert equals expected response status code http get response code string builder msg new string builder entry string list string field http get header fields entry set string value field get value msg append field get key null field get key value system out println msg integer actual max age seconds string cache control header http get header field cache control cache control header null actual max age seconds null else actual max age seconds null string tokenizer cache control tokenizer new string tokenizer cache control header while cache control tokenizer has more tokens actual max age seconds null string cache directive cache control tokenizer next token string tokenizer cache directive tokenizer new string tokenizer cache directive cache directive tokenizer count tokens string key cache directive tokenizer next token trim string value cache directive tokenizer next token trim key equals ignore case max age actual max age seconds integer value value expected max age seconds null assert assert null actual max age seconds actual max age seconds should null actual max age seconds return assert assert null actual max age seconds suppress warnings null int delta seconds math abs actual max age seconds int value expected max age seconds int value assert assert true actual max age seconds actual max age seconds expected max age seconds expected max age seconds request time time before millis content type http get content type delta seconds finally tomcat stop public void test ints comma delimited string string actual expires filter ints comma delimited string new int 500 503 string expected 500 503 assert assert equals expected actual add bug 48998 bug add expires filter port httpd mod expires module patch provided cyrille le clerc markt add subsection name introduction expires filter java servlet api port href http httpd apache org docs mod mod expires html apache mod expires filter controls setting tt expires tt http header tt max age tt directive tt cache control tt http header server responses expiration date can set relative either time source file last modified time client access http headers instruction client about document x27 validity persistence cached document may fetched from cache rather than from source until time has passed after cache copy considered quot expired quot invalid new copy must obtained from source modify tt cache control tt directives other than tt max age tt see href http www w3 org protocols rfc2616 rfc2616 sec14 html sec14 rfc 2616 section 14 you can use other servlet filters href http httpd apache org docs mod mod headers html apache httpd mod headers module subsection subsection name basic sample basic add tt expires tt tt cache control max age tt headers images css javascript source lt filter name gt expires filter lt filter name gt lt filter class gt org apache catalina filters expires filter lt filter class gt lt init param gt lt param name gt expires type image lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text css lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text javascript lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt filter name gt expires filter lt filter name gt lt url pattern gt lt url pattern gt lt dispatcher gt request lt dispatcher gt source subsection subsection name alternate syntax tt expires default tt tt expires type tt directives can also defined more readable syntax form source lt param name gt expires default lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt param name gt expires type type lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt param name gt expires type type encoding lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt source where tt lt base gt tt one ul li tt access tt li li tt now tt equivalent x27 tt access tt x27 li li tt modification tt li ul tt plus tt keyword optional tt lt num gt tt should integer value acceptable tt integer parse int tt tt lt type gt tt one ul li tt years tt li li tt months tt li li tt weeks tt li li tt days tt li li tt hours tt li li tt minutes tt li li tt seconds tt li ul example any following directives can used make documents expire month after being accessed default source lt param name gt expires default lt param name gt lt param value gt access plus month lt param value gt lt param name gt expires default lt param name gt lt param value gt access plus weeks lt param value gt lt param name gt expires default lt param name gt lt param value gt access plus 30 days lt param value gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt param name gt expires type image gif lt param name gt lt param value gt modification plus hours minutes lt param value gt source note you use modification date based setting tt expires tt header strong strong added content does come from file disk due fact modification time content subsection subsection name expiration headers generation eligibility response eligible enriched tt expires filter tt ol li expiration header defined tt expires tt header tt max age tt directive tt cache control tt header li li response status code excluded directive tt expires excluded response status codes tt li li tt content type tt response matches one types defined tt expires type tt directives tt expires default tt directive defined li ol note tt cache control tt header contains other directives than tt max age tt concatenated tt max age tt directive added tt expires filter tt subsection subsection name expiration selection expiration elected according following algorithm ol li tt expires type tt matching exact content type returned tt http servlet response get content type tt possibly including charset x27 tt text xml charset utf tt x27 li li tt expires type tt matching content type without charset tt http servlet response get content type tt contains charset x27 tt text xml charset utf tt x27 gt x27 tt text xml tt x27 li li tt expires type tt matching major type substring before x27 tt tt x27 tt http servlet response get content type tt x27 tt text xml charset utf tt x27 gt x27 tt text tt x27 li li tt expires default tt li ol subsection subsection name filter class name filter class name expires filter strong code org apache catalina filters expires filter code strong subsection subsection name parameters strong expires filter strong supports following parameters attributes attribute name expires active required false directive enables disables generation tt expires tt tt cache control tt headers tt expires filter tt set tt off tt headers generated any http response set tt tt tt true tt headers added served http responses according criteria defined tt expires type lt content type gt tt tt expires default tt directives note directive does guarantee tt expires tt tt cache control tt header generated criteria aren x27 met header sent effect though directive wasn x27 even specified default value tt true tt sample enable filter source lt supports case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt lt param value gt source sample disable filter source lt supports anything different from case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt off lt param value gt source attribute attribute name expires excluded response status codes required false directive defines http response status codes which tt expires filter tt generate expiration headers default tt 304 tt status code quot tt modified tt quot skipped value comma separated list http status codes directive useful ease usage tt expires default tt directive indeed behavior tt 304 modified tt which does specify tt content type tt header combined tt expires tt tt cache control max age tt headers can tricky understand sample exclude response status codes 302 500 503 source lt param name gt expires excluded response status codes lt param name gt lt param value gt 302 500 503 lt param value gt source attribute attribute name expires type lt content type gt required false directive defines value tt expires tt header tt max age tt directive tt cache control tt header generated documents specified type tt text html tt second argument sets number seconds added base time construct expiration date tt cache control max age tt calculated subtracting request time from expiration date expressing result seconds base time either last modification time file time client x27 access document which should used specified tt lt code gt tt field tt tt means file x27 last modification time should used base time tt tt means client x27 access time should used duration expressed seconds tt a2592000 tt stands tt access plus 30 days tt alternate syntax difference effect subtle tt tt tt modification tt alternate syntax used all current copies document all caches expire same time which can good something like weekly notice x27 always found same url tt tt tt access tt tt now tt alternate syntax used date expiration different each client can good image files don x27 change very often particularly set related documents all refer same images images accessed repeatedly within relatively short timespan strong note strong when content type includes charset tt expires type text xml charset utf tt tomcat removes blank chars between tt tt tt charset tt keyword due expiration charset must strong strong include space character sample source lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt 2592000 seconds 30 days gt lt param name gt expires type image gif lt param name gt lt param value gt a2592000 lt param value gt source note directive only has effect tt expires active tt has been specified overrides specified mime type only any expiration date set tt expires default tt directive you can also specify expiration time calculation using alternate syntax described earlier document attribute attribute name expires default required false directive sets default algorithm calculating expiration time all documents affected realm can overridden type type basis tt expires type tt directive see description directive details about syntax argument alternate syntax description well attribute attributes subsection subsection name troubleshoot enable logging tt org apache catalina filters expires filter tt extract logging properties source source sample log message source active true excluded response status code 304 default null type image expires starting point access time duration 10 minute text css expires starting point access time duration 10 minute text javascript expires starting point access time duration 10 minute source sample per request log message where tt expires filter tt adds expiration date source source sample per request log message where tt expires filter tt does add expiration date source source subsection
-1
catch interrupted exception sleep ignore bug 49127 bug don swallow exceptions code simple tcp replication manager start internal code markt fix fix
catch security exception bug 49128 bug don swallow exceptions code webapp class loader start code markt fix fix allow exec use exec command enabled false allow exec use exec command enabled false
allow exec boolean parse boolean config get init parameter allow exec	debug allow exec	protected final boolean allow exec public ssiprocessor ssiexternal resolver ssi external resolver int debug boolean allow exec allow exec allow exec	allow exec add command exec new ssiexec	allow exec normally blocked security protected boolean allow exec false	allow exec boolean parse boolean get servlet config get init parameter allow exec	debug allow exec add bug 48960 bug add new option ssi servlet ssi filter allow disabling code exec code command now disabled default based patch yair lenga markt add
private final resource bundle bundle private final locale locale	resource bundle bnd null bnd resource bundle get bundle bundle name locale get default	bnd resource bundle get bundle bundle bnd else locale null	private static final hashtable string string manager managers
text type iso 8859 another user defined character set rfc2616 explicitly states browsers must use iso 8859 character set defined media subtype text however browsers may attempt browsers have option enable br private static final log log log factory get log add default charset filter class private static final string default encoding iso 8859 private string encoding public void set encoding string encoding encoding encoding override protected log get logger return log override public void init filter config filter config throws servlet exception super init filter config encoding null encoding length encoding equals ignore case default encoding default encoding else encoding equals ignore case system encoding charset default charset name else charset supported encoding throw new illegal argument exception sm get string add default charset unsupported charset encoding	new response wrapper http servlet response response encoding wrapper adds character set text media types character set specified public static class response wrapper extends http servlet response wrapper private string encoding public response wrapper http servlet response response string encoding super response encoding encoding ct null ct starts text ct index charset super set content type ct charset encoding else super set content type ct encoding get character encoding override public void set character encoding string charset super set character encoding charset encoding charset licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test none specified mode1 throws exception do test null iso 8859 public void test none specified mode2 throws exception do test null iso 8859 public void test none specified mode3 throws exception do test null iso 8859 public void test default throws exception do test default iso 8859 public void test default mixed case throws exception do test ef au lt iso 8859 public void test system throws exception do test system charset default charset name public void test system mixed case throws exception do test sy st em charset default charset name public void test utf8 throws exception do test utf utf private void do test string encoding string expected throws exception do test encoding expected private void do test string encoding string expected int mode throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir add servlet charset servlet servlet new charset servlet mode tomcat add servlet ctx servlet servlet ctx add servlet mapping servlet add filter filter def filter def new filter def filter def set filter class add default charset filter class get name filter def set filter name filter encoding null filter def add init parameter encoding encoding ctx add filter def filter def filter map filter map new filter map filter map set filter name filter filter map add servlet name servlet ctx add filter map filter map tomcat start map string list string headers new hash map string list string get url http localhost get port new byte chunk headers list string ct headers headers get content type assert equals ct headers size string ct ct headers get assert equals text plain charset expected ct private static class charset servlet extends http servlet private static final long serial version uid 1l private static final string output ok private final int mode public charset servlet int mode mode mode override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception switch mode case resp set content type text plain break case resp set content type text plain charset iso 8859 break case resp set content type text plain resp set character encoding iso 8859 break default resp set content type text plain charset iso 8859 break resp get writer print output add bug 49478 bug add support user specified character sets code add default charset filter code based patch felix schumacher markt add add default character set filter supports following parameters attributes attribute name encoding required false name character set which should set other character set set explicitly servlet parameter has two special values code default code code system code value code system code uses jvm wide default character set which usually set locale value code default code use strong iso 8859 strong attribute attributes fix bug 49570 bug when using example compression filter set vary header compressed responses markt fix
string vary response get header vary vary null add new vary header response set header vary accept encoding else vary equals action required else merge current header response set header vary vary accept encoding
try protocol handler init catch exception throw new lifecycle exception sm get string coyote connector protocol handler failed	mapper listener doesn follow lifecycle conventions	mapper listener doesn follow lifecycle conventions	try protocol handler destroy catch exception throw new lifecycle exception sm get string coyote connector protocol handler destroy failed bug 49503 bug make sure connectors bind associated ports sufficiently early allow jsvc org apache catalina startup exit init failure system property operate correctly markt fix fix
open default context xml file exists	file default context file new file default context xml default context file absolute default context file new file get base dir default context xml fix bug 49551 bug allow default context xml location specified using absolute path markt fix
suppress warnings deprecation space deprecated cannot replaced white space	space deprecated cannot replaced white space fix bug 49550 bug supress deprecation warning where deprecated code required used functional change patch provided sebb markt fix
try child get state available child stop catch lifecycle exception log error container base remove child stop bug 49530 bug contexts servlets stopped when tomcat shut down markt fix fix
context point likely root context has been deployed request get context null res set status 404 res set message found context so use host request get host log access request response true return false	mapper add host host get name aliases host	container host context get parent mapper add context host get name host context name context welcome files resources	return host mapping data host	param host host object string host name object host string path object context add host host name new string host host mapped host hosts pos mapped host name equals host name synchronized mapped host context contexts mapped host context list contexts slash count mapped host context list nesting mapped host context list nesting slash count	mapped host context list contexts new contexts fix bug 49536 bug root context deployed ensure 404 rather than 200 returned requests don map any other context markt fix
handle special case root context where cookies require path servlet spec uses empty string context path length context path fix bug 49525 bug ensure cookies root context have path rather than empty string markt fix
type naming resources get object key properties name only	new string builder j2ee type web module key properties append get object key properties name only key properties append key properties append get key properties append j2eeserver key properties append get j2eeserver return key properties string private string get object key properties name only string builder result new string builder name string hostname get parent get name hostname null result append default result append hostname result append result append path name return result string fix bug 49522 bug fix regression due change name mbeans naming resources broke complete server status page manager application note mbeans now have new name markt fix
private final int nonce cache size	suppress warnings unchecked lru cache string nonce cache lru cache string req get session true get attribute constants csrf nonce session attr name nonce cache null nonce cache contains previous nonce nonce cache null nonce cache new lru cache string nonce cache size req get session set attribute constants csrf nonce session attr name nonce cache nonce cache add new nonce	private static class lru cache although internal uses map cache only concerned keys private final map cache public lru cache final int cache size cache new linked hash map private static final long serial version uid 1l override protected boolean remove eldest entry map entry eldest size cache size return true return false public void add key cache put key null public boolean contains key return cache contains key key	context ctxt context host find child context path ctxt null	args ctxt get display name args new boolean ctxt get available ctxt get manager null ctxt get manager get active sessions	args new object 14	manager manager ctxt get manager ctxt get manager get max inactive interval 60 ctxt get path equals context get path else ctxt get available deployed else ctxt get available deployed else ctxt get available deployed	args new object	args new object args new object args sm get string html manager servlet diagnostics leak warning args sm get string html manager servlet diagnostics leak button	context ctxt context host find child search path null ctxt session sessions ctxt get manager find sessions	context ctxt context host find child search path null ctxt session session ctxt get manager find session id	get servlet context get request dispatcher resp encode url session detail jsp path include req resp	small href small td	input type submit value small small attribute name nonce cache size required false number previously issued nonces cached lru basis support parallel requests limited use refresh back browser similar behaviors may result submission previous nonce rather than current one set default value used attribute you authorized view page you have already configured manager application allow access you have used your browsers back button used saved bookmark similar you may have triggered cross site request forgery csrf protection has been enabled html interface manager application you need reset protection returning href request get context path html main manager page once you return page you able continue using manager appliction html interface normally you continue see access denied message check you have necessary permissions access application you have changed string submit url response encode url http servlet request page context get request get request url string meta http equiv pragma content cache http meta http equiv cache control content cache must revalidate http meta http equiv expires content invalid value should treated now meta http equiv content language content en meta name author content cedrik lime meta name copyright content copyright 2005 2010 apache software foundation meta name robots content noindex nofollow noarchive title sessions details current session id title div input type hidden name path value path input type hidden name session id value current session id input type hidden name action value session detail input type submit value refresh div attribute names enumeration next element attributes caption style font variant small caps jsp helper format number attributes attributes caption thead tr th remove attribute th th attribute name th th attribute value th tr thead tfoot tr td colspan style text align center todo set max inactive interval sessions td tr tfoot tbody string attribute name string attribute names enumeration next element tr td align center form method post action submit url div input type hidden name path value path input type hidden name action value remove session attribute input type hidden name session id value current session id input type hidden name attribute name value attribute name input type submit value remove div form td td jsp helper escape xml attribute name td td object attribute value current http session get attribute attribute name span title attribute value null attribute value get class string jsp helper escape xml attribute value span td tr tbody style text align center input type hidden name path value path input type submit value return session list href http validator w3 org check uri referer img src http www w3 org icons valid html401 alt valid html 01 height 31 width 88 href http validator w3 org check uri referer img src http www w3 org icons valid xhtml10 alt valid xhtml height 31 width 88 href http validator w3 org check uri referer img src http www w3 org icons valid xhtml11 alt valid xhtml height 31 width 88 string submit url response encode url http servlet request page context get request get request uri path path style text align center input type submit value return main page filter filter name csrf filter name filter class org apache catalina filters csrf prevention filter filter class init param param name entry points param name param value html html html list param value init param filter filter mapping filter name csrf filter name servlet name htmlmanager servlet name servlet name jsp servlet name filter mapping
header named code remote ip header code default value code forwarded code values processed right left order li	td remote ip header td	code remote ip header code td	lt param name gt remote ip header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ip proxies header lt param name gt lt param value gt forwarded lt param value gt	lt param name gt remote ip header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ip proxies header lt param name gt lt param value gt forwarded lt param value gt	lt param name gt remote ip header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ip proxies header lt param name gt lt param value gt forwarded lt param value gt	lt param name gt remote ip header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ip proxies header lt param name gt lt param value gt forwarded lt param value gt	protected static final string remote ip header parameter remote ip header	see set remote ip header string private string remote ip header forwarded	string remote ip header value comma delimited list string array request get header remote ip header loop remote ip header value find first trusted remote ip build proxies chain idx remote ip header value length idx idx string current remote ip remote ip header value idx	continue loop remote ip header value build new value remote ip header string current remote ip remote ip header value idx	request remove header remote ip header request set header remote ip header comma delimited remote ip header value	original scheme request get scheme original remote ip header request get header remote ip header original protocol header request get scheme new secure request secure new remote ip header request get header remote ip header new proxies header request get header proxies header	public string get remote ip header return remote ip header	set remote ip header filter config get init parameter remote ip header parameter	public void set remote ip header string remote ip header remote ip header remote ip header comma delimited list proxies trusted when appear link remote ip header header can expressed	header named code remote ip header code default value code forwarded code values processed right left order li	td remote ip header td	code remote ip header code td	remote ip header forwarded remote ip proxies header forwarded	remote ip header forwarded remote ip proxies header forwarded	remote ip header forwarded remote ip proxies header forwarded	remote ip header forwarded remote ip proxies header forwarded	string remote ip header value comma delimited list string array request get header remote ip header loop remote ip header value find first trusted remote ip build proxies chain idx remote ip header value length idx idx string current remote ip remote ip header value idx	continue loop remote ip header value build new value remote ip header string current remote ip remote ip header value idx lt param name gt remote ip header lt param name gt lt param name gt remote ip proxies header lt param name gt lt param name gt remote ip header lt param name gt lt param name gt remote ip proxies header lt param name gt lt param name gt remote ip header lt param name gt lt param name gt remote ip proxies header lt param name gt lt param name gt remote ip header lt param name gt lt param name gt remote ip proxies header lt param name gt attribute name remote ip header required false attribute name remote ip header required false
private int counter receive evt all session private long counter receive evt change session id private long counter send evt all session data private long counter send evt change session id	return returns counter send evt change session id public long get counter send evt change session id return counter send evt change session id	return returns counter receive evt change session id public long get counter receive evt change session id return counter receive evt change session id	change session id current session new randomly generated session id param session session change session id override public void change session id session session change session id session true public void change session id session session boolean notify original session id string org session id session get id super change session id session notify changed session id string new session id session get id try serialize session id byte data serialize session id new session id notify change session id session message msg new session message impl get name session message evt change session id data org session id org session id system current time millis counter send evt change session id send msg catch ioexception log error sm get string delta manager unable serialize session id new session id serialize session id throws ioexception input output error occurs protected byte serialize session id string session id throws ioexception byte array output stream bos new byte array output stream object output stream oos new object output stream bos oos write utf session id oos flush oos close return bos byte array load session id throws ioexception input output error occurs protected string deserialize session id byte data throws ioexception replication stream ois get replication stream data string session id ois read utf ois close return session id	case session message evt session delta case session message evt change session id	counter receive evt change session id	counter send evt change session id	case session message evt change session id handle change session id msg sender break	handle receive change session id other node param msg param sender throws ioexception protected void handle change session id session message msg member sender throws ioexception counter receive evt change session id delta session session delta session find session msg get session id string new session id deserialize session id msg get session session set primary session false notify session listeners replication session set id new session id else session set id internal new session id add session	li pre public static final int evt session expired pre li li pre public static final int evt session delta pre li li pre public static final int evt all session data pre li li pre public static final int evt all session pre li li pre public static final int evt change session id pre li	event type used when session id has been changed public static final int evt change session id 15	evt get all sessions br get all sessions from from one nodes br	evt change session id br send original session id new session id br	case evt change session id return session id changed name counter receive evt change session id description count receive evt change session id messages type long writeable false attribute name counter send evt change session id description count send evt change session id messages type long writeable false attribute
org apache catalina ha cluster single sign	protected static final string info org apache catalina ha cluster single sign listener	protected static final string info org apache catalina ha session cluster session listener
code false code used should tomcat attempt terminate any link java util timer thread have been started web application specified default value code false code used private boolean clear references stop timer threads false	return clear references stop timer threads flag context public boolean get clear references stop timer threads return clear references stop timer threads set clear references stop timer threads feature context param clear references stop timer threads new flag value public void set clear references stop timer threads boolean clear references stop timer threads boolean old clear references stop timer threads clear references stop timer threads clear references stop timer threads clear references stop timer threads support fire property change clear references stop timer threads old clear references stop timer threads clear references stop timer threads	code false code used should tomcat attempt terminate any link java util timer thread have been started web application specified default value code false code used private boolean clear references stop timer threads false	return clear references stop timer threads flag context public boolean get clear references stop timer threads return clear references stop timer threads set clear references stop timer threads feature context param clear references stop timer threads new flag value public void set clear references stop timer threads boolean clear references stop timer threads clear references stop timer threads clear references stop timer threads	set clear references log factory release feature context param clear references log factory release new flag value public void set clear references log factory release boolean clear references log factory release clear references log factory release clear references log factory release	timer thread can stopped safely so treat separately java util timer thread clear references stop timer threads	class loader set clear references stop timer threads standard context container get clear references stop timer threads attribute name clear references stop timer threads required false code true code tomcat attempts terminate code java util timer code threads have been started web application unlike standard threads timer threads can stopped safely although may still side effects application specified default value code false code used attribute
-1
child add container listener	remove listeners child
copy raw uri decoded uri parse path parameters strip out path parameters convert decoded uri bytes parse path parameters req request uri decoding xx decoding url try req get urldecoder convert decoded uri false catch ioexception ioe res set status 400 res set message invalid uri ioe get message return false normalize req decoded uri res set status 400 res set message invalid uri return false character decoding convert uri decoded uri request check uri still normalized check normalize req decoded uri res set status 400 res set message invalid uri character encoding return false	redirect path redirect path application session cookie config get session uri param name request get context request get requested session id	request get servlet context get effective session tracking modes get session id one string session id request get path parameter application session cookie config get session uri param name request get context session id null request set requested session id session id request set requested session url true	extract path parameters from request assumes parameters form path name value name2 value2 etc currently only really interested session id form other parameters can safely ignored param req param request protected void parse path parameters org apache coyote request req request request process bytes default format so normally op req decoded uri bytes byte chunk uri bc req decoded uri get byte chunk int semicolon uri bc index string enc null while semicolon enc null what encoding use some platforms eg os use default encoding doesn give expected result so explicit enc connector get uriencoding enc null enc iso 8859 parse path param extract from decoded request uri int start uri bc get start int end uri bc get end int path param start semicolon int path param end byte chunk find chars uri bc get buffer uri bc get start path param start uri bc get end new byte string pv null boolean warned encoding false path param end try pv new string uri bc get buffer start path param start path param end path param start enc catch unsupported encoding exception warned encoding log warn sm get string coyote adapter parse path param enc warned encoding true extract path param from decoded request uri byte buf uri bc get buffer int end start path param end buf start semicolon buf start path param end uri bc set bytes buf start end start path param end semicolon else try pv new string uri bc get buffer start path param start end start path param start enc catch unsupported encoding exception warned encoding log warn sm get string coyote adapter parse path param enc warned encoding true uri bc set end start semicolon pv null int equals pv index equals request add path parameter pv substring equals pv substring equals semicolon uri bc index semicolon	path parameters protected map string string path parameters new hash map string string protected void add path parameter string name string value path parameters put name value protected string get path parameter string name return path parameters get name	path parameters clear	string tok application session cookie config get session uri param name request get context session get id internal	sb append application session cookie config get session uri param name request get context	private static final string default session cookie name jsessionid private static final string default session parameter name jsessionid	private static string get configured session cookie name context context	return null determine name use session cookie provided context param context public static string get session cookie name context context string result get configured session cookie name context result null result default session cookie name return result determine name use session cookie provided context param context public static string get session uri param name context context string result get configured session cookie name context result null result default session parameter name return result	server digest equals client digest return null	log debug enabled log debug passing all access status true	file append application session cookie config get session uri param name request get context	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test path params throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx servlet new path param servlet ctx add servlet mapping servlet tomcat start test path none test path jsessionid 1234 1234 test path foo jsessionid 1234 1234 test path foo jsessionid 1234 dummy 1234 test path foo jsessionid 1234 dummy 5678 1234 test path foo jsessionid 1234 5678 1234 test path foo jsessionid 1234 bar 1234 private void test path string path string expected throws exception byte chunk res get url http localhost get port path assert equals expected res string private static class path param servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain print writer pw resp get writer string session id req get requested session id session id null session id none pw write session id
private static final string sci location meta inf services javax servlet servlet container initializer	url url fragment get url jar equals url get protocol jar conn jar url open connection jar file conn get jar file zip entry entry jar file get entry sci location entry null jar file get input stream entry else file equals url get protocol string path url get path file file new file path sci location file exists new file input stream file null context config servlet container initializer fail url	url url fragment get url note ignore file urls now since only jar urls accepted jar equals url get protocol jar conn jar url open connection jar file conn get jar file zip entry entry jar file get entry meta inf resources entry null context add resource jar url url log error sm get string context config resource jar fail url
-1
usr null pool properties get db properties set property user usr pwd null pool properties get db properties set property password pwd
string cdl cd lower case locale english	default host host lower case locale english	name name lower case locale english internally all names lower case	alias alias lower case locale english	alias alias lower case locale english	string dispatcher dispatcher string upper case locale english	filename lower case locale english ends war	filename lower case locale english index war	string cdl cd lower case locale english	obj session get attribute locale test attributes lower case locale english obj session get attribute locale test attributes upper case locale english	obj http session get attribute user test attributes lower case locale english obj http session get attribute user test attributes upper case locale english	header headers next element upper case locale english	path upper case locale english starts web inf path upper case locale english starts meta inf	path upper case locale english starts web inf path upper case locale english starts meta inf	destination path upper case locale english starts web inf destination path upper case locale english starts meta inf path upper case locale english starts web inf path upper case locale english starts meta inf	path upper case locale english starts web inf path upper case locale english starts meta inf	path upper case locale english starts web inf path upper case locale english starts meta inf	path upper case locale english starts web inf path upper case locale english starts meta inf	path upper case locale english starts web inf path upper case locale english starts meta inf	string lname name lower case locale english	string lname name lower case locale english	string lname name lower case locale english	string lname name lower case locale english	string lower case variable name variable name lower case locale english	variable name variable name upper case locale english	commands get str cmd lower case locale english	path null path upper case locale english starts web inf path upper case locale english starts meta inf	string name parts name upper case locale english split	string filename filenames lower case locale english	string filename filenames lower case locale english	doc base lower case locale english ends war file directory unpack wars	else doc base lower case locale english ends war	doc base lower case locale english ends war	files lower case locale english ends xml	doc base get absolute path lower case locale english ends war	files lower case locale english ends war dir file	doc base get absolute path lower case locale english ends war	classpath item lower case locale english ends jar	binding get name upper case locale english equals manifest mf	binding get name lower case locale english ends jar	files get name lower case locale english ends jar	return enchash get mime charset name upper case locale english	return revhash get encoding upper case locale english	value str value str trim lower case locale english	string name lower name lower case locale english	string name lower name lower case locale english	content type lower case locale english starts multipart	string cdl content disposition lower case locale english	content disposition lower case locale english starts form data	content type lower case locale english starts multipart	sub content type lower case locale english	param name param name lower case locale english	post equals request get method lower case locale english content type lower case locale english starts multipart	impact impact upper case locale english	string spec substring start lower case locale english	alias alias lower case locale english	jsp file upper case locale english index web inf jsp file upper case locale english index meta inf	return text upper case locale english
start pos comma pos lower case locale english trim	lower case locale english trim	start pos comma pos lower case locale english trim	lower case locale english trim	start pos comma pos lower case locale english trim	lower case locale english trim
string page dir enc page dir enc upper case locale english	config enc config enc upper case locale english	string page enc root get page encoding upper case locale english	string page dir enc page dir enc upper case locale english	string page enc root get page encoding upper case locale english	int index input upper case locale english index name upper case locale english
super class needs checked match link handles types annotation matches link handles types	clazz annotation skip return boolean match false entry get key annotation annotation entry annotation entries java class get annotation entries annotation entry annotation entry annotation entries entry get key get name equals get class name annotation entry get annotation type match true break else entry get key assignable from clazz match true match	private static final string get class name string internal form internal form starts return internal form assume starts ends uses rather than return internal form substring internal form length replace
clazz context get loader get class loader load class class name catch class def found error log debug sm get string context config invalid sci handles types class name return return
protected int max idle max active
protected static final string prop suspect timeout suspect timeout	value properties get property prop suspect timeout value null pool properties set suspect timeout integer parse int value
public static final string path separator system get property path separator
filter map set filter name filter def get filter name
filter maps length filter map insert point
protected map string jar resource tag file jar urls	protected jar resource tag jar resource	tag file jar urls new hash map string jar resource	jar resource tag jar resource tag jar resource tag jar resource tag jar resource null	jar resource jar resource tag file jar urls get res jar resource null jar resource tag jar resource jar resource null result jar resource get entry res substring	public jar resource get tag file jar resource string tag file public void set tag file jar resource string tag file jar resource jar resource tag file jar urls put tag file jar resource	public jar resource get tag file jar resource return tag jar resource	public tld location get tld location string uri throws jasper exception tld location location	pc get jsp compilation context get tag file jar resource path	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license return jar file resource new instance jar file should returned each call throws ioexception jar file get jar file throws ioexception return url resource may may point actual jar file string get url param name return url entry within resource url get entry string name	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private string jar url public jar urlresource url jar url jar url external form public jar urlresource string jar url jar url jar url public jar file get jar file throws ioexception url jar file url new url jar jar url jar conn jar jar file url open connection conn set use caches false conn connect return conn get jar file public string get url return jar url public url get entry string name try return new url jar jar url name catch malformed urlexception throw new runtime exception	tld location location ctxt get tld location uri	private jar resource jar resource	boolean directives only jar resource jar resource	jar resource jar resource	jar resource jar resource string page enc string jsp config page enc jar resource	parser controller parse file parent jar resource	tld location location ctxt get tld location uri	ctxt set tag file jar resource info get path ctxt get tag file jar resource	return do parse file name null ctxt get tag file jar resource	return do parse file name null ctxt get tag file jar resource	jar resource jar resource return do parse file name parent jar resource	jar resource jar resource node nodes page do parse file name null jar resource	jar resource jar resource	jar file jar file jar resource null null jar resource get jar file	jar resource get entry abs file name substring string	directive only jar resource	string name string path jar resource jar resource tag library info tag lib info	page pc parse tag file directives path jar resource	jar resource tag jar resouce null tag jar resouce compiler get compilation context get tld location tag info get tag library get uri get jar resource string wrapper uri tag jar resouce null wrapper uri tag file path wrapper uri tag jar resouce get entry tag file path string get runtime context tag jar resouce	ctxt get tag file jar resource tag file path	tld location location jar resource jar resource location get jar resource page info add dependant jar resource get entry location get name string page info add dependant jar resource get entry tag file path substring string	string prefix string uri tld location location error dispatcher err	string tld name location get name jar resource jar resource location get jar resource jar resource null get resource stream tld name throw new file found exception tld name err jsp error jsp error file found tld name parse tld tld name null page info add dependant tld name jar resource get entry tld name open stream parse tld jar resource get url jar resource err jsp error jsp error tld unable read jar resource get url jar resource get url ex string	private void parse tld string uri input stream jar resource jar resource	jar resource	private tld location generate tldlocation string uri jsp compilation context ctxt	uri ends jar url ctxt get resource uri err jsp error jsp error tld unable get jar uri ex err jsp error jsp error tld missing jar uri return new tld location meta inf taglib tld url string else return new tld location uri	private tag file info create tag file info tree node elem jar resource jar resource	ctxt set tag file jar resource path jar resource parser controller name path jar resource	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private string entry name private jar resource jar public tld location string entry name entry name jar resource null public tld location string entry name string resource url entry name get jar resource resource url public tld location string entry name jar resource jar resource entry name null throw new illegal argument exception tld name required entry name entry name jar jar resource private static jar resource get jar resource string resource url return resource url null new jar urlresource resource url null return name tag library public string get name return entry name return jar resource tag library contained might return null tag library contained jar resource public jar resource get jar resource return jar	private hashtable string tld location mappings	mappings new hashtable string tld location	public tld location get location string uri throws jasper exception	tld location location location new tld location meta inf taglib tld ctxt get resource tag loc string else location new tld location tag loc mappings put tag uri location	tld location location entry name null location new tld location resource path else location new tld location entry name resource path mappings put uri location	jar resource tag jar resource	tag jar resource add bug 48689 bug access tld files through new jar resource interface make extending jasper simpler particularly osgi environments patch provided jarek gawor markt add
array list locale list locales values locale locale list	map entry string string entry orig entry set dest put entry get key entry get value	array list wrapper list map values wrapper wrapper list	map entry string cluster manager entry managers entry set entry get value null session entry get value find session session id	entry get key	map entry string cluster manager entry managers entry set entry get value null entry get value message data received msg entry get key	map entry string string entry init params entry set servlet def add init parameter entry get key entry get value	map entry string string entry init params entry set filter def add init parameter entry get key entry get value
protected static volatile message digest md5helper	protected static volatile http session context session context null	stream write object long value creation time stream write object long value last accessed time stream write object integer value max inactive interval stream write object boolean value new stream write object boolean value valid stream write object long value accessed time	stream write object integer value	private static volatile set string tld jars null	private static volatile array list extension container available extensions null	protected static volatile digester digester null
param values boolean value await	don set daemon until init has completed bootstrap bootstrap new bootstrap bootstrap init daemon bootstrap
final queue exception exception queue new concurrent linked queue exception	exception queue add	exception queue empty fail exception while sending threads exception queue remove string
class klass assignable from tag get class
int len get send all sessions size current sessions length current sessions length get send all sessions size session send sessions new session len
prestart threads protected boolean prestartmin spare threads false	prestartmin spare threads executor prestart all core threads	public boolean prestartmin spare threads return prestartmin spare threads	public void set prestartmin spare threads boolean prestartmin spare threads prestartmin spare threads prestartmin spare threads add bug 43642 bug add prestartmin spare threads attribute executor jfclere add attribute name prestartmin spare threads required false boolean whether min spare threads should started when starting executor default code false code attribute
-1
sessions instanceof lazy replicated map lazy replicated map map lazy replicated map sessions map null map breakdown
initialized init force random number generator generate session id	set state lifecycle state starting	log debug enabled log debug stopping set state lifecycle state stopping random null initialized destroy
protected volatile static message digest md5helper
string builder buffer new string builder trace append req get request uri append append req get protocol buffer append crlf append header name append append req get header header name buffer append crlf response length buffer length out print buffer string
protected static final class page context pool
-1
-1
return new expression factory	param properties properties passed new instance may null return new expression factory	convenience constructor link empty role semantic deny	link session tracking mode ssl	param jsp wildcard true name identifies jsp servlet	return true host attempt create directories	component soon link start exits	see get accessed time	see get last accessed time	link http servlet response send error int string	link http servlet response send error int string	param new session id session change session id	param context context web application	digester should use link get pipeline link add valve valve case	set clear references thread locals feature context param clear references thread locals new flag value	see get accessed time	see get last accessed time	see object hash code	param rpc options int first reply majority reply all reply param channel options channel sender options	since el	false string literals rtexprvalues should	param response servlet response we creating	param response servlet response we creating
protected concurrent hash map socket wrapper socket ajp processor connections new concurrent hash map socket wrapper socket ajp processor	protected concurrent hash map socket wrapper socket connections new concurrent hash map socket wrapper socket	iterator socket wrapper socket sockets waiting requests iterator socket wrapper socket socket sockets next	protected concurrent linked queue socket wrapper socket waiting requests new concurrent linked queue socket wrapper socket
override	override	override	override	override	override	override	override	override	override	override	override	override
return create standard context parent path doc base false false false false	creates new standard service standard engine param domain domain name container instance param default host name default host used engine param base dir base directory value engine exception exception mbean cannot created registered public string create standard service engine string domain string default host string base dir throws exception container instanceof server throw new exception standard engine engine new standard engine engine set domain domain engine set name domain engine set default host default host engine set base dir base dir service service new standard service service set container engine service set name domain server container add service service return engine get jmx name string	remove existing service param name mbean name component remove exception exception component cannot removed public void remove service string name throws exception container instanceof server throw new exception acquire reference component removed object name oname new object name name service service get service oname server container remove service service type org apache catalina mbeans mbean factory operation name create standard service engine description create new standard service standard engine parameter name domain description domain used mbeans associated new service description default host name new engine parameter name base dir description base directory value new engine
public static volatile boolean use secure random uuid false
session valid internal session already invalid expire session prevent memory leak session set valid true session expire
annotation used declare array application classes which passed link javax servlet servlet container initializer return array classes	annotation represents security constraints applied all requests http protocol method types otherwise represented link javax servlet annotation http method constraint link javax servlet annotation servlet security annotation empty role semantic determines behaviour when roles allowed list empty return empty role semantic determines whether ssl tls required process current request return transport guarantee authorized roles names container may discard duplicate role names during processing annotation string does have special meaning occurs role name return array names array may zero length which case empty role semantic applies returned value determines whether access permitted denied regardless identity state either case permit deny br otherwise when array contains one more role names access permitted user member least one named roles empty role semantic applied case	specific security constraints can applied different types request http protocol method type using annotation inside link javax servlet annotation servlet security annotation http protocol method name post put return method name empty role semantic determines behaviour when roles allowed list empty return empty role semantic determines whether ssl tls required process current request return transport guarantee authorized roles names container may discard duplicate role names during processing annotation string does have special meaning occurs role name return array names array may zero length which case empty role semantic applies returned value determines whether access permitted denied regardless identity state either case permit deny br otherwise when array contains one more role names access permitted user member least one named roles empty role semantic applied case	annotation used indicate link javax servlet servlet which declared expects requests made using code multipart form data mime type br br link javax servlet http part components given code multipart form data request retrieved servlet annotated code multipart config calling link javax servlet http http servlet request get part link javax servlet http http servlet request get parts br br code web servlet upload code br code multipart config code code public class upload servlet extends http servlet code br return location which container stores temporary files return maximum size allowed uploaded files bytes return maximum size request allowed code multipart form data return size threshold which file written disk	declare annotation link javax servlet servlet class enforce security constraints http protocol requests br container applies constraints url patterns mapped each servlet which declares annotation br br represents two possible values empty role semantic active when list role names empty access must permitted regardless state identity access must denied regardless state identity represents two possible values data transport encrypted user data must encrypted container during transport container must encrypt user data during transport default constraint apply requests handled specific method constraints return http constraint array http method contraint objects which security constraint applied return array http method constraint	annotation used declare servlet link javax servlet filter br br annotation processed container during deployment filter class which found created per applied url patterns link javax servlet servlet link javax servlet dispatcher type br br name attribute defined fully qualified name class used br br least one url pattern must declared either code value code url pattern attribute annotation both br br code value attribute recommended use when url pattern only attribute being set otherwise code url pattern attribute should used br br annotated class must implement link javax servlet filter code web filter path code br code public class example filter implements filter code br since servlet section return description filter present return display name filter present return array params filter return name filter present return small icon filter present return large icon filter present return array servlet names which filter applies convenience method allow extremely simple annotation class return array url patterns see url patterns return array url patterns which filter applies return array dispatcher types which filter applies return asynchronous operation supported filter	annotation used declare parameter link javax servlet servlet link javax servlet filter within link javax servlet annotation web filter link javax servlet annotation web servlet annotation br br code web servlet name test servlet url patterns test init params web init param name test value true public class test servlet extends http servlet code br return name parameter return value parameter return description parameter	annotation used declare listener various types event given web application context br br class annotated must implement one more following interfaces link javax servlet http http session attribute listener link javax servlet http http session listener link javax servlet servlet context attribute listener link javax servlet servlet context listener link javax servlet servlet request attribute listener link javax servlet servlet request listener br br code web listener code br code public test listener implements servlet context listener code br return description listener present	annotation used declare link javax servlet servlet br name attribute defined fully qualified name class used br br least one url pattern must declared either code value code url pattern attribute annotation both br br code value attribute recommended use when url pattern only attribute being set otherwise code url pattern attribute should used br br class which annotation declared must extend link javax servlet http http servlet br br code web servlet path br public class test servlet extends http servlet code br code web servlet name test servlet url patterns path alt br public class test servlet extends http servlet code br since servlet section return name servlet convenience method allow extremely simple annotation class return array url patterns see url patterns return array url patterns which filter applies return load startup ordering hint return array params servlet return asynchronous operation supported servlet return small icon servlet present return large icon servlet present return description servlet present return display name servlet present
private static char special characters new char highest special
final private list string roles new array list string roles null roles add all roles
expired	writer println sm get string manager servlet unlimited notimeout writer println sm get string manager servlet expired idle expired
timeout licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license mock link filter chain keep handle passed link servlet request public static class mock filter chain implements filter chain private http servlet request request override public void do filter servlet request request servlet response response throws ioexception servlet exception request http servlet request request public http servlet request get request return request public static class mock http servlet extends http servlet private static final long serial version uid 1l http servlet request request public http servlet request get request return request override public void service http servlet request request http servlet response response throws servlet exception ioexception request request print writer writer response get writer writer println request remote addr request get remote addr writer println request remote host request get remote host writer println request secure request secure writer println request scheme request get scheme writer println request server port request get server port writer println enumeration string headers request get header names headers has more elements string name headers next element string writer println request header name collections list request get headers name enhanced link request ease testing public static class mock http servlet request extends request public mock http servlet request super set coyote request new org apache coyote request set connector new connector public void set header string name string value get coyote request get mime headers set value name set string value public void set scheme string scheme get coyote request scheme set string scheme public static final string temp dir system get property java io tmpdir public void test comma delimited list string array list string elements arrays list element1 element2 element3 string actual remote ip filter list comma delimited string elements assert equals element1 element2 element3 actual public void test comma delimited list string array empty list list string elements new array list string string actual remote ip filter list comma delimited string elements assert equals actual public void test comma delimited list string array null list string actual remote ip filter list comma delimited string null assert equals actual public void test header names case remote ip filter xforwarded request request new remote ip filter xforwarded request new mock http servlet request request set header myheader lower case request set header myheader upper case request set header my header camel case assert equals request headers size assert equals camel case request get header myheader public void test incoming request secured protocol header says custom values throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto filter def add init parameter remote ipheader my forwarded filter def add init parameter http server port 8080 mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set secure true request set scheme https request set header my forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify boolean actual secure actual request secure assert equals request must unsecured header forwarded proto said http false actual secure string actual scheme actual request get scheme assert equals scheme must http header forwarded proto said http http actual scheme int actual server port actual request get server port assert equals wrong http server port 8080 actual server port string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test incoming request secured protocol header says default values throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set secure true request set scheme https request set header forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify boolean actual secure actual request secure assert equals request must unsecured header forwarded proto said http false actual secure string actual scheme actual request get scheme assert equals scheme must http header forwarded proto said http http actual scheme string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke allowed remote addr null remote ip header throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded request get header forwarded assert null forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 192 168 10 actual remote addr string actual remote host actual request get remote host assert equals remote host remote host original value actual remote host public void test invoke all proxies internal throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 192 168 10 192 168 11 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies internal forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert null all proxies internal forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted throws exception prepare remote ip filter remote ip filter new remote ip filter filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded filter def set filter remote ip filter mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted remote addr match regexp throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 127 192 168 another internal proxy filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted internal throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 192 168 10 192 168 11 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke allowed remote addr throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr allowed internal proxy request set remote host allowed internal proxy host request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert equals forwarded must unchanged 140 211 11 130 proxy1 proxy2 actual xforwarded string actual xforwarded actual request get header forwarded assert null forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr allowed internal proxy actual remote addr string actual remote host actual request get remote host assert equals remote host allowed internal proxy host actual remote host public void test invoke untrusted proxy chain throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 untrusted proxy proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert equals ip host before untrusted proxy must appear forwarded 140 211 11 130 proxy1 actual xforwarded string actual xforwarded actual request get header forwarded assert equals ip host after untrusted proxy must appear forwarded proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr untrusted proxy actual remote addr string actual remote host actual request get remote host assert equals remote host untrusted proxy actual remote host public void test list comma delimited string string actual remote ip filter comma delimited list string array element1 element2 element3 string expected new string element1 element2 element3 assert equals expected length actual length int actual length assert equals expected actual public void test list comma delimited string mixed space chars string actual remote ip filter comma delimited list string array element1 element2 element3 string expected new string element1 element2 element3 assert equals expected length actual length int actual length assert equals expected actual private http servlet request test remote ip filter filter def filter def request request throws lifecycle exception ioexception servlet exception tomcat tomcat get tomcat instance context root tomcat add context temp dir remote ip filter remote ip filter new remote ip filter filter def set filter class remote ip filter class get name filter def set filter remote ip filter filter def set filter name remote ip filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name remote ip filter class get name filter map add urlpattern root add filter map filter map get tomcat instance start mock filter chain filter chain new mock filter chain test remote ip filter do filter request new response filter chain return filter chain get request test link remote ip filter tomcat standalone server public void test tomcat server throws exception mostly default enable forwarded proto map string string remote ip filter parameter new hash map string string remote ip filter parameter put protocol header forwarded proto setup tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def get parameter map put all remote ip filter parameter filter def set filter class remote ip filter class get name filter def set filter name remote ip filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name remote ip filter class get name filter map add urlpattern root add filter map filter map mock http servlet mock servlet new mock http servlet tomcat add servlet root mock servlet get class get name mock servlet root add servlet mapping test mock servlet get class get name get tomcat instance start test http http http new url http localhost tomcat get connector get port test open connection string expected remote addr my remote addr http add request property forwarded expected remote addr http add request property forwarded proto https validate assert assert equals http http ok http get response code http servlet request request mock servlet get request assert assert null request validate fowarded assert assert equals expected remote addr request get remote addr assert assert equals expected remote addr request get remote host validate forwarded proto assert assert true request secure assert assert equals https request get scheme assert assert equals 443 request get server port
-1
log debug enabled log debug skip remote ip filter request request get request uri original remote addr request get remote addr	else log debug enabled log debug skip remote ip valve request request get request uri original remote addr request get remote addr
should tomcat attempt clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload disabled default since clearing thread local objects performed thread safe manner private boolean clear references thread locals false	return clear references thread locals flag context public boolean get clear references thread locals return clear references thread locals set clear references stop threads feature context param clear references stop threads new flag value public void set clear references thread locals boolean clear references thread locals boolean old clear references thread locals clear references thread locals clear references thread locals clear references thread locals support fire property change clear references stop threads old clear references thread locals clear references thread locals	should tomcat attempt clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload disabled default since clearing thread local objects performed thread safe manner private boolean clear references thread locals false	return clear references thread locals flag context public boolean get clear references thread locals return clear references thread locals set clear references thread locals feature context param clear references thread locals new flag value public void set clear references thread locals boolean clear references thread locals clear references thread locals clear references thread locals	clear references thread locals log debug sm get string webapp class loader clear thread local debug clear clear references thread locals log info sm get string webapp class loader clear thread local clear clear references thread locals key null stale entries count else map remove invoke map key	class loader set clear references thread locals standard context container get clear references thread locals attribute name clear references thread locals required false code true code tomcat attempts clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload specified default value code false code used since clearing thread local objects performed thread safe manner attribute
notify session listeners replication session tell new
return url xml descriptor context public url get config file set url xml descriptor context param config file url xml descriptor context public void set config file url config file	url xml descriptor context private url config file null	return url xml descriptor context public url get config file	set url xml descriptor context param config file url xml descriptor context public void set config file url config file	should xml files copied catalina base conf engine host default when web application deployed private boolean copy xml false	return copy xml config file flag component public boolean copy xml return copy xml set copy xml config file flag component param copy xml new copy xml flag public void set copy xml boolean copy xml copy xml copy xml	context set config file config file uri url	file default context file new file get base dir default context xml default context file exists try url default context url default context file uri url process context config default context url catch malformed urlexception log error sm get string context config bad url default context file file host context file new file get config base get host config path constants host context xml host context file exists try url host context url host context file uri url process context config host context url catch malformed urlexception log error sm get string context config bad url host context file process context config context get config file	protected void process context config url context xml file context xml source new input source context xml string stream context xml open stream add watched resource so cascade reload occurs default config file modified added removed context xml get protocol file context add watched resource new file context xml uri get absolute path context xml	file context xml	should xml files copied catalina base conf engine host default when web application deployed protected boolean copy xml false	return copy xml config file flag component public boolean copy xml return copy xml set copy xml config file flag component param copy xml new copy xml flag public void set copy xml boolean copy xml copy xml copy xml	set copy xml standard host host copy xml	context set config file context xml uri url	boolean xml war false xml war true copy xml	context set config file xml uri url else deploy xml xml war synchronized digester try jar new jar file war entry jar get jar entry constants application context xml istream jar get input stream entry context context digester parse istream context null log error sm get string host config deploy descriptor error file return context set config file new url jar war uri string constants application context xml catch exception istream null try istream close catch throwable ignore istream null finally entry null jar null try jar close catch throwable ignore jar null digester reset context null log error sm get string host config deploy descriptor error file return	copy xml xml copy new file config base file xml input stream null output stream os null new file input stream xml os new file output stream xml copy iotools flow os don catch ioe let outer try catch handle finally try null close catch ioexception ignore try os null os close catch ioexception ignore context set config file xml copy uri url else context set config file xml uri url add bug 48662 bug provide new option control copying context xml descriptors from web applications host xml base copying xml descriptors now disabled default markt add absolute pathname pathname relative code catalina base code directory see deployment web applications specified default code webapps code used pathname directory may contain context xml descriptors deployed virtual host you may specify deployment web applications specified default code engine name host name code used set true tomcat attempt create directories defined attributes code app base code code xml base code during startup phase default value code true code set true directory creation fails error message printed out halt startup sequence flag value indicates tomcat should check periodically new updated web applications while tomcat running true tomcat periodically checks code app base code code xml base code directories deploys any new web applications context xml descriptors found updated web applications context xml descriptors trigger reload web application flag value defaults true see deployed when tomcat starts flag value defaults true see attribute name copy xml required false set code true code you want context xml descriptor embedded inside application located code meta inf context xml code copied code xml base code when application deployed subsequent starts copied context xml descriptor used preference any context xml descriptor embedded inside application even descriptor embedded inside application more recent flag value defaults code false code note strong deploy xml strong code false code attribute have effect attribute set code false code you want disable parsing context xml descriptor embedded inside application located code meta inf context xml code security conscious environments should set code false code prevent applications from interacting container responsible providing external context file putting location defined strong xml base strong attribute flag value defaults code true code from war file war files located outside host strong app base strong expanded see code org apache catalina core container base engine name host name code li any xml file host code xml base code directory default code catalina base conf engine name host name code assumed context xml descriptor containing sub elements single web application web applications associated each context xml descriptor files deployed first br code doc base code attribute code lt context gt code element must only set doc base outside host code app base code web applications located inside host code app base code code doc base code name xml file xml replaced war web application archive name xml file xml removed directory br code path code attribute must set context path used slash character followed name xml file less xml extension multi level context paths may defined using code foo bar xml code context path code foo bar code default web application has context path code code may defined using file called code root xml code li li any web application archive file within host code app base code directory has already been deployed result context xml descriptor does have directory same name without war extension deployed next context path used slash character followed web application archive name less war extension one exception rule web application archive named root war deployed context path code code multi level contexts may defined using use war named code foo bar war code context path code foo bar code br code unpack wars code attribute code true code web application archive file expanded directory same name without war extension br note you re deploy updated war file while tomcat stopped sure delete associated expanded directory before restarting tomcat so updated war file re expanded when tomcat restarts br code copy xml code code true code code false code default any web application archive file within hosts code app base code directory does have context xml descriptor xml extension rather than war extension host code xml base code scanned see contains context xml descriptor located code meta inf context xml code one found descriptor copied code xml base code directory renamed li li finally any sub directory within host code app base code has already been deployed result context xml descriptor deployed next context path used slash character followed directory name unless directory name root which case context path code code multi level contexts may defined using use directory named code foo bar code context path code foo bar code br code copy xml code code true code code false code default any directory within hosts code app base code directory does have context xml descriptor host code xml base code scanned see contains context xml descriptor located code meta inf context xml code one found descriptor copied code xml base code directory renamed li sub directories dropped code app base code code xml base code case xml file directory while tomcat running deployed according rules described above auto deployer also track web applications following changes finally note you defining contexts explicitly server xml you should probably turn off automatic application deployment otherwise web applications each deployed twice each may cause problems applications
sender send message destination message	catch channel exception sender disconnect throw connected disconnect
private static int min int int
specialized resource avoids opening input stream	file input stream fis new file input stream file input stream fis return fis	input stream base get input stream entry input stream return
else may jar some ide environments result context get resource canonical uri res
list add all group map values return list
response committed response committed including error page best we can do rd include request get request response get response else reset response keeping real error code message response reset buffer true rd forward request get request response get response we forward response suspended again response set suspended false
return ctxt get servlet context
trigger loading class reading property security util package protection enabled
jsp lines length jsp begin line num avoid array index out bounds exception probably bug 48494 could some other cause jsp extract localizer get message jsp error bug48494 return context xslt file global xslt file null context xslt file make directory listings xml doc pass result style sheet which relative context root overrides global xslt file null
protected string local xslt file null allow customized directory listing per context protected string context xslt file null protected string global xslt file null	context xslt file get servlet config get init parameter context xslt file	cache entry name trimmed equals context xslt file continue	context xslt file null input stream get servlet context get resource stream context xslt file null return debug 10 log context xslt file context xslt file found can overridden per context per directory see strong context xslt file strong strong local xslt file strong below format xml shown below td tr tr th valign top context xslt file th td valign top you may also customize your directory listing context configuring code context xslt file code should context relative path code path context xslt code overrides code global xslt file code value present file does exist code global xslt file code used code global xslt file code does exist default directory listing shown overrides code global xslt file code code context xslt file code value present file does exist code context xslt file code used code context xslt file code does exist
protected static final set string insert before new hash set string static insert before add web app insert before add servlet mapping insert before add session config insert before add mime mapping insert before add welcome file list insert before add error page insert before add taglib insert before add resource env ref insert before add resource ref insert before add security constraint insert before add login config insert before add security role insert before add env entry insert before add ejb ref insert before add ejb local ref	boolean inserted false int current reader read while current inserted current string element get element reader insert before contains element insert generated content here writer println insert start marker while true string line fragment reader read line writer println break writer println line writer println insert end marker writer println writer write element else element contains insert start marker skip previous auto generated content while element contains insert end marker element get element reader else writer write element writer write current current reader read	assumes valid xml private string get element reader reader throws ioexception string builder result new string builder result append boolean done false while done int current reader read while current result append char current current reader read result append char current int len result length len result substring equals comment make sure we end result substring len len equals done true else done true return result string
cache entry exists file directory listing doesn appear exist broken symlink odd permission settings return
hconn set fixed length streaming mode content length	file input stream fs input new file input stream war long size fs input get channel size size integer max value throw new unsupported operation exception deploy task does support war files greater than gb content length int size stream new buffered input stream fs input 1024
private static volatile jsp factory deflt null	public static void set default factory jsp factory deflt	public static jsp factory get default factory
try open jars return null entry null jar files length jar entry jar files get jar entry path jar entry null entry new resource entry try entry code base get url jar real files false string jar fake url get uri jar real files string jar fake url jar jar fake url path entry source new url jar fake url entry last modified jar real files last modified catch malformed urlexception return null content length int jar entry get size try entry manifest jar files get manifest binary stream jar files get input stream jar entry catch ioexception return null extract resources contained jar workdir anti jarlocking path ends class byte buf new byte 1024 file resource file new file loader dir jar entry get name resource file exists enumeration jar entry entries jar files entries while entries has more elements jar entry jar entry2 entries next element jar entry2 directory jar entry2 get name ends class resource file new file loader dir jar entry2 get name resource file get canonical path starts canonical loader dir throw new illegal argument exception sm get string webapp class loader illegal jar path jar entry2 get name catch ioexception ioe throw new illegal argument exception sm get string webapp class loader validation error jar path jar entry2 get name ioe resource file get parent file mkdirs file output stream os null input stream null jar files get input stream jar entry2 os new file output stream resource file while true int read buf break os write buf ignore finally try null close catch ioexception try os null os close catch ioexception entry null synchronized found resources found resources put name name binary stream null byte binary content new byte content length int pos while true int binary stream read binary content pos binary content length pos break pos catch ioexception log error sm get string webapp class loader read error name file need convert workaround certain files platforms use ebcdic encoding when read through file input stream see commit message rev 303915 details http svn apache org viewvc view revision revision 303915 string str new string binary content pos try binary content str get bytes utf catch exception return null entry binary content binary content certificates only available after jar entry associated input stream has been fully read jar entry null entry certificates jar entry get certificates finally binary stream null try binary stream close catch ioexception ignore
class name org apache catalina valves remote ip valve	class name org apache catalina valves remote ip valve	class name org apache catalina valves remote ip valve	class name org apache catalina valves remote ip valve	private static final string info org apache catalina valves remote ip valve
buffered input stream bis null bis new buffered input stream fis	bis null bis close catch ioexception ignore fis null try fis close	try ois close catch ioexception ignore	fos null fos close	buffered input stream bis null bis new buffered input stream fis	fis null fis close catch ioexception ignore bis null try bis close	try ois close catch ioexception ignore try ois close catch ioexception ignore ois close	fos null fos close	try oos close catch ioexception ignore	finally try oos close catch ioexception ignore
get server null	get server get port socket socket new socket get server get address get server get port string shutdown get server get shutdown	get server instanceof lifecycle get server initialize	get server null get server null	get server instanceof lifecycle lifecycle get server start	get server instanceof lifecycle lifecycle get server stop	get server await	get server null
entry string string entry context params entry set context add parameter entry get key entry get value	entry string string entry locale encoding mappings entry set context add locale encoding mapping parameter entry get key entry get value	entry string string entry mime mappings entry set context add mime mapping entry get key entry get value	entry string string entry params entry set wrapper add init parameter entry get key entry get value	entry string string entry servlet mappings entry set context add servlet mapping entry get key entry get value	entry string string entry taglibs entry set context add taglib entry get key entry get value	entry string entry fragment map entry set final string key entry get key value entry get value	entry string web xml entry fragments entry set requested order contains entry get key web xml fragment entry get value	entry byte entry int item bc stats entry set byte entry entry item get key int count item get value	entry char entry int item cc stats entry set char entry entry item get key int count item get value
td http server port td td value returned link servlet request get server port when code protocol header code indicates code http code protocol td td td td integer td td 80 td tr tr td https server port td td value returned link servlet request get server port when code protocol header code indicates code https code protocol td td td td integer td td 443 td tr	see set http server port int private int http server port 80	public int get http server port return http server port	protocol header value null don modify secure scheme server port attributes request else protocol header https value equals ignore case protocol header value else request set secure false use request coyote request scheme instead request set scheme because request set scheme op tomcat request get coyote request scheme set string http request set server port http server port	server port value link protocol header code null code does indicate http default value 80 public void set http server port int http server port http server port http server port attribute name http server port description value returned servlet request get server port when protocol header indicates http protocol type java lang string writeable false attribute name https server port description value returned servlet request get server port when protocol header indicates https protocol type java lang string writeable false attribute name remote ip header	private string scheme private boolean secure private int server port	public string get scheme return scheme public int get server port return server port public boolean secure return secure scheme request get scheme secure request secure server port request get server port	public void test invoke xforwarded proto says https incoming http request throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol request get coyote request get mime headers add value forwarded proto set string https request set secure false request set server port 8080 request get coyote request scheme set string http test remote ip valve invoke request null verify client ip string actual xforwarded request get header forwarded assert null intermediate non trusted proxy forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null intermediate trusted proxy actual xforwarded string actual remote addr remote addr host tracker valve get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host remote addr host tracker valve get remote host assert equals remote host 140 211 11 130 actual remote host string actual post invoke remote addr request get remote addr assert equals post invoke remote addr 192 168 10 actual post invoke remote addr string actual post invoke remote host request get remote host assert equals post invoke remote addr 192 168 10 actual post invoke remote host protocol string actual scheme remote addr host tracker valve get scheme assert equals forwarded proto says https https actual scheme int actual server port remote addr host tracker valve get server port assert equals forwarded proto says https 443 actual server port boolean actual secure remote addr host tracker valve secure assert equals forwarded proto says https true actual secure boolean actual post invoke secure request secure assert equals post invoke secure false actual post invoke secure int actual post invoke server port request get server port assert equals post invoke server port 8080 actual post invoke server port string actual post invoke scheme request get scheme assert equals post invoke scheme http actual post invoke scheme public void test invoke xforwarded proto null incoming http request throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol null forwarded proto request set secure false request set server port 8080 request get coyote request scheme set string http test remote ip valve invoke request null verify client ip string actual xforwarded request get header forwarded assert null intermediate non trusted proxy forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null intermediate trusted proxy actual xforwarded string actual remote addr remote addr host tracker valve get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host remote addr host tracker valve get remote host assert equals remote host 140 211 11 130 actual remote host string actual post invoke remote addr request get remote addr assert equals post invoke remote addr 192 168 10 actual post invoke remote addr string actual post invoke remote host request get remote host assert equals post invoke remote addr 192 168 10 actual post invoke remote host protocol string actual scheme remote addr host tracker valve get scheme assert equals forwarded proto null http actual scheme int actual server port remote addr host tracker valve get server port assert equals forwarded proto null 8080 actual server port boolean actual secure remote addr host tracker valve secure assert equals forwarded proto null false actual secure boolean actual post invoke secure request secure assert equals post invoke secure false actual post invoke secure int actual post invoke server port request get server port assert equals post invoke server port 8080 actual post invoke server port string actual post invoke scheme request get scheme assert equals post invoke scheme http actual post invoke scheme public void test invoke xforwarded proto says http incoming https request throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol request get coyote request get mime headers add value forwarded proto set string http request set secure true request set server port 8443 request get coyote request scheme set string https test remote ip valve invoke request null verify client ip string actual xforwarded request get header forwarded assert null intermediate non trusted proxy forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null intermediate trusted proxy actual xforwarded string actual remote addr remote addr host tracker valve get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host remote addr host tracker valve get remote host assert equals remote host 140 211 11 130 actual remote host string actual post invoke remote addr request get remote addr assert equals post invoke remote addr 192 168 10 actual post invoke remote addr string actual post invoke remote host request get remote host assert equals post invoke remote addr 192 168 10 actual post invoke remote host protocol string actual scheme remote addr host tracker valve get scheme assert equals forwarded proto says http http actual scheme int actual server port remote addr host tracker valve get server port assert equals forwarded proto says http 80 actual server port boolean actual secure remote addr host tracker valve secure assert equals forwarded proto says http false actual secure boolean actual post invoke secure request secure assert equals post invoke secure true actual post invoke secure int actual post invoke server port request get server port assert equals post invoke server port 8443 actual post invoke server port string actual post invoke scheme request get scheme assert equals post invoke scheme https actual post invoke scheme public void test invoke xforwarded proto null incoming https request throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol don declare forwarded proto request set secure true request set server port 8443 request get coyote request scheme set string https test remote ip valve invoke request null verify client ip string actual xforwarded request get header forwarded assert null intermediate non trusted proxy forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null intermediate trusted proxy actual xforwarded string actual remote addr remote addr host tracker valve get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host remote addr host tracker valve get remote host assert equals remote host 140 211 11 130 actual remote host string actual post invoke remote addr request get remote addr assert equals post invoke remote addr 192 168 10 actual post invoke remote addr string actual post invoke remote host request get remote host assert equals post invoke remote addr 192 168 10 actual post invoke remote host protocol string actual scheme remote addr host tracker valve get scheme assert equals forwarded proto null https actual scheme int actual server port remote addr host tracker valve get server port assert equals forwarded proto null 8443 actual server port boolean actual secure remote addr host tracker valve secure assert equals forwarded proto null true actual secure boolean actual post invoke secure request secure assert equals post invoke secure true actual post invoke secure int actual post invoke server port request get server port assert equals post invoke server port 8443 actual post invoke server port string actual post invoke scheme request get scheme assert equals post invoke scheme https actual post invoke scheme http https server port code request secure code scheme presented proxy load balancer via request header quot forwarded proto quot attribute name http server port required false value returned code servlet request get server port code when strong protocol header strong indicates code http code protocol specified default code 80 code used attribute attribute name https server port required false value returned code servlet request get server port code when strong protocol header strong indicates code https code protocol specified default code 443 code used attribute
td http server port td td value returned link servlet request get server port when code protocol header code indicates code http code protocol td td td td integer td td 80 td tr tr td https server port td td value returned link servlet request get server port when code protocol header code indicates code https code protocol td td td td integer td td 443 td tr	protected static final string http server port parameter http server port	see set http server port int private int http server port 80	protocol header value null don modify secure scheme server port attributes request else protocol header https value equals ignore case protocol header value else request set secure false request set scheme http request set server port http server port	filter config get init parameter http server port parameter null try set http server port integer parse int filter config get init parameter http server port parameter catch number format exception throw new number format exception illegal http server port parameter get message throw new number format exception illegal https server port parameter get message server port value link protocol header indicates http link protocol header null has value different link protocol header https value default value 80 public void set http server port int http server port http server port http server port http https server port code request secure code scheme presented proxy load balancer via request header quot forwarded proto quot attribute name http server port required false value returned code servlet request get server port code when strong protocol header strong indicates code http code protocol specified default code 80 code used attribute attribute name https server port required false value returned code servlet request get server port code when strong protocol header strong indicates code https code protocol specified default code 443 code used attribute
return urldecode bytes enc false
user null return new generic principal user username user password get roles context user return null
always overrides anything app might set else headers get value server null app didn set header use default	always overrides anything app might set else headers get value server null app didn set header use default	always overrides anything app might set else headers get value server null app didn set header use default overrides server header http response set value attribute overrides tomcat default any server header set web application set any value specified application used application does specify value code apache coyote code used unless you paranoid you won need feature
private final class cleaner extends thread override public void run jvm us being shutdown make sure all loggers all class loaders shutdown class loader log info cl log info class loader loggers values logger logger cl log info loggers values reset logger logger private void reset logger logger logger handler handlers logger get handlers handler handler handlers logger remove handler handler try handler close catch exception ignore constructors public class loader log manager super try runtime get runtime add shutdown hook new cleaner catch illegal state exception ise we probably already being shutdown ignore error	public static void release suppress warnings unused class loader class loader juli log manager looks current class loader log manager get log manager reset
sm get string context config jndi url dir context conn url
public suppress warnings unchecked class get property type	can use class because api needs match public object get context suppress warnings unchecked class key can use class because api needs match public void put context suppress warnings unchecked class key object context object throws null pointer exception	can use iterator feature descriptor because api needs match public suppress warnings unchecked iterator get feature descriptors elcontext context object base	suppress warnings unchecked clear jdbc driver returns list string	suppress warnings unchecked resource entries hash map string resource entry	suppress warnings deprecation thread stop	suppress warnings unchecked checked above suppress warnings unchecked checked above	can use class because api needs match superclass public object get context suppress warnings unchecked class key	can use class because api needs match superclass public void put context suppress warnings unchecked class key object context object	interface el parser node uses raw types auto generated public object invoke evaluation context ctx suppress warnings unchecked class param types interface el parser node uses raw types auto generated public method info get method info evaluation context ctx suppress warnings unchecked class param types	interface el parser node uses raw types auto generated public method info get method info evaluation context ctx suppress warnings unchecked class param types	interface el parser node uses raw type auto generated public object invoke evaluation context ctx suppress warnings unchecked class param types	interface el parser node uses raw types auto generated public object invoke evaluation context ctx suppress warnings unchecked class param types interface el parser node uses raw type auto generated suppress warnings unchecked class param types throws elexception	protected array list naming entry list file file array list naming entry entries super list file
public void test parser function bug 48112 assert equals world evaluate expression fn trim world	ctx set function mapper new fmapper public static class fmapper extends function mapper override public method resolve function string prefix string local name trim equals local name method try get class get method trim string class return catch security exception ignore catch method exception ignore return null public static string trim string input return input trim
object address obj get property address string builder sb new string builder domain sb append type sb append type sb append port sb append get port address obj null string address address obj string address length sb append address sb append object name quote address object name oname new object name sb string	object address obj utils get property connector address sb append port sb append port address obj null string address address obj string address length sb append address sb append object name quote address
private static final string powered servlet jsp server info get server info java system get property java vm vendor system get property java runtime version	response add header powered powered
private static final string service resource name meta inf services javax el expression factory private static final string sep system get property file separator private static final string property file system get property java home jre sep lib sep el properties private static final string property name javax el expression factory	create new link expression factory class use determined following search order ol li services api meta inf services javax el expression factory li li jre home lib el properties key javax el expression factory li li javax el expression factory li li platform default org apache el expression factory impl li ol return create new link expression factory passing provided link properties search order same link new instance param properties return string class name null expression factory result null class loader tccl thread current thread get context class loader first services api class name get class name services tccl class name null second el properties file class name get class name jre dir class name null third system property class name get class name sys prop class name null fourth default class name org apache el expression factory impl try class clazz null tccl null clazz class name class name else clazz tccl load class class name constructor constructor null do we need look constructor take properties properties null try constructor clazz get constructor properties class catch security exception se throw new elexception se catch method exception nsme can ignored ok constructor exist constructor null result expression factory clazz new instance else result expression factory constructor new instance properties catch class found exception throw new elexception unable find expression factory type class name catch exception throw new elexception unable create expression factory type class name catch illegal access exception throw new elexception unable create expression factory type class name catch illegal argument exception throw new elexception unable create expression factory type class name catch invocation target exception throw new elexception unable create expression factory type class name return result private static string get class name services class loader tccl input stream null tccl null class loader get system resource stream service resource name else tccl get resource stream service resource name null string line null try buffered reader br new buffered reader new input stream reader utf line br read line line null line trim length return line trim catch unsupported encoding exception should never happen utf does ignore return null catch ioexception throw new elexception failed read service resource name finally try close catch ioexception ioe ignore return null private static string get class name jre dir file file new file property file file can read input stream null try new file input stream file properties props new properties props load string value props get property property name value null value trim length return value trim catch file found exception should happen ignore does catch ioexception throw new elexception failed read property file finally null try close catch ioexception ignore return null private static final string get class name sys prop string value system get property property name value null value trim length return value trim	private expression factory expression factory expression factory new instance	private static final expression factory expression factory expression factory new instance	expression factory coerce type attrs get value expected class
long time now system current time millis int time idle int time now session get accessed time 1000l time idle session get max inactive interval	remove keys stderr timeout time milliseconds wait reading std err complete before terminating cgi process 2000
private string parameter encoding system get property file encoding utf time milliseconds wait reading std err complete before terminating cgi process private long stderr timeout 2000	get servlet config get init parameter stderr timeout null stderr timeout long parse long get servlet config get init parameter stderr timeout	thread err reader thread null	err reader thread new thread err reader thread start	make sure error stream reader has finished err reader thread null try err reader thread join stderr timeout catch interrupted exception log interupted waiting stderr reader thread
form hostname contextpath file name contextpath empty otherwise form hostname file name int start context instanceof proxy dir context equals proxy dir context context get context name start file index else start file index file index
protected final lock diff lock new reentrant read write lock write lock	final reentrant read write lock lock new reentrant read write lock true final reentrant read write lock out lock new reentrant read write lock true	private final reentrant lock locks new reentrant lock lock count
sessions currently being swapped associated locks private map string object session swap locks new hash map string object	object swap lock null purpose sync locks make sure session only loaded once doesn matter lock removed another thread enters method trues load same session thread re creates swap lock session quickly find session already sessions use carry synchronized session session null synchronized swap lock first check see another thread has loaded session manager session sessions get id session null make sure lock removed synchronized
code 192 168 16 code configure code remote ipinternal proxy code code remote iptrusted proxy code jvm doesn have href http apr apache org docs apr group apr network io html apr ipsubnet test we rely regular expressions	protected static final string protocol header https value parameter protocol header https value	private string protocol header https value https	protocol header value null protocol header https value equals ignore case protocol header value	public string get protocol header https value return protocol header https value	filter config get init parameter protocol header https value parameter null set protocol header https value filter config get init parameter protocol header https value parameter	case insensitive value protocol header indicate incoming http request uses https default value code https code public void set protocol header https value string protocol header https value protocol header https value protocol header https value
private static final map sslsession integer key size cache new weak hash map sslsession integer	integer key size null synchronized key size cache key size key size cache get session	synchronized key size cache key size cache put session key size
throws ioexception forward login page fails call link http servlet response send error int string throws link ioexception http servlet response response login config config throws ioexception string msg sm get string form forward login fail log warn msg request set attribute globals exception attr response send error http servlet response sc internal server error msg	throws ioexception forward error page fails call link http servlet response send error int string throws link ioexception http servlet response response login config config throws ioexception string msg sm get string form forward error fail log warn msg request set attribute globals exception attr response send error http servlet response sc internal server error msg
return java util arrays list clients values array new client
private static final log log log factory get log request base class	jsonobject msg data null	override	override
names returned only those attributes set via li link globals dispatcher type attr li li link globals dispatcher request path attr li li link globals async supported attr li li link globals certificates attr ssl connections only li li link globals cipher suite attr ssl connections only li li link globals key size attr ssl connections only li li link globals ssl session id attr ssl connections only li li link globals ssl session mgr attr ssl connections only li	return event	return true requested session id obtained from ssl session
value null exclude keys
iterator iter1 list key iterator iter1 has next	suppress warnings unchecked map correct type already final hash map member impl mbr entry tmpclone hash map member impl mbr entry map clone clone map tmpclone	return true member new cluster false otherwise br false member local member updated	return collections empty map	suppress warnings unchecked overridden method uses raw type class
initialized try init catch exception ex throw new lifecycle exception error ex
compare two objects after coercing same type appropriate objects identical equal according link equals object object return either object big decimal coerce both big decimal first similarly double float big integer long integer char short byte otherwise check first object instance comparable compare against second object null return otherwise return result comparing against second object similarly second object comparable first null return else return result comparing against first object null object considered ul li zero when compared numbers li li empty string string compares li li otherwise null considered lower than anything else li ul param obj0 first object param obj1 second object return object less than equal greater than val throws elexception neither object comparable throws class cast exception objects mutually comparable	obj0 instanceof comparable suppress warnings unchecked final comparable object comparable comparable object obj0 return obj1 null comparable compare obj1 obj1 instanceof comparable suppress warnings unchecked final comparable object comparable comparable object obj1 return obj0 null comparable compare obj0 compare two objects equality after coercing same type appropriate objects identical including both null return true either object null return false either object boolean coerce both boolean check equality similarly enum string big decimal double float long integer short byte character otherwise default using object equals param obj0 first object param obj1 second object return true objects equal throws elexception	return enum obj convert object boolean null empty string false param obj object convert return boolean value object throws illegal argument exception object boolean string	coerce object string return string value object else obj instanceof enum return enum obj name	check array contains any code null entries param obj array checked return true array contains code null	private void compare both string msg int expected object o1 object o2 int i1 elsupport compare o1 o2 int i2 elsupport compare o2 o1 assert equals msg expected i1 assert equals msg expected i2 public void test el support compare compare both nulls should compare equal null null compare both null should compare equal null compare both null should less than file null new file compare both null should less than date null new date compare both date should less than date new date new date try compare both should compare new date new file fail expecting class cast exception catch class cast exception expected expected assert true null null
suppress warnings unchecked can use class because api needs match super class	suppress warnings unchecked can use class because api needs match super class	suppress warnings unchecked can use class because api needs match super class	suppress warnings unchecked can use class because api needs match super class
suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type	suppress warnings unchecked do privileged returns correct type
case async filter map get dispatcher mapping filter map async return true break	public static final int async 16	representing state when filters should applied	else dispatcher equals dispatcher type async name apply error global dispatcher mapping dispatcher mapping async
group null item get group null results add item get name	else source instanceof class
suppress warnings unchecked can use class because api needs match	suppress warnings unchecked can use class because api needs match	public class get property type	suppress warnings unchecked can use class because api needs match	suppress warnings unchecked can use class because api needs match	suppress warnings unchecked can use iterator feature descriptor because api needs match	suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match
type instanceof simple type	type instanceof simple type	set object instance set bean server query mbeans object name null	suppress warnings unchecked sessions type map string session	list delta session sessions cross context sessions get sessions null sessions size iterator delta session iter sessions iterator iter has next	list delta session sessions cross context sessions get sessions null sessions size iterator delta session iter sessions iterator	suppress warnings unchecked map members has correct type	iterator map entry super entry set iterator map entry next	array list list array list msg get value	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry entry set iterator map entry entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	iterator map entry super entry set iterator map entry next	suppress warnings unchecked bio senders type hash map member bio sender
taglibs new hash map string string	else event get type equals lifecycle stop event taglib uris clear listeners clear
int char value hex utils get dec value value	int char value hex utils get dec value value	int char value hex utils get dec value value	int char value hex utils get dec value value	int char value hex utils get dec value value	hex utils get dec buf pos result hex utils get dec buf pos	chunk length pos hex utils get hex digit	private static final int dec	private static final byte hex	public static int get dec int index return dec index public static byte get hex int index return hex index	buf end hex utils get hex digit	buf end hex utils get hex digit
protected volatile boolean do run true	protected volatile boolean run false	protected volatile boolean running true	protected volatile boolean do run sender false protected volatile boolean do run receiver false	static volatile boolean running false
protected volatile boolean run true
context entry value destroy subcontext name get suffix
public void set domain string domain domain null return domain starts set domain org apache catalina tribes util arrays from string domain set domain org apache catalina tribes util arrays convert domain	public void set domain string domain domain null return domain starts set domain arrays from string domain else set domain arrays convert domain
else false equals value webxml set metadata complete false
naming resources add property change listener	process property change events	process property change naming resources making
random null try random close catch ioexception ioe log warn failed close random random null
return set property name value true public static boolean set property object string name string value boolean invoke set property	return utils set property name value false
return logger container
private atomic integer jsp reload count	class loader loader thread current thread get context class loader loader null loader get class get class loader loader null loader string parent class loader loader classpath init class path code source null permission collection null security holder holder init security code source holder cs permission collection holder pc else code source null permission collection null	private final servlet context context private final options options private final class loader parent class loader private final permission collection permission collection private final code source code source private final string classpath private volatile long last check 1l	public void increment jsp reload count jsp reload count increment get	public void set jsp reload count int count jsp reload count set count	return jsp reload count int value	private string init class path	string path cpath string cp log debug compilation classpath initialized path return path helper class allow init security return two items private static class security holder private final code source cs private final permission collection pc private security holder code source cs permission collection pc cs cs pc pc private security holder init security code source source null permission collection permissions null	source new code source url certificate null permissions policy get permissions source permissions add permissions add permissions add new file permission doc base read	permissions add permissions add new file permission permissions add new runtime permission	permissions add permissions add permissions add return new security holder source permissions
private static final org apache juli logging log log private static final byte start data 70 76 84 50 48 48 50 private static final byte end data 84 76 70 50 48 48 51	converts byte array entry boolean param byte array param offset within byte array return true byte array entry non zero false otherwise	private static atomic integer invokecount new atomic integer
-1
private static final org apache juli logging log log org apache juli logging log factory get log abstract class	override	override	private static final org apache juli logging log log	private static final org apache juli logging log log	override	override
private static final string default mime mappings	private static final byte start data new byte 113 58 34 60 75 78 101 12 32 29 32 111 40 private static final byte end data new byte 54 13 90 110 47 31 75 24 81 29 36 52 58 77 110 56	private static final int dec
public static final int default pool size 100 1024 1024 100mb	public static final int tab width public static final string spaces	public static final hashtable string string default map
private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	protected static final org apache juli logging log log	public static final org apache juli logging log log org apache juli logging log factory get log cluster listener class	public static final org apache juli logging log log org apache juli logging log factory get log replicated context class	public static final org apache juli logging log log org apache juli logging log factory	public static final org apache juli logging log log org apache juli logging log factory	public static final org apache juli logging log log org apache juli logging log factory	public static final org apache juli logging log log org apache juli logging log factory get log backup manager class	public static final org apache juli logging log log org apache juli logging log factory get log delta manager class	public static final org apache juli logging log log	public static final org apache juli logging log log org apache juli logging log factory get log delta session class	public static final org apache juli logging log log org apache juli logging log factory	protected static final org apache juli logging log log	public static final org apache juli logging log log org apache juli logging log factory get log simple tcp replication manager class	private static final org apache juli logging log log	protected static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	protected static final org apache juli logging log log	private static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	protected static final org apache juli logging log log org apache juli logging log factory get log	protected static final org apache juli logging log log org apache juli logging log factory get log heartbeat thread class	protected static final org apache juli logging log log org apache juli logging log factory get log rpc channel class	private static final org apache juli logging log log org apache juli logging log factory get log interceptor class	protected static final org apache juli logging log log org apache juli logging log factory get log message dispatch interceptor class	private static final org apache juli logging log log org apache juli logging log factory get log tcp failure detector class	protected static final org apache juli logging log log	protected static final org apache juli logging log log org apache juli logging log factory get log throughput interceptor class	private static final org apache juli logging log log org apache juli logging log factory get log two phase commit interceptor class	protected static final org apache juli logging log log org apache juli logging log factory get log object reader class	public static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	protected static final org apache juli logging log log org apache juli logging log factory get log lazy replicated map class	protected static final org apache juli logging log log org apache juli logging log factory get log replicated map class	protected static final org apache juli logging log log org apache juli logging log factory get log bio receiver class	protected static final org apache juli logging log log org apache juli logging log factory get log bio replication task class	private static final org apache juli logging log log org apache juli logging log factory get log bio sender class	private static final org apache juli logging log log org apache juli logging log factory get log fast queue class	protected static final org apache juli logging log log org apache juli logging log factory get log nio receiver class	private static final org apache juli logging log log org apache juli logging log factory get log nio replication task class	protected static final org apache juli logging log log org apache juli logging log factory get log nio sender class	protected static final org apache juli logging log log org apache juli logging log factory get log parallel nio sender class	public static final log messages log factory get log org apache catalina tribes messages	private static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected static final org apache juli logging log log	protected final org apache juli logging log log	private final org apache juli logging log log	private static final org apache juli logging log log	private final org apache juli logging log log	private final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log logger	private static final org apache juli logging log logger	static final org apache juli logging log logger	static final org apache juli logging log log	private static final org apache juli logging log log	private static final org apache juli logging log logger	private static final org apache juli logging log log
static public final string apr anyaddr
public static final channel data empty data array new channel data
licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
contains	uses return headers client	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	throws java io ioexception error occurred while writing	method kept backwards reasons newly	page case where one tag invokes another can	throws javax servlet jsp jsp exception thrown error occurred	when being passed tag library validator instance	stream encoded utf recall xml view	additional constraint can exploited	tag library imported more than once bound different prefixes	jsp container responsible locating appropriate	additional constraint can exploited
action id usable switches table indexes	main interface implemented coyote connector adapter main interface implemented coyote servlet container	time request useful avoid repeated calls system current time	get instance id jvm route currently ajp sending each negotiated config time so both tomcat apache share same name	currently used only jmx artifact aggregate data	about requests being processed	useful long running requests only	called explicitly user set content language	param charset string containing name character encoding	hardcoded byte marshaling overhead	adapter which process requests received endpoint	hardcoded byte marshaling overhead	adapter which process requests received endpoint	content delimiter request false connection	minimum content size make compression	add mime type which compressible	set compressible mime type list method best when used	check content already gzipped	force mode always compress test purposes only	check sufficient length trigger compression	throws ioexception underlying error occurred	throws ioexception underlying error occurred	throws ioexception underlying error occurred	throws ioexception underlying error occurred	method write contents specified message bytes	method write contents specified message bytes	method write contents specified char	method write contents specified byte	method write contents specified string	content delimiter request false connection	minimum content size make compression	add mime type which compressible	set compressible mime type list method best when used	set compressible mime type list	acknowledge request	default what socket tells us overridden host	check content already gzipped	force mode always compress test purposes only	check sufficient length trigger compression	acknowledge request	default what socket tells us overridden host	acknowledge request	default what socket tells us overridden host	throws ioexception underlying error occurred	read operations given buffer big enough accommodate	fill internal buffer using data from underlying input stream	throws ioexception underlying error occurred	throws ioexception underlying error occurred	send	throws ioexception underlying error occurred	throws ioexception underlying error occurred	method write contents specified message bytes	method write contents specified message bytes	method write contents specified char	method write contents specified byte	method write contents specified string	read operations given buffer big enough accommodate	read operations given buffer big enough accommodate	fill true false request line parsing	throws ioexception underlying error occurred	throws ioexception underlying error occurred	send	throws ioexception underlying error occurred	send	throws ioexception underlying error occurred	set associated request	our base null we know more properties evaluate	following token therefore first error token
default urls download plugin netscape ie	generation smap info jsr45 debugging suppressed	background jsp compile thread check interval	generation smap info jsr45 debugging suppressed	convenient catch just top level	generation smap info jsr45 debugging suppressed	obtain jsp information specified web xml	acceptable candidate uri root	strip base slash since combined	root directory separator char	derived package name directly mirrors file hierarchy jsp page	tag library exposed either explicitly web xml implicitly via uri tag tld	obtain jsp information specified web xml	collect info about page nodes make them available through	has dependencies check also extended its dependents so method can overridden subclasses compiler	instead global mapper mapper used each call el	generation static initializers preamble example dependent	check bean already	initialize local variables used method	int src line relative starting source line	short name encoded make resultant string valid java		obtain link jar scanner associated specified link	url patterns following	flag set delay incrementing tag dependent nesting until jsp body	gets unique identifier which index array source	set null just convenience maybe used	dependent upon dependent file changes jsp page	application context	process destroy event web application context	replacement binary name would work	internal data jsp page jsp document xml also included here visitor class traversing nodes	page dom	mandatory attribute name checked validator	position source line relative line	auxiliary classes used node	perform checks after nodes visited	url jar containing tag file	dependency exists circularly dependent tag	add dependents tag file its parent dependent list only reliable dependency information	assumed have been processed encapsulated tag file info	return tag info tag file directives	following directives ignored text	constructor	some page global value those from page directives stored	bodycontent simple tag cannot jsp	string literal must castable what declared type	interface allows plugin author make inquiries about	used declare inner class method class variable	generate codes evaluate value attribute custom tag	deemed too complicated optimization	method throw ioexception buffer has already been	param request servlet request we processing	when compiling tag files circular dependencies prototype	assign appropriate value charset	constructors provided easily create wrappers	error signaling error next block read we	invocation when read method invoked uses	throws ioexception error	easier grep logs only exception stacktraces which always preceded whitespace make simple skip them	also possible user modified jre lib logging properties	bad design committee can really bad impact performance	should ensure though ordering behaves	note just wrapper around jdk logging like	example running following ant scriptlet	specified object class has overridden string method
type instance variable used avoid using rtti when doing	returns catalina component name	returns jndi component name	param auth resource	param auth resource	create new ejb instance	create new ejb instance using open ejb	create new resource env instance	object factory user transactions	create new user transaction instance	return enumeration search results objects satisfy	connect dir context retrieve bound object well	return enumeration search results objects satisfy	return vector containing naming entry objects	retrieving object	encapsulates contents resource	find map element given its name sorted array map elements	return enumeration search results objects satisfy
param buf containing bytes write	return string up len bytes read	param perm permissions new directory	param perm permissions new directory	write data from array byte arrays specified file	write data from array byte arrays specified file	return read character	function should used preference explicit manipulation	param file file retrieve flags	number instances unlimited	get name system default character set	data can retrieved system	public static final int apr pollnval 0x040 descriptor invalid	descriptor signaled apr pollset poll	param descriptors array signaled descriptors output parameter descriptor array must two times size pollset return number signaled descriptors output parameter	param descriptors array signaled descriptors output parameter descriptor array must size pollset return number signaled descriptors output parameter	descriptor array must two times size pollset	object attached pool globally referenced until pool cleared data set called null data	restart occurring perform any necessary cleanup including	health check occurring most maintenance functions	allocate apr proc structure from pool	hardware accelerator card crypto operations	close bio dereference callback object	param file file containing dh params	associate biocallback input output data capture warn warning messages	reconfigured cipher suite after http request	encrypted password prompt displayed	established per directory context forces ssl	create make accessible shared memory segment all platforms support anonymous shared memory segments some cases preferred over other types shared memory	elapses data read written	private method getting socket struct members param socket socket use	return structure member address	number milliseconds per microsecond	number microseconds since 00 00 00 january 1970 utc	return apr success apr uid structures identify same user	return apr success apr gid structures identify same group	get trimmed text content node null text	param parent lookup direct children	check overridden	uses standard jdk mechanism reader provides mechanisms	overridden do nothing reset internal state	input interface used when buffer empty	set buffer grow indefinitely	you can also call explicitly force data written	safer use classical new string	uses standard jdk mechanism writer provides mechanisms	special writer class where close overridden default would set byte outputter null writer can recycled	stream flush close overridden	overridden do nothing reset internal state	utilities manipulate char chunks while string designed immutable secure objects	grow indefinitely	set buffer grow indefinitely	while waiting lock just return string value	utility function re encode url	create new entry	each next element comparison less frequent than add	we always string unique	namespace uri associate subsequent code rule code	zero single argument from body element you wish use primitive type specify	zero single argument from body element you wish use primitive type specify	zero single argument from body element you wish use primitive type specify	zero single argument from body element you wish use primitive type specify	properties only affect saxparser empty constructor	set public id current file being parse	you wish use primitive type specify	you wish use primitive type specify	you wish use primitive type specify	you wish use primitive type specify	needed before object can created common scenario	create code saxparser code configured support xml schema dtd	only xml content under element rule triggered li	class implements interface	order were originally registered	you wish use primitive type specify	you wish use primitive type specify	introspect relevant objects so right method can called	constructor allows attribute property mapping overridden	property name indicates attribute should ignored	have writable property specified name	you wish use primitive type specify	you wish use primitive type specify	introspect relevant objects so right method can called	you wish use primitive type specify	you wish use primitive type specify	introspect relevant objects so right method can called	sets digester using rules	useful methods content type processing	register new initialized cookie cookies recycled	last quote must dealt	get token returns position delimiter	given starting position after initial quote character gets	input headers possible use message byte fields so gc	each next element comparison less frequent than add	storing contents file	close delimiter boundary br	index last valid character buffer	we prepend cr lf boundary chop trailing cr lf from	read boundary succeeded stream contains	find map element given its name sorted array map elements	find map element given its name sorted array map elements	find map element given its name sorted array map elements	find map element given its name sorted array map elements	attribute writable management applications	some gratuitous flexibility removed instead more predictive	supported li	list managed beans keyed class name	method should used explicitly load metadata same package	param get att map readable attributes map	use sendfile sending static files	exit otherwise parallel destruction sockets which still	62 recompiling apr necessary remove limitation	exit otherwise parallel destruction sockets which still	param data containing reference data which should sent	close socket response would incomplete	close socket response would incomplete	plain old server sockets	invocations both read write separate threads	reg key ka avoid multiple calls gets reregistered after invocation	note preferred mechanism	gets initialized trust managers
sets maximum age param max age maximum age set	param class loader name class loader set	process event using security manager option enabled param event event process	param event	param event event	param event event	param domain replication flag value	public delta session null	param msg	write html xml header param writer print writer use param mode html header xml declaration	param nonce unique supposedly unique token which has been used param realm name realm name string nonce string nc string cnonce string qop	user realm authenticate username client digest nonce	param nonce unique supposedly unique token which has been used param realm name realm name string nonce string nc string cnonce string qop	nonce nc cnonce qop realm name md5a2	enables disables redirection param redirect streams new redirection value	param text body text element	param text body text element	param payload tba	sets message options param options message options	param xbuf byte	param count whether return count return number messages sent callback count false	param class loaders class loader array used instantiate objects	param cdata message data contained within package	converts boolean byte array param bool integer return byte array	return serialized content byte array	param local loopback disabled disable loopback mode	throws ioexception	number milliseconds since member	param alive time number milliseconds since member created	param local has name local member used filter local member from cluster membership param include local tba	param msg message param destination tba	throws ioexception	param readonly new status	param remote ip header	comma delimited list proxies trusted when appear link remote ip header header can expressed	param socket wrapper socket from which http requests read	param jar file url jar file from which read included resource	param path	param name path desired resource	param fs fileset converted	throws build exception error occurs during execution	param name local name parser namespace aware just	param name local name parser namespace aware just	invalidate ssl session
noop	return new standard context	param base dir base dir context static files must exist	static version link add servlet string string string	static version link add servlet string string servlet	see add user string string	get host add child ctx else host add child ctx string url string path	get host add child ctx else host add child ctx	static version link init webapp defaults string
cluster manager cluster	note response object dependent output stream writer still	request servlet should perform any needed cleanup had received	asynchronous io receiving events when data available reading	remove tag library location specified tag library uri	return true namespace awareness enabled	return true namespace awareness enabled	host child webapps should discovered	host child webapps should discovered	return true namespace awareness enabled	valve pipeline any prior setting basic valve	exception illegal argument exception specified valve refuses	always sent log default output sent only	prevent we attempt reuse previously	priorities output stream	priorities output stream flushes stream	check correct lb worker parameter	property manager lenght show size result manager length name	em true em you can save all attributes from all found objects	get mbean attribute from mbean server	option you delimit your result delimiter	so can omitted environments do require	we signaled after successful	browser isn expecting conditional response now	web application propagated other web applications same	server port which we should pretend requests connector	look ssl session id required only look ssl session id	which would permanently disable us	coyote buffered reader	coyote mostly processor	preferred locales associated request	param uriconverter new uri converter	error valve pick exception up display user	error valve pick exception up display user	set set cookies received request	identify realm we use checking role assignments	place so performance won suffer non secure case	place so performance won suffer non secure case	param charset string containing name character encoding	from append cookie value invocation	handler have done	li canceling first dialog box trying	one web application propagated other web applications	send muticast message using format	send muticast message using format	modification from watch dir war detected	war remove from watch dir	number last message processed message ids based	check modification send notification listener	set maximum number active sessions allowed limit	fixme replace currently sessions same id without notification	expire all find sessions	request executed actions translate invocations methods	last time session replicated used distributed expiring	nodes after all session stickiness work directly	get name failed request session attribute	handle jvm route stickiness after tomcat instance failed after session id change propagate other cluster nodes	fixme set id trigger session listener only chance register manager correct id	now sending change all other clusternodes	set original sessionid request allow application detect	return event type string useful debugging	reset active statistics	param request current request after response generated	emit failure event lifecylce listener received message	code url code referring code null code resource	validate classname per srv we must restrict loading	param path context path application undeployed	limited number message format can process maximum 10	can null think	param idle expire all sessions idle time gt idle context	limited number message format can process maximum 10	jsf check browser meta tag accept languages choose what language display	cannot use side effects removed added back each time	cannot use side effects removed added back each time	cannot use side effects removed added back each time	param context name mbean name component remove	param name mbean name component remove	param name mbean name component remove	param name mbean name component remove	param name mbean name component remove	param name mbean name component remove	semicolon separated list paths containing mbean descriptor resources	create mbean connector itself	column user table holds user credentials	param qop quality protection applied message	quality protection applied message	link text input callback used pass various additional	catalina base system property absolute pathname	code null code validation failed	return code true code all cases because	realm users via em java	li realm iterates over code principals code returned	param qop quality protection applied message	column user table holds user credentials	number tries number attempts connect database needs rewritten better pooling support existing code	number tries number attempts connect database needs rewritten better pooling support existing code	number tries number attempts connect database	occasionally directory context timeout try one more	associated user storage mechanisms achieves recording all failed	should overridden jaasrealm avoid pretty inefficient conversions	param target type code class code array used instantiate	param target type code class code array used instantiate	param target type code class code array used instantiate	param target type code class code array used instantiate	param target type code class code array used instantiate	metavariable values according cgi	supplied script precisely supplied client	script relies heavily servlet api methods find cgi invocation	passed constructor	parameters strings	param path path which has rewritten	propfind helper method displays properties lock null resource	one collides http 207 partial update ok	one collides http	one collides http	http status code	return code connection code connection succeeded	persistence even only restarts	set maximum number active sessions allowed	set maximum number active sessions allowed	similar strategy eq above except similar strategy eq above except	we try mimic apache here we do everywhere	cut off file name	commands used mimic apache behavior set invalid	registering code membership listener code br	send options byte message message pure byte message marshaling unmarshaling	processed above application just received forgot about feature required	heartbeat invocation resources cleanup etc	return listen port member its listening insecure port	title represents globally unique id	first interceptor interceptor stack	sleep between invocations code channel heartbeat code	except uses atomic long current size calculation	return number messages sent callback	some platforms linux possible bind	op senders created upon demands	send reply	after successful sending update stats warning subclasses must very careful only one thread call push message once	wait from other server fixme please wait only three characters better control wait ack message correct	length when you have strange producer thread problems	limit queue length default unlimited	we have written everything we starting new package	timeout has occurred	clean up any canceled keys	relative absolute pathname file which we write	encodes hex octets base64	decodes base64 data octets	us locale all http dates english	ensures all extension dependencies resolved web application application validates those extensions	runtime validation web application	find manifest web application	method should also provide static validation web application	check application itself extension	param buf char array use buffer	convenience method check code manifest resource code	param map map whose contents duplicated new map	convert byte character value hexadecimal digit value	digester instance which class entity resolver	all remote dtds schema local destination	translate put seconds since epoch	translate put week year first sunday first day translate put week year first monday first day	performing conditional logging null every	encounter closing ignore	list current comet connections	track connection webapp reload
private hashtable string qname port component ref null	class class class args iterator qname ports service get ports ports has next qname port name ports next	public void set port component ref hashtable string qname port component ref	class class class args qname portname port component ref get class get name	hashtable environment	hashtable string qname port component ref new hashtable string qname	class service interface class null	map string ports wsdlservice get ports iterator string ports key set iterator has next string port name next	class interfaces null class service interfaces service interface class get interfaces interfaces new class service interfaces length int service interfaces length interfaces service interfaces	array list string soaproles new array list string	class handler class null	array list qname headers new array list qname hashtable string string config new hashtable string string array list string port names new array list string	handlerref set headers headers array new qname headers size iterator string iter port names iterator init handler chain new qname iter next handler registry enumeration qname port component ref elements init handler chain next element handler registry	list element extensions port get elements iterator element extensions iterator has next element ext next	handler info handlerref array list string soaproles add	soaproles soaproles add get
called servlet propagated caller	servlet srv request response may have been wrapped	called servlet propagated caller	factory creation caching filters creation	prevent outside get instance method	return factory instance	convenience method which returns true dispatcher type	request cross context since changes session access	exception illegal argument exception specified valve refuses	valve pipeline any prior setting basic valve	return abbreviated name container logging messages	before mappings deployment descriptor must inserted	param doc base original document root	allow base dir specified explicitly	can overridden engine context host level	consistency we probably embedded mode	attribute value used turn off xml namespace awareness	host child webapps should discovered	return true namespace awareness enabled	return mbean names valves associated host	valve pipeline any prior setting basic valve	exception illegal argument exception specified valve refuses	unregister removed valve	fixme pero why container stop first keep alive connections can send request	backward compat nobody should bother load explicitly	service shouldn used embedded so doesn matter	create new facade around standard wrapper	some jmx statistics valve associated standard wrapper
deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated public void set status int sc string sm	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated	deprecated
matching pattern prefix default fragment setting	rule check code login config code occurring	rule check code jsp config code occurring	rule check code session config code occurring
attribute value used turn off tld namespace awareness	return true namespace awareness enabled
you wish use primitive type specify
removing security role	segments read
attribute value used turn off xml namespace awareness	return true namespace awareness enabled	set namespace aware feature xml parser used when	code false code application has been deployed does	entry point admin webapp other jmx context controllers	entry point admin webapp other jmx context controllers
return true redirection standard streams enabled	tomcat embedded application already defines those
project log wrong object reference ref id	version revision date	string remote host string user request get remote user string query request get request uri	pattern equals combined	sk cancel
bootstrap loader catalina application constructs class loader	stop standalone server	stop standalone server
li help display usage information li nonaming disable naming support li start start instance catalina li stop stop currently running instance catalina	nonaming help start stop
args args length start args args length stop
jsp allowed template text string value attrs get value page info deferred syntax allowed literal contains deferred syntax value err jsp error jsp error el template deferred attrs get uri attrs get local name value false	look sequence isn preceded private boolean contains deferred syntax string value value null return false int int len value length boolean prev char escape false while value length char value char len value char prev char escape return true else prev char escape true else prev char escape false return false	string literal must castable what declared type
name null name length return	name null name length value null return	name null name length return	name null name length return	name null name length value null return	name null name length return
empty code enumeration code none note attribute names return only those attributes set via link set attribute string object tomcat internal attributes included although accessible via link get attribute string tomcat internal attributes include ul li link globals dispatcher type attr li li link globals dispatcher request path attr li li link globals async supported attr li li link globals certificates attr ssl connections only li li link globals cipher suite attr ssl connections only li li link globals key size attr ssl connections only li li link globals ssl session id attr ssl connections only li li link globals ssl session mgr attr ssl connections only li ul underlying connector may also expose request attributes all have names starting org apache tomcat include ul li org apache tomcat sendfile support li li org apache tomcat comet support li li org apache tomcat comet timeout support li ul connector may return some all none attributes may also support additional attributes
chance resource only missing temporarily eg renamed during text editor save try thread sleep 500 catch interrupted exception e1 ignore recheck resource see really deleted resource exists continue
comment reader skip until else reader matches declaration reader skip until else reader matches expression reader skip until else reader matches scriptlet reader skip until
org apache catalina util tomcat css tomcat css	form margin form inline display inline	table cellspacing border	table cellspacing border	else command equals upload command equals deploy command equals reload command equals undeploy command equals expire command equals start command equals stop message sm get string manager servlet post command command	string path request get parameter path string deploy path request get parameter deploy path string deploy config request get parameter deploy config string deploy war request get parameter deploy war string message command null command length command list list always displayed do nothing else command equals upload message upload request else command equals deploy message deploy internal deploy config deploy path deploy war else command equals reload message reload path else command equals undeploy message undeploy path else command equals expire message expire sessions path request else command equals start message start path else command equals stop message stop path else try get do get request response return	nbsp small small nbsp form class inline method post action small input type submit value small form form class inline method post action small input type submit value small form form class inline method post action small input type submit value small form	form class inline method post action small input type submit value small form nbsp small small nbsp nbsp small small nbsp form class inline method post action small input type submit value small form nbsp small small nbsp form class inline method post action small input type submit value small form form class inline method post action small input type submit value small form nbsp small small nbsp form class inline method post action small input type submit value small form nbsp small small nbsp nbsp small small nbsp nbsp small small nbsp
what encoding use some platforms eg os use default encoding doesn give expected result so explicit string enc connector get uriencoding enc null enc iso 8859	try semicolon2 request set requested session id new string uri bc get buffer start session id start semicolon2 session id start enc extract session id from request uri byte buf uri bc get buffer int end start semicolon2 buf start semicolon buf start semicolon2 uri bc set bytes buf start end start semicolon2 semicolon else request set requested session id new string uri bc get buffer start session id start end start session id start enc uri bc set end start semicolon request set requested session url true catch unsupported encoding exception uee make sure session id returned request set requested session id null request set requested session url false log warn sm get string coyote adapter parse session enc uee
catch bind exception orig string msg msg orig get message null get port msg orig get message get address string get port bind exception new bind exception msg init cause orig throw
simple servlet test jndi	servlet tries obtain url web inf web xml public static class get resource extends http servlet private static final long serial version uid 1l public void do get http servlet request req http servlet response res throws ioexception url url req get servlet context get resource web inf web xml res get writer write url obtained web inf web xml url null res get writer write null else res get writer write url string	assert equals hello world res string	assert equals hello tomcat user res string test https issues apache org bugzilla show bug cgi id 47866 public void test get resource throws exception tomcat tomcat get tomcat instance must have real doc base just use temp standard context ctx tomcat add context system get property java io tmpdir you can customize context calling its api tomcat add servlet ctx my servlet new get resource ctx add servlet mapping my servlet tomcat start int rc get url http localhost get port new byte chunk null assert equals http servlet response sc ok rc
path get buffer path offset path end path offset
public int get max threads running executor null executor instanceof java util concurrent thread pool executor return java util concurrent thread pool executor executor get maximum pool size else executor instanceof resizable executor return resizable executor executor get max threads else return else return max threads	public int get max threads
protected static final int tcn required patch 17 protected static final int tcn recommended pv 17	cert length indicates error client cert null cert length	consume buffer request body so does interfere client handshake messages configure connection require certificate sslsocket set verify socket ssl ssl cverify require endpoint get sslverify depth renegotiate certificates sslsocket renegotiate socket don look certs unless we know worked get client certificate certificate chain present cert length indicates error int cert length sslsocket get info socket ssl ssl info client cert chain byte client cert sslsocket get info socket ssl ssl info client cert certs null client cert null cert length certs new cert length certificate factory cf certificate factory get instance 509 certs cf generate certificate new byte array input stream client cert int cert length byte data sslsocket get info socket ssl ssl info client cert chain certs cf generate certificate new byte array input stream data certs null request set attribute apr endpoint certificate key certs	usually step between headers	set type client certificate verification maximum depth ca certificates client certificate verification br used change verification level connection prior starting re negotiation br following levels available level pre ssl cverify none client certificate required all ssl cverify optional client may present valid certificate ssl cverify require client has present valid certificate ssl cverify optional ca client may present valid certificate need successfully verifiable pre br param sock socket change param level type client certificate verification public static native void set verify long sock int level int depth return ssl info parameter byte array	return ssl info parameter string	return ssl info parameter integer
controls loggers silenced param silent code true code sets log level warn loggers log information tomcat start up prevents usual startup information being logged code false code sets log level default level info public void set silent boolean silent silent logger get logger set level level warning else logger get logger set level level info
param context path context add servlet param servlet name servlet name used mappings param servlet class class used servlet return wrapper servlet public standard wrapper add servlet string context path string servlet name string servlet class container ctx get host find child context path return add servlet standard context ctx servlet name servlet class static version link add servlet string string string param ctx context add servlet param servlet name servlet name used mappings param servlet class class used servlet return wrapper servlet	add existing servlet context class name param context path context add servlet param servlet name servlet name used mappings param servlet servlet add return wrapper servlet public standard wrapper add servlet string context path string servlet name servlet servlet container ctx get host find child context path return add servlet standard context ctx servlet name servlet static version link add servlet string string servlet param ctx context add servlet param servlet name servlet name used mappings param servlet servlet add return wrapper servlet	param context path context set defaults public void init webapp defaults string context path container ctx get host find child context path init webapp defaults standard context ctx static version link init webapp defaults string param ctx context set defaults	fix startup sequence required you don use web xml start method context set configured false expects listener set back true	helper class wrapping existing servlets disables servlet
log debug expanded before repository
histo interval histo interval
welcome file processing take now we have looked welcome files physical backing now look extension mapping listed may have physical backing case index jsf index do etc watered down version rule mapping data wrapper null boolean check welcome files check jsp welcome files check welcome files char buf path get buffer check welcome files buf path end check welcome files int context welcome resources length mapping data wrapper null path set offset path offset path set end path end path append context welcome resources context welcome resources length path set offset servlet path internal map extension wrapper extension wrappers path mapping data path set offset servlet path path set end path end
protected static final string create statement create statement protected static final int create statement idx protected static final string prepare statement prepare statement protected static final int prepare statement idx protected static final string prepare call prepare call protected static final int prepare idx protected static final string statement types create statement prepare statement prepare call protected static final int statement type count statement types length protected static final string execute execute protected static final string execute query execute query protected static final string execute update execute update protected static final string execute batch execute batch protected static final string execute types execute execute query execute update execute batch	process statement method process	param method method called one methods defined link statement types	returns true method being invoked matches one statement types param method method being invoked proxy param process boolean result used recursion return returns true method name matched protected boolean statement method method boolean process return process statement types method process returns true method being invoked matches one execute types param method method being invoked proxy param process boolean result used recursion return returns true method name matched protected boolean execute method method boolean process return process execute types method process	new constructor abstract create statement interceptor statement type count	sql null compare execute batch name	sql null compare execute batch name	sql null compare execute batch name	compare create statement name constructor get constructor create statement idx statement class else compare prepare statement name constructor get constructor prepare statement idx prepared statement class else compare prepare call name constructor get constructor prepare idx callable statement class	process execute method process
driver reset	assert true size comparison less than 11 ds get pool get size 10
throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported	throws unsupported operation exception operation supported
override public void set up throws exception super set up override public void tear down throws exception super tear down	client set port get port	private static final long serial version uid 1l	private class extends simple http client private boolean init private synchronized void init throws exception init return tomcat tomcat get tomcat instance standard context root tomcat add context temp dir tomcat add servlet root bug37794 new root add servlet mapping test bug37794 tomcat start init true tomcat tomcat get tomcat instance init	private int port 8080	public void set port int port port port	socket new socket localhost port	tomcat tomcat get tomcat instance must have real doc base just use temp tomcat add context system get property java io tmpdir	byte chunk res get url http localhost get port tomcat tomcat get tomcat instance new file output build webapps examples byte chunk res get url http localhost get port examples servlets servlet hello world example tomcat tomcat get tomcat instance long t0 system current time millis tomcat add context null system err println test time system current time millis t0
temp dir new file base output tmp tomcat get host set app base temp dir get absolute path webapps	expand war delete temp dir
string target type get canonical name expected type
-1
executing code get next invoke code	code get next invoke code method has returned specified response after code get next invoke code method has
java util collection resource entry values hash map string resource entry resource entries clone values iterator resource entry loaded classes values iterator walk through all loaded class trigger any classes otherwise one class may call previously cleared class while loaded classes has next resource entry entry loaded classes next entry loaded class null class clazz entry loaded class try field fields clazz get declared fields int fields length modifier static fields get modifiers fields get null break catch throwable ignore loaded classes values iterator
manager null manager instanceof cluster manager get cluster null get cluster get manager cluster manager manager get name null manager instanceof persistent manager	get cluster null now sending change all other clusternode cluster manager manager cluster manager catalina session get manager send session idcluster backup manager request session id new session id	log info enabled cluster null log info sm get string jvm route cluster
msg null session set last time replicated system current time millis msg set timestamp session get last time replicated
protected transient volatile boolean expiring false	protected volatile boolean valid false	check see expire progress has previously been called expiring valid check again now we inside sync so code only runs once double check locking expiring valid need volatile expiring valid return mark session being expired
protected executor service executor executor factory new thread pool time unit seconds	executor executor factory new thread pool min threads max threads max idle time time unit milliseconds tf	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static class task queue extends linked blocking queue runnable thread pool executor parent null public task queue super public task queue int initial capacity super initial capacity public task queue collection extends runnable super public void set parent thread pool executor tp parent tp public boolean force runnable parent shutdown throw new rejected execution exception executor running can force command queue return super offer forces item onto queue used task rejected public boolean offer runnable we can do any checks parent null return super offer we maxed out threads simply queue object parent get pool size parent get maximum pool size return super offer we have idle threads just add queue so could use some tuning parent get active count parent get pool size return super offer we have less threads than maximum force creation new thread parent get pool size parent get maximum pool size return false we reached here we need add queue return super offer
realm name password roles user principal null construct new principal associated specified realm specified username password specified role names strings param realm realm owns principal param name username user represented principal param password credentials used authenticate user param roles list roles must strings possessed user param user principal principal returned from request get user principal call null null returned param login context provided used log out user appropriate time public generic principal realm realm string name string password list string roles principal user principal login context login context	login context login context	jaas login context any used authenticate principal kept so we can call logout protected login context login context null public login context get login context return login context	principal principal create principal username subject login context	param login context associated th princpal so link login context logout can called later protected principal create principal string username subject subject login context login context	return new generic principal username null roles user principal login context	call jaas logout method necessary principal instanceof generic principal generic principal gp generic principal principal gp get login context null try gp get login context logout catch login exception manager get container get logger error sm get string standard session
get delta request execute cluster manager get manager notify listeners replication
private set string var info names	else var info names contains name object custom action associated jspx page context find attribute else string builder msg new string builder jsp get property bean name msg append name msg append name previously introduced per jsp throw new jasper exception msg string	add named objects lits introduced names enable later test per jsp variable info infos get variable infos infos null infos length int infos length variable info info infos info null info get var name null page info get var info names add info get var name	var info names page info get var info names	private set string var info names	var info names new hash set string	public set string get var info names return var info names
some directories prefix password hash type password starts md5 password starts sha
url system get property url jdbc mysql localhost 3306 mysql auto reconnect true driver class name system get property driver class name com mysql jdbc driver password system get property password password username system get property username root validation query system get property validation query select	string fast sql datasource get validation query result set rs st execute query fast sql
connection null throw new sqlexception driver driver returned null url driver url
spec says apps should have read write temp directory fine security sensitive files least any app doesn have full control anyway written here new file permission work dir read write permission collection add new file permission work dir read write delete
public void set local loopback disabled boolean local loopback disabled properties set property local loopback disabled string value local loopback disabled	boolean value properties get property local loopback disabled false boolean value	disable enable local loopback message protected boolean local loopback disabled false	param disable loopback mode disable loopback mode	message listener msgservice boolean local loopback disabled	local loopback disabled local loopback disabled	socket set loopback mode local loopback disabled hint we want disable loop back local machine messages attribute name local loopback disabled required false membership uses multicast call code java net multicast socket set loopback mode local loopback disabled code when code local loopback disabled true code multicast messages reach other nodes same local machine default code false code br attribute
notify session listeners replication else add session
rentry reset diff
deploy xml xml exists deployed app redeploy resources put xml get absolute path new long xml last modified	file xml copy null	xml copy new file config base file xml	xml copy null deployed app redeploy resources put xml copy get absolute path new long xml copy last modified
context instanceof standard context note race condition harmless so do synchronize standard context context fire container event type data
private volatile string date stamp	private volatile long current millis	date stamp file date formatter format new date system current time millis	string ts date file date formatter format new date systime	date stamp file date formatter format new date system current time millis
protected void parse host message bytes value mb
member set service start time	return member null member get service start time 1l
bundle resource bundle get bundle bundle name locale get default
string message response get message
host null host remove container listener	try string address string utils get property connector address integer port integer utils get property connector port string buffer sb new string buffer domain sb append type connector sb append port port address null address length sb append address address name new object name sb string return name catch exception cannot create object name connector	domain engine name string domain service get container get name	unregister associated request processor string worker null protocol handler handler connector get protocol handler handler instanceof worker handler get name else handler instanceof http11nio protocol worker http11nio protocol handler get name else handler instanceof http11apr protocol worker http11apr protocol handler get name else handler instanceof ajp protocol worker ajp protocol handler get name else handler instanceof ajp apr protocol worker ajp apr protocol handler get name object name query new object name domain type request processor worker worker set object name results mserver query names query null object name result results mserver unregister mbean result	string domain context get parent get parent get name	user database resource need destroy groups roles users user database mbean org apache catalina user database equals resource get type destroy mbean user database resource get name	string domain engine get name	string domain host get parent get name	mserver registered oname	global string cache fixed name oname new object name catalina type string cache mserver registered oname mserver unregister mbean oname mbean factory fixed name oname new object name catalina type mbean factory mserver registered oname mserver unregister mbean oname	deregister mbean code user database code object name param user database user database managed exception exception mbean cannot deregistered static void destroy mbean user database string user database throws exception object name query null set object name results null groups query new object name users type group database user database results mserver query names query null object name result results mserver unregister mbean result roles query new object name users type role database user database results mserver query names query null object name result results mserver unregister mbean result users query new object name users type user database user database results mserver query names query null object name result results mserver unregister mbean result database itself object name db new object name users type user database database user database mserver unregister mbean db	else lifecycle after stop event equals event get type	deregister mbean connector itself log debug enabled log debug destroying mbean connector connector mbean utils destroy mbean connector service	mbean utils destroy mbean context	mbean utils destroy mbean engine	mbean utils destroy mbean host	mbean utils destroy mbean server	destroy mbeans engine deregister mbeans connectors connector connectors service find connectors int connectors length destroy mbeans connectors service
li directory server contains nested roles you can search them setting code role nested code code true code default value code false code so role searches find nested roles li	should we look nested group order determine roles protected boolean role nested false	return nested group search flag flag public boolean get role nested return role nested set search subtree roles flag param role nested nested group search flag public void set role nested boolean role nested role nested role nested	string key keys container log trace found direct role key group map get key nested group search enabled perform searches nested groups until new group found get role nested following efficient algorithm known member algorithm described practices directory groups avoids group slurping handles cyclic group memberships well see http middleware internet2 edu dir details set string new group dns new hash set string group map key set while new group dns empty set string new round new hash set string stores groups we find iteration string group dn new group dns filter role format format new string group dn container log trace enabled container log trace perform nested group search base role base filter filter results context search role base filter controls try while results has more search result result results next attributes attrs result get attributes attrs null continue string dname get name context role base result string name get attribute value role name attrs name null dname null group map key set contains dname group map put dname name new round add dname container log trace enabled container log trace found nested role dname name catch partial result exception ex ad compat throw ex new group dns new round return new array list string group map values bug 46925 bug replace recusive search nested roles iterative search patch provided stefan zoerner rjung update update session attribute mturk
-1
public static final string precompile system get property org apache jasper constants precompile jsp precompile	req set query string constants precompile jsp precompile true
protected string get name dir context context string base search result result throws naming exception get entry name relative results means we need composite name base name context name result name non relative names use returned name result relative container log trace enabled container log trace search returned relative name result get name name parser parser context get name parser name context name parser parse context get name namespace name base name parser parse base bugzilla 32269 name entry name parser parse new composite name result get name get name name context name add all base name name name add all entry name return name string else string absolute name result get name container log trace enabled container log trace search returned absolute name result get name try normalize name running through name parser name parser parser context get name parser uri user name uri new uri absolute name string path component user name uri get path should ever have empty path component since dn path component length throw new invalid name exception search returned unparseable absolute name absolute name name name parser parse path component substring return name string catch urisyntax exception throw new invalid name exception search returned unparseable absolute name absolute name
method returns size buffer used jsp writer return size buffer bytes unbuffered public int get buffer size according spec jsp writer returned jsp context push body java io writer writer must behave though were unbuffered means its get buffer size must always return return writer null buffer size	writer null
error setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true	error setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true	error setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true	spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib	spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib	spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib
clazz class name name false loader	clazz class name name false loader
jreversion null version	jreversion null version
buffered reader close
private final thread group group private final atomic integer thread number new atomic integer private final string name prefix private final boolean daemon private final int thread priority
private thread pool executor parent null	parent null parent get pool size parent get maximum pool size return false else we reached here we need add queue can do any checks return super offer
req recycle
private final object application listeners lock new object	private final object application parameters lock new object	private final object constraints lock new object	private final object filter maps lock new object	private final object instance listeners lock new object	private final object security roles lock new object	private final object servlet mappings lock new object	private final object watched resources lock new object private final object welcome files lock new object	private final object wrapper lifecycles lock new object	private final object wrapper listeners lock new object	synchronized application listeners lock	synchronized application parameters lock	synchronized constraints lock	synchronized filter maps lock	synchronized filter maps lock	synchronized instance listeners lock	synchronized security roles lock	synchronized servlet mappings lock	synchronized watched resources lock	synchronized welcome files lock	synchronized wrapper lifecycles lock	synchronized wrapper listeners lock	synchronized instance listeners lock	synchronized wrapper lifecycles lock	synchronized wrapper listeners lock	synchronized application parameters lock return application parameters	synchronized instance listeners lock return instance listeners	synchronized security roles lock	synchronized security roles lock return security roles	synchronized servlet mappings lock	synchronized servlet mappings lock	synchronized welcome files lock	synchronized watched resources lock return watched resources	synchronized welcome files lock return welcome files	synchronized wrapper lifecycles lock return wrapper lifecycles	synchronized wrapper listeners lock return wrapper listeners	synchronized application listeners lock	synchronized application parameters lock	synchronized constraints lock	synchronized filter maps lock	synchronized instance listeners lock	synchronized security roles lock	synchronized servlet mappings lock	synchronized watched resources lock	synchronized welcome files lock	synchronized wrapper lifecycles lock	synchronized wrapper listeners lock	synchronized instance listeners lock instance listeners new string	private final object aliases lock new object	synchronized aliases lock skip duplicate aliases int aliases length aliases equals alias return add alias list string new aliases new string aliases length int aliases length new aliases aliases new aliases aliases length alias aliases new aliases	synchronized aliases lock return aliases	synchronized aliases lock	synchronized aliases lock return aliases	private final object members lock new object	synchronized members lock	synchronized members lock	synchronized members lock	private final object listeners lock new object lock object changes listeners	synchronized listeners lock	synchronized listeners lock	private final object listeners lock new object lock object changes listeners	synchronized listeners lock	synchronized listeners lock
public static final string jmx service prefix service jmx rmi jndi rmi public static final string jmx service suffix jmxrmi instance variables
private static final string private standard imports public static final list string standard imports collections unmodifiable list arrays list private standard imports	todo add private static final string private cached dtd public ids public static final list string cached dtd public ids collections unmodifiable list arrays list private cached dtd public ids private static final string private cached dtd resource paths public static final list string cached dtd resource paths collections unmodifiable list arrays list private cached dtd resource paths	imports add all constants standard imports	int constants cached dtd public ids size string cached dtd public id constants cached dtd public ids get string resource path constants cached dtd resource paths get
public privileged set random file string dev random source public data input stream run	log warn error reading dev random source ex random null try random close catch exception log warn failed close random dev random source null random null	hack you can use static file generate same random access controller do privileged new privileged set random file	log warn error reading dev random source ex random null try random close catch exception log warn failed close random dev random source null
xml stylesheet type text xsl href xform xsl
public string get string final string key final object args value null value key message format mf new message format value mf set locale locale return mf format args new string buffer null string	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final string manager sm string manager get manager org apache naming public void test null key boolean iae thrown false try sm get string null catch illegal argument exception iae iae thrown true assert equals iae thrown null key true iae thrown public void test bug46933 check null args ok sm get string naming context name bound sm get string naming context name bound object null sm get string naming context name bound new object
int offset timezone get dstsavings
fix bugzilla 41606 set jsp servlet wrapper servlet class last modified time after successful compile string target file name ctxt get class file name target file name null file target file new file target file name target file exists jsw null jsw set servlet class last modified time target file last modified
support fire property change delegate old delegate delegate	old anti jarlocking anti jarlocking	old anti resource locking anti resource locking	old available available	old configured configured	old cookies cookies	old use http only use http only	old cross context cross context	old	support fire property change ignore annotations old ignore annotations ignore annotations	old privileged privileged	old reloadable reloadable	old override override	old replace welcome files replace welcome files	old session timeout session timeout	old swallow output swallow output	long value old unload delay long value unload delay	status pages put integer value error page get error code	return status pages get integer value error code	error page error page status pages get integer value status	status pages remove integer value error page get error code	integer key integer value load startup
random new random	protected static random rand new random	public static random new random	public static random random new random	public static random new random	public static random new random	public static random new random	public static random new random	static random new random
request reqs null try reqs request session get attribute comet requests attribute catch illegal state exception ise ignore session has been invalidated listener have cleaned up	try session set attribute comet requests attribute new connection infos catch illegal state exception ise ignore session has been invalidated listener have cleaned up try session remove attribute comet requests attribute catch illegal state exception ise ignore session has been invalidated listener have cleaned up
kept alive
licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
public boolean get allow trace return request get connector get allow trace	override default ensure trace correctly handled param req link http servlet request object contains request client made servlet param resp link http servlet response object contains response servlet returns client exception ioexception input output error occurs while servlet handling options request exception servlet exception request options cannot handled protected void do options http servlet request req http servlet response resp throws servlet exception ioexception string buffer allow new string buffer do get method allow append get head do post allow append post do put allow append put do delete allow append post trace assume disabled unless we can prove otherwise req instanceof request facade request facade req get allow trace allow append trace always allow options allow append options resp set header allow allow string
doc base starts canonical app base get path file separator char
response send error http servlet response sc unauthorized
get local name get attributes get named attribute nodes has empty body	string short name attributes attrs node nodes named attrs boolean has empty body string attr names new string attrs get length named attrs size int named attrs size attr names attrs get length named attribute named attrs get node get qname
default depth spec infinite limit depth default infinite depth makes operations very expensive private int max depth	get servlet config get init parameter max depth null max depth integer parse int get servlet config get init parameter max depth	int depth max depth depth max depth depth max depth	lock depth max depth lock depth max depth	lock depth max depth	depth max depth
param page dir enc value page encoding attribute page private void compare tag encodings string page dir enc string page dir enc page dir enc upper case	string page enc root get page encoding upper case
pc get jsp compilation context get tag file jar url path	deprecated use link get tag handler class name string string error dispatcher see https issues apache org bugzilla show bug cgi id 46471 return get tag handler class name path null err gets fully qualified class name tag handler given tag file path param path tag file path param err error dispatcher return fully qualified class name tag handler given tag file path public static string get tag handler class name string path string urn error dispatcher err throws jasper exception	class name get class name base urn	private static string get class name base string urn string buffer base new string buffer org apache jsp tag meta urn null base append make java package urn base append return base string	deprecated use link parse tag file directives string url see https issues apache org bugzilla show bug cgi id 46471 return parse tag file directives file name ctxt get tag file jar url file name extracts tag file directive information from given tag file invoked compiler param file name name tag file parsed param tag file jar url location tag file public node nodes parse tag file directives string file name url tag file jar url throws file found exception jasper exception ioexception node nodes page do parse file name null tag file jar url	string tag class name jsp util get tag handler class name path tag lib info get reliable urn err	deprecated use link tag file processor parse tag file directives parser controller string string url tag library info see https issues apache org bugzilla show bug cgi id 46471 return parse tag file directives pc name path pc get jsp compilation context get tag file jar url path tag lib info parses tag file collects information directives included method used obtain info tag file when handler represents referenced tag file compiled here param pc current parser controller used compilation param name tag name specified tld param tagfile path tagfile param tag file jar url url jar containign tag file param tag lib info tag library info object associated tag info return tag info object assembled from directives tag file public static tag info parse tag file directives parser controller pc string name string path url tag file jar url tag library info tag lib info throws jasper exception page pc parse tag file directives path tag file jar url	url tag file jar url null tag file path starts meta inf try tag file jar url new url jar compiler get compilation context get tld location tag info get tag library get uri catch malformed urlexception print stack trace string tag file jar path tag file jar url null tag file jar path else tag file jar path tag file jar url string jsp servlet wrapper wrapper rctxt get wrapper tag file jar path tag file path get runtime context tag file jar url rctxt add wrapper tag file jar path tag file path wrapper	see https issues apache org bugzilla show bug cgi id 46471 needs removed once all broken code depends has been removed parser controller name path jar file url	do nothing
name starts constants jsp package name
db connection null throw new sqlexception sm get string jdbc realm open invalidurl driver name connection url
set name path	protected static final urlencoder url encoder static url encoder new urlencoder should encoded context paths url encoder add safe character	args new object args url encoder encode display path args display path args context get display name args null args nbsp args new boolean context get available args response encode url html sessions path url encoder encode display path args new integer args new integer args highlight color	html start path url encoder encode display path html stop path url encoder encode display path html reload path url encoder encode display path html undeploy path url encoder encode display path html expire path url encoder encode display path	td class row left bgcolor rowspan small href td class row left bgcolor rowspan small small td td class row center bgcolor rowspan small small td td class row center bgcolor rowspan small href target new small td
class type expected type	composite expression must coerce string type string class	composite expression must coerce string type string class tx substring mark type
econtainer instanceof engine
pooling enabled implements jsp id consumer
set false we don use ie6 max age expires work around public static final boolean always add expires boolean value system get property org apache tomcat util http server cookie always add expires true boolean value	version buf append max age buf append max age ie6 ie7 possibly other browsers don understand max age do understand expires even v1 cookies version always add expires	property name org apache tomcat util http server cookie always add expires code true code tomcat always add expires parameter set cookie header even cookies version greater than zero work around known ie6 ie7 bug causes ie ignore max age parameter set cookie header specified default value code true code used property
catch privileged action exception pe throwable pe get exception instanceof invocation target exception invocation target exception pe get exception else pe
licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface represents server side api bayeux messaging protocol bayeux simple subscribe publish receive methodology far from jms much simplified br used both actual server side clients br server side clients use create retrieve subscribe channels server side clients represented just like remote clients through client interface br bayeux intended thread safe multiple threads may call bayeux methods br bayeux object starting point any cometd application relying bayeux object dependent container bayeux object stored code javax servlet servlet context code object attribute under name code bayeux dojox cometd bayeux code br retrieve object one would simply call br code bayeux bx bayeux get servlet context get attribute bayeux dojox cometd bayeux br br bayeux protocol pretty straight forward includes bunch messaging needed known clients both server side remote clients object gets initialized container dependent servlet servlet handles all bayeux from client remote messsages delivered channels server side clients using code listener code interface br br code bayeux session code active long webapp hosting bayeux object active br when shuts down bayeux object unsubscribe all clients remove all active channels author greg wilkins author filip hanik meta definitions channels public static final string meta meta meta definitions channels public static final string meta slash meta meta definitions channels connect message public static final string meta connect meta connect meta definitions channels client messsage public static final string meta client meta client meta definitions channels disconnect messsage public static final string meta disconnect meta disconnect meta definitions channels handshake messsage public static final string meta handshake meta handshake meta definitions channels ping messsage public static final string meta ping meta ping meta definitions channels reconnect messsage deprecated public static final string meta reconnect meta reconnect meta definitions channels status messsage public static final string meta status meta status meta definitions channels subscribe messsage public static final string meta subscribe meta subscribe meta definitions channels unsubscribe messsage public static final string meta unsubscribe meta unsubscribe field names inside bayeux messages field names inside bayeux messages client id field public static final string client field client id field names inside bayeux messages data field public static final string data field data field names inside bayeux messages channel field public static final string channel field channel field names inside bayeux messages id field public static final string id field id field names inside bayeux messages error field public static final string error field error field names inside bayeux messages timestamp field public static final string timestamp field timestamp field names inside bayeux messages transport field public static final string transport field transport field names inside bayeux messages advice field public static final string advice field advice field names inside bayeux messages successful field public static final string successful field successful field names inside bayeux messages subscription field public static final string subscription field subscription field names inside bayeux messages ext field public static final string ext field ext field names inside bayeux messages connection type field public static final string connection type field connection type field names inside bayeux messages version field public static final string version field version field names inside bayeux messages minimum version field public static final string min version field minimum version field names inside bayeux messages supported connection types field public static final string supp connection type field supported connection types field names inside bayeux messages json comment filtered field public static final string json comment filtered field json comment filtered field names inside bayeux messages reconnect field public static final string reconnect field reconnect field names inside bayeux messages interval field public static final string interval field interval field values inside bayeux messages retry response public static final string retry response retry field values inside bayeux messages handshake response public static final string handshake response handshake field values inside bayeux messages none response public static final string none response none service channel names starts public static final string service service service channel names trailing slash public static final string service slash service transport types transport types long polling public static final string transport long poll long polling transport types callback polling public static final string transport callback poll callback polling transport types iframe public static final string transport iframe iframe transport types flash public static final string transport flash flash servlet context attribute name used obtain bayeux object public static final string dojox cometd bayeux dojox cometd bayeux http field names http helpers text json content type public static final string json content type text json http helpers parameter name json message public static final string message parameter message http helpers name jsonp parameter public static final string jsonp parameter jsonp http helpers default name jsonp callback function public static final string jsonp default name client creates new server side client method invoked server side objects only you cannot create remote client using method client represents entity can subscribe channels publish receive messages through channels param idprefix string prefix string id generated can null param listener listener callback object called when messages delivered new client return client returns client interface public client new client string idprefix listener listener retrieve client based id return null client doesn exist param clientid string return client null client doesn exist returns client does public client get client string clientid returns non modifiable list all clients currently active bayeux session return list client list containing all clients list can modified public list client get clients returns true client given id exists br same executing code get client id null code param client id string return boolean true client exists public boolean has client string client id removes client all together unsubscribe client any channels may subscribed remove from list param client client return client returns client removed null client removed public client remove client client channel returns channel given channel id channel doesn exist code create code parameter set true channel created added list active channels br code create code set false channel doesn exist null returned param channel id string id channel retrieved created param create boolean true bayeux impl should create channel return channel null code create code set false channel doesn exist otherwise returns channel object public channel get channel string channel id boolean create returns list currently active channels bayeux session return list channel public list channel get channels removes channel from bayeux object also unsubscribe all clients currently subscribed channel param channel channel channel removed return channel returns channel removed null channel removed public channel remove channel channel returns true channel given channel id exists br same executing code bayeux get channel channel id false null code param channel id string return boolean true channel exists public boolean has channel string channel id message creates new message sent server side client return message returns new message object has unique id public message new message client from security policy returns security policy associated bayeux session return security policy public security policy get security policy sets security policy used bayeux session param security policy security policy public void set security policy security policy security policy	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux channel represents channel used receive messages from publish messages order publish messages receive messages from one must subscribe channel easily done invoking code subscribe code method channel created calling code bayeux get channel channel id true code method channel can created either server side invoking get channel client side using meta subscribe message without wildcard author greg wilkins author filip hanik returns id channel id unique within bayeux session return string never null public string get id publishes message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msg publishes more than one message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msgs non persistent channels removed when last subscription removed persistent channels survive periods without any subscribers return true channel persist without any subscription public boolean persistent param persistent true channel persist without any subscription see persistent public void set persistent boolean persistent subscribes client channel param subscriber client subscribed client already subscribed call create duplicate subscription public void subscribe client subscriber unsubscribes client from channel param subscriber client subscribed return returns client unsubscribed null client wasn subscribed public client unsubscribe client subscriber returns non modifiable list all subscribers channel return list subscribers public list client get subscribers adds data filter channel all messages received channel run through filter param filter filter public void add filter data filter filter removes filter from channel returns filter removed null filter wasn channel param filter filter return filter null filter removed otherwise returns filter removed public data filter remove filter data filter filter	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license client may subscribe channels publish messages channels client instances should directly created uses should obtained via link bayeux get client string link bayeux new client string listener methods three types client may represented interface nl li server remote client connected via http created bayeux server when connect message comes li li server side client created application using link bayeux new client string listener method li li java client connected remote bayeux server implemented li nl author greg wilkins author filip hanik returns unique id client id unique within bayeux session return string null public string get id returns true client holding messages delivered remote client method always returns false local clients since messages delivered instantly using listener callback object return boolean public boolean has messages deliver message client only deliver message directly client message filtered published channel param message public void deliver message message deliver batch messages client only deliver batch messages directly client messages filtered published channel param message public void deliver message message return true client local false client either remote http client java client remote server public boolean local starts batch messages delivered until end batch called batches can nested messages only delivered after last end batch has been called public void start batch ends batch since batches can nested messages only delivered after end batch has been called many times start batch has public void end batch	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license data filter br data filters used transform data sent channel messages filtered message published channel invoking link channel publish message method br method gets invoked two different scenarios first being when message received from remote client bayeux invokes publish method directly second scenario when local client invokes link channel publish message directly local jvm author greg wilkins author filip hanik runs message through filter filtering can only modify existing object can replace param data message message filtered may null public void filter message data	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license cometd listener interface br local clients order receive messages pass callback object when local client created using link bayeux new client string listener method callback object implementing listener interface used deliver messages local jvm clients author greg wilkins author filip hanik method called when client removed explicitly from timeout param timeout true client removed from timeout false removed explicitly public void removed boolean timeout invoked when message delivered client message contains message itself well what channel message came through who sender someone invoked link client deliver message channel reference null param msg public void deliver message msg	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux message br bayeux message map string object key value pairs representing data message message contains information about channel published through who sender author greg wilkins author filip hanik returns reference client sent message return client may null public client get client returns reference channel message published throuhg return channel may null public channel get channel returns unique id message return string public string get id sets time live milliseconds message hasn been delivered when time passed after creation time longer than ttl message expire removed from any delivery queues param ttl long public void set ttl long ttl returns time live milliseconds message return long public long get ttl returns timestamp milliseconds system current time millis when message created return long public long get creation time	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author greg wilkins boolean can handshake message message boolean can create client client string channel message message boolean can subscribe client client string channel message messsage boolean can publish client client string channel message messsage	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public bayeux exception super public bayeux exception string message super message public bayeux exception string message throwable cause super message cause public bayeux exception throwable cause super cause	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface defines methods managing bayeux request meta messages author guy molinari author filip hanik version public static final string last req attr org apache cometd bayeux last request public static final string current req attr org apache cometd bayeux current request public static final string json msg array org apache cometd bayeux json msg array validates specific request method must called prior process request can do pre processing validate method br should validation fail error object returned containing error message potentially stack trace exception generated return http error null error detected http error object containing information about error public http error validate processes remote client bayeux message param prevops operation requested previous request case chained requests return int returns interest operation comet event currently used throws bayeux exception error detected appropriate error response couldn delivered client public int process int prevops throws bayeux exception	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik author guy molinari version attribute hold tomcat bayeux object servlet context public static final string tomcat bayeux attr bayeux dojox cometd bayeux logger object protected static log log log factory get log bayeux servlet class servlet config future use protected servlet config servlet config reference global tomcat bayeux object protected tomcat bayeux tb upon servlet destruction servlet clean up tomcat bayeux object terminate any outstanding events public void destroy servlet config null do close all outstanding comet events tb destroy tb null do close everything down returns connection timeout timeout has been configured servlet init parameter named code timeout code default 2min used return int timeout connection milliseconds protected int get timeout string timeout servlet config get init parameter timeout int timeout 120 1000 min try timeout integer parse int timeout catch number format exception nfe ignore we have default value return timeout protected int get reconnect interval string rs servlet config get init parameter reconnect interval int rct 1000 seconds try rct integer parse int rs catch number format exception nfe ignore we have default value return rct public void event comet event comet event throws ioexception servlet exception comet event event type type comet event get event type log debug enabled log debug thread current thread get name received comet event type type subtype comet event get event sub type synchronized comet event type comet event event type begin begin event set timeout comet event set timeout get timeout check bayeux comet event read event should always come else type comet event event type read check bayeux comet event else type comet event event type error tb remove comet event comet event close else type comet event event type end tb remove comet event comet event close end synchronized event param comet event comet event return boolean true we comet event stays open throws ioexception throws unsupported operation exception protected void check bayeux comet event comet event throws ioexception unsupported operation exception we actually have data data can text json bayeux json content type equals comet event get http servlet request get content type read decode bytes according content length log warn thread current thread get name json encoding supported throw exception abort request int comet event get http servlet request get content length throw new unsupported operation exception decoding bayeux json content type yet implemented else get method application www form urlencoded string message comet event get http servlet request get parameter bayeux message parameter log trace enabled log trace thread current thread get name received json message message try int action handle bayeux message comet event log debug enabled log debug thread current thread get name bayeux handling complete action result action action comet event close catch exception print stack trace tb remove comet event log error comet event close protected int handle bayeux string message comet event event throws ioexception servlet exception int result message null message length return result try bayeux request request null message can array messages jsonarray js array new jsonarray message int js array length jsonobject msg js array get jsonobject log debug enabled log debug thread current thread get name processing bayeux message msg request request factory get request tb event msg log debug enabled log debug thread current thread get name processing bayeux message using request request result request process result log debug enabled log debug thread current thread get name processing bayeux message result result result request null event get http servlet request set attribute bayeux request last req attr request client impl ci client impl tb get client request base request get client id ci add comet event event log debug enabled log debug thread current thread get name done bayeux message added request attribute else result request null request base deliver event client impl tb get client request base request get client id log debug enabled log debug thread current thread get name done bayeux message delivered client catch log error do impl error handling result catch bayeux exception log error do impl error handling result return result public servlet config get servlet config return servlet config public string get servlet info return tomcat bayeux servlet public void init servlet config servlet config throws servlet exception servlet config servlet config servlet context ctx servlet config get servlet context ctx get attribute tomcat bayeux attr null ctx set attribute tomcat bayeux attr new tomcat bayeux tb tomcat bayeux ctx get attribute tomcat bayeux attr tb set reconnect interval get reconnect interval public void service servlet request servlet request servlet response servlet response throws servlet exception ioexception servlet response instanceof http servlet response http servlet response servlet response send error 500 tomcat server must configured support comet operations else throw new servlet exception tomcat server must configured support comet operations bayeux protocol	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected static log log log factory get log channel impl class unique id channel protected string id null list current subscribers protected linked list client subscribers new linked list client list current filters protected linked list data filter filters new linked list data filter channel persistent default value true protected boolean persistent true creates new channel param id string id channel can null protected channel impl string id assert id null id id returns id channel return string public string get id return id returns true channel matches pattern its id channel pattern can complete name like code service mychannel code can wild card pattern like code service app2 code param pattern string according bayeux section channel globbing can null return boolean true id channel matches pattern public boolean matches string pattern pattern null throw new null pointer exception channel pattern must null get id equals pattern return true int wildcard pos pattern index wildcard pos return false boolean multi segment pattern index string lead substring pattern substring wildcard pos lead substring null return false multi segment return get id starts lead substring else get id length wildcard pos return false return get id substring wildcard pos contains return returns non modifiable list subscribers channel public list client get subscribers return collections unmodifiable list subscribers return true channel persist without any subscription public boolean persistent return persistent public void publish message msg publish new message msg public void publish message msgs msgs null return message impl imsgs new message impl msgs length int msgs null msgs length message data msgs data instanceof message impl throw new illegal argument exception invalid message class you can only publish messages created through bayeux new message method log debug enabled log debug publishing message data channel clone so we can set channel reference message impl msg message impl message impl data clone channel delivered through msg set channel pass through filters iterator data filter filters iterator has next next filter msg imsgs msg deliver clients iterator client subscribers iterator has next client impl client impl next deliver internal imsgs public void set persistent boolean persistent persistent persistent public void subscribe client subscriber subscribers contains subscriber subscribers add last subscriber client impl subscriber subscribed public client unsubscribe client subscriber subscribers remove subscriber client impl subscriber unsubscribed return subscriber else return null public void add filter data filter filter filters contains filter filters add last filter public data filter remove filter data filter filter filters remove filter return filter else return null public string string string buffer buf new string buffer super string buf append channel id append get id return buf string	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final int support callback poll 0x1 public static final int support long poll 0x2 public static final string comet event attr org apache cometd bayeux client protected static log log log factory get log client impl class protected static linked list message empty list new linked list message queued message remote clients protected linked list message messages null protected queue comet event events new linked list comet event unique id representing client protected string id supported connection types defaults long polling protected int supported conn types support long poll support callback poll desired connection type protected int desirect conn type support long poll does client use json comment filtered messages protected boolean use json filtered false same jvm clients get local true protected boolean local callback object local clients protected listener listener protected atomic integer new atomic integer protected client impl string id boolean local id id local local local messages new linked list message protected client impl string id comet event event id false events new concurrent linked queue comet event add comet event event public synchronized void deliver message message deliver internal null new message impl message impl message public synchronized void deliver message message deliver internal null message protected synchronized void deliver internal channel impl channel message impl message deliver internal channel new message impl message protected synchronized void deliver internal channel impl channel message msgs local local clients must have listener array list message list new array list message int msgs null msgs length dont deliver ourselves msgs get client list add msgs get listener null list size get listener deliver list array new message else int msgs null msgs length message impl message message impl msgs message get client dont deliver ourself continue we implementing forever responses client connected we fire off message first we check see we have any existing connections we can piggy back comet event event events poll boolean delivered false todo todo check thread safety writing getting last request event null synchronized event request base rq request base event get http servlet request get attribute request base last req attr rq null map map new hash map try map put bayeux channel field message get channel get id map put bayeux data field message jsonobject json new jsonobject map log debug enabled log debug message instantly delivered remote client message json rq add delivery queue json deliver batch msgs length rq deliver event event close todo figure out better way means only one message gets delivered remove comet event event delivered instantly delivered true catch exception log error delivered log debug enabled log debug message added queue remote client message message queue message next round messages add message public string get id return id protected listener get listener return listener public boolean has messages local return false else return messages size public boolean local return local public int get supported conn types return supported conn types public int get desirect conn type return desirect conn type public boolean use json filtered return use json filtered public void set listener listener listener listener listener public void set supported conn types int supported conn types supported conn types supported conn types public void set use json filtered boolean use json filtered use json filtered use json filtered public void set desirect conn type int desirect conn type desirect conn type desirect conn type public boolean supports callback poll return supported conn types support callback poll support callback poll public boolean supports long poll return supported conn types support long poll support long poll public synchronized list message take messages local return null messages size return empty list list result new linked list messages messages clear return result public string string string buffer buf new string buffer super string buf append id append get id return buf string public boolean subscribed return get protected synchronized boolean add comet event comet event event boolean result false events contains event events add event result true event get http servlet request set attribute comet event attr return result protected synchronized boolean remove comet event comet event event boolean result events remove event event get http servlet request remove attribute comet event attr return result protected void subscribed channel impl ch add get protected void unsubscribed channel impl ch add get public void start batch noop until improved public void end batch noop until improved	private int code private string status private throwable cause public http error int code string status throwable cause code code status status cause cause public void set code int code code code public void set status string status status status public void set cause throwable exception cause exception public int get code return code public string get status return status public throwable get cause return cause public string string cause null return code status cause else return code status	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license protected channel channel protected client client protected string id private long ttl 1000 60 5min default ttl message protected long creation time system current time millis public object clone message impl copy new message impl id copy put all copy channel channel copy client client copy id id copy creation time creation time copy ttl ttl return copy protected message impl string id assert id null id id public channel get channel return channel public client get client return client public long get creation time return creation time public long get ttl return ttl public string get id return id protected void set channel channel channel channel channel protected void set client client client client client public void set ttl long ttl ttl ttl	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license common member variables all bayeux requests author guy molinari author filip hanik version protected static final simple date format timestamp fmt new simple date format yyyy mm dd hh mm ss sssz static timestamp fmt set time zone time zone get time zone gmt message properties combined all messages protected tomcat bayeux tomcat bayeux protected string channel protected string id protected string client id protected string version null protected string supp conn types null protected int supp conn types flag protected int desired conn type flag protected string min version null protected string subscription null protected string data null protected string con type null protected linked hash map string object ext new linked hash map string object protected comet event event protected hash map string object response null protected static log log log factory get log request base class protected int reconnect interval 1000 protected request base tomcat bayeux tb comet event event jsonobject js req throws tomcat bayeux tb event event channel js req opt string bayeux channel field id js req opt string bayeux id field client id js req opt string bayeux client field version js req opt string bayeux version field min version js req opt string bayeux min version field con type js req opt string bayeux connection type field subscription js req opt string bayeux subscription field data js req opt string bayeux data field reconnect interval tb get reconnect interval js req has bayeux ext field jsonobject jext js req get jsonobject bayeux ext field iterator string jext keys has next string key next ext put key jext get key end js req has bayeux supp connection type field jsonarray types js req get jsonarray bayeux supp connection type field supp conn types new string types length int types length supp conn types types get string bayeux transport callback poll equals supp conn types supp conn types flag supp conn types flag client impl support callback poll else bayeux transport long poll equals supp conn types supp conn types flag supp conn types flag client impl support long poll end con type null bayeux transport callback poll equals con type desired conn type flag client impl support callback poll else bayeux transport long poll equals con type desired conn type flag client impl support long poll end due fact javascript doesn send up required field we have fake supp conn types flag client impl support callback poll client impl support long poll public http error validate http error result null return result public tomcat bayeux get tomcat bayeux return tomcat bayeux public string get channel return channel public string get id return id public string get client id return client id public linked hash map get ext return ext public comet event get event return event protected static void deliver comet event event client impl throws ioexception servlet exception bayeux exception jsonarray jarray get jsonarray event true jarray null throw new bayeux exception message send string jsonstring jarray string log debug enabled log debug thread current thread get name delivering message message jsonstring null use json filtered event get http servlet response committed event get http servlet response set content type text json comment filtered else event get http servlet response committed event get http servlet response set content type text json print writer out event get http servlet response get writer null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll string jsonp event get http servlet request get parameter bayeux jsonp parameter jsonp null jsonp bayeux jsonp default name out print jsonp out print else throw new bayeux exception client doesn support any appropriate connection type out print jsonstring null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll out print out flush event get http servlet response flush buffer protected static jsonarray get jsonarray comet event event boolean nullok synchronized event jsonarray jarray jsonarray event get http servlet request get attribute json msg array jarray null nullok jarray new jsonarray event get http servlet request set attribute json msg array jarray return jarray protected jsonarray get jsonarray return get jsonarray event false protected void add delivery queue client impl jsonobject msg throws ioexception servlet exception bayeux exception synchronized event get jsonarray put msg protected void flush messages client impl client throws bayeux exception list message msgs client take messages synchronized event try iterator message msgs iterator has next message impl msg message impl next map map new hash map map put bayeux channel field msg get channel get id msg get client null map put bayeux client field msg get client get id map put bayeux data field msg jsonobject obj new jsonobject map add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception public int process int prevops throws bayeux exception event get http servlet request set attribute current req attr return prevops public int get reconnect interval return reconnect interval public string get time stamp return timestamp fmt format new date system current time millis	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static bayeux request get request tomcat bayeux tomcat bayeux comet event event jsonobject msg throws string channel msg opt string bayeux channel field bayeux meta handshake equals channel return new meta handshake request tomcat bayeux event msg else bayeux meta connect equals channel return new meta connect request tomcat bayeux event msg else bayeux meta disconnect equals channel return new meta disconnect request tomcat bayeux event msg else bayeux meta subscribe equals channel return new meta subscribe request tomcat bayeux event msg else bayeux meta unsubscribe equals channel return new meta unsubscribe request tomcat bayeux event msg else return new publish request tomcat bayeux event msg	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected int reconnect interval 5000 list all active clients protected hash map string client clients new hash map string client list all active channels protected linked hash map string channel channels new linked hash map string channel security policy used protected security policy security policy null default client use when we need send error message don have client valid reference protected static client impl error client new client impl error client false returns default error client return client impl public static client impl get error client return error client protected tomcat bayeux should invoked when servlet destroyed when context shuts down public void destroy throw new unsupported operation exception tomcat bayeux destroy yet implemented public channel get channel string channel id boolean create channel result channels get channel id result null create result new channel impl channel id channels put channel id result return result public channel remove channel channel return channels remove channel get id public client remove client client client null return null channel ch get channels ch unsubscribe client return clients remove client get id public client get client string client id return clients get client id public boolean has client string client id return clients contains key client id public list client get clients return java util arrays list clients entry set array new client public security policy get security policy return security policy public int get reconnect interval return reconnect interval public boolean has channel string channel return channels contains key channel public client new client string idprefix listener listener boolean local comet event event string id create uuid idprefix client impl client new client impl id local client set listener listener clients put id client return client public client new client string idprefix listener listener assert listener null method gets called someone using api inside jvm local client return new client idprefix listener true null protected client impl get client impl comet event event return client impl event get http servlet request get attribute client impl comet event attr protected void remove comet event event client impl client get client impl event client null client remove comet event event public string create uuid string idprefix idprefix null idprefix return idprefix arrays string random uuid false public list channel get channels return java util arrays list channels entry set array new channel protected message new message string id create uuid msg return new message impl id public message new message client from message impl msg message impl new message msg set client from return msg public void set security policy security policy security policy security policy security policy public void set reconnect interval int reconnect timeout reconnect interval reconnect timeout	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta connect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta connect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req client id null get tomcat bayeux has client client id event get http servlet request set attribute client get tomcat bayeux get client client id check client request validity per section bayuex spec connect request must contain meta connect channel identifier client id returned server after handshake desired connection type must one server supported types returned handshake response return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null bayeux transport long poll equals con type bayeux transport callback poll equals con type return new http error 400 unsupported connection type null return null error transition connected state flushing pending messages available pending messages flush connection held until pending publish event delivered client section spec public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id boolean success false http error error validate error null client set desirect conn type desired conn type flag hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval success true else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return immediately so we can process next message int result client subscribed success client null client has messages send out messages flush messages client result flush out messages return result	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta disconnect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta disconnect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta disconnect channel identifier client id return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error disconnect client session public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else get tomcat bayeux remove client response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect none client null client tomcat bayeux get error client response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta handshake response template put bayeux version field response template put bayeux supp connection type field new string bayeux transport long poll bayeux transport callback poll response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta handshake request tomcat bayeux tomcat bayeux comet event event jsonobject js req throws super tomcat bayeux event js req public string get version return version public string get minimum version return min version check client request validity per section bayuex spec handshake request must contain meta handshake channel identifier version protocol supported client client supported connection types return http error method returns null errors were found public http error validate boolean error version null version length error error supp conn types flag error return new http error 400 invalid handshake request supported connection type field missing null else return null generate return client identifier return list supported connection types must subset identical list types supported client see section bayuex public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client null http error error validate error null client client impl get tomcat bayeux new client http null false get event client id client get id client set supported conn types supp conn types flag client set use json filtered get ext get bayeux json comment filtered field null response put bayeux client field client get id hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string client tomcat bayeux get error client hash map response get bayeux advice field put bayeux reconnect field bayeux none response try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta subscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta subscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta subscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error register interest one more channels per section bayeux spec pattern may specified assign client matching channels inverse client channel reference public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean subscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch subscribe client subscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch subscribe client subscribed true response put bayeux successful field boolean value subscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta unsubscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta unsubscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta unsubscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error de register interest one more channels per section bayeux spec pattern may specified sever public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean unsubscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch unsubscribe client unsubscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch unsubscribe client unsubscribed true response put bayeux successful field boolean value unsubscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version jsonobject msg data null protected static hash map string object response template new hash map string object static response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public publish request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain channel identifier channel publication data send return http error method returns null errors were found public http error validate channel null get tomcat bayeux has channel channel return new http error 400 channel id valid null data null data length return new http error 400 message data missing null try msg data new jsonobject data catch return new http error 400 invalid json object data attribute client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error send event message all registered subscribers public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client id null client impl get tomcat bayeux get client client id client impl event get http servlet request get attribute client boolean success false http error error validate error null channel impl chimpl channel impl get tomcat bayeux get channel channel false message impl mimpl message impl get tomcat bayeux new message client try string keys jsonobject get names msg data int keys length mimpl put keys msg data get keys success true hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval catch log error enabled log error unable parse msg data throw new bayeux exception chimpl publish mimpl success response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux channel field channel response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception success client null client has messages send out messages flush messages client return	servlet context attribute listener listener static atomic integer counter new atomic integer protected int id protected bayeux protected client protected boolean alive true protected boolean initialized false protected ticker thread tt new ticker thread public bayeux stock ticker id counter increment get system out println new listener created id id public void context destroyed servlet context event servlet context event alive false tt run false tt interrupt public void context initialized servlet context event servlet context event public void attribute added servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux initialized return initialized true system out println starting stock ticker server client bayeux scae get value new client stock ticker tt start public void attribute removed servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux initialized false bayeux scae get value list channel chs get channels channel ch chs ch unsubscribe public void attribute replaced servlet context attribute event servlet context attribute event public void removed boolean timeout system out println client removed public void deliver message msgs int msgs null msgs length message msg msgs system out println stock ticker server client received message msg public class ticker thread extends thread public boolean run true public ticker thread set name ticker thread public void run try stock stocks new stock new stock goog 435 43 new stock yhoo 27 88 new stock sprg 1015 55 stock stocks channel ch get channel stock get symbol true ch subscribe random new random system current time millis while run int int next int stock stock stocks double change next double boolean plus next boolean plus stock set value stock get value change else stock set value stock get value change channel ch get channel stock stock get symbol true message new message put stock stock string put symbol stock get symbol put price stock get value string put change stock get last change string ch publish system out println stock stock get symbol price stock get value string change stock get last change string thread sleep 850 catch interrupted exception ix catch exception print stack trace public static class stock protected static decimal format df new decimal format 00 protected string symbol protected double value 0d protected double lastchange 0d protected int cnt public stock string symbol double initvalue symbol symbol value initvalue public void set cnt int cnt public int get cnt return cnt public string get symbol return symbol public double get value return value public void set value double value double old value value value lastchange value old public string get value string return df format value public double get last change return lastchange public void set last change double lastchange lastchange lastchange public string get last change string return df format lastchange public int hash code return symbol hash code public boolean equals object other other instanceof stock return symbol equals stock other symbol else return false public string string string buffer buf new string buffer stock buf append get symbol buf append buf append get value string buf append buf append get last change string buf append buf append string value get cnt return buf string public object clone stock new stock get symbol get value set last change get last change set cnt cnt return	static atomic integer counter new atomic integer protected int id protected bayeux protected client protected boolean alive true protected timestamp thread tt new timestamp thread public echo chat client id counter increment get system out println new listener created id id public void context destroyed servlet context event servlet context event alive false tt interrupt public void context initialized servlet context event servlet context event public void attribute added servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux system out println starting echo chat client bayeux scae get value new client echochat channel ch get channel chat demo true ch subscribe tt start public void attribute removed servlet context attribute event servlet context attribute event public void attribute replaced servlet context attribute event servlet context attribute event public void removed boolean timeout system out println client removed public void deliver message msgs int msgs null msgs length message msg msgs system out println received message msg message new message put all msg echo same message put user contains key msg simple chat demo string chat string get msg put msg received your message chat substring chat index system out println sending message msg get channel publish public class timestamp thread extends thread public timestamp thread set daemon true public void run while alive try sleep 5000 channel ch get channel chat demo false ch get subscribers size continue message new message put user put chat time new java sql date system current time millis locale string put join false ch publish catch interrupted exception ignore thread current thread interrupted catch exception print stack trace xmlns http java sun com xml ns javaee xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version display name cometd test web app display name servlet servlet name cometd servlet name servlet class org apache tomcat bayeux bayeux servlet servlet class init param param name timeout param name param value 120000000 param value init param init param param name reconnect interval param name param value 250 param value init param load startup load startup servlet servlet mapping servlet name cometd servlet name url pattern cometd url pattern servlet mapping listener listener class org apache cometd bayeux samples echo chat client listener class listener listener listener class org apache cometd bayeux samples bayeux stock ticker listener class listener dojox cometd init cometd cometd dojox cometd start batch dojox cometd subscribe stock goog msg event dojox cometd subscribe stock yhoo msg event dojox cometd subscribe stock sprg msg event dojox cometd end batch node undefined node null return var len node child nodes length break apart text string screen name message parts var symbol event data symbol var price event data price var pricechange event data change alert symbol symbol price price change pricechange var pricenode dojo id price symbol var changenode dojo id change symbol remove children from node pricenode remove children from node changenode var pricelabel document create text node price pricelabel value price var changelabel document create text node pricechange changelabel value pricechange pricenode append child pricelabel changenode append child changelabel var table dojo id stocktable var rows table get elements tag name tr rows length manipulate rows var row current dojo id row symbol pricechange row current bg color red else tr id row header td symbol td td price td td last change td td subscribe td tr tr id row sprg td sprg td td id price sprg td td id change sprg td td id check sprg input type checkbox id check sprg checked click subscribe sprg td tr tr id row goog td goog td td id price goog td td id change goog td td id check goog input type checkbox id check goog checked click subscribe goog td tr tr id row yhoo td yhoo td td id price yhoo td td id change yhoo td td id check yhoo input type checkbox id check goog checked click subscribe yhoo td tr	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interceptor keep track connection state avoid roundtrips database author fhanik protected static log log log factory get log connection state class protected final string read state get auto commit get transaction isolation read only get catalog protected final string write state set auto commit set transaction isolation set read only set catalog protected boolean auto commit null protected integer transaction isolation null protected boolean read only null protected string catalog null public void reset connection pool parent pooled connection con pool properties pool properties parent get pool properties pool properties get default read only null try read only null read only boolean value pool properties get default read only boolean value con get connection set read only pool properties get default read only boolean value read only pool properties get default read only catch sqlexception read only null log error unable reset readonly state connection pool properties get default auto commit null try auto commit null auto commit boolean value pool properties get default auto commit boolean value con get connection set auto commit pool properties get default auto commit boolean value auto commit pool properties get default auto commit catch sqlexception auto commit null log error unable reset autocommit state connection pool properties get default catalog null try catalog null catalog equals pool properties get default catalog con get connection set catalog pool properties get default catalog catalog pool properties get default catalog catch sqlexception catalog null log error unable reset default catalog state connection pool properties get default transaction isolation data source factory unknown try transaction isolation null transaction isolation int value pool properties get default transaction isolation con get connection set transaction isolation pool properties get default transaction isolation transaction isolation pool properties get default transaction isolation catch sqlexception transaction isolation null log error unable reset transaction isolation state connection override public object invoke object proxy method method object args throws throwable string name method get name boolean read false int index int read read state length read compare name read state read index boolean write false int write read write state length write compare name write state write index object result null read switch index case result auto commit break case result transaction isolation break case result read only break case result catalog break default result null return cached result we have result null return result result super invoke proxy method args read write switch index case auto commit boolean read result args break case transaction isolation integer read result args break case read only boolean read result args break case catalog string read result args break return result	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected final string statements create statement prepare statement prepare call protected final string executes execute execute query execute update execute batch protected static identity hash map connection pool hash map string query stats per pool stats new identity hash map connection pool hash map string query stats protected hash map string query stats queries null protected long threshold 100 don report queries less than protected int max queries 1000 don store more than amount queries public slow query report super public long get threshold return threshold public void set threshold long threshold threshold threshold override public void close invoked todo auto generated method stub override public object create statement object proxy method method object args object statement todo auto generated method stub string sql null method get name starts prepare sql args length args instanceof string string args null return new statement proxy statement sql protected boolean process final string names method method boolean process int process names length process compare method get name names return process protected class query stats private final string query private int nr invocations private long max invocation time private long max invocation date private long min invocation time private long min invocation date private long total invocation time public query stats string query query query public void add long invocation time long now thread safe don sacrifice performance kind stuff max invocation time math max invocation time max invocation time max invocation time invocation time now system current time millis max invocation date now min invocation time math min invocation time min invocation time min invocation time invocation time now now system current time millis now min invocation date now nr invocations total invocation time invocation time public string get query return query public int get nr invocations return nr invocations public long get max invocation time return max invocation time public long get max invocation date return max invocation date public long get min invocation time return min invocation time public long get min invocation date return min invocation date public long get total invocation time return total invocation time public int hash code return query hash code public boolean equals object other other instanceof query stats query stats qs query stats other return slow query report compare qs query query return false protected class statement proxy implements invocation handler protected boolean closed false protected object delegate protected final string query public statement proxy object parent string query delegate parent query query public object invoke object proxy method method object args throws throwable final string name method get name boolean close compare jdbc interceptor close val name close closed return null allow close called multiple times closed throw new sqlexception statement closed boolean process false process process executes method process long start process system current time millis execute query object result method invoke delegate args long delta process system current time millis start delta threshold string sql null todo query stats qs slow query report queries get sql qs null qs new query stats sql slow query report queries put string sql qs qs add delta return qs close closed true delegate null return result public void reset connection pool parent pooled connection con queries null slow query report per pool stats get parent null queries new linked hash map string query stats override protected boolean remove eldest entry entry string query stats eldest return size max queries apache license version january 2004 http www apache org licenses terms conditions use reproduction distribution definitions license shall mean terms conditions use reproduction distribution defined sections through document licensor shall mean copyright owner entity authorized copyright owner granting license legal entity shall mean union acting entity all other entities control controlled under common control entity purposes definition control means power direct indirect cause direction management entity whether contract otherwise ii ownership fifty percent 50 more outstanding shares iii beneficial ownership entity you your shall mean individual legal entity exercising permissions granted license source form shall mean preferred form making including limited software source code source files object form shall mean any form resulting from mechanical translation source form including limited compiled object code generated conversions other media types work shall mean work authorship whether source object form made available under license indicated copyright notice included attached work example provided appendix below derivative works shall mean any work whether source object form based derived from work which editorial revisions annotations elaborations other represent whole original work authorship purposes license derivative works shall include works remain separable from merely link bind name interfaces work derivative works thereof contribution shall mean any work authorship including original version work any additions work derivative works thereof submitted licensor inclusion work copyright owner individual legal entity authorized submit behalf copyright owner purposes definition submitted means any form electronic verbal written sent licensor its including limited electronic mailing lists source code control systems issue tracking systems managed behalf licensor purpose discussing improving work excluding marked otherwise designated writing copyright owner contribution contributor shall mean licensor any individual legal entity behalf whom contribution has been received licensor subsequently incorporated within work grant copyright license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable copyright license reproduce prepare derivative works publicly display publicly perform sublicense distribute work derivative works source object form grant patent license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable except stated section patent license make have made use offer sell sell import otherwise transfer work where license applies only those patent claims licensable contributor necessarily infringed contribution alone combination contribution work which contribution submitted you institute patent litigation against any entity including cross claim counterclaim lawsuit alleging work contribution incorporated within work constitutes direct contributory patent infringement any patent licenses granted you under license work shall terminate date litigation filed you may reproduce distribute copies work derivative works thereof any medium without source object form provided you meet following conditions you must give any other recipients work derivative works copy license you must cause any modified files carry prominent notices stating you changed files you must retain source form any derivative works you distribute all copyright patent trademark attribution notices from source form work excluding those notices do pertain any part derivative works work includes notice text file part its distribution any derivative works you distribute must include readable copy attribution notices contained within notice file excluding those notices do pertain any part derivative works least one following places within notice text file distributed part derivative works within source form provided along derivative works within display generated derivative works wherever third party notices normally appear contents notice file purposes only do modify license you may add your own attribution notices within derivative works you distribute alongside addendum notice text from work provided additional attribution notices cannot construed modifying license you may add your own copyright statement your may provide additional different license terms conditions use reproduction distribution your any derivative works whole provided your use reproduction distribution work otherwise complies conditions stated license submission unless you explicitly state otherwise any contribution submitted inclusion work you licensor shall under terms conditions license without any additional terms conditions above nothing herein shall supersede modify terms any separate license agreement you may have executed licensor regarding trademarks license does grant permission use trade names trademarks service marks product names licensor except required reasonable customary use describing origin work reproducing content notice file disclaimer warranty unless required applicable law agreed writing licensor provides work each contributor provides its basis without warranties conditions any kind either express implied including without limitation any warranties conditions title non infringement fitness particular purpose you solely responsible determining using work assume any risks associated your exercise permissions under license limitation liability event under legal theory whether tort including negligence contract otherwise unless required applicable law deliberate grossly negligent acts agreed writing shall any contributor liable you damages including any direct indirect special incidental damages any character arising result license out use inability use work including limited damages loss goodwill work stoppage computer failure malfunction any all other commercial damages losses even contributor has been advised possibility damages accepting warranty additional liability while work derivative works thereof you may choose offer charge fee acceptance support warranty indemnity other liability obligations rights consistent license however accepting obligations you may act only your own behalf your sole behalf any other contributor only you agree indemnify defend hold each contributor harmless any liability incurred claims asserted against contributor reason your accepting any warranty additional liability end terms conditions appendix how apply apache license your work apply apache license your work attach following boilerplate notice fields enclosed brackets replaced your own identifying information don include brackets text should enclosed appropriate comment syntax file format we also recommend file class name description purpose included same printed page copyright notice easier within third party archives copyright yyyy name copyright owner licensed under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
private iterator feature descriptor itr private feature descriptor next	public boolean has next next null return true itr null while next null itr has next next itr next else return false next null itr null guarantee iterator return has next has next throw new element exception feature descriptor next next next null return next
tfp null ctxt prototype mode
implements notification listener container listener	container listener methods public void container event container event event event get type host add alias event mapper add host alias host event get source get name event get data string else event get type host remove alias event mapper remove host alias event get data string	should probably called later	host host host server factory get server find service domain get container find child name string aliases host find aliases host add container listener	name null host host host server factory get server find service domain get container find child name mapper remove host name host remove container listener log debug enabled log debug sm get string mapper listener unregister host name domain	add alias existing host param name name host param alias alias add public synchronized void add host alias string name string alias int pos find hosts name pos should adding alias host doesn exist just case return host real host hosts pos host new hosts new host hosts length host new host new host new host name alias new host context list real host context list new host object real host insert map hosts new hosts new host hosts new hosts remove host alias param alias alias remove public synchronized void remove host alias string alias find remove alias int pos find hosts alias pos return host new hosts new host hosts length remove map hosts new hosts alias hosts new hosts	find map element given its name sorted array map elements
protected string get path without context final string context path final string servlet path servlet path starts context path return servlet path substring context path length return servlet path	string context get path without context norm context get context path normalized
do filter filter class type args principal	perform work particular code subject code here work	do privilege method name target object target type target arguments null perform work particular code subject code here work granted code null code subject param method name method apply security restriction param target object code filter code which method called param target type code class code array used instanciate code method code object param target arguments code object code array contains runtime parameters instance param principal code principal code which security privilege apply public static void do privilege final string method name final filter target object final class target type final object target arguments principal principal throws java lang exception	execute method target object target arguments principal
jar file null compiler get page info add dependant abs file name else compiler get page info add dependant jar file url external form abs file name substring
class clazz exception get class	response reset buffer
need do privileged block every web app has permission read default private static final char line sep system get property line separator char array
request get coyote request get parameters set query string encoding request get connector get uriencoding
threshold default file item factory default size threshold small threshold use memory output stream new byte array output stream threshold else large threshold use default array expand required memory output stream new byte array output stream default file item factory default size threshold
protected volatile long last accessed time creation time	protected volatile long accessed time creation time
protected void post construct object instance final class clazz method methods null globals security enabled methods access controller do privileged new privileged action method public method run return clazz get declared methods else methods clazz get declared methods	field fields null globals security enabled final class clazz2 clazz fields access controller do privileged new privileged action field public field run return clazz2 get declared fields else fields clazz get declared fields	method methods null globals security enabled final class clazz2 clazz methods access controller do privileged new privileged action method public method run return clazz2 get declared methods else methods clazz get declared methods
return weak etag return get etag false get etag param strong true strong etag returned return etag public string get etag boolean strong strong strong etag must always calculated resources strong etag null return strong etag attributes null attribute attribute attributes get etag attribute null try strong etag attribute get string catch naming exception value attribute return strong etag else weak etag content lenght last modified weak etag null weak etag get content length get last modified return weak etag
-1
public static final string session cookie name system get property org apache catalina session cookie name jsessionid public static final string session parameter name system get property org apache catalina session parameter name jsessionid	public static final string single sign cookie system get property org apache catalina constants sso session cookie name	public static final string session parameter name system get property org apache catalina session parameter name jsessionid properties property name org apache catalina session cookie name alternative name session cookie defaults code jsessionid code note servlet requires code jsessionid code you should rely being able change property property name org apache catalina session parameter name alternative name session path parameter defaults code jsessionid code note servlet requires code jsessionid code you should rely being able change property property name org apache catalina sso session cookie name alternative name single sign session cookie defaults code code property properties
process tlds add lifecycle listener new tld config	startup event listener context configures application listeners configured any tld files	public void lifecycle event lifecycle event event identify context we associated try context context event get lifecycle catch class cast exception log error sm get string tld config cce event get lifecycle return event get type equals lifecycle init event init else event get type equals lifecycle start event try execute catch exception log error sm get string tld config execute context get path ignore other event types nothing do private void init tld digester null check attribute has been defined context element set tld validation context get tld validation set tld namespace aware context get tld namespace aware attribute wasn defined context try host tld validation set tld validation standard host context get parent get xml validation tld namespace aware set tld namespace aware standard host context get parent get xml namespace aware tld digester digester factory new digester tld validation tld namespace aware new tld rule set tld digester get parser
host host engine find child hostname	number messages we have written	number last message procssed message ids based protected atomic long last message processed new atomic long messages received out order held buffer until required everything worked expected messages spend very little time buffer protected map long file message msg buffer new concurrent hash map long file message	flag indicates thread writing messages disk access flag must synchronised protected boolean writing false	msg get message number last message processed get duplicate message already processed log warn receive message again sender act timeout too short path msg get context path war msg get file name data msg get data data length msg get data length return false file message previous msg buffer put new long msg get message number msg previous null duplicate message yet processed log warn receive message again sender act timeout too short path msg get context path war msg get file name data msg get data data length msg get data length return false file message next null synchronized writing next msg buffer get new long last message processed get next null writing true else return false else return false while next null out write next get data next get data length last message processed increment get next get message number next get total nr msgs synchronized next msg buffer get new long last message processed get next null writing false	msg buffer clear last message processed null
message null mod jk httpd fails null status message bug 45026 message integer string res get status use accept ranges should accept ranges header included responses where appropriate true
should accept ranges bytes header send static resources protected boolean use accept ranges true	get servlet config get init parameter use accept ranges null use accept ranges boolean parse boolean get servlet config get init parameter use accept ranges	use accept ranges accept ranges header response set header accept ranges bytes tr th valign top use accept ranges th td valign top true accept ranges header set when appropriate response true td tr
get combined path	combine servlet path path info path info code null code ignored servlet path code null code code null code returned return combined path path info appended servlet info private string get combined path servlet path null return null path info null return servlet path return servlet path path info	get combined path	get combined path
string value request get header header value null buf append else buf append value
try selector close catch exception ignore exclude name org apache tomcat bayeux exclude name org apache cometd property name cometd api jar value tomcat extras cometd api jar property name tomcat bayeux jar value tomcat extras tomcat bayeux jar property name cometd war value tomcat extras cometd war target name bayeux mkdir dir tomcat extras copy todir tomcat extras file json lib home json lib jar classpath path id tomcat bayeux classpath pathelement path tomcat classpath pathelement path json lib home json lib jar path compile org apache tomcat bayeux compile org apache cometd javac srcdir java destdir tomcat classes debug compile debug deprecation compile deprecation source compile source optimize compile optimize classpath refid tomcat bayeux classpath include name org apache tomcat bayeux include name org apache cometd javac cometd api jar file jar jarfile cometd api jar fileset dir tomcat classes exclude name package html exclude name local strings include name org apache cometd fileset jar cometd api jar file jar jarfile tomcat bayeux jar fileset dir tomcat classes exclude name package html exclude name local strings include name org apache tomcat bayeux fileset jar zip zipfile cometd war fileset dir basedir webapps cometd include name fileset zip checksum file cometd api jar force overwrite yes fileext md5 checksum file tomcat bayeux jar force overwrite yes fileext md5 checksum file tomcat extras json lib jar force overwrite yes fileext md5 echo you ve built tomcat bayeux libraries simply add following libraries your catalina home lib directory cometd api jar tomcat bayeux jar tomcat extras json lib jar cometd war echo target target name extras depends prepare commons logging webservices bayeux licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface represents server side api bayeux messaging protocol bayeux simple subscribe publish receive methodology far from jms much simplified br used both actual server side clients br server side clients use create retrieve subscribe channels server side clients represented just like remote clients through client interface br bayeux intended thread safe multiple threads may call bayeux methods br bayeux object starting point any cometd application relying bayeux object dependent container bayeux object stored code javax servlet servlet context code object attribute under name code bayeux dojox cometd bayeux code br retrieve object one would simply call br code bayeux bx bayeux get servlet context get attribute bayeux dojox cometd bayeux br br bayeux protocol pretty straight forward includes bunch messaging needed known clients both server side remote clients object gets initialized container dependent servlet servlet handles all bayeux from client remote messsages delivered channels server side clients using code listener code interface br br code bayeux session code active long webapp hosting bayeux object active br when shuts down bayeux object unsubscribe all clients remove all active channels author greg wilkins author filip hanik meta definitions channels public static final string meta meta meta definitions channels public static final string meta slash meta meta definitions channels connect message public static final string meta connect meta connect meta definitions channels client messsage public static final string meta client meta client meta definitions channels disconnect messsage public static final string meta disconnect meta disconnect meta definitions channels handshake messsage public static final string meta handshake meta handshake meta definitions channels ping messsage public static final string meta ping meta ping meta definitions channels reconnect messsage deprecated public static final string meta reconnect meta reconnect meta definitions channels status messsage public static final string meta status meta status meta definitions channels subscribe messsage public static final string meta subscribe meta subscribe meta definitions channels unsubscribe messsage public static final string meta unsubscribe meta unsubscribe field names inside bayeux messages field names inside bayeux messages client id field public static final string client field client id field names inside bayeux messages data field public static final string data field data field names inside bayeux messages channel field public static final string channel field channel field names inside bayeux messages id field public static final string id field id field names inside bayeux messages error field public static final string error field error field names inside bayeux messages timestamp field public static final string timestamp field timestamp field names inside bayeux messages transport field public static final string transport field transport field names inside bayeux messages advice field public static final string advice field advice field names inside bayeux messages successful field public static final string successful field successful field names inside bayeux messages subscription field public static final string subscription field subscription field names inside bayeux messages ext field public static final string ext field ext field names inside bayeux messages connection type field public static final string connection type field connection type field names inside bayeux messages version field public static final string version field version field names inside bayeux messages minimum version field public static final string min version field minimum version field names inside bayeux messages supported connection types field public static final string supp connection type field supported connection types field names inside bayeux messages json comment filtered field public static final string json comment filtered field json comment filtered field names inside bayeux messages reconnect field public static final string reconnect field reconnect field names inside bayeux messages interval field public static final string interval field interval field values inside bayeux messages retry response public static final string retry response retry field values inside bayeux messages handshake response public static final string handshake response handshake field values inside bayeux messages none response public static final string none response none service channel names starts public static final string service service service channel names trailing slash public static final string service slash service transport types transport types long polling public static final string transport long poll long polling transport types callback polling public static final string transport callback poll callback polling transport types iframe public static final string transport iframe iframe transport types flash public static final string transport flash flash servlet context attribute name used obtain bayeux object public static final string dojox cometd bayeux dojox cometd bayeux http field names http helpers text json content type public static final string json content type text json http helpers parameter name json message public static final string message parameter message http helpers name jsonp parameter public static final string jsonp parameter jsonp http helpers default name jsonp callback function public static final string jsonp default name client creates new server side client method invoked server side objects only you cannot create remote client using method client represents entity can subscribe channels publish receive messages through channels param idprefix string prefix string id generated can null param listener listener callback object called when messages delivered new client return client returns client interface public client new client string idprefix listener listener retrieve client based id return null client doesn exist param clientid string return client null client doesn exist returns client does public client get client string clientid returns non modifiable list all clients currently active bayeux session return list client list containing all clients list can modified public list client get clients returns true client given id exists br same executing code get client id null code param client id string return boolean true client exists public boolean has client string client id removes client all together unsubscribe client any channels may subscribed remove from list param client client return client returns client removed null client removed public client remove client client channel returns channel given channel id channel doesn exist code create code parameter set true channel created added list active channels br code create code set false channel doesn exist null returned param channel id string id channel retrieved created param create boolean true bayeux impl should create channel return channel null code create code set false channel doesn exist otherwise returns channel object public channel get channel string channel id boolean create returns list currently active channels bayeux session return list channel public list channel get channels removes channel from bayeux object also unsubscribe all clients currently subscribed channel param channel channel channel removed return channel returns channel removed null channel removed public channel remove channel channel returns true channel given channel id exists br same executing code bayeux get channel channel id false null code param channel id string return boolean true channel exists public boolean has channel string channel id message creates new message sent server side client return message returns new message object has unique id public message new message client from security policy returns security policy associated bayeux session return security policy public security policy get security policy sets security policy used bayeux session param security policy security policy public void set security policy security policy security policy licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux channel represents channel used receive messages from publish messages order publish messages receive messages from one must subscribe channel easily done invoking code subscribe code method channel created calling code bayeux get channel channel id true code method channel can created either server side invoking get channel client side using meta subscribe message without wildcard author greg wilkins author filip hanik returns id channel id unique within bayeux session return string never null public string get id publishes message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msg publishes more than one message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msgs non persistent channels removed when last subscription removed persistent channels survive periods without any subscribers return true channel persist without any subscription public boolean persistent param persistent true channel persist without any subscription see persistent public void set persistent boolean persistent subscribes client channel param subscriber client subscribed client already subscribed call create duplicate subscription public void subscribe client subscriber unsubscribes client from channel param subscriber client subscribed return returns client unsubscribed null client wasn subscribed public client unsubscribe client subscriber returns non modifiable list all subscribers channel return list subscribers public list client get subscribers adds data filter channel all messages received channel run through filter param filter filter public void add filter data filter filter removes filter from channel returns filter removed null filter wasn channel param filter filter return filter null filter removed otherwise returns filter removed public data filter remove filter data filter filter licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license client may subscribe channels publish messages channels client instances should directly created uses should obtained via link bayeux get client string link bayeux new client string listener methods three types client may represented interface nl li server remote client connected via http created bayeux server when connect message comes li li server side client created application using link bayeux new client string listener method li li java client connected remote bayeux server implemented li nl author greg wilkins author filip hanik returns unique id client id unique within bayeux session return string null public string get id returns true client holding messages delivered remote client method always returns false local clients since messages delivered instantly using listener callback object return boolean public boolean has messages deliver message client only deliver message directly client message filtered published channel param message public void deliver message message deliver batch messages client only deliver batch messages directly client messages filtered published channel param message public void deliver message message return true client local false client either remote http client java client remote server public boolean local starts batch messages delivered until end batch called batches can nested messages only delivered after last end batch has been called public void start batch ends batch since batches can nested messages only delivered after end batch has been called many times start batch has public void end batch licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license data filter br data filters used transform data sent channel messages filtered message published channel invoking link channel publish message method br method gets invoked two different scenarios first being when message received from remote client bayeux invokes publish method directly second scenario when local client invokes link channel publish message directly local jvm author greg wilkins author filip hanik runs message through filter filtering can only modify existing object can replace param data message message filtered may null public void filter message data licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license cometd listener interface br local clients order receive messages pass callback object when local client created using link bayeux new client string listener method callback object implementing listener interface used deliver messages local jvm clients author greg wilkins author filip hanik method called when client removed explicitly from timeout param timeout true client removed from timeout false removed explicitly public void removed boolean timeout invoked when message delivered client message contains message itself well what channel message came through who sender someone invoked link client deliver message channel reference null param msg public void deliver message msg licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux message br bayeux message map string object key value pairs representing data message message contains information about channel published through who sender author greg wilkins author filip hanik returns reference client sent message return client may null public client get client returns reference channel message published throuhg return channel may null public channel get channel returns unique id message return string public string get id sets time live milliseconds message hasn been delivered when time passed after creation time longer than ttl message expire removed from any delivery queues param ttl long public void set ttl long ttl returns time live milliseconds message return long public long get ttl returns timestamp milliseconds system current time millis when message created return long public long get creation time licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author greg wilkins boolean can handshake message message boolean can create client client string channel message message boolean can subscribe client client string channel message messsage boolean can publish client client string channel message messsage licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public bayeux exception super public bayeux exception string message super message public bayeux exception string message throwable cause super message cause public bayeux exception throwable cause super cause licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface defines methods managing bayeux request meta messages author guy molinari author filip hanik version public static final string last req attr org apache cometd bayeux last request public static final string current req attr org apache cometd bayeux current request public static final string json msg array org apache cometd bayeux json msg array validates specific request method must called prior process request can do pre processing validate method br should validation fail error object returned containing error message potentially stack trace exception generated return http error null error detected http error object containing information about error public http error validate processes remote client bayeux message param prevops operation requested previous request case chained requests return int returns interest operation comet event currently used throws bayeux exception error detected appropriate error response couldn delivered client public int process int prevops throws bayeux exception licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik author guy molinari version attribute hold tomcat bayeux object servlet context public static final string tomcat bayeux attr bayeux dojox cometd bayeux logger object protected static log log log factory get log bayeux servlet class servlet config future use protected servlet config servlet config reference global tomcat bayeux object protected tomcat bayeux tb upon servlet destruction servlet clean up tomcat bayeux object terminate any outstanding events public void destroy servlet config null do close all outstanding comet events tb destroy tb null do close everything down returns connection timeout timeout has been configured servlet init parameter named code timeout code default 2min used return int timeout connection milliseconds protected int get timeout string timeout servlet config get init parameter timeout int timeout 120 1000 min try timeout integer parse int timeout catch number format exception nfe ignore we have default value return timeout protected int get reconnect interval string rs servlet config get init parameter reconnect interval int rct 5000 seconds try rct integer parse int rs catch number format exception nfe ignore we have default value return rct public void event comet event comet event throws ioexception servlet exception comet event event type type comet event get event type log debug enabled log debug thread current thread get name received comet event type type subtype comet event get event sub type synchronized comet event type comet event event type begin begin event set timeout comet event set timeout get timeout check bayeux comet event read event should always come else type comet event event type read check bayeux comet event else type comet event event type error tb remove comet event comet event close else type comet event event type end tb remove comet event comet event close end synchronized event param comet event comet event return boolean true we comet event stays open throws ioexception throws unsupported operation exception protected void check bayeux comet event comet event throws ioexception unsupported operation exception we actually have data data can text json bayeux json content type equals comet event get http servlet request get content type read decode bytes according content length log warn thread current thread get name json encoding supported throw exception abort request int comet event get http servlet request get content length throw new unsupported operation exception decoding bayeux json content type yet implemented else get method application www form urlencoded string message comet event get http servlet request get parameter bayeux message parameter log trace enabled log trace thread current thread get name received json message message try int action handle bayeux message comet event log debug enabled log debug thread current thread get name bayeux handling complete action result action action comet event close catch exception print stack trace tb remove comet event log error comet event close protected int handle bayeux string message comet event event throws ioexception servlet exception int result message null message length return result try bayeux request request null message can array messages jsonarray js array new jsonarray message int js array length jsonobject msg js array get jsonobject log debug enabled log debug thread current thread get name processing bayeux message msg request request factory get request tb event msg log debug enabled log debug thread current thread get name processing bayeux message using request request result request process result log debug enabled log debug thread current thread get name processing bayeux message result result result request null event get http servlet request set attribute bayeux request last req attr request client impl ci client impl tb get client request base request get client id ci add comet event event log debug enabled log debug thread current thread get name done bayeux message added request attribute else result request null request base deliver event client impl tb get client request base request get client id log debug enabled log debug thread current thread get name done bayeux message delivered client catch log error do impl error handling result catch bayeux exception log error do impl error handling result return result public servlet config get servlet config return servlet config public string get servlet info return tomcat bayeux servlet public void init servlet config servlet config throws servlet exception servlet config servlet config servlet context ctx servlet config get servlet context ctx get attribute tomcat bayeux attr null ctx set attribute tomcat bayeux attr new tomcat bayeux tb tomcat bayeux ctx get attribute tomcat bayeux attr tb set reconnect interval get reconnect interval public void service servlet request servlet request servlet response servlet response throws servlet exception ioexception servlet response instanceof http servlet response http servlet response servlet response send error 500 tomcat server must configured support comet operations else throw new servlet exception tomcat server must configured support comet operations bayeux protocol licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected static log log log factory get log channel impl class unique id channel protected string id null list current subscribers protected linked list client subscribers new linked list client list current filters protected linked list data filter filters new linked list data filter channel persistent default value true protected boolean persistent true creates new channel param id string id channel can null protected channel impl string id assert id null id id returns id channel return string public string get id return id returns true channel matches pattern its id channel pattern can complete name like code service mychannel code can wild card pattern like code service app2 code param pattern string according bayeux section channel globbing can null return boolean true id channel matches pattern public boolean matches string pattern pattern null throw new null pointer exception channel pattern must null get id equals pattern return true int wildcard pos pattern index wildcard pos return false boolean multi segment pattern index string lead substring pattern substring wildcard pos lead substring null return false multi segment return get id starts lead substring else get id length wildcard pos return false return get id substring wildcard pos contains return returns non modifiable list subscribers channel public list client get subscribers return collections unmodifiable list subscribers return true channel persist without any subscription public boolean persistent return persistent public void publish message msg publish new message msg public void publish message msgs msgs null return message impl imsgs new message impl msgs length int msgs null msgs length message data msgs data instanceof message impl throw new illegal argument exception invalid message class you can only publish messages created through bayeux new message method log debug enabled log debug publishing message data channel clone so we can set channel reference message impl msg message impl message impl data clone channel delivered through msg set channel pass through filters iterator data filter filters iterator has next next filter msg imsgs msg deliver clients iterator client subscribers iterator has next client impl client impl next deliver internal imsgs public void set persistent boolean persistent persistent persistent public void subscribe client subscriber subscribers contains subscriber subscribers add last subscriber client impl subscriber subscribed public client unsubscribe client subscriber subscribers remove subscriber client impl subscriber unsubscribed return subscriber else return null public void add filter data filter filter filters contains filter filters add last filter public data filter remove filter data filter filter filters remove filter return filter else return null public string string string buffer buf new string buffer super string buf append channel id append get id return buf string licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final int support callback poll 0x1 public static final int support long poll 0x2 public static final string comet event attr org apache cometd bayeux client protected static log log log factory get log client impl class protected static linked list message empty list new linked list message queued message remote clients protected linked list message messages null protected queue comet event events new linked list comet event unique id representing client protected string id supported connection types defaults long polling protected int supported conn types support long poll support callback poll desired connection type protected int desirect conn type support long poll does client use json comment filtered messages protected boolean use json filtered false same jvm clients get local true protected boolean local callback object local clients protected listener listener protected atomic integer new atomic integer protected client impl string id boolean local id id local local local messages new linked list message protected client impl string id comet event event id false events new concurrent linked queue comet event add comet event event public synchronized void deliver message message deliver internal null new message impl message impl message public synchronized void deliver message message deliver internal null message protected synchronized void deliver internal channel impl channel message impl message deliver internal channel new message impl message protected synchronized void deliver internal channel impl channel message msgs local local clients must have listener array list message list new array list message int msgs null msgs length msgs get client list add msgs get listener null get listener deliver list array new message else int msgs null msgs length message impl message message impl msgs message get client dont deliver ourself continue we implementing forever responses client connected we fire off message first we check see we have any existing connections we can piggy back comet event event events poll boolean delivered false todo todo check thread safety writing getting last request event null synchronized event request base rq request base event get http servlet request get attribute request base last req attr rq null map map new hash map try map put bayeux channel field message get channel get id map put bayeux data field message jsonobject json new jsonobject map log debug enabled log debug message instantly delivered remote client message json rq add delivery queue json deliver batch msgs length rq deliver event event close todo figure out better way means only one message gets delivered remove comet event event delivered instantly delivered true catch exception log error delivered log debug enabled log debug message added queue remote client message message queue message next round messages add message public string get id return id protected listener get listener return listener public boolean has messages local return false else return messages size public boolean local return local public int get supported conn types return supported conn types public int get desirect conn type return desirect conn type public boolean use json filtered return use json filtered public void set listener listener listener listener listener public void set supported conn types int supported conn types supported conn types supported conn types public void set use json filtered boolean use json filtered use json filtered use json filtered public void set desirect conn type int desirect conn type desirect conn type desirect conn type public boolean supports callback poll return supported conn types support callback poll support callback poll public boolean supports long poll return supported conn types support long poll support long poll public synchronized list message take messages local return null messages size return empty list list result new linked list messages messages clear return result public string string string buffer buf new string buffer super string buf append id append get id return buf string public boolean subscribed return get protected synchronized boolean add comet event comet event event boolean result false events contains event events add event result true event get http servlet request set attribute comet event attr return result protected synchronized boolean remove comet event comet event event boolean result events remove event event get http servlet request remove attribute comet event attr return result protected void subscribed channel impl ch add get protected void unsubscribed channel impl ch add get public void start batch noop until improved public void end batch noop until improved private int code private string status private throwable cause public http error int code string status throwable cause code code status status cause cause public void set code int code code code public void set status string status status status public void set cause throwable exception cause exception public int get code return code public string get status return status public throwable get cause return cause public string string cause null return code status cause else return code status licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license protected channel channel protected client client protected string id private long ttl 1000 60 5min default ttl message protected long creation time system current time millis public object clone message impl copy new message impl id copy put all copy channel channel copy client client copy id id copy creation time creation time copy ttl ttl return copy protected message impl string id assert id null id id public channel get channel return channel public client get client return client public long get creation time return creation time public long get ttl return ttl public string get id return id protected void set channel channel channel channel channel protected void set client client client client client public void set ttl long ttl ttl ttl licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license common member variables all bayeux requests author guy molinari author filip hanik version protected static final simple date format timestamp fmt new simple date format yyyy mm dd hh mm ss sssz static timestamp fmt set time zone time zone get time zone gmt message properties combined all messages protected tomcat bayeux tomcat bayeux protected string channel protected string id protected string client id protected string version null protected string supp conn types null protected int supp conn types flag protected int desired conn type flag protected string min version null protected string subscription null protected string data null protected string con type null protected linked hash map string object ext new linked hash map string object protected comet event event protected hash map string object response null protected static log log log factory get log request base class protected int reconnect interval protected request base tomcat bayeux tb comet event event jsonobject js req throws tomcat bayeux tb event event channel js req opt string bayeux channel field id js req opt string bayeux id field client id js req opt string bayeux client field version js req opt string bayeux version field min version js req opt string bayeux min version field con type js req opt string bayeux connection type field subscription js req opt string bayeux subscription field data js req opt string bayeux data field reconnect interval tb get reconnect interval js req has bayeux ext field jsonobject jext js req get jsonobject bayeux ext field iterator string jext keys has next string key next ext put key jext get key end js req has bayeux supp connection type field jsonarray types js req get jsonarray bayeux supp connection type field supp conn types new string types length int types length supp conn types types get string bayeux transport callback poll equals supp conn types supp conn types flag supp conn types flag client impl support callback poll else bayeux transport long poll equals supp conn types supp conn types flag supp conn types flag client impl support long poll end con type null bayeux transport callback poll equals con type desired conn type flag client impl support callback poll else bayeux transport long poll equals con type desired conn type flag client impl support long poll end due fact javascript doesn send up required field we have fake supp conn types flag client impl support callback poll client impl support long poll public http error validate http error result null return result public tomcat bayeux get tomcat bayeux return tomcat bayeux public string get channel return channel public string get id return id public string get client id return client id public linked hash map get ext return ext public comet event get event return event protected static void deliver comet event event client impl throws ioexception servlet exception bayeux exception jsonarray jarray get jsonarray event true jarray null throw new bayeux exception message send string jsonstring jarray string log debug enabled log debug thread current thread get name delivering message message jsonstring print writer out event get http servlet response get writer null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll string jsonp event get http servlet request get parameter bayeux jsonp parameter jsonp null jsonp bayeux jsonp default name out print jsonp out print else throw new bayeux exception client doesn support any appropriate connection type out print jsonstring null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll out print out flush event get http servlet response flush buffer protected static jsonarray get jsonarray comet event event boolean nullok synchronized event jsonarray jarray jsonarray event get http servlet request get attribute json msg array jarray null nullok jarray new jsonarray event get http servlet request set attribute json msg array jarray return jarray protected jsonarray get jsonarray return get jsonarray event false protected void add delivery queue client impl jsonobject msg throws ioexception servlet exception bayeux exception synchronized event get jsonarray put msg protected void flush messages client impl client throws bayeux exception list message msgs client take messages synchronized event try iterator message msgs iterator has next message impl msg message impl next map map new hash map map put bayeux channel field msg get channel get id msg get client null map put bayeux client field msg get client get id map put bayeux data field msg jsonobject obj new jsonobject map add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception public int process int prevops throws bayeux exception event get http servlet request set attribute current req attr return prevops public int get reconnect interval return reconnect interval public string get time stamp return timestamp fmt format new date system current time millis licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static bayeux request get request tomcat bayeux tomcat bayeux comet event event jsonobject msg throws string channel msg opt string bayeux channel field bayeux meta handshake equals channel return new meta handshake request tomcat bayeux event msg else bayeux meta connect equals channel return new meta connect request tomcat bayeux event msg else bayeux meta disconnect equals channel return new meta disconnect request tomcat bayeux event msg else bayeux meta subscribe equals channel return new meta subscribe request tomcat bayeux event msg else bayeux meta unsubscribe equals channel return new meta unsubscribe request tomcat bayeux event msg else return new publish request tomcat bayeux event msg licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected int reconnect interval 5000 list all active clients protected hash map string client clients new hash map string client list all active channels protected linked hash map string channel channels new linked hash map string channel security policy used protected security policy security policy null default client use when we need send error message don have client valid reference protected static client impl error client new client impl error client false returns default error client return client impl public static client impl get error client return error client protected tomcat bayeux should invoked when servlet destroyed when context shuts down public void destroy throw new unsupported operation exception tomcat bayeux destroy yet implemented public channel get channel string channel id boolean create channel result channels get channel id result null create result new channel impl channel id channels put channel id result return result public channel remove channel channel return channels remove channel get id public client remove client client client null return null channel ch get channels ch unsubscribe client return clients remove client get id public client get client string client id return clients get client id public boolean has client string client id return clients contains key client id public list client get clients return java util arrays list clients entry set array new client public security policy get security policy return security policy public int get reconnect interval return reconnect interval public boolean has channel string channel return channels contains key channel public client new client string idprefix listener listener boolean local comet event event string id create uuid idprefix client impl client new client impl id local client set listener listener clients put id client return client public client new client string idprefix listener listener assert listener null method gets called someone using api inside jvm local client return new client idprefix listener true null protected client impl get client impl comet event event return client impl event get http servlet request get attribute client impl comet event attr protected void remove comet event event client impl client get client impl event client null client remove comet event event public string create uuid string idprefix idprefix null idprefix return idprefix arrays string random uuid false public list channel get channels return java util arrays list channels entry set array new channel protected message new message string id create uuid msg return new message impl id public message new message client from message impl msg message impl new message msg set client from return msg public void set security policy security policy security policy security policy security policy public void set reconnect interval int reconnect timeout reconnect interval reconnect timeout licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta connect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta connect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req client id null get tomcat bayeux has client client id event get http servlet request set attribute client get tomcat bayeux get client client id check client request validity per section bayuex spec connect request must contain meta connect channel identifier client id returned server after handshake desired connection type must one server supported types returned handshake response return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null bayeux transport long poll equals con type bayeux transport callback poll equals con type return new http error 400 unsupported connection type null return null error transition connected state flushing pending messages available pending messages flush connection held until pending publish event delivered client section spec public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id boolean success false http error error validate error null client set desirect conn type desired conn type flag hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval success true else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return immediately so we can process next message int result client subscribed success client null client has messages send out messages flush messages client result flush out messages return result licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta disconnect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta disconnect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta disconnect channel identifier client id return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error disconnect client session public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else get tomcat bayeux remove client response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect none client null client tomcat bayeux get error client response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta handshake response template put bayeux version field response template put bayeux supp connection type field new string bayeux transport long poll bayeux transport callback poll response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta handshake request tomcat bayeux tomcat bayeux comet event event jsonobject js req throws super tomcat bayeux event js req public string get version return version public string get minimum version return min version check client request validity per section bayuex spec handshake request must contain meta handshake channel identifier version protocol supported client client supported connection types return http error method returns null errors were found public http error validate boolean error version null version length error error supp conn types flag error return new http error 400 invalid handshake request supported connection type field missing null else return null generate return client identifier return list supported connection types must subset identical list types supported client see section bayuex public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client null http error error validate error null client client impl get tomcat bayeux new client http null false get event client id client get id client set supported conn types supp conn types flag client set use json filtered get ext get bayeux json comment filtered field null response put bayeux client field client get id hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string client tomcat bayeux get error client hash map response get bayeux advice field put bayeux reconnect field bayeux none response try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta subscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta subscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta subscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error register interest one more channels per section bayeux spec pattern may specified assign client matching channels inverse client channel reference public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean subscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch subscribe client subscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch subscribe client subscribed true response put bayeux successful field boolean value subscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta unsubscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta unsubscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta unsubscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error de register interest one more channels per section bayeux spec pattern may specified sever public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean unsubscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch unsubscribe client unsubscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch unsubscribe client unsubscribed true response put bayeux successful field boolean value unsubscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version jsonobject msg data null protected static hash map string object response template new hash map string object static response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public publish request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain channel identifier channel publication data send return http error method returns null errors were found public http error validate channel null get tomcat bayeux has channel channel return new http error 400 channel id valid null data null data length return new http error 400 message data missing null try msg data new jsonobject data catch return new http error 400 invalid json object data attribute client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error send event message all registered subscribers public int process int prevops throws bayeux exception prevops super process prevops response hash map string object response template clone client impl client client id null client impl get tomcat bayeux get client client id client impl event get http servlet request get attribute client boolean success false http error error validate error null channel impl chimpl channel impl get tomcat bayeux get channel channel false message impl mimpl message impl get tomcat bayeux new message client try string keys jsonobject get names msg data int keys length mimpl put keys msg data get keys success true hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval catch log error enabled log error unable parse msg data throw new bayeux exception chimpl publish mimpl success response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux channel field channel response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception success client null client has messages send out messages flush messages client return static atomic integer counter new atomic integer protected int id protected bayeux protected client protected boolean alive true protected timestamp thread tt new timestamp thread public echo chat client id counter increment get system out println new listener created id id context destroyed param servlet context event servlet context event todo implement javax servlet servlet context listener method public void context destroyed servlet context event servlet context event alive false tt interrupt context initialized param servlet context event servlet context event todo implement javax servlet servlet context listener method public void context initialized servlet context event servlet context event public void attribute added servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux bayeux scae get value new client echochat channel ch get channel chat demo true ch subscribe tt start public void attribute removed servlet context attribute event servlet context attribute event public void attribute replaced servlet context attribute event servlet context attribute event public void removed boolean timeout system out println client removed public void deliver message msgs int msgs null msgs length message msg msgs system out println received message msg message new message put all msg echo same message put user contains key msg simple chat demo string chat string get msg put msg received your message chat substring chat index system out println sending message msg get channel publish public class timestamp thread extends thread public timestamp thread set daemon true public void run while alive try sleep 5000 channel ch get channel chat demo false ch get subscribers size continue message new message put user put chat time new java sql date system current time millis locale string put join false ch publish catch interrupted exception ignore catch exception print stack trace channels filter org mortbay cometd filter markup filter init channels chat filter org mortbay cometd filter regex filter init channels chat filter org mortbay cometd filter regex filter init xmlns http java sun com xml ns javaee xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version display name cometd test web app display name servlet servlet name cometd servlet name servlet class org apache tomcat bayeux bayeux servlet servlet class init param param name timeout param name param value 120000000 param value init param load startup load startup servlet servlet mapping servlet name cometd servlet name url pattern cometd url pattern servlet mapping border 0px solid black background color e0e0e0 border 1px solid black width 45em height 20ex overflow auto background color f0f0f0 padding 4px border 0px solid black clear both padding 4px border 0px solid black border top 1px solid black width 28em background color e0f0f0 width 14em background color e0f0f0 display none font weight bold font style italic last username null connected true join function name name null name length alert please enter username else dojox cometd init new string document location replace http replace examples cometd dojox cometd init http 127 8080 cometd connected true username name dojo id join class name hidden dojo id joined class name dojo id phrase focus subscribe join dojox cometd subscribe chat demo room chat dojox cometd publish chat demo user room username join true chat room username has joined handle cometd failures while room room meta dojo subscribe cometd meta dojo hitch function event console debug event event action handshake dojox cometd subscribe chat demo room chat else event action connect room chat data leave true user server chat reconnected room chat data leave true user server chat disconnected leave function room username null return dojo unsubscribe room meta dojox cometd unsubscribe chat demo room chat dojox cometd publish chat demo user room username leave true chat room username has left switch input form dojo id join class name dojo id joined class name hidden dojo id username focus room username null dojox cometd disconnect chat function text text text length return false dojox cometd publish chat demo user room username chat text chat function message var chat dojo id chat message data alert bad message format message return var from message data user var special message data join message data leave var text message data chat text return special from room last from else room last from from special chat inner html span class alert span class from from nbsp span span class text text span span br room last else chat inner html span class from from nbsp span span class text text span br chat scroll top chat scroll height chat client height init function dojo id join class name dojo id joined class name hidden dojo id username focus var element dojo id username element set attribute autocomplete off dojo connect element onkeyup function key code dojo keys enter room join dojo id username value return false return true dojo connect dojo id join onclick function room join dojo id username value prevent default element dojo id phrase element set attribute autocomplete off dojo connect element onkeyup function key code dojo keys enter room chat dojo id phrase value dojo id phrase value prevent default dojo id phrase value title cometd chat title script type text javascript src dojo dojo dojo js script script type text javascript src dojo dojox cometd js uncompressed js script script type text javascript src chat js script link rel stylesheet type text css href chat css div id chat div div id input div id join username nbsp input id username type text input id join class button type submit name join value join div div id joined class hidden chat nbsp input id phrase type text input id send class button type submit name join value send input id leave class button type submit name join value leave div div div loader js bootstrap module runs before hostenv js file contains all package loading methods function loader js bootstrap module runs before hostenv js file contains all package loading methods var dep reg exp dojo require require provide require after platform require require localization mg var match summary figure out whether path local domain return false xdomain current xdomain check whether relpath absolute url itself so we ignore base url var colon index relpath index var slash index relpath index colon index colon index slash index var bundle resource module name nls bundle name join var bundle resource dojo get object module name nls bundle name join summary loads bundle based whether module local xd overrides local case var module path module url module name string xd xdomain path module path call cross domain loader return dojo xd require localization apply dojo arguments else call local loader return dojo xd real require localization apply dojo arguments safari parse float dav split version function var bundle package module name nls bundle name join file defines comet protocol client actual message transport deferred one several connection type default long polling single global object named dojox cometd used mediate connection types order provide stable interface extensions modules may loaded eg dojox cometd timestamp use cometd extend list cometd extend out list fields provide functions extend handling incoming outgoing messages disconnected disconnected initialized false connected false connecting connecting initialized true connected false handshake sent connected connected initialized true connected true first successful connect disconnecing initialized false connected true disconnect sent else cometd connected file defines comet protocol client actual message transport deferred one several connection type default long polling single global object named dojox cometd used mediate connection types order provide stable interface extensions modules may loaded eg dojox cometd timestamp use cometd extend list cometd extend out list fields provide functions extend handling incoming outgoing messages disconnected disconnected initialized false connected false connecting connecting initialized true connected false handshake sent connected connected initialized true connected true first successful connect disconnecing initialized false connected true disconnect sent else cometd connected session null function msg var channel msg channel channel service ext session session msg data return msg out function msg var channel msg channel channel meta handshake session null msg ext msg ext msg ext session session return msg file provides time extension cometd timesync allows client server exchange time information every handshake connect message so client may calculate approximate offset from own clock epoch server each handshake connect extension sends timestamps within ext field like ext timesync tc 12345567890 where ts timestamp ms since 1970 when message sent cometd server supports timesync should respond ext field like ext timesync tc 12345567890 ts 1234567900 123 where ts timestamp sent client te timestamp server when message received poll duration ms ie time server took before sending response receipt response client able use current time determine total trip time from which subtracted determine approximate two way network traversal time assumption made network symmetric traversal time so offset between two clocks ts tc now tc practise networks cometd client server software never perfectly symmetric so accuracy limited difference which can 10s milliseconds order smooth over any transient fluctuations extension keeps sliding average offsets received default over 10 messages can changed dojox cometd timesync window element http www w3 org tr html4 strict dtd head title comet echo rpc title link rel stylesheet type text css href chat chat css link script type text javascript src dojo dojo dojo js uncompressed js script script type text javascript src dojo dojox cometd js uncompressed js script script type text javascript dojo require dojox cometd dojo require dojox cometd timestamp dojo id var echo behaviours phrase found function set attribute autocomplete off onkeyup function key code dojo keys enter echo rpc phrase value phrase value return false return true send onclick function echo rpc phrase value phrase value return false function set up var element dojo id phrase element set attribute autocomplete off dojo connect element onkeyup function key code dojo keys enter echo rpc phrase value phrase value return false return true element dojo id send dojo connect element onclick function echo rpc phrase value phrase value return false dojox cometd init new string document location replace http replace examples cometd dojox cometd subscribe service echo echo rpc return function echo rpc msg console debug msg dojox cometd publish service echo msg msg function echo rpc return msg dojo id responses inner html msg timestamp msg timestamp msg channel msg data msg dojo add load set up script head body h1 echo test h1 echo data only client using rpc style messaging over cometd requires server side component service echo which echos responses directly client div echo input id phrase type text input input id send class button type submit name join value send div pre id responses pre body dojo id message style visibility hidden dojox cometd init cometd cometd return str replace dojo id msgtext value dojo id msgtext focus key code 13 send trim dojo id msgtext value clear dojox cometd subscribe chat demo msg event dojo id login style visibility hidden dojo id message style visibility visible send has joined chat room clear dojo id msgtext onkeydown enter key handler dojo id myname append child document create text node dojo id scrname value break apart text string screen name message parts var str trim event data msg var scrname str match var spl str split scrname spl str spl insert screen name red message black dom var new document create element var fnt1 document create element font var attr1 document create attribute color attr1 node value red fnt1 set attribute node attr1 var new document create text node scrname fnt1 append child new new append child fnt1 var fnt2 document create element font var attr2 document create attribute color attr2 node value black fnt2 set attribute node attr2 var new t2 document create text node str fnt2 append child new t2 new append child fnt2 dojo id dialog append child new var scrname dojo id scrname value var evt data msg trim scrname msg msg event evt echo local dojox cometd publish chat demo evt data background color ffffcc text align center color black color black color yellow background color ccffcc padding left 20 padding right 20 border none margin auto padding 10px border bottom thin solid black border right thin solid black padding 10px border bottom thin solid black border right thin solid black border left thin solid black padding 10px border left thin solid black border bottom thin solid black padding 10px border top thin solid black border right thin solid black border bottom thin solid black padding 10px border top thin solid black border right thin solid black border left thin solid black border bottom thin solid black padding 10px border top thin solid black border left thin solid black border bottom thin solid black padding 10px border top thin solid black border right thin solid black padding 10px border top thin solid black border right thin solid black border left thin solid black padding 10px border top thin solid black border left thin solid black head title tic tac toe cometd example title meta http equiv content type content text html charset utf link rel stylesheet type text css href resources tictactoe css script type text javascript src dojo dojo dojo js script script type text javascript src dojo dojox cometd js uncompressed js script script type text javascript dojo require dojox cometd var 10 var var board new array var wins new array var turn num var winner var iam dojo add load function init arrays dojox cometd init cometd cometd dojox cometd subscribe demo tictactoe msg event function post me arg var move eval arg iam win dojo id myrole inner html game over return iam turn num dojo id gstatus inner html sorry you have wait until game ends return iam whose turn iam dojo id gstatus inner html your turn return turn move dojo id gstatus inner html valid move try again return var win win var turn whose turn var data move move win win turn turn board board turn num turn num dojox cometd publish demo tictactoe data msg event data data function msg event event var data event data blank 10 dojo id img src resources data board gif var status msg unfinished tie win win data win status msg tie else data win status msg wins else data win status msg wins else data win data turn 10 status msg turn else data win data turn status msg turn else status msg odd shouldn get here iam turn num dojo id myrole inner html you can join game you like else dojo id myrole inner html you currently spectator else iam dojo id myrole inner html you currently player else dojo id myrole inner html you currently player data win status msg status msg br href ttt1 html restart game write status message out here dojo id gstatus inner html status msg board data board winner data win turn num data turn num return false cell invalid move function turn cell cell cell return false invalid move winner return false iam iam turn num iam else iam board cell return false invalid move turn num turn num board cell else else board cell return true function whose turn turn num turn num return else return function done return turn num return win tie win win function win winner return winner var win sum board wins board wins board wins win sum winner else win sum 30 winner winner turn num winner return winner function init arrays wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins wins new array wins wins wins board board board board board board board board board script head body h1 tic tac toe h1 table tr td id cell0 img id img0 src resources gif onclick post me td td id cell1 img id img1 src resources gif onclick post me td td id cell2 img id img2 src resources gif onclick post me td tr tr td id cell3 img id img3 src resources gif onclick post me td td id cell4 img id img4 src resources gif onclick post me td td id cell5 img id img5 src resources gif onclick post me td tr tr td id cell6 img id img6 src resources gif onclick post me td td id cell7 img id img7 src resources gif onclick post me td td id cell8 img id img8 src resources gif onclick post me td tr table h2 id gstatus new game click start h2 br h2 id myrole h2 body http www w3 org tr html4 strict dtd head title comet echo rpc title link rel stylesheet type text css href chat chat css link script type text javascript src dojo dojo dojo js uncompressed js script script type text javascript src dojo dojox cometd js uncompressed js script script type text javascript dojo require dojox cometd dojo require dojox cometd timesync dojox cometd init new string document location replace http replace examples cometd var next var tick function set timeout tick 1000 script head body h1 time sync test h1 test uses timesync extension calculate timeoffset server div id time div body
-1
return true
-1
jjtn000 set prefix t0 image
sequence number temporary variables private int temp sequence number	generates new temporary variable name public string next temporary variable name parent root null return constants temp variable name prefix temp sequence number else return parent root next temporary variable name	temporary variable name get root next temporary variable name	return node get root next temporary variable name
public void set poller thread count int poller thread count endpoint set poller thread count poller thread count public int get poller thread count return endpoint get poller thread count public void set sendfile thread count int sendfile thread count endpoint set sendfile thread count sendfile thread count public int get sendfile thread count return endpoint get sendfile thread count fix bug 45074 bug add parameters http11apr protocol fix
log debug sm get string apr listener ssl init fix bug 44809 bug improve apr lifecycle listener error messages fix
server sock socket create address get info inet address family socket sock stream
info class loader loggers get current handler info handlers get handler name	return get class loader info class loader loggers get name	string prefix prefix get	info class loader loggers get current	class loader log info info class loader loggers get class loader	info class loader loggers get class loader	class loader log info info class loader loggers get class loader	log node child node current node children get next name
protected atomic integer count allocated new atomic integer	return count allocated get	count allocated increment get	count allocated increment get	while count allocated get instances	count allocated increment get	count allocated decrement get count allocated decrement get	count allocated get while retries 21 count allocated get count allocated string
param realm our associated jaasrealm instance param username username param password password param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest param auth method mehtod use string md5a2 string auth method	auth method auth method	methdod used null assume basic form protected string auth method	else cb get prompt equals auth method cb set text auth method	callback callbacks new callback	callbacks new text input callback auth method	string auth method null	auth method text input callback callbacks get text	auth method null basic form else auth method equals constants digest method else auth method equals constants cert method principal super get principal username else throw new login exception unknown method	param auth method scheme use nc cnonce qop realm name md5a2 constants digest method	return authenticate username new jaascallback handler username null null null null null null null constants cert method
construct callback handler digest param realm our associated jaasrealm instance param username username param password password param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest md5 method uri public jaascallback handler jaasrealm realm string username string password string nonce string nc string cnonce string qop string realm name string md5a2 realm username password nonce nonce nc nc cnonce cnonce qop qop realm name realm name md5a2 md5a2	server generated nonce protected string nonce null nonce count protected string nc null client generated nonce protected string cnonce null quality protection aplied message protected string qop realm name protected string realm name second md5 digest protected string md5a2 only recognizes link name callback link password callback link text input callback link text input callback ued pass various additional parameters required digest	else callbacks instanceof text input callback text input callback cb text input callback callbacks cb get prompt equals nonce cb set text nonce else cb get prompt equals nc cb set text nc else cb get prompt equals cnonce cb set text cnonce else cb get prompt equals qop cb set text qop else cb get prompt equals realm name cb set text realm name else cb get prompt equals md5a2 cb set text md5a2 else throw new unsupported callback exception callbacks	callback callbacks new callback callbacks new text input callback nonce callbacks new text input callback nc callbacks new text input callback cnonce callbacks new text input callback qop callbacks new text input callback realm name callbacks new text input callback md5a2 string nonce null string nc null string cnonce null string qop null string realm name null string md5a2 null nonce text input callback callbacks get text nc text input callback callbacks get text cnonce text input callback callbacks get text qop text input callback callbacks get text realm name text input callback callbacks get text md5a2 text input callback callbacks get text	md5a2 null using digest principal super authenticate username password else must using digest principal super authenticate username password nonce nc cnonce qop realm name md5a2	return code principal code associated specified username credentials one otherwise return code null code return authenticate username new jaascallback handler username credentials return code principal code associated specified username digest one otherwise return code null code param username username code principal code look up param client digest digest use username param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest md5 method uri public principal authenticate string username string client digest string nonce string nc string cnonce string qop string realm name string md5a2 return authenticate username new jaascallback handler username client digest nonce nc cnonce qop realm name md5a2 package methods protected methods perform actual jaas protected principal authenticate string username callback handler callback handler	login context new login context app name callback handler	return password associated given principal user name always returns null jaasrealm has way obtaining information
env sometime null shutdown bug45591 env null int env get handler count env get handler null env get handler pause
protected synchronized principal get principal string username
catch illegal access exception iae get logger error sm get string standard context application listener iae listeners iae ok false
pos aggregator null
close output stream used cgi output null cgi output close
doc base get canonical path starts app base get absolute path file separator
log warn enabled log warn sm get string delta manager wait session state get name mbr get state transfer timeout attribute name state transfer timeout required false time seconds wait session state transfer complete from another node when node starting up default value code 60 code seconds attribute
mb get char chunk recycle valid anymore
try socket close catch exception ignore
protected string get header value string object header value header value null return null header value instanceof date return date strings ie last modified http format rather than java format return fast http date format format date date header value get time null return header value string	object attr value attribute values next attribute value list add get header value string attr value	object attr value attribute get attribute size return get header value string attr value
spec says single sp also says tolerant ht buf pos constants sp buf pos constants ht	spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false	spec says single sp also says tolerant ht buf pos constants sp buf pos constants ht	spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false	spec says single sp also says tolerant ht buf pos constants sp buf pos constants ht	spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false	spec says single sp also says tolerant ht buf pos constants sp buf pos constants ht	spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false	buf pos constants sp buf pos constants ht	spec says single sp also tolerant multiple ht boolean space true while space read new bytes needed pos last valid fill true false request line parsing return false buf pos constants sp buf pos constants ht pos else space false buf pos constants sp buf pos constants ht	spec says single sp also tolerant multiple ht boolean space true while space read new bytes needed pos last valid fill true false request line parsing return false buf pos constants sp buf pos constants ht pos else space false
private string compare page encodings string page dir enc string config enc root get jsp config page encoding upper case string page dir enc page dir enc upper case	string page enc root get page encoding upper case
configure call application event listeners try start manager manager null manager instanceof lifecycle lifecycle get manager start start container background processor thread super thread start catch exception log error error manager start ok false configure call application filters
string current prefix get prefix current get qname jsp uri equals uri text action equals current get local name jsp equals current prefix	string prefix get prefix name	string prefix get prefix name prefix length	private string get prefix string name int index name index index return name substring index return
url pattern index check unusual urlpattern url pattern else url pattern index check unusual urlpattern url pattern else check unusual valid code lt url pattern gt code see bugzilla 34805 43079 43080 private void check unusual urlpattern string url pattern log info enabled url pattern ends url pattern length url pattern char url pattern length log info suspicious url pattern url pattern context get name see section srv 11 servlet
compressable mime types null	compressable mime types null	compressable mime types null
url url file uri url	url url file uri url	url url directory uri url	url url file uri url	url url file uri url	string tag name tag info get tag class name path tag name replace file separator char path path substring path last index file separator char path get servlet package name replace file separator char file base options get scratch dir base url base uri url output dir base get absolute path file separator path file separator
files lower case ends war dir file
li sessions deprecated use expire	else command equals sessions expire sessions writer path request
attr names length pool name pool name
string description default	persistence property properties default	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license string name string value
endorsed arg set line djava endorsed dirs quote path list endorsed info append endorsed dir quote path list endorsed	private string quote path list string list string buffer result new string buffer list length 10 string tokenizer st new string tokenizer list file path separator while st has more tokens string token st next token token index result append token else result append result append token result append st has more tokens result append file path separator char return result string
web digester null web digester create web digester web digester get parser context digester null context digester create context digester context digester get parser
expect file urls xx encoded depending class loader check url using file protocol else ignore file equals urls get protocol continue
private static final class dispatch data
escaped quotes
string original value null original value param value	string variable value ssi mediator get variable value original value encoding variable value null variable value missing variable value writer write variable value return system current time millis	has references html entities work val index val index return val html decoding val replace lt val replace gt val replace quot val replace amp int char start sb index while char start int char end sb index char start char end char char integer parse int sb substring char start char end sb delete char start char end sb insert char start char start sb index else break	ret val http messages filter value
final expression factory expr factory jspf get jsp application context page context get servlet context get expression factory
make sure isn null get method
public int get queue size return executor null executor get queue size
break status true else	denyfromall all roles mode all roles mode strict mode status principal null
string manager package protected static string manager sm string manager get manager constants package	closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed	closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed	closed throw new ioexception sm get string input buffer stream closed	closed throw new ioexception sm get string input buffer stream closed	closed throw new ioexception sm get string input buffer stream closed	closed throw new ioexception sm get string input buffer stream closed
list current coment connections protected list request comet requests collections synchronized list new array list request name session attribute used store list comet connections protected string comet requests attribute org apache tomcat comet connection list	container getting stopped close all current connections iterator request iterator comet requests iterator request request iterator next remove session tracking attribute isn serializable required http session session request get session false session null session remove attribute comet requests attribute close comet connection try comet event impl comet event request get event comet event set event type comet event event type end comet event set event sub type comet event event sub type webapp reload get next event request request get response comet event comet event close catch exception container get logger warn sm get string comet connection manager valve event comet requests clear	track conection webapp reload comet requests add request track connection session expiration request requests request session get attribute comet requests attribute requests null requests new request requests request session set attribute comet requests attribute requests request new requests new request requests length int requests length new requests requests new requests requests length request session set attribute comet requests attribute new requests	event get event sub type comet event event sub type timeout remove connection from webapp reload tracking comet requests remove request remove connection from session expiration tracking note can get session has been invalidated ok since session listener have done clean up http session session request get session false session null synchronized session request reqs request session get attribute comet requests attribute reqs null boolean found false int found reqs length found reqs request found reqs length request new connection infos new request reqs length int pos int reqs length reqs request new connection infos pos reqs session set attribute comet requests attribute new connection infos else session remove attribute comet requests attribute	request reqs request se get session get attribute comet requests attribute reqs null int reqs length request req reqs comet event impl event req get event event set event type comet event event type end event set event sub type comet event event sub type session end comet processor req get wrapper get servlet event event event close req get wrapper get parent get logger warn sm get string comet connection manager valve listener event
address null throw new bind exception get message null port else throw new bind exception get message address string port
response wrapper use dumb head support content length all other methods delegate wrapped http servlet response object super super set content length body get content length super set content length len public servlet output stream get output stream throws ioexception return body public print writer get writer throws unsupported encoding exception output stream writer
debug 10 log readme readme file found return null	debug 10 log local xslt file local xslt file found return null
start poller thread poller new poller thread poller thread new thread poller get name client poller poller thread set priority thread priority poller thread set daemon true poller thread start	fix bug 43701 bug start acceptor thread before poller thread fix
protected final class privileged get class loader implements privileged action class loader public class clazz public privileged get class loader class clazz clazz clazz public class loader run return clazz get class loader	log trace enabled clazz null class loader cl globals security enabled cl access controller do privileged new privileged get class loader clazz else cl clazz get class loader log debug loaded cl string
listener equals application listeners log info sm get string standard context duplicate listener listener
truststore type null truststore type system get property javax net ssl trust store type
manager manager context get manager manager null args 11 sm get string html manager servlet manager else args 11 new integer context get manager get max inactive interval 60
we need crlf pos last valid we call parse crlf we overrun buffer here so we defer next call bz 11117 need crlfparse true else parse crlf parse crlf immediately	boolean crfound false	crfound throw new ioexception invalid crlf two cr characters encountered crfound true crfound throw new ioexception invalid crlf cr character encountered
else current compilation context needs location cached tag files tag file info info impl get tag files ctxt set tag file jar url info get path ctxt get tag file jar url
ret null body null string buffer buf new string buffer int body size buf append body get node get text ret buf string else nulls cause npes further down line ret
object bean	object bean
elresolver resolver ctx get elresolver resolver set value ctx base property coerce expected type elsupport coerce type value resolver get type ctx base property
get creation get last modified	creation get last modified	creation get creation	last modified get last modified
encoder location url http redirects protected static urlencoder url encoder static initializer safe character set static url encoder new urlencoder url encoder add safe character url encoder add safe character url encoder add safe character url encoder add safe character url encoder add safe character	string redirect path url encoder encode redirect path mb string
public locale get locale return el context get locale public void set locale locale locale el context set locale locale
throw new illegal argument exception message factory get error convert obj obj type number
nbsp input type submit value nbsp 10 nbsp input type text name idle size value 11 nbsp 12 nbsp	nbsp input type submit value nbsp 10 nbsp input type text name idle size value 11 nbsp 12 nbsp
sets list comma delimited classes represent roles classes list must implement code java security principal code supplied list classes parsed when link start called provided list each class must implement code java security principal code	class loader loader get class get class loader use context class loader loader thread current thread get context class loader class principal class class name class names false loader	sets list comma delimited classes represent individual users classes list must implement code java security principal code supplied list classes parsed when link start called	use context class loader ocl thread current thread get context class loader thread current thread set context class loader get class get class loader	use context class loader	iterator principal principals subject get principals iterator principal principal principals next	need called after loading case use context class loader appears after them xml config parse class names user class names user classes parse class names role class names role classes
using output stream false using writer false character encoding set false
path null path starts	normalize slashes
host find child path null deployed path message sm get string html manager servlet deploy upload server xml war break
processor set compression proto compression	processor set compression proto compression	processor set compression proto compression
scriplet node one one mapping between jsp lines java lines err visitor get jsp source node instanceof node scriptlet javac error new javac error detail fname line num err node get start get file err node get start get line number line num err visitor get jsp source node get begin java line err msg buf ctxt else javac error new javac error detail fname line num err node get start get file err node get start get line number err msg buf ctxt
copy successful resp set status webdav status sc created
log info error registering servlet jmx ex	instance ex
handled default servlet web davservlet must used default servlet ie mapped work enable web dav context add following web xml br code lt servlet gt br lt servlet name gt webdav lt servlet name gt br lt servlet class gt org apache catalina servlets webdav servlet lt servlet class gt br lt init param gt br lt param name gt debug lt param name gt br lt param value gt lt param value gt br lt init param gt br lt init param gt br lt param name gt listings lt param name gt br lt param value gt true lt param value gt br lt init param gt br lt servlet gt br lt servlet mapping gt br lt servlet name gt webdav lt servlet name gt br lt url pattern gt lt url pattern gt br lt servlet mapping gt code enable read only access enable read write access add br code lt init param gt br lt param name gt readonly lt param name gt br lt param value gt false lt param value gt br lt init param gt br code make content editable via different url using following mapping br code lt servlet mapping gt br lt servlet name gt webdav lt servlet name gt br lt url pattern gt webdavedit lt url pattern gt br lt servlet mapping gt code don forget secure access editing urls context accessible normal users before those users necessary access able edit content available via http host port context content using http host port context webdavedit content	remm would like sleep value currently 100s jfclere remm
sendfile data remove new long data socket	long maintain time	reset maintain time maintain time	maintain time poll time	call maintain sendfile poller so timeout maintain time 1000000l running rv poll maintain sendfile pollset desc true maintain time rv int rv get sendfile state sendfile data state sendfile data get new long desc close socket clear pool remove state destroy file descriptor pool which should close file close socket response would incomplete socket destroy state socket fix bug 43479 bug memory leak cleaning up sendfile connections submitted chris elving remm fix fix bug 42925 bug add maintain sendfile remm fix
error page error page error page status pages get new integer status error page null return error page get location return null patch tuomas kiviaho tuomas kiviahos ikis fi funkman fix fix bug 43453 bug class cast exception org apache catalina core standard context find status page int funkman
removed log debug enabled log debug member member disappeared present map return member part our map bug 43435 bug don iterate relocate sessions part map fix fix
public void set clientauth string set client auth public string get clientauth return get client auth public string get client auth return ep get client auth public void set client auth string ep set client auth public void set truststore file string ep set truststore file public string get truststore file return ep get truststore file public void set truststore pass string ep set truststore pass public string get truststore pass return ep get truststore pass public void set truststore type string ep set truststore type public string get truststore type return ep get truststore type	public string adjust relative path string path string relative file new file path absolute path relative file separator path new file path exists log warn configured file path does exist return path public string default null string val string default value val null return default value else return val protected string truststore file system get property javax net ssl trust store public void set truststore file string adjust relative path system get property catalina base truststore file public string get truststore file return truststore file protected string truststore pass system get property javax net ssl trust store password public void set truststore pass string truststore pass truststore pass truststore pass public string get truststore pass return truststore pass protected string truststore type system get property javax net ssl trust store type public void set truststore type string truststore type truststore type truststore type public string get truststore type return truststore type public void set keystore file string adjust relative path system get property catalina base keystore file protected string client auth false public string get client auth return client auth public void set client auth string client auth	char tpassphrase get truststore pass null get truststore pass char array passphrase string ttype get truststore type null get truststore type get keystore type key store ts null get truststore file null ts key store get instance get keystore type ts load new file input stream get keystore file passphrase else ts key store get instance ttype ts load new file input stream get truststore file tpassphrase	false equals get client auth engine set need client auth false engine set want client auth false else true equals get client auth yes equals get client auth engine set need client auth true else want equals get client auth engine set want client auth true
recycle request necessary also bz 30949 recycle request wrapper state	private void recycle request wrapper state state state wrap request instanceof application http request application http request state wrap request recycle bug 30949 bug improve previous fix ensure requests re cycled cross context includes forwards when exception occurs target page markt fix fix
fix bug 43216 bug set correct standard session access count standard session activity check true patch provided takayuki kaneko pero fix
servers assumed string query string	decode return specified url encoded string assumed string query string	return urldecode str enc false decode return specified url encoded string param str url encoded string param enc encoding use null default encoding used param query query string being processed exception illegal argument exception character followed valid digit hexadecimal number public static string urldecode string str string enc boolean query	return urldecode bytes enc query decode return specified url encoded byte array assumed string query string	decode return specified url encoded byte array assumed string query string	return urldecode bytes null false decode return specified url encoded byte array param bytes url encoded byte array param enc encoding use null default encoding used param query query string being processed exception illegal argument exception character followed valid digit hexadecimal number public static string urldecode byte bytes string enc boolean query	query bug 42944 bug correctly handle servlet mappings use character part url pattern markt fix fix
public void process request submit null submit equals add
comet req comet comet req set filter chain filter chain	licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license security role reference web application represented code lt security role ref gt code element deployment descriptor author mark thomas version revision date since tomcat properties required role name private string name null public string get name return name public void set name string name name name optional role link private string link null public string get link return link public void set link string link link link public methods return string object public string string string buffer sb new string buffer security role ref sb append name sb append name link null sb append link sb append link sb append return sb string
digester add rule prefix web app servlet security role ref new security role ref create rule digester add call method prefix web app servlet security role ref role link set link digester add call method prefix web app servlet security role ref role name set name	rule adds security role ref servlet allowing fact role link optional element public security role ref create rule public void begin string namespace string name attributes attributes throws exception security role ref security role ref new security role ref digester push security role ref digester get logger debug enabled digester get logger debug new security role ref public void end string namespace string name throws exception security role ref security role ref security role ref digester pop wrapper wrapper wrapper digester peek wrapper add security reference security role ref get name security role ref get link digester get logger debug enabled digester get logger debug pop security role ref bug 41722 bug make role link element optional required spec when using security role ref element markt fix fix override env entry web xml markt
input stream null file input stream fis null ctxt get resource stream jsp file name string jsp lines read file fis new file input stream ctxt get servlet java file name string java lines read file fis	finally null try close catch ioexception ioe ignore fis null try fis close catch ioexception ioe ignore
context environment ce find environment environment get name context resource link rl find resource link environment get name ce null ce get override remove environment environment get name else return else rl null link need look global resources naming resources global server factory get server get global naming resources global find environment rl get global null global find environment rl get global get override remove resource link environment get name else return exists isn env res link fix bug 42547 bug fix npe when resource link context xml tries override env entry web xml fix
private int curr func	throws jasper exception elfunction mapper map new elfunction mapper map ds new string buffer map ss new string buffer page visit map new elfunction visitor append declarations root node string ds map ds string ds length node root page get root new node declaration map ss string null root new node declaration static ds null root	use global name map facilitate reuse function maps key used prefix function uri private hash map string string map new hash map string string public void visit node param action throws jasper exception do map get value visit body public void visit node include action throws jasper exception do map get page visit body public void visit node forward action throws jasper exception do map get page visit body do map get value visit body do map get bean name visit body do map get height do map get width visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs do map get name attribute visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs visit body do map get el private void do map node jsp attribute attr throws jasper exception attr null do map attr get el private void do map elnode nodes el throws jasper exception class fvisitor extends elnode visitor array list elnode function funcs new array list elnode function hash map string string key map new hash map string string public void visit elnode function throws jasper exception string key get prefix get name key map contains key key key map put key funcs add el null return first locate all unique functions el fvisitor fv new fvisitor el visit fv array list functions fv funcs functions size return reuse previous map possible string dec name match map functions dec name null el set map name dec name return generate declaration map statically dec name get map name ss append static private org apache jasper runtime protected function mapper dec name ds append dec name ds append org apache jasper runtime protected function mapper special case only one function map string func method null functions size func method get map function else ds append get instance func method dec name map function int functions size elnode function elnode function functions get function info func info get function info string key get prefix get name ds append func method key func info get function class class get method name new class string params get parameters int params length ds append int array params index array ds append params class else string base type params substring array ds append java lang reflect array new instance ds append base type ds append class count number array dimension int count int jj array jj params length jj params char jj count count ds append get class else ds append new int count get class ds append put current name global function map map put get prefix get name get uri dec name el set map name dec name	private string match map array list functions string map name null int functions size elnode function elnode function functions get string tem name string map get get prefix get name get uri tem name null return null map name null map name tem name else tem name equals map name all previous match match return null return map name private string get map name return jspx fnmap curr func fix fix xss security cve 2007 2450 manager host manager reported daiki fukumori markt fix fix bug 42643 bug prevent creation duplicate jsp function mapper variables markt fix fix fix xss security cve 2007 2449 examples reported toshiharu sugiyama markt fix
array list range result new array list range	response set header etag get etag resource attributes	response set header etag get etag resource attributes bug 39875 bug fix bpe realm base init port yoavs fix from tomcat markt bug 42444 bug prevent npe access log valve patch provided nils hammar funkman fix fix bug 42449 bug jndirealm does catch null pointer exception sun ldap provider see bug details funkman fix fix bug 42497 bug ensure etag header present 304 response patch provided len popp markt
response committed
array list security constraint results null	results new array list security constraint	results new array list security constraint	results new array list security constraint	results new array list security constraint	private security constraint results array array list security constraint results	we want logger soon possible container null container log container get logger fix bug 39875 bug fix bpe realm base init port yoavs fix from tomcat markt fix
temporary variable name null temporary variable name jsp util next temporary variable name subsection name jasper changelog fix bug 42438 bug duplicate temporary variables were created when jsp attribute used conjunction custom tags patch provided brian lenz markt fix changelog subsection
tr tr tr	tr tr tr	tr tr tr subsection name webapps changelog fix bug 42459 bug tomcat web application manager table error rjung fix changelog subsection
bug 42444 bug prevent npe patch provided nils hammar funkman fix fix
content type specified use default post string saved content type saved get content type saved content type null saved content type application www form urlencoded content type set string saved content type	saved set content type request get content type	content type request used post private string content type null public string get content type return content type public void set content type string content type content type content type subsection name catalina changelog fix bug 42361 bug handle multi part forms when saving requests during form process patch provided peter runge markt fix changelog subsection
connector set property sslenabled true else connector new connector protocol
comet next request input buffer next request output buffer next request	comet next request input buffer next request output buffer next request
file file null try file new file url uri catch urisyntax exception ignore probably unencoded char file new file url get file try file file get canonical file catch ioexception ignore	expect file urls xx encoded depending class loader file file null try file new file urls uri catch urisyntax exception ignore probably unencoded char file new file urls get file
available system current time millis response set date header retry after available response send error http servlet response sc service unavailable localizer get message jsp error unavailable return else wait period has expired reset available fix bug 42071 bug fix illegal state exception multiple requests unavailable jsp patch provided kawasima kazuh markt fix fix after jsp throws unavailable exception allow accessed once unavailable period has expired markt fix
container get logger error sm get string standard wrapper allocate exception wrapper get name
parse character encoding from specified content type header content type null explicit character encoding code null code returned param content type content type header public static string get charset from content type string content type content type null return null int start content type index charset start return null string encoding content type substring start int end encoding index end encoding encoding substring end encoding encoding trim encoding length encoding starts encoding ends encoding encoding substring encoding length return encoding trim fix bug 42119 bug fix return value request get character encoding when content type headers contain parameters other than charset patch leigh klotz jr markt fix
-1
servlet servlet null servlet servlet servlet class new instance annotation processor process annotations servlet annotation processor post construct servlet	servlet init config servlet servlet fix bug 42072 bug don call destroy associated init fails patch provided kawasima kazuh markt fix
config base mkdirs
bug 41703 bug single sign message invalid setter patch provided nils hammar fhanik fix fix
cluster manager manager get name bug 41682 bug class cast exception when logging turned fhanik fix fix
protected standard context get context return context protected map get readonly attributes return read only attributes protected void clear attributes	context null context new repl appl context get base path get alt ddname null context set attribute globals alt dd attr get alt ddname	public void remove attribute string name do nothing super remove attribute name public void set attribute string name object value do nothing super set attribute name value	return remove key true public object remove object key boolean notify get map members length notify	clear true public void clear boolean notify notify only delete active keys iterator keys key set iterator while keys has next remove keys next else super clear	object key get key map entry entry map entry super get key entry primary set add entry get value	object key get key map entry entry map entry super get key entry primary set add key	value value	key key
log debug enabled log debug sm get string request prepare unsupported http version protocol mb	log debug enabled log debug sm get string request prepare unsupported transfer encoding encoding name	log debug enabled log debug sm get string request prepare host header missing add bug 41675 bug add couple debug level logging statements when sending error responses patch ralf hauser yoavs add
protected list string role classes new array list string	protected list string user classes new array list string	comma delimited list code java security principal code classes represent security roles protected string role class names null public string get role class names return role class names	parse class names role class names role classes parses comma delimited list class names store class names provided list each class must implement codejava security principal code param class names string comma delimited list fully qualified class names param class names list list which class names stored list cleared before being populated protected void parse class names string class names string list string class names list class names list clear class names string null return string class names class names string split int class names length class names length continue try class principal class class name class names principal class assignable from principal class class names list add class names else log error class class names implementing java security principal class added catch class found exception log error class class names found class added comma delimited list code java security principal code classes represent individual users protected string user class names null public string get user class names return user class names	parse class names user class names user classes	list string roles new array list string fix bug 40150 bug ensure user roll classnames validated startup patch tom yoavs fix
file input stream null new file input stream source file reader reader new buffered reader new input stream reader ctxt get options get java encoding	finally null try close catch ioexception exc ignore
throw new lifecycle exception sm get string memory realm read xml fix bug 41752 bug correct error message exception memory realm markt fix
last modified header value 1000	last modified header value 1000 bug 41666 bug correct handling boundary conditions unmodified since modified since headers patch provided suzuki yuichiro markt fix fix fix requests multiple content length headers now rejected markt fix
fix bug 41739 bug correct handling servlets load startup value zero now first servlets started markt fix
container get logger error sm get string standard wrapper service exception container get logger error sm get string standard wrapper service exception	container get logger error sm get string standard wrapper service exception container get logger error sm get string standard wrapper service exception fix bug 41608 bug make log levels consistent when servlet service throws exception markt fix
private static final int pool size integer value system get property org apache jasper runtime jsp factory impl pool size int value private thread local page context pool local pool new thread local page context pool	use pool page context pool pool local pool get pool null pool new page context pool local pool set pool pc pool get pc null	local pool get put pc	protected final class page context pool private page context pool private int current public page context pool pool new page context pool size public void put page context current pool size current pool current public page context get page context item null current item pool current current return item
out print jspx factory get jsp application context	out printil private static final jsp factory jspx factory jsp factory get default factory out println	printil jspx factory release page context jspx page context	system get security manager null string base package org apache jasper try factory get class get class loader load class base package runtime jsp factory impl privileged get page context factory get class get class loader load class base package runtime jsp factory impl privileged release page context factory get class get class loader load class base package runtime jsp runtime library factory get class get class loader load class base package runtime jsp runtime library privileged introspect helper factory get class get class loader load class base package runtime servlet response wrapper include factory get class get class loader load class base package servlet jsp servlet wrapper catch class found exception ex throw new illegal state exception ex
filter map get match all url patterns	check specific special servlet name else filter map get match all servlet names return true	equals servlet name match all servlet names true else string results new string servlet names length system arraycopy servlet names results servlet names length results servlet names length servlet name servlet names results flag indicates mapping match all url patterns private boolean match all url patterns false public boolean get match all url patterns return match all url patterns flag indicates mapping match all servlet names private boolean match all servlet names false public boolean get match all servlet names return match all servlet names	match all url patterns true
socket get buf handler get write buffer buf socket get buf handler get write buffer put buf buf socket get buf handler get write buffer fix bug 39572 bug improvements compression filter example provided eric hedstr markt fix
protected output stream gzipstream null	response committed debug system out print response already committed using original output stream gzipstream output else response add header content encoding gzip gzipstream new gzipoutput stream output
bug 41265 bug allow jsp servlet check interval init parameter explicitly set stated default value zero removing code resets 300 explicitly specified zero markt fix fix
public static final string cert method client cert	return basic client cert digest form code null code	basic form which less secure than client cert auth type	following digest client cert updated	param auth type type used basic client cert	param auth type type used basic client cert	return basic client cert digest form none	param auth type type used basic client cert fix bug 40524 bug http servlet request get auth type now returns client cert rather than client cert certificate per spec note web xml continues use client cert specify certificate should used markt fix
bugzilla 41217 cookie set secure request secure fix bug 41217 bug set secure attribute sso cookie when cookie created during secure request patch provided chris halstead markt fix
request get request uri fix bug 41327 bug show full uri 404 patch provided vijay markt fix
class name org apache jasper compiler jsp runtime context true get class get class loader
out println param name blah out printil out write param name	object string s0 object	param java code s0 param name java code make attr value code param java codebase s0 param name java codebase param java archive s0 param name java archive param type s0 param name type	generate param each jsp param plugin body	out printil out write quote comment	out printil out write quote noembed	out printil out write quote noembed out printil out write quote comment out printil out write quote object subsection name jasper changelog fix bug 41057 bug make jsp plugin output xhtml compliant markt fix changelog subsection
null null null configure open	directory null directory get property class name directory logs prefix null prefix get property class name prefix juli suffix null suffix get property class name suffix log subsection name catalina changelog fix bug 40585 bug fix constructor juli file handler so parameters have effect markt fix changelog subsection
private static final string jsp version	private static final string jsp version	version equals version equals version equals
protected static int max string size integer parse int system get property tomcat util buf string cache max string size 128	byte enabled value length max string size	char enabled value length max string size
request method get post head query string does contain unencoded indexed query parsed query string becomes command line parameters cgi command req get method equals get req get method equals post req get method equals head string qs req get query string qs null qs index string tokenizer qs tokens new string tokenizer qs while qs tokens has more tokens cmd line parameters add urldecoder decode qs tokens next token parameter encoding bug 41008 bug allow post used indexed queries cgi servlet patch provided chris halstead markt fix fix
sb append request util filter trimmed	sb append request util filter trimmed fix bug 40901 bug encode directory listing output based patch provided chris halstead markt fix
subclass java net urlclass loader functional differences between class java net urlclass loader bug 37509 bug do remove whitespace from end values defined logging properties files markt fix fix bug 40929 bug correct java doc standard class loader markt markt
context get logger warn sm get string coyote request parse parameters	log warn parameters invalid chunk ignored	log warn parameters character decoding failed parameter skipped fix bug 40860 bug log exceptions other problems during parameter processing markt fix
string result str fix bug 37509 bug do remove whitespace from end values defined logging properties files markt fix
protected synchronized string get password string username	protected synchronized prepared statement roles connection db connection string username subsection name general changelog changelog subsection subsection name catalina changelog fix bug 40844 bug missing syncs jdbcrealm markt fix changelog subsection subsection name coyote changelog changelog subsection
deferred tld attrs can request time
globals strict servlet compliance check srv srv 14 compliance check same objects	globals strict servlet compliance check srv srv 14 compliance check same objects	private void check same objects throws servlet exception servlet request original request application filter chain get last serviced request servlet response original response application filter chain get last serviced response some forwards eg from valves set original values original request null original response null return boolean same false servlet request dispatched request app request while same original request equals dispatched request same true same dispatched request instanceof servlet request wrapper dispatched request servlet request wrapper dispatched request get request else break same throw new servlet exception sm get string application dispatcher spec violation request same false servlet response dispatched response app response while same original response equals dispatched response same true same dispatched response instanceof servlet response wrapper dispatched response servlet response wrapper dispatched response get response else break same throw new servlet exception sm get string application dispatcher spec violation response	used enforce requirements srv srv 14 private final static thread local last serviced request private final static thread local last serviced response static globals strict servlet compliance last serviced request new thread local last serviced response new thread local else last serviced request null last serviced response null	globals strict servlet compliance last serviced request set request last serviced response set response	finally globals strict servlet compliance last serviced request set null last serviced response set null	last request passed servlet servicing from current thread return last request serviced public static servlet request get last serviced request return servlet request last serviced request get last response passed servlet servicing from current thread return last response serviced public static servlet response get last serviced response return servlet response last serviced response get
cginame current location get parent file separator substring web app root dir length name	envp put script filename command php
synchronized entry looking up package string package name null int pos name last index pos package name name substring pos package pkg null package name null synchronized pkg get package package name define package null pkg null entry manifest null define package package name null null null null null null null else define package package name entry manifest entry code base security manager null checking sealing pkg null boolean seal check true pkg sealed seal check pkg sealed entry code base else seal check entry manifest null package sealed package name entry manifest seal check throw new security exception sealing violation loading name package package name sealed new code source entry code base entry certificates
index timestamp
input get offset input get end return
first basic first null
find environment environment get name get override remove environment environment get name else return entries put environment get name environment get type
throw
container get logger error sm get string standard context request listener request init	container get logger error sm get string standard context request listener request destroy
boolean deployed true	try deployed deployed context path catch exception assume false failure safety deployed false	else context get available deployed writer print message format format started deployed apps row button section args else context get available deployed started nondeployed apps row button section args else context get available deployed writer print message format format stopped deployed apps row button section args stopped nondeployed apps row button section args	private static final string started deployed apps row button section	private static final string stopped deployed apps row button section	private static final string started nondeployed apps row button section td class row left bgcolor small nbsp nbsp nbsp href onclick return confirm you sure nbsp nbsp href onclick return confirm you sure nbsp nbsp nbsp small td tr private static final string stopped nondeployed apps row button section td class row left bgcolor small nbsp href onclick return confirm you sure nbsp nbsp nbsp nbsp nbsp nbsp nbsp small td tr	deployed path writer println sm get string manager servlet deployed request util filter display path return	invoke deployed method deployer protected boolean deployed string name throws exception string params name string signature java lang string boolean result boolean bean server invoke oname deployed params signature return result boolean value	invoke serviced method deployer	invoke add serviced method deployer	invoke remove serviced method deployer	has specified application been deployed note applications defined server xml have been deployed return code true code application has been deployed code false code applciation has been deployed does exist public boolean deployed string name deployed application app deployed application deployed get name app null return false else return true	operation name deployed description web application deployed component impact action return type boolean parameter name name description application name type java lang string operation
return jsp util make java identifier pool name	return jsp util make java identifier var name
prev
tag file parent null out printin tag handler var out print set parent out print new javax servlet jsp tagext tag adapter out print javax servlet jsp tagext simple tag else simple tag
copyright 1999 2004 2006 apache software foundation	removed rctxt null rctxt remove wrapper jsp uri	jsp compiler remove generated files	copyright 1999 2004 2006 apache software foundation	copyright 1999 2004 2006 apache software foundation	catch file found exception ex ctxt increment removed string include request uri string request get attribute javax servlet include request uri include request uri null file included throw exception response send error ignored servlet engine throw new servlet exception ex else try response send error http servlet response sc found ex get message catch illegal state exception ise log error localizer get message jsp error file found ex get message ex catch servlet exception ex options get development throw handle jsp exception ex else throw ex catch ioexception ex options get development throw handle jsp exception ex else throw ex catch illegal state exception ex options get development throw handle jsp exception ex else throw ex catch exception ex options get development throw handle jsp exception ex else throw new jasper exception ex try
request set content length reset content length	req set content length reset content length
else obj0 get class enum return obj0 equals coerce enum obj1 obj0 get class else obj1 get class enum return obj1 equals coerce enum obj0 obj1 get class	param obj param type return public final static enum coerce enum final object obj class type obj null equals obj return null obj get class enum return enum obj return enum value type obj string	else obj instanceof enum return enum obj name	type enum return coerce enum obj type	reload false	try object target tag file reload false target tag handler class new instance else target get servlet target null target instanceof jsp source dependent return java util list jsp source dependent target get dependants catch throwable ex return null
ret val equals req get method equals ignore case org apache coyote http11 constants head
char end quote while idx cmd length quote cmd char idx end quote cmd char idx	end quote escaped break	protected boolean quote char return
try rt runtime get runtime proc rt exec cmd args string hash string array env wd string content length string env get content length equals content length commands std new buffered output stream proc get output stream iotools flow stdin commands std commands std flush commands std close we want wait process exit process wait useless our situation see http developer java sun com developer bug parade bugs 4223650 html boolean running true commands std err new buffered reader new input stream reader proc get error stream final buffered reader std err rdr commands std err new thread public void run send log std err rdr start input stream cgi header stream new httpheader input stream proc get input stream buffered reader cgi header reader new buffered reader new input stream reader cgi header stream while running try set headers string line null while line cgi header reader read line null equals line debug log run cgi add header line line starts http response set status get scfrom http status line line else line index string header line substring line index trim string value line substring line index trim header equals ignore case status response set status get scfrom cgistatus header value else response add header header value log run cgi bad header line line write output byte buf new byte 2048 output stream out response get output stream cgi output proc get input stream try while buf read cgi output read buf debug log run cgi output buf read bytes data out write buf buf read finally attempt consume any leftover byte something bad happens socket disconnect servlet side otherwise external process could hang buf read while buf read cgi output read buf proc exit value throws exception alive running false catch illegal thread state exception try thread sleep 500 catch interrupted exception ignored replacement process wait close output stream used cgi output close catch ioexception log caught exception throw new ioexception string finally debug log running finally block proc null proc destroy proc null
-1
-1
acquire clustered manager manager context manager null manager null get cluster null try context manager get cluster create manager get name catch exception ex log error standard context cluster fail ex ok false else context manager new standard manager	context manager null set manager context manager
