wrong import statement gener while us extend attribut page direct

ternari oper doesn t work expect insid attribut jspx page

provid wai prevent look system classload befor webapp classload

order invoc method server endpoint config . configur

jsp factori . get page context jsp writer . default buffer throw illeg argument except

async context doe timeout http nio connector

null pointer except when run jspc from shell script . jsp cservlet context . java : 344 return url object resourc map specifi context rel path . param path context rel path desir resourc except malform urlexcept resourc path properli form overrid public url get resourc ( string path ) throw malform urlexcept { ( path . start ( ) ) throw new malform urlexcept ( path path doe start ) ; tld cach . java : 124 privat long get last modifi ( tld resourc path tld resourc path ) { long result = new long 2 ; result 0 = 1 ; result 1 = 1 ; try { url url = servlet context . get resourc ( tld resourc path . get webapp path ( ) ) ; usr java jdk1 . 7 . 0 45 bin java classpath : home tomcat apach tomcat 8 . 0 . 0 rc10 lib catalina storeconfig . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat websocket . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat i18n es . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib catalina tribe . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib catalina ha . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat i18n ja . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib jsp api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat util . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat jni . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib jasper . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib websocket api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib ecj 4 . 3 . 1 . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat i18n fr . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat coyot . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib servlet api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib jasper el . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib catalina . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat dbcp . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat jdbc . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib annot api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat util scan . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib catalina ant . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib el api . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 lib tomcat spdy . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 bin tomcat juli . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 bin bootstrap . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 bin common daemon . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 webapp exampl web inf lib jstl . jar : home tomcat apach tomcat 8 . 0 . 0 rc10 webapp exampl web inf lib standard . jar : home java sourc head work jsp compil share web inf lib ant 1 . 6 . 5 . jar org . apach . jasper . jsp c d home java sourc head work tomcat80 v l uriroot home java sourc head work jsp compil share home java sourc head work jsp compil share web inf jsp dialog qb ax dlg . jsp home java sourc head work jsp compil share web inf jsp dialog qb manual gecod dlg . jsp home java sourc head work jsp compil share web inf jsp fmtdlg . jsp home java sourc head work jsp compil share web inf jsp index . jsp home java sourc head work jsp compil share web inf jsp joindlg . jsp home java sourc head work jsp compil share web inf jsp produc . jsp home java sourc head work jsp compil share web inf jsp simplefilt . jsp home java sourc head work jsp compil share web inf jsp selectvaluedlg . jsp home java sourc head work jsp compil share web inf jsp binddow test view . jsp home java sourc head work jsp compil share web inf jsp variableeditordlg . jsp home java sourc head work jsp compil share web inf jsp filterprompteditor . jsp home java sourc head work jsp compil share web inf jsp ajax respons . jsp home java sourc head work jsp compil share web inf jsp fontdlg . jsp home java sourc head work jsp compil share web inf jsp join field . jsp home java sourc head work jsp compil share web inf jsp tree compon . jsp home java sourc head work jsp compil share web inf jsp wait banner . jsp home java sourc head work jsp compil share web inf jsp bid folderblock bid folder block init . jsp home java sourc head work jsp compil share web inf jsp bid folderblock bid folder block boot . jsp home java sourc head work jsp compil share web inf jsp bid bid empti content . jsp home java sourc head work jsp compil share web inf jsp bid xml bid url properti . jsp home java sourc head work jsp compil share web inf jsp bid xml bid ibfspath href . jsp home java sourc head work jsp compil share web inf jsp bid xml bid xmlrespons . jsp home java sourc head work jsp compil share web inf jsp bid xml bid statu respons . jsp home java sourc head work jsp compil share web inf jsp bid favorit bid favorit tree . jsp home java sourc head work jsp compil share web inf jsp bid favorit bid favorit block boot . jsp home java sourc head work jsp compil share web inf jsp bid favorit bid favorit block init . jsp home java sourc head work jsp compil share web inf jsp bid favorit bid favorit tree boot . jsp home java sourc head work jsp compil share web inf jsp bid favorit bid list xml . jsp home java sourc head work jsp compil share web inf jsp bid index . jsp home java sourc head work jsp compil share web inf jsp bid view bid intern page . jsp home java sourc head work jsp compil share web inf jsp bid view bid search tree boot . jsp home java sourc head work jsp compil share web inf jsp bid view bid satre boot . jsp home java sourc head work jsp compil share web inf jsp bid view bid bi frame . jsp home java sourc head work jsp compil share web inf jsp bid view bid init view . jsp home java sourc head work jsp compil share web inf jsp bid view bid show toolbar . jsp home java sourc head work jsp compil share web inf jsp bid view bid extern page . jsp home java sourc head work jsp compil share web inf jsp bid view bid satre bi frame . jsp home java sourc head work jsp compil share web inf jsp bid view bid init bindow . jsp home java sourc head work jsp compil share web inf jsp bid view bid search tree bi frame . jsp home java sourc head work jsp compil share web inf jsp bid recent bid recent tree boot . jsp home java sourc head work jsp compil share web inf jsp bid recent bid recent tree . jsp home java sourc head work jsp compil share web inf jsp bid recent bid list xml . jsp home java sourc head work jsp compil share web inf jsp bid error . jsp home java sourc head work jsp compil share web inf jsp bid group bid list xml . jsp home java sourc head work jsp compil share web inf jsp bid search bid search list xml . jsp home java sourc head work jsp compil share web inf jsp bid search bid list xml . jsp home java sourc head work jsp compil share web inf jsp bid tree bid mr properti xml . jsp home java sourc head work jsp compil share web inf jsp bid tree bid flat list xml . jsp home java sourc head work jsp compil share web inf jsp bid tree bid plain text . jsp home java sourc head work jsp compil share web inf jsp bid tree bid list xml . jsp 2 1 except thread main java . lang . null pointer except org . apach . jasper . servlet . jsp cservlet context . get resourc ( jsp cservlet context . java : 344 ) org . apach . jasper . compil . tld cach . get last modifi ( tld cach . java : 124 ) org . apach . jasper . compil . tld cach . init ( tld cach . java : 70 ) org . apach . jasper . jsp c . init servlet context ( jsp c . java : 1468 ) org . apach . jasper . jsp c . execut ( jsp c . java : 1321 ) org . apach . jasper . jsp c . main ( jsp c . java : 269 ) java . lang . null pointer except org . apach . jasper . servlet . jsp cservlet context . get resourc ( jsp cservlet context . java : 344 )

split access log valv extract format logic abstract access log valv

when us write listen non block io servlet async api , contain make first call write possibl ( ) per spec . when us write listen non block io servlet http upgrad api contain doe make initi call write possibl ( ) . when fix thi bug worth check initi call data avail ( ) well . initi call write possibl ( ) made contain when us http upgrad

broken respons from nio connector tomcat 7 . 0 . 50

honor order when report xml pars error warn xml error handler class

reload context reload repeatedli web inf lib contain non jar file

test ssonon login basic authent flaw incomplet

webapp deploy fail dirnam end . war becaus automat consid zip archiv . tomcat tri deploi dir zip archiv even when directori name end . war

tomcat auto deploy work root applic

see issu non block io when write lot data

error messag unhelp when web . xml refer tld file doesn t exist

jsp longer compil java 8

add 172 . 16 12 rang default intern proxi

do pars web fragment . xml file when empti absolut order

add abil provid custom sslcontext websocket client

tomcat spnego authent incompat ibm jdk : accept secur context need wrap around privileg action order server side authent

i found problem set buffer size servlet respons . i call respons . set buffer size ( 1 , 000 , 000 ) ; send about 20 , 000 charact , respons chunk even though should . respons sent sever chunk contain transfer encod : chunk respons header . my understand thi case respons should fulli buffer server sent whole contain content length header . thi caus problem my applic becaus i want us larger buffer abl redirect error page error occur dure render respons . i wa abl reproduc thi tomcat 7 . 0 . 39 , 7 . 0 . 40 , 7 . 0 . 42 , 7 . 0 . 47 . tomcat 7 . 0 . 37 work fine expect . thi easili reproduc us jsp follow : respons . set buffer size ( 1000 1000 ) ; ( int i = 0 ; i 100 ; i ) { ( int j = 0 ; j 100 ; j ) { respons . get writer ( ) . write ( x ) ; } respons . get writer ( ) . write ( br ) ; } respons . set buffer size ( ) doe seem work properli

code string path = servlet context . get real path ( test ) ; file folder name test exist webroot path return null int tomcat 5 6 7 , return correct valu , ex data oschina webapp test servlet context . get real path ( ) return null

spnego authent , we check request . get user princip ( ) return prinicp we do do fresh authent . thi happen even when gsscredenti return gener princip ha remain life time less than zero . thi caus issu deleg credenti credenti valid ani more . can we add addit check reauthent when credent ha expir put gsscredenti same session spnegoauthent gsscredenti doe get renew after remain life time less than zero

enabl manag app process descript inadequ

whenev i try authent gssapi ldap server ssl connect ( ldap ) , follow except thrown : javax . name . servic unavail except : myserv . : 636 ; socket close ; remain name dc = exampl , dc = org com . sun . jndi . ldap . connect . read repli ( connect . java : 452 ) com . sun . jndi . ldap . ldap client . get search repli ( ldap client . java : 631 ) com . sun . jndi . ldap . ldap client . search ( ldap client . java : 554 ) com . sun . jndi . ldap . ldap ctx . do search ( ldap ctx . java : 1985 ) com . sun . jndi . ldap . ldap ctx . search aux ( ldap ctx . java : 1847 ) com . sun . jndi . ldap . ldap ctx . c search ( ldap ctx . java : 1772 ) . . . step reproduc : 1 . configur valv org . apach . catalina . authent . spnego authent server . xml store deleg credenti = true . 2 . configur realm org . apach . catalina . realm . jndirealm server . xml ssl connect url ( e . g . ldap : myserv . : 636 ) 3 . configur auth method spnego , secur constraint secur role web . xml 4 . add requir keystor jdk ldap connect . 5 . try authent i debug jndirealm figur out , chang line 2082 from context . add environ ( javax . secur . sasl . qop , auth conf ) ; context . add environ ( javax . secur . sasl . qop , auth ) ; would solv problem . i also test fix new written jndirealm . i m sure , thi fix caus other secur issu . jndirealm : authent gssapi ldap ssl connect caus except

i us ibati my project , config file path includ . . , tomcat can find file , command line show : could find resourc . . ibati code send type . xml path includ rel char , eg : . . , classload find zhe file

flush async context respons writer after client abort except ( broken pipe ) caus request state leak

tomcat spnego authent incompat ibm jdk case keytab base initi accept authent

put listen class name = org . apach . catalina . core . apr lifecycl listen sslengin = off you server . xml . put apr connector some week later your server . xml : connector protocol = org . apach . coyot . http11 . http11apr protocol port = http port connect timeout = 20000 max http header size = 24576 max thread = 250 uriencod = utf 8 buffer size = 4096 scheme = http secur = true sslenabl = true sslprotocol = tlsv1 sslcipher suit = high : adh sslcertif file = ssl cert file sslcertif kei file = ssl cert kei file sslpassword = ssl password start your tomcat receiv follow confus messag : nov 06 , 2013 1 : 30 : 39 pm org . apach . coyot . http11 . http11apr protocol start sever : error start endpoint java . lang . except : socket bind fail : 226 adress bereit im zugriff org . apach . tomcat . util . net . apr endpoint . init ( apr endpoint . java : 671 ) org . apach . tomcat . util . net . apr endpoint . start ( apr endpoint . java : 851 ) org . apach . coyot . http11 . http11apr protocol . start ( http11apr protocol . java : 139 ) org . apach . catalina . connector . connector . start ( connector . java : 1196 ) org . apach . catalina . core . standard servic . start ( standard servic . java : 540 ) org . apach . catalina . core . standard server . start ( standard server . java : 754 ) org . apach . catalina . startup . catalina . start ( catalina . java : 595 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 57 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 606 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 289 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 414 ) nov 06 , 2013 1 : 30 : 39 pm org . apach . catalina . core . standard servic start sever : fail start connector connector http 1 . 1 8444 lifecycl except : servic . get name ( ) : catalina ; protocol handler start fail : java . lang . except : socket bind fail : 226 adress bereit im zugriff org . apach . catalina . connector . connector . start ( connector . java : 1203 ) org . apach . catalina . core . standard servic . start ( standard servic . java : 540 ) org . apach . catalina . core . standard server . start ( standard server . java : 754 ) org . apach . catalina . startup . catalina . start ( catalina . java : 595 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 57 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 606 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 289 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 414 ) thi cours correct . port availbl ssl engin ha been turn off . should check stratup which sai thi illeg state . disabl sslengin apr lifecycl listen lead mislead error messag startup when ssl connector delcar

addit quot entiti html element attribut evalu tagx attribut contain el express

remot endpoint . async send text ( string , send handler ) can caus stack overflow error contradict oracl s java doc

web applic contain own tld within web inf directori fail render jsp page referenc tld tomcat instal directori space path , c : program file . . . . after move entir tomcat instal directori path without space ( c : 1 tomcat8 ) , applic can render same jsp page . follow stacktrac print . note 20 file path org . apach . jasper . jasper except : jsp layout standard . jsp ( line : 7 , column : 69 ) file file : c : program 20file apach tomcat 8 . 0 . 0 rc5 webapp mywebapp web inf tld mywebapp tag . tld found org . apach . jasper . compil . default error handler . jsp error ( default error handler . java : 42 ) org . apach . jasper . compil . error dispatch . dispatch ( error dispatch . java : 276 ) org . apach . jasper . compil . error dispatch . jsp error ( error dispatch . java : 92 ) org . apach . jasper . compil . tag librari info impl . init ( tag librari info impl . java : 166 ) org . apach . jasper . compil . parser . pars taglib direct ( parser . java : 410 ) org . apach . jasper . compil . parser . pars direct ( parser . java : 476 ) org . apach . jasper . compil . parser . pars element ( parser . java : 1451 ) org . apach . jasper . compil . parser . pars ( parser . java : 138 ) org . apach . jasper . compil . parser control . do pars ( parser control . java : 242 ) org . apach . jasper . compil . parser control . pars ( parser control . java : 102 ) org . apach . jasper . compil . compil . gener java ( compil . java : 198 ) org . apach . jasper . compil . compil . compil ( compil . java : 373 ) org . apach . jasper . compil . compil . compil ( compil . java : 353 ) org . apach . jasper . compil . compil . compil ( compil . java : 340 ) org . apach . jasper . jsp compil context . compil ( jsp compil context . java : 606 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 357 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 403 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 347 ) javax . servlet . http . http servlet . servic ( http servlet . java : 728 ) java version us : oracl jdk 7 updat 45 ( 64 bit ) activ tomcat connector : http nio 8080 tld cannot load catalina home contain space

tomcat mai have all permiss grant . method webapp class loader . get thread try access root thread group order list all thread . you should either manag secur except avoid access parent thread group thread which start tomcat . webapp class loader . get thread want access root thread group

wa work tomcat 6 . 0 . 20 error javax . face . context . except handler wrapper javax . face . compon . updat model except : java . lang . class cast except : unabl add object type java . lang . integ arrai object type int java . lang . class cast except : unabl add object type java . lang . integ arrai object type int javax . el . arrai elresolv . set valu ( arrai elresolv . java : 94 ) com . sun . face . el . demux composit elresolv . set valu ( demux composit elresolv . java : 255 ) com . sun . face . el . demux composit elresolv . set valu ( demux composit elresolv . java : 281 ) org . apach . el . parser . ast valu . set valu ( ast valu . java : 158 ) org . apach . el . valu express impl . set valu ( valu express impl . java : 249 ) com . sun . face . facelet . el . tag valu express . set valu ( tag valu express . java : 131 ) javax . face . compon . uiinput . updat model ( uiinput . java : 818 ) javax . face . compon . uiinput . process updat ( uiinput . java : 735 ) javax . face . compon . uidata . iter ( uidata . java : 2001 ) javax . face . compon . uidata . process updat ( uidata . java : 1253 ) javax . face . compon . uicompon base . process updat ( uicompon base . java : 1242 ) javax . face . compon . uiform . process updat ( uiform . java : 281 ) javax . face . compon . uicompon base . process updat ( uicompon base . java : 1242 ) javax . face . compon . uicompon base . process updat ( uicompon base . java : 1242 ) javax . face . compon . uiview root . process updat ( uiview root . java : 1231 ) com . sun . face . lifecycl . updat model valu phase . execut ( updat model valu phase . java : 78 ) com . sun . face . lifecycl . phase . do phase ( phase . java : 101 ) com . sun . face . lifecycl . lifecycl impl . execut ( lifecycl impl . java : 118 ) javax . face . webapp . face servlet . servic ( face servlet . java : 593 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) javax . el . arrai elresolv . set valu support arrai primit

i am test what happen when encod decod except occur dure jsr 356 commun . our case , we do us annot , we extend endpoint implement whole thingworx messag . i wa forc decod except occur expect my error call actual decod except . instead , i got null . step follow code tomcat : messag , ( ( ws session ) session ) null . result , actual decod except ( caus ) lost . can thi messag decod object payload ; try { payload = decod ( messag ) ; } catch ( decod except de ) { ( ( ws session ) session ) . get local ( ) . error ( session , de ) ; return ; } trace thi further up stack , i found util . get messag handler initi pass null session : ( decod match . get text decod ( ) . size ( ) 0 ) { messag handler result result = new messag handler result ( new pojo messag handler whole text ( listen , m , null , endpoint config , decod match . get text decod ( ) , new object 1 , 0 , fals , 1 , 1 ) , messag handler result type . text ) ; result . add ( result ) ; } pleas let me know i can provid ani more detail . bob jsr 356 messag handl : null pointer thrown when decod except caught pojo messag handler whole base t . messag

websocket npe util decod match dure applic start

server class loader us server creation

patch support gzip version static resourc default servlet

file specifi web xml ( via call set web xml ) cannot creat ( exampl directori doe exist ) , jsp c fail silent . jsp c fail silent directori gener web . xml doe exist

function constant attribut tag plugin manag seem broken . valu order . statu return fals . valu { order . state . name } return true . accord javadoc should exact opposit . problem seem node . liter function . el = null should probabl el = = null thi function us elsewher . return true attribut specifi valu translat time constant . public boolean tag plugin manag . constant attribut ( string attribut ) { node . jsp attribut attr = get node attribut ( attribut ) ; ( attr = = null ) return fals ; return attr . liter ( ) ; } return true valu string liter known translat time . public boolean liter ( ) { return express ( el = null ) name attribut ; } tag plugin manag constant attribut broken

current method set webapp loader . first via reflect ( becaus privat ) . i think set urlstream handler factori should move catalina . start ( first static field can move catalina ) . so we could have static method catalina prevent set urlstream handler factori call while first start . clean wai avoid set urlstream handler factori call

statu manag servlet . destroi should call m bean server . remov notif listen becaus init method call m bean server . add notif listen . statu manag servlet doe remov jmx notif listen

facilit weav allow class file transform ad webpp class loader

servlet request interfac provid two method iter through request paramet : enumer string get paramet name ( ) , map string , string get paramet map ( ) unfortun , underli implement tomcat hash map , which fail preserv order paramet thei ar specifi request . altern implement should us preserv request order . link hash map , exampl , capabl preserv insert order . servlet specif ( v3 . 0 ) speak onli rel order queri string data post bodi data . howev , section 17 . 13 . 3 html specif ( v4 . 01 ) titl process form data , clearli state control name valu ar list order thei appear document . therefor , i do see valid interpret either specif ration tomcat s implement . receiv request order list paramet repres them implement guarante preserv thi order difficult ration . order servlet request paramet preserv

concurr issu tag file processor

java org apach catalina authent spnego authent . java problem ar log except . except doe show up log . except onli show up i hack java org apach catalina authent local string . properti catalina . jar , add placehold . reproduc : configur sp nego kerbero . mess up your princip com . sun . secur . jgss . krb5 . accept jaa . config . try login . see you get someth like : fine org . apach . catalina . authent . spnego authent authent fail valid client suppli ticket fix : java org apach catalina authent local string . properti pleas add { 0 } follow line : spnego authent . ticket valid fail = fail valid client suppli ticket spnego authent . servic login fail = unabl login servic princip spnego authent . java you can verifi except ar inde pass log . valid : reproduc again see you now get fail valid client suppli ticket gssexcept : failur unspecifi gss api level ( mechan level : invalid argument ( 400 ) cannot find kei appropri type decrypt ap rep rc4 hmac ) except super help , least s someth . spnego authent : resourc file miss placehold except .

default servlet serv multipl encod

comet connect manag valv ad http servlet request http session which prevent session serial cluster setup . we re resolv thi local us serializ connect list class transient request i . e . public class connect list implement serializ { transient request connect list = null ; connect list ( request connect list ) { thi . connect list = connect list ; } public request get ( ) { return connect list ; } } comet connect manag valv ad non serializ request session

potenti null pointer except compil jsp expect el result primit type

add valid queri timeout properti

race condit http session invalid ( ) http servlet request get session ( boolean )

jssesocket factori condition convert alia lower case . condit code follow : privat static final string default keystor type = jk ; . . . ( jssesocket factori . default keystor type . equal ( keystor type ) ) { alia = alia . lower case ( local . english ) ; } intent downcas onli jk store alias , comparison should made jk , constant happen contain jk present . us specif compar would both clarifi code protect against possibl chang default ( albeit veri unlik ) . jssesocket factori condition convert alia lower case ; condit unwis

i want my initi pool some size i . e . empti start even fail creat all some connect . pool fail creat initi connect some reason just throw except . workaround i have set initi pool size 0 . can handi add flag ignor ( just log them ) except occur while creat initi connect . add flag ignor except while creat initi pool

org . apach . tomcat . jdbc . pool . connect pool close should call thread . interrupt ( ) becaus interrupt wa alreadi reset code thrown interrupt except . } catch ( interrupt except ex ) { ( get pool properti ( ) . get propag interrupt state ( ) ) { thread . current thread ( ) . interrupt ( ) ; } els { thread . interrupt ( ) ; } } lost interrupt

async listen . timeout call , when timeout occur , when traffic rout via ajp connector configur ajp nio protocol protocol . async listen . timeout call via ajp ajp nio protocol connector

jndirealm throw except after timeout connect reset

ajp send bodi statu 304

would nice org . apach . catalina . startup . tomcat . add web app ( . . . ) would process web applic s meta inf context . xml found . current implement skip meta inf context . xml load , doe appear offer ani hook enabl standard context instanti initi null config file singl call add web app ( . . . ) . process web applic context config embed tomcat . add web app (

miss html close tag manag applic

possibl relat 53353 when have invalid contenttyp like : jsp : direct . page languag = java content type = text html ; ( note trail ; ) tomcat throw null pointer except like thi : java . lang . null pointer except org . apach . tomcat . util . http . parser . http parser . pars media type ( http parser . java : 217 ) org . apach . tomcat . util . http . parser . media type cach . pars ( media type cach . java : 54 ) org . apach . catalina . connector . respons . set content type ( respons . java : 805 ) org . apach . catalina . connector . respons facad . set content type ( respons facad . java : 245 ) javax . servlet . servlet respons wrapper . set content type ( servlet respons wrapper . java : 123 ) after remov extra ; enter charset like thi : jsp : direct . page languag = java content type = text html ; charset = utf 8 work expect . my desir behaviour would : don t crash npe . other tomcat version seem handli thi differ . null pointer except caus invalid content type , e . g . trail semicolon

el 3 . 0 spec , section 1 . 22 . 3 constructor refer state class name refer , follow argument parenthesi , boolean ( true ) denot invoc constructor class suppli argument . thi lead me believ follow test should work : test public void test import03 ( ) { elprocessor processor = new elprocessor ( ) ; object result = processor . get valu ( integ ( 1000 ) , integ . class ) ; assert . assert equal ( integ . valu ( 1000 ) , result ) ; } unfortun , thi fail follow error . javax . el . elexcept : function : integ found org . apach . el . parser . ast function . get valu ( ast function . java : 136 ) org . apach . el . valu express impl . get valu ( valu express impl . java : 188 ) javax . el . elprocessor . get valu ( elprocessor . java : 45 ) org . apach . el . parser . test ast identifi . test import03 ( test ast identifi . java : 53 ) . . . thank el constructor throw except

non block api s all data read call twice

ws filter call ws server contain . find map ( foo bar ) , which turn call new uri templat ( path ) . path contain repeat segment , caus follow code uri templat constructor throw except : segment old = thi . segment . put ( segment , new segment ( index , segment ) ) ; ( old = null ) { throw new illeg argument except ( sm . get string ( uri templat . duplic name , segment ) ) ; } thi would valid duplic were uri variabl name when plain path segment . path foo bar caus illeg argument except when ws server contain creat uri templat

get princip ( context , usernam , gss credenti ) method jndirealm design allow deleg credenti appli directori server connect part spnego authent . thi done manipul number directori context s environ paramet . howev , current implement , environ paramet ar forcibl clear after get user ( ) call regardless whether valu were even chang ( i . e . us deleg credenti ( ) return fals ) . contain realm defin us gssapi authent , onli first spnego authent request succe . all subsequ request fail thi except : javax . name . name except : ldap : error code 1 000004dc : ldap err : dsid 0c0906dc , comment : order perform thi oper success bind must complet connect . , data 0 , v1db0 except due context . secur authent clear get princip ( ) result attempt simpl bind usernam password ( i . e . anonym ) . workaround ensur connect name connect password paramet ar specifi realm definit howev , us gssapi thi shouldn t necessari certainli defeat purpos us gssapi first place . code should preserv pre exist environ paramet context befor chang them , restor those valu afterward rather than just clear set complet . jndirealm . get princip ( context , usernam , gss credenti ) corrupt realm context

i m us persist manag jdbcstore store session my databas . my webappl , object my session which instanc org . apach . el . method express impl . thi class implement externaliz interfac thi read extern method us org . apach . el . util . reflect util . name ( string ) which us thread . current thread ( ) . get context class loader ( ) class loader . seem incorrect becaus thi method return standard class loader which cannot find my class web inf lib directori my webapp . problem method express impl class which us thi method jdbcstore which doe set thread context class loader webapp class loader here stacktrac : sever : error process request java . lang . illeg state except : erreur lor de la deserialis de la session : { 1 } org . apach . catalina . session . persist manag base . swap ( persist manag base . java : 713 ) org . apach . catalina . session . persist manag base . find session ( persist manag base . java : 503 ) org . apach . catalina . connector . request . request session id valid ( request . java : 2391 ) org . apach . catalina . connector . coyot adapt . pars session cooki id ( coyot adapt . java : 954 ) org . apach . catalina . connector . coyot adapt . post pars request ( coyot adapt . java : 688 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 402 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1002 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 585 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 312 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1145 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 615 ) java . lang . thread . run ( thread . java : 722 ) caus : java . lang . class found except : javax . face . event . action event java . net . urlclass loader 1 . run ( urlclass loader . java : 366 ) java . net . urlclass loader 1 . run ( urlclass loader . java : 355 ) java . secur . access control . do privileg ( nativ method ) java . net . urlclass loader . find class ( urlclass loader . java : 354 ) java . lang . class loader . load class ( class loader . java : 423 ) java . lang . class loader . load class ( class loader . java : 356 ) java . lang . class . name0 ( nativ method ) java . lang . class . name ( class . java : 266 ) org . apach . el . util . reflect util . name ( reflect util . java : 62 ) org . apach . el . util . reflect util . type arrai ( reflect util . java : 88 ) org . apach . el . method express impl . read extern ( method express impl . java : 290 ) java . io . object input stream . read extern data ( object input stream . java : 1835 ) java . io . object input stream . read ordinari object ( object input stream . java : 1794 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read object ( object input stream . java : 370 ) com . sun . facelet . el . tag method express . read extern ( tag method express . java : 101 ) java . io . object input stream . read extern data ( object input stream . java : 1835 ) java . io . object input stream . read ordinari object ( object input stream . java : 1794 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . default read field ( object input stream . java : 1989 ) java . io . object input stream . read serial data ( object input stream . java : 1913 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read object ( object input stream . java : 370 ) java . util . arrai list . read object ( arrai list . java : 733 ) sun . reflect . gener method accessor90 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 601 ) java . io . object stream class . invok read object ( object stream class . java : 1004 ) java . io . object input stream . read serial data ( object input stream . java : 1891 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . read arrai ( object input stream . java : 1704 ) java . io . object input stream . read object0 ( object input stream . java : 1342 ) java . io . object input stream . default read field ( object input stream . java : 1989 ) java . io . object input stream . read serial data ( object input stream . java : 1913 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read object ( object input stream . java : 370 ) java . util . hash map . read object ( hash map . java : 1155 ) sun . reflect . gener method accessor89 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 601 ) java . io . object stream class . invok read object ( object stream class . java : 1004 ) java . io . object input stream . read serial data ( object input stream . java : 1891 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read object ( object input stream . java : 370 ) java . util . hash map . read object ( hash map . java : 1155 ) sun . reflect . gener method accessor89 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 601 ) java . io . object stream class . invok read object ( object stream class . java : 1004 ) java . io . object input stream . read serial data ( object input stream . java : 1891 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . default read field ( object input stream . java : 1989 ) java . io . object input stream . default read object ( object input stream . java : 499 ) org . ajax4jsf . applic . ajax state holder . read object ( ajax state holder . java : 204 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 57 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 601 ) java . io . object stream class . invok read object ( object stream class . java : 1004 ) java . io . object input stream . read serial data ( object input stream . java : 1891 ) java . io . object input stream . read ordinari object ( object input stream . java : 1796 ) java . io . object input stream . read object0 ( object input stream . java : 1348 ) java . io . object input stream . read object ( object input stream . java : 370 ) org . apach . catalina . session . standard session . read object ( standard session . java : 1595 ) org . apach . catalina . session . standard session . read object data ( standard session . java : 1060 ) org . apach . catalina . session . jdbcstore . load ( jdbcstore . java : 657 ) org . apach . catalina . session . persist manag base . swap ( persist manag base . java : 707 ) . . . 11 more cannot deseri session when contain externaliz object ( us persist manag )

ws filter compat async sampl applic

context config valid secur role emit three info log messag which contain warn

apach tomcat 7 ha creat some veri import enhanc log , we should exploit them . pleas make org . apach . juli . async file handler org . apach . juli . line formatt default ship conf log . properti . enhanc have been vet over 20 releas apach tomcat , let s give them some first class statu . pleas make async file handler line formatt default log . properti

describ user list : tomcat 8 , unlik tomcat 7 . 0 . 42 , throw illeg argument except upon call servlet context . get real path ( ) . seem tc8 expect argument provid get real path non empti string . i believ servlet context . get real path should allow empti string argument . ognjen stack trace : error java . lang . illeg argument except java . lang . illeg argument except org . apach . catalina . webresourc . abstract resourc set . check path ( abstract resourc set . java : 39 ) org . apach . catalina . webresourc . dir resourc set . get resourc ( dir resourc set . java : 91 ) org . apach . catalina . webresourc . standard root . get resourc intern ( standard root . java : 176 ) org . apach . catalina . webresourc . cach resourc . valid ( cach resourc . java : 62 ) org . apach . catalina . webresourc . cach . get resourc ( cach . java : 78 ) org . apach . catalina . webresourc . standard root . get resourc ( standard root . java : 163 ) org . apach . catalina . core . standard context . get real path ( standard context . java : 4528 ) org . apach . catalina . core . applic context . get real path ( applic context . java : 398 ) org . apach . catalina . core . applic context facad . get real path ( applic context facad . java : 335 ) org . apach . axis2 . deploy . war base axi configur . init ( war base axi configur . java : 103 ) org . apach . axis2 . transport . http . axi servlet . init config context ( axi servlet . java : 584 ) org . apach . axis2 . transport . http . axi servlet . init ( axi servlet . java : 454 ) org . apach . catalina . core . standard wrapper . init servlet ( standard wrapper . java : 1235 ) org . apach . catalina . core . standard wrapper . load servlet ( standard wrapper . java : 1148 ) org . apach . catalina . core . standard wrapper . load ( standard wrapper . java : 1044 ) org . apach . catalina . core . standard context . load startup ( standard context . java : 5025 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5322 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 726 ) org . apach . catalina . core . contain base . add child ( contain base . java : 702 ) org . apach . catalina . core . standard host . add child ( standard host . java : 698 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 968 ) org . apach . catalina . startup . host config deploi war . run ( host config . java : 1742 ) java . util . concurr . executor runnabl adapt . call ( executor . java : 471 ) java . util . concurr . futur task sync . inner run ( futur task . java : 334 ) java . util . concurr . futur task . run ( futur task . java : 166 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1145 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 615 ) java . lang . thread . run ( thread . java : 724 ) webresourc class abstract resourc set throw except upon callong servlet context . get real path ( )

issu : digest authent flow work error thrown : function sequenc error packag name : org . apach . catalina . realm class name : jdbcrealm method name : string get password ( string usernam ) snapshot from abov mention method = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = stmt = credenti ( db connect , usernam ) ; rs = stmt . execut queri ( ) ; due thi connect commit , resultset nullifi db connect . commit ( ) ; while execut thi statement throw function sequenc error ( rs . next ( ) ) { db credenti = rs . get string ( 1 ) ; } = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = abov explan ha been valid place 7 . 0 . 41 catalina . jar where abov chang ar due fix 55071 bug below snapshot error observ while try digest authent = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = jul 31 , 2013 3 : 43 : 40 pm org . apach . catalina . realm . jdbcrealm get password sever : except perform authent java . sql . sqlexcept : time ten time ten 11 . 2 . 2 . 5 . 0 odbc driver function sequenc error com . timesten . jdbc . jdbc odbc . creat sqlexcept ( jdbc odbc . java : 3238 ) com . timesten . jdbc . jdbc odbc . standard error ( jdbc odbc . java : 3387 ) com . timesten . jdbc . jdbc odbc . sqlfetch ( jdbc odbc . java : 921 ) com . timesten . jdbc . jdbc odbc result set . next ( jdbc odbc result set . java : 409 ) org . apach . catalina . realm . jdbcrealm . get password ( jdbcrealm . java : 558 ) org . apach . catalina . realm . realm base . get digest ( realm base . java : 1189 ) org . apach . catalina . realm . realm base . authent ( realm base . java : 409 ) com . kodiak . digest . authent . kn digest authent kn digest info . authent ( kn digest authent . java : 733 ) com . kodiak . digest . authent . kn digest authent . authent ( kn digest authent . java : 275 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 574 ) org . apach . catalina . valv . access log valv . invok ( access log valv . java : 953 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 171 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 99 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 408 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1023 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 589 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 312 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1145 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 615 ) java . lang . thread . run ( thread . java : 724 ) jul 31 , 2013 3 : 43 : 40 pm org . apach . catalina . realm . jdbcrealm get password sever : except perform authent java . sql . sqlexcept : time ten time ten 11 . 2 . 2 . 5 . 0 odbc driver function sequenc error com . timesten . jdbc . jdbc odbc . creat sqlexcept ( jdbc odbc . java : 3238 ) com . timesten . jdbc . jdbc odbc . standard error ( jdbc odbc . java : 3387 ) com . timesten . jdbc . jdbc odbc . sqlfetch ( jdbc odbc . java : 921 ) com . timesten . jdbc . jdbc odbc result set . next ( jdbc odbc result set . java : 409 ) org . apach . catalina . realm . jdbcrealm . get password ( jdbcrealm . java : 558 ) org . apach . catalina . realm . realm base . get digest ( realm base . java : 1189 ) org . apach . catalina . realm . realm base . authent ( realm base . java : 409 ) localhost . 2013 07 31 . log 50l , 3800c cheer , mahaaboob jdbcrealm digest authent flow work throw function sequenc error

when ws browser client disconnect unexpectedli ( e . g . snake sampl user just close browser load anoth page ) you get ugl error log tomcat server . e . g . 2013 07 27 12 : 04 : 34 . 424 error 31847 nio 8080 exec 7 org . apach . tomcat . websocket . ws session : fail send close messag remot endpoint java . io . ioexcept : java . util . concurr . execut except : java . io . eofexcept org . apach . tomcat . websocket . ws remot endpoint impl base . start messag block ( ws remot endpoint impl base . java : 221 ) org . apach . tomcat . websocket . ws session . send close messag ( ws session . java : 466 ) org . apach . tomcat . websocket . ws session . close ( ws session . java : 430 ) org . apach . tomcat . websocket . server . ws http upgrad handler . close ( ws http upgrad handler . java : 172 ) org . apach . tomcat . websocket . server . ws http upgrad handler . access 200 ( ws http upgrad handler . java : 45 ) org . apach . tomcat . websocket . server . ws http upgrad handler ws read listen . data avail ( ws http upgrad handler . java : 198 ) org . apach . coyot . http11 . upgrad . abstract servlet input stream . data avail ( abstract servlet input stream . java : 169 ) org . apach . coyot . http11 . upgrad . abstract processor . upgrad dispatch ( abstract processor . java : 95 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 630 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . do run ( nio endpoint . java : 1585 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1543 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1145 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 615 ) java . lang . thread . run ( thread . java : 724 ) caus : java . util . concurr . execut except : java . io . eofexcept org . apach . tomcat . websocket . ws remot endpoint impl base futur send handler . get ( ws remot endpoint impl base . java : 779 ) org . apach . tomcat . websocket . ws remot endpoint impl base . start messag block ( ws remot endpoint impl base . java : 217 ) . . . 14 common frame omit caus : java . io . eofexcept : null org . apach . tomcat . websocket . server . ws remot endpoint impl server . do close ( ws remot endpoint impl server . java : 126 ) org . apach . tomcat . websocket . ws remot endpoint impl base . close ( ws remot endpoint impl base . java : 531 ) org . apach . tomcat . websocket . server . ws remot endpoint impl server . write possibl ( ws remot endpoint impl server . java : 107 ) org . apach . tomcat . websocket . server . ws remot endpoint impl server . do write ( ws remot endpoint impl server . java : 71 ) org . apach . tomcat . websocket . ws remot endpoint impl base . write messag part ( ws remot endpoint impl base . java : 353 ) org . apach . tomcat . websocket . ws remot endpoint impl base . start messag ( ws remot endpoint impl base . java : 254 ) org . apach . tomcat . websocket . ws remot endpoint impl base . start messag block ( ws remot endpoint impl base . java : 211 ) . . . 14 common frame omit presum thi expect rel normal , so i d expect lot less nois ( error ) log ugli error log when ws client disconnect unexpectedli

i like fact sci scan off default tomcat embed instanc , i d lik eto abl switch . might even possibl alreadi , api non obviou . mayb method tomcat associ friendli helper would also nice tomcat 7 . sci scan embed tomcat

concurr issu tag plugin manag

includ jasper initi test environ i ad entri testclass meta inf servic . thi pick up when parent classload search becaus thi path directori jar file . would pick up scan all directori extens wa enabl should necessari search semant equival j . u . servic loader ( which doe locat ) . servlet contain initi parent classload mai found

did some load test thread got stuck , see dump . basic i just simul 100 user connect disconnect . nio thread lock

bug ws server contain lead npe

jsp properti group contain multipl includ prelud element happen refer same file onli includ perform . same appli coda . thi happen becaus web xml store link hash set rather than list . when multipl jsp properti group s ar combin , jsp config us vector so preserv duplic requir jsp spec . i have test case demonstr thi befor commit fix i would like confirm web xml s behaviour incorrect . duplic prelud coda same jsp properti group ar ignor

jsp properti same all url pattern group ; current code creat new each iter unnecessari work jsp config

test suit should includ test jsp c ant task add test case jsp c

chang how servlet context wa creat miss initi tld locat cach jsp c doe initi tld locat cach result npe

jsp c throw class found except from digest

websocket soe nio endpoint

websocket npe clear handler ( ws remot endpoint impl server . java : 156 )

abstract http11processor overwrit date header , even when set applic

xml syntax , jsp : text doe error sub element from other namespac

jsp c s jsp config now read version jsp config inform from servlet context . us get major version ( ) which return maximum version support contain . should us get effect version ( ) us version web applic . servlet context . get jsp config descriptor ( ) can return null jsp config web . xml . jsp config doe allow thi throw npe e . g . web . xml applic . npe incorrect version detect jsp c

digest us sax2 featur still base sax1 default handler . upgrad default handler2 would abl handl base uri when resolv entiti would have default implement lexic handler . us lexic handler would allow respond directli start dtd event report doctyp ( present ) so would need infer from first attempt resolv entiti . upgrad digest base default handler2 us lexic handler detect public id

duplic function exist both schema resolv parser util . my entiti resolv . s also basic version digest . common entiti resolv can us catalina jasper

javax servlet resourc packag doe contain jsp specif xsd . ar referenc from web app web common xsd defin element like jsp config . schema locat refer between servlet jsp xsd ar invalid

sever : servlet content initi licens apach softwar foundat ( asf ) under more could creat

i see sometim fail connect due ioexcept ( see below ) . thi happen when try send thousand binari messag ( 1024 byte each ) without ani delai between subsequ messag . have look code async channel wrapper secur write task . run ( 219 ) , i think correct assum all byte buffer ar written , thi shall produc ioexcept . i think thi case , shall attempt write rest byte cycl . here except i got dure test : except : java . io . ioexcept : java . util . concurr . execut except : java . io . ioexcept : onli wrote 460 1 , 098 byte org . apach . tomcat . websocket . ws remot endpoint impl base . start messag block ( ws remot endpoint impl base . java : 204 ) org . apach . tomcat . websocket . ws remot endpoint impl base . send byte ( ws remot endpoint impl base . java : 113 ) org . apach . tomcat . websocket . ws remot endpoint basic . send binari ( ws remot endpoint basic . java : 43 ) websocket test manag test thread . run ( websocket test manag . java : 271 ) caus : java . util . concurr . execut except : java . io . ioexcept : onli wrote 460 1 , 098 byte org . apach . tomcat . websocket . ws remot endpoint impl base futur send handler . get ( ws remot endpoint impl base . java : 729 ) org . apach . tomcat . websocket . ws remot endpoint impl base . start messag block ( ws remot endpoint impl base . java : 202 ) . . . 3 more caus : java . io . ioexcept : onli wrote 460 1 , 098 byte org . apach . tomcat . websocket . async channel wrapper secur write task . run ( async channel wrapper secur . java : 220 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1145 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 615 ) java . lang . thread . run ( thread . java : 789 ) websocket problem write mani subsequ binari messag

us ipvhost = true , incorrect get request . local name

npe pojo method map get messag handler

miss ws protocol header session negoti header

subprotocol avail annot serverendpoint

ping pong messag should have ident applic data

i configur server . xml like thi : connect timeout = 1 disabl upload timeout = fals connect upload timeout = 200 ( mayb stupid configur like thi , connect timeout = 1 , can i make disabl upload timeout = fals ) . caus : java . lang . illeg argument except : timeout can t neg sun . nio . ch . socket adaptor . set so timeout ( socket adaptor . java : 361 ) org . apach . coyot . http11 . http11nio processor . set socket timeout ( http11nio processor . java : 251 ) . . . . . . becaus : ( disabl upload timeout ) { endpoint . get so timeout ( ) = 1 . set socket timeout ( endpoint . get so timeout ( ) ) ; } anoth thing : i configur connect timeout = 0 . nio block selector . read ( byte buffer buf , nio channel socket , long read timeout ) , read timeout = 0 , case socket . read ( buf ) = = 0 , make timeout = true . ( read timeout = 0 ( keycount = = 0 ) ) timedout = ( system . current time milli ( ) time ) = read timeout ; throw socket timeout except ( ) . thank you . connect timeout = 1 caus timeout can t neg

i have test which add messag handler which get notifi text messag . implement method messag ( string text ) throw some except ( e . g . runtim except ) , thi messag handler never ever notifi again ani new text messag receiv session . i suppos thi happen becaus except actual kill underli thread which notif ha happen . i think client side implement shall more robust expect prepar except come from call user code . jsr 356 websocket messag handler never get notifi again after throw except

incorrect paramet name remot ip valv exampl

connect timeout = 1 caus high cpu

abil bundl jaa configur webappp

when i configur disabl upload timeout = fals connect timeout = 20000 , connect upload timeout = 30000 . i found connect upload timeout doesn t work , becaus code intern nio input buffer . read socket ( ) : try { nio endpoint . kei attach att = ( nio endpoint . kei attach ) socket . get attach ( fals ) ; ( att = = null ) throw new ioexcept ( kei must cancel . ) ; n read = pool . read ( socket . get buf handler ( ) . get read buffer ( ) , socket , selector , att . get timeout ( ) ) ; } catch ( eofexcept eof ) { n read = 1 ; } final { ( selector = null ) pool . put ( selector ) ; } att . get timeout ( ) connect timeout , connect upload timeout . so , nio block selector . read ( ) , read timeout connect timeout nio connect upload timeout can t work

wast work attribut name enumer constructor

wast work error report valv . get partial servlet stack trace

abil configur rmi bind address

fix msg byte encod decod test encod decod websocket test

add abil report time taken prepar respons

tomcat doe shut down lifecycl listen throw except

encod init destroi method ar never call

iae thrown dure deploy server end point have multipl text decod

basic authent parser associ unit test

tomcat jar scan doe work when tomcat start java web start

usual error ( secur hole ) secur constraint ar defin some all http method given url . situat detect web applic start , log . log uncov http method combin secur constraint

wast work valid visitor . express (

wast work abstract replic map . exclud from set

wast work webdav servlet . lock

wast work test non login basic authent . do test basic

juli make class loader log manag . get properti ( ) try unprefix properti prefix doe exist

cor filter

current ant deploi task doe support separ paramet version , thank urlencod , workaround . app empti context s possibl defin version us , like set path some context some version . app empti context we receiv error : case 1 : deploi url = { tomcat . manag } text usernam = { usernam } , password = { password } path = root 12345 war = { pathtowar } result : fail deploi applic context path root 12345 case 1 : deploi url = { tomcat . manag } text usernam = { usernam } , password = { password } path = 12345 war = { pathtowar } result : fail deploi applic context path 12345 deploi root webapp version through text manag us ant

test i found jsessionidsso wa re creat upon re authent via logout ( ) login ( usernam , password ) same request . problem stem from req ssoid note wa wa reset upon request . logout ( ) , wherea document indic logout ( ) from ani web app should logout ( ) from all web app . when req ssoid note remov upon logout ( ) , subsequ login ( usernam , password ) same request re creat jsessionid current web app fail re creat jsessionidsso sinc req sso id note still linger request . authent base . java adjust logout ( request ) remov req ssoid note so subsequ login ( usernam , password ) work same request : overrid public void logout ( request request ) throw servlet except { regist ( request , request . get respons ( ) , null , null , null , null ) ; request . remov note ( constant . req ssoid note ) ; } i ll upload diff patch against trunk 7 . 0 . 40 . jsessionidsso re creat upon re authent same request logout ( ) login ( usernam , password )

ssl handshak implement asycn channel wrapper secur doe handl sslengin result . statu . buffer underflow sslengin result . statu . buffer overflow state

1 . file name paramet rel vs absolut fila name paramet specif 1 jsr 000315 java servlet 3 . 0 final releas javadoc differ from 2 javax api tomcat refer . 1 jsr 000315 java servlet 3 . 0 final releas javadoc paramet : file name name file which stream written . file creat rel locat specifi multipart config 2 javax . api tomcat refer param file name locat which upload part should store . rel locat ar rel { link javax . servlet . multipart config element get locat ( ) } tomcat implement specifi 2 so can process absolut path , should onli accept rel path specifi 1 jsr 000315 java servlet 3 . 0 final releas javadoc 2 . multi part config . locat set , write ( string rel path ) throw file found except . default locat need set order avoid except . exampl ) os : windows8 part . write ( test ) ; java . io . ioexcept : java . io . file found except : test ( access deni ) org . apach . catalina . core . applic part . write ( applic part . java : 123 ) servlet . multipart . multipl upload servlet . do post ( multipl upload servlet . java : 76 ) javax . servlet . http . http servlet . servic ( http servlet . java : 647 ) javax . servlet . http . http servlet . servic ( http servlet . java : 728 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 305 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 222 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 123 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 472 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 171 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 99 ) org . apach . catalina . valv . access log valv . invok ( access log valv . java : 947 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 408 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1009 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 589 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 312 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 895 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 918 ) java . lang . thread . run ( thread . java : 662 ) javax . servlet . http . part . write ( string file name ) properli implement

class load issu tag plugin tag plugin manag

concurr issu spdy net support socket

make compress configur spdy proxi protocol

http request broken up across multipl packet first packet contain get request up r n termin first line request includ next packet tomcat incorrectli throw http 505 version support respons . thi http11nio protocol connector onli default http 1 . 1 connector doe exhibit thi problem . exampl request : packet 1 : get http 1 . 1 r packet 2 : n host : localhost r n packet 3 : connect : close r n r n respons : http 1 . 1 505 http version support server : apach coyot 1 . 1 date : thu , 09 mai 2013 20 : 23 : 58 gmt connect : close follow python program reproduc problem me both tomcat 6 . 0 . 37 tomcat 7 . 0 . 39 : usr bin python import socket import time s = socket . socket ( ) s . connect ( ( localhost , 8080 ) ) s . sendal ( get http 1 . 1 r ) time . sleep ( 1 . 5 ) make sure abov goe out own packet s . sendal ( n host : localhost r n ) s . sendal ( connect : close r n r n ) print s . makefil ( ) . read ( ) move n from second sendal end first sendal caus tomcat respond correctli . http11nio protocol gener http 505 respons valid request request split across multipl packet

enhanc test form authent

jsp : includ page = blabla flush = true fail compil under secur manag

bug occur when form data post multipart form data us servlet 3 api get post file . servlet , we set encod : request . set charact encod ( utf 8 ) ; invok : request . get part ( ) invok : string text = request . get paramet ( sometextfield ) ; utf 8 charact text have been garbl . order method call ar signific , get paramet call befor get part , correct encod us . howev , order which you invok method should matter . multipart form data alwai read correct encod

async scenario ( request . start async ) , when client goe awai , try write respons rais ioexcept . i call async context . complet ( ) order final clean up request , soon after follow except occur : java . lang . illeg state except : call async error ( ) valid request async state complet org . apach . coyot . async state machin . async error ( async state machin . java : 304 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 793 ) org . apach . coyot . request . action ( request . java : 373 ) org . apach . catalina . core . async context impl . set error state ( async context impl . java : 441 ) org . apach . catalina . connector . coyot adapt . async dispatch ( coyot adapt . java : 312 ) org . apach . coyot . http11 . abstract http11processor . async dispatch ( abstract http11processor . java : 1509 ) org . apach . coyot . http11 . http11nio processor . async dispatch ( http11nio processor . java : 221 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 619 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . do run ( nio endpoint . java : 1581 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1540 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) look like attempt mayb send error event async listen s async context . complet ha alreadi been call . call async context . complet ( ) reason wai handl ioexcept from respons order final request releas ani resorc associ illeg state except : call async error ( ) valid request async state complet

map applic context root return 404 after reload

accord servlet 3 . 0 javadoc servlet context . get jsp config descriptor ( ) must return null when jsp configur : return : jsp config relat configur wa aggreg from web . xml web fragment . xml descriptor file web applic repres thi servlet context , null configur exist servlet context . get jsp config descriptor ( ) should return null when jsp configur

accord servlet 3 . 0 javadoc javax . servlet . session cooki config setter method must throw illeg state except when invok after initi phase set comment ( string ) set domain ( string ) set http onli ( boolean ) set max ag ( int ) set name ( string ) set path ( string ) set secur ( boolean ) throw : java . lang . illeg state except servlet context from which thi session cooki config wa acquir ha alreadi been initi session cooki config . set xxx method must throw illeg state except when invok after initi phase

input pars media type ( ) multipart sign ; protocol = applic pkcs7 signatur ; micalg = sha 256 ; boundari = = part 121 929034657 . 1363355797756 except trace java . lang . null pointer except org . apach . tomcat . util . http . parser . http parser . pars media type ( http parser . java : 215 ) org . apach . tomcat . util . http . parser . media type cach . pars ( media type cach . java : 54 ) org . apach . catalina . connector . respons . set content type ( respons . java : 806 ) org . apach . catalina . connector . respons . check special header ( respons . java : 1119 ) org . apach . catalina . connector . respons . set header ( respons . java : 1446 ) org . apach . catalina . connector . respons facad . set header ( respons facad . java : 535 ) nullpoint except http parser . pars media type

webapp class loader . load thi child can throw concurr modif except

ws filter perform sever valid web socket request befor check regist endpoint . i think check regist endpont ( deleg next filter ) should take place first filter should do further process map endpoint url . exampl sock js protocol test send post request connect upgrad header ws version header expect back 405 ( invalid http method ) where ws filter send 426 even though ha endpoint map url . ws filter perform handshak valid even doesn t have map endpoint

tag plugin each doesn t support csv item

el like express jsp : scriptlet break compil jsp xml document

http request us post method , tomcat call do get ( ) what realli strage . i onli test 7 . 0 . 23 , 7 . 0 . 32 . 7 . 0 . 32 , 7 . 0 . 32 more reproduc than 7 . 0 . 23 . i know must veri strang issu , tomcat ha so mani releas . i can t believ i didn t see my own ey . so i attach imag . cve 2013 2071 runtim except complet async listen , make org . apach . catalina . connector . request recycl ( orgin report messag post tomcat , call do get )

us base file name ( root ) work directori default webapp instead

npe ws server contain match path

thi look relat 54659 54724 possibl new issu . reproduc , open chat sampl page , send messag two , close browser tab . follow except appear log doesn t seem step from anyth done applic : java . lang . illeg state except : web socket session ha been close method ( apart from close ( ) ) mai call close session org . apach . tomcat . websocket . ws session . check state ( ws session . java : 516 ) org . apach . tomcat . websocket . ws session . get messag handler ( ws session . java : 191 ) org . apach . tomcat . websocket . pojo . pojo endpoint base . close ( pojo endpoint base . java : 113 ) org . apach . tomcat . websocket . ws session . fire endpoint close ( ws session . java : 392 ) org . apach . tomcat . websocket . ws session . close ( ws session . java : 370 ) org . apach . tomcat . websocket . server . ws http upgrad handler . close ( ws http upgrad handler . java : 166 ) org . apach . tomcat . websocket . server . ws http upgrad handler . access 200 ( ws http upgrad handler . java : 44 ) org . apach . tomcat . websocket . server . ws http upgrad handler ws read listen . data avail ( ws http upgrad handler . java : 192 ) org . apach . coyot . http11 . upgrad . abstract servlet input stream . data avail ( abstract servlet input stream . java : 169 ) org . apach . coyot . http11 . upgrad . abstract processor . upgrad dispatch ( abstract processor . java : 94 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 618 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . do run ( nio endpoint . java : 1581 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1537 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) illeg state except chat sampl

whenev web socket contain us connect server endpoint , follow messag appear when tomcat shut down : sever : web applic websocket test appear have start thread name thread 4 ha fail stop . thi veri like creat memori leak . messag repeat 6 differ thread . i don t have proof thi caus us web socket contain messag don t appear when isn t us . endpoint us connect veri simpl . send messag when session open echo endpoint server side , print respons close when messag echo back . possibl thread memori leak us web socket contain

caus : java . lang . class cast except : org . apach . tomcat . websocket . server . ws server contain templat path match cannot cast java . lang . compar java . util . tree map . compar ( tree map . java : 1188 ) java . util . tree map . put ( tree map . java : 531 ) java . util . tree set . add ( tree set . java : 255 ) org . apach . tomcat . websocket . server . ws server contain . add endpoint ( ws server contain . java : 144 ) org . apach . tomcat . websocket . server . ws sci . startup ( ws sci . java : 118 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5195 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) . . . 11 more reproduc when path defin { path } . exampl : overrid public set server endpoint config get endpoint config ( set class extend endpoint >> endpoint class ) { logger . debug ( { } detect , jsr356server endpoint config . class . get name ( ) ) ; return new hash set server endpoint config ( ) { { add ( server endpoint config . builder . creat ( jsr356endpoint . class , { path } ) . configur ( c ) . build ( ) ) ; } } ; } jsr356 java . lang . class cast except : org . apach . tomcat . websocket . server . ws server contain templat path match

url queri string can t work over spdy

folder without web fragment . xml should impact statu distribut

type base endpoint s , ws servlet instanti endpoint via reflect instead us configur done pojo endpoint server : sec . get configur ( ) . get endpoint instanc ( sec . get endpoint class ( ) ) type base endpoint s cannot deploi instanc

ioexcept new frame receiv after close control frame rais after press disconnect . except can detect ad error method echo endpoint . ioexcept echo web socket exampl

statement cach interceptor doe forward call statement . close ( ) which caus memori leak

server side , creat data sourc us org . apach . tomcat . jdbc . pool . data sourc factori . ex : resourc auth = contain descript = name = jdbc test tomcat jdbc factori = org . apach . tomcat . jdbc . pool . data sourc factori type = javax . sql . data sourc usernam = sa password = super secret driver class name = org . h2 . driver url = jdbc : h2 : mem : test min idl = 1 initi size = 1 web applic , creat jsp file , add follow : page import = javax . name . session = fals doctyp html html head titl displai password titl head bodi h1 string tomcat jdbc h1 data sourc = ( javax . sql . data sourc ) ctx . lookup ( java : comp env jdbc test tomcat jdbc ) ; out . println ( p data sourc . string ( ) p ) ; bodi html access jsp your browser . output from string data sourc displai password wa configur resourc tag . exampl output : string tomcat jdbc org . apach . tomcat . jdbc . pool . data sourc 75cae120 { connect pool default auto commit = null ; default read onli = null ; default transact isol = 1 ; default catalog = null ; driver class name = org . h2 . driver ; max activ = 100 ; max idl = 100 ; min idl = 1 ; initi size = 1 ; max wait = 30000 ; test borrow = fals ; test return = fals ; time between evict run milli = 5000 ; num test per evict run = 0 ; min evict idl time milli = 60000 ; test while idl = fals ; test connect = fals ; password = super secret ; url = jdbc : h2 : mem : test ; usernam = sa ; valid queri = null ; valid class name = null ; valid interv = 30000 ; access underli connect allow = true ; remov abandon = fals ; remov abandon timeout = 60 ; log abandon = fals ; connect properti = null ; init sql = null ; jdbc interceptor = null ; jmx enabl = true ; fair queue = true ; us equal = true ; abandon when percentag full = 0 ; max ag = 0 ; us lock = fals ; data sourc = null ; data sourc jndi = null ; suspect timeout = 0 ; altern usernam allow = fals ; commit return = fals ; rollback return = fals ; us dispos connect facad = true ; log valid error = fals ; propag interrupt state = fals ; } data sourc password expos applic via string method

spec java doc sai : onc session close , longer valid us applic . call ani method onc session ha been close result illeg state except thrown . develop should retriev ani inform from session dure endpoint . close ( session , close reason ) method . cours , rule closeabl also appli here , call session close ( . . . ) more than onc should have effect subsequ time . ar actual three problem here : 1 ) none method throw illeg state except session close . instead , thei return thing ( like basic remot , exampl ) , some method endpoint implement notic concurr except from socket block forev wait four countdown clear . 2 ) session state never actual chang state . close unless session close call . howev , session close never actual call i can find ( though i look harder befor i make chang ) . 3 ) even session close , state incorrectli chang state . close befor endpoint close call , when should chang after . i m work patch thi . ws session doe throw illeg state except close when method ar call

remot endpoint block indefinit send object call binari stream text stream encod

java web socket specif sai messag method can have input stream reader paramet ; close can have close reason paramet

offici scheme web socket ar ws wss ; ws web socket contain onli allow http http

prefer local . english over local . us case convers

i have defin server end point : server endpoint ( valu = ws { mid } { rid } { uid } ) when us path param messag , valu ar null . other annot like open close print valu specifi url . messag public void text messag ( path param ( mid ) long mid , path param ( rid ) integ rid , path param ( uid ) long uid , session session , string messag , boolean pair ) { log . debug ( text : mid : rid : uid messag : session . get request uri ( ) ) ; } path param work messag

hello i think i ve found file descriptor leak file tomcat trunk java org apach catalina startup context config . java ( method get global web xml sourc ) . stream from file web . xml close . privat web xml get default web xml fragment ( ) { . . . 1284 input sourc global web xml = get global web xml sourc ( ) ; . . . 1337 pars global web . xml present 1338 ( global web xml = = null ) { 1339 thi unusu enough log 1340 log . info ( sm . get string ( context config . default miss ) ) ; 1341 } els { 1342 pars web xml ( global web xml , web xml default fragment , fals ) ; 1343 } here full stack trace java . io . file input stream . init ( file input stream . java : 109 ) org . apach . catalina . startup . context config . get web xml sourc ( context config . java : 1837 ) org . apach . catalina . startup . context config . get global web xml sourc ( context config . java : 1744 ) org . apach . catalina . startup . context config . get default web xml fragment ( context config . java : 1417 ) org . apach . catalina . startup . context config . web config ( context config . java : 1253 ) org . apach . catalina . startup . context config . configur start ( context config . java : 878 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 369 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 90 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5173 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 901 ) org . apach . catalina . core . contain base . add child ( contain base . java : 877 ) org . apach . catalina . core . standard host . add child ( standard host . java : 633 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 977 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 542 ) org . apach . catalina . startup . host config . check ( host config . java : 1462 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . tomcat . util . model . base model mbean . invok ( base model mbean . java : 301 ) com . sun . jmx . interceptor . default mbean server interceptor . invok ( default mbean server interceptor . java : 836 ) com . sun . jmx . mbeanserv . jmx mbean server . invok ( jmx mbean server . java : 761 ) org . apach . catalina . manag . manag servlet . check ( manag servlet . java : 1445 ) org . apach . catalina . manag . htmlmanag servlet . upload ( htmlmanag servlet . java : 301 ) org . apach . catalina . manag . htmlmanag servlet . do post ( htmlmanag servlet . java : 208 ) javax . servlet . http . http servlet . servic ( http servlet . java : 647 ) javax . servlet . http . http servlet . servic ( http servlet . java : 728 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 305 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . filter . csrf prevent filter . do filter ( csrf prevent filter . java : 213 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 243 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . filter . set charact encod filter . do filter ( set charact encod filter . java : 108 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 243 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 222 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 123 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 581 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 171 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 99 ) org . apach . catalina . valv . access log valv . invok ( access log valv . java : 931 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 407 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1004 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 589 ) org . apach . tomcat . util . net . apr endpoint socket processor . run ( apr endpoint . java : 1822 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 662 ) file descriptor leak web . xml load

implement part get submit file name from servlet spec 57

when access log valv ad catalina host jmx add vale ( ) oper host object name , valv start default file date format . chang attribut valv through s jmx object name ha effect becaus valv alreadi start . execut rotat ( ) oper valv doe also have effect . step reproduc : start tomcat server add host us jmx add valv host us jmx set valv attribut file date format someth els than yyyi mm dd , exampl yy mm actual result : access log file format includ default file date format yyyi mm dd expect result : access log file format yy mm , from exampl . access log valv file date format can chang through jmx

http bio nio connector doe enabl tl 1 . 1 tl 1 . 2 default

spec sai server contain provid get server contain ( ) should public , implement packag privat tomcat 8 . 0

someth wrong when send binari data websocket . see org . apach . catalina . websocket . ws outbound . do write byte ( byte buffer , boolean ) i think write content upgrad outbound . write ( buffer . arrai ( ) , 0 , buffer . limit ( ) ) ; upgrad outbound . flush ( ) ; should chang : write content upgrad outbound . write ( buffer . arrai ( ) , buffer . arrai offset ( ) , buffer . limit ( ) ) ; upgrad outbound . flush ( ) ; exampl : byte bt = new byte { 1 , 2 , 3 , 4 , 5 } byte buffer bf = byte buffer . wrap ( bt , 2 , 2 ) ; out . write binari messag ( bf ) ; i mean write 3 , 4 client , fact 1 , 2 , 3 , 4 sent ; someth wrong when send binari data websocket .

setup : tomcat ajp connector behind mod proxi ajp , form base authent . when session expir post request submit , tomcat show login form , user log , authent tri restor origin post request . do , tri swallow ajp messag bodi befor replac bodi request origin post request bodi . tri read first 4 byte ajp messag ( messag length ) block forev wait those 4 byte . form authent hang re authent post request behind mod proxi ajp

fatal error when try send data web socket conect close

hi all , manag statu xml = true , inform about memori pool ar incorrect . everi row all valu ( initi , commit , maximum , us ) ar same : memori pool name : eden space type : heap memori initi : 143130624 commit : 143130624 maximum : 143130624 us : 143130624 name : survivor space type : heap memori initi : 17891328 commit : 17891328 maximum : 17891328 us : 17891328 name : tenur gen type : heap memori initi : 357957632 commit : 357957632 maximum : 357957632 us : 357957632 name : code cach type : non heap memori initi : 163840 commit : 8421376 maximum : 33554432 us : 163840 name : perm gen type : non heap memori initi : 12582912 commit : 23330816 maximum : 67108864 us : 12582912 name : perm gen share ro type : non heap memori initi : 10485760 commit : 10485760 maximum : 10485760 us : 10485760 name : perm gen share rw type : non heap memori initi : 12582912 commit : 12582912 maximum : 12582912 us : 12582912 instead gui page valu ar correct . manag statu xml = true

custom webapp class loader creat deleg = true parent first classload model us . everyth work here expect . howev jsp classpath alwai construct follow manner : custom webapp class loader . url ; parent . url ; parent . . . parent . url wherea expect me deleg = true parent s url should come first . webapp loader doesn t honor deleg attr while construct jsp classpath

request contain uri end multi byte charact which miss byte extra byte ar left buffer which reus futur request . problem come from two differ thing : 1 ) b2cconvert tri convert byte chunk which end charact underflow doe convert last charact left buffer b2cconver . 2 ) b2cconvert org . apach . catalina . connector . request recycl rest object . look like thi done intention base comment abov s declar . issu b2cconvert can demonstr code below , which simplif what done insid coyot adapt . convert uri ( ) : code b2cconvert conv = new b2cconvert ( utf 8 ) ; byte chunk bc = new byte chunk ( ) ; char chunk cc = new char chunk ( ) ; byte byte = { 0x61 , 0x62 , 0x63 , 0x64 , 8 , 69 , 73 , 77 } ; bc . append ( byte , 0 , byte . length ) ; cc . alloc ( bc . get length ( ) , 1 ) ; conv . convert ( bc , cc , cc . get buffer ( ) . length cc . get end ( ) ) ; system . out . println ( cc ) ; cc . recycl ( ) ; bc . recycl ( ) ; bc . append ( byte , 0 , byte . length ) ; cc . alloc ( bc . get length ( ) , 1 ) ; conv . convert ( bc , cc , cc . get buffer ( ) . length cc . get end ( ) ) ; system . out . println ( cc ) ; code b2cconvert wa recycl everyth els request thi would prevent previou request from corrupt next request doesn t fix issu charact drop from initi decod . i tri plai b2cconvert onli wai i could get convert get everyth wa ignor limit argument read end stream . look like tomcat8 move thi direct move nio , howev i tri plai latest b2cconvert wa still see issu given byte sequenc . b2cconvert charact decod underflow leav byte buffer

part class miss document

complet servlet 3 . 1 spec chang session id , http session id listen

error report valv doesn t respect http servlet respons . send error ( int sc , string msg )

extens el interpret

chunk input filter return eof when client close connect without send end chunk

concern compon : org . apach . catalina . authent . digest authent org . apach . catalina . authent . digest authent . nonc info scenario : multithread client send two request within millisecond . digest authent creat each request nonc well nonc info instanc . two nonc ar equal , thei were creat within same millisecond . when write data cach ( method gener nonc ( ) ) , second nonc info instanc overwrit first ( same kei ) . problem : two client thread send second request digest authent header . both request , nc ( nonc count ) equal 1 , nonc ha been newli creat . nonc info first request , arrai seen set true index ( ( nonc count offset ) seen . length ) . second request same nonc info instanc us , instanc retriev from map nonc us nonc kei , , both request same kei us . consequ , method nonc count valid ( ) return fals , seen ( nonc count offset ) seen . length ) ha alreadi been set true . therefor authent fail , although client ha sent valid digest authent header . conclus : work multi thread client mani request , digest authent doe function reliabl . digest authent : nonc count valid ( ) fail case simultan asynchron request same client

jmx connect mai load servlet invalid class loader

trunk r1441188 , run test suit apr connector , nativ 1 . 1 . 26 window 32 bit jdk 7u11 . i encount follow when run org . apach . catalina . loader . test virtual context test second re run test same issu happen , so someth specif here . i have encount issu rest testsuit yet . feb 01 , 2013 2 : 07 : 26 am org . apach . tomcat . util . net . apr endpoint poller run warn : unexpect poller error java . lang . null pointer except org . apach . tomcat . util . net . apr endpoint apr socket wrapper . access 200 ( apr endpoint . java : 2198 ) org . apach . tomcat . util . net . apr endpoint poller . run ( apr endpoint . java : 1632 ) java . lang . thread . run ( thread . java : 722 ) code apr endpoint poller . run ( apr endpoint . java : 1632 ) 1628 ( int n = 0 ; n rv ; n ) { 1629 timeout . remov ( desc n 2 1 ) ; 1630 apr socket wrapper wrapper = connect . get ( 1631 long . valu ( desc n 2 1 ) ) ; 1632 wrapper . poller flag = wrapper . poller flag ( ( int ) desc n 2 ) ; i suspect wrapper null here . abov code specif tomcat trunk present 7 . 0 . x . when thi happen , test hung 15 minut ( 1000 sec ) wait socket read . when time out pass , continu run all other test . testcas : test addit web inf class path took 1 006 , 735 sec caus error read time out java . net . socket timeout except : read time out java . net . socket input stream . socket read0 ( nativ method ) java . net . socket input stream . read ( socket input stream . java : 150 ) java . net . socket input stream . read ( socket input stream . java : 121 ) java . io . buffer input stream . fill ( buffer input stream . java : 235 ) java . io . buffer input stream . read1 ( buffer input stream . java : 275 ) java . io . buffer input stream . read ( buffer input stream . java : 334 ) sun . net . www . http . http client . pars httpheader ( http client . java : 633 ) sun . net . www . http . http client . pars http ( http client . java : 579 ) sun . net . www . protocol . http . http urlconnect . get input stream ( http urlconnect . java : 1322 ) java . net . http urlconnect . get respons code ( http urlconnect . java : 468 ) org . apach . catalina . startup . tomcat base test . method url ( tomcat base test . java : 247 ) org . apach . catalina . startup . tomcat base test . get url ( tomcat base test . java : 219 ) org . apach . catalina . startup . tomcat base test . get url ( tomcat base test . java : 213 ) org . apach . catalina . startup . tomcat base test . get url ( tomcat base test . java : 202 ) org . apach . catalina . loader . test virtual context . assert page contain ( test virtual context . java : 326 ) org . apach . catalina . loader . test virtual context . assert page contain ( test virtual context . java : 320 ) org . apach . catalina . loader . test virtual context . test addit web inf class path ( test virtual context . java : 311 ) null pointer except apr endpoint poller . run

observ thi when test tomcat trunk r1438747 , win xp 32 bit , jdk 7u11 . ( run test ws web socket contain apr , tomcat nativ 1 . 1 . 26 rc ) occur npe webapp class loader . check thread local map leak ( ) . wa uncaught caus lifecycl except ultim failur stop tomcat . = = = = = = = = = = = = = = = stderr : sever : child contain fail dure stop java . util . concurr . execut except : org . apach . catalina . lifecycl except : fail stop compon standard engin tomcat . standard host localhost . standard context java . util . concurr . futur task sync . inner get ( futur task . java : 252 ) java . util . concurr . futur task . get ( futur task . java : 111 ) org . apach . catalina . core . contain base . stop intern ( contain base . java : 974 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) org . apach . catalina . core . contain base stop child . call ( contain base . java : 1404 ) org . apach . catalina . core . contain base stop child . call ( contain base . java : 1393 ) java . util . concurr . futur task sync . inner run ( futur task . java : 334 ) java . util . concurr . futur task . run ( futur task . java : 166 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) caus : org . apach . catalina . lifecycl except : fail stop compon standard engin tomcat . standard host localhost . standard context org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) . . . 7 more caus : org . apach . catalina . lifecycl except : fail stop compon webapp loader org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) org . apach . catalina . core . standard context . stop intern ( standard context . java : 5365 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) . . . 7 more caus : java . lang . null pointer except sun . reflect . unsaf field accessor impl . ensur obj ( unsaf field accessor impl . java : 54 ) sun . reflect . unsaf object field accessor impl . get ( unsaf object field accessor impl . java : 36 ) java . lang . reflect . field . get ( field . java : 372 ) org . apach . catalina . loader . webapp class loader . check thread local map leak ( webapp class loader . java : 2247 ) org . apach . catalina . loader . webapp class loader . check thread local leak ( webapp class loader . java : 2188 ) org . apach . catalina . loader . webapp class loader . clear refer ( webapp class loader . java : 1731 ) org . apach . catalina . loader . webapp class loader . stop ( webapp class loader . java : 1641 ) org . apach . catalina . loader . webapp loader . stop intern ( webapp loader . java : 491 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) . . . 9 more = = = = = = = = = = = = = = = testcas : testcas : test small text buffer client text messag took 2 , 328 sec caus error fail stop compon standard server 1 org . apach . catalina . lifecycl except : fail stop compon standard server 1 org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) org . apach . catalina . startup . tomcat . stop ( tomcat . java : 336 ) org . apach . catalina . startup . tomcat base test . tear down ( tomcat base test . java : 163 ) caus : org . apach . catalina . lifecycl except : fail stop compon standard servic tomcat org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) org . apach . catalina . core . standard server . stop intern ( standard server . java : 766 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) caus : org . apach . catalina . lifecycl except : fail stop compon standard engin tomcat org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) org . apach . catalina . core . standard servic . stop intern ( standard servic . java : 501 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) caus : org . apach . catalina . lifecycl except : child contain fail dure stop org . apach . catalina . core . contain base . stop intern ( contain base . java : 981 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 232 ) = = = = = = = = = = = = = = = thought : 1 . we should catch throwabl those check leak method . should caus fail stop compon failur . 2 . method ar mani call tabl j . arrai member should evalu onli onc , so doe becom null unexpectedli . runtim except webapp class loader . check thread local map leak ( ) caus lifecycl except

public string string ( ) { string builder buf = new string builder ( org . apach . catalina . tribe . membership . member impl ) ; might better us . get class ( ) . get name ( ) cover static member ani other sub class might aris . . . tribe . membership . member impl . string ( ) might better us . get class ( ) . get name (

perform tune solut resolv too mani cascad jsp context wrapper issu

param destin member destin . length 1 i believ thi should : param destin member destin . length 0 incorrect param specif javadoc . . . tribe . group . group channel send method

file name inform detail error when compil java file gener from tag file

get password ( ) method data sourc realm doe log enough inform when encount sql error . catch block : } catch ( sqlexcept e ) { contain log . error ( sm . get string ( data sourc realm . get password . except , usernam ) ) ; } final { would realli help have some detail what sqlexcept . i am get thi intermitt , have resort subclass get password ( ) attempt figur out what go wrong . data sourc realm should provid more info sqlexcept

hi , i have servlet : annot properti inject target declar web . xml when i try request thi servlet i receiv : javax . name . name found except : name env entry1 bound thi context . unabl find env entry1 . org . apach . name . name context . lookup ( name context . java : 820 ) org . apach . name . name context . lookup ( name context . java : 154 ) org . apach . name . name context . lookup ( name context . java : 831 ) org . apach . name . name context . lookup ( name context . java : 168 ) org . apach . catalina . core . default instanc manag . lookup method resourc ( default instanc manag . java : 622 ) org . apach . catalina . core . default instanc manag . process annot ( default instanc manag . java : 466 ) org . apach . catalina . core . default instanc manag . new instanc ( default instanc manag . java : 157 ) org . apach . catalina . core . default instanc manag . new instanc ( default instanc manag . java : 138 ) org . apach . catalina . core . standard wrapper . load servlet ( standard wrapper . java : 1137 ) org . apach . catalina . core . standard wrapper . alloc ( standard wrapper . java : 858 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 136 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 123 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 472 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 171 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 99 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 407 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1004 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 589 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 310 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 680 ) problem when applic us inject target declar org . apach . catalina . core . default instanc manag . popul annot cach ( class , map string , string ) onli first setter method evalu rest ar skip . i would like propos patch test case . i m look forward your comment . regard violeta inject fail when part servlet properti us resourc other us inject target

hi , i have servlet field primit type . field annot resourc . public class my servlet extend http servlet { resourc ( map name = 1 ) privat int env entri ; protect void do get ( http servlet request req , http servlet respons resp ) throw servlet except , ioexcept { . . . } } when i request thi servlet i receiv follow except : sever : alloc except servlet my servlet javax . name . name except : cannot creat resourc instanc org . apach . name . factori . resourc env factori . get object instanc ( resourc env factori . java : 117 ) javax . name . spi . name manag . get object instanc ( name manag . java : 304 ) org . apach . name . name context . lookup ( name context . java : 843 ) org . apach . name . name context . lookup ( name context . java : 154 ) org . apach . name . name context . lookup ( name context . java : 831 ) org . apach . name . name context . lookup ( name context . java : 168 ) org . apach . catalina . core . default instanc manag . lookup field resourc ( default instanc manag . java : 581 ) org . apach . catalina . core . default instanc manag . process annot ( default instanc manag . java : 470 ) org . apach . catalina . core . default instanc manag . new instanc ( default instanc manag . java : 157 ) org . apach . catalina . core . default instanc manag . new instanc ( default instanc manag . java : 138 ) org . apach . catalina . core . standard wrapper . load servlet ( standard wrapper . java : 1137 ) org . apach . catalina . core . standard wrapper . alloc ( standard wrapper . java : 858 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 136 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 123 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 472 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 171 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 99 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 407 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1004 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 589 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 310 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 680 ) s becaus method below primit type ar convert correspond wrapper thi field interpret env entri resourc env ref . org . apach . catalina . startup . web annot set . add resourc ( context , resourc , string , string ) i m attach patch solv thi issu test case . i m look forward your comment . regard violeta field primit type , annot resourc recogn env entri

support requir disabl tl compress prevent against crime attack

bug fix 52953 introduc null pointer except realm base . java line 409 when user found jdbc

tag plugin manag . init ( ) throw npe when us ant jasper task

nio bio connector share ( most ) jsse base sslimplement , differ handl cipher ssl enabl protocol attribut . nio connector set configur valu both attribut directli sslengin , which fail immedi ani them ar unsupport . thi make creat portabl superset collect cipher imposs i . e . ibm jdk do support mani cipher suit name us jsse vice versa ( usual tl vs ssl prefix differ ) support option differ between java 6 7 etc . bio connector attempt filter specifi valu down those support ssl implement , ha issu well : none specifi cipher protocol ar support silent us default ssl implement , which can lead unexpectedli ( unwittingli ) insecur configur . i propos : modifi nio connector us same logic bio connector filter request cipher protocol support valu ( place oper sslutil interfac ) . modifi cipher protocol filter logic treat explicit list unsupport option set support cipher protocol warn when thi done ( also fail visibl error ssl connect ar attempt ) . nio bio connector handl unsupport ssl cipher ssl enabl protocol differ

i ve found thi interest mal function applic where i just copi map portion web . xml new creat servlet , forgot chang de uri . tomcat deploi applic without ani warn , when run applic onli last referenc servlet wa work ( like map first ha been overwritten last xml file ) . i made addit test us annot servlet , behavior have more than servlet same map caus random access anoth ( i cannot determin predict wai ) . order prevent break exist applic , i would like have just big warn log startup deploy applic have more than servlet map same url . exampl problem : exampl 1 : web . xml . . . servlet servlet name print dact servlet servlet name servlet class br . com . simfret v1 . web . print dact servlet servlet class servlet servlet servlet name cotacao report servlet servlet name servlet class br . com . simfret v1 . web . cotacao report servlet servlet class servlet servlet map servlet name print dact servlet servlet name url pattern secur relatorio action url pattern servlet map servlet map servlet name cotacao report servlet servlet name url pattern secur relatorio action url pattern servlet map . . . exampl 2 : annot java servlet file web servlet ( name = pdf report print , url pattern = { secur relatorio do report } ) public class pdf report print extend abstract base servlet { . . . web servlet ( name = print boleto servlet , url pattern = { secur relatorio do report } ) public class print boleto servlet extend http servlet { . . . have servlet same url should least caus warn

implement support post construct pre destroi element web . xml

1 . activ ssi tomcat restart tomcat 2 . creat ani html file comment like thi 3 . put thi html file webapp folder tomcat 4 . when you now go html file via tomcat , you get nullpoint except . ssiservlet . class other necessari ssi class cannot found nullpoint except after activ ssi load ani html file specif comment

tomcat websocket api now allow send ping frame server ( 7 . 0 . 33 ) , via ws outbound , never report receipt pong . see stream inbound data ( ) method . . . } els ( op code = = constant . opcod pong ) { op } intend us ping heartbeat messag , allow ping without inform server extens return pong leav out half util . i would suggest chang stream inbound fix . . . 1 ) data ( ) method . . . } els ( op code = = constant . opcod pong ) { pong ( frame . get pai load ( ) ) ; } 2 ) add method pong ( byte buffer buffer ) . . . protect void pong ( byte buffer buffer ) { op } . . . which implement mai now overrid handl pong receipt heartbeat logic . thi necessari data ( ) mark final , so s altern workaround . websocket stream inbound never report receipt pong

remot ip filter class , code publish new request attribut access log ( see below ) . 821 ( request attribut enabl ) { 822 request . set attribut ( access log . remot addr attribut , 823 request . get remot addr ( ) ) ; 824 request . set attribut ( access log . remot host attribut , 825 request . get remot host ( ) ) ; 826 request . set attribut ( access log . protocol attribut , 827 request . get protocol ( ) ) ; 828 request . set attribut ( access log . server port attribut , 829 integ . valu ( request . get server port ( ) ) ) ; 830 } problem sourc valu should come from x request , e . g . x request . get remot addr ( ) x request . get remot host ( ) , etc . written abov , remot ip filter simpli republish current valu , access log therefor doe displai correct valu . remot ip filter doe correctli set request attribut access log

mapper listen . lifecycl event ( . . ) : check state parent befor call regist wrapper (

request contain content includ bom my case content type : applic xml ; charset utf 16 content ha bom ( ff fe ) , when fetch util buffer reader from get reader ( ) first request servic ajp thread work correctli ( encod correctli , onli charact fetch ) , howev , ani subsequ request thread which includ bom ha bom deliv applic . appear via review tomcat code , recycl ( ) method b2cconvert simpli ensur socket s data ha been complet flush underli input stream doesn t get reset ( don t realli know wai do thi without re instanti ) ensur subsequ request bom consum . i prove thi test ad call reset ( ) within recycl ( ) method which re instanti underli input stream problem resolv itself . i ve temporarili resolv issu my applic code us request . get input stream ( ) us request . get charact encod ( ) encod content insid my applic . retriev content contain bom via request . get reader ( ) issu

how reproduc from insid context initi method servlet context listen instanc , call context . add filter ( null , new arbitrari filter ( path prefix ) ) . add map url pattern ( null , fals , path prefix ) ; what happen dec 12 , 2012 3 : 59 : 03 pm org . apach . catalina . core . standard context filter start sever : except start filter null java . lang . null pointer except org . apach . tomcat . util . model . util . object name valu need quot ( util . java : 26 ) org . apach . catalina . core . applic filter config . regist jmx ( applic filter config . java : 421 ) org . apach . catalina . core . applic filter config . init filter ( applic filter config . java : 282 ) org . apach . catalina . core . applic filter config . init ( applic filter config . java : 108 ) org . apach . catalina . core . standard context . filter start ( standard context . java : 4650 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5306 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 901 ) org . apach . catalina . core . contain base . add child ( contain base . java : 877 ) org . apach . catalina . core . standard host . add child ( standard host . java : 633 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 657 ) org . apach . catalina . startup . host config deploi descriptor . run ( host config . java : 1637 ) java . util . concurr . executor runnabl adapt . call ( executor . java : 471 ) java . util . concurr . futur task sync . inner run ( futur task . java : 334 ) java . util . concurr . futur task . run ( futur task . java : 166 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) dec 12 , 2012 3 : 59 : 03 pm org . apach . catalina . core . standard context start intern sever : error filter start dec 12 , 2012 3 : 59 : 03 pm org . apach . catalina . core . standard context start intern sever : context startup fail due previou error what should happen either null allow filter name , throw illeg argument except context . add filter ( . . . ) , allow filter name , handl null valu gracefulli util . object name valu need quot throw npe anonym filter

us absolut order element doe disabl servlet contain initi classpath scan discuss also issu 53619 . howev , doe seem requir have least web fragment name list . other word i would thi : absolut order turn off all web fragment sinc none ar name . workaround list web fragment even doesn t exist shouldn t necessari . empti absolut order should turn off all web fragment

npe map method el

jsp unload null pointer except when us . tag file

( i post thi mail list oct 28 , 2011 , didn t end up creat report until now . i have same error tomcat 7 . ) problem descript : i have except ( append below ) , i think would nice have more inform about what go . i had more context , would help me find caus my problem much more quickli . exampl , except indic what file resourc wa have problem wa , would speed up troubleshoot immens . how reproduc : jar file contain war file s web inf lib folder : chang manifest . mf file jar file . put line onli class path : . note space after period , which what caus error . dure load applic , except which i have append end thi messag show up . suggest improv : my suggest would modifi extens valid . valid applic ( . . . ) , around line 195 . thi locat actual know about what resourc . would nice ioexcept wa caught , inform about resourc wa ad except , probabl wrap except . becaus i have gone through overhead get version tomcat run from sourc , chang have been compil test , i think suggest rel straight forward . here ar suggest code chang : first code chang move definit resourc outsid try catch : locat manifest all bundl jar resourc resourc = null ; ad name enumer bind ne = null ; second code chang make exist declar resourc just assign : resourc = ( resourc ) obj ; modifi input stream = resourc . stream content ( ) ; manifest jmanifest = get manifest ( input stream ) ; third code chang : add catch claus re throw : } catch ( name except nex ) { jump out check thi applic becaus ha resourc } catch ( ioexcept ioex ) { ad throw new ioexcept ( valid problem resourc . string ( ) , ioex ) ; ad } final { problem resourc mai have proper string ( ) . i would suggest chang file dir context : 898 ( inner class = file resourc ) have string method , someth along line : public string string ( ) { ad return file = = null null : file . string ( ) ; ad } ad note : about thi , origin email thread , konstantin kolinko said : sure about file resourc . string ( ) , ad catch ioexcept look like doabl . final , here s except : 28 oct 2011 11 : 03 : 03 am org . apach . catalina . core . standard context start intern sever : error depend check java . io . ioexcept : invalid header field java . util . jar . attribut . read ( attribut . java : 410 ) java . util . jar . manifest . read ( manifest . java : 199 ) java . util . jar . jar input stream . init ( jar input stream . java : 83 ) java . util . jar . jar input stream . init ( jar input stream . java : 60 ) org . apach . catalina . util . extens valid . get manifest ( extens valid . java : 394 ) org . apach . catalina . util . extens valid . valid applic ( extens valid . java : 195 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5037 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 148 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1033 ) org . apach . catalina . core . standard host . start intern ( standard host . java : 774 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 148 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1033 ) org . apach . catalina . core . standard engin . start intern ( standard engin . java : 291 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 148 ) org . apach . catalina . core . standard servic . start intern ( standard servic . java : 443 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 148 ) org . apach . catalina . core . standard server . start intern ( standard server . java : 727 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 148 ) org . apach . catalina . startup . catalina . start ( catalina . java : 621 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 57 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 43 ) java . lang . reflect . method . invok ( method . java : 616 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 322 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 450 ) ( onli java . util . jar . attribut . read report which attribut had problem , we d realli busi . ) enhanc except report jar file error

except jmx remot lifecycl listen . destroi server

npe bodi content impl

npe data sourc . regist jmx ( ) although data sourc creat set jmx enabl ( fals )

found while debug version 7 . 0 . 29 i found our slow queri report jmx mbean wa deregist dure webapp shutdown . i track thi down npe . interceptor properti ar set ( done setup connect ) prior pool close callback . connect pool . close ( boolean ) pool close callback produc npe slow queri report jmx . { code } pool properti . interceptor definit proxi = get pool properti ( ) . get jdbc interceptor arrai ( ) ; ( int i = 0 ; i proxi . length ; i ) { try { proxi i . get interceptor class ( ) . new instanc ( ) . pool close ( thi ) ; } catch ( except x ) { log . debug ( unabl inform interceptor pool closur . , x ) ; } } . . . { code } npe slow queri report jmx null . contain kei { code } public object name get object name ( class clazz , string pool name ) throw malform object name except { . . . npe ( get properti ( ) . contain kei ( object name attribut ) ) { . . . { code } sound reason set properti ani time you need instanti interceptor . done connect pool . init ( pool configur ) { code } jdbc interceptor interceptor = proxi i . get interceptor class ( ) . new instanc ( ) ; interceptor . set properti ( proxi i . get properti ( ) ) ; interceptor . pool start ( thi ) ; { code } slow queri report jmx mbean deregistr failur due npe properti set dure pool close callback

error report valv invok non error respons too

jdbc connect pool run out connect when context reload = true enabl tomcat

javadoc org . apach . name . java . java urlcontext factori : context factori java : namespac . p b import note b : thi factori must associ java url prefix , which can done either : ul li ad java . name . factori . url . pkg = org . apach . catalina . util . name properti jndi properti file li li set environ variabl name context . url pkg prefix valu includ org . apach . catalina . util . name packag name . more detail about thi can found jndi document : { link javax . name . spi . name manag get urlcontext ( java . lang . string , java . util . hashtabl ) } . li ul author remi maucherat version id org . apach . catalina . util . name veri old packag name . correct name both tc6 tc7 org . apach . name . java urlcontext factori javadoc refer defunct packag name initi context properti

thi method call send error ( int , null ) intern . thu gener html page without messag . thi mention doc . could assum respons empti . could duplic first paragraph send error ( int , string ) method alter server default creat respons look like html format server error page ani specif messag , set content type text html , . . . further error page declar ha been made web applic correspond statu code pass , serv back . ( might need improv thi case , i am nativ speaker ) . moreov , i would add thi method effect same call send error ( int , null ) . plu add see send error ( int , string ) . though java doc seem verbatim copi oracl s servlet api , doe reveal thi inform explicitli . should i provid patch doc avail svn . apach . org improv http servlet respons send error ( int ) java doc descript

process java . io . reader out tagplugin

add displai perm gen memori pool usag statu page manag webapp

configur doe allow realm nest more than 2 level deep

http connector incorrectli throw except invalid modifi sinc header

minor enhanc http client test helper class

clearli shown org . apach . catalina . core . async context impl . dispatch ( servlet context , string ) overrid public void dispatch ( servlet context context , string path ) { ( log . debug enabl ( ) ) { log debug ( dispatch ) ; } check ( ) ; ( request . get attribut ( async request uri ) = = null ) { request . set attribut ( async request uri , request . get request uri ( ) request . get queri string ( ) ) ; request . set attribut ( async context path , request . get context path ( ) ) ; request . set attribut ( async servlet path , request . get servlet path ( ) ) ; request . set attribut ( async queri string , request . get queri string ( ) ) ; } . . . . } valu async request uri same request . get request uri ( ) . thei must equal each other defin servlet 3 . 0 , 9 . 7 . 2 dispatch request paramet . async path info miss . wrong javax . servlet . async . request uri inform javax . servlet . async . path info miss

servlet 3 . 0 spec violat async timeout process

ws outbound miss ping method

servlet 3 . 0 type env entri can ani type which ha public constructor take singl string ( charact ) argument . tomcat onli accept fix list type ( see name context listen from line 813 ) . thi legal web . xml accept tomcat : env entri env entri name locat env entri name env entri type java . io . file env entri type env entri valu var lib tomcat env entri valu env entri env entri reject legal type

spnego authent s stateless ness incompat state client

web fragment sort incorrectli detect circular refer

upgrad respons transfer encod : chunk invalid

perform tune solut page context impl . xml escap

2 cgiservlet s differ paramet pass shell environ

comet event . end event sent suspend socket disconnect when run tomcat nativ ( tcnativ 1 . dll ) window vista window server 2008 newer .

target class object . class , gener gener new string ( quot ) ; attribut valu tag handler . how about us quot directli same when target class object . class creat string instanc caus some overhead from memori alloc hash code recalu when us kei hash map . here detail code , param c target class which coerc given string param s string valu param attr name name attribut whose valu suppli param prop editor class properti editor given attribut param name attribut true given attribut name attribut ( , specifi us jsp : attribut standard action ) , fals otherwis privat string convert string ( class c , string s , string attr name , class prop editor class , boolean name attribut ) { string quot = s ; ( name attribut ) { quot = quot ( s ) ; } ( prop editor class = null ) { string class name = c . get canon name ( ) ; return ( class name ) org . apach . jasper . runtim . jsp runtim librari . get valu from bean info properti editor ( class name . class , attr name , quot , prop editor class . get canon name ( ) . class ) ; } els ( c = = string . class ) { return quot ; } els ( c = = boolean . class ) { return jsp util . coerc primit boolean ( s , name attribut ) ; } els ( c = = boolean . class ) { return jsp util . coerc boolean ( s , name attribut ) ; } els ( c = = byte . class ) { return jsp util . coerc primit byte ( s , name attribut ) ; } els ( c = = byte . class ) { return jsp util . coerc byte ( s , name attribut ) ; } els ( c = = char . class ) { return jsp util . coerc char ( s , name attribut ) ; } els ( c = = charact . class ) { return jsp util . coerc charact ( s , name attribut ) ; } els ( c = = doubl . class ) { return jsp util . coerc primit doubl ( s , name attribut ) ; } els ( c = = doubl . class ) { return jsp util . coerc doubl ( s , name attribut ) ; } els ( c = = float . class ) { return jsp util . coerc primit float ( s , name attribut ) ; } els ( c = = float . class ) { return jsp util . coerc float ( s , name attribut ) ; } els ( c = = int . class ) { return jsp util . coerc int ( s , name attribut ) ; } els ( c = = integ . class ) { return jsp util . coerc integ ( s , name attribut ) ; } els ( c = = short . class ) { return jsp util . coerc primit short ( s , name attribut ) ; } els ( c = = short . class ) { return jsp util . coerc short ( s , name attribut ) ; } els ( c = = long . class ) { return jsp util . coerc primit long ( s , name attribut ) ; } els ( c = = long . class ) { return jsp util . coerc long ( s , name attribut ) ; } els ( c = = object . class ) { return new string ( quot ) ; } els { string class name = c . get canon name ( ) ; return ( class name ) org . apach . jasper . runtim . jsp runtim librari . get valu from properti editor manag ( class name . class , attr name , quot ) ; } } new string instanc gener constant string gener . convert string

page context tag file gener java code when us code gener jstl tagplugin set

tribe stack us : tcp ping interceptor tcp failur detector messag dispatch interceptor static membership interceptor do work well static cluster . first side ( ie thread ) : call tcp failur detector . heartbeat ( ) call check member ( fals ) call perform basic check ( ) synchron ( membership ) perform basic check , miss static node : add miss member membership membership . member aliv ( m ) here second thread have some time work check member aliv ( m ) remov sinc doesn t exist second side ( ie anoth thread ) : some call channel . get member ( ) like what done abstract replic map thi call call tcp failur detector . get member ( ) thi could return wrong valu sinc can contain unavail node note : synchron membership isn t us tcp failur detector get member ( ) , get member ( ) , ha member ( ) , neither membership equival method ( mayb becaus s too heavi lock everi thread while tcp failur detector check node ar aliv ) . must issu abstract replic map sinc without tcp failur detector node could disapear while replic map try us . replic map us alwai channel . send option default where valu channel . send option us ack . so messag sent miss node fail except . personnali i overrid tcp failur detector . heartbeat ( ) avoid perform basic check ( ) i us static configur ( tcp ping interceptor call perform forc check ( ) ) . thi doesn t fix replic map issu . better fix could avoid ad miss member membership list : add method like member aliv ( member impl ) membership without side effect ( add member ) tcp failur detector . perform basic check ( ) : check thi new method befor ad node thi doesn t fix abstract replic map issu which work alwai acknoledg from other node . same code tomcat 6 . best regard f . arnoud replic map don t like tcp failur detector static configur

connector jk java org apach jk common handler request . java coyot . request s scheme mb assign 2 place . 1st place : 400 boolean ssl = msg . get byte ( ) = 0 ; 401 ( ssl ) { 402 xxx req . set secur ( true ) ; 403 req . scheme ( ) . set string ( http ) ; 404 } 2nd place : 518 case ajp constant . sc ssl cert : 519 req . scheme ( ) . set string ( http ) ; similar assign sc ssl cipher sc ssl session case below . seem thei do make sens becaus packet s 8 bit field design tell whether s ssl . so 1st place enough . ad 2nd place mai pose potenti bug packet 8 bit ssl field 0 suffix sc ssl kei valu pair can later incorrect trigger wrong redirect messag point http locat . simpl correct honor 8 bit ssl field packet delet 3 line 2nd place assign http . even though chanc spuriou packet low , s best we can have threat free , semant correct tomcat code . same line code remain 6 . 0 7 . 0 . mayb i misunderstand code , which case pleas kindli point out . thank . suggest code improv ( avoid potenti bug )

dure load test tomcat 7 . 0 . 30 , we occasion see npe from access log valv . some request ar execut part load test call http session . invalid . i mention thi becaus code question appear suscept multithread manipul session . i think fix should simpl check null return valu request . get session intern . cours , our access log pattern includ log session id . java . lang . null pointer except org . apach . catalina . valv . access log valv session id element . add element ( access log valv . java : 1733 ) org . apach . catalina . valv . access log valv . log ( access log valv . java : 955 ) org . apach . catalina . core . access log adapt . log ( access log adapt . java : 51 ) org . apach . catalina . core . standard engin . log access ( standard engin . java : 332 ) org . apach . catalina . core . contain base . log access ( contain base . java : 1270 ) org . apach . catalina . core . contain base . log access ( contain base . java : 1270 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 441 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1002 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 585 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 312 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) exist code conveni : protect static class session id element implement access log element { overrid public void add element ( string builder buf , date date , request request , respons respons , long time ) { ( request = null ) { ( request . get session ( fals ) = null ) { buf . append ( request . get session intern ( fals ) line 1733 . get id intern ( ) ) ; } els { buf . append ( ) ; } } els { buf . append ( ) ; } } } possibl fix : . . . ( request . get session ( fals ) = null ) { session intern session = request . get session intern ( fals ) ; ( intern session = null ) { buf . append ( intern session . get id intern ( ) ) ; } els { buf . append ( ) ; } } els { buf . append ( ) ; } npe access log valv

comment end tag preced directli dash caus jsp fail compil

default servlet directori list alias directori do seem work

implement servlet contain initi can t add map becaus default servlet load first , first report 51278 : public final class sampl servlet contain initi implement servlet contain initi { public void startup ( final set class >> c , final servlet context ctx ) throw servlet except { final xml web applic context app ctx = new xml web applic context ( ) ; app ctx . set config locat ( web inf dispatch servlet servlet . xml ) ; final servlet registr . dynam dispatch = ctx . add servlet ( dispatch servlet , new dispatch servlet ( app ctx ) ) ; dispatch . set load startup ( 1 ) ; final set string conflict set = dispatch . add map ( ) ; ( final string conflict : conflict set ) out . println ( conflict ) ; print } } test case follow attach . unabl overrid default servlet when us tomcat embed mode

under parallel deploy , when older version applic ha zero session , shut down automat releas tomcat jvm resourc . christoph schultz suggest approach might possibl ( tomcat user list ) : 1 . modifi parallel deploy code regist mbean notif listen filter us event ( expir session notif outgo webapp ) . 2 . when listen receiv notif , check current state ( e . g . session count = 0 ; , i suppos you could make thi part your filter step 1 ) . session count = 0 , start new thread stop outgo webapp de regist listen . . 1 . instal session event listen count down session ( you ll have get count from jmx , i suppos ) until thei equal 0 , start new thread . . . etc . . 1 . instal timer thread poll interv ( 1 minut ) see all session ar dead start thread . . . etc . first idea seem cleanest , though tomcat might actual fire mbean event thing like session count chang . automat shut down old version parallel deploy

perform tune solut jsp reader

201 privat void close outbound connect ( ws frame frame ) throw ioexcept { 202 try { 203 get ws outbound ( ) . close ( frame ) ; 204 } final { 205 do close ( constant . opcod close ) ; 206 } 207 } line 205 us close opcod instead valid statu ( constant . statu ) . sure exact context thi call seem onli call when last frame from client wa close frame , thu constant . statu normal mai order . , frame s opcod could inspect map appropri statu ( normal , shutdown , etc . . . ) . thank , michael stream inbound . close outbound connect ( ws frame ) close opcod instead statu

nondeterminist behaviour secur constraint

infint loop caus file dir context cdi weld project when us eclips s server modul without publish

first column tabl list web applic tomcat manag webapp contain link those applic , e . g . href = exampl exampl when link click browser navig exampl , result 302 redirect exampl . would better chang link point directli exampl . href = exampl exampl i am chang link address onli , text . becaus path web applic displai column ( us manag command elsewher ) doe have addit . chang webapp link manag point appnam instead appnam

apr 22 , 2007 11 : 53 : 32 am org . apach . coyot . http11 . http11processor process sever : error finish request java . lang . arrai index out bound except : 28 org . apach . coyot . http11 . filter . chunk input filter . pars chunk header ( chunk input filter . java : 256 ) org . apach . coyot . http11 . filter . chunk input filter . do read ( chunk input filter . java : 129 ) org . apach . coyot . http11 . filter . chunk input filter . end ( chunk input filter . java : 179 ) org . apach . coyot . http11 . intern input buffer . end request ( intern input buffer . java : 368 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 894 ) org . apach . coyot . http11 . http11base protocol http11connect handler . process connect ( http11base protocol . java : 664 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 595 ) arrai index out bound except pars chunk header

static resourc jsp file under web inf lib . jar meta inf resourc ar found

class org . apach . catalina . core . applic filter registr , method add map servlet name add map url pattern have invert logic how regist filter context . paramet match after pass true , filter place context us add filter map befor method . ( match after ) { context . add filter map befor ( filter map ) ; } els { context . add filter map ( filter map ) ; } logic should ultim ( both method ) : ( match after ) { context . add filter map befor ( filter map ) ; } els { context . add filter map ( filter map ) ; } ( match after ) { context . add filter map ( filter map ) ; } els { context . add filter map befor ( filter map ) ; } svn rev trunk 1375614 dynam filter registr map logic invert

some gzip respons result java . io . ioexcept : corrupt gzip trailer dure gunzip .

i have jar which contain web fragment tld . when start server i get messag : org . apach . jasper . compil . tld locat cach tld scan jar info : least jar wa scan tld yet contain tld . enabl debug log thi logger complet list jar were scan tld were found them . skip unneed jar dure scan can improv startup time jsp compil time . so far so good . when ad tomcat . util . scan . default jar scanner . jar skip properti web fragment won t scan either . log messag should onli print when tld web fragment could found jar . mislead log output when jar skip cointain web fragment

i hit tomcat 20 differ url 2 second , test some function , wait 3 minut , do again i alwai get thi except i get ( intermit ) connect interrupt messag browser . here s full trace : aug 10 , 2012 6 : 33 : 14 pm org . apach . catalina . connector . coyot adapt event sever : null aug 10 , 2012 6 : 33 : 14 pm org . apach . catalina . connector . coyot adapt event java . lang . null pointer except org . apach . coyot . http11 . http11apr processor . action intern ( http11apr processor . java : 277 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 846 ) org . apach . coyot . respons . action ( respons . java : 172 ) org . apach . catalina . connector . coyot adapt . event ( coyot adapt . java : 229 ) org . apach . coyot . http11 . http11apr processor . event ( http11apr processor . java : 133 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 581 ) org . apach . tomcat . util . net . apr endpoint socket processor . run ( apr endpoint . java : 1770 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) aug 10 , 2012 6 : 33 : 14 pm org . apach . coyot . http11 . http11apr processor event sever : error process request java . lang . null pointer except org . apach . coyot . http11 . http11apr processor . action intern ( http11apr processor . java : 277 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 846 ) org . apach . coyot . request . action ( request . java : 346 ) org . apach . catalina . connector . request . get remot addr ( request . java : 1281 ) org . apach . catalina . connector . request . get remot host ( request . java : 1296 ) org . apach . catalina . valv . access log valv host element . add element ( access log valv . java : 1327 ) org . apach . catalina . valv . access log valv . log ( access log valv . java : 953 ) org . apach . catalina . core . access log adapt . log ( access log adapt . java : 51 ) org . apach . catalina . core . contain base . log access ( contain base . java : 1263 ) org . apach . catalina . core . contain base . log access ( contain base . java : 1270 ) org . apach . catalina . connector . coyot adapt . event ( coyot adapt . java : 250 ) org . apach . coyot . http11 . http11apr processor . event ( http11apr processor . java : 133 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 581 ) org . apach . tomcat . util . net . apr endpoint socket processor . run ( apr endpoint . java : 1770 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) addit inform : hp proliant dl360 two 3ghz processor cent os 6 . 3 app run websocket under blead edg atmospher grail 20 url come from chrome firefox , simulatn java . lang . null pointer except org . apach . coyot . http11 . http11apr processor . action intern ( http11apr processor . java : 277 )

onli last url pattern from jsp properti group process

now , jasper code , onli support jar url rel url , mai enough common web applic . while , possibl third parti us other protocol url , like file : protocol base url . so , jsp file alwai recompil each access target page . code ar locat compil . out date ( ) method . possibl provid more gener handler url jsp file alwai recompil us file base tld url

send redirect doesn t work after dispatch through async context

javadoc fix

class intern nio output buffer includ field : int total = 0 ; thi current defin line 227 , which between javadoc method bodi which javadoc appli , i . e . privat synchron int write socket . thi invalid method javadoc . field us keep run total byte written method ; howev field actual referenc system . out . println statement comment out . field associ code shcould probabl delet . field kept , should privat , should probabl chang long , cours should move so doe invalid method javadoc . intern nio output buffer unus ( debug ) code

we have servlet defin servlet servlet name version info servlet servlet name jsp file web inf svnrevis . jsp jsp file servlet map servlet map servlet name version info servlet servlet name url pattern svnrevis url pattern servlet map work fine . we chang metadata complet true , from now we receiv info : mark servlet version info servlet unavail lip 20 , 2012 11 : 05 : 36 am org . apach . catalina . core . standard wrapper valv invok sever : alloc except servlet version info servlet javax . servlet . servlet except : servlet class ha been specifi servlet version info servlet org . apach . catalina . core . standard wrapper . load servlet ( standard wrapper . java : 1130 ) org . apach . catalina . core . standard wrapper . alloc ( standard wrapper . java : 857 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 136 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 123 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 168 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 98 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 407 ) org . apach . coyot . ajp . ajp nio processor . process ( ajp nio processor . java : 184 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 585 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) metadata complet = true servlet defin jsp work

jsp : forward action static resourc caus illeg state except when insid classic custom tag

bug virtual webapp featur . custom tag badli support . error org . apach . jasper . jasper except : absolut uri : http : java . sun . com jsp jstl core cannot resolv either web . xml jar file deploi thi applic

support ssl op cipher server prefer sslhonor cipher order

accord rfc6455 section 4 . 3 . handl subprotocol request correct . must check sec web socket protocol instead sec web socket protocol client web socket servlet class . wrong websocket s subprotocol implement

i ad data . set messag ( new xbyte buffer ( tcp ping data , fals ) ) ; tcp ping interceptor send ping messag function : protect void send ping messag ( member member ) { ( member = = null member . length = = 0 ) return ; channel data data = new channel data ( true ) ; gener uniqu id data . set address ( get local member ( fals ) ) ; data . set timestamp ( system . current time milli ( ) ) ; data . set option ( get option flag ( ) ) ; data . set messag ( new xbyte buffer ( tcp ping data , fals ) ) ; try { super . send messag ( member , data , null ) ; } catch ( channel except x ) { log . warn ( unabl send tcp ping . , x ) ; } } error also tomcat 6 regard fred messag set ping : tcp ping interceptor fail null pointer except channel data . get data packag length (

start ( int ) method initi failur detector ( resp . static member ) onli tcp failur detector ( resp . static membership interceptor ) wa found channel interceptor stack . without tcp failur detector ( resp . static membership interceptor ) , futur call send ping ( ) fail becaus failur detector ( resp . static member ) wasn t initi least new weak refer static membership interceptor ( null ) . fix : v1 ) initi weak refer contain : replac : weak refer tcp failur detector failur detector = null ; weak refer static membership interceptor static member = null ; : weak refer tcp failur detector failur detector = new weak refer tcp failur detector ( ) ; weak refer static membership interceptor static member = new weak refer static membership interceptor ( ) ; v2 ) check field befor dereferenc : send ping becom : protect void send ping ( ) { ( failur detector = null failur detector . get ( ) = null ) { we have refer failur detector piggi back dude failur detector . get ( ) . check member ( true ) ; } els { ( static onli static member = null static member . get ( ) = null ) { send ping messag ( static member . get ( ) . get member ( ) ) ; } els { send ping messag ( get member ( ) ) ; } } } affect also tomcat 6 regard fred arnoud null pointer except tcp ping interceptor

out memori while perform context config . web config

respons . normal ( char chunk cc ) introduc 7 . 0 . 28 introduc bug . see bug id 53062 url encod : . . . . resourc org . apach . wicket . markup . html . wicket event refer wicket event . js w : lm = 1340711670 which caus illeg argument except thi method java . lang . illeg argument except org . apach . catalina . connector . respons . normal ( respons . java : 1799 ) org . apach . catalina . connector . respons . absolut ( respons . java : 1732 ) org . apach . catalina . connector . respons . encod url ( respons . java : 1242 ) org . apach . catalina . connector . respons facad . encod url ( respons facad . java : 406 ) org . apach . wicket . protocol . http . web respons . encod url ( web respons . java : 149 ) org . apach . wicket . protocol . http . request . web request code strategi . encod ( web request code strategi . java : 387 ) run same applic tomcat 7 . 0 . 27 6 . 0 . 18 work without issu possibl bug respons . normal ( char chunk cc )

class : org apach catalina tribe group group channel . java line 692 org apach catalina tribe group interceptor non block coordin . java line 228 org apach catalina tribe group interceptor tcp ping interceptor . java line 173 org apach catalina tribe membership mcast servic impl . java line 542 org apach juli async file handler . java line 124 line 146 org apach tomcat util net apr endpoint . java line 640 org apach tomcat util net nio block selector . java line 112 line 177 org apach tomcat util thread thread pool executor . java line 187 affect 7 . 0 . 29 ( previou releas ) affect also tomcat 6 . call interrupt ( ) after interrupt except instead interrupt (

method connect pool . termin transact ( pool connect con ) us = = check valu boolean , viz : ( con . get pool properti ( ) . get default auto commit ( ) = = boolean . fals ) { thi 100 safe user set properti follow : string valu ; e . g . deriv from properti file . . . set default auto commit ( new boolean ( valu ) ) ; condit never true , even valu = fals . although better us boolean . valu ( valu ) , which would have same problem , code ought work regardless . . connect pool . termin transact unsaf = = check boolean

hi , properti rollback return commit return , which ar critic clean up connect after thei ar us return pool , doe work when default auto commit properti set when set true . code segment connect pool class ha thi , protect boolean termin transact ( pool connect con ) { try { ( con . get pool properti ( ) . get default auto commit ( ) = = boolean . fals ) { . . . . full logic wrap first statement , i see , correct . becaus , actual default auto commit valu when we don t set thi properti can either auto commit true fals , which depend databas driver . also , even when we have default set provid , user ha freedom chang auto commit flag either true fals begin when thei get connect from pool . so we should read pool properti thi place , just check current live connect s auto commit valu act accordingli . so i suppos fix should simpli remov outer statement . cheer , anjana . rollback return commit return doe work without default auto commit = fals

my configur : 2 node run tomcat 7 . 0 . 26 us custom session manag , which extend delta manag my start intern ( ) method first call super . start intern ( ) , perform few addit initi . i review code delta manag . start intern ( ) , call get all cluster session ( ) which turn call wait send all session ( ) , which requir either get state transfer ( ) return true , timeout . so thi , i should abl trust second node start , initi sync up all session data from first node ha complet prior start intern ( ) method exit ( thu prior my initi ) . thi , howev , case i can confirm thi repeatedli log valu find session ( ) . length dure my inial , see number go up appear race condit between process messag contain actual session data transfer complet messag . after trace thi through littl further , i see state transfer set true handl all session transfercomplet ( ) callback method . callback call prior session data itself even receiv here debug log output ( slightli scrub ) which show thi out order messag : jul 5 , 2012 4 : 20 : 41 pm org . apach . catalina . ha . session . delta manag get all cluster session info : manag wwwtest , request session state from org . apach . catalina . tribe . membership . member impl . . . . thi oper timeout session state ha been receiv within 60 second . jul 5 , 2012 4 : 20 : 41 pm org . apach . catalina . ha . session . delta manag messag receiv fine : manag wwwtest : receiv session messag type = ( session state transfer ) from org . apach . catalina . tribe . membership . member impl . . . jul 5 , 2012 4 : 20 : 41 pm org . apach . catalina . ha . session . delta manag handl all session transfercomplet fine : manag wwwtest receiv from node b 6789b939 : 4 , 000 session state transfer . jul 5 , 2012 4 : 20 : 41 pm org . apach . catalina . ha . session . delta manag messag receiv fine : manag wwwtest : receiv session messag type = ( all session data ) from org . apach . catalina . tribe . membership . member impl . . . jul 5 , 2012 4 : 20 : 41 pm org . apach . catalina . ha . session . delta manag handl all session data fine : manag wwwtest : receiv session state data race condit out order oper session replic node startup

atom violat bug becaus misus concurr collect

hi , dev tomcat list i describ topic byte serv pdf default servlet issu i had tomcat serv pdf . analys answer i could find matter wa relat case file extens . todai tomcat case sensit mime type extens . so solut me wa enter two mime specif web . xml file . pdf anoth pdf . thi wai i would like ask request enhanc make tomcat abl , due setup configur file , consid case mime type extens . regard , vitor rfe mime type extens case sensit

new servlet 3 . 0 global error page error page locat error . jsp locat error page handl tomcat 7 . glassfish 3 exampl , work fine . global error page handl

7 . 0 . 28 longer accept our jsp filenam

deploi two differ web applic onto tomcat . each web applic ha resourc : us us tomcat jdbc connect pool ha ident name other resourc name = jdbc collis factori = org . apach . tomcat . jdbc . pool . data sourc factori . . . when start server you get non fatal error log instanc alreadi exist except . both applic appear still work ok error org . apach . tomcat . jdbc . pool . data sourc unabl regist jdbc pool jmx javax . manag . instanc alreadi exist except : tomcat . jdbc : name = jdbc soscvuk , context = , type = connect pool , host = localhost , class = org . apach . tomcat . jdbc . pool . data sourc com . sun . jmx . mbeanserv . repositori . add mbean ( repositori . java : 453 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . intern add object ( default mbean server interceptor . java : 1484 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist dynam mbean ( default mbean server interceptor . java : 963 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist object ( default mbean server interceptor . java : 917 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist mbean ( default mbean server interceptor . java : 312 ) na : 1 . 6 . 0 32 com . sun . jmx . mbeanserv . jmx mbean server . regist mbean ( jmx mbean server . java : 482 ) na : 1 . 6 . 0 32 org . apach . tomcat . jdbc . pool . data sourc . regist jmx ( data sourc . java : 135 ) tomcat jdbc . jar : na org . apach . tomcat . jdbc . pool . data sourc . pre regist ( data sourc . java : 102 ) tomcat jdbc . jar : na org . apach . tomcat . util . model . base model mbean . pre regist ( base model mbean . java : 1132 ) tomcat coyot . jar : 7 . 0 . 27 com . sun . jmx . interceptor . default mbean server interceptor . pre regist invok ( default mbean server interceptor . java : 1010 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist dynam mbean ( default mbean server interceptor . java : 938 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist object ( default mbean server interceptor . java : 917 ) na : 1 . 6 . 0 32 com . sun . jmx . interceptor . default mbean server interceptor . regist mbean ( default mbean server interceptor . java : 312 ) na : 1 . 6 . 0 32 com . sun . jmx . mbeanserv . jmx mbean server . regist mbean ( jmx mbean server . java : 482 ) na : 1 . 6 . 0 32 org . apach . tomcat . util . model . registri . regist compon ( registri . java : 742 ) tomcat coyot . jar : 7 . 0 . 27 org . apach . catalina . core . name context listen . add resourc ( name context listen . java : 1062 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . name context listen . creat name context ( name context listen . java : 671 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . name context listen . lifecycl event ( name context listen . java : 270 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 90 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . standard context . start intern ( standard context . java : 5161 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . contain base . add child intern ( contain base . java : 895 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . contain base . add child ( contain base . java : 871 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . core . standard host . add child ( standard host . java : 615 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 649 ) catalina . jar : 7 . 0 . 27 org . apach . catalina . startup . host config deploi descriptor . run ( host config . java : 1585 ) catalina . jar : 7 . 0 . 27 java . util . concurr . executor runnabl adapt . call ( executor . java : 441 ) na : 1 . 6 . 0 32 java . util . concurr . futur task sync . inner run ( futur task . java : 303 ) na : 1 . 6 . 0 32 java . util . concurr . futur task . run ( futur task . java : 138 ) na : 1 . 6 . 0 32 java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) na : 1 . 6 . 0 32 java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) na : 1 . 6 . 0 32 java . lang . thread . run ( thread . java : 662 ) na : 1 . 6 . 0 32 two datasourc same name differ web applic result javax . manag . instanc alreadi exist except

map name read when resourc , when web . xml

us error handl when too mani activ session except happen jsp

tomcat jdbc pool version test : 7 . 0 . 27 7 . 0 . 28 more inquiri . let me prefac sai we have recent adopt thi pool ar veri pleas so far . current , jmx manag resourc like connect pool slow queri report jmx ar regist under same domain ( i . e . tomcat . jdbc ) . some user mai want emploi altern object name strategi . data sourc creat object name rel easi chang connect pool object name ( i . e . subclass ) . howev , slow queri report jmx , due static get object name method , requir overrid addit method which less desir . appear connect pool ha constant pool jmx type prefix . slow queri report jmx appear us thi data sourc doe ani reason slow queri report jmx get object name method static what about regist object name strategi pool variou compon would us , facilit consist thi would mitig need overrid just alter object name . refer : spring mbean export object name strategi interfac . thank . support consist jmx object name strategi across manag resourc

jvm crash startup tc nativ version too old

bean elresolv s inner class bean properti ( line : 264 ) ha two method ( write , read ) throw properti found except . current implement ar wrong : throw new properti found except ( messag ( ctx , properti writabl , new object { type . get name ( ) , descriptor . get name ( ) } ) ) ; should us owner . get name ( ) instead type . get name ( ) becaus assembl messag : properti descriptor . get name ( ) readabl type type . get name ( ) here descriptor . get name ( ) mean properti name , type . get name ( ) mean properti type s name owner . get name ( ) mean properti owner bean s type name . cours we develop would prefer receiv messag tell us which bean type doesn t contain properti becaus thi properti found except . bean elresolv s inner class bean properti throw incorrect messag while properti found

hi , scenario follow : i have run tomcat 7 . 0 . 28 i deploi applic root context deploy hang forev . when take tread dump , follow suspici : localhost start stop 2 daemon prio = 6 tid = 0x0000000006607800 nid = 0x2560 wait condit 0x0000000009ebf000 java . lang . thread . state : wait ( park ) sun . misc . unsaf . park ( nativ method ) park wait 0x00000007d80f0108 ( java . util . concurr . lock . reentrant read write lock nonfair sync ) java . util . concurr . lock . lock support . park ( lock support . java : 158 ) java . util . concurr . lock . abstract queu synchron . park check interrupt ( abstract queu synchron . java : 811 ) java . util . concurr . lock . abstract queu synchron . acquir queu ( abstract queu synchron . java : 842 ) java . util . concurr . lock . abstract queu synchron . acquir ( abstract queu synchron . java : 1178 ) java . util . concurr . lock . reentrant read write lock write lock . lock ( reentrant read write lock . java : 807 ) org . apach . catalina . core . contain base . remov contain listen ( contain base . java : 1071 ) org . apach . catalina . core . standard engin access log listen . uninstal ( standard engin . java : 463 ) org . apach . catalina . core . standard engin access log listen . contain event ( standard engin . java : 505 ) org . apach . catalina . core . contain base . fire contain event ( contain base . java : 1431 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 907 ) org . apach . catalina . core . contain base . add child ( contain base . java : 875 ) org . apach . catalina . core . standard host . add child ( standard host . java : 618 ) org . apach . catalina . startup . host config . deploi directori ( host config . java : 1100 ) org . apach . catalina . startup . host config deploi directori . run ( host config . java : 1618 ) java . util . concurr . executor runnabl adapt . call ( executor . java : 441 ) java . util . concurr . futur task sync . inner run ( futur task . java : 303 ) java . util . concurr . futur task . run ( futur task . java : 138 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 662 ) you can see read lock acquir org . apach . catalina . core . contain base . fire contain event ( contain base . java : 1425 ) everi listen invok process contain event access log listen invok org . apach . catalina . core . standard engin access log listen . uninstal ( standard engin . java : 463 ) latter caus call write lock org . apach . catalina . core . contain base . remov contain listen ( contain base . java : 1071 ) unfortun reentrant read write lock state upgrad from read write lock possibl reentranc also allow downgrad from write lock read lock , acquir write lock , read lock releas write lock . howev , upgrad from read lock write lock possibl . regard violeta georgieva deploy applic root context hang forev

found against trunk jun 18 , 2012 sever : java . lang . stack overflow error org . apach . catalina . core . standard context valv . event ( standard context valv . java : 128 ) org . apach . catalina . valv . valv base . event ( valv base . java : 204 ) org . apach . catalina . core . standard host valv . event ( standard host valv . java : 223 ) org . apach . catalina . valv . valv base . event ( valv base . java : 204 ) org . apach . catalina . valv . valv base . event ( valv base . java : 204 ) org . apach . catalina . core . standard engin valv . event ( standard engin valv . java : 110 ) org . apach . catalina . connector . coyot adapt . event ( coyot adapt . java : 209 ) org . apach . coyot . http11 . http11nio processor . event ( http11nio processor . java : 124 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 569 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1653 ) org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 730 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 1008 ) org . apach . tomcat . util . net . nio endpoint poller . add ( nio endpoint . java : 999 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . long poll ( http11nio protocol . java : 277 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 596 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 223 ) stack overflow connector

allow broken android http digest support

when us servlet contain initi handl type annot ani class specifi handl type annot ar avail due miss jar file catalina crash java . lang . arrai store except : sun . reflect . annot . type present except proxi . caus : java . lang . arrai store except : sun . reflect . annot . type present except proxi sun . reflect . annot . annot parser . pars class arrai ( annot parser . java : 653 ) sun . reflect . annot . annot parser . pars arrai ( annot parser . java : 460 ) sun . reflect . annot . annot parser . pars member valu ( annot parser . java : 286 ) sun . reflect . annot . annot parser . pars annot ( annot parser . java : 222 ) sun . reflect . annot . annot parser . pars annotations2 ( annot parser . java : 69 ) sun . reflect . annot . annot parser . pars annot ( annot parser . java : 52 ) java . lang . class . init annot necessari ( class . java : 3070 ) java . lang . class . get annot ( class . java : 3029 ) org . apach . catalina . startup . context config . process servlet contain initi ( context config . java : 1546 ) org . apach . catalina . startup . context config . web config ( context config . java : 1222 ) org . apach . catalina . startup . context config . configur start ( context config . java : 855 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 345 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 90 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5161 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) . . . 7 more line where except thrown : handl type ht = sci . get class ( ) . get annot ( handl type . class ) ; servlet contain initi crash catalina dependci present .

incorrect tag xml respons when call manag statu xml = true

add thread factori implement executor servic us deploi applic

data sourc factori doe support commit return properti . data sourc factori . all properti data sourc factori . pars pool properti ( ) omit commit return properti . data sourc factori doe support commit return properti

allow whitespac around delimit context alias readabl

dure con . connect ( ) ; call method protect pool connect borrow connect ( long now , pool connect con , string usernam , string password ) connect pool . java count down size pool . thi mean , connect failur happen here , pool size remain same . thi mean size show pool full , realiti pool empti databas failur mai caus pool hang

ant jasper task fail run when us xml namespac ; output ; error

allow custom error map when manag s max activ session exceed

s possibl specifi invoc order web filter , user ar forc explicitli specifi filter map web . xml . thi work combin web filter ( filter name ) glassfish jboss follow : web filter ( filter name = filter1 ) public class filter1 implement filter { } web filter ( filter name = filter2 ) public class filter2 implement filter { } filter map filter name filter1 filter name url pattern url1 url pattern filter map filter map filter name filter2 filter name url pattern url2 url pattern filter map howev fail tomcat 7 . 0 . 27 follow confus except ( url pattern been set ) caus : java . lang . illeg argument except : filter map must specifi either url pattern servlet name org . apach . catalina . core . standard context . valid filter map ( standard context . java : 3009 ) org . apach . catalina . core . standard context . add filter map ( standard context . java : 2968 ) org . apach . catalina . deploi . web xml . configur context ( web xml . java : 1207 ) org . apach . catalina . startup . context config . web config ( context config . java : 1294 ) org . apach . catalina . startup . context config . configur start ( context config . java : 855 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 345 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 90 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5161 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 150 ) . . . 7 more filter map doesn t find web filter ( filter name )

i m try do jndi lookup insid open method my stream inbound class , give me except below . code work i move my jnp jar server lib instead webapp lib . code also work fine from anywher els , like do get method . error http bio 8080 exec 3 test javax . name . initi context except : cannot instanti class : org . jnp . interfac . name context factori root except java . lang . class found except : org . jnp . interfac . name context factori javax . name . spi . name manag . get initi context ( name manag . java : 657 ) javax . name . initi context . get default init ctx ( initi context . java : 288 ) javax . name . initi context . init ( initi context . java : 223 ) javax . name . initi context . init ( initi context . java : 197 ) test test stream inbound . open ( test . java : 103 ) org . apach . catalina . websocket . stream inbound . upgrad complet ( stream inbound . java : 180 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 579 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 307 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 662 ) class found except when us web socket servlet

new test case basic authent

illeg state except when try render jsp after start async

when us embed tomcat , servlet init method call twice contain . thi ha been seen apach direct memori unit test . i have check normal tomcat launch tomcat maven plugin ( mvn tomcat7 : run ) thi case , init method correctli call onc . servlet init method call twice embed tomcat

web app configur fail when secur role ref doe contain role link

e . g . when context stop throw lifecycl except , main thread stop , start stop thread host engin remain while . becaus , start stop thread demon thread . result , even main thread stop , acceptor thread 8080 8009 stop . keep aliv time 10 second set up now . = = = start stop executor = new thread pool executor ( get start stop thread intern ( ) , get start stop thread intern ( ) , 10 , time unit . second , start stop queue ) ; = = = therefor , order avoid bind except , wait 10 second requir . i think i need make start stop thread demon thread . best regard . start immedi after tomcat stop fail , bind except throw .

illeg state except zip file close resourc from webfrag jar jre memori leak prevent listen remov

patch don t do chunk connect : close

odd decapit when infer java bean properti from setter name inject target

default instanc manag popul annot cach incomplet check us when valid setter method

webapp class loader caus java . lang . out memori error find resourc intern (

servlet superclass inject target ar ignor

default connect timeout valu set 20000 caus issu web socket connect java . net . socket timeout except : read time out java . net . socket input stream . socket read0 ( nativ method ) java . net . socket input stream . read ( socket input stream . java : 129 ) org . apach . coyot . http11 . upgrad . upgrad bio processor . read ( upgrad bio processor . java : 75 ) org . apach . catalina . websocket . ws frame . next frame ( ws frame . java : 213 ) org . apach . catalina . websocket . ws input stream . next frame ( ws input stream . java : 68 ) org . apach . catalina . websocket . stream inbound . data ( stream inbound . java : 143 ) org . apach . coyot . http11 . upgrad . upgrad processor . upgrad dispatch ( upgrad processor . java : 83 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 563 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 307 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 680 ) increas valu delai issu ( timeout should occur ) websocket java . net . socket timeout except : read time caus server . xml connect timeout

common function connect pool support purg pool all current connect get all fresh connect . oracl ucp webspher pool ar two exampl . would great thi pool support oper well . would us oper were expos through jmx too . support purg connect pool

web socket implement issu wrap request

inconsist document regard connector s max connect properti

backup manag doe replic session access time .

when tcnativ start , emit inform like thi catalina . out : pr 10 , 2012 4 : 54 : 55 pm org . apach . catalina . core . apr lifecycl listen init info : load apr base apach tomcat nativ librari 1 . 1 . 23 . apr 10 , 2012 4 : 54 : 55 pm org . apach . catalina . core . apr lifecycl listen init info : apr capabl : ipv6 true , sendfil true , accept filter fals , random true . would nice apr version us could also displai well tcnativ version . mayb open ssl version , too . add apr version number tcnativ version info log messag

reconfigur pool fly us jmx

perform issu express factori . new instanc (

behaviour resourc bundl elresolv

name found except thrown when field method annot resourc annot

upgrad maven plugin 7 . 0 . 26 , goal which run tomcat conf dir ( emb version ) gener follow npe log : org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 236 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 141 ) org . apach . catalina . startup . catalina . start ( catalina . java : 645 ) org . apach . tomcat . maven . plugin . tomcat7 . run . abstract run mojo . start contain ( abstract run mojo . java : 679 ) org . apach . tomcat . maven . plugin . tomcat7 . run . abstract run mojo . execut ( abstract run mojo . java : 365 ) org . apach . maven . plugin . default build plugin manag . execut mojo ( default build plugin manag . java : 101 ) org . apach . maven . lifecycl . intern . mojo executor . execut ( mojo executor . java : 209 ) org . apach . maven . lifecycl . intern . mojo executor . execut ( mojo executor . java : 153 ) org . apach . maven . lifecycl . intern . mojo executor . execut ( mojo executor . java : 145 ) org . apach . maven . lifecycl . intern . lifecycl modul builder . build project ( lifecycl modul builder . java : 84 ) org . apach . maven . lifecycl . intern . lifecycl modul builder . build project ( lifecycl modul builder . java : 59 ) org . apach . maven . lifecycl . intern . lifecycl starter . singl thread build ( lifecycl starter . java : 183 ) org . apach . maven . lifecycl . intern . lifecycl starter . execut ( lifecycl starter . java : 161 ) org . apach . maven . default maven . do execut ( default maven . java : 320 ) org . apach . maven . default maven . execut ( default maven . java : 156 ) org . apach . maven . cli . maven cli . execut ( maven cli . java : 544 ) org . apach . maven . cli . maven cli . do main ( maven cli . java : 197 ) org . apach . maven . cli . maven cli . main ( maven cli . java : 141 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . codehau . plexu . classworld . launcher . launcher . launch enhanc ( launcher . java : 290 ) org . codehau . plexu . classworld . launcher . launcher . launch ( launcher . java : 230 ) org . codehau . plexu . classworld . launcher . launcher . main exit code ( launcher . java : 409 ) org . codehau . plexu . classworld . launcher . launcher . main ( launcher . java : 352 ) npe 7 . 0 . 26

thi code snippet start line 6 . 15 connect pool . java version 7 . 0 . 22 try { retriev exist connect con = idl . poll ( timetowait , time unit . millisecond ) ; } catch ( interrupt except ex ) { thread . interrupt ( ) ; clear flag , bail out sqlexcept sx = new sqlexcept ( pool wait interrupt . ) ; sx . init caus ( ex ) ; throw sx ; } final { waitcount . decrement get ( ) ; } line mark clear flag , bail out wrong , becaus after wai call code find out thread ha been interrupt . correct behavior should thread . current thread ( ) . interrupt ( ) ; here excerpt from biran goetz s java concurr practic chapter 5 . 4 . start quotat librari code ar basic two choic : propag interrupt except . thi often most sensibl polici you can get awai just propag interrupt except your caller . thi could involv catch interrupt except , catch throw again after perform some brief activ specif cleanup . restor interrupt . sometim you cannot throw interrupt except , instanc when your code part runnabl . situat , you must catch interrupt except restor interrupt statu call interrupt current thread , so code higher up call stack can see interrupt wa issu . end quotat case borrow connect , 1 realli choic , run confin jdbc interfac . can definit restor interrupt statu thread . connect pool . borrow connect swallow interrupt state .

class cast except while remov valv

new unit test digest authent singl sign

code ( pool connect . java valid ( int valid action , string sql ) ) statement stmt = null ; try { stmt = connect . creat statement ( ) ; stmt . execut ( queri ) ; stmt . close ( ) ; thi . last valid = now ; return true ; } catch ( except ignor ) { ( log . debug enabl ( ) ) log . debug ( unabl valid object : , ignor ) ; ( stmt = null ) try { stmt . close ( ) ; } catch ( except ignore2 ) { noop } } return fals ; so case null invalid queri ( connect alwai invalid : seem normal : ) ) . without ani useful messag ( except you us debug : seem complic product env ) . so imho ad log . warn case null queri could useful . case invalid empti slq queri connect ar alwai invalid without useful inform

current , error get connect from pool , gener sqlexcept thrown . onli wai determin problem result connect pool exhaust catch sqlexcept pars messag ( i . e . look pool empti ex . get messag ( ) ) . would like see follow : 1 ) subclass sqlexcept thrown case empti pool 2 ) jmx notif sent case empti pool ( e . g . pool exhaust ) jmx notif except empti exhaust connect pool

slow queri report interceptor doe log anyth

we have sporad issu trigger 502 proxi error us nio connector behind nginx , caus drop connect end stream tomcat . tomcat log show : sever : error alloc socket processor java . lang . null pointer except org . apach . tomcat . util . net . nio endpoint . process socket ( nio endpoint . java : 721 ) org . apach . tomcat . util . net . nio endpoint poller . cancel kei ( nio endpoint . java : 1048 ) org . apach . tomcat . util . net . nio endpoint poller . timeout ( nio endpoint . java : 1392 ) org . apach . tomcat . util . net . nio endpoint poller . run ( nio endpoint . java : 1174 ) java . lang . thread . run ( thread . java : 662 ) look code process socket i see line nio endpoint ( 721 ) : attach . set comet notifi ( fals ) ; get reset upon next reg attach fetch line 720 : kei attach attach = ( kei attach ) socket . get attach ( fals ) ; look socket . get attach ( ) method i see thi method inde capabl return null , null check thi done ( although multipl other locat , so seem inconsist ) . npe process socket

incomplet fix resourc leak bug standard manag . java

problem descript tomcat memori leak detect ha follow issu most detect fix code ha been test onli sun jvm . lot reflect base code doe work ibm jdk . test tomcat7 . sourc test org apach catalina loader do seem run successfulli ar incomplet all protect tomcat provid classload memori leak . some categori threadloc memori leak kei valu ar displai correctli warn messag ; particularli deal indirect refer threadloc org . apach . catalina . loader . webapp class loader . load thi child ( object ) incorrectli travers object classload hierarchi instead current ( thi ) classload hierarchi problem conclus after extens test ibm jdk , i have clean up sanit some reflect code stop executor , timer , thread etc ibm jdk ad new test detect threadloc leak thread leak better thread local leak report correct load thi child method addit expung stale entri method make code more resili certain leak detect scenario . variou miscellan fix tomcat memori leak detect code

develop captur jsp fragment themselv call invok , jsp context . class attribut enclos page context s elcontext set gener jsp fragment subclass , reset origin valu afterward . therefor after invok jsp context ani el express search wrong jsp context attribut valu . org . apach . jasper . compil . gener respons creat jsp fragment subclass repres compil fragment . gener postambl ( ) method emit gener code set jsp context attribut elcontext : out . printil ( thi . jsp context . get elcontext ( ) . put context ( javax . servlet . jsp . jsp context . class , thi . jsp context ) ; ) ; howev doesn t later put back origin valu . you ar us jsp : invok tag invok fragment ( which undoubtedli what most peopl ar do ) code gener visit ( node . invok action n ) gener explicitli restor el context : out . printil ( jsp context . get elcontext ( ) . put context ( javax . servlet . jsp . jsp context . class , get jsp context ( ) ) ; ) ; howev you call invok ( writer ) jsp fragment yourself you don t get tidi up code . i suggest resolut have jsp fragment . invok method tidi up after itself . put chang jsp context . class attribut so should also re put . shouldn t ani need restor el context gener jsp : invok code . i have test thi solut successfulli . gener s jsp fragment . invok implement doe reset elcontext jsp context . class

improv client certif authent

incomplet fix resourc leak bug webapp class loader . java

incomplet error messag when lookup resourc bound name

org . apach . jasper . jsp c execut ( ) method , uri root null , scan all jsp file under uri root , check uri root directori . should more desir check uri root directori first scan . here ar my suggest . ( uri root = = null ) { throw new jasper except ( local . get messag ( jsp . error . jspc . uriroot ) ) ; } file uri root f = new file ( uri root ) ; ( uri root f . exist ( ) uri root f . directori ( ) ) { throw new jasper except ( local . get messag ( jsp . error . jspc . uriroot dir ) ) ; } ( context = = null ) { init servlet context ( ) ; } explicit page , we ll process all . jsp webapp ( page . size ( ) = = 0 ) { scan file ( uri root f ) ; } jsp c : check uri root option valid

thi ken cheung , comput scienc m . phil . student . i observ some code clone tomcat found inconsist code : tomcat trunk java org apach tomcat util net nio block selector . java 103 try { 104 ( att . get write latch ( ) = = null att . get write latch ( ) . get count ( ) = = 0 ) att . start write latch ( 1 ) ; 105 poller . add ( att , select kei . op write , refer ) ; 106 att . await write latch ( write timeout , time unit . millisecond ) ; 107 } catch ( interrupt except ignor ) { 108 thread . interrupt ( ) ; 109 } 110 ( att . get write latch ( ) = null att . get write latch ( ) . get count ( ) 0 ) { 111 we got interrupt , we haven t receiv notif from poller . 112 keycount = 0 ; 113 } els { 114 latch countdown ha happen 115 keycount = 1 ; 116 att . reset write latch ( ) ; 117 } 118 119 ( write timeout 0 ( keycount = = 0 ) ) 120 timedout = ( system . current time milli ( ) time ) = write timeout ; tomcat trunk java org apach tomcat util net nio block selector . java 164 try { 165 ( att . get read latch ( ) = = null att . get read latch ( ) . get count ( ) = = 0 ) att . start read latch ( 1 ) ; 166 poller . add ( att , select kei . op read , refer ) ; 167 ( read timeout 0 ) { 168 att . await read latch ( long . max valu , time unit . millisecond ) ; 169 } els { 170 att . await read latch ( read timeout , time unit . millisecond ) ; 171 } 172 } catch ( interrupt except ignor ) { 173 thread . interrupt ( ) ; 174 } 175 ( att . get read latch ( ) = null att . get read latch ( ) . get count ( ) 0 ) { 176 we got interrupt , we haven t receiv notif from poller . 177 keycount = 0 ; 178 } els { 179 latch countdown ha happen 180 keycount = 1 ; 181 att . reset read latch ( ) ; 182 } 183 ( read timeout = 0 ( keycount = = 0 ) ) 184 timedout = ( system . current time milli ( ) time ) = read timeout ; quick descript inconsist two code snippet ar veri similar code , you see , first code doe check ( read timeout 0 ) while second code ha checker . we thought could potenti bug inconsist . hope thi help . potenti bug inconsist nio block selector . java

thi ken cheung , comput scienc m . phil . student . i observ some code clone tomcat found inconsist code : tomcat trunk java org apach catalina realm jdbcrealm . java 676 ( driver = = null ) { 677 try { 678 class clazz = class . name ( driver name ) ; 679 driver = ( driver ) clazz . new instanc ( ) ; 680 } catch ( throwabl e ) { 681 except util . handl throwabl ( e ) ; 682 throw new sqlexcept ( e . get messag ( ) , e ) ; 683 } 684 } 685 686 open new connect 687 properti prop = new properti ( ) ; 688 ( connect name = null ) 689 prop . put ( user , connect name ) ; 690 ( connect password = null ) 691 prop . put ( password , connect password ) ; 692 db connect = driver . connect ( connect url , prop ) ; tomcat trunk java org apach catalina valv jdbcaccess log valv . java 566 ( driver = = null ) { 567 try { 568 class clazz = class . name ( driver name ) ; 569 driver = ( driver ) clazz . new instanc ( ) ; 570 } catch ( throwabl e ) { 571 except util . handl throwabl ( e ) ; 572 throw new sqlexcept ( e . get messag ( ) , e ) ; 573 } 574 } 575 576 open new connect 577 properti prop = new properti ( ) ; 578 prop . put ( auto reconnect , true ) ; 579 ( connect name = null ) { 580 prop . put ( user , connect name ) ; 581 } 582 ( connect password = null ) { 583 prop . put ( password , connect password ) ; 584 } 585 conn = driver . connect ( connect url , prop ) ; quick descript inconsist two code snippet ar veri similar code , you see , jdbcrealm . java doe us prop . put ( auto reconnect , true ) while jdbcaccess log valv . java ha . we thought could potenti bug inconsist . hope thi help . potenti bug inconsist jdbcrealm . java jdbcaccess log valv . java

imho , http servlet request login doe need defin login config . non login authent us when login config specifi http servlet request login . when user databas realm us , gener princip memori user set session . authent base invok , princip regist session set request . becaus memori user set request princip , realm base ha role alwai return fals . result , 403 error return . programmat login us user databas realm return 403 error .

incomplet fix resourc leak bug express factori . java

incomplet fix resourc leak bug jdtcompil . java

incomplet fix resourc leak bug comet connect manag valv . java

incomplet fix resourc leak bug host config . java

incomplet fix resourc leak bug memori user databas . java

class org . apach . jasper . compil . jsp util , method public static string get tag handler class name ( string path , string urn , error dispatch err ) throw jasper except { . . . } us string constant directli like org . apach . jsp . tag . web . , org . apach . jsp . tag . meta . . you know tag file packag name field class org . apach . jasper . constant . code should adjust like below : constant . tag file packag name . web constant . tag file packag name . meta org . apach . jasper . compil . jsp util get tag handler class name ( ) doe us org . apach . jasper . constant . tag file packag name

incomplet fix resourc leak bug catalina . java

would veri us have pool properti class implement java . lang . cloneabl interfac . we have mani databas share same schema , usernam , password , configur etc differ onli url . implement rout datasourc base someth like org . springframework . jdbc . datasourc . abstract data sourc can just clone pool properti object set two properti differ clone . spring project properti ar common across all datasourc ar onli suppli onc . make pool properti implement cloneabl .

mime type javascript incorrect document

jasper illeg implement org . eclips . jdt . intern . compil . env . icompil unit from eclips

nio connector : except invok method read buf size write buf size jmx proxi servlet

annot process , web inf class , servlet listen filter skip when web app extract , class do have packag some embed scenario

el should coerc string integ equal oper

well defin how depend extens mechan can us tomcat

form authent post replai broken ajp

basic data sourc configur ( us resourc ) , simpli list avail mbean thi except emit stdout : sever : error get attribut catalina : type = data sourc , context = context , host = localhost , class = javax . sql . data sourc , name = jdbc my data sourc login timeout javax . manag . runtim oper except : except invok method login timeout org . apach . tomcat . util . model . base model mbean . get attribut ( base model mbean . java : 197 ) com . sun . jmx . interceptor . default mbean server interceptor . get attribut ( default mbean server interceptor . java : 666 ) com . sun . jmx . mbeanserv . jmx mbean server . get attribut ( jmx mbean server . java : 638 ) org . apach . catalina . mbean . mbean dumper . dump bean ( mbean dumper . java : 81 ) org . apach . catalina . manag . jmxproxi servlet . list bean ( jmxproxi servlet . java : 166 ) org . apach . catalina . manag . jmxproxi servlet . do get ( jmxproxi servlet . java : 121 ) javax . servlet . http . http servlet . servic ( http servlet . java : 621 ) . . . caus : java . lang . unsupport oper except : support basic data sourc org . apach . tomcat . dbcp . dbcp . basic data sourc . get login timeout ( basic data sourc . java : 1083 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) thi except doe caus request fail , definit put ugli stack trace catalina . out . might better catch unsupport oper except emit line error messag isn t sever . unsupport oper except log when fetch basic data sourc login timeout

per servlet spec , valu : javax . servlet . forward . request uri javax . servlet . forward . context javax . servlet . forward . servlet path javax . servlet . forward . path info javax . servlet . forward . queri string must set valu from veri first servlet servic current request . howev , seem tomcat popul path info valu last path info servic request ( i . e . final servlet servic request ) . s possibl other valu assign ar afflict similar defect , i ve explicitli test thi . becaus thi issu , s imposs correctli reconstruct origin request s uri piecem concaten context servlet path path info queri string , sinc path info contain path anoth servlet thu thi concaten produc probabl invalid uri target . therefor , creat click here retri link imposs without workaround code . critic issu here deviat from servlet spec , which spell out behavior those attribut . when request ar forward , request attribut javax . servlet . forward . path info assign incorrect valu .

due chang 1229726 , 1229727 1229728 output written respons filter can truncat up 8192 byte . consid follow scenario : you have filter invok get writer ( ) befor chain . do filter ( request , respons wrapper ) respons wrapper overrid get writer ( ) method return some buffer writer , real dure execut chain . do filter forward befor forward applic dispath call reset buffer respons , which turn call reset ( ) output buffer , which set got enc field fals . thi field initi set convert ( ) method which call from respons . get writer ( ) , sinc our wrapper respons overrid get writer ( ) , output buffer . set convert ( ) never call output buffer still ha got enc = fals . respons s close ( ) flush buffer ( ) method call output buffer s flush ( ) , sinc got enc = = fals , conv . flush buffer ( ) call : ( got enc conv = null ) { conv . flush buffer ( ) ; } workaround us implement get writer ( ) method respons wrapper like thi : public writer get writer ( ) { writer origin writer = origin respons . get writer ( ) ; save futur process return our writer ; } mayb you should chang flush someth like : ( conv = null ) { conv . flush buffer ( ) ; } becaus you invok conv . convert ( ) without ani check write ( ) method seem like conv never null . respons output written filter can truncat

when realm avail authent against , npe thrown . str : 1 . start stock 7 . 0 . 25 modifi server . xml : 2 . comment out resourc global name resourc 3 . comment out realm engin 4 . deploi manag app try log java . lang . null pointer except org . apach . catalina . realm . realm base . authent ( realm base . java : 340 ) org . apach . catalina . authent . basic authent . authent ( basic authent . java : 158 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 544 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 98 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 407 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 987 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 579 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1600 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 680 ) clearli , thi patholog setup , might nice get decent error messag instead npe . npe authent when realm resourc defin

see 52326 background , note particularli follow : long sci process involv expens classload , larger applic suffer from long startup time thu encourag shut off thi function via metadata complet = true . thi issu , , intend address classload base approach handl type process replac someth faster gener less problemat . asm would wai get done . classload base servlet contain initi handl type process can result long startup time

incorrect byeswritten log after complet async request under http1 . 0

sever : error finish respons java . lang . arrai index out bound except java . lang . system . arraycopi ( nativ method ) org . apach . coyot . http11 . abstract output buffer . write ( abstract output buffer . java : 495 ) org . apach . coyot . http11 . abstract output buffer . send statu ( abstract output buffer . java : 337 ) org . apach . coyot . http11 . abstract http11processor . prepar respons ( abstract http11processor . java : 1418 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 756 ) org . apach . coyot . respons . action ( respons . java : 168 ) org . apach . coyot . http11 . abstract output buffer . end request ( abstract output buffer . java : 310 ) org . apach . coyot . http11 . intern output buffer . end request ( intern output buffer . java : 158 ) org . apach . coyot . http11 . abstract http11processor . end request ( abstract http11processor . java : 1586 ) org . apach . coyot . http11 . abstract http11processor . process ( abstract http11processor . java : 1022 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 579 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 307 ) java . util . concurr . thread pool executor . run worker ( thread pool executor . java : 1110 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 603 ) java . lang . thread . run ( thread . java : 722 ) big applic i dont know why happen mai due fact twice add some cooki except

except log annot scan web app without web inf class

do load listen declar blank space tld file .

seem rather lot instanc where string byte ar cconvert us default charset . sinc default charset unknown , behaviour cannot reli . string . get byte ( ) new string ( byte ) us default charset mai caus problem some local

tc7 ant compil problem whitespac pathnam

current can onli queri bean set get attribut them . would good certain oper mbean could call jmxproxi servlet . extend jmxproxi allow call mbean oper

java . lang . illeg argument except : uri scheme file thrown context config . get default web xml fragment

methodexpress argument fail nest properti

tomcat default realm share realm instanc between web applic , result info log messag from lifecycl

el api current detect code webapp class loader . applic contain el api . jar start . ( patch follow ) . add detect el jar webapp class loader

valu express method get valu refer should return base object properti . return null valu express facelet paramet . exampl : some var = { concret object . properti } valu express { some var } return null from method get valu refer ( guess becaus simpl express { some var } ) , logicali should return parent express valu refer ( need hierach valu refer lookup ) . i made workaround java reflect api my code illustr problem : elcontext el context = face context . get current instanc ( ) . get elcontext ( ) ; valu refer refer = exp . get valu refer ( el context ) ; ( refer = = null exp instanceof tag valu express uel ) { valu express impl orig exp = ( valu express impl ) ( ( tag valu express uel ) exp ) . get wrap ( ) ; todo : jr : find better wai get base properti . code portabl becaus us tomcat el implement detail . field field = reflect util . find field ( orig exp . get class ( ) , el impl var properti ) ; field . set access ( true ) ; variabl mapper var mapper = ( variabl mapper ) reflect util . get field ( field , orig exp ) ; field = reflect util . find field ( orig exp . get class ( ) , el impl node properti ) ; field . set access ( true ) ; simpl node node = ( simpl node ) reflect util . get field ( field , orig exp ) ; ( var mapper = null node = null ) { valu express parent exp = var mapper . resolv variabl ( node . get imag ( ) ) ; ( parent exp = null ) { try { refer = parent exp . get valu refer ( el context ) ; ( refer = = null ) { refer = get valu refer ( parent exp ) ; } } catch ( properti found except e ) { log . warn ( properti found : e . get messag ( ) ) ; } } } } wrong get valu refer behaviour facelet paramet express

our applic we us us tomcat 5 , write our content directli respons writer our servlet : writer w = respons . get writer ( ) ; w . append ( . . . ) we have regularli measur perform our applic under stress multipl simultan request per second . we recent upgrad tomcat 7 , immedi observ perform degrad 10 request roundtrip same machin same test , compar our applic deploi tomcat 5 . profil jprofil show we got massiv amount transient object { { java . nio . heap char buffer } } produc 400mb within few minut . wai we ar write respons multipl statement { { append } } small string singl char , which us work properli . experi , we wrap respons writer { { buffer writer } } buffer 64k . thi brought our applic s perform back normal . we see thi either : anti pattern usag sinc tomcat 6 7 , which case pleas provid some document about . bug c2bconvert appli per everi call coyot writer write method , which gener garbag buffer per everi call . we know respons stream ha 8k buffer default . nevertheless , thi buffer come after encod step too late help garbag . perhap tomcat can buffer befor encod still , so much transient object just pattern elig us servlet api seem bug me . massiv garbag product observ when us respons writer

org . catalina . tomcat . startup . tomcat silenc method doesn t us host where we add applic

lower log level fail class load

access log doe log size file sent sendfil

non login authent doe honour session timeout singl sign valv

url paramet without valu should pars successfulli when log level = debug

prevent potenti data race org . apach . catalina . tribe . transport . bio . util . fast queue . size .

protect concurr access field org . apach . catalina . tribe . transport . bio . util . fast queue . remov

field org . apach . catalina . tribe . transport . bio . util . fast queue . enabl should volatil .

anti resourc lock unpack war

coda prelud order respect

null pointer except tribe . transport . nio . nio receiv . listen ( ) test run

embed tomcat us connector random port ( port 0 )

ad alia exist host run tomcat caus class cast except

add drop addit clarif doc deleg set webapp class loader

allow explicit us fip mode apr lifecycl listen

servlet context . get resourc ( path ) doesn t accept . . anymor

hello , i m us tomcat jmx interfac deploi app follow : 1 ) call mbean factori creat standard context , where mbean factori catalina : type = mbean factori , paramet : parent = catalina : type = host , host = localhost , path = w1 , doc base = my path app 2 ) call my app start , where my app catalina : j2ee type = web modul , name = localhost w1 , j2eeapplic = none , j2eeserv = none result , my app succesfulli deploi ( context avail ) , nevertheless i see follow except server consol ( full stacktrac ar skip , attach next comment ) : 31 2011 14 : 05 : 53 org . apach . catalina . startup . context config process context config sever : miss context . xml : file : c : my tomcat base folder conf catalina localhost w1 . xml java . io . file found except : c : my tomcat base folder conf catalina localhost w1 . xml 31 2011 14 : 05 : 53 org . apach . catalina . startup . context config process context config sever : pars error context . xml w1 java . io . file found except : c : my tomcat base folder conf catalina localhost w1 . xml 31 2011 14 : 05 : 53 org . apach . catalina . startup . context config configur start sever : mark thi applic unavail due previou error ( s ) 31 2011 14 : 05 : 53 org . apach . catalina . core . standard context start intern sever : error get configur 31 2011 14 : 05 : 53 org . apach . catalina . core . standard context start intern sever : context w1 startup fail due previou error except look strang me , sinc i don t understand why tomcat search context xml file dure jmx deploi . do i do someth wrong deploy workflow regard , michael tomcat report miss context xml wrong locat jmx deploy

null pointer except when jasper tri compil directori

npe except org . apach . catalina . connector . coyot adapt . servic

send redirect doe support protocol rel url

illeg state except us compress filter tomcat 7 . 0 . 21 22

public void do filter event ( comet event event , comet filter chain chain ) throw ioexcept , servlet except { process comet event ( event . get http servlet request ( ) . get remot host ( ) , event , chain ) ; } us get remot host should get remot addr . remot addr filter us remot host ( address ) do filter event

exampl : webapp exampl web inf class async async0 . java log file : log localhost . 2011 08 07 . log = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = java . lang . illeg state except : call async complet ( ) valid request async state dispatch org . apach . coyot . async state machin . async complet ( async state machin . java : 221 ) org . apach . coyot . http11 . http11processor . action intern ( http11processor . java : 525 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 773 ) org . apach . coyot . request . action ( request . java : 344 ) org . apach . catalina . core . async context impl . complet ( async context impl . java : 89 ) async . async0 . servic ( async0 . java : 42 ) javax . servlet . http . http servlet . servic ( http servlet . java : 722 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 304 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . core . applic dispatch . invok ( applic dispatch . java : 684 ) org . apach . catalina . core . applic dispatch . do includ ( applic dispatch . java : 593 ) org . apach . catalina . core . applic dispatch . includ ( applic dispatch . java : 530 ) org . apach . catalina . core . async context impl 1 . run ( async context impl . java : 173 ) org . apach . catalina . core . async context impl . do intern dispatch ( async context impl . java : 314 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 219 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 175 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 462 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 164 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 100 ) org . apach . catalina . valv . access log valv . invok ( access log valv . java : 851 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . async dispatch ( coyot adapt . java : 296 ) org . apach . coyot . http11 . abstract http11processor . async dispatch ( abstract http11processor . java : 1220 ) org . apach . coyot . abstract protocol abstract connect handler . process ( abstract protocol . java : 511 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 302 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 619 ) java . lang . illeg state except : call async complet ( )

npe comet process when shut down tomcat

infinit loop when shut down apr endpoint

request . get remot addr ( ) sometim return ip address from previou request . we have compar ip address return from get remot host ( ) from header get remot addr ( ) get remot addr return wrong ip address . we believ thi mai come from pool request object where sometim see previou valu remot ip . problem doesn t occur all time . we ar heavili reli get remot addr verifi remot client some our authent . can thi fix 2011 09 22 16 : 49 : 55 , 713 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv invok 2011 09 22 16 : 49 : 55 , 826 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv request . get info ( ) : org . apach . coyot . catalina . coyot request 1 . 0 2011 09 22 16 : 49 : 56 , 013 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv request . get remot addr ( ) : 98 . 138 . 85 . 230 2011 09 22 16 : 49 : 56 , 014 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv request . get remot host ( ) : web120016 . mail . ne1 . yahoo . com nslookup web120016 . mail . ne1 . yahoo . com server : 10 . 72 . 226 . 8 address : 10 . 72 . 226 . 8 53 name : web120016 . mail . ne1 . yahoo . com address : 98 . 138 . 85 . 143 2011 09 22 16 : 49 : 56 , 014 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv request . get request session id ( ) : null 2011 09 22 16 : 49 : 56 , 015 debug yjava . tomcat . valv . yahoo connect valv threadid : 1262 yahoo connect valv request . get header ( ) : accept : host : ls100 . mail . vip . ne1 . yahoo . com : 4080 content type : applic x ypy yahoo app auth : v = 1 ; = yahoo . mail . acl . yca . lsg prod ; h = 98 . 138 . 85 . 143 ; t = 1319282225 ; content length : 574 2011 09 22 16 : 49 : 56 , 015 debug yjava . filter . address . remot iptransl threadid : 1262 got remot address 98 . 138 . 85 . 230 port 46663 request . get remot addr ( ) sometim return ip address from previou request

speedup sessionid gener when run testsuit

http ssl nio won t work

bean elresolv vararg handl broken multipl wai

sever error deploi war applic ( expand war error )

sun . java2d . dispos class , when load , start endless daemon thread can inherit webapp class loader context loader . thi caus leak when webapp unload . would us jre memori leak prevent listen could load thi class prevent leak . improv jre memori leak prevent listen against leak caus sun . java2d . dispos

ssl configur properti name illeg

i m see occasion race condit happen between nio endpoint poller run http11nio protocol finish event . what happen race condit upon wake up selector can caus select kei mark interest op . read soon could . race poller . wakeup counter . step can occur which caus my select kei have interest op reset soon selector have wakeup ( ) call . 1 . poller0 start process run loop call event ( ) . 2 . poller0 check wakeup counter . get ( ) 0 which evalu fals ( wakeup counter 0 ) . 3 . worker1 finish event call poller add event 4 . worker1 enqueu poller event reset interest op . 5 . worker1 call wakeup counter . increment get increment get wakeup counter 1 . thi fail check call selector . wakeup ( ) ; 6 . poller0 call wakeup counter . set ( 1 ) 7 . poller0 call selector . select ( selector timeout ) block either full time out until anoth unrel select kei poll . 8 . poller0 ultim get around call event ( ) again which now reset interest op select kei wa process worker1 . simpl fix thi chang thi code : ( wakeup counter . get ( ) 0 ) { we ar here , mean we have other stuff do do non block select kei count = selector . select now ( ) ; } els { wakeup counter . set ( 1 ) ; kei count = selector . select ( selector timeout ) ; } thi ( wakeup counter . get set ( 1 ) 0 ) { we ar here , mean we have other stuff do do non block select kei count = selector . select now ( ) ; } els { kei count = selector . select ( selector timeout ) ; } race condit nio endpoint poller caus socket read until selector timeout

ajp cping forward request packet forgeri , design decis secur vulner

landingpag xhtml ( jsf cdi ) , nullpoint except .

regress cach control header request secur constraint

default rpc timeout backup manag set abstract replic map 15000 msec . thi configur . when receiv map messag . msg start ( after new member ad ) , publish entri info call all session where primari backup node ar includ . , backup node set session . when onli tomcat start cluster , publish entri info call all session . result , rpc messag ha possibl timeout . when acquir session from restart tomcat , warn unabl retriev remot object kei : xxx log . session cannot continu . i make rpc timeout configur backup manag . addition , rpc messag timeout abstract replic map broadcast , add warn messag . best regard . make rpc timeout configur backup manag .

dubiou us mkdir ( ) return code juli file handler

when i deploi webapp tomcat server , i us function tomcat . add webapp . i look code thi function make follow call : ctx . add lifecycl listen ( new default web xml listen ( ) ) ; when i start tomcat , thi default web xml listen activ automat , alwai doe follow code , so manag i set my context get overriden thi code : public static void init webapp default ( context ctx ) { . . . session ctx . set manag ( new standard manag ( ) ) ; ctx . set session timeout ( 30 ) ; . . . } so when i set standard manag programat , get overriden thi code . workaround i us , unregist default web xml listen , than add my own context . xml specif set , like custom manag deactiv session persist : context war context = tomcat . add webapp ( war context path , war locat ) ; lifecycl listen lclisten = war context . find lifecycl listen ( ) ; lifecycl listen default web xmllisten = null ; ( int i = 0 ; i lclisten . length ; i ) { ( lclisten i instanceof default web xml listen ) { default web xmllisten = lclisten i ; } } war context . remov lifecycl listen ( default web xmllisten ) ; . . . standard manag manag = new standard manag ( ) ; manag . set pathnam ( null ) ; disabl session persist : manag . set pathnam ( session . ser ) ; war context . set cooki ( true ) ; war context . set cross context ( true ) ; war context . set manag ( manag ) ; i think bug us tomcat . add webapp method make imposs set context . xml specif set programmat , becaus thei alwai get overriden default valu tomcat start . tomcat embed : us tomcat . add webapp alwai overrid programmat context set default valu context start tomcat server

under follow configur , npe thrown becaus set executor ( ) call con . get protocol handler ( ) . get class ( ) when protocol handler null . would nice report bad configur instead suffer npe . server . xml : executor name = tomcat thread pool name prefix = catalina exec max thread = 150 min spare thread = 4 connector port = 12345 redirect port = 443 protocol = http secur = true scheme = http proxi port = 80 uriencod = utf 8 executor = tomcat thread pool catalina . out : aug 23 , 2011 5 : 18 : 30 pm org . apach . catalina . connector . connector init sever : protocol handler instanti fail aug 23 , 2011 5 : 18 : 30 pm org . apach . tomcat . util . digest . digest start element sever : begin event threw except java . lang . null pointer except org . apach . catalina . startup . connector creat rule . set executor ( connector creat rule . java : 69 ) org . apach . catalina . startup . connector creat rule . begin ( connector creat rule . java : 63 ) org . apach . tomcat . util . digest . digest . start element ( digest . java : 1276 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . start element ( abstract saxpars . java : 501 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 179 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1537 ) org . apach . catalina . startup . catalina . load ( catalina . java : 555 ) org . apach . catalina . startup . catalina . load ( catalina . java : 596 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . load ( bootstrap . java : 281 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 449 ) aug 23 , 2011 5 : 18 : 30 pm org . apach . catalina . startup . catalina load warn : catalina . start us conf server . xml : error ( 104 , 66 ) : null aug 23 , 2011 5 : 18 : 30 pm org . apach . catalina . connector . connector init sever : protocol handler instanti fail aug 23 , 2011 5 : 18 : 30 pm org . apach . tomcat . util . digest . digest start element sever : begin event threw except java . lang . null pointer except org . apach . catalina . startup . connector creat rule . set executor ( connector creat rule . java : 69 ) org . apach . catalina . startup . connector creat rule . begin ( connector creat rule . java : 63 ) org . apach . tomcat . util . digest . digest . start element ( digest . java : 1276 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . start element ( abstract saxpars . java : 501 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 179 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1537 ) org . apach . catalina . startup . catalina . load ( catalina . java : 555 ) org . apach . catalina . startup . catalina . start ( catalina . java : 609 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 322 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 450 ) aug 23 , 2011 5 : 18 : 31 pm org . apach . catalina . startup . catalina load warn : catalina . start us conf server . xml : error ( 104 , 66 ) : null aug 23 , 2011 5 : 18 : 31 pm org . apach . catalina . startup . catalina start sever : cannot start server . server instanc configur . bad connector protocol caus null pointer except when us executor

ani webapp call java . awt . toolkit . get default toolkit launch new thread ( awt window , awt xawt , etc . ) which captur context class loader , pin webapp memori after undeploi redeploi . simpl addit jre memori leak prevent listen can allevi thi condit . jre memori leak prevent listen should protect against awt thread creation

separ keep aliv connect timeout apr nativ connector

potenti npe coyot adapt . log

hard diagnos null pointer except startup which can better appropri error messag : info : start servlet engin : apach tomcat 7 . 0 . 19 java . lang . null pointer except org . apach . catalina . startup . host config . filter app path ( host config . java : 493 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 466 ) org . apach . catalina . startup . host config . start ( host config . java : 1322 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 311 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) ok , what s thi about protect string filter app path ( string unfilt app path ) except rais ( string app path : unfilt app path ) which mean unfilt app path pass null . filter app path doe check ( shouldn t assert least ) problem come from deploi app ( ) : protect void deploi app ( ) { file app base = app base ( ) ; file config base = config base ( ) ; string filter app path = filter app path ( app base . list ( ) ) ; deploi xml descriptor from config base deploi descriptor ( config base , config base . list ( ) ) ; deploi war , loop addit descriptor ar found deploi war ( app base , filter app path ) ; deploi expand folder deploi directori ( app base , filter app path ) ; } where app base . list ( ) return null . thi must becaus app base doe actual denot directori ( ha ) inde , server . xml point nonexist app base . suggest add check deploi app : protect void deploi app ( ) { file app base = app base ( ) ; file config base = config base ( ) ; ( app base . exist ( ) app base . list ( ) = = null ) { throw new illeg argument except ( app base app base doe exist cannot list ) ; } string filter app path = filter app path ( app base . list ( ) ) ; deploi xml descriptor from config base deploi descriptor ( config base , config base . list ( ) ) ; deploi war , loop addit descriptor ar found deploi war ( app base , filter app path ) ; deploi expand folder deploi directori ( app base , filter app path ) ; } thi probabl violat some i18n requir though . null pointer except startup ( org . apach . catalina . startup . host config . filter app path ) due miss app base

possibl nullpoint except request util . pars paramet

jasper output messag compil error us lf ( n ) ani os . thi cannot correctli displai window notepad . i think line feed code along os would better , though i know other text editor solv thi . jasper output messag compil error us lf ( n ) ani os .

when i try deploi context name b . xml i get follow except . sever : unabl process jndi url jndi : localhost sampl web inf class annot java . io . file found except : jndi : localhost sampl web inf class org . apach . name . resourc . dir context urlconnect . list ( dir context ur lconnect . java : 452 ) org . apach . catalina . startup . context config . process annot jndi ( cont ext config . java : 1901 ) org . apach . catalina . startup . context config . process annot url ( cont xt config . java : 1828 ) org . apach . catalina . startup . context config . web config ( context config . jav : 1295 ) org . apach . catalina . startup . context config . configur start ( context confi g . java : 896 ) org . apach . catalina . startup . context config . lifecycl event ( context confi g . java : 322 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl e support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl ba se . java : 89 ) org . apach . catalina . core . standard context . start intern ( standard contex t . java : 5103 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 812 ) org . apach . catalina . core . contain base . add child ( contain base . java : 78 7 ) org . apach . catalina . core . standard host . add child ( standard host . java : 607 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . ja va : 633 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . j ava : 558 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 468 ) org . apach . catalina . startup . host config . check ( host config . java : 1363 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 294 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl e support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl ba se . java : 89 ) org . apach . catalina . core . contain base . background process ( contain ba e . java : 1233 ) org . apach . catalina . core . contain base contain background processor . p rocess children ( contain base . java : 1391 ) org . apach . catalina . core . contain base contain background processor . p rocess children ( contain base . java : 1401 ) org . apach . catalina . core . contain base contain background processor . r un ( contain base . java : 1380 ) java . lang . thread . run ( thread . java : 619 ) i would have expect applic avail uri b . bug seem list ( ) method dir context urlconnect . java . method assum context name doe have ani charact . see develop note just befor block . i have ad els condit seem have solv problem me . try { string file = get url ( ) . get file ( ) ; thi form hostnam contextpath file name contextpath empti otherwis thi form hostnam file name strip off hostnam contextpath int start ; ( context instanceof proxi dir context . equal ( ( ( proxi dir context ) context ) . get context path ( ) ) ) { start = file . index ( , 1 ) ; } els ( context instanceof proxi dir context ) { start = . length ( ) ( ( proxi dir context ) context ) . get host name ( ) . length ( ) ( ( proxi dir context ) context ) . get context path ( ) . length ( ) ; seem like bug tomcat . below wa code tomcat . how can handl contextpath like sampl . cannot start = file . index ( , file . index ( , 1 ) 1 ) ; } els start = file . index ( , file . index ( , 1 ) 1 ) ; name enumer name class pair enumer = context . list ( file . substr ( start ) ) ; while ( enumer . ha more element ( ) ) { name class pair ncp = enumer . next element ( ) ; result . add element ( ncp . get name ( ) ) ; } } catch ( name except e ) { unabl deploi applic name b . xml

clear refer jdbc seem caus leak com . oracl . ojdbc5 driver

org . apach . coyot . http11 . http11nio protocol . http11connect handler code segment : = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = overrid public void releas ( socket wrapper nio channel socket ) { http11nio processor processor = connect . remov ( socket ) ; ( processor = null ) { processor . recycl ( ) ; recycl processor . offer ( processor ) ; } } = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = should : = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = overrid public void releas ( socket wrapper nio channel socket ) { http11nio processor processor = connect . remov ( socket . get socket ( ) ) ; ( processor = null ) { processor . recycl ( ) ; recycl processor . offer ( processor ) ; } } = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = type connect concurr hash map nio channel , http11nio processor , concurr hash map socket wrapper nio channel , http11nio processor . http11nio processor correct releas

noth bad here , my compil light up : connect = connect = driver . connect ( driver url , properti ) ; clearli , fix . line 267 org . apach . tomcat . jdbc . pool . pool connect : doubl assign typo

current trunk . step reproduc : 1 . start tomcat 7 2 . go webapp exampl web inf web . xml uncom filter map time filter ( line 75 ) . 3 . wait sever second . exampl webapp reload , fail start . thi happen becaus typo . filter name valu should s time filter time filter . stack trace log : 04 . 08 . 2011 8 : 09 : 39 org . apach . catalina . startup . host config check resourc warn : error dure context exampl restart java . lang . illeg argument except : filter map specifi unknown filter name time filter org . apach . catalina . core . standard context . valid filter map ( standard context . java : 2950 ) org . apach . catalina . core . standard context . add filter map ( standard context . java : 2915 ) org . apach . catalina . deploi . web xml . configur context ( web xml . java : 1206 ) org . apach . catalina . startup . context config . web config ( context config . java : 1343 ) org . apach . catalina . startup . context config . configur start ( context config . java : 896 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 322 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5103 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . startup . host config . check resourc ( host config . java : 1279 ) org . apach . catalina . startup . host config . check ( host config . java : 1360 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 294 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1240 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1398 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1408 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1387 ) java . lang . thread . run ( thread . java : 662 ) 4 . go web . xml edit onc again . e . g . re comment map , correct typo . 5 . wait sever second . here issu : expect : exampl webapp should reload successfulli . actual : reload fail . follow print log : 04 . 08 . 2011 8 : 09 : 59 org . apach . catalina . startup . host config check resourc info : reload context exampl 04 . 08 . 2011 8 : 09 : 59 org . apach . catalina . util . lifecycl base start info : start ( ) method wa call compon standard engin catalina . standard host localhost . standard context exampl after start ( ) had alreadi been call . second call ignor . 6 . stop tomcat . here second issu : expect : success shutdown actual : 04 . 08 . 2011 8 : 14 : 10 org . apach . catalina . startup . catalina stop sever : catalina . stop org . apach . catalina . lifecycl except : invalid lifecycl transit wa attempt ( befor stop ) compon standard engin catalina . standard host localhost . standard context exampl state start prep org . apach . catalina . util . lifecycl base . invalid transit ( lifecycl base . java : 387 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 212 ) org . apach . catalina . core . contain base . stop intern ( contain base . java : 1072 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 225 ) org . apach . catalina . core . contain base . stop intern ( contain base . java : 1072 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 225 ) org . apach . catalina . core . standard servic . stop intern ( standard servic . java : 502 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 225 ) org . apach . catalina . core . standard server . stop intern ( standard server . java : 748 ) org . apach . catalina . util . lifecycl base . stop ( lifecycl base . java : 225 ) org . apach . catalina . startup . catalina . stop ( catalina . java : 694 ) org . apach . catalina . startup . catalina catalina shutdown hook . run ( catalina . java : 847 ) thi except shutdown happen onli exampl webapp wa correct when tomcat start , wa broken afterward . wa alreadi broken startup time , noth happen . 7 . here third issu : when abov happen shutdown sequenc appar abort abnorm . expect : info : stop protocol handler http bio 8080 etc . messag actual : ar messag after sever : catalina . stop i cite abov . context fail reload after error web . xml wa correct

check whether session load memori , store base process expir call find session ( id ) . = = = = = . . . ( manag . find session ( kei i ) = null ) { load = true ; } . . . = = = = = howev , persist manag find session ( id ) load session from store when session memori . becaus session load from store invalid session persist manag log errorlog , call session . expir ( ) , delet session from store . result , find session ( id ) return null , load becom fals . , session . expir ( ) call again , session delet from store . manag persist manag , necessari call persist manag base load ( id ) . howev , avoid regress r1033024 , other manag call find session ( id ) . best regard . persist manag load session from store call session . expir ( ) twice .

i m ad some field subclass org . apach . catalina . valv . access log valv creat log element ( ) closest extens point avail . rather than reimplement function would prefer both creat access log element ( ) method were protect rather than privat s simpl method match char you want us fall back super . creat access log element ( ) . chang access modifi access log valv make easier extend

i ve recent upgrad tomcat 7 us run metadata complet = true my web . xml . servlet 3 i decid i d try some annot featur . when i turn off metadata complet i got verifi error try load my class . thi class meant onli work tomcat 6 so fact tomcat 7 cannot load thi class expect . what expect tomcat 7 doesn t just ignor error continu scan annot . look context config . check handl type ( ) i check virtual everi type load failur except verifi error . perhap verifi error should ad thi list java . lang . verifi error : class org . ld . stack . tomcat . decrypt . decrypt standard context overrid final method start . ( ) v java . lang . class loader . defin class1 ( nativ method ) java . lang . class loader . defin class cond ( class loader . java : 631 ) java . lang . class loader . defin class ( class loader . java : 615 ) java . secur . secur class loader . defin class ( secur class loader . java : 141 ) java . net . urlclass loader . defin class ( urlclass loader . java : 283 ) java . net . urlclass loader . access 000 ( urlclass loader . java : 58 ) java . net . urlclass loader 1 . run ( urlclass loader . java : 197 ) java . secur . access control . do privileg ( nativ method ) java . net . urlclass loader . find class ( urlclass loader . java : 190 ) java . lang . class loader . load class ( class loader . java : 306 ) java . lang . class loader . load class ( class loader . java : 247 ) java . lang . class . name0 ( nativ method ) java . lang . class . name ( class . java : 247 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1665 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1523 ) org . apach . catalina . startup . context config . check handl type ( context config . java : 2006 ) org . apach . catalina . startup . context config . process annot stream ( context config . java : 1969 ) org . apach . catalina . startup . context config . process annot jar ( context config . java : 1858 ) org . apach . catalina . startup . context config . process annot url ( context config . java : 1826 ) org . apach . catalina . startup . context config . process annot ( context config . java : 1812 ) org . apach . catalina . startup . context config . web config ( context config . java : 1306 ) org . apach . catalina . startup . context config . configur start ( context config . java : 896 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 322 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 5103 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 812 ) org . apach . catalina . core . contain base . add child ( contain base . java : 787 ) org . apach . catalina . core . standard host . add child ( standard host . java : 607 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 633 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 558 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 468 ) org . apach . catalina . startup . host config . start ( host config . java : 1322 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 311 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) org . apach . catalina . util . lifecycl base . set state intern ( lifecycl base . java : 379 ) org . apach . catalina . util . lifecycl base . set state ( lifecycl base . java : 324 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1041 ) org . apach . catalina . core . standard host . start intern ( standard host . java : 774 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1033 ) org . apach . catalina . core . standard engin . start intern ( standard engin . java : 291 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . core . standard servic . start intern ( standard servic . java : 443 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . core . standard server . start intern ( standard server . java : 727 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 145 ) org . apach . catalina . startup . catalina . start ( catalina . java : 621 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 322 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 450 ) context config . check handl type ( ) doesn t check verifi error when load class

newlin dure http header field name obscur next valu

make threadnam avail extend access log valv

invalid lifecycl transit ( befor stop ) compon state initi : mapper listen

after respons commit , follow api throw illeg state except . s o . k . messag except set . http servlet respons reset buffer http servlet respons send error http servlet respons send redirect http servlet respons set buffer size understand bug applic , hope messag set like other except . when call api relat buffer after respons commit , messag thrown .

disabl drop support sslv2

perform issu when retriv jar file dure tld file pars .

lru cach ( org . apach . catalina . filter . csrf prevent filter lru cach ) us csrf prevent filter base link hash map . from link hash map java doc : note thi implement synchron . multipl thread access link hash map concurr , least thread modifi map structur , must synchron extern . . . . lru cach implement doe synchron access map . csrf prevent filter s lru cach thread save

method : org . apach . catalina . startup . web rule set . add rule instanc ( digest digest ) code : = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = digest . add call method ( full prefix absolut order name other , add absolut order other ) ; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = web common 3 0 . xsd = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = xsd : complex type name = absolut order type xsd : annot xsd : document pleas see section 8 . 2 . 2 specif detail . xsd : document xsd : annot xsd : choic min occur = 0 max occur = unbound xsd : element name = name type = javae : java identifi type min occur = 0 max occur = unbound xsd : element name = other type = javae : order other type min occur = 0 max occur = 1 xsd : choic xsd : complex type = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = absolut order name other should includ name element

tomcat crash tcnativ 1 . dll frequent

7 . 0 . 18 packag candid releas final unreleas , when i stop tomcat servic ( onli 1 war deploi ) , servic take lot time stop final wa kill system . have look stderr log , i see paus right after folow line : info : stop protocol handler http apr 0 went slow loop fill log line : 13 juil . 2011 14 : 30 : 30 org . apach . tomcat . util . net . apr endpoint stop intern attent : acceptor thread http apr 0 acceptor 0 fail unlock . forc hard socket shutdown . 13 juil . 2011 14 : 30 : 31 org . apach . tomcat . util . net . apr endpoint stop intern attent : acceptor thread http apr 0 acceptor 0 fail unlock . forc hard socket shutdown . 13 juil . 2011 14 : 30 : 32 org . apach . tomcat . util . net . apr endpoint stop intern attent : acceptor thread http apr 0 acceptor 0 fail unlock . forc hard socket shutdown . etc . ( about 30 time befor wa kill ) i think wa issu 7 . 0 . 16 . addit error check requir connector port attribut ( e . g . port = )

support all protocol combin sslprotocol apr connector

access log valv , which respons handl access log us file writer ( doesn t support unicod ) . i guess instanti writer like thi would solv case : writer = new print writer ( new output stream writer ( new file output stream ( pathnam ) , utf 8 ) , true ) ; tomcat access log doesn t support unicod

npe standard context valv . invok ( ) when webapp redeploi while request still process

gzip interceptor decompress completli implement

secur config , set packag . definit secur properti nullsun . , java . , . . .

standard context method thread run us . thi most probabl mistak , sinc few line below thread join call wait complet thread . so we could either remov join get rid thread us just runnabl , start thread . usag method run instead start start thread

typo comment host manag servlet

tomcat 7 , i ve notic request url doe requir authent get forward login page request contain author header . our applic expect request process servlet . servlet pars author header take appropri action ( possibl redirect login page allow request header contain accept token ) . thi ha work older version tomcat . relev part our web . xml look like : secur constraint web resourc collect web resourc name open web resourc name url pattern url pattern sever other url pattern web resourc collect user data constraint transport guarante confidenti transport guarante user data constraint notic auth constraint element secur constraint i observ behavior org . apach . catalina . authent . authent base . invok ( ) , here s what i saw : constraint variabl contain singl constraint match secur constraint from our web . xml abov . line 520 , auth requir set true becaus presenc author header . authent ( ) call line 535 fail redirect login page . request open url includ author header do reach servlet

i found follow arrai index out bound except my logfil . occur directli after login my web app without ani further user interact . unfortun reproduc all . i am sure whether jasper right compon . howev class jjtelpars state jasper el . jar . environ : tomcat 6 . 0 . 32 facelet 1 . 1 . 14 myfac 1 . 2 . 9 schwerwiegend : error render view facelet myview . xhtml java . lang . arrai index out bound except : 1 java . util . arrai list . remov ( arrai list . java : 390 ) org . apach . el . parser . jjtelpars state . close node scope ( jjtelpars state . java : 108 ) org . apach . el . parser . elpars . composit express ( elpars . java : 74 ) org . apach . el . lang . express builder . creat node intern ( express builder . java : 115 ) org . apach . el . lang . express builder . build ( express builder . java : 172 ) org . apach . el . lang . express builder . creat valu express ( express builder . java : 216 ) org . apach . el . express factori impl . creat valu express ( express factori impl . java : 68 ) com . sun . facelet . el . eltext eltext variabl . appli ( eltext . java : 161 ) com . sun . facelet . compil . attribut instruct . appli ( attribut instruct . java : 60 ) com . sun . facelet . compil . uiinstruct handler . appli ( uiinstruct handler . java : 95 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jstl . core . handler . appli ( handler . java : 54 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jsf . compon handler . appli next handler ( compon handler . java : 360 ) com . sun . facelet . tag . jsf . compon handler . appli ( compon handler . java : 190 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jsf . compon handler . appli next handler ( compon handler . java : 360 ) com . sun . facelet . tag . jsf . compon handler . appli ( compon handler . java : 190 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jsf . compon handler . appli next handler ( compon handler . java : 360 ) org . apach . myfac . custom . aliasbean . alia bean scope tag handler . appli next handler ( alia bean scope tag handler . java : 52 ) com . sun . facelet . tag . jsf . compon handler . appli ( compon handler . java : 190 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . ui . composit handler . appli ( composit handler . java : 124 ) com . sun . facelet . compil . namespac handler . appli ( namespac handler . java : 49 ) com . sun . facelet . compil . encod handler . appli ( encod handler . java : 39 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 248 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 294 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 273 ) com . sun . facelet . impl . default facelet context . includ facelet ( default facelet context . java : 140 ) com . sun . facelet . tag . ui . includ handler . appli ( includ handler . java : 66 ) com . sun . facelet . tag . ui . defin handler . appli definit ( defin handler . java : 64 ) com . sun . facelet . tag . ui . composit handler . appli ( composit handler . java : 136 ) com . sun . facelet . impl . default facelet context templat manag . appli ( default facelet context . java : 337 ) com . sun . facelet . impl . default facelet context . includ definit ( default facelet context . java : 307 ) com . sun . facelet . tag . ui . insert handler . appli ( insert handler . java : 68 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jsf . compon handler . appli next handler ( compon handler . java : 360 ) com . sun . facelet . tag . jsf . compon handler . appli ( compon handler . java : 190 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . jsf . compon handler . appli next handler ( compon handler . java : 360 ) com . sun . facelet . tag . jsf . compon handler . appli ( compon handler . java : 190 ) com . sun . facelet . tag . composit facelet handler . appli ( composit facelet handler . java : 47 ) com . sun . facelet . tag . ui . composit handler . appli ( composit handler . java : 124 ) com . sun . facelet . compil . namespac handler . appli ( namespac handler . java : 49 ) com . sun . facelet . compil . encod handler . appli ( encod handler . java : 39 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 248 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 294 ) com . sun . facelet . impl . default facelet . includ ( default facelet . java : 273 ) com . sun . facelet . impl . default facelet context . includ facelet ( default facelet context . java : 140 ) com . sun . facelet . tag . ui . composit handler . appli ( composit handler . java : 116 ) com . sun . facelet . compil . namespac handler . appli ( namespac handler . java : 49 ) com . sun . facelet . compil . encod handler . appli ( encod handler . java : 39 ) com . sun . facelet . impl . default facelet . appli ( default facelet . java : 95 ) com . sun . facelet . facelet view handler . build view ( facelet view handler . java : 596 ) com . sun . facelet . facelet view handler . render view ( facelet view handler . java : 651 ) org . ajax4jsf . applic . view handler wrapper . render view ( view handler wrapper . java : 100 ) org . ajax4jsf . applic . ajax view handler . render view ( ajax view handler . java : 176 ) org . apach . myfac . lifecycl . render respons executor . execut ( render respons executor . java : 41 ) org . apach . myfac . lifecycl . lifecycl impl . render ( lifecycl impl . java : 140 ) org . apach . myfac . custom . ppr . pprlifecycl wrapper . render ( pprlifecycl wrapper . java : 84 ) javax . face . webapp . face servlet . servic ( face servlet . java : 187 ) com . foo . . client . web . servlet . face servlet wrapper . servic ( face servlet wrapper . java : 125 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . ajax4jsf . webapp . base xmlfilter . do xml filter ( base xmlfilter . java : 206 ) org . ajax4jsf . webapp . base filter . handl request ( base filter . java : 290 ) org . ajax4jsf . webapp . base filter . process upload handl request ( base filter . java : 388 ) org . ajax4jsf . webapp . base filter . do filter ( base filter . java : 515 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . myfac . webapp . filter . extens filter . do filter ( extens filter . java : 392 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . foo . . client . web . filter . login filter . do filter ( login filter . java : 219 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . foo . . client . web . filter . cach filter . do filter ( cach filter . java : 110 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . foo . . client . web . filter . encod filter . do filter ( encod filter . java : 54 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . foo . . client . web . filter . timer filter . do filter ( timer filter . java : 80 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 233 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 191 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 470 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 127 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 298 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 859 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 588 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 489 ) java . lang . thread . run ( thread . java : 662 ) arrai index out bound except from org . apach . el . parser . jjtelpars state

servlet request listen fail access request paramet when expect header sent

async thread call async context . get respons ( ) after async timeout , get null refer . follow exampl , lead npe . servlet spec veri clear behavior adopt after timeout , i don t think null should return . mayb illeg state except instead seem case complet ( ) call after timeout . packag test ; import java . io . ioexcept ; import java . io . print writer ; import javax . servlet . async context ; import javax . servlet . async event ; import javax . servlet . async listen ; import javax . servlet . servlet except ; import javax . servlet . servlet respons ; import javax . servlet . annot . web servlet ; import javax . servlet . http . http servlet ; import javax . servlet . http . http servlet request ; import javax . servlet . http . http servlet respons ; servlet implement class my servlet web servlet ( valu = my servlet , async support = true ) public class my servlet extend http servlet implement async listen { privat static final long serial version uid = 1l ; protect void do get ( http servlet request request , http servlet respons respons ) throw servlet except , ioexcept { final async context async context = request . start async ( request , respons ) ; async context . add listen ( thi ) ; async context . set timeout ( 10 1000 ) ; async context . start ( new runnabl ( ) { overrid public void run ( ) { system . out . println ( enter async thread ) ; try { thread . sleep ( 20 1000 ) ; system . out . println ( asyncthread about write respons ) ; servlet respons response2 = async context . get respons ( ) ; print writer writer = response2 . get writer ( ) ; writer . write ( hello world ) ; system . out . println ( asyncthread about complet ) ; async context . complet ( ) ; } catch ( except e ) { e . print stack trace ( ) ; } } } ) ; } overrid public void complet ( async event evt ) throw ioexcept { system . out . println ( complet evt ) ; } overrid public void error ( async event evt ) throw ioexcept { system . out . println ( error evt ) ; } overrid public void start async ( async event evt ) throw ioexcept { system . out . println ( start async evt ) ; } overrid public void timeout ( async event evt ) throw ioexcept { system . out . println ( timeout evt ) ; evt . get async context ( ) . get respons ( ) . get writer ( ) . write ( time out ) ; evt . get async context ( ) . complet ( ) ; } } call async context . get respons ( ) return null after async timeout

session type chang from backup primari

allow more flexibl ad webapp org . apach . catalina . startup . tomcat

formatt assign org . apach . juli . file handler log . properti misconfigur fail load , file handler start without formatt fail npe later . reproduc : assign some bogu valu 1catalina . org . apach . juli . file handler . formatt when tomcat start , follow print consol : java . util . log . error manag : 4 java . lang . null pointer except org . apach . juli . file handler . open writer ( file handler . java : 377 ) org . apach . juli . file handler . init ( file handler . java : 99 ) org . apach . juli . file handler . init ( file handler . java : 90 ) i think we can more toler thi configur error fall back default formatt . i commit fix shortli . avoid null pointer except juli file handler formatt misconfigur

java . lang . illeg argument except : session config element limit 1 occurr

embed class cannot launch webapp jsp servlet

access log valv . date time element ( ) can current configur onli t which output date time common log format . ad capabl configur { time format } , could overrid ( least ) time formatt properti class . . . could go further allow overrid all dai , month , year , time formatt properti . justif enhanc : log currenlti provid abil log process time milli ( via t ) , accur log order which request ar receiv cannot determin without capabl log format millisecond us t element . enhanc allow { time format } t configur access log valv

handl type correctli handl server startup lead incorrect class set pass initi

ssi regular express work

we have environ coupl load balanc tomcat front httpd . someon access manag applic through load balanc , thei know which load balanc tomcat thei end up . situat , other well , would nice manag could tell hostnam ip address machin run . patch show hostnam ip address manag webapp

occasion we got error like follow : = = = = = = 2011 05 30 03 : 40 : 17 , 697 error pool 1 thread 2 ( org . apach . catalina . ha . session . delta manag ) manag localhost : unabl receiv messag through tcp channel java . lang . null pointer except java . io . object output stream block data output stream . get utflength ( object output stream . java : 2106 ) java . io . object output stream block data output stream . write utf ( object output stream . java : 1977 ) java . io . object output stream . write utf ( object output stream . java : 849 ) org . apach . catalina . ha . session . delta request . write extern ( delta request . java : 267 ) org . apach . catalina . ha . session . delta request . serial ( delta request . java : 287 ) org . apach . catalina . ha . session . delta manag . serial delta request ( delta manag . java : 716 ) org . apach . catalina . ha . session . delta manag . request complet ( delta manag . java : 1224 ) org . apach . catalina . ha . session . delta session . expir ( delta session . java : 403 ) org . apach . catalina . ha . session . delta manag . handl session expir ( delta manag . java : 1546 ) org . apach . catalina . ha . session . delta manag . messag receiv ( delta manag . java : 1452 ) org . apach . catalina . ha . session . delta manag . messag data receiv ( delta manag . java : 1173 ) org . apach . catalina . ha . session . cluster session listen . messag receiv ( cluster session listen . java : 92 ) org . apach . catalina . ha . tcp . simpl tcp cluster . messag receiv ( simpl tcp cluster . java : 901 ) org . apach . catalina . ha . tcp . simpl tcp cluster . messag receiv ( simpl tcp cluster . java : 882 ) org . apach . catalina . tribe . group . group channel . messag receiv ( group channel . java : 269 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . interceptor . tcp failur detector . messag receiv ( tcp failur detector . java : 110 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . channel coordin . messag receiv ( channel coordin . java : 241 ) org . apach . catalina . tribe . transport . receiv base . messag data receiv ( receiv base . java : 225 ) org . apach . catalina . tribe . transport . nio . nio replic task . drain channel ( nio replic task . java : 188 ) org . apach . catalina . tribe . transport . nio . nio replic task . run ( nio replic task . java : 91 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 662 ) look like function tomcat affect thi . npe come from try write null session id , why doe tomcat try send someth from handl receiv authorit session expir messag npe delta request . write extern ( delta request . java : 267 ) when handl remot session expir

web dav lock refresh request mai caus null pointer except becaus ( imho ) wrong check line 1332 webdav servlet . java 1056763 2011 01 08 18 : 56 : 57z markt . i suggest line 1332 should : . . . ( renew = null ) { . . . potenti null pointer except org . apach . catalina . servlet . webdav servlet line 1336

sure thi bug just my mi code . . . i ve been us embed compon tomcat 6 . 0 . 29 integr test . someth like thi : server = new embed tomcat ( test , 7890 , jvm 1 ) ; peer peer cach lifecycl listen p2p listen = new peer peer cach lifecycl listen ( ) ; p2p listen . set properti ( mcast port , 19991 ) ; server . get embed ( ) . add lifecycl listen ( p2p listen ) ; session manag = new delta session manag ( ) ; server . get root context ( ) . set manag ( session manag ) ; here embed tomcat class simpli wrapper embed i m pass context , port jvm rout noth special . i add listen which should programmat equival have follow server . xml snippet : server listen class name = peer peer cach lifecycl listen server delta session manag perform custom session manag thu extend manag base implement lifecycl session manag . dure start delta session manag i initi listen do thi . lifecycl . fire lifecycl event ( start event , null ) ; listen pick up thi event start . all work nice under tomcat 6 , break under tomcat 7 . 0 . 12 . my initi investig show lifecycl event , fire , reach embed compon which where listen regist . remov overridden lifecycl method from embed ( so lifecyl process happen lifecycl base ) seem work trigger event reach my listen . org . apach . catalina . startup . embed overrid lifecycl incorrectli

intermitt java . lang . illeg argument except : session config element limit 1 occurr

when output buffer . do flush get except , do flush get stuck true

patch add version paramet ant task

startup time tomcat 7 . 0 . 14 10x higher than 7 . 0 . 12 , ar few share jar tomcat lib few webapp . issu veri simpl reproduc , simpli add 10 empti directori tomcat webapp ( exampl ) metro webservic jar tomcat lib . my machin startup time increas from 0 . 5 sec ( default instal ) 35 . 2 sec . when us tomcat 7 . 0 . 12 startup time about 3 sec my machin thi test case . startup time too high ar few jar lib few webapp .

npe dure form authent when form login config miss

max connect honor config when acceptor thread count 1

ant task find leak . patch add find leak ant task

ssl seem fail when content type header set imag svg xml . i ve onli seen thi failur when ssl wa run solari machin . ( unam : sun os hostnam remov 5 . 8 gener 108528 18 sun4u sparc sunw , ultra 60 ) when attempt window , we were unabl duplic error . thi reliabl fail when attempt thi specif solari machin . i get chanc , i ll try creat test case see i can reproduc thi other solari machin . unfortun , thi wa show stopper releas s made todai so i m press time . basic , what happen we re us jsp page creat svg file . becaus thi , we have set content type header imag svg xml . when mime type set thi valu , page fail load internet explor 6 ( sp1 ) messag connect fail someth similar . when attempt wa made opera , opera respond crash . mozilla successfulli download file , though . howev , when reset mime type page text plain all three browser can access page without failur . back rev tomcat version 4 . 1 . 29 , we were abl resolv thi issu access page all three browser . i ll try creat test case later todai verifi isn t just our svg jsp s fail ani creat svg i m current press time sorri . ie plugin cannot access compon through tomcat 5 over ssl

perform : data sourc proxi creat pool should us more fine grain synchronis

otherwis , mai veri hard find what wrong warn app base exist file directori

add system properti make possibl jsp page extend page direct take advantag tag pool

some async exampl ar work correctli

queri stat ha synchornis issu

svn trunk : jdbc interceptor option ar taken account

app configur server . xml like thi : { code } host name = www . myapp . pl app base = usr lib tomcat webapp unpack war = fals auto deploi = fals xml valid = fals xml namespac awar = fals context doc base = var www myapp path = cach max size = 5120 cach ttl = 60000 cach allow = true context context path = manag privileg = true doc base = usr lib tomcat webapp manag context host { code } tomcat manag , applic list , button expir session avail onli manag applic . button expir session path . i think bug htmlmanag servlet . java thi part : { code } ( context . get path ( ) . equal ( thi . context . get path ( ) ) ) { writer . print ( messag format . format ( manag app row button section , arg ) ) ; } els ( context . get avail ( ) deploi ) { writer . print ( messag format . format ( start deploi app row button section , arg ) ) ; } els ( context . get avail ( ) deploi ) { writer . print ( messag format . format ( start nondeploi app row button section , arg ) ) ; } els ( context . get avail ( ) deploi ) { writer . print ( messag format . format ( stop deploi app row button section , arg ) ) ; } els { writer . print ( messag format . format ( stop nondeploi app row button section , arg ) ) ; } { code } expir session button visibl context configur server . xml

miss deprec comment

spuriou deprec tag servlet context

serializ except : org . apach . catalina . realm . gener princip

report fhanik dev list : 2 . com . sun . secur . jgss . krb5 . accept configur while authent ha attribut login config name , seem place code where omit thi entri . renam thi entri jaa . conf set login config name fail valid ticket problem code here : gss context = manag . creat context ( manag . creat credenti ( null , gsscredenti . default lifetim , new oid ( 1 . 3 . 6 . 1 . 5 . 5 . 2 ) , gsscredenti . accept onli ) ) ; should look like final gssmanag manag = gssmanag . get instanc ( ) ; final privileg except action gsscredenti action = new privileg except action gsscredenti ( ) { public gsscredenti run ( ) throw gssexcept { return manag . creat credenti ( null , gsscredenti . default lifetim , new oid ( 1 . 3 . 6 . 1 . 5 . 5 . 2 ) , gsscredenti . accept onli ) ; } } ; gss context = manag . creat context ( subject . do ( lc . get subject ( ) , action ) ) ; best filip spnego login config name doe work

( also true tomcat 7 ) jmx remot lifecycl listen doe support jaa base authent . , when authent requir , onli support file base authent . extra jmx remot lifecycl listen doe support jaa base authent authoris

first all , i know ha been bug regard similar problem befor wa fix . current thi bug occur even tomcat version 6 . 0 . 32 . we have problem tomcat runnign paramet org . apach . jasper . runtim . bodi content impl . limit buffer = true . after tomcat ha just start , everyth fine after two dai lot arrai index out bound except occur random page applic . tomcat start without thi paramet don t seem have problem . unfortun we weren t abl reproduc bug local , appear onli our product system . could concurr problem , onli show lot go platform i can provid two small stackstrac can show class where problem occur : 1 . caus : java . lang . arrai index out bound except org . apach . jasper . runtim . bodi content impl . write ( unknown sourc ) java . io . print writer . write ( print writer . java : 382 ) org . apach . jasper . runtim . jsp writer impl . flush buffer ( unknown sourc ) org . apach . jasper . runtim . page context impl . releas ( unknown sourc ) org . apach . jasper . runtim . jsp factori impl . intern releas page context ( unknown sourc ) org . apach . jasper . runtim . jsp factori impl . releas page context ( unknown sourc ) org . apach . jsp . member . list . short . incom short list jsp . jsp servic ( incom short list jsp . java : 796 ) org . apach . jasper . runtim . http jsp base . servic ( unknown sourc ) javax . servlet . http . http servlet . servic ( unknown sourc ) 2 . caus : java . lang . arrai index out bound except java . lang . string . get char ( string . java : 854 ) org . apach . jasper . runtim . bodi content impl . write ( unknown sourc ) org . apach . jasper . runtim . bodi content impl . write ( unknown sourc ) org . apach . jasper . runtim . bodi content impl . print ( unknown sourc ) org . apach . taglib . standard . tag . common . fmt . messag support . do end tag ( messag support . java : 203 ) org . apach . jsp . member . profil . profil jsp . jspx meth fmt 005fmessag 005f2 ( profil jsp . java : 4897 ) org . apach . jsp . member . profil . profil jsp . jsp servic ( profil jsp . java : 481 ) org . apach . jasper . runtim . http jsp base . servic ( unknown sourc ) javax . servlet . http . http servlet . servic ( unknown sourc ) arrai index out bound except after set org . apach . jasper . runtim . bodi content impl . limit buffer = true

org . apach . catalina . startup . tomcat creat context add them host directli . would nice we could set name context befor ad host . i m includ patch overload method add webapp add context take name paramet . allow set context name through tomcat s embed class befor ad host

npe apr endpoint . java

hi , i am us jmeter test plan us jdbc request prepar statement queri type . when run thi i am get follow error jmeter . log file 2010 10 28 11 : 30 : 31 info jmeter . thread . jmeter thread : thread start : jdbc user 1 1 2010 10 28 12 : 13 : 38 error jmeter . thread . jmeter thread : error while process sampler prepar select custom jdbc request : java . lang . null pointer except org . apach . jmeter . protocol . jdbc . sampler . jdbcsampler . get string from result set ( jdbcsampler . java : 415 ) org . apach . jmeter . protocol . jdbc . sampler . jdbcsampler . result set string ( jdbcsampler . java : 268 ) org . apach . jmeter . protocol . jdbc . sampler . jdbcsampler . sampl ( jdbcsampler . java : 208 ) org . apach . jmeter . thread . jmeter thread . process sampler ( jmeter thread . java : 348 ) org . apach . jmeter . thread . jmeter thread . run ( jmeter thread . java : 243 ) java . lang . thread . run ( thread . java : 619 ) queri ( below ) can expect return number record select from custom where id = ; param set 1 i us instead select statement result ar return so queri itself fault . i have retriev code v2 4 tag identifi root caus npe creat patch . thi bug report includ patch against trunk issu also trunk . root caus due : org . apach . jmeter . protocol . jdbc . sampler . jdbcsampler . sampl ( entri e ) code path prepar statement type start line 204 ha call org . hsqldb . jdbc . jdbcprepar statement . execut updat ( ) which return result set . side effect call set jdbcprepar statement . current result set field member null . jdbcsampler doe keep result set refer . instead discard . call next line ( 208 ) string sb = result set string ( pstmt , true , null ) again tri get result set line 267 . thi caus null pointer except becaus jdbcprepar statement . current result set field wa set null earlier . look code path callabl statement type ( line 190 ) show better handl queri return result set . two line 207 , 208 replac boolean ha result set = pstmt . execut ( ) ; string sb = result set string ( pstmt , ha result set , null ) ; fix defect . regard , jeremi white red hat jdbcsampler discard result set from prepar statement .

when my web applic ha http session listen configur web . xml , class session creat ( ) call when user assign new session . howev , method also call when user authent itself session assign new id ( whether thi actual new session can disput , s point thi bug ) . when session remov ( due timeout , exampl ) , singl session destroi ( ) call execut . when http session listen manag some kind extern resourc , thi behaviour lead resourc leak , becaus session creat ( ) call twice , while session remov ( ) onli call onc i m awar reason chang session id ( somehow ) understand why session creat ( ) call again ( after all s new session id ) , must some wai session listen notifi old session longer exist . same behaviour seen tomcat 6 . 0 ( probabl 5 . 5 well , i didn t test ) . http session listen . session creat ( ) call second time when user authent match session destroi ( ) call .

access log written org . apach . catalina . valv . access log valv ar written servlet 3 . 0 async request . reproduc : handl request asynchron mark servlet web servlet ( async support = true ) send some traffic notic noth written access log . access log valv . log ( ) call org . apach . catalina . context . log access ( ) . from sourc version 7 . 0 . 11 , org . apach . catalina . connector . coyot adapt . java , line 416 : async context impl async con impl = ( async context impl ) request . get async context ( ) ; ( async con impl = null ) { async = true ; } els ( comet ) { respons . finish respons ( ) ; ( post pars success ) { log onli process wa invok . post pars request ( ) fail , ha alreadi log . ( ( context ) request . get map data ( ) . context ) . log access ( request , respons , system . current time milli ( ) req . get start time ( ) , fals ) ; } req . action ( action code . post request , null ) ; } async case log access ( ) isn t call here . i ve search through code don t see log access ( ) call anywher els , except error case . so , look like async case miss call log access ( ) somewher . access log servlet 3 . 0 async request

standard jar scanner ignor web fragment . xml file unpack jar thei ar end . jar

patch more specif error messag miss sslcertif file

patch ensur rethrown except retain origin caus

when connector stop , connect keep aliv state next request receiv connect process connect close . when request receiv , should reject . outstand question : what return code ( ani ) should sent back client read request start befor connector stop , should request allow complet should reject current keep aliv request process after connector . stop (

enhanc set secur provid within ajp apr processor

jsp compil initi class dure compil which can result failur

i fiddl around thi while have determin best my abil thi real bug . i have jndi datasourc connect postgresql server . i have two jndi resourc ( reader writer ) so later i can implement system replic etc deal write read differ connect . summar , after us system , ar two connect postgr get reus reader writer . under load , thi number increas slowli go back down . i usual end up two idl connect ( reader writer ) left under load . you reload context where datasourc ( s context specif datasourc ) , number connect jump two when us . each reload produc 2 more connect min until i restart server . appear after reload , persist connect get abandon orphan . eventu , i hit my max connect cannot aquir ani more system fail . i have tri abandond collect paramet have ad debug log my code ensur i am inde call close connect i checkout , even except error case . under normal useag without reload , connect leakag happen . thi solari 8 machin 4 . 1 . 27 hotfix 22096 . tar . gz appli . let me know more inform requir . i have thi develop environ can let somon attach jdb hammer thing sinc s product system help get repro . wayn reload context orphan current open jndi datasourc connect

stream handler factori can regist onc per vm tomcat regist dir context stream handler factori jndi protocol . howev ar web applic run insid want regist handler custom scheme current possibl . can dir context stream handler factori enhanc allow applic regist stream handler custom scheme thei might have . better can thi made properti context . xml file thi alreadi can thi enhanc futur enabl web applic regist own stream handler

null pointer except thrown authent base . regist method null princip

test pool async junit java . sql . sqlexcept : tomcat pool 10 wait : pool empti . unabl fetch connect , none avail 10 us . junit org . apach . tomcat . jdbc . pool . connect pool . borrow connect ( connect pool . java : 615 ) junit org . apach . tomcat . jdbc . pool . connect pool . get connect async ( connect pool . java : 143 ) junit org . apach . tomcat . jdbc . pool . data sourc proxi . get connect async ( data sourc proxi . java : 122 ) junit org . apach . tomcat . jdbc . test . fair test test thread . run ( fair test . java : 231 ) test failur window 7 , 24 thread system

org . apach . name . resourc . dir context urlconnect rais file found except line 311 , 344 , 382 396 . would more help provid messag string . exampl , chang line 344 throw new file found except ( get url ( ) . get file ( ) ) ; thi would make easier diagnos mistak server configur . unhelp file found except rais

failonerror boolean attribut manag ant task would nice have allow more flexibl oper within ant build file . i attach patch next week also fix unecessari cr dure respons read print miss url encod some task . failonerror attribut ant task

develop accident place tab charact after port number properti file tomcat instanc . thi prevent tomcat from listen port , wa difficult track down whether tomcat wa run . seem like properti file reader could easili trim excess whitespac befor try us entri . major error from minor whitespac error properti file

i think some valu return lifecycl state avail ( ) ar wrong . 1 . i am certain must destroi should return fals , becaus state later than stop . 2 . i think stop prep should return fals , becaus we can get from fail state . 3 . i think start should return fals , becaus too earli return true . result , follow complet list state ar return true avail ( ) : start , must stop lifecycl state avail ( ) more restrict

summari sai all . enter remind would good do thi . implement ssl renegoti nio connector

embed tomcat sometim throw thi except when call destroi ( ) method : java . lang . illeg argument except : null sourc java . util . event object . init ( event object . java : 56 ) javax . manag . notif . init ( notif . java : 184 ) org . apach . catalina . core . standard context . destroi intern ( standard context . java : 5433 ) org . apach . catalina . util . lifecycl base . destroi ( lifecycl base . java : 285 ) org . apach . catalina . core . contain base . remov child ( contain base . java : 969 ) org . apach . catalina . core . contain base . destroi intern ( contain base . java : 1108 ) org . apach . catalina . util . lifecycl base . destroi ( lifecycl base . java : 285 ) org . apach . catalina . core . contain base . remov child ( contain base . java : 969 ) org . apach . catalina . core . contain base . destroi intern ( contain base . java : 1108 ) org . apach . catalina . util . lifecycl base . destroi ( lifecycl base . java : 285 ) org . apach . catalina . core . standard servic . destroi intern ( standard servic . java : 593 ) org . apach . catalina . util . lifecycl base . destroi ( lifecycl base . java : 285 ) org . apach . catalina . core . standard server . destroi intern ( standard server . java : 786 ) org . apach . catalina . util . lifecycl base . destroi ( lifecycl base . java : 285 ) org . apach . catalina . startup . tomcat . destroi ( tomcat . java : 323 ) su . msk . jet . nioproxi . rule . config . embed webserv . stop ( embed webserv . java : 26 ) i think standard context . destroi intern ( ) miss check thi . get object name ( ) = null ( embed ) tomcat . destroi ( ) throw java . lang . illeg argument except

current role base attribut must fxed locat directori . simpl chang would allow role base specifi rel user dn . my enhanc suggest would chang role base definit follow : role base base entri role search . specifi , search base top level directori context . specifi mai option includ pattern replac { 0 } . . { n } corrospond name part user s distinguish name ( return javax . name . name . get ( ) ) . exampl , realm defint server . xml you could specifi role base : role base = ou = group , { 1 } , { 0 } major code accomplish thi would jndirealm . get role ( ) could look like thi : string base = null ; ( role base format = null ) { name parser np = context . get name parser ( ) ; name name = np . pars ( dn ) ; string name part = new string name . size ( ) ; ( int idx = 0 ; idx name . size ( ) ; idx ) name part idx = name . get ( idx ) ; base = role base format . format ( name part ) ; } perform configur search process result ( debug = 3 ) { log ( search role base base attribut role name ) ; log ( filter express filter ) ; } name enumer result = context . search ( base , filter , control ) ; thank you , art jndirealm role base pattern enahnc

appear jndirealm abl locat role , thei must anonym access . i believ secur purpos thi should necessari we ar valid user bind directori . case role could access ani bound user particular user . i discuss thi veri briefli tomcat user list . sound like thi had been discuss previous whatev reason , idea reject . anyhow i submit bug , either code which requir role anonym , document which doe make clear thi case ( least tomcat 4 servlet jsp contain realm configur how ) . seem reason me we ar bind directori authent , we would have user s access role . perhap document should more explicetli state thi case . hope would accept enhanc , i am go attempt attach modifi jndirealm us authent connect obtain role . thank you , art jndi authent role must anonym access

servlet ( probabl incorrectli ) close writer outputstream respons , attempt read from request , ajp connector send get bodi chunk mod jk worker . thi start seri veri confus commun between worker tomcat . worker doesn t read until make next request . after make next request , read , send respons 0 length . same time , tomcat respond request made worker anoth get bodi chunk , which worker also respond messag 0 length . realli weird thing happen , tomcat replai first request made worker . thi point , base what i m look tcpdump , i get too confus work out exactli what happen . ajp connector send get bodi chunk when read after respons close

deviat from servlet3 spec concern resourc lookup from meta inf resourc

hi , sorri my english . i us tomcat 7 . 0 . 6 apr 1 . 1 . 20 . i notic ( from heap dump ) mani org . apach . tomcat . util . net . socket wrapper object , which ar kept connect atribut org . apach . coyot . ajp . ajp apr protocol ajp connect handler object . i don t understand , why ar so mani object repres old connect which ar activ . my exampl wa 300000 object creat , after 7 dai tomcat work . ha someon forgotten clean thi hash map from time time best regard sergiusz brzezinski ajp connect handler keep mani connect caus memori leak

custom error page cdi weld problem

string . contain ( char sequenc ) resolv correctli follow situat : span class = { ( face context . extern context . request . request uri . contain ( item . url ) ) activepag : } { templat item . label kei } span except : javax . el . elexcept : face templat main layout . xhtml : java . lang . method except : java . lang . string . contain ( java . lang . string ) com . sun . face . facelet . compil . attribut instruct . write ( attribut instruct . java : 87 ) com . sun . face . facelet . compil . uiinstruct . encod begin ( uiinstruct . java : 75 ) com . sun . face . renderkit . html basic . html basic render . encod recurs ( html basic render . java : 285 ) com . sun . face . renderkit . html basic . output link render . encod children ( output link render . java : 125 ) javax . face . compon . uicompon base . encod children ( uicompon base . java : 848 ) javax . face . compon . uicompon . encod all ( uicompon . java : 1613 ) com . sun . face . facelet . compon . repeat render . encod children ( repeat render . java : 97 ) com . sun . face . facelet . compon . uirepeat . process ( uirepeat . java : 496 ) com . sun . face . facelet . compon . uirepeat . encod children ( uirepeat . java : 926 ) javax . face . compon . uicompon . encod all ( uicompon . java : 1613 ) javax . face . render . render . encod children ( render . java : 168 ) javax . face . compon . uicompon base . encod children ( uicompon base . java : 848 ) javax . face . compon . uicompon . encod all ( uicompon . java : 1613 ) javax . face . compon . uicompon . encod all ( uicompon . java : 1616 ) javax . face . compon . uicompon . encod all ( uicompon . java : 1616 ) com . sun . face . applic . view . facelet view handl strategi . render view ( facelet view handl strategi . java : 380 ) com . sun . face . applic . view . multi view handler . render view ( multi view handler . java : 126 ) com . ocpsoft . pretti . face . applic . pretti view handler . render view ( pretti view handler . java : 157 ) com . sun . face . lifecycl . render respons phase . execut ( render respons phase . java : 127 ) com . sun . face . lifecycl . phase . do phase ( phase . java : 101 ) com . sun . face . lifecycl . lifecycl impl . render ( lifecycl impl . java : 139 ) javax . face . webapp . face servlet . servic ( face servlet . java : 313 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 306 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) com . reardeninc . tigri . ui . facesutil . face filter . do filter ( face filter . java : 86 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 244 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . primefac . webapp . filter . file upload filter . do filter ( file upload filter . java : 79 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 244 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) com . ocpsoft . pretti . pretti filter . do filter ( pretti filter . java : 100 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 244 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 210 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 240 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 161 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 496 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 164 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 100 ) org . apach . catalina . valv . access log valv . invok ( access log valv . java : 541 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 118 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 383 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 243 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 188 ) org . apach . tomcat . util . net . jio endpoint socket processor . run ( jio endpoint . java : 288 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 680 ) caus : java . lang . method except : java . lang . string . contain ( java . lang . string ) java . lang . class . get method ( class . java : 1605 ) javax . el . bean elresolv . invok ( bean elresolv . java : 405 ) javax . el . composit elresolv . invok ( composit elresolv . java : 161 ) org . apach . el . parser . ast valu . get valu ( ast valu . java : 159 ) org . apach . el . parser . ast choic . get valu ( ast choic . java : 45 ) org . apach . el . valu express impl . get valu ( valu express impl . java : 189 ) com . sun . face . facelet . el . eltext eltext variabl . string ( eltext . java : 207 ) com . sun . face . facelet . compil . attribut instruct . write ( attribut instruct . java : 82 ) . . . 46 more el parser need more dynam

servlet request listen defin , when invok after call async context dispatch ( ) dispatch type return from servlet request request rather than async . when actual servlet invok , type correctli set async . listen intend invok each dispatch , dispatch type should match valu return filter servlet . invalid dispatch type servlet request listen async dispatch

role command doesn t work

context paramet ar overridden paramet from web applic deploy descriptor even through overrid attribut set fals exampl : line from context file context path = path doc base = path docbas cooki = true paramet name = paramet name valu = test1 overrid = fals . . . . context line from web . xml context param descript default valu paramet name descript param name paramet name param name param valu test2 param valu context param now servlet context . get init paramet ( paramet name ) return test2 context paramet ar overridden paramet from web applic deploy descriptor

http servlet request get auth type ( ) return null though request authent .

our jsp page ar compil build time . i turn gen string char arrai optim switch , some case longer line gener java code than javac compil can process . provid follow error messag : javac compil 1609 sourc file d : . . . jspc class javac d : . . . jspc src org apach jsp web 002d inf . . . 005f app page termscondit term condit 005fm 005f my jsp . java : 96 : constant string too long jasper can gener uncompil sourc code gen string char arrai turn

valid class name valid fail set last valid timestamp

jndirealm invok get attribut attribut id . prevent us domain { 0 } login .

s debug log messag embed . java typo : initi context factori alread set attach patch against 6 0 29 tag , issu exist tc6 . 0 . x trunk typo embed . java log messag

when us jsp map servlet web . xml , cyril charact ar allow web . xml

request util . urldecod ( ) throw illeg argument except url xx code last charact

pleas make class org . apach . catalina . core . applic context facad non final so can subclass . need extend applic context facad so mobic sip servlet , work top tomcat 7 , integr weld . thank georg make class org . apach . catalina . core . applic context facad non final

when stop tomcat us servic . msc , error messag displai : window could stop apach tomcat 7 servic local comput . error 109 : pipe ha been end . despit thi error , tomcat appear stop normal . problem wa encount 6 . 0 . 29 . error when stop tomcat us servic . msc

intern nio input buffer automat expand buffer while read request line , effect ignor max http header size set . intern nio input buffer should honor max http head size

updat tomcat us jre provid solut cve 2009 3555 avail

servlet 3 . 0 annot scan unpack war = fals

remov redund object instanti jsp runtim librari

npe tag file processor when tag file expand directori jar

version : tomcat 7 . 0 . 6 compon : catalina os : window 7 64bit overview : parallel deploy work like charm non cluster environ . when deploi version app ( appnam version . war ) farm deploy directori , seem filenam encod delimit translat correctli identifi war file file system : translat 23 23 reproduc : 1 . creat version app file 2 . deploi file watch farm deploy directori expect result : version app copyi cluster member deploi actual result : version app copyi cluster member . catalina . log displai follow error messag : contain background processor standard engin catalina info org . apach . catalina . ha . deploi . farm war deploy instal webapp shop 201101261 from c : apach tomcat7 cluster webapp shop 201101261 . war contain background processor standard engin catalina info org . apach . catalina . ha . deploi . farm war deploy cluster wide remov web app shop 201101261 contain background processor standard engin catalina error org . apach . catalina . ha . deploi . farm war deploy unabl instal war file java . io . file found except : c : apach tomcat7 cluster webapp shop 23 23201101261 . war ( da system kann die angegeben datei nicht finden ) java . io . file input stream . open ( nativ method ) java . io . file input stream . init ( file input stream . java : 106 ) org . apach . catalina . ha . deploi . file messag factori . init ( file messag factori . java : 152 ) org . apach . catalina . ha . deploi . file messag factori . get instanc ( file messag factori . java : 175 ) org . apach . catalina . ha . deploi . farm war deploy . instal ( farm war deploy . java : 372 ) org . apach . catalina . ha . deploi . farm war deploy . file modifi ( farm war deploy . java : 468 ) org . apach . catalina . ha . deploi . war watcher . check ( war watcher . java : 95 ) org . apach . catalina . ha . deploi . farm war deploy . background process ( farm war deploy . java : 591 ) org . apach . catalina . ha . tcp . simpl tcp cluster . background process ( simpl tcp cluster . java : 627 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1200 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1393 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1403 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1382 ) java . lang . thread . run ( thread . java : 662 ) contain background processor standard engin catalina info org . apach . catalina . startup . host config deploi web applic archiv shop 201101261 . war relev configur server . xml : . . . host name = sbwebapp1 app base = { catalina . base } cluster webapp unpack war = true auto deploi = true cluster class name = org . apach . catalina . ha . tcp . simpl tcp cluster channel send option = 8 manag class name = org . apach . catalina . ha . session . delta manag expir session shutdown = true notifi listen replic = fals state transfer timeout = 5 channel class name = org . apach . catalina . tribe . group . group channel membership class name = org . apach . catalina . tribe . membership . mcast servic address = 228 . 0 . 0 . 4 port = 45564 frequenc = 500 drop time = 3000 receiv class name = org . apach . catalina . tribe . transport . nio . nio receiv address = 192 . 168 . 222 . 220 port = 4000 auto bind = 100 selector timeout = 5000 max thread = 6 sender class name = org . apach . catalina . tribe . transport . replic transmitt transport class name = org . apach . catalina . tribe . transport . nio . pool parallel sender sender interceptor class name = org . apach . catalina . tribe . group . interceptor . tcp failur detector interceptor class name = org . apach . catalina . tribe . group . interceptor . messag interceptor class name = org . apach . catalina . tribe . group . interceptor . throughput interceptor channel valv class name = org . apach . catalina . ha . tcp . replic valv filter = . . gif ; . . js ; . . jpg ; . . png ; . . htm ; . . html ; . . css ; . . txt ; . . swf ; . . flv ; valv class name = org . apach . catalina . ha . session . jvm rout binder valv cluster listen class name = org . apach . catalina . ha . session . jvm rout session idbind listen cluster listen class name = org . apach . catalina . ha . session . cluster session listen deploy class name = org . apach . catalina . ha . deploi . farm war deploy temp dir = { catalina . base } cluster temp deploi dir = { catalina . base } cluster webapp watch dir = { catalina . base } cluster deploi watch enabl = true cluster access log process all exampl . document : doc config valv . html note : pattern us equival us pattern = common valv class name = org . apach . catalina . valv . access log valv directori = log prefix = ajp access suffix = . log pattern = h l u t quot ; r quot ; s b resolv host = fals host . . . farm deploy doesn t support parallel deploy

keep aliv protect doesn t work

tribe byte messag class us transfer byte payload context tribe commun framework . due how messag deseri , data loss ( henc corrupt ) messag size exce underli buffer size . solut replac object input read ( byte ) call object input read fulli ( byte ) . fix attach . tribe byte messag get corrupt messag size exce underli buffer size

latest tomcat code , i saw new thread creat listen start , filter start load startup . two method bind thread unbind thread mark privat , how about make those method protect so other contain could us those two method own initi work . thank . make bind thread unbind thread method protect

session relat error prevent clean recycl request respons object coyot adapt

error run cgi execut tomcat 6 . 0 . 30

when ( variou form ) evict run connect pool , connect pool . size goe neg . thi appear concurr problem . attach unit test illustr issu . connect pool . size corrupt when evict enabl :

redund null check befor instanceof equal (

sampl build . xml us wrong manag . url

class . new instanc call even when follow method servlet context . add filter method call : javax . servlet . filter registr . dynam add filter ( java . lang . string s , javax . servlet . filter filter ) ; thi lead instanti except runtim arg constructor filter ( past below ) . i ll suppli simpl patch fix issu me . sever : except start filter test filter java . lang . instanti except : test . test filter java . lang . class . new instance0 ( class . java : 340 ) java . lang . class . new instanc ( class . java : 308 ) org . apach . catalina . core . default instanc manag . new instanc ( default stanc manag . java : 119 ) org . apach . catalina . core . applic filter config . get filter ( applicatio n filter config . java : 252 ) org . apach . catalina . core . applic filter config . set filter def ( applica tion filter config . java : 372 ) org . apach . catalina . core . applic filter config . init ( applic fi lter config . java : 98 ) org . apach . catalina . core . standard context . filter start ( standard context . java : 4382 ) org . apach . catalina . core . standard context 2 . call ( standard context . java : 5040 ) org . apach . catalina . core . standard context 2 . call ( standard context . java : 5035 ) java . util . concurr . futur task sync . inner run ( futur task . java : 303 ) java . util . concurr . futur task . run ( futur task . java : 138 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 662 ) class . new instanc us dynam instanc filter caus instanti except

follow except wa report via work warn : except process cluster org . apach . catalina . ha . tcp . simpl tcp cluster 68e4e358 background process java . util . concurr modif except java . util . hash map hash iter . next entri ( hash map . java : 810 ) java . util . hash map entri iter . next ( hash map . java : 851 ) java . util . hash map entri iter . next ( hash map . java : 849 ) org . apach . catalina . ha . deploi . war watcher . check ( war watcher . java : 87 ) org . apach . catalina . ha . deploi . farm war deploy . background process ( farm war deploy . java : 609 ) org . apach . catalina . ha . tcp . simpl tcp cluster . background process ( simpl tcp cluster . java : 596 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1302 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1601 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1610 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1590 ) java . lang . thread . run ( thread . java : 636 ) root caus remov entri directli from map rather than from iter . i have patch i ll appli shortli . concurr modif except remov war via farm war deploy

small jsp do set content length ( us chunk encod ) access log valv configur

npe replic valv 7 . 0 . 6

implement org . apach . catalina . realm . memori rule set . begin dosen t valid attribut valu befor ad user memori realm . usernam name ar present null usernam us which can caus odd problem later . basic method should check paramet pass memori realm . add user ar null befor call method . memori user rule doesn t valid user attribut

i am us eclips do my develop i am run tomcat 4 . 1 . 24 from within eclips . nice featur eclips anyth you displai system . out come out blue anyth you send system . err displai red . howev when tomcat run catalina overrid system . err make point system . out . thi veri inconvini becaus much harder search sever error messag list million trivial . system . err get overriden output system . out

hi , jasper gener . java file ar compil . templat those file veri unaesthet . i could demonstr nice side effect us simpl page import = mypackag . jspfactori you should us full qualifi name instead bunch import stament . exampl jspx factori = jsp factori . get default factori ( ) ; would becom jspx factori = javax . servlet . jsp . jsp factori . get default factori ( ) ; you don t alreadi do , you should us thi refer where possibl . i don t know what spec sai about conflict , shouldn t bad idea us full qualifi name instead import . full qualifi name instead import

illeg argument except occur when set max activ smaller than 1 .

miss overrid annot

servlet can set header cooki after write data servlet s output stream . onc servlet write data , header ar commit . howev cooki exampl write some data first befor do add cooki respons . reason why thi code work all even abov bug : cooki exampl onli write small amount data befor do respons . add cooki . data still held buffer yet sent over wire . henc header ar yet commit . so pure luck thi exampl work . you can easili expos bug write sai 20k charact thi exampl befor respons . add cooki call . you see cooki ar ad respons ar actual sent back client . fix simpl . move up respons . add cooki ( ) befor respons . get writer ( ) cooki exampl set cooki after write data

ant task give null pointer except when error occur , mask true error

bad us get class ( ) could potenti lead concurr bug futur

you set 0 initi size , can t obtain connect us get connect async method .

abil configur datasourc server level have share amongst all applic server each applic suppli own credenti datasourc . thi type configur support dbcp call share datasourc configur . request share datasourc configur dbcp

prop find 404 error after mk col succ

apr , get remot host ( ) return null unknown client

neither chang session id messag nor session expir messag set timestamp . messag ar receiv dure cluster session synchron delta manag startup , becaus timestamp set , thei ar drop . i made patch add timestamp chang session id session expir messag . best regard . chang session id messag receiv dure cluster session synchron drop .

multipl x forward header handl remot ip valv

we ve been run tomcat 6 . 0 . 29 fc8 2 . 6 . 21 ten thousand long poll thread which usual work fine . everi few dai though we experi sudden lockup nio connector ha restart . have been seen accompani follow stack trace : except thread http 8082 client poller 0 java . lang . null pointer except org . apach . tomcat . util . net . nio endpoint poller . run ( nio endpoint . java : 1620 ) java . lang . thread . run ( thread . java : 662 ) look sourc seem issu like race condit where access ( ) call null attach , probabl while s process cancel : while ( iter = null iter . ha next ( ) ) { select kei sk = ( select kei ) iter . next ( ) ; kei attach attach = ( kei attach ) sk . attach ( ) ; npe attach . access ( ) ; iter . remov ( ) ; process kei ( sk , attach ) ; } while occasion nio connector lockup high load

jndirealm : support configur ldap size limit ( count limit search control )

accord el spec ch . 1 . 7 . 1 , b , b , b express when string contain . , e , e b big integ have evalu follow : coerc both b big decim appli oper actual implement though , instead coerc string big decim , doe two coercion : string doubl big decim , which produc differ result . reproduc , run follow jsp page : page context . set attribut ( , 1 . 1 ) ; page context . set attribut ( b , new java . math . big integ ( ) ) ; c us explicitli coerc argument big decim page context . set attribut ( c , new java . math . big decim ( 0 ) ) ; { b } br { ( c ) ( b c ) } br { b } br { ( c ) ( b c ) } br { b } br { ( c ) ( b c ) } actual result : . . 1 . . 9 . . 0 expect result : . 1 . 1 . 9 . 9 . 0 . 0 i think minor issu , though . thi reproduc current tc6 . 0 . x well . mayb o . . el . lang . elarithmet add ( object , object ) should deleg bigdecim instead doubl type argument . el evalu float point string valu vs big integ lose precis

get connect method class data sourc proxi ignor credenti

engin level cluster , name cluster manag host name context name . simpl tcp cluster get manag name ( string , manag ) follow . = = = = public string get manag name ( string name , manag manag ) { string cluster name = name ; ( cluster name = = null ) cluster name = manag . get contain ( ) . get name ( ) ; ( get contain ( ) instanceof engin ) { contain context = manag . get contain ( ) ; ( context = null context instanceof context ) { contain host = ( ( context ) context ) . get parent ( ) ; ( host = null host instanceof host cluster name = null ( cluster name . index ( ) = 0 ) ) cluster name = host . get name ( ) cluster name ; } } return cluster name ; } = = = = thi method , cluster name . index ( ) = 0 check . becaus context name becom context name version web applic ha version , name cluster manag doesn t becom format host name context name . result , engin level cluster doesn t work correctli . best regard . engin level cluster doe work correctli web applic ha version .

provid capabl declar request , respons , session other variabl jsp servic function final . tunabl featur , just like other , tomcat s web . xml file . why need thi featur us request , respons , session variabl anonym implement class . exampl declar iter through element , which includ some other jsp file ( static ) . usag thi iter other jsp file . final request , respons , session other variabl .

class name attribut includ realm tag server . xml , server di cryptic null pointer except . would nice produc more meaning error messag ( like miss class name attribut realm tag ) . realm without class name server . xml produc null pointer except

onc user authent princip object suppos cach durat user s session . thi especi import when us jdbcrealm jndirealm reduc load extern authent servic . most authent ( basic authent , sslauthent digest authent ) call authent base . regist ( ) cach princip . howev regist ( ) doe noth session object doe alreadi exist , so cach doe occur when applic doe creat session object itself . problem can seen set secur constraint tomcat doc brows tomcat document extern authent servic hit everi request . problem doe occur form base login , becaus form authent cach princip itself creat new session necessari do . probabl best fix would chang authent base . regist ( ) creat new session call get session ( request , true ) instead get session ( request , fals ) . howev , perhap reason why thi done though so i cannot see what . altern chang concret authent class make sure session exist befor call regist ( ) , e . g . basic authent . java 23 mar 2002 17 : 52 : 16 0000 1 . 12 basic authent . java 6 jul 2002 12 : 46 : 30 0000 160 , 6 160 , 7 string password = pars password ( author ) ; princip = context . get realm ( ) . authent ( usernam , password ) ; ( princip = null ) { session session = get session ( request , true ) ; regist ( request , respons , princip , constant . basic method , usernam , password ) ; return ( true ) ; similar patch would requir sslauthent digest authent cours . authent do alwai cach princip

two exampl us string ( ) byte arrai , which unlik produc desir output : ha . deploi . file messag factori . write messag ( ) log messag us string msg . get data ( ) which byte arrai coyot . ajp . ajp messag . dump us string msg which type byte string byte arrai probabl correct

first access jspx page caus classload leak jsp document parser

hi , when verifi fix 50360 i ran issu expir session dure process expir : dec 10 , 2010 12 : 59 : 32 am org . apach . catalina . core . contain base background process warn : except process manag de . javakaffe . web . msm . memcach backup session manag background process java . lang . illeg state except : get creation time : session alreadi invalid org . apach . catalina . session . standard session . get creation time ( standard session . java : 1096 ) org . apach . catalina . session . manag base . remov ( manag base . java : 802 ) org . apach . catalina . session . standard session . expir ( standard session . java : 840 ) org . apach . catalina . session . standard session . valid ( standard session . java : 655 ) org . apach . catalina . session . manag base . process expir ( manag base . java : 609 ) org . apach . catalina . session . manag base . background process ( manag base . java : 594 ) de . javakaffe . web . msm . memcach backup session manag . background process ( memcach backup session manag . java : 1130 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1214 ) afaic memcach backup session manag i could overrid remov ( session session , boolean updat ) call super . remov ( session , fals ) invalid session . anoth option would chang standard session . expir ( standard session . java : 840 ) so doe invok manag . remov ( thi , true ) manag . remov ( thi , fals ) . even better : chang manag base . remov ( manag base . java : 802 ) invok some session . get creation time intern ( ) which skip valid . what do you think cheer , martin standard session . expir caus illeg state except : get creation time : session alreadi invalid

consid follow exampl : dl c : each item = { page context . respons . header name } var = name c : each item = { page context . respons . get header ( name ) } var = valu dt { name } dt dd { valu } dd c : each c : each dl { name } string . { name . class . name } also prove . get header ( name ) call howev result : org . apach . jasper . el . jsp elexcept : test . jsp ( 23 , 12 ) { page context . respons . get header ( name ) } java . lang . method except : org . apach . catalina . connector . respons facad . get header ( java . lang . object ) anoth exampl which also result method except which suggest object been pass argument : c : set var = name valu = test { page context . respons . get header ( name ) } thi work all fine glassfish v3 . scope el variabl methodexpress treat object

provid option treat applic x www form urlencod encod paramet put request similar manner applic x www form urlencod paramet post request provid option pars applic x www form urlencod put request

embed . stop intern set state start , should stop

org . apach . catalina . ha . cluster messag base serializ ; consid declar serial version uid similarli : org . apach . catalina . ha . session . replic session org . apach . catalina . ha . session . serializ princip org . apach . catalina . session . standard session org . apach . catalina . tribe . tipi . abstract replic map . map messag org . apach . tomcat . util . model . manag bean miss serial version uid

memori leak protect doe detect leak trigger jsp page code

add miss setter getter abstract xxxprotocol

thi reproduc us default chat exampl ( ie : chat servlet , exampl jsp chat ) follow addit chang : 1 ) enabl http11nio conf server . xml : connector address = 0 . 0 . 0 . 0 port = 8080 protocol = org . apach . coyot . http11 . http11nio protocol connect timeout = 20000 enabl lookup = fals accept count = 100 disabl upload timeout = true max thread = 15 min spare thread = 15 max spare thread = 15 recycl facad = true 2 ) enabl comet valv conf context . xml : valv class name = org . apach . catalina . valv . comet connect manag valv problem comet event . event type . error ( subtyp timeout ) comet event . event type . end ar never fire . thi can confirm log ; messag event ar never print . thi work tomcat 6 . 0 . 29 . asid , what most complet robust wai do async io tomcat 7 todai , servlet 3 . 0 comet processor comet processor async timeout event ar fire

minor glitch displai neg ttl session detail . jsp

when dispatch ( ) method call insid timeout ( ) function async listen , except thrown : sever : except error occur contain dure request process java . lang . illeg state except : call dispatch async ( ) valid request async state time out org . apach . coyot . async state machin . async dispatch ( async state machin . java : 220 ) org . apach . coyot . http11 . http11nio processor . action intern ( http11nio processor . java : 672 ) org . apach . coyot . http11 . abstract http11processor . action ( abstract http11processor . java : 937 ) org . apach . coyot . request . action ( request . java : 348 ) org . apach . catalina . core . async context impl . dispatch ( async context impl . java : 173 ) org . apach . catalina . core . async context impl . dispatch ( async context impl . java : 135 ) org . apach . catalina . core . async context impl . dispatch ( async context impl . java : 130 ) com . jurii . snowbal . snow servlet 1 . timeout ( snow servlet . java : 23 ) org . apach . catalina . core . async listen wrapper . fire timeout ( async listen wrapper . java : 45 ) org . apach . catalina . core . async context impl . timeout ( async context impl . java : 109 ) org . apach . catalina . connector . coyot adapt . async dispatch ( coyot adapt . java : 270 ) org . apach . coyot . http11 . http11nio processor . async dispatch ( http11nio processor . java : 232 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . event ( http11nio protocol . java : 305 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 1526 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 619 ) sampl code below : protect void servic ( http servlet request request , http servlet respons respons ) throw servlet except , ioexcept { async context context = request . start async ( ) ; context . set timeout ( 3000 ) ; context . add listen ( new async listen ( ) { public void complet ( async event async event ) throw ioexcept { } public void timeout ( async event async event ) throw ioexcept { system . out . println ( hit timeout ) ; async event . get async context ( ) . dispatch ( ) ; } public void error ( async event async event ) throw ioexcept { } public void start async ( async event async event ) throw ioexcept { } } ) ; } look like servlet 3 . 0 specif allow do call , here s quotat explicitli state flow timeout async context ( page 18 ) : event asynchron oper time out , contain must run through follow step : invok async listen . timeout method all async listen instanc regist servlet request which asynchron oper wa initi . none listen call async context . complet ( ) ani async context . dispatch method , perform error dispatch statu code equal http servlet respons . sc intern server error . match error page wa found , error page did call async context . complet ( ) ani async context . dispatch method , contain must call async context . complet ( ) second step assum call dispatch timeout ( ) allow . call async context . dispatch ( ) timeout callback throw except

reproduc : 1 . login manag webapp 2 . click server statu complet server statu link . tc6 complet server statu page list servlet each deploi applic . current tc7 doe list them . onli summari inform each webapp displai . look statu manag servlet statu transform class , code iter over servlet still , probabl jmx name have chang ar work ani more . manag detail statu page doe displai servlet

javax . el . composit elresolv synchron issu

perform issu after revis 746425

recurs depend between tomcat catalina ha tomcat catalina

class cast except occur context . xml contain resourc link .

tribe bio sender schedul task excecutor

try regist wrapper welcom file mapper befor context regist mapper .

jre memori leak prevent listen intention invok method known pin context class loader memori order avoid have webapp class loader unintention pin itself . thi mai caus undesir behavior embed environ . instead , jmlpl could us secur context temporarili set current context class loader system class loader solv embed situat without client have rememb take thi care . jre memori leak prevent listen should specul caus memori leak us system class loader

rpc channel send answer without request ack

org . apach . catalina . session . store base ha hidden depend persist manag

while call method destori ( ) standard context directli , seem method destori intern ( ) call twice lifecycl mbean base , two stacktrac ar below : . lifecycl mbean base . unregist ( object name ) line : 191 lifecycl mbean base . destroi intern ( ) line : 73 contain base . destroi intern ( ) line : 1109 standard context . destroi intern ( ) line : 5114 lifecycl base . destroi ( ) line : 271 contain base . remov child ( contain ) line : 963 contain base . destroi intern ( ) line : 1106 standard context . destroi intern ( ) line : 5114 lifecycl base . destroi ( ) line : 271 . . . b . lifecycl mbean base . unregist ( object name ) line : 191 lifecycl mbean base . destroi intern ( ) line : 73 contain base . destroi intern ( ) line : 1109 standard context . destroi intern ( ) line : 5114 lifecycl base . destroi ( ) line : 271 . . . destori method call twice while child destori directli

possibl npe simpl tcpcluster

small enhanc file handler . java which allow suser disabl log rotat set . rotat attribut fals . add option disabl log rotat file handler .

lot mapper listen regist contain listen standard context

context config unnecessari null check

symptom : all processor thread spin madli : = = = = = = = = = = = = = = tomcat processor 20 daemon prio = 10 tid = 0x09210800 nid = 0x51fb runnabl 0x61b76000 java . lang . thread . state : runnabl java . util . hash map . get entri ( hash map . java : 347 ) java . util . hash map . contain kei ( hash map . java : 335 ) org . apach . catalina . secur . secur util . do privileg ( secur util . java : 227 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 230 ) org . apach . catalina . core . applic filter chain . access 000 ( applic filter chain . java : 56 ) org . apach . catalina . core . applic filter chain 1 . run ( applic filter chain . java : 189 ) java . secur . access control . do privileg ( nativ method ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 185 ) . . . = = = = = = = = = = = = = = caus : org . apach . catalina . secur . secur util . object cach hash map , access synchron . javadoc hash map sai : = = = = = = = = = = = = = note thi implement synchron . multipl thread access hash map concurr , least thread modifi map structur , must synchron extern . = = = = = = = = = = = = = propos solut : chang object cach concurr hash map ; lack synchron org . apach . catalina . secur . secur util

standard pipelin destroi two time .

violat jsp el spec version 2 . 1 when coerc enum string

manag app wrongli local

when metadata complet = fals add groovi all 1 . 7 . 2 . jar app lib throw java . lang . reflect . invoc target except sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 290 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 418 ) caus : java . lang . class format error : groovi jmx builder packag info : illeg jvm constant class name : groovi jmx builder packag info java . lang . class loader . defin class1 ( nativ method ) java . lang . class loader . defin class cond ( class loader . java : 632 ) java . lang . class loader . defin class ( class loader . java : 616 ) java . secur . secur class loader . defin class ( secur class loader . java : 141 ) org . apach . catalina . loader . webapp class loader . find class intern ( webapp class loader . java : 2804 ) org . apach . catalina . loader . webapp class loader . find class ( webapp class loader . java : 1144 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1639 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1517 ) org . apach . catalina . startup . context config . check handl type ( context config . java : 1952 ) org . apach . catalina . startup . context config . process annot stream ( context config . java : 1915 ) org . apach . catalina . startup . context config . process annot jar ( context config . java : 1802 ) org . apach . catalina . startup . context config . process annot url ( context config . java : 1761 ) org . apach . catalina . startup . context config . process annot ( context config . java : 1747 ) org . apach . catalina . startup . context config . web config ( context config . java : 1252 ) org . apach . catalina . startup . context config . configur start ( context config . java : 881 ) org . apach . catalina . startup . context config . lifecycl event ( context config . java : 315 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . util . lifecycl base . fire lifecycl event ( lifecycl base . java : 89 ) org . apach . catalina . core . standard context . start intern ( standard context . java : 4700 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 140 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1028 ) org . apach . catalina . core . standard host . start intern ( standard host . java : 773 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 140 ) org . apach . catalina . core . contain base . start intern ( contain base . java : 1028 ) org . apach . catalina . core . standard engin . start intern ( standard engin . java : 278 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 140 ) org . apach . catalina . core . standard servic . start intern ( standard servic . java : 429 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 140 ) org . apach . catalina . core . standard server . start intern ( standard server . java : 662 ) org . apach . catalina . util . lifecycl base . start ( lifecycl base . java : 140 ) org . apach . catalina . startup . catalina . start ( catalina . java : 592 ) . . . 6 more when metadata complet = fals throw illeg jvm constant class name

cannot compil recurs tag ant us class from webapp

latest trunck can t configur context when metadata complet true version 3 . 0

you deploi war contex . xml meta inf context . xml ha resourc tag , tomcat don t boot give thi error : java . lang . null pointer except org . apach . catalina . core . standard context . get object kei properti name onli ( standard context . java : 5570 ) org . apach . catalina . core . standard context . set name resourc ( standard context . java : 1757 ) org . apach . catalina . core . standard context . get name resourc ( standard context . java : 1735 ) org . apach . catalina . startup . set next name rule . end ( set next name rule . java : 99 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1058 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . end element ( abstract saxpars . java : 601 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 180 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1544 ) org . apach . catalina . startup . catalina . load ( catalina . java : 524 ) org . apach . catalina . startup . catalina . load ( catalina . java : 560 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . load ( bootstrap . java : 260 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 414 ) 29 09 2010 13 : 50 : 37 org . apach . catalina . startup . catalina load aviso : catalina . start us conf server . xml : java . lang . null pointer except org . apach . tomcat . util . digest . digest . creat saxexcept ( digest . java : 2688 ) org . apach . tomcat . util . digest . digest . creat saxexcept ( digest . java : 2714 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1061 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . end element ( abstract saxpars . java : 601 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 180 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1544 ) org . apach . catalina . startup . catalina . load ( catalina . java : 524 ) org . apach . catalina . startup . catalina . load ( catalina . java : 560 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . load ( bootstrap . java : 260 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 414 ) caus : java . lang . null pointer except org . apach . catalina . core . standard context . get object kei properti name onli ( standard context . java : 5570 ) org . apach . catalina . core . standard context . set name resourc ( standard context . java : 1757 ) org . apach . catalina . core . standard context . get name resourc ( standard context . java : 1735 ) org . apach . catalina . startup . set next name rule . end ( set next name rule . java : 99 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1058 ) . . . 20 more 29 09 2010 13 : 50 : 37 org . apach . tomcat . util . digest . set properti rule begin aviso : set properti rule { server servic engin host context } set properti sourc org . eclips . jst . jee . server : bestforkprim did find match properti . 29 09 2010 13 : 50 : 37 org . apach . tomcat . util . digest . digest end element grave : end event threw except java . lang . null pointer except org . apach . catalina . core . standard context . get object kei properti name onli ( standard context . java : 5570 ) org . apach . catalina . core . standard context . set name resourc ( standard context . java : 1757 ) org . apach . catalina . core . standard context . get name resourc ( standard context . java : 1735 ) org . apach . catalina . startup . set next name rule . end ( set next name rule . java : 99 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1058 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . end element ( abstract saxpars . java : 601 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 180 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1544 ) org . apach . catalina . startup . catalina . load ( catalina . java : 524 ) org . apach . catalina . startup . catalina . start ( catalina . java : 573 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 288 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 415 ) 29 09 2010 13 : 50 : 37 org . apach . catalina . startup . catalina load aviso : catalina . start us conf server . xml : java . lang . null pointer except org . apach . tomcat . util . digest . digest . creat saxexcept ( digest . java : 2688 ) org . apach . tomcat . util . digest . digest . creat saxexcept ( digest . java : 2714 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1061 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . end element ( abstract saxpars . java : 601 ) com . sun . org . apach . xerc . intern . parser . abstract xmldocument parser . empti element ( abstract xmldocument parser . java : 180 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan start element ( xmldocument fragment scanner impl . java : 1343 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl fragment content driver . next ( xmldocument fragment scanner impl . java : 2755 ) com . sun . org . apach . xerc . intern . impl . xmldocument scanner impl . next ( xmldocument scanner impl . java : 648 ) com . sun . org . apach . xerc . intern . impl . xmldocument fragment scanner impl . scan document ( xmldocument fragment scanner impl . java : 511 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 808 ) com . sun . org . apach . xerc . intern . parser . xml11configur . pars ( xml11configur . java : 737 ) com . sun . org . apach . xerc . intern . parser . xmlparser . pars ( xmlparser . java : 119 ) com . sun . org . apach . xerc . intern . parser . abstract saxpars . pars ( abstract saxpars . java : 1205 ) com . sun . org . apach . xerc . intern . jaxp . saxpars impl jaxpsaxpars . pars ( saxpars impl . java : 522 ) org . apach . tomcat . util . digest . digest . pars ( digest . java : 1544 ) org . apach . catalina . startup . catalina . load ( catalina . java : 524 ) org . apach . catalina . startup . catalina . start ( catalina . java : 573 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 288 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 415 ) caus : java . lang . null pointer except org . apach . catalina . core . standard context . get object kei properti name onli ( standard context . java : 5570 ) org . apach . catalina . core . standard context . set name resourc ( standard context . java : 1757 ) org . apach . catalina . core . standard context . get name resourc ( standard context . java : 1735 ) org . apach . catalina . startup . set next name rule . end ( set next name rule . java : 99 ) org . apach . tomcat . util . digest . digest . end element ( digest . java : 1058 ) . . . 20 more 29 09 2010 13 : 50 : 37 org . apach . catalina . startup . catalina start grave : cannot start server . server instanc configur . here my contex . xml ob : some valu were replac xxxx xml version = 1 . 0 encod = utf 8 context privileg = true reload = true watch resourc web inf web . xml watch resourc watch resourc meta inf context . xml watch resourc resourc name = jdbc bestfork auth = contain type = com . mchang . v2 . c3p0 . combo pool data sourc factori = org . apach . name . factori . bean factori user = xxx password = xxxx driver class = org . postgresql . driver jdbc url = jdbc : postgresql : localhost : 5432 xxxxx min pool size = 5 max pool size = 30 acquir increment = 5 idl connect test period = 100 max idl time = 30 resourc name = mail session auth = contain type = javax . mail . session mail . smtp . host = xxxx mail . smtp . auth = true usernam = xxx password = xxx mail . user = xxxx mail . password = xxxx mail . smtp . port = 587 mail . transport . protocol = smtp mail . debug = true realm class name = org . apach . catalina . realm . jdbcrealm driver name = org . postgresql . driver connect url = jdbc : postgresql : localhost : 5432 xxxx connect name = xxxx connect password = xxxx user tabl = usuario user name col = usuario cpf user cred col = usuario senha user role tabl = usuario papel role name col = papel nome digest = md5 context null pointer except context . xml present resourc

resourc ar serv from web inf lib { . jar } meta inf resourc metadata complet = true set web . xml

make privat immut field final

bad divis respons around user role new request login logout method

data race applic context

doubl check lock . possibl data race jsp servlet wrapper

doubl check idiom . possibl data race .

i found follow warn messag . = = oct 7 , 2010 2 : 25 : 27 pm org . apach . catalina . startup . set all properti rule begin warn : set all properti rule { server servic connector } set properti min spare thread 31 did find match properti . = = ajp connector s config ar follow . connector port = 8009 protocol = ajp 1 . 3 redirect port = 8443 min spare thread = 100 when i us http connector , min spare thread wa abl us . org . apach . coyot . ajp . ajp protocol doesn t set min spare thread org . apach . tomcat . util . net . jio endpoint . i made patch . thi patch wa made base abstract http11protocol . best regard . when ajp connector us , min spare thread cannot us .

resourc ( name = ) normal jndi name

servlet contain initi can t actual add listen

problem async listen resourc inject

lazi initi without ani synchron data race ast integ , ast float point , ast string

when o . . c . c . standard server store config call all except were get swallow . thi lead impresss wa work correctli when save either through manag applic manag save through jconsol . i ve remov catch throwabl block thrown except upon find registerd mbean . patch o . . c . c . standard server swallow error store config .

cluster , when us delta manag memori leak can occur

nio selector issu linux platform

log format rmi port can improv , remov ,

jdbc leak prevent class can regist unregist jcbc driver

when view either connector object thread pool object via jmx name executor shown . would help thi were expos via jmx so link between connector thread pool executor could determin . connector thread pool link executor expos via jmx

tomcat 6 , i often configur executor min spare thread = 0 work around memori leak issu upon redeploy . sometim ( especi develop ) , when i refresh page my webapp safari , chrome firefox , some resourc page take sever second ( 10 ) serv though thei ar static resourc should come less than 50m . instanc , over 15 request page ( 1 html , other resourc like js , css , imag . . . ) , i sometim have 1 2 take 10 . after analysi , i found org . apach . catalina . core . standard thread executor . task queue . offer ( runnabl ) statement ( parent . get activ count ( ) ( parent . get pool size ( ) ) ) sometim true unexpectedli . here scenario : thread pool executor empti user refresh page ( access empti cach ) hi web browser page us more than 10 15 resourc browser establish tcp connect new thread creat after browser receiv respons , decid load mani resourc possibl parallel . thi establish up 6 tcp connect ( my test ) acceptor thread call standard thread executor . execut process each incom connect . each call , standard thread executor . task queue . offer ( runnabl ) call you studi sourc java 6 thread pool executor , you can see s small delai between time new thread creat ( thu increas pool size ) time start work first task ( increas activ count ) sinc my case connect ar establish rapid burst , call task queue . offer ( ) ar sometim faster than thi small delai , so we do have parent . get activ count ( ) parent . get pool size ( ) thu task enqueu instead forc creation thread serv . sinc keep aliv enabl tomcat 6 thread take care onli tcp connect time , request queue must wait keep aliv timeout so thread return pool serv pend task . 25 keep aliv time out , mean some request take more than 25 serv eventhough pool wa never full server quit idl other fact about thi issu : although my test case start empti pool , can occur even load server . thing trigger issu burst new tcp connect . problem less sever lower keep aliv timeout , keepal disabl . ani case , also depend time taken serv current request . issu also affect tomcat 7 less sever becaus tc7 thread ar return pool after each http request , even tcp connect kept aliv . impact would same tc6 keep aliv disabl . race condit standard thread executor : request ar sometim enqueu instead creat new thread

o . . c . startup . bootstrap us o . . jasper . util . except util , thi class place bootstrap . jar , caus rather nasti failur anyth goe wrong dure initi bootstrap . thi should fairli simpl matter updat build . xml includ , i wasn t sure whether includ jasper class bootstrap wa done thing . s o . . tomcat . util . except util ident , too look like wrong thing grab . except util class miss from bootstrap . jar

javadoc correct

1 . instal tomcat servic window 2 . specifi server port = 1 server . xml 3 . start servic , stop servic . 4 . follow print catalina . 2010 04 27 . log : 27 . 04 . 2010 17 : 49 : 13 org . apach . catalina . startup . catalina stop server sever : shutdown port configur . shut down server through os signal . server shut down . just messag . tomcat stop regardless : after print messag catalina stop server ( ) perform system . exit ( 1 ) which result tomcat shutdown . i think when servic launcher stop tomcat , catalina server null . can us differenti two us case . could improv how stop tomcat . e . g . , call catalina . stop ( ) . case , would better us wait ( 10000 ) instead sleep ( 10000 ) standard server . await ( ) , so could woken notifi all ( ) call , us interrupt ( ) call wake up ( we know thread ) . system . exit ( 0 ) would work regardless all . i suppos jsvc mai show same behaviour , i have tri . us 1 shutdown port window servic work , print error messag

when file found error occur doe tell you which file caus error .

http requir vari respons header sent consist all respons thei chang base upon differ aspect request . my page ha both compress uncompress variant avail , negoti accept encod request header , send differ vari header each ; accept encod when respons compress , when . thi can caus problem downstream cach , becaus thei cannot consist determin what cach kei given uri . my server . xml content : servic name = catalina connector port = 8080 proxi port = 80 max http header size = 8192 protocol = org . apach . coyot . http11 . http11protocol max thread = 200 min spare thread = 25 max post size = 8 max spare thread = 75 enabl lookup = fals keep aliv timeout = 3000 max keep aliv request = 100 redirect port = 8443 accept count = 100 connect timeout = 8000 disabl upload timeout = true compress = compress min size = 2048 compress mime type = text html , text xml , text javascript , text css engin name = catalina default host = localhost host name = localhost app base = webapp unpack war = fals auto deploi = fals debug = 0 xml valid = fals xml namespac awar = fals host engin servic tomcat doesn t send vari consist when gzip enabl

when run tomcat secur manag , access control except thrown dure undeploy . stack trace : caus : java . secur . access control except : access deni ( java . lang . runtim permiss get class loader ) java . secur . access control context . check permiss ( access control context . java : 323 ) java . secur . access control . check permiss ( access control . java : 546 ) java . lang . secur manag . check permiss ( secur manag . java : 532 ) java . lang . class . get class loader ( class . java : 594 ) org . apach . catalina . loader . jdbc leak prevent . clear jdbc driver registr ( jdbc leak prevent . java : 49 ) i assum default catalina . polici should updat , take thi case account . access control except when undeploi applic

class coyot . ajp . constant contain 3 public static non empti string arrai : method tran arrai respons tran arrai header tran arrai respons tran arrai onli appear local , so could made privat . other ar us index lookup , so get ( index ) method could us protect them . coyot . ajp . constant 3 constant arrai ar mutabl

jstl 1 . 2 support

backup manag us , when primari node switch , delta session primari session chang true . non primari node chang primari node when primari node stop we get non primari session . primari node stop , primari node switch . abstract replic map , when primari node switch , map owner ( backup manag ) object made primai call . howev , primari session doe chang true thi method . = = = = = backup manag object made primai = = = = = public void object made primai ( object kei , object valu ) { ( valu = null valu instanceof delta session ) { delta session session = ( delta session ) valu ; synchron ( session ) { session . access ( ) ; session . end access ( ) ; } } } = = = = = we get non primari session , primari node switch . howev , primari session doe chang true . onli chang primari node . i made patch . contain follow . primari session set true backup manag object made primai . when get ( ) call non primari node , map owner object made primai call . best regard . when non primari node chang primari node , primari session chang true .

jmx descriptor modif

method base jndi env . inject work correctli . patch attach . see java ee 6 specif section , ee . 5 . 2 . 5 annot inject . patch provid solv problem . wrong jndi name method resourc inject

when us xaconnect mssql ha been notic physic connect ar close when data sourc proxi . close ( boolean all ) call . thi method invok org . apach . tomcat . jdbc . pool . pool connect . disconn ( ) which call connect . close ( ) . howev , when us sqlserver , connect attribut proxi object ( type com . microsoft . sqlserver . jdbc . sqlserver connect pool proxi ) which wrap physic connect ( type com . microsoft . sqlserver . jdbc . sqlserver connect ) . call close ( ) proxi object onli notifi pool manag connect releas back pool ; doe close underli physic connect . thi what pool connect . disconn ( ) implement current read : privat void disconnect ( boolean final ) { ( discard ( ) ) { return ; } set discard ( true ) ; ( connect = null ) { try { connect . close ( ) ; } catch ( except ignor ) { ( log . debug enabl ( ) ) { log . debug ( unabl close underli sql connect , ignor ) ; } } } connect = null ; xa connect = null ; last connect = 1 ; ( final ) parent . final ( thi ) ; } logic wa chang follow , would properli close xaconnect mssql . privat void disconnect ( boolean final ) { ( discard ( ) ) { return ; } set discard ( true ) ; ( connect = null ) { try { ( xa connect = null ) { xa connect . close ( ) ; } els { connect . close ( ) ; } } catch ( except ignor ) { ( log . debug enabl ( ) ) { log . debug ( unabl close underli sql connect , ignor ) ; } } } connect = null ; xa connect = null ; last connect = 1 ; ( final ) parent . final ( thi ) ; } issu close xaconnect mssql

java . lang . unsupport oper except : get name ( ) method should never call

shutdown ajp connector do work

explan : sever file have compil time gener relat warn displai org apach tomcat util bcel classfil . thi patch clean up sever those warn . correct gener relat compil warn org apach tomcat util bcel classfil file

constructor take parent class loader ha copi doc string from constructor doe take parent class loader . javadoc web app class loader constructor ha copi past error

extern string catalina . base catalina . home

sso cooki should made http onli default . org . apach . catalina . authent . authent base regist ( ) , 798 respons . add cooki ( cooki ) ; 798 respons . add cooki intern ( cooki , true ) ; sso cooki should ad http onli

patch allow gzip output filter send partial result when flush buffer ( ) call

i have two web applic ; neither declar realm context . xml both ar configur authent web . xml us standard tomcat authent method . i have enabl tomcat valv host have ad realm host well . host name = localhost app base = webapp unpack war = true auto deploi = true realm class name = org . apach . catalina . realm . jaasrealm app name = sso user class name = . b . c role class name = . b . c us context class loader = fals singl sign valv , share authent between web applic document : doc config valv . html valv class name = org . apach . catalina . authent . singl sign access log process all exampl . document : doc config valv . html valv class name = org . apach . catalina . valv . access log valv directori = log prefix = localhost access log . suffix = . txt pattern = common resolv host = fals i have ad jaa configur sso app jaa . conf file server . i am certain realm , jaa . conf ar all configur properli web applic do requir user authent befor access applic , i have authent applic i still am requir authent befor access other applic . i have thi exact same configur work tomcat 6 environ , ident configur oper tomcat 7 server . org . apach . catalina . authent . singl sign valv doe function

i put jsp file jar file test whether tomcat 7 support view from browser fail . fail access resourc jsp file from jar file which support servlet 3 . 0

jsp 2 . 2 new configur element default content type under jsp properti group work incorrectli tomcat trunk

method doe valid class name describ method document . valid classnam . per srv . 9 . 7 . 2 , we must restrict load class from j2se ( java . ) class servlet api ( javax . servlet . ) webapp class loader . valid ( name ) doe valid javax . servlet .

patch gener warn rawtyp

patch attach . thank correct some gener relat warn

even distribut set web . xml ( servlet3 . 0 ) , distribut chang from true fals annot process jar . context config process annot follow . = = = context config process annot protect void process annot ( set web xml fragment ) { ( web xml fragment : fragment ) { ( fragment . metadata complet ( ) ) { web xml annot = new web xml ( ) ; url url = fragment . get url ( ) ; process annot url ( url , annot ) ; set web xml set = new hash set web xml ( ) ; set . add ( annot ) ; merg annot fragment fragment take prioriti fragment . merg ( set ) ; } } } = = = distribut annot creat new web xml ( ) fals ( default ) . annot merg fragment , distribut fragment becom fals . becaus fragment merg web . xml web applic , even distribut set web . xml , distribut chang from true fals . follow ar necessari . annot . set distribut ( true ) ; best regard . annot process jar should impact distribut web . xml .

express factori impl . creat method express ( ) el 2 . 2 spec conform

100 session share across 4 node ( i . e . 25 activ session per node ) , delta manag report 100 current session per node ( 25 activ copi session from other node ) . back manag report 25 . consist should report 50 . 25 activ session plu 25 ( so ) ar back up node . backup manag report too few current session

request . get attribut name ( ) slow down some applic

when start new thread from start async runnabl , infinit amount do post gener

remov last refer remov configur paramet expir activ . fix expir filter doc ( remov remain expir activ refer )

propos : port mod expir java expir filter servlet filter

ha . session . simpl tcp replic manag . start intern ( ) ignor except when invok thread . sleep ( ) onli need ignor interrupt except . simpl tcp replic manag . start intern ( ) ignor except

catalina . loader . webapp class loader . start ( ) ignor except . howev , probabl onli need ignor secur except loader . webapp class loader . start ( ) ignor except

current configur ssi modul all none . all option expos all legaci apach ssi direct ( echo , printenv , , exec , . . . ) . document , allow ssi allow execut arbitrari program us exec . result , safe wai expos site project contain ssi direct , without take secur risk , review everi file . exec direct , cmd option major risk . even apach , you have option allow safe includ ( includ exec ) . includ exec allow page serv , even when content review , when user ar allow upload content site . i have big site which need convert jsp . i would like us ssi servlet allow transit over time . extra risk from ( from exec cmd ) make imposs deploi ssi . my request : modifi configur ssi follow : default , onli allow safe direct ( exec cmd = . . . ) . thi elimin risk from arbitrari execut command ( del . ) . also remov mani potentail load problem . cmd = should onli allow us direct like allow unsaf exec , which default fals . i think chang make easier us ssi featur , without expos server big risk . risk associ safer version ssi similar risk from run jsp page . ssi servlet should support safe configur

make string manag field final

add default char set filter add default charset each request . assum iso 8859 1 default charset . attach patch make configur introduc encod paramet . thi paramet can take two special valu default system . everi other valu interpret name charact set , e . g utf 8 . mean two special valu ar follow : default : us iso 8859 1 . thi valu also us , paramet wa specifi , empti system : jvm ask default charset . thi charset usual set system local . togeth thi function chang , ar two minor chang bigger chang hidden . first us annot overrid overriden method . second us keyword static respons wrapper , sinc ha refer outer class . third somewhat bigger chang us http servlet respons set charact encod ( encod ) instead manipul content type . add encod paramet add default char set filter

compress filter exampl should support http proxi cach gzip content better send vari : accept encod header

connector do bind port catalina . load ( ) , onli later start (

when set absolut path default context . xml , context config . context config ( ) cannot found

patch respons class fix space ( deprec ) = white space

context correctli stop shutdown

webapp deploi , access url return 200 ok content instead 404

environ : tomcat 7 . 0 . 0 beta ie8 simplest webapp onli have test . jsp below : = request . get session ( ) . get id ( ) thi app instal root context test . jsp work fine firefox when us ie8 alwai differ session id where refresh test page . btw : test . jsp work find tomcat 6 . x ie8 : unabl store data http session ( root context )

type except report messag descript server encount intern error ( ) prevent from fulfil thi request . except javax . servlet . servlet except : javax . manag . attribut found except : cannot find attribut start time org . apach . catalina . deploi . name resourc d1c778 org . apach . catalina . manag . statu manag servlet . do get ( statu manag servlet . java : 292 ) javax . servlet . http . http servlet . servic ( http servlet . java : 621 ) javax . servlet . http . http servlet . servic ( http servlet . java : 722 ) root caus javax . manag . attribut found except : cannot find attribut start time org . apach . catalina . deploi . name resourc d1c778 org . apach . tomcat . util . model . manag bean . get getter ( manag bean . java : 493 ) org . apach . tomcat . util . model . base model mbean . get attribut ( base model mbean . java : 180 ) com . sun . jmx . interceptor . default mbean server interceptor . get attribut ( default mbean server interceptor . java : 666 ) com . sun . jmx . mbeanserv . jmx mbean server . get attribut ( jmx mbean server . java : 638 ) org . apach . catalina . manag . statu transform . write context ( statu transform . java : 656 ) org . apach . catalina . manag . statu transform . write detail state ( statu transform . java : 590 ) org . apach . catalina . manag . statu manag servlet . do get ( statu manag servlet . java : 287 ) javax . servlet . http . http servlet . servic ( http servlet . java : 621 ) javax . servlet . http . http servlet . servic ( http servlet . java : 722 ) complet server statu ( statu all ) caus stack trace

cannot expir select session manag webapp

remot ip valv : remot ip header vs remot iphead

after r889716 , session id chang authent . ( default chang session id authent true . ) delta manag doesn t notifi other cluster node . therefor , non primari node keep have old session id . , can replic chang session attribut notifi new session id . workaround . . . overrid chang session id method , notifi chang session id . backup manag ok . thi problem delta manag onli . best regard . after session id chang authent , session replic doe work .

static info properti appear contain legaci packag . minor correct info properti .

memori leak protect : stop time thread should option disabl default

context class reload tomcat fail lifecycl except : invalid lifecycl transit wa attempt ( befor start ) compon org . apach . catalina . session . persist manag xxx state destroi context class reload fail persist manag

occur tomcat 7 . 0 rc3 6 . 0 . 26 us manag html : deploi war test page , should deploi properli stop webapp start webapp test page : failur : tomcat return 404 . note : us reload instead stop start s ok , doe fix unavail webapp present when tomcat start , stop start work normal work around undeploi webapp redeploi . webapp unavail after deploi stop start

servlet 3 . 0 ch . 7 . 1 . 1 sai custom cooki name affect url rewrit

us jar scanner scan all directori = true caus tomcat 7 start

javax . servlet . http . cooki . set domain ( string pattern ) ha follow code : domain = pattern . lower case ( ) ; result thi depend default local ; would safer us fix local , e . g . local . english . javax . servlet . http . cooki . set domain us default charset

i m us jdbc pool ( version 1 . 0 . 8 . 5 ) connect data sourc requir authent . unless i explicitli set usernam password pool properti object empti string ( oppos leav them null ) , null pointer except thrown line 215 216 pool connect . connect us driver ( ) . null pointer except pool connect when usernam password ar null

lower case ( ) upper case ( ) mai work ok all local

lower case ( ) upper case ( ) mai work ok all local

lower case ( ) upper case ( ) mai work ok all local

servlet contain initi startup ( set class >> class set expect class

context config . check handl type ( ) throw class def found error , which isn t caught , when class analys initialis class , class refer ( ) , present classpath . e . g . when mysql connector j jar ( v5 . x ) scan , attempt load follow class occur : com . mchang . v2 . c3p0 . queri connect tester java . lang . class def found error : com mchang v2 c3p0 queri connect tester java . lang . class loader . defin class1 ( nativ method ) java . lang . class loader . defin class ( class loader . java : 698 ) java . secur . secur class loader . defin class ( secur class loader . java : 124 ) java . net . urlclass loader . defin class ( urlclass loader . java : 260 ) java . net . urlclass loader . access 000 ( urlclass loader . java : 56 ) java . net . urlclass loader 1 . run ( urlclass loader . java : 195 ) java . secur . access control . do privileg ( nativ method ) java . net . urlclass loader . find class ( urlclass loader . java : 188 ) java . lang . class loader . load class ( class loader . java : 315 ) java . lang . class loader . load class ( class loader . java : 250 ) java . lang . class loader . load class intern ( class loader . java : 398 ) java . lang . class . name0 ( nativ method ) java . lang . class . name ( class . java : 247 ) also class . name us here , referenc webapp class loader , instead call webapp class loader . load class ( ) directli . error thrown dure detect servlet contain initi s

pool properti , default valu max idl integ . max valu default max activ 100 . thi result warn messag log valu max idl set match max activ line 393 394 connect pool . default max idl should match max activ . shouldn t see max idl max activ messag default prop

you call data sourc factori . pars pool properti ( ) method , pass properti object suspect timeout properti set , kei valu pair never pass pool properti . set suspect timeout ( ) method . data sourc factori . pars pool properti ( ) doesn t look suspect timeout

field org . apach . tomcat . util . introspect util . path separ should final . util . introspect util . path separ should final

when dynam ad filter name set when call method add map url pattern applic filter registr . java . java . lang . illeg argument except : filter map specifi unknown filter name null org . apach . catalina . core . standard context . valid filter map ( standard context . java : 2650 ) org . apach . catalina . core . standard context . add filter map befor ( standard context . java : 2622 ) org . apach . catalina . core . applic filter registr . add map url pattern ( applic filter registr . java : 102 ) org . pidster . tomcat . test7 . dyn . test dynam listen . context initi ( test dynam listen . java : 105 ) filter name set when dynam ad

when dynam ad filter context except thrown . java . lang . arrai index out bound except java . lang . system . arraycopi ( nativ method ) org . apach . catalina . core . standard context . add filter map befor ( standard context . java : 2629 ) org . apach . catalina . core . applic filter registr . add map servlet name ( applic filter registr . java : 75 ) index out bound except thrown when dynam ad filter

jasper can load tld file through servlet context from jar file . load tld from jar file , url jar file must pass . howev , some environ ( e . g . osgi ) might easi provid url jar file . would nice abstract wai jasper look up embed tld so differ wai look up tld within jar file bundl whatev could us . jar abstract jasper

ineffici us kei set ( ) iter standard context . java

incorrect lazi initi static field : org . apach . catalina . realm . realm base . md5helper org . apach . catalina . session . standard session . session context org . apach . catalina . startup . tld config . tld jar org . apach . catalina . util . extens valid . contain avail extens org . apach . tomcat . util . model . modul . mbean descriptor digest sourc . digest field should probabl all made volatil possibl incorrect lazi initialis

incorrect lazi initi updat static field : org . apach . catalina . startup . bootstrap . daemon org . apach . catalina . startup . context config . context digest findbug sai : thi method contain unsynchron lazi initi static field . after field set , object store locat further updat access . set field visibl other thread soon set . futher access method set field serv initi object , you have veri seriou multithread bug , unless someth els prevent ani other thread from access store object until fulli initi . even you feel confid method never call multipl thread , might better set static field until valu you ar set fulli popul initi . incorrect lazi initi updat static field

junit test ignor failur thread

avoid raw type warn tag support

transmiss duplic session delta manag handl get all session .

attach patch add boolean attribut prestartmin spare thread executor element . thi allow admin prestart minspar thread thi executor dure start tomcat . default valu fals which old behaviour . document patch executor . xml can creat interest commit thi patch . add prestartmin spare thread attribut executor

name . factori . send mail factori . get object instanc contain imposs cast from javax . mail . internet . mime messag javax . mail . internet . mime part findbug imposs cast name . factori . send mail factori . get object instanc

backup manag start intern , when constructor lazi replic map throw except , session lazi replic map . actual , abstract replic map init ha possibl throw runtim except . backup manag stop intern class cast except thrown becaus abstract replic map breakdown execut regardless type session . should chang follow avoid class cast except . = = = skip . ( session instanceof lazi replic map ) { lazi replic map map = ( lazi replic map ) session ; ( map = null ) { map . breakdown ( ) ; } } skip . = = = thi problem exist tomcat7 . 0 6 . 0 . best regard . class cast except backup manag stop intern .

backup manag stop intern follow . = = = = = protect synchron void stop intern ( ) throw lifecycl except { super . stop intern ( ) ; lazi replic map map = ( lazi replic map ) session ; ( map = null ) { map . breakdown ( ) ; } cluster . remov manag ( thi ) ; } = = = = = tomcat 7 . 0 . 0 rc1 , super stop intern ( ) call first . standard manag stop intern ( ) super class , session store , expir all activ session . store session unnecessari backup manag . when session expir , session delet from all cluster node . result , all primari session ( own node ha ) ar delet from all cluster node . instanc , node1 : session ( primari ) , session b ( proxi ) , session c ( backup ) node2 : session ( backup ) , session b ( primari ) , session c ( proxi ) node3 : session ( proxi ) , session b ( backup ) , session c ( primari ) node1 stop , becom follow . node1 : stop node2 : session b ( primari ) , session c ( backup ) node3 : session b ( backup ) , session c ( primari ) session expir . should follow . node1 : stop node2 : session ( primari ) , session b ( primari ) , session c ( backup ) node3 : session ( backup ) , session b ( backup ) , session c ( primari ) problem tomcat6 . 0 . x , becaus execut super . stop ( ) after lazi replic map breakdown ( ) . i made patch against trunk . best regard . all primari session ar delet backup manag stop intern .

findbug sai : thi method contain unsynchron lazi initi non volatil static field . becaus compil processor mai reorder instruct , thread ar guarante see complet initi object , method can call multipl thread . you can make field volatil correct problem . digest authent . md5helper possibl incorrect lazi initialis

ineffici us string concaten loop

findbug sai : bug : org . apach . jasper . runtim . jsp factori impl page context pool need static avoid deadli embrac org . apach . jasper . runtim . jsp factori impl . local pool pattern id : sic threadloc deadli embrac , type : sic , categori : correct thi class inner class , should probabl static inner class . , seriou danger deadli embrac between inner class thread local outer class . becaus inner class isn t static , retain refer outer class . thread local contain refer instanc inner class , inner outer instanc both reachabl elig garbag collect . runtim . jsp factori impl page context pool need static

catalina . realm . realm base . authent ( string usernam , byte credenti ) ha follow code : return ( authent ( usernam , credenti . string ( ) ) ) ; thi look wrong , credenti byte arrai . should probabl : return ( authent ( usernam , new string ( credenti , charset ) ) ) ; realm base . authent us string byte arrai

unus import

javadoc correct

fix up some raw type

miss annot

current mbean factori doesn t have method creat new standard servic mbean . thi would becom issu futur enhanc jmx support tomcat . per discuss mark , thi enhanc suggest start point possibl futur enhanc jmx support . jmx enhanc provis mbean factori creat standard servic

catalina . tribe . io . channel data . us secur random uuid mutabl public static field . s onli us instanc method , so s need static . probabl need public either ; could privat field setter better final field set constructor . channel data . us secur random uuid public static mutabl field

when session store standard manag do unload method , invalid session store . instanc , http session invalid execut while execut standard manag do unload , session valid = fals store . session valid = fals restor standard manag do load , regist session map ( session ) . howev , can invalid thi session . valid fals , standard session invalid ( ) standard session valid ( ) can expir session . thei ar throw illeg state except return immedi . consequ , session valid = fals never delet from session map ( session ) . i made patch . session alreadi invalid , expir session prevent memori leak . best regard . keiichi . memori leak http session .

addit javadoc servlet 3 . 0 annot

jasper . tagplugin . jstl . util . special charact represent mutabl public static arrai ; us outsid class far i can tell so should made privat util . special charact represent should privat

protect class user doesn t check argument role null

step reproduc : 1 . login tomcat manag applic 2 . select web applic ha sever session ar inact more than 2 minut 3 . text field next expir session button print 2 4 . press expir session 5 . sampl observ result : ok session inform applic context path myapp default maximum session inact interv 30 minut 1 minut : 16 session 1 2 minut : 2 session 2 3 minut : 5 session 3 4 minut : 1 session 4 5 minut : 2 session 5 6 minut : 1 session 6 7 minut : 2 session 9 10 minut : 1 session 8 minut : expir 0 session actual some session were expir ( even abov messag print 0 ) . expect result : all session idl time 2 minut had expir . bug follow line manag servlet session ( print writer , string , int ) : line 1176 1179 ( idl = 0 time = idl 60 ) { session i . expir ( ) ; idl ; } patch would replac idl expir , becaus idl time ( minut ) submit from web form expir counter . timeout argument misprocess when expir session from tomcat manag

blank page ( drop connect ) when run tc7 tcnativ ( apr )

add remot ip filter test case

enhanc remot ip valv remot ip filter log

i think memori leak protect web app class loader . clear refer thread local ( ) which detect clear thread local would prevent gc web app class loader instanc ha issu regard concurr : enumer thread look intern structur thread class , ar memori barrier would ensur consist state thread local map examin . so , theoret possibl thread local thread wa properli clean up applic , current thread b ( undeploi applic ) doe see up date state becaus s synchron between those thread . much more sever : after detect leak , invok java . lang . thread local . thread local map . remov ( thread local ) thread s thread local map instanc invoc done thread b ( thread undeploi app ) . remov ( ) method thread safe all , nor expung stale entri ( ) method which mai also invok clear thread local map ( ) . so , webapp undeploi while other applic continu receiv heavi load request , thi could corrupt intern structur thread local map instanc i propos keep detect leak , make actual clear option ( disabl default ) avoid encount big problem product . idea improv clear safe wai : thread provok leak tomcat s worker thread , we could mark dirti , have background task would end thread ( renew those thread pool ) . web app class loader . clear thread local map ( ) concurr issu

session listen call cluster node start

two part : 1 . log warn info messag tomcat ignor bundl context . xml favour catalina base engin name host name 2 . make extract copi context . xml configur , probabl via new attribut extract xml host context . xml expans deploy improv

cluster s regress . when replic fail onc , replic can never done again .

you know , jsp writer impl . write method wa alwai invok jsp file frequent . i found perform poor becaus too mani sub method were invok well . after copi two sub method s code write method , perform wa improv observ . improv jsp writer impl perform inlin sub method

tomcat break serv larg file ( = 1 . 8mb ) under high load high thread .

jsp compil context assum tagfil path start meta inf ar jar without check

jndirealm . java pars role correctli

seem bug least inconsist how tomcat handl error page . tomcat 6 . 0 . 20 , i defin my error page like thi web . xml : error page except type java . lang . except except type locat unexpect error . jsp locat error page , respons ha alreadi been commit , tomcat doe thi system consol : feb 1 , 2010 5 : 59 : 04 pm org . apach . catalina . core . standard wrapper valv invok sever : servlet . servic ( ) servlet jsp threw except java . lang . null pointer except org . apach . jsp . cpe jsp . jsp servic ( cpe jsp . java : 693 ) org . apach . jasper . runtim . http jsp base . servic ( http jsp base . java : 70 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 374 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 342 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 267 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . eaglecreektech . expedi . provis . web . servlet filter . auth filter . do filter ( auth filter . java : 133 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . eaglecreektech . expedi . provis . web . servlet filter . request volum filter . do filter ( request volum filter . java : 141 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) com . eaglecreektech . expedi . provis . web . servlet filter . startup check filter . do filter ( startup check filter . java : 65 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 233 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 191 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 128 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 293 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 849 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 583 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 454 ) java . lang . thread . run ( thread . java : 619 ) feb 1 , 2010 5 : 59 : 04 pm org . apach . catalina . core . standard host valv custom sever : except process error page except type = java . lang . except , locat = unexpect error . jsp java . lang . illeg state except : cannot reset buffer after respons ha been commit org . apach . catalina . connector . respons . reset buffer ( respons . java : 691 ) org . apach . catalina . core . standard host valv . custom ( standard host valv . java : 409 ) org . apach . catalina . core . standard host valv . throwabl ( standard host valv . java : 271 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 142 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 293 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 849 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 583 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 454 ) java . lang . thread . run ( thread . java : 619 ) doesn t put ani error text broken page page just show how ever far got befor encount error . thi behavior doesn t seem correct seem like should least behav same wai doe when error page defin jsp page : page error page = unexpect error . jsp respons ha alreadi been commit , just append error page onto end respons ( ideal , noth els can done , far i know ) respons ha been commit , clear buffer write error page ( which look nice pretti , like should ) i d suggest error handl code error page defin web . xml should check respons ha been commit , try clear buffer alreadi commit just append end , same wai jsp error handler doe . inconsist error page behavior

jsp servlet wrapper . get servlet context ( ) throw null pointer except

6 . 0 . 24 : access control except protect function mapper first access certain jsp

6 . 0 . 22rc : arrai index out bound except from jasper when compil error insid cdata block

when overrid default servlet given applic , global xslt file path need rel tomcat root . exampl : init param param name global xslt file param name param valu webapp quercu web inf list . xsl param valu init param would nice path could rel applic context . global xslt file paramet default servlet

comment out secur constraint comment out servlet tag add web xml map = true , jsp s servlet servlet map tag ar place incorrectli tomcat start due insid comment . basic , seem web . xml pars correctli when us add web xml map you cannot have abov tag comment out , new servlet tag place incorrectli comment tag respect . add web xml map doe place servlet tag correctli

directori contain file readabl tomcat process ( eg file permiss , dangl symlink ) tomcat throw null pointer except return 500 intern server error client . throw npe circumst certainli wrong . return 500 further inform unhelp behavior should fix . gener , interfac thi type least list inaccess file ( window explor , unix ls ( 1 ) , bsd ftp client , . . . ) onli return error when attempt access file . markt suggest altern simpli ignor inaccess file note could caus issu user tri upload file name suggest better error report . stack : sever : servlet . servic ( ) servlet webdav threw except java . lang . null pointer except org . apach . catalina . servlet . webdav servlet . pars properti ( unknown sourc ) org . apach . catalina . servlet . webdav servlet . do propfind ( unknown sourc ) org . apach . catalina . servlet . webdav servlet . servic ( unknown sourc ) javax . servlet . http . http servlet . servic ( unknown sourc ) . . . method pars properti ( ) java org apach catalina servlet webdav servlet . java . org npe happen when cach entri . attribut null ( case find properti my test possibl other case too ) . follow breadcrumb via : cach entri = resourc . lookup cach ( path ) ; lead eventu java org apach name resourc file dir context . java : public attribut get attribut ( string name , string attr id ) throw name except { build attribut list file file = file ( name ) ; ( file = = null ) throw new name except ( sm . get string ( resourc . found , name ) ) ; . . . protect file file ( string name ) { file file = new file ( base , name ) ; ( file . exist ( ) file . can read ( ) ) { . . . do us stuff } els { return null ; ouch } web dav servlet return 500 file readabl

deploi task throw out memori error when deploi larg war file

i have soak test constant load initi stabl . within hour , ever increas number block thread develop . vast major thread ar jsp render , block jsp factori . get default factori ( ) . server eventu crash . we ar run java 6 . upon code inspect , appear real reason synchron get default factori ( ) set default factori ( ) setter call onli onc upon startup when sub class load . patch jar , i tri three other experi : 1 ) remov synchron keyword entir . 2 ) lock inner static class instead jsp factori . class . 3 ) us volatil static member variabl . both experi 1 3 show vastli better stabil . i wa abl doubl throughput server without see increas number block thread . experi 2 yield same behavior origin code . thu , other code synchron jsp factori . class . rather , seem some sort content java . lang . class monitor . us volatil would preserv multi thread semant while avoid contribut instabl issu . unnecessari synchron jsp factori . get default factori contribut stabil problem

improv binari stream process webapp class loader find resourc intern

remot ip valv exampl refer connector packag

code save ( ) method read : try { fo = new file output stream ( file . get absolut path ( ) ) ; oo = new object output stream ( new buffer output stream ( fo ) ) ; } catch ( ioexcept e ) { ( oo = null ) { = = oo can onli null here try { oo . close ( ) ; } catch ( ioexcept f ) { ignor } } throw e ; } presum catch statement should try close fo instead similarli load ( ) method ; line 280 281 code : } catch ( ioexcept e ) { ( oi = null ) { howev , oi last object creat try claus , so must null . probabl code should check close bi fi . end load ( ) method , code sai : close input stream ( oi = null ) { howev , oi cannot null point . note : bug were detect eclips compil . catalina . session . file store . save ( ) load ( ) close ( ) bug

org . apach . catalina . startup . catalina incorrectli duplic super class member

string cach : us entri set ( ) rather than kei set ( ) get (

remot ip valv : request . secur request . scheme ar forc fals http x forward proto = http

remot ip filter : request . secur request . scheme ar forc fals http x forward proto = http

enc us implement public static string urldecod ( byte byte , string enc ) { return urldecod ( byte , null , fals ) ; } request util . urldecod ( byte byte , string enc )

null pointer except jndirealm

set header ( ) doe replac previou valu server

tomcat 6 juli log file which ar ( can ) declar webapp web inf class log . properti close , when webapp reload , stop even undeploi . file last close , when tomcat shut down restart . thi also true normal us handler org . apach . juli . file handler , which open new file everi dai close old . window thi ha follow effect : ) webapp undeploi file which ar open thi moment ar lock cannot delet until tomcat ( somedai ) stop restart . b ) webapp reload file open second time . so file ha two open handl . next dai file handler close handl file kept lock through other handl cannot delet . everi time webapp reload associ logfil open again ( close ) . thi ha consequ after reload webapp few time tomcat must restart from time time . when tomcat shutdown unnecessari ( other ) open file ar close get shutdown time modif time . mean ani old log file receiv current modif time , which irrit . step verifi window : ( exampl : undeploi ) 1 . creat exampl webapp : tomcat 6 . 0 . 20 : exampl web inf class log . properti : handler = org . apach . juli . file handler org . apach . juli . file handler . level = fine org . apach . juli . file handler . directori = { catalina . base } log org . apach . juli . file handler . prefix = servlet exampl . 2 . start tomcat 3 . undeploi exampl us manag actual result : file { catalina . base } log servlet exampl . date . log cannot delet ( nor next dai ) expect : file { catalina . base } log servlet exampl . date . log can delet veri cumbersom workaround ( work reload ) : get head method custom formatt extend track handler along classload webapp . webapp differ ( i . e . new ) classload detect close method handler assign old classload call . so assign file proper close ( formatt . get tail result append ) i have set sever minor becaus tomcat can us ( without webapp log ) . bug becaus thi log same logfil can useless multipl open ( describ abov ) , which should consid buggi . juli webapp log file close when webapp stop , reload undeploi

ar some properti file non uniqu properti kei ; normal should uniqu . file : java org apach catalina realm local string . properti duplic kei : jaa realm . user princip success jaa realm . user princip success = princip { 0 } valid user class . we us thi user princip . jaa realm . user princip success = subject usernam { 0 } return user princip { 1 } duplic kei : jaa realm . user princip failur jaa realm . user princip failur = valid user princip found jaa realm . user princip failur = subject usernam { 0 } did return valid user princip file : java org apach catalina realm local string es . properti duplic kei : jaa realm . user princip success jaa realm . user princip success = el princip { 0 } es una clase v u00e1lida de usuario . la vamo usar como usuario princip . jaa realm . user princip success = el asunto para el nombr de usuario { 0 } devolvi u00f3 usuario princip { 1 } duplic kei : jaa realm . user princip failur jaa realm . user princip failur = se ha hallado usuario princip jaa realm . user princip failur = el asunto para el nombr de usuario { 0 } devolvi u00f3 un usuario princip v u00e1lido file : java org apach catalina startup local string . properti duplic kei : context config . jndi url context config . jndi url = connect creat url { 0 } wa dir context urlconnect context config . jndi url = unabl process jndi url { 0 } annot duplic kei : web xml . merg conflict filter web xml . merg conflict filter = servlet { 0 } wa defin inconsist multipl fragment includ fragment name { 1 } locat { 2 } web xml . merg conflict filter = filter { 0 } wa defin inconsist multipl fragment includ fragment name { 1 } locat { 2 } file : java org apach jasper resourc local string . properti duplic kei : jsp . error . page . invalid . buffer jsp . error . page . invalid . buffer = page direct : invalid valu buffer jsp . error . page . invalid . buffer = page direct : invalid buffer size duplic kei : jsp . error . xml . invalid high surrog jsp . error . xml . invalid high surrog = high surrog bit utf 8 sequenc must exce 0x10 found 0x { 0 } . jsp . error . xml . invalid high surrog = high surrog bit utf 8 sequenc must exce 0x10 found 0x { 0 } . file : java org apach jasper resourc local string es . properti duplic kei : jsp . error . page . invalid . buffer jsp . error . page . invalid . buffer = directiva page : valor incorrecto para b u00faf jsp . error . page . invalid . buffer = directiva page : valor incorrecto para buffer duplic kei : jsp . error . xml . invalid high surrog jsp . error . xml . invalid high surrog = lo bit de surrogaci u00f3n alta en secuencai utf 8 deben de exced 0x10 pero se hall u00f3 0x { 0 } . jsp . error . xml . invalid high surrog = surrogaci u00f3n alta de bit en secuencia utf 8 debe de exced 0x10 , pero se hall u00f3 0x { 0 } . file : java org apach jasper resourc local string ja . properti duplic kei : jsp . error . page . invalid . buffer jsp . error . page . invalid . buffer = page u6307 u793a u5b50 : buffer u5c5 u6027 u306 u5024 u304c u7121 u52b9 u3067 u3059 jsp . error . page . invalid . buffer = page u6307 u793a u5b50 : u7121 u52b9 u306a u30d0 u30c3 u30d5 u30a1 u30b5 u30a4 u30ba u3067 u3059 duplic kei : jsp . error . xml . invalid high surrog jsp . error . xml . invalid high surrog = utf 8 u30b7 u30fc u30b1 u30f3 u30b9 u306 u30cf u30a4 u30b5 u30 u30b2 u30fc u30c8 u30d3 u30c3 u30c8 u306f0x10 u3092 u8d8a u3048 u3066 u306f u3044 u3051 u307 u305b u3093 u304c u30010x { 0 } u304c u898b u3064 u304b u308a u307 u3057 u305f jsp . error . xml . invalid high surrog = utf 8 u30b7 u30fc u30b1 u30f3 u30b9 u306 u30cf u30a4 u30b5 u30 u30b2 u30fc u30c8 u30d3 u30c3 u30c8 u306f0x10 u3092 u8d8a u3048 u3066 u306f u3044 u3051 u307 u305b u3093 u304c u30010x { 0 } u304c u898b u3064 u304b u308a u307 u3057 u305f file : java org apach tomcat util net re local string . properti duplic kei : endpoint . poll . fail endpoint . poll . fail = socket { 0 } poll event : { 1 } { 2 } endpoint . poll . fail = critic poller failur ( restart poller ) : { 0 } { 1 } file : java org apach tomcat util net re local string es . properti duplic kei : endpoint . poll . fail endpoint . poll . fail = conector { 0 } evento de encuesta : { 1 } { 2 } endpoint . poll . fail = fallo cr u00edtico de encuestador ( reiniciando encuestador ) : { 0 } { 1 } file : java org apach tomcat util net re local string . properti duplic kei : endpoint . poll . fail endpoint . poll . fail = socket { 0 } poll event : { 1 } { 2 } endpoint . poll . fail = critic poller failur ( restart poller ) : { 0 } { 1 } file : java org apach tomcat util net re local string es . properti duplic kei : endpoint . poll . fail endpoint . poll . fail = conector { 0 } evento de encuesta : { 1 } { 2 } endpoint . poll . fail = fallo cr u00edtico de encuestador ( reiniciando encuestador ) : { 0 } { 1 } duplic properti kei variou file

suppress warn ( uncheck ) document reduc scope

tomcat 6 . 0 . 20 someth like follow line jsp caus except : c : out valu = { fn : trim ( { world } ) } after remov close curli brace from liter ( { world } { world ) jsp work . thi behaviour seem specif 6 . 0 . 20 , 6 . 0 . 18 6 . 0 . 16 line abov work fine . exampl except : = = = = = = = = = = = = = = = = = = = = = org . apach . jasper . jasper except : except occur process jsp page test . jsp line 11 8 : meta http equiv = content type content = text html ; charset = utf 8 9 : head 10 : bodi 11 : c : out valu = { fn : trim ( { world } ) } 12 : bodi 13 : html stacktrac : org . apach . jasper . servlet . jsp servlet wrapper . handl jsp except ( jsp servlet wrapper . java : 505 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 416 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 342 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 267 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) root caus javax . el . elexcept : error pars : { fn : trim ( { world } org . apach . el . lang . express builder . creat node intern ( express builder . java : 125 ) org . apach . el . lang . express builder . build ( express builder . java : 150 ) org . apach . el . lang . express builder . creat valu express ( express builder . java : 194 ) org . apach . el . express factori impl . creat valu express ( express factori impl . java : 68 ) org . apach . jasper . runtim . page context impl . proprietari evalu ( page context impl . java : 934 ) org . apach . jsp . test jsp . jspx meth c 005fout 005f0 ( test jsp . java : 98 ) org . apach . jsp . test jsp . jsp servic ( test jsp . java : 72 ) org . apach . jasper . runtim . http jsp base . servic ( http jsp base . java : 70 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 374 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 342 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 267 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) root caus org . apach . el . parser . pars except : encount illeg charact line 1 , column 11 . wa expect : integ liter . . . float point liter . . . string liter . . . true . . . fals . . . null . . . ( . . . ) . . . . . . . . . empti . . . . . . identifi . . . org . apach . el . parser . elpars . gener pars except ( elpars . java : 2142 ) org . apach . el . parser . elpars . jj consum token ( elpars . java : 2024 ) org . apach . el . parser . elpars . function ( elpars . java : 1207 ) org . apach . el . parser . elpars . non liter ( elpars . java : 1114 ) org . apach . el . parser . elpars . valu prefix ( elpars . java : 1016 ) org . apach . el . parser . elpars . valu ( elpars . java : 965 ) org . apach . el . parser . elpars . unari ( elpars . java : 947 ) org . apach . el . parser . elpars . multipl ( elpars . java : 711 ) org . apach . el . parser . elpars . math ( elpars . java : 631 ) org . apach . el . parser . elpars . compar ( elpars . java : 443 ) org . apach . el . parser . elpars . equal ( elpars . java : 337 ) org . apach . el . parser . elpars . ( elpars . java : 281 ) org . apach . el . parser . elpars . ( elpars . java : 225 ) org . apach . el . parser . elpars . choic ( elpars . java : 182 ) org . apach . el . parser . elpars . express ( elpars . java : 174 ) org . apach . el . parser . elpars . dynam express ( elpars . java : 146 ) org . apach . el . parser . elpars . composit express ( elpars . java : 43 ) org . apach . el . lang . express builder . creat node intern ( express builder . java : 93 ) org . apach . el . lang . express builder . build ( express builder . java : 150 ) org . apach . el . lang . express builder . creat valu express ( express builder . java : 194 ) org . apach . el . express factori impl . creat valu express ( express factori impl . java : 68 ) org . apach . jasper . runtim . page context impl . proprietari evalu ( page context impl . java : 934 ) org . apach . jsp . test jsp . jspx meth c 005fout 005f0 ( test jsp . java : 98 ) org . apach . jsp . test jsp . jsp servic ( test jsp . java : 72 ) org . apach . jasper . runtim . http jsp base . servic ( http jsp base . java : 70 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 374 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 342 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 267 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) close curli brace liter string incorrectli treat express termin .

current , connector mbean , thei ar regist unregist connector class themselv . server lifecycl mbean util , ar also code unregist connector mbean . suppos us doubl check question code creat connector object name ar same , mbean util , alwai assum address properti string type , sometim class cast except would thrown . keep same logic creat objectnam connector mbean

implement header x power suggest servlet specif

support latest jsr245 propos make el self contain

i am encount problem session doe time out shorter than set web . xml . thi simpl scenario where problem occur . i am us persist manag follow configur . context manag class name = org . apach . catalina . session . persist manag max idl swap = 120 store class name = org . apach . catalina . session . file store manag context i am set session timeout five minut . session config session timeout 5 session timeout session config scenario 1 . creat session . 2 . 120 second pass . session doe swap out . 3 . addit , 120 second pass . get session . session doe swap access time session memori updat . 4 . addit , 90 second pass . get session . becaus access time session ha been updat ( 3 ) , session should abl acquir . howev , session can acquir . thi caus store base process expir invok between ( 3 ) ( 4 ) . store base process expir delet session save store . store base process expir follow . = = = = = store base process expir = = = = = public void process expir ( ) { . . . ( int i = 0 ; i kei . length ; i ) { try { standard session session = ( standard session ) load ( kei i ) ; ( session = = null ) { continu ; } ( session . valid ( ) ) { continu ; } . . . ( ( ( persist manag base ) manag ) . load ( kei i ) ) { recycl old backup session session . recycl ( ) ; } els { expir swap out session session . expir ( ) ; } remov ( session . get id intern ( ) ) ; } catch ( except e ) { . . . } } } = = = = = = session save store load , standard session valid ( ) execut . standard session expir ( true ) invok session pass session time out standard session valid ( ) . standard session expir ( true ) invok manag remov ( session ) . result , session delet from session map . word , session memori delet invalid old session store . result , session doe time out shorter than set web . xml i made patch against trunk . best regard . session doe time out shorter than set web . xml when persist manag us .

bad file descriptor ioexcept cgiservlet some program

when context path empti , tomcat startup file found except

lock field should final

persist manag ( us filestor ) can return differ session object link same session id , when tomcat restart

make remot ip filter paramet consist remot ip valv

memori leak when us ssl java secur manag

when tomcat receiv post request session ha timedout , forward form base login page ( form login page ) . thi forward fail some reason ( error login page instanc ) , tomcat return empti http respons , without ani error code . tomcat log sai unexpect error forward login page contain detail stacktrac , i would expect error show up browser well ( least 500 statu ) empti respons when forward login page fail

when call get client method , except : java . lang . arrai store except : java . util . hash map entri mayb thi method should : public list client get client ( ) { return java . util . arrai . list ( client . valu ( ) . arrai ( new client 0 ) ) ; } instead thi : public list client get client ( ) { return java . util . arrai . list ( client . entri set ( ) . arrai ( new client 0 ) ) ; } can get client from tomcat bayeux

log us org . apach . tomcat . bayeux . request . publish request , wa defin , so class can compli successfulli , should someth like thi privat static final log log = log factori . get log ( publish request . class ) ; publish request . java can compil

javadoc fix connector . request . java

cluster fail serial javax . secur . auth . subject . see stack below . i look littl tomcat code . . java org apach catalina connector request . java line 1752 tomcat put javax . secur . auth . subject session you us securitymanag . thi memori user my case i think . i must us securitymanag becaus i us rmi . solut possibl make memori user serializ put session attribut . mark thoma markt apach dot org suggest note session tomcat user mailinglist . i ve never seen note session . memori user come from secur constraint my web . xml . jul 8 , 2009 5 : 53 : 52 pm org . apach . catalina . ha . session . delta session write object sever : cannot serial session attribut javax . secur . auth . subject session java . io . serializ except : org . apach . catalina . user . memori user java . io . object output stream . write object0 ( object output stream . java : 1156 ) java . io . object output stream . write object ( object output stream . java : 326 ) java . util . link list . write object ( link list . java : 943 ) sun . reflect . gener method accessor216 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) java . io . object stream class . invok write object ( object stream class . java : 945 ) java . io . object output stream . write serial data ( object output stream . java : 1461 ) java . io . object output stream . write ordinari object ( object output stream . java : 1392 ) java . io . object output stream . write object0 ( object output stream . java : 1150 ) java . io . object output stream . access 300 ( object output stream . java : 143 ) java . io . object output stream put field impl . write field ( object output stream . java : 1668 ) java . io . object output stream . write field ( object output stream . java : 454 ) javax . secur . auth . subject secur set . write object ( subject . java : 1281 ) sun . reflect . gener method accessor215 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) java . io . object stream class . invok write object ( object stream class . java : 945 ) java . io . object output stream . write serial data ( object output stream . java : 1461 ) java . io . object output stream . write ordinari object ( object output stream . java : 1392 ) java . io . object output stream . write object0 ( object output stream . java : 1150 ) java . io . object output stream . default write field ( object output stream . java : 1509 ) java . io . object output stream . default write object ( object output stream . java : 416 ) java . util . collect synchron collect . write object ( collect . java : 1602 ) sun . reflect . gener method accessor214 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) java . io . object stream class . invok write object ( object stream class . java : 945 ) java . io . object output stream . write serial data ( object output stream . java : 1461 ) java . io . object output stream . write ordinari object ( object output stream . java : 1392 ) java . io . object output stream . write object0 ( object output stream . java : 1150 ) java . io . object output stream . default write field ( object output stream . java : 1509 ) java . io . object output stream . default write object ( object output stream . java : 416 ) javax . secur . auth . subject . write object ( subject . java : 919 ) sun . reflect . gener method accessor213 . invok ( unknown sourc ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) java . io . object stream class . invok write object ( object stream class . java : 945 ) java . io . object output stream . write serial data ( object output stream . java : 1461 ) java . io . object output stream . write ordinari object ( object output stream . java : 1392 ) java . io . object output stream . write object0 ( object output stream . java : 1150 ) java . io . object output stream . write object ( object output stream . java : 326 ) org . apach . catalina . ha . session . delta session . write object ( delta session . java : 714 ) org . apach . catalina . ha . session . delta session . write object data ( delta session . java : 475 ) org . apach . catalina . ha . session . delta session . write object data ( delta session . java : 472 ) org . apach . catalina . ha . session . delta manag . serial session ( delta manag . java : 733 ) org . apach . catalina . ha . session . delta manag . send session ( delta manag . java : 1513 ) org . apach . catalina . ha . session . delta manag . handl get all session ( delta manag . java : 1479 ) org . apach . catalina . ha . session . delta manag . messag receiv ( delta manag . java : 1310 ) org . apach . catalina . ha . session . delta manag . messag data receiv ( delta manag . java : 1093 ) org . apach . catalina . ha . session . cluster session listen . messag receiv ( cluster session listen . java : 87 ) org . apach . catalina . ha . tcp . simpl tcp cluster . messag receiv ( simpl tcp cluster . java : 901 ) org . apach . catalina . ha . tcp . simpl tcp cluster . messag receiv ( simpl tcp cluster . java : 882 ) org . apach . catalina . tribe . group . group channel . messag receiv ( group channel . java : 269 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . interceptor . tcp failur detector . messag receiv ( tcp failur detector . java : 110 ) org . apach . catalina . tribe . group . channel interceptor base . messag receiv ( channel interceptor base . java : 79 ) org . apach . catalina . tribe . group . channel coordin . messag receiv ( channel coordin . java : 241 ) org . apach . catalina . tribe . transport . receiv base . messag data receiv ( receiv base . java : 225 ) org . apach . catalina . tribe . transport . nio . nio replic task . drain channel ( nio replic task . java : 188 ) org . apach . catalina . tribe . transport . nio . nio replic task . run ( nio replic task . java : 91 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 619 ) cluster fail serial javax . secur . auth . subject

gener fix

replic context start throw null pointer except .

el support javadoc gener fix

patch fix gener javax . el packag helper

applic context facad gener fix

catalina . core . applic filter factori . match dispatch ( filter map filter map , dispatch type type ) fail check type = = async extra case ought ad ( i don t know what should contain , so cannot provid patch ) applic filter factori . match dispatch ( ) fail check async

possibl npe org . apach . tomcat . util . model . registri

patch fix gener javax packag

patch fix gener catalina

tld config keep intern list applic listen

hex util expos public arrai

org . apach . catalina . tribe . group . interceptor . messag dispatch interceptor . run should volatil , us commun between run thread . tribe . group . interceptor . messag dispatch interceptor . run should volatil

org . apach . tomcat . util . net . nio block selector . block poller . run should volatil , us commun between run thread . org . apach . tomcat . util . net . nio block selector . block poller . run = volatil

below origin implement destroi subcontext ( name name ) method : public void destroi subcontext ( name name ) throw name except { check writabl ( ) ; while ( ( name . empti ( ) ) ( name . get ( 0 ) . length ( ) = = 0 ) ) name = name . get suffix ( 1 ) ; ( name . empti ( ) ) throw new name except ( sm . get string ( name context . invalid name ) ) ; name entri entri = ( name entri ) bind . get ( name . get ( 0 ) ) ; ( entri = = null ) { throw new name found except ( sm . get string ( name context . name bound , name . get ( 0 ) ) ) ; } ( name . size ( ) 1 ) { ( entri . type = = name entri . context ) { ( ( context ) entri . valu ) . unbind ( name . get suffix ( 1 ) ) ; } els { throw new name except ( sm . get string ( name context . context expect ) ) ; } } els { ( entri . type = = name entri . context ) { ( ( context ) entri . valu ) . close ( ) ; bind . remov ( name . get ( 0 ) ) ; } els { throw new context except ( sm . get string ( name context . context expect ) ) ; } } } howev , method invok unbind method rather than invok itself recurs . ( name . size ( ) 1 ) { ( entri . type = = name entri . context ) { ( ( context ) entri . valu ) . unbind ( name . get suffix ( 1 ) ) ; } els { throw new name except ( sm . get string ( name context . context expect ) ) ; } should : ( name . size ( ) 1 ) { ( entri . type = = name entri . context ) { ( ( context ) entri . valu ) . destroi subcontext ( name . get suffix ( 1 ) ) ; } els { throw new name except ( sm . get string ( name context . context expect ) ) ; } org . apach . name . name context s destroi subcontext ( ) method doesn t invok itself recurs , invok unbind ( ) method

domain doe work membership domain filter interceptor .

annot doesn t becom effect . ( metadata complet = fals effect .

name context listen fail add itself properti chang listen all name resourc

oper system where dev urandom exist , org . apach . catalina . session . manag base us sourc data get random byte ( ) . you stop context undeploi host , number file descriptor have dev urandom open tomcat remain constant . exampl , you us manag applic stop undeploi context , number file descriptor dev urandom same befor stop . file descriptor us determin us lsof examin proc pid fd directori linux . same issu seen you undeploi virtual host . you undeploi deploi context , remov add virtual host , file descriptor dev urandom increas each time . thi becaus manag base doe close data input stream hold dev urandom . patch shown below resolv thi issu . stop context , undeploi virtual host close session manag s refer dev urandom . apach tomcat 5 . 5 . 28 src contain catalina src share org apach catalina session manag base . java 2009 07 24 13 : 35 : 00 . 000000000 0600 apach tomcat 5 . 5 . 28 gl contain catalina src share org apach catalina session manag base . java 2009 08 20 13 : 38 : 03 . 000000000 0600 688 , 10 688 , 17 } public void destroi ( ) { ( onam = null ) registri . get registri ( null , null ) . unregist compon ( onam ) ; ( random = null ) { try { random . close ( ) ; } catch ( ioexcept ioe ) { } random = null ; } initi = fals ; onam = null ; don t clear log sinc requir case attribut ar chang ( eg via jmx ) whilst manag stop . } manag base leak fd dev urandom when context stop

notic onli when run debugg breakpoint set stack overflow error . error translat java s reflect mechan invoc target except , which caught silent ignor introspect util . connector . initi ( ) set jk home properti http11nio protocol . http11nio protocol set jk home properti nio endpoint . nio endpoint recurs invok own set properti method via introspect util . set properti , caus stack overflow . us embed tomcat . us nio connector . doe happen standard connector . happen 6 . 0 . 18 6 . 0 . 20 ; haven t test earlier version . stack overflow error nio endpoint . set properti when set jk home

org . apach . catalina . core . contain base . get logger ( ) synchronis , yet all other method which access org . apach . catalina . core . contain base . logger ar synch . thi seem wrong . org . apach . catalina . core . contain base . logger should probabl privat prevent unsynch . access subclass . similar consider appli log name log name ( ) javadoc get logger ( ) state can return null doe appear possibl . sure method ever return parent logger either . org . apach . catalina . core . contain base . get logger ( ) thread safe

jsp runtim context . jsp reload count synchronis when updat , when read get jsp reload count ( ) . instanc access from multipl thread , return valu mai current valu , could arbitrarili stale . thi accept , javadoc should sai so ; otherwis getter need synch . ( field need volatil ) just us atom integ . = = variou other field ar neither final nor synchron , e . g . classpath code sourc etc . far i can tell , could easili made final thei ar onli written constructor . jsp runtim context synch . problem .

xbyte buffer : privat public field ; fix javadoc

unus import

logger should final

public arrai should privat

field should final

logger should final

org . apach . tomcat . jni . address . apr anyaddr should final org . apach . tomcat . jni . address . apr anyaddr should final

org . apach . catalina . tribe . io . channel data . empti data arrai should final org . apach . catalina . tribe . io . channel data . empti data arrai should final

java file don t have al header

some misspel i found javax . servlet packag

some misspel i found org . apach . coyot packag org . apach . el packag

some misspel i found org . apach . jasper packag org . apach . juli packag

some misspel i can find org . apach . name packag

some misspel i can find org . apach . tomcat packag

javadoc fix

tomcat javadoc unthrown except fix

some misspel i can find org . apach . catalina packag

servic ref factori class perform imposs null check servic interfac class line 238 : 237 : class servic interfac = servic interfac class . get interfac ( ) ; 238 : ( servic interfac class = null ) { were null , line 237 would gener npe . servic ref factori : imposs null check servic interfac class

misspel javadoc comment variou class packag org . apach . core

add deprec annot deprec element

. 1 line : 99 construct instanc thi code rule set code default match pattern prefix default fargment set . public web rule set ( ) { fragment wa misspel fargment . 2 line : 614 rule check code login config code occur onli 1 time within web . xml final class set login config extend rule { occur wa misspel occur . 3 line 635 rule check code jsp config code occur onli 1 time within web . xml final class set jsp config extend rule { occur wa misspel occur . 4 line 656 rule check code session config code occur onli 1 time within web . xml final class set session config extend rule { occur wa misspel occur 4 misspel javadoc class org . apach . catalina . startup . web rule set

. 1 line 194 : attribut valu us turn off tld namespac awaren . privat boolean tld namespac awar = fals ; awar wa misspel awaren . 2 line 261 get server . xml lt ; host gt ; attribut s xml namespac awar . return true namespac awaren enabl . public boolean get tld namespac awar ( ) { return thi . tld namespac awar ; } awar wa misspel awaren 2 misspel javadoc class org . apach . catalina . startup . tld config

line 50 : construct set next rule specifi method name . param method name method name parent method call param param type java class parent method s argument ( you wish us primit type , specifi corresond java wrapper class instead , code java . lang . boolean code code boolean code paramet ) public set next name rule ( string method name , string param type ) { correspond wa misspel corresond misspel javadoc class org . apach . catalina . startup . set next name rule

protect synchron void stop ( ) : ( line : 1059 ) remov sercur role secur misspel sercur protect input sourc get web xml sourc ( string filenam , string path ) : ( line : 1354 ) param filenam name file ( possibl more lead path segemnt ) read param path locat filenam rel return segment misspel segemnt . two misspel javadoc class org . apach . catalina . startup . context config

. 1 line 146 : attribut valu us turn off xml namespac awaren . protect boolean xml namespac awar = fals ; awar wa misspel awaren . 2 line 268 : get server . xml lt ; host gt ; attribut s xml namespac awar . return true namespac awaren enabl . public boolean get xml namespac awar ( ) { return xml namespac awar ; } awar wa misspel awaren . 3 line 366 : ha specifi applic been deploi note applic defin server . xml have been deploi . return code true code applic ha been deploi code fals code applciat ha been deploi doe exist public boolean deploi ( string name ) { applic wa misspel applciat . 4 line 1328 : add new context manag us . entri point admin webapp , other jmx context control . public void manag app ( context context ) { control wa misspel control line 1382 : remov webapp from our control . entri point admin webapp , other jmx context control . public void unmanag app ( string context path ) { control wa misspel control 5 misspel javadoc class org . apach . catalina . startup . host config

line : 230 return true redirct standard stream enabl . public boolean redirect stream ( ) { return ( thi . redirect stream ) ; } redirect wa misspel redirct line : 875 initi name thi should onli enabl java : env root name . tomcat embed applic alreadi defin those shouldn t do . xxx 2 should separ , you mai want enabl java : initi context revers xxx can we guess i . e . lookup java : someth return assum fals xxx we have major problem current set java : url protect void init name ( ) { embed wa mispel embed two misspel javadoc class org . apach . catalina . startup . embed

code cleanup patch remov some obsolet null check

below javadoc class org . apach . catalina . startup . bootstrap : boostrap loader catalina . thi applic construct class loader us load catalina intern class ( accumul all jar file found server directori under catalina . home ) , start regular execut contain . purpos thi roundabout approach keep catalina intern class ( ani other class thei depend , xml parser ) out system class path therefor visibl applic level class . author craig r . mc clanahan author remi maucherat version revis : 831860 date : 2009 11 02 19 : 00 : 01 0800 ( mon , 02 nov 2009 ) first word ommit t letter . sould bootstrap , boostrap . bootstrap misspel boostrap javadoc class org . apach . catalina . startup . bootstrap

below javadoc class org . apach . catalina . startup . catalina : startup shutdown shell program catalina . follow command line option ar recogn : ul li b config { pathnam } b set pathnam configur file process . rel path specifi , interpret rel directori pathnam specifi catalina . base system properti . conf server . xml li b help b displai usag inform . li b stop b stop current run instanc catalina . u should do same thing embed , us server . xml file . author craig r . mc clanahan author remi maucherat version revis : 752323 date : 2009 03 11 08 : 46 : 54 0800 ( wed , 11 mar 2009 ) howev , doesn t allud nonma option , start option . below usag ( ) method same class : print usag inform thi applic . protect void usag ( ) { system . out . println ( usag : java org . apach . catalina . startup . catalina config { pathnam } nonam { start stop } ) ; } complet either . lack help option . javadoc class org . apach . catalina . startup . catalina complet , usag ( ) method

string command = start ; ( arg . length 0 ) { command = arg arg . length 1 ; } ( command . equal ( startd ) ) { arg 0 = start ; daemon . load ( arg ) ; daemon . start ( ) ; } els ( command . equal ( stopd ) ) { arg 0 = stop ; daemon . stop ( ) ; } . . . . . . should : string command = start ; ( arg . length 0 ) { command = arg arg . length 1 ; } ( command . equal ( startd ) ) { arg arg . length 1 = start ; daemon . load ( arg ) ; daemon . start ( ) ; } els ( command . equal ( stopd ) ) { arg arg . length 1 = stop ; daemon . stop ( ) ; } . . . . . . pleas refer follow usag method org . apach . catalina . startup . catalina : protect void usag ( ) { system . out . println ( usag : java org . apach . catalina . startup . catalina config { pathnam } nonam { start stop } ) ; } org . apach . catalina . startup . bootstrap s main method handl startd stopd wrongli

translat error messag when us { . . . } templat text

npe respons contain null content encod header

email exchang involv ranier ( see attach ) , he suggest i log thi bugzilla , so i am . i wa us tomcat 6 . 0 . 20 window xp sp3 latest java 6 jvm . do get method servlet , i wa try see all request attribut see sendfil support attribut wa set ( specif request attribut org . apach . tomcat . sendfil . support ) . my first pass thi i just us http servlet request . get attribut name ( ) dump all name attribut expect see thi list , i got attribut list all . i actual got attribut via get attribut ( org . apach . tomcat . sendfil . support ) which work . so get attribut name return name all attribut . so either : 1 . get attribut name need fix return name all attribut ( i . e . , code chang ) ; 2 . tomcat doc need updat some wai sai thatget attribut name onli return certain attribut blah blah ( i . e . , doc chang ) . again my origin email ranier s repli attach . thank http servlet request . get attribut name ( ) doe return name all attribut

tomcat poll context . xml file chang . previous exist context . xml miss instant tomcat poll , applic undeploi . some text editor ( notabl vi deriv ) creat backup file : 1 ) renam origin file , 2 ) creat new file write edit content file . therefor race condit . small non zero probabl user edit save context . xml us editor see webapp undeploi . messag tomcat user indic situat ha occur product server least onc . s undoubtedli rare . suggest fix : examin directori presenc backup file context . xml , do undeploi found even context . xml miss . thi horribl ugli make semant backup file veri peculiar , actual onli wai prevent race anyth els onli make less like , heavili load system ( where context . xml edit via network file share ) interv between old context . xml renam new creat mai arbitrarili long . onli undeploi file miss period time . discuss around period . tomcat user , mark thoma suggest poll again after 500m ; i suggest rememb state between poll onli undeploi file wa miss two success poll . thi cleaner fix explain , complet solut doe remov possibl race . asid , mai well similar issu where tomcat poll context . xml written , find ha chang , read part written version . mitig , file involv ar typic small mai well written veri few oper ; howev , tomcat should probabl assum ani file chang atom . edit context . xml mai caus unwant undeploi webapp

jsp file name : common header . jsp s cotent : exampl : includ file = common header . jsp meta http equiv = content type content = text html ; charset = utf 8 meta http equiv = cach control content = store meta http equiv = pragma content = cach meta http equiv = expir content = 0 link href = . . css css . css rel = stylesheet type = text css consol output : java . lang . stack overflow error java . text . date format . format ( date format . java : 275 ) java . text . format . format ( format . java : 140 ) java . text . messag format . subformat ( messag format . java : 1288 ) java . text . messag format . format ( messag format . java : 795 ) java . util . log . simpl formatt . format ( simpl formatt . java : 50 ) java . util . log . stream handler . publish ( stream handler . java : 179 ) java . util . log . consol handler . publish ( consol handler . java : 88 ) java . util . log . logger . log ( logger . java : 458 ) java . util . log . logger . do log ( logger . java : 480 ) java . util . log . logger . logp ( logger . java : 680 ) org . apach . juli . log . direct jdklog . log ( direct jdklog . java : 167 ) org . apach . juli . log . direct jdklog . error ( direct jdklog . java : 135 ) org . apach . jasper . compil . jsp reader . push file ( jsp reader . java : 606 ) org . apach . jasper . compil . jsp reader . init ( jsp reader . java : 141 ) org . apach . jasper . compil . jsp reader . init ( jsp reader . java : 119 ) org . apach . jasper . compil . parser control . determin syntax encod ( parser control . java : 399 ) org . apach . jasper . compil . parser control . do pars ( parser control . java : 207 ) org . apach . jasper . compil . parser control . pars ( parser control . java : 137 ) org . apach . jasper . compil . parser . process includ direct ( parser . java : 339 ) org . apach . jasper . compil . parser . pars includ direct ( parser . java : 376 ) org . apach . jasper . compil . parser . pars direct ( parser . java : 484 ) org . apach . jasper . compil . parser . pars tag file direct ( parser . java : 1784 ) org . apach . jasper . compil . parser . pars ( parser . java : 127 ) thi exist 6 . 0 . 18 . stack overflow error includ

html page should us get restart web app .

you receiv rewritten url z os uss ( unix mainfram ) , tomcat doe properli decod jsessionid portion url . problem org . apach . catalina . connector . coyot adapt pars session id method . two instanti string object do specifi encdod us . e . g . string sid = new string ( uri bc . get buffer ( ) , start session id start , semicolon2 session id start ) ; . . . well second string instanti thi method . consequ z os us default encod which ( i think ) ebcdic . i recompil hardcod utf 8 encod jsessionid decod properli . i am suggest thi liter offici fix . e . g . string sid = new string ( uri bc . get buffer ( ) , start session id start , semicolon2 session id start , utf 8 ) ; decod jsessionid bug z os

1 ) cite address you attempt listen ( just port ) 2 ) proper except chain follow info current lost : << java . net . bind except : cannot assign request address java . net . plain socket impl . socket bind ( nativ method ) java . net . plain socket impl . bind ( plain socket impl . java : 359 ) java . net . server socket . bind ( server socket . java : 319 ) java . net . server socket . init ( server socket . java : 185 ) javax . net . ssl . sslserver socket . init ( sslserver socket . java : 106 ) com . privaspher . net . ssl . sslserver socket impl . init ( sslserver socket impl . java : 106 ) com . privaspher . net . ssl . sslserver socket factori impl . creat server socket ( sslserver socket factori impl . java : 71 ) org . apach . tomcat . util . net . jsse . jssesocket factori . creat socket ( jssesocket factori . java : 100 ) org . apach . tomcat . util . net . pool tcp endpoint . init endpoint ( pool tcp endpoint . java : 295 ) org . apach . coyot . http11 . http11base protocol . init ( http11base protocol . java : 139 ) org . apach . catalina . connector . connector . initi ( connector . java : 1017 ) org . apach . catalina . core . standard servic . initi ( standard servic . java : 578 ) >> provid better insight bind except : cannot assign request address

seem webapp class loader wa stop { noformat } caus : java . lang . null pointer except org . apach . catalina . loader . webapp class loader . find resourc ( webapp class loader . java : 994 ) java . lang . class loader . get resourc ( class loader . java : 1016 ) { noformat } all i did wa launch server add context ask load resourc from classpath . s bit more complic than , so i ll try narrow down need . null pointer except embed tomcat

wrong argument redirect path . set char mapper . intern map wrapper (

when displai thread pool , statu manag servlet ignor executor us standard thread pool inform each connector . thi caus incorrect inform displai when connector configur us executor . relat topic , appear connector executor link expos via jmx ( which need fix thi ) . manag ignor executor statu page

when part webapp requir ssl connect client certif should ssl renegoti request client certif from browser . thi configur i ad webapp alreadi us ssl connector : login config id = login config 1 auth method client cert auth method realm name wp realm name login config secur constraint id = secur constraint 1 web resourc collect id = web resourc collect 1 web resourc name url pattern login cert . do url pattern http method delet http method http method get http method http method post http method http method put http method http method head http method web resourc collect user data constraint id = user data constraint 4 transport guarante confidenti transport guarante user data constraint secur constraint request login cert . do requir ssl connect , isn t , client certif request . ssl renegoti doe occur when resourc client cert auth request

chang tomcat . set silent ( ) set silent ( boolean ) . s nicer client have java bean type setter , doesn t seem make sens you can set someth unset . chang tomcat . set silent ( ) set silent ( boolean )

why ar static add servlet ( ) method tomcat static i can see thei don t us ani state from instanc , isn t cleaner us instanc method , so api uniform ( everyth i want do tomcat instanc goe through instanc ) would more consist follow pattern add servlet ( string , string , string ) , search context name instead requir instanc pass static method . static util method tomcat should instanc method

local repositori boolean replac = fals ; string befor = repositori ; while ( ( i = repositori . index ( catalina home token ) ) = 0 ) { replac = true ; ( i 0 ) { repositori = repositori . substr ( 0 , i ) get catalina home ( ) repositori . substr ( i catalina home token . length ( ) ) ; } els { repositori = get catalina home ( ) repositori . substr ( catalina home token . length ( ) ) ; } } while ( ( i = repositori . index ( catalina base token ) ) = 0 ) { replac = true ; ( i 0 ) { repositori = repositori . substr ( 0 , i ) get catalina base ( ) repositori . substr ( i catalina base token . length ( ) ) ; } els { repositori = get catalina base ( ) repositori . substr ( catalina base token . length ( ) ) ; } } ( replac log . debug enabl ( ) ) log . debug ( expand befor replac ) ; last line should : log . debug ( expand befor repositori ) ; log statement error org . apach . catalina . startup . bootstrap . java

receiv arithmet except : zero when expir session via tomcat manag webapp . thi except wa thrown onli session timeout set 1 webapp web . xml . moreov , except wa also thrown regardless idl paramet valu ( expir path = xxx idl = mm ) long session timeout = 1 . result : except stacktrac : error : 19 08 2009 00 : 18 : 22 http 80 exec 33 ( org . apach . catalina . core . applic context : 669 ) htmlmanag : manag servlet . session contextpath java . lang . arithmet except : zero org . apach . catalina . manag . manag servlet . session ( manag servlet . java : 1133 ) org . apach . catalina . manag . htmlmanag servlet . session ( htmlmanag servlet . java : 573 ) org . apach . catalina . manag . htmlmanag servlet . expir session ( htmlmanag servlet . java : 660 ) org . apach . catalina . manag . htmlmanag servlet . do get ( htmlmanag servlet . java : 118 ) org . apach . catalina . manag . htmlmanag servlet . do post ( htmlmanag servlet . java : 157 ) javax . servlet . http . http servlet . servic ( http servlet . java : 637 ) javax . servlet . http . http servlet . servic ( http servlet . java : 717 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 233 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 191 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 525 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 128 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 286 ) org . apach . coyot . http11 . http11nio processor . process ( http11nio processor . java : 880 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 719 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 2081 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 886 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 908 ) java . lang . thread . run ( thread . java : 619 ) arithmet except : zero when expir session via manag

web applic us servlet map welcom file ar ignor server return either directori list 404 list disabl . i have jsf servlet defin servlet map . jsf go face servlet . i have index . jsf list welcom file i get 404 directori list disabl . i also have custom servlet defin map set welcom file map get 404 well . welcom file ignor servlet map

patch fix unsaf public string arrai abstract creat statement interceptor

fix occasion test failur test concurr

file fair block queue . java multi lock fair block queue . java us throw unsupport oper thi should throw unsupport oper except javadoc error except name misspelt

some test case ( e . g . test tomcat ) start tomcat server , thi creat directori tree tomcat . 8080 work . . . which delet when test finish . test case do clear up afterward

test tomcat . set up ( ) creat work directori , doe delet tear down ( ) test tomcat fail delet work directori

unabl us nest type tld

thi tomcat 5 . 5 . x ( don t rememb last rev . number , my current machin ) . when log4j classpath web app configur log debug level , jasper dump whole http post request bodi debug trace . thi consum http servlet request input stream which arriv unus user begin jsp code ( us http servlet request . get input stream ( ) , stream alreadi end ) . workaround disabl debug trace japser class log4j . properti , jasper should consum http servlet request input stream whatev mode run . jasper log4j web app classpath debug level enabl prevent read http post stream from jsp

appear valv interfac javadoc hasn t been updat sinc around tc 5 . 5 . here snip what current avail from tc s websit ( 6 . 0 . 20 i would guess ) : correspond respons wa gener ( control wa return , call next valv pipelin ( ) execut context . invok next ( ) . . . . modifi http header includ respons after invok next ( ) method ha return . perform ani action output stream associ specifi respons after invok next ( ) method ha return . invok next method ha exist valv interfac mani version . i believ replac : thi . get next ( ) . invok ( request , respons ) i m happi provid doc patch get next ( ) . invok ( request , respons ) expect replac invok next ( request , respons ) . note doc 5 . 5 also have same problem . pleas let me know i should log separ . valv interfac javadoc invok method refer non exist method

when web app class loader stop manual set all static final variabl null clear refer method . thi result npe ani thread wa stop expect final static variabl null . thi particularli problem hot deploi sinc unload fail termin deploi . web app class loader clear refer code break run thread

cluster node load balanc sticki session , particular node becom unavail , ani session bound node must redistribut . particularli case mod jk session bound whichev node failov occur becaus jessionid still contain jvm rout origin fail node , thu place session indetermin state lose sticki properti . i am attach patch trigger session rebind itself new node jvmrout don t match replac jessionid browser s cooki . sticki session us persist manag enter indetermin state node failov

tomcat can t replic session when start .

public void expir ( boolean notifi ) { mark thi session expir need ( expir ) return ; man s land here synchron ( thi ) { ( manag = = null ) return ; expir = true ; potenti syncro problem standard session . expir ( boolean )

mcast servic impl executor dispatch event .

issu custom jaa s login modul . logout ( ) method never call . i guess thi ha been never implement correctli ( least sinc tomcat 5 . 5 . 9 ) . thing accord jaa spec , login context . logout ( ) suppos invok logout method each login modul configur thi login context . so , somebodi should sure call login context . logout ( ) method . caller thi method could either server client . so , either tomcat should provid some mean access login context client , tomcat should take respons call thi method itself . i guess solut could tomcat associ instanc login context user s session , tomcat could invok login context . logout ( ) when session invalid ( both when session time out invalid explicit ) . i hope i am correctli interpret jaa spec . jaa contract login modul broken

delta session ignor notifi listen replic when backup manag us .

bug tomcat

i m us jndirealm authent open ldap 2 . 2 . 28 . within open ldap i ve configur user password attribut each user contain md5 digest , each prefix string { md5 } . i am ldap expert ani mean i believ thi prefix standard convent . anywai assum thi convent jndirealm need strip off { md5 } portion much like doe { sha1 } . see attach patch which accomplish thi i verifi work my environ . jndirealm . java abl handl md5 password

some test case assum jdbc provid support select 1 valid sql statement ; howev thi alwai case , e . g . derbi requir tabl name select from . solut provid patch us valid queri defin properti set up test , rather than alwai us select 1 . remov db specif sql statement from test case ( select 1 )

pool connect . connect ( ) fail check null return from java . sql . driver . connect ( ) method . thi can result npe when connect us later . pool connect . connect ( ) fail check null connect

thi patch add addit entri catalina . polici file . specif : catalina . base share directori ad given equal permiss catalina . home common java . io . tmpdir now readabl . javax . servlet . context . tempdir now readabl . i think compliant spec , thi must allow . directori specifi java . io . tmpdir ( which what tomcat point javax . servlet . context . tempdir ) now read , write , delet . again , i think spec requir thi . addit entri default catalina . polici file .

cannot join cluster membership .

delta manag doesn t do session replic . ( notifi session listen replic = fals )

delta request never reset . ( us backup manag )

fail re deploi , when we updat context . xml .

standard session . fire contain event check string class name why just us instanceof check here cannot overrid standard context embed case becaus standard session . fire contain event

i think access log valv ha race condit problem

code around line 1075 : } els ( action code = = action code . action req local addr attribut ) { ( local addr = = null ) local addr = socket . get local address ( ) . get host address ( ) ; fail check socket = null . sinc thi check everywher els method thi probabl bug . method http11processor . pars host ( ) also refer socket without check null . within class , onli call process ( socket ) , which guarante won t null . howev onc process ( ) return normal , socket set null . pars host ( ) method public , so mai call when socket = = null . perhap pars host ( ) method should privat possibl npe http11processor . action (

hi , i m us tribe cluster modul my own applic ( which ha noth do tomcat ) i m us member aliv time valu sort all cluster member . thi bug produc follow : i have 2 node were start almost same time both node claim other node wa start befor them node1 : remot member : ( 52 . 63 . 57 . 110 : 4001 readi = true suspect = fals fail = fals aliv time = 1526 ) local member : ( 52 . 63 . 57 . 109 : 4000 readi = true suspect = fals fail = fals aliv time = 1236 ) node2 : remot member : ( 52 . 63 . 57 . 109 : 4000 readi = true suspect = fals fail = fals aliv time = 2021 ) local member : ( 52 . 63 . 57 . 110 : 4001 readi = true suspect = fals fail = fals aliv time = 1069 ) my code do follow : member member = group channel . get member ( ) ; print remot ( member ) ; member local member = group channel . get local member ( true ) ; print local ( local member ) ; code ( due time issu ) should possibl other wai around ( everi node claim start befor other ) case . issu occur becaus when mcast servic start , assign start time local member . public class mcast servic . . . . { public void start ( int level ) { . . . . local member . set servic start time ( system . current time milli ( ) ) ; . . . . impl = new mcast servic impl ( local member , . . . . ) ; impl . start ( level ) ; } } , creat start mcast servic impl which also store new servic start time : ( public class mcast servic impl { protect long servic start time ; public void start ( int level ) { . . . . servic start time = system . current time milli ( ) ; . . . . } } so , we have 2 differ start time . unfortun both time ar us : get local member , impl . get servic start time ( ) us : public class mcast servic . . . . { public member get local member ( boolean aliv ) { ( aliv local member = null impl = null ) local member . set member aliv time ( system . current time milli ( ) impl . get servic start time ( ) ) ; return local member ; } } , when member transmit throw network , member impl . get servic start time ( ) us . public class member impl . . . . { public byte get data ( boolean getal , boolean reset ) { ( reset ) data pkg = null ; look cach first ( data pkg = null ) { ( getal ) { you d surpris , system . current time milli show up profil long aliv = system . current time milli ( ) get servic start time ( ) ; xbyte buffer . byte ( ( long ) aliv , data pkg , tribe mbr begin . length 4 ) ; } return data pkg ; } . . . . . . } produc weird behaviour . imho , fix should set same servic start time both compon . thi issu affect serious my code . i would appreci you could fix asap . i ve verifi same code present trunk repositori . regard , ariel servic start time differ member impl from mcast servic impl

do cach resourc like docu sai ( string manag )

standard host valv . statu unnecessarili html escap error messag

shutdown doe unregist all mbean

nest group jndi realm non recurs implement

javax . servlet . http . http session method get attribut ( ) , get valu ( ) , get attribut name ( ) , get valu name ( ) , etc , throw illeg state except call session ha been invalid . so , follow code jsp page : session . invalid ( ) ; object obj = page context . find attribut ( foo ) ; illeg state except thrown becaus page context . find attribut ( ) eventu call session . get attribut ( ) session ha been invalid . session ha been invalid should simpli ignor when method need process variou scope ( page , request , session , applic ) . thi impact follow method page context impl : public int get attribut scope ( final string name ) which call privat int do get attribut scope ( string name ) ; public object find attribut ( final string name ) which call privat object do find attribut ( string name ) ; public void remov attribut ( final string name ) which call privat void do remov attribut ( string name ) ; fix catch illeg state except ignor when process attribut session scope . code simpli follow through process applic scope . need worri about set attribut ( ) becaus alwai invok specif scope , spec alreadi state java . lang . illeg state except must thrown when call invalid session . page context . set attribut ( foo , valu foo , page context . session scope ) ; java . lang . illeg state except scope page context . session scope page wa request doe particip session session ha been invalid . same time , fix should done method do remov attribut ( string name ) where try catch block except appear unnecessari . privat void do remov attribut ( string name ) { try { remov attribut ( name , page scope ) ; remov attribut ( name , request scope ) ; ( session = null ) { try { remov attribut ( name , session scope ) ; } catch ( illeg state except ex ) { session ha been invalid . ignor fall through applic scope . } } remov attribut ( name , applic scope ) ; } catch ( except ex ) { we remov much we can , simpli ignor possibl except } } here full analysi : start remov attribut ( final string name ) we check null throw npe necessari we call do remov attribut ( name ) do remov attribut ( name ) we call remov attribut ( name , scope ) each scope remov attribut ( final string name , final int scope ) thi call do remov attribut ( name , scope ) do remov attribut ( name , scope ) page scope : attribut . remov won t throw except request scope : request . remov attribut document except thrown session scope : throw illeg state except session null app scope : context . remov attribut document except thrown null valu name alreadi check remov attribut ( final string name ) we throw npe . so thi situat ( remov attr from page request scope throw npe ) won t happen . do remov attribut ( name ) , we alreadi check session = null befor call remov attribut ( name , session scope ) . so normal illeg state except thrown ( except invalid case ) . when remov attribut from applic ( i . e . , servlet context ) scope , ani regist listen notifi , code doe ( see appserv webtier src java org apach catalina core applic context . remov attribut ( ) ) alreadi catch ani throwabl listen mai throw . try catch block therefor unnecessari . moreov , ani remov action from differ scope could have thrown except , each them would have need wrap insid own try catch , so ensur except scope doe caus ani subsequ remov bypass . do remov attribut ( string name ) ha therefor been modifi follow : privat void do remov attribut ( string name ) { remov attribut ( name , page scope ) ; remov attribut ( name , request scope ) ; ( session = null ) { try { remov attribut ( name , session scope ) ; } catch ( illeg state except ex ) { session ha been invalid . ignor fall through applic scope . } } remov attribut ( name , applic scope ) ; } chang done glassfish . ymmv jasper diff . page context impl . java 9 dec 2005 18 : 54 : 30 0000 1 . 7 page context impl . java 16 dec 2005 00 : 11 : 21 0000 1 . 8 452 , 8 452 , 13 return request scope ; ( session = null ) { try { ( session . get attribut ( name ) = null ) return session scope ; } catch ( illeg state except ex ) { session ha been invalid . ignor fall through applic scope . } } ( context . get attribut ( name ) = null ) 495 , 9 500 , 14 return o ; ( session = null ) { try { o = session . get attribut ( name ) ; ( o = null ) return o ; } catch ( illeg state except ex ) { session ha been invalid . ignor fall through applic scope . } ( o = null ) return o ; } return context . get attribut ( name ) ; 559 , 19 569 , 18 } } privat void do remov attribut ( string name ) { try { remov attribut ( name , page scope ) ; remov attribut ( name , request scope ) ; ( session = null ) { try { remov attribut ( name , session scope ) ; } catch ( illeg state except ex ) { session ha been invalid . ignor fall through applic scope . } remov attribut ( name , applic scope ) ; } catch ( except ex ) { we remov much we can , simpli ignor possibl except } remov attribut ( name , applic scope ) ; } public jsp writer get out ( ) { invalid session caus page context method fail

jsp compil startup when us servlet

activ directori can respond queri search result s ar rel . we discov thi happen directori host across mani server when user base wa suffici identifi singl server . get user search , jndirealm assum search result rel goe about creat dn user append togeth variou bit name get back . thi definit wrong absolut name which ar url s form : ldap : server encod user dn i discov thi issu tomcat 5 . 5 cursori look svn repo tomcat 6 . 0 reveal thi bug also present . i have patch thi issu which i attach . patch jndirealm fail pars absolut name

limit buffer set caus arraycopi error

server incorrectli report 501 error bad method name . should report 400 error .

org . apach . catalina . loader . webapp class loader throw except relat java 6 bug 6434149

jsp : plugin type = applet gener type = applic x java applet ; instead type = applic x java applet . firefox java plugin cannot displai java applet becaus ; ad . jsp : plugin error

shtml file ar lock when us window . close reader solv problem . reader close

small fix task thread factori

small fix task queue

us jk modul submit some data post method , byte receiv alwai show zero see sourc file , jk coyot handler . java , inovk method public int invok ( msg msg , msg context ep ) throw ioexcept { ( ep . log time enabl ( ) ) ep . set long ( msg context . timer pre request , system . current time milli ( ) ) ; request req = ep . get request ( ) ; respons re = req . get respons ( ) ; ( log . debug enabl ( ) ) log . debug ( invok req re req . request uri ( ) . string ( ) ) ; re . set note ( ep note , ep ) ; ep . set statu ( msg context . jk statu head ) ; request info rp = req . get request processor ( ) ; rp . set stage ( constant . stage servic ) ; try { adapt . servic ( req , re ) ; } catch ( except ex ) { log . info ( error servic request req , ex ) ; } ( ep . get statu ( ) = msg context . jk statu close ) { re . finish ( ) ; } req . recycl ( ) ; req . updat counter ( ) ; see thi line re . recycl ( ) ; ep . recycl ( ) ; ( ep . get statu ( ) = = msg context . jk statu error ) { return error ; } ep . set statu ( msg context . jk statu new ) ; rp . set stage ( constant . stage keepal ) ; return ok ; } request object recycl , byte read properti must set zero , next line , begin updat counter , thi mai bug byte receiv problem

synchron target can chang midwai

jmxaccessor task string constant should final

ar variou public string arrai org . apach . jasper . constant . although arrai variabl ar final , ani code can chang ani arrai constant . org . apach . jasper . constant public arrai ar mutabl

some platform ( z os sure ) , devic file dev urandom can pass f . exist ( ) test , throw ioexcept some kind when try open . current code manag base . set random file ( ) doesn t handl thi , which result everi call get random ( ) try again log error fail close random . follow chang method add proper error handl correct thi ( my chang mark kjw ) public void set random file ( string s ) { hack , you can us static file genar same session id ( good strang debug ) ( global . secur enabl ) { random = ( data input stream ) access control . do privileg ( new privileg set random file ( ) ) ; } els { try { dev random sourc = s ; file f = new file ( dev random sourc ) ; ( f . exist ( ) ) return ; random = new data input stream ( new file input stream ( f ) ) ; random . read long ( ) ; ( log . debug enabl ( ) ) log . debug ( open dev random sourc ) ; } catch ( ioexcept ex ) { log . debug ( error read dev random sourc , ex ) ; kjw ( random = null ) { kjw : open try { random . close ( ) ; } catch ( except e ) { log . warn ( fail close random . ) ; } } kjw dev random sourc = null ; kjw : don t try again automat random = null ; } } } manag base . set random file error handl fix

manag xml interfac hard code path xsl transform

us java 1 . 5 string manag

thi problem access log valv tc5 . 5 well tc6 . 0 all platform . system clock my linux machin ( ubuntu my case ) just befor us time chang march 8 , i start tomcat 5 . 5 see follow messag my tomcat access log after access tomcat jsp exampl page time dst transit : : 08 mar 2009 : 01 : 56 : 20 0700 get jsp exampl jsp2 simpletag book . jsp http 1 . 1 200 1738 1 { http 8080 processor24 } : 08 mar 2009 : 03 : 01 : 22 0700 get jsp exampl jsp2 tagfil hello . jsp http 1 . 1 200 2213 68 { http 8080 processor25 } note offset 0700 both befor after dst transit . follow tomcat restart offset correct : : 08 mar 2009 : 03 : 19 : 42 0600 get jsp exampl jsp2 jspx basic . jspx http 1 . 1 200 1919 780 { http 8080 processor25 } : 08 mar 2009 : 03 : 19 : 59 0600 get jsp exampl jsp2 jspx svgexampl . html http 1 . 1 200 2239 4 { http 8080 processor25 } : 08 mar 2009 : 03 : 19 : 59 0600 get jsp exampl jsp2 jspx text rotat . jpg http 1 . 1 200 26729 3 { http 8080 processor25 } btw , i ran tzupdat befor my test : linwin01 512 java jar tzupdat . jar v tzupdat version 1 . 3 . 12 b01 jre time zone data version : tzdata2009a embed time zone data version : tzdata2009a problem org . apach . catalina . valv . access log valv which contain follow start method : initi time zone , date formatt , current date timezon = time zone . get default ( ) ; time zone dst = calcul time zone offset ( timezon . get raw offset ( ) ) ; calendar calendar = calendar . get instanc ( timezon ) ; int offset = calendar . get ( calendar . dst offset ) ; time zone dst = calcul time zone offset ( timezon . get raw offset ( ) offset ) ; base what iv seen , int offset = calendar . get ( calendar . dst offset ) ; return 0 when current time daylight save time ( my timezon ) 3600000 ( 60 60 1000 ) when current time daylight save . look like code assum thi alwai offset daylight save current timezon . i have idea ar some locat timezon where daylight save time doe have 1 hour offset . becaus thi , non dst time period , time zone dst time zone dst ar set same valu . dst time period , i believ thei ar set correctli so transit autumn work correctli . i think onli problem when move ahead springtim ( unless softwar ha been run 6 month so which caus offset set correctli ) . access log valv report correct time incorrect offset follow spring dst transit .

problem : jsp init method call twice . definit : jsp background compil ar enabl . ( default web . xml , defin check interv defin develop fals . ) defin jsp servlet load startup tag web . xml . propos : org apach jasper compil compil . java public void compil ( boolean compil class , boolean jspc mode ) throw file found except , jasper except , except { . . . . ( compil class ) { file target file = new file ( ctxt . get class file name ( ) ) ; ( target file . exist ( ) ) { long target last modifi = target file . last modifi ( ) ; ( jsw = null ) { jsw . set servlet class last modifi time ( target last modifi ) ; } } } } last method . regard , yuichiro jsp init method call twice .

avoid redund instanti standard context

fgrep r new random ( system . current time milli ( ) ) . give 7 place where random initi seed = current time milli . thi unnecessari , becaus better seed initi happen default random constructor . seed from current time useless

when call invalid ( ) valid http session object comet connect manag valv method session destroi ( http session event se ) event ( request request , respons respons , comet event event ) ar call concurr . so either comet event event type . end event sub type . session end never signal via session destroi ( . . . ) http session object ha becom invalid attribut hold comet request can set remov via event ( . . . ) . i have configur comet connect manag valv valv element context . xml also listen element my applic web . xml . see thi stacktrac session destroi ( ) wa bit faster : except error occur contain dure request process java . lang . illeg state except : remov attribut : session alreadi invalid org . apach . catalina . session . standard session . remov attribut ( standard session . java : 1206 ) org . apach . catalina . session . standard session . remov attribut ( standard session . java : 1181 ) org . apach . catalina . session . standard session facad . remov attribut ( standard session facad . java : 140 ) org . apach . catalina . valv . comet connect manag valv . event ( comet connect manag valv . java : 335 ) org . apach . catalina . core . standard host valv . event ( standard host valv . java : 179 ) org . apach . catalina . valv . valv base . event ( valv base . java : 200 ) org . apach . catalina . core . standard engin valv . event ( standard engin valv . java : 128 ) org . apach . catalina . connector . coyot adapt . event ( coyot adapt . java : 198 ) org . apach . coyot . http11 . http11nio processor . event ( http11nio processor . java : 750 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . event ( http11nio protocol . java : 653 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 2081 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 885 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 907 ) java . lang . thread . run ( thread . java : 637 ) comet connect manag valv : concurr access session object when call http session . invalid (

http11processor . java while ( start error keep aliv ) { pars request header try { ( disabl upload timeout kept aliv ) { ( keep aliv timeout 0 ) { socket . set so timeout ( keep aliv timeout ) ; } els ( so timeout 0 ) { socket . set so timeout ( so timeout ) ; } } input buffer . pars request line ( ) ; request . set start time ( system . current time milli ( ) ) ; kept aliv = true ; ( disabl upload timeout ) { socket . set so timeout ( timeout ) ; } disabl upload timeout thi flag allow servlet contain us differ , longer connect timeout while servlet execut , which end allow either servlet longer amount time complet execut , longer timeout dure data upload . specifi , thi attribut set true . code abov wait new http request preced servlet process logic . seem odd me i must set disabl timeout fals get my keep aliv timeout set . set keepalivetimout , i must implicit enabl upload timeout whether i need . seem me disabl timeout unneccessari follow line ( disabl upload timeout kept aliv ) { do you agre thi thank insight why disabl upload timeout keep aliv timeout correl http11 connector

follow file tomcat trunk don t have al header ; far i can tell , thei should : modul jdbc pool sign . sh modul jdbc pool test org apach tomcat jdbc test starvat test . java miss al header

when option http request made tomcat directori ha default file ( like index . jsp ) , tomcat report full list allow verb , when fact , most them ar allow . exampl , request gener img directori : option img http 1 . 0 cooki : jsessionid = content length : 0 accept : accept languag : en us connect : keep aliv user agent : mozilla 4 . 0 ( compat ; msie 6 . 0 ; window nt 5 . 1 ; sv1 ; . net clr 1 . 1 4322 ; info path . 1 ) return : http 1 . 1 200 ok server : apach coyot 1 . 1 allow : get , head , post , put , delet , trace , option content length : 0 date : mon , 24 apr 2006 15 : 11 : 16 gmt connect : close which show sever destruct option avail ( put , delet ) . request delet put ( correctli ) return 403 forbidden result : delet img http 1 . 0 cooki : jsessionid = content length : 0 accept : accept languag : en us connect : keep aliv user agent : mozilla 4 . 0 ( compat ; msie 6 . 0 ; window nt 5 . 1 ; sv1 ; . net clr 1 . 1 4322 ; info path . 1 ) return : http 1 . 1 403 forbidden server : apach coyot 1 . 1 content type : text html ; charset = utf 8 content length : 964 date : mon , 24 apr 2006 15 : 12 : 31 gmt connect : close becaus initi option request return list contain danger verb , directori flag seriou secur vulner most scanner ( fals posit ) . issu doe occur when directori ha default file : option user manag http 1 . 0 cooki : jsessionid = content length : 0 accept : accept languag : en us connect : keep aliv user agent : mozilla 4 . 0 ( compat ; msie 6 . 0 ; window nt 5 . 1 ; sv1 ; . net clr 1 . 1 4322 ; info path . 1 ) return : http 1 . 1 200 ok server : apach coyot 1 . 1 set cooki : jsessionid = ; path = content type : text html ; charset = iso 8859 1 date : mon , 24 apr 2006 15 : 14 : 27 gmt connect : close option request directori default file report incorrect list allow http verb

doc base path contain webapp , backslash insert

server . xml : = = = = = = = = = = = i set client auth want tomcat user . xml : = = = = = = = = = = = = = = = = i creat role user ssl certif metadata web . xml : = = = = = = = = privat url my webseit , i creat secur constraint like thi : secur constraint web resourc collect web resourc name app web resourc name url pattern protect . jsp url pattern web resourc collect auth constraint role name tomcat role name auth constraint user data constraint transport guarante confidenti transport guarante user data constraint secur constraint login config auth method client cert auth method login config secur role role name tomcat role name secur role my result : ( i try access restrict jsp page ) = = = = = = = = = = = 1 ) when right client certif browser keystor : work : ) 2 ) when wrong client certif i get : http statu 401 cannot authent provid credenti ( thi ok , too ) 3 ) when client certif i get : http statu 400 client certif chain thi request 400 usual stand bad request bad syntax . bug : = = = = = = = = case 3 i expect get http statu 401 . wrong http code fail client cert authent

taglib pool bug when tag us jsp : attribut

webdav servlet

. tagx file don t compil document page encod case differ

compil tag file from differ tag librari share same packag

jspwiki jsp compil prevent org . apach . jasper . constant . jsp packag name

jdbcrealm . open ( ) throw null pointer except specifi driver doesn t handl specifi jdbc url

context 2f name caus tomcat crash shutdown sever year ago i work integr tomcat 5 . 5 our web applic manag infrastructur . dure process i fix sever tomcat 5 . 5 bug , appar never sent fix upstream . oop . our applic need deploi creat url look like thi : product customernam servlet i work sever peopl irc get tomcat5 . 5 do thi . we had previous been us path = paramet context xml file element tomcat 4 . 1 . unfortun , appear thi featur wa remov from tomcat5 . 5 , tomcat5 . 5 doe recurs subdirectori when read . xml context file . recommend irc ( after sever suggest which would work our environ ) wa put 2f context xml file s name . thi product 2fcustomernam . xml thi doe work , howev when you try shutdown tomcat 6 . 0 . 18 , you get thi crash : nov 9 , 2008 10 : 56 : 17 pm org . apach . coyot . http11 . http11protocol paus info : paus coyot http 1 . 1 http 8180 nov 9 , 2008 10 : 56 : 18 pm org . apach . catalina . core . standard servic stop info : stop servic catalina nov 9 , 2008 10 : 56 : 18 pm org . apach . catalina . startup . host config undeploi app warn : error while remov context product 2fcustomernam java . lang . null pointer except org . apach . catalina . core . contain base . remov child ( contain base . java : 915 ) org . apach . catalina . startup . host config . undeploi app ( host config . java : 1191 ) org . apach . catalina . startup . host config . stop ( host config . java : 1162 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 313 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 117 ) org . apach . catalina . core . contain base . stop ( contain base . java : 1086 ) org . apach . catalina . core . contain base . stop ( contain base . java : 1098 ) org . apach . catalina . core . standard engin . stop ( standard engin . java : 448 ) org . apach . catalina . core . standard servic . stop ( standard servic . java : 584 ) org . apach . catalina . core . standard server . stop ( standard server . java : 744 ) org . apach . catalina . startup . catalina . stop ( catalina . java : 628 ) org . apach . catalina . startup . catalina catalina shutdown hook . run ( catalina . java : 671 ) nov 9 , 2008 10 : 56 : 18 pm org . apach . coyot . http11 . http11protocol destroi info : stop coyot http 1 . 1 http 8180 context 2f name caus tomcat crash shutdown

coerc el express java . lang . object break express concaten

farm war deploy ha follow code line 152 : ( econtain = = null econtain instanceof engin ) { s clearli someth wrong condit . farm war deploy ha nonsens condit

potenti memori leak tag handler jsp id consum

persist cooki written 6 . 0 . 18 do work internet explor safari

case privileg action except thrown : privat static void execut ( final method method , final object target object , final object target argument , princip princip ) method , fals assumpt catch block , privileg action except . get except ( ) return invoc target except . could also illeg access except possibl other type except well . here stack trace provok catalina shutdown when enabl secur manag : java . lang . class cast except : java . lang . illeg access except cannot cast java . lang . reflect . invoc target except org . apach . catalina . secur . secur util . execut ( secur util . java : 278 ) org . apach . catalina . secur . secur util . do privileg ( secur util . java : 218 ) org . apach . catalina . secur . secur util . do privileg ( secur util . java : 178 ) org . apach . catalina . core . applic filter config . releas ( applic filter config . java : 326 ) org . apach . catalina . core . standard context . filter stop ( standard context . java : 3744 ) org . apach . catalina . core . standard context . stop ( standard context . java : 4513 ) org . apach . catalina . core . contain base . remov child ( contain base . java : 924 ) org . apach . catalina . startup . host config . undeploi app ( host config . java : 1191 ) org . apach . catalina . startup . host config . stop ( host config . java : 1162 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 313 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 117 ) org . apach . catalina . core . contain base . stop ( contain base . java : 1086 ) org . apach . catalina . core . contain base . stop ( contain base . java : 1098 ) org . apach . catalina . core . standard engin . stop ( standard engin . java : 448 ) org . apach . catalina . core . standard servic . stop ( standard servic . java : 584 ) org . apach . catalina . core . standard server . stop ( standard server . java : 744 ) org . apach . catalina . startup . catalina . stop ( catalina . java : 628 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . stop ( bootstrap . java : 300 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . common . daemon . support . daemon loader . stop ( daemon loader . java : 200 ) invalid cast secur util

svn properti patch

iter from javax . el . composit elresolv get featur descriptor ( ) must return null valu

addendum : s version 6 . 13 ( avail combobox abov ) scenario : = = = = = = = = = menu decrib tree structur ; render menu done tagfil render menuitem , which render current item either leaf item ( click caus action ) node item ( click open anoth next level submenu ) ; render submenu done call tagfil again from within bodi ; thi work fine tomcat 5 . 0 . x 5 . 5 . x make clear see follow pseudo code ( origin code volumin ) : tagfil render menuitem . tagx : jsp : root . . . jsp : direct . attribut name = menu item c : choos c : when test = { menu item . node } div node : { menu item . label } div c : each var = sub item item = menu item . children thi go caus problem tomcat6 : tag : render menuitem menu item = { sub item } c : each c : when c : otherwis div leaf : { menu item . label } div c : otherwis c : choos jsp : root faulti behaviour : = = = = = = = = = = = = = = = = tomcat 6 . 0 . 13 , gener java sourc tagfil reveal , bodi do tag ( ) method empti therefor emit html ; compil itself wa silent done , error warn wa shown logfil . jsp gener error recurs tagfil structur

add host alia us jmx doesn t take affect until restart

context path applic contain slash ( e . g . b ) method get path without context class org . apach . catalina . ssi . ssiservlet extern resolv simpli cut from second slash , so url b do . . tri includ b do . . instead do . . . patch includ context path strip path off : line 419 string context = get path without context ( norm context . get context path ( ) , normal ) ; line 356ff protect string get path without context ( final string context path , final string servlet path ) { ( servlet path . start ( context path ) ) { return servlet path . substr ( context path . length ( ) ) ; } return servlet path ; } ssi virtual includ broken context path slash

cannot access princip via subject . get subject ( access control . get context ( ) ) . problem method intern do filter applic filter chain call filter chain code determin princip don t us : ( global . secur enabl ) { final servlet request req = request ; final servlet respons re = respons ; princip princip = ( ( http servlet request ) req ) . get user princip ( ) ; object arg = new object { req , re , thi } ; secur util . do privileg ( do filter , filter , class type , arg ) ; arg = null ; } els { thi manner secur util . do privileg call princip = = null method execut creat subject princip . call subject . do privileg ( subject , pea , null ) ; thi do propag princip . i obtain subject without princip call subject . get subject ( access control . get context ( ) ) . attach we send our solut cannot access princip via subject . get subject ( access control . get context (

issu when us includ direct insid tag file ar insid jar file

i creat servlet doe follow : respons . set header ( x bug , valu ) ; respons . send error ( http servlet respons . sc bad request ) ; i us tomcat default error page 400 respons , respons contain header x bug valu valu . howev , i creat custom error page , respons header do contain x bug header respons . here my web . xml , exampl : error page error code 400 error code locat 400 . jsp locat error page 400 . jsp contain plain html : html bodi h3 custom 400 error page h3 bodi html extra respons header sent when us custom error page

servlet respons writer doe respect line . separ system properti

how reproduc bug . configur tomcat connector uriencod = utf 8 attribut . make simpl page write out ani request paramet . configur thi page protect form base authent . try access page , e . g . site page . jsp q = xx yy zz tt where q = xx yy zz valu utf 8 charset . when page access first time , after authent , paramet q incorrectli interpret ( seem wa iso8859 1 anyth els , utf 8 ) . subsequ access same uri , i . e . site page . jsp q = xx yy zz tt give perfect result . i also tri us bobi encod uri = true request . set charact encod ( utf 8 ) noth chang . uriencod doesn t affect after form authent redirect

default file item class pacakg org . apach . tomcat . util . http . fileupload creat byte arrai output stream full threshold size everi control submit form . i have form 63 control ( checkbox , text box file input ) , i set threshold 20 meg allow upload larg imag file memori . i get out memori except sinc tri alloc 63 lot 20m , although onli 1 control requir request size . i think would much more sensibl creat byte arrai output stream initi size onli few kilobyt size automat increas size data written . file upload memori usag

session ar incorrectli expir due thread unsaf code

tomcat run secur manag , jsp us page context . forward , default annot processor code can call untrist code call stack . process annot method contain line : field field = instanc . get class ( ) . get declar field ( ) ; get declar field ( ) subject secur check so thi throw java . secur . access control except . default annot processor part code catlina lib directori , which grant all permiss standard polici file . howev , becaus untrust jsp code stack , permiss ar us . call get declar field ( ) should wrap access control . do privileg call avoid except . default annot processor . process annot should us do privileg call get declar field

after look user s list post , i notic implement wa consist other getter ( like get name ) . i propos chang : public string get etag ( boolean strong ) { ( strong ) { strong etag must alwai calcul resourc ( strong etag = null ) return strong etag ; ( attribut = null ) { attribut attribut = attribut . get ( etag ) ; ( attribut = null ) { try { strong etag = attribut . get ( ) . string ( ) ; } catch ( name except e ) { ; valu attribut } } } return strong etag ; } els { weak etag content lenght last modifi ( weak etag = = null ) { weak etag = w get content length ( ) get last modifi ( ) ; } return weak etag ; } } updat resourc attribut . get etag

xxx comment below seem sai same thing . sure what xxx repres . pars addit request paramet . protect boolean post pars request ( org . apach . coyot . request req , request request , org . apach . coyot . respons re , respons respons ) throw except { xxx processor need set correct scheme port prior thi point , ajp13 protocol dont make sens get port from connector . . xxx processor mai have set correct scheme port prior thi point , ajp13 protocol dont make sens get port from connector . . . otherwis , us connector configur ( req . scheme ( ) . null ( ) ) { us processor specifi scheme determin secur state request . set secur ( req . scheme ( ) . equal ( http ) ) ; duplic comment code coyot adapt . java

provid support renam jsessionid

error process tld file webapp xml parser

farm war deploy fail properli unpack copi war target node

we us apach 2 . 2 . 8 mod jk 1 . 2 . 26 load balanc tomcat 5 . 5 cluster . we us custom http error code like 450 authent purpos . those code get remap 500 . error code 450 rfc2616 describ valid return code so thi bug . custom error code work fine apach 1 . 3 . 41 mod jk 1 . 2 . 25 . you can easili reproduc thi bug write simpl jsp page follow line : respons . set statu ( 450 ) ; custom http error code get remap 500er code

current default servlet accept rang request header , doesn t indic thi respons return accept rang : byte . although thi requir http 1 . 1 , set header requir order adob acrobat plugin correctli handl linear pdf s ( which can speed download allow random access pdf file ) . although s strictli necessari accord specif i can t think ani reason why thi header safe set respons from default servlet , which alwai deal static file , do so ha neg impact serv larg pdf file so i m file bug rather than rfe . return accept rang from default servlet

i ran situat where tomcat execut appropri filter request ha been forward . i m us handi urlrewrit filter implement ( from tuckei . org ) . when i forward request intern , filter had match url pattern ( web . xml file ) dispatch set both request forward were invok . trace code ( hour later ) , i found problem li insid applic dispatch code . set dispatch request path attr state attribu servlet path . meant onli match us servlet path would match , longer ( more exact ) url would fail match . exampl , us follow filter map : filter map filter name my filter filter name url pattern app level mycod . do url pattern dispatch request dispatch dispatch forward dispatch filter map would match request wa forward app level mycod . do , which should chang url pattern app would match , app level would , sinc servlet path wa app thi exampl . fix thi quit simpl . applic dispatch . java code , method process request ( ) ( which onli call forward ) , chang follow statement : state . outer request . set attribut ( applic filter factori . dispatch request path attr , servlet path ) ; us request uri instead follow : state . outer request . set attribut ( applic filter factori . dispatch request path attr , request uri ) ; thi resolv problem let all exampl abov correctli match run filter forward . i believ includ also broken same manner . similar chang do includ ( ) method applic dispatch . java like resolv issu well , though i have test thi person . nice see thi resolv 6 . 0 . 17 . thank . . . . andrzej match relev servlet filter fail when request forward .

access log valv doesn t correctli handl combin log format ( patch )

selector close .

contribut bayeux implement tomcat

extens valid doesn t handl wrap line manifest . mf

public void includ ( string rel url path , boolean flush ) throw servlet except , ioexcept { includ ( rel url path , fals ) ; xxx } just call itself seem . perhap thi should ( just guess ) : public void includ ( string rel url path , boolean flush ) throw servlet except , ioexcept { invok jsp ctxt . includ ( rel url path , fals ) ; xxx } thi came up me when i had . tag file had includ . i wa us tomcat 5 . 5 look sourc jsp context wrapper . java look like thi issu 5 . 5 well 6 ( svn trunk ) . jsp context wrapper contain infinit loop includ ( string rel url path , boolean flush )

function f : length found

sometim jsp s java code , which have been gener jasper , ha duplic variabl name . therefor jsp cannot compil tomcat deliv http statu code 500 . you get error messag like thi org . apach . jasper . jasper except : unabl compil class jsp : error occur line : 10 jsp file : test1 . jsp duplic local variabl jspx temp0 7 : c : set var = 8 : jsp : attribut name = valu = new java . util . date ( ) . string ( ) jsp : attribut 9 : c : set 10 : c : set var = b 11 : jsp : attribut name = valu = new java . util . date ( ) . string ( ) jsp : attribut 12 : c : set 13 : h1 test 1 h1 reason thi error gener variabl name like jspx temp0 , which ar creat jsp : attribut tag . begin pars jsp file counter reset 0 . everi time jsp : attribut tag occur , counter us build variabl name jspx temp counter . thereaft counter increment . unfortun counter static member jsp util class . suppos s thread 1 , which creat jspx temp4 . counter 5 . now second thread ( thread 2 ) start reset counter . afterward thread 2 creat jspx temp0 jspx temp3 . counter 4 now . thread 2 stop thread 1 continu . next variabl s name thread 1 jspx temp4 , which alreadi exist . therefor gener java class cannot compil . jasper creat duplic variabl name

add configur paramet finer tune http11apr protocol thread usag

improv apr lifecycl listen error messag

i m run debian sid , kernel 2 . 6 . 22 us tomcat 6 . 0 . 14 togeth apr 1 . 2 . 11 . special tomcat configur ( out box ) . start up tomcat i get follow error log : debug apr reveal problem ipv6 : apr socket creat ( ) assign af inet6 socket , apr socket bind tri bind af inet address which fail . info : load apach tomcat nativ librari 1 . 1 . 10 . sep 7 , 2007 6 : 05 : 16 pm org . apach . catalina . core . apr lifecycl listen init info : apr capabl : ipv6 true , sendfil true , accept filter fals , random true . sep 7 , 2007 6 : 05 : 16 pm org . apach . coyot . http11 . http11apr protocol init sever : error initi endpoint java . lang . except : socket bind fail : 22 invalid argument org . apach . tomcat . util . net . apr endpoint . init ( apr endpoint . java : 612 ) org . apach . coyot . http11 . http11apr protocol . init ( http11apr protocol . java : 121 ) org . apach . catalina . connector . connector . initi ( connector . java : 1059 ) regard erik socket bind fail tomcat startup when us apr

check permisson

we found field count alloc ar access alloc ( ) dealloc ( ) without ani protect lock . here trace log , thread http 8081 1 id : 23 : read org . apach . catalina . core . standard wrapper : alloc : 820 org . apach . catalina . core . standard wrapper valv : invok : 129 org . apach . catalina . core . standard context valv : invok : 175 org . apach . catalina . core . standard host valv : invok : 128 org . apach . catalina . valv . error report valv : invok : 104 org . apach . catalina . core . standard engin valv : invok : 109 org . apach . catalina . connector . coyot adapt : servic : 261 org . apach . coyot . http11 . http11processor : process : 844 org . apach . coyot . http11 . http11protocol http11connect handler : process : 581 org . apach . tomcat . util . net . jio endpoint worker : run : 447 java . lang . thread : run : 735 thread http 8081 4 id : 26 : write org . apach . catalina . core . standard wrapper : dealloc : 871 org . apach . catalina . core . standard wrapper valv : invok : 298 org . apach . catalina . core . standard context valv : invok : 175 org . apach . catalina . core . standard host valv : invok : 128 org . apach . catalina . valv . error report valv : invok : 104 org . apach . catalina . core . standard engin valv : invok : 109 org . apach . catalina . connector . coyot adapt : servic : 261 org . apach . coyot . http11 . http11processor : process : 844 org . apach . coyot . http11 . http11protocol http11connect handler : process : 581 org . apach . tomcat . util . net . jio endpoint worker : run : 447 java . lang . thread : run : 735 thread http 8081 4 http 8081 1 access count alloc parallel . sinc increment decrement atom , we think potenti race condit . race condit field count alloc class org . apach . catalina . core . standard wrapper

i tri config my webapp authent user client cert auth method . i verifi my jaa login modul us basic auth method successfulli authent user login . after studi tomcat 5 . 5 . 20 sourc , i found problem caus realm base . java jaasrealm . java . client cert auth method us , sslauthent call : jaasrealm . authent ( x509certif cert ) jaasrealm didn t overrid authent ( x509certif cert ) , realm base s authent us onli valid cert call get princip ( x509certif ) get princip ( string ) call get princip . howev , jaasrealm , thi function alwai return null . mean tomcat can t us jaasrealm client cert auth method . thank butler client cert authent jaasrealm work

jaasrealm work digest authent

startup , tomcat discov main port alreadi bound anoth process , fail tri execut shutdown code . some situat ( i m sure which ) , org . apach . jk . server . jkmain instanc variabl w env null thi point , which caus null pointer except when jkmain . paus ( ) call ( see stacktrac below ) . sinc thi occur within shutdown hook thread , can result dirti shutdown jvm . i ve observ thi tomcat 5 . 5 . 20 , i look over code 5 . 5 . 26 look like same problem still present . fortun , solut veri simpl . just add follow test begin jkmain . paus ( ) : ( w env = = null ) { return ; } stacktrac : sever : standard server . await : creat 8006 : java . net . bind except : address alreadi us : jvm bind java . net . plain socket impl . socket bind ( nativ method ) java . net . plain socket impl . bind ( plain socket impl . java : 359 ) java . net . server socket . bind ( server socket . java : 319 ) java . net . server socket . init ( server socket . java : 185 ) org . apach . catalina . core . standard server . await ( standard server . java : 372 ) org . apach . catalina . startup . catalina . await ( catalina . java : 615 ) org . apach . catalina . startup . catalina . start ( catalina . java : 575 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 585 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 294 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 432 ) aug 7 , 2008 3 : 25 : 34 pm org . apach . coyot . http11 . http11base protocol paus info : paus coyot http 1 . 1 http 8000 aug 7 , 2008 3 : 25 : 34 pm org . apach . catalina . connector . connector paus sever : protocol handler paus fail java . lang . null pointer except org . apach . jk . server . jk main . paus ( jk main . java : 678 ) org . apach . jk . server . jk coyot handler . paus ( jk coyot handler . java : 162 ) org . apach . catalina . connector . connector . paus ( connector . java : 1031 ) org . apach . catalina . core . standard servic . stop ( standard servic . java : 491 ) org . apach . catalina . core . standard server . stop ( standard server . java : 743 ) org . apach . catalina . startup . catalina . stop ( catalina . java : 601 ) org . apach . catalina . startup . catalina catalina shutdown hook . run ( catalina . java : 644 ) null pointer except dure shutdown jkmain . paus (

jdbcrealm . get role bad synchron caus hang w digest authent jdbcrealm cach prepar statement prepar role . , miss synchron jdbcrealm digest authent allow two thread call get role simultan so t1 do stmt . execut queri ( ) while t2 doe stmt . set string ( 1 , user name ) plu anoth . execut queri ( ) same prepar statement object . worst case , jdbc driver get confus thi , block forev wait server respons , caus all other thread try access db hang . ( thi wa observ postgr sql 8 . 3 603 jdbc4 jdbc driver ) org . postgresql . jdbc2 . abstract jdbc2statement . execut ( abstract jdbc2statement . java : 451 ) org . postgresql . jdbc2 . abstract jdbc2statement . execut flag ( abstract jdbc2statement . java : 350 ) org . postgresql . jdbc2 . abstract jdbc2statement . execut queri ( abstract jdbc2statement . java : 254 ) org . apach . catalina . realm . jdbcrealm . get role ( jdbcrealm . java : 631 ) org . apach . catalina . realm . jdbcrealm . get princip ( jdbcrealm . java : 596 ) org . apach . catalina . realm . realm base . authent ( realm base . java : 399 ) org . apach . catalina . authent . digest authent . find princip ( digest authent . java : 283 ) org . apach . catalina . authent . digest authent . authent ( digest authent . java : 176 ) jdbcrealm . get role bad synchron caus hang w digest authent

startup listen error messag unhelp

coyot reader read line return null some post request bodi ar multipl max line length size

potenti null pointer except org . apach . catalina . servlet . cgiservlet

i us latest 6 . 0 svn snapshot . i store deploy war webapp dist ( asid webapp ) . thi my setup : bash 3 . 2 ls catalina base conf log temp tomcat dist webapp webapp dist work bash 3 . 2 ls webapp dist sampl . war bash 3 . 2 cat conf catalina localhost sampl . xml context doc base = { catalina . base } webapp dist sampl . war thi end up : warnung : doc base home juergen java tomcat webapp dist sampl . war insid host app base ha been specifi , ignor doc base ignor even subdir app base

hi , i overrid state transfer timeout : manag class name = org . apach . catalina . ha . session . delta manag state transfer timeout = 10 expir session shutdown = fals notifi listen replic = true delta manag continu log default timeout valu ( ie : thi oper timeout session state ha been receiv within 60 second . ) : 2008 07 01 14 : 31 : 30 , 419 warn org . apach . catalina . ha . session . delta manag manag localhost manag , request session state from org . apach . catalina . tribe . membership . member impl tcp : { 10 , 64 , 104 , 55 } : 15000 , { 10 , 64 , 104 , 55 } , 15000 , aliv = 18586 , id = { 62 91 70 63 111 50 70 33 104 41 48 32 91 34 83 55 } , payload = { } , command = { } , domain = { } , . thi oper timeout session state ha been receiv within 60 second . 2008 07 01 14 : 31 : 35 , 310 warn org . apach . catalina . ha . cluster listen context manag doesn t exist : localhost host manag actual us correct timeout valu ( ie : time out after 10 , 100 ms ) : 2008 07 01 14 : 31 : 40 , 518 error org . apach . catalina . ha . session . delta manag manag localhost manag : session state send 01 07 08 14 : 31 receiv , time out after 10 , 100 ms . thi onli incorrect messag , quit annoi especi coupl fact abov configur onli document tomcat 5 ( where syntax subtli differ ) . delta manag alwai report default timeout valu receiv session state startup

tomcat choos wrong host us mod jk

mcast servic impl doe close socket stop ( ) claim . mere call leav group ( ) , which suffici stop receiv messag , doe close socket . thi caus file descriptor leak each time servic stop . add ; socket . close ( ) ; after leav group ( ) ; mcast servic impl leak socket .

dir context urlconnect format date header valu per http spec

http post request handl correctli more than space between post url

jsp file ha byte order mark . attribut set utf 8 ( upper case ) file ha byte order mark , compil work fine . { code } 12 : 32 : 16 , 946 error jsp servlet . servic ( ) servlet jsp threw except org . apach . jasper . jasper except : dialog . jsp ( 2 , 0 ) page encod specifi xml prolog ( utf 8 ) differ from specifi page direct ( utf 8 ) org . apach . jasper . compil . default error handler . jsp error ( default error handler . java : 40 ) org . apach . jasper . compil . error dispatch . dispatch ( error dispatch . java : 407 ) org . apach . jasper . compil . error dispatch . jsp error ( error dispatch . java : 236 ) org . apach . jasper . compil . valid direct visitor . compar page encod ( valid . java : 362 ) org . apach . jasper . compil . valid direct visitor . visit ( valid . java : 197 ) org . apach . jasper . compil . node page direct . accept ( node . java : 590 ) org . apach . jasper . compil . node node . visit ( node . java : 2338 ) org . apach . jasper . compil . node visitor . visit bodi ( node . java : 2388 ) org . apach . jasper . compil . node visitor . visit ( node . java : 2394 ) org . apach . jasper . compil . node root . accept ( node . java : 489 ) org . apach . jasper . compil . node node . visit ( node . java : 2338 ) org . apach . jasper . compil . valid . valid ( valid . java : 1700 ) org . apach . jasper . compil . compil . gener java ( compil . java : 178 ) org . apach . jasper . compil . compil . compil ( compil . java : 306 ) org . apach . jasper . compil . compil . compil ( compil . java : 286 ) org . apach . jasper . compil . compil . compil ( compil . java : 273 ) org . apach . jasper . jsp compil context . compil ( jsp compil context . java : 566 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 316 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 336 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 265 ) javax . servlet . http . http servlet . servic ( http servlet . java : 803 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . applic dispatch . invok ( applic dispatch . java : 654 ) org . apach . catalina . core . applic dispatch . process request ( applic dispatch . java : 445 ) org . apach . catalina . core . applic dispatch . do forward ( applic dispatch . java : 379 ) org . apach . catalina . core . applic dispatch . forward ( applic dispatch . java : 292 ) de . cit . jsp . control . dispatch servlet . forward ( dispatch servlet . java : 286 ) de . cit . jsp . control . dispatch servlet . do get ( dispatch servlet . java : 272 ) javax . servlet . http . http servlet . servic ( http servlet . java : 690 ) javax . servlet . http . http servlet . servic ( http servlet . java : 803 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) de . cit . util . javax . servlet . valid filter . do filter ( valid filter . java : 108 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) de . cit . util . javax . servlet . jsp . xhtml content type filter . do filter ( xhtml content type filter . java : 36 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . jboss . web . tomcat . filter . repli header filter . do filter ( repli header filter . java : 96 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 235 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 230 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 175 ) org . jboss . web . tomcat . secur . secur associ valv . invok ( secur associ valv . java : 179 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 432 ) org . jboss . web . tomcat . secur . jacc context valv . invok ( jacc context valv . java : 84 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 127 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . jboss . web . tomcat . servic . jca . cach connect valv . invok ( cach connect valv . java : 157 ) org . apach . catalina . authent . singl sign . invok ( singl sign . java : 420 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 262 ) org . apach . coyot . ajp . ajp processor . process ( ajp processor . java : 437 ) org . apach . coyot . ajp . ajp protocol ajp connect handler . process ( ajp protocol . java : 366 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 446 ) java . lang . thread . run ( thread . java : 619 ) { code } case insensit camparison org . apach . jasper . compil . valid . compar page encod ( . . . ) seem fix problem : { code } compar page encod specifi variou place , throw except case page encod mismatch . param page dir enc valu page encod attribut page direct param page dir page direct node throw jasper except case page encod mismatch privat string compar page encod ( string page dir enc , node . page direct page dir ) throw jasper except { node . root root = page dir . get root ( ) ; string config enc = root . get jsp config page encod ( ) ; compar page encod attribut page direct encod specifi jsp config element whose url pattern match thi page . treat utf 16 , utf 16be , utf 16le ident . ( config enc = null ) { ( page dir enc . equal ignor case ( config enc ) ( page dir enc . upper case ( ) . start ( utf 16 ) config enc . upper case ( ) . start ( utf 16 ) ) ) { err . jsp error ( page dir , jsp . error . config pagedir encod mismatch , config enc , page dir enc ) ; } els { return config enc ; } } compar page encod attribut page direct encod specifi xml prolog ( onli xml syntax , onli jsp document contain xml prolog encod declar ) . treat utf 16 , utf 16be , utf 16le ident . ( ( root . xml syntax ( ) root . encod specifi prolog ( ) ) root . bom present ( ) ) { string page enc = root . get page encod ( ) ; ( page dir enc . equal ignor case ( page enc ) ( page dir enc . upper case ( ) . start ( utf 16 ) page enc . upper case ( ) . start ( utf 16 ) ) ) { err . jsp error ( page dir , jsp . error . prolog pagedir encod mismatch , page enc , page dir enc ) ; } els { return page enc ; } } return page dir enc ; } { code } jsp compil except page encod = utf 8 file byte order mark

i m us seam seam app depend upon seam applic initi befor you can do much anyth seam . said seam put some hook session did activ ( ) session did passiv ( ) event . becaus when i start up my app i m get seam illeg state except becaus context initi ( ) event fire after session did activ ( ) so seam yet initi s session hook ar fire . what make me think thi bug session passiv ( ) correctli call befor context destroi ( ) so would seem session did activ ( ) call befor context initi ( ) would inconsist behavior . so sum up i think tomcat should fire context session event follow order : context initi session did activ session passiv context destroi side note tomcat 5 follow what i think complet wrong consist order fire event thi order : session did activ context initi context destroi session passiv session did activ ( ) call befor context initi (

jsp : text get confus other : text element jsp tag file

suspici url pattern warn ar log wrong webapp , actual us them . log event ar come from secur collect . java . suspici url pattern warn log wrong webapp

i have set compress = compress mime type = text html server . xml . appear valu compress mime type ignor . my xml respons ar all come back gzip . i switch compress = off respons ar gzip , soon i turn , regardless valu compress mime type , xml respons ar come back gzip . full connector tag follow . note thi just exampl i have tri mani valu compress mime type ( do includ text xml ) respons ar still compress . connector port = 7630 address = { jboss . bind . address } max thread = 20 min spare thread = 4 max spare thread = 10 strategi = ms max http header size = 8192 empti session path = true enabl lookup = fals redirect port = 7643 accept count = 16 connect timeout = 20000 disabl upload timeout = true compress = off compress mime type = text html , text javascript , applic x javascript , applic javascript compress mime type attribut ignor

tomcat start s locat launch from path ( pound ) charact somewher . you ll find all inform given mail thread tomcat user , includ some develop specif inform . part problem usag file . url urlclassload . . . i d realli appreci thi problem could fix work around ( see mail thread hint ) . btw . same appli version 5 . 5 probabl earlier version too . thank tomcat path pound sign ( ) class found except

reproduc : copi expand file xxx . war file folder tomcat webapp xxx . war bug : tomcat load app twice webapp expand folder name webapp xxx . war load twice

session statist command manag fail unknown command session

class cast except due bad tag handler pool name gener two differ tag

non compliant annot

when jsp compil fork javac process , should check see what current endors directori ar ( check system properti java . endors . dir otherwis , class end up miss jsp page do properli compil . we experienc problem when we explicitli set java . endors . dir properti command line , jsp compil did us when javac wa fork . i have patch org . apach . jasper . compil . compil support thi : src . origin jakarta tomcat jasper jasper2 src share org apach jasper compil compil . java tue jun 15 17 : 30 : 35 2004 src org apach jasper compil compil . java thu sep 16 00 : 05 : 14 2004 349 , 358 349 , 369 extdir . set path ( ext ) ; javac . set extdir ( extdir ) ; info . append ( extens dir = ext n ) ; } add endors directori string endors = system . get properti ( java . endors . dir ) ; ( endors = null ) { javac . implement specif argument endors arg = javac . creat compil arg ( ) ; endors arg . set line ( j djava . endors . dir = endors ) ; info . append ( endors dir = endors n ) ; } els { info . append ( endors dir specifi n ) ; } configur compil object javac . set encod ( java encod ) ; javac . set classpath ( path ) ; javac . set debug ( ctxt . get option ( ) . get class debug info ( ) ) ; true , i should probabl check ctxt . get option ( ) . get fork ( ) ( ) well , sinc i alwai fork doesn t matter me . java . endors . dir us when jsp compil fork

i m try us jstl 1 . 1 thi version tomcat have both saxon crimson my web app . we have crimson saxon our webapp lib tomcat tri us crimson xml parser when read web . xml compil jsp we get prefix error : org . apach . jasper . jasper except : h3 valid error messag from tag librari valid c h3 p null : java . lang . illeg state except : can t declar ani more prefix thi context p h3 valid error messag from tag librari valid fmt h3 p null : java . lang . illeg state except : can t declar ani more prefix thi context p we remov crimson , tomcat us saxon ( aelfr parser ) thi fail read web . xml ( javax . xml . parser . parser configur except : aelfr parser namespac awar ) we remov saxon crimson we ar okai ( default xerc tomcat endors directori ) seem me tomcat us parser my web app read web . xml rather than us xerc from endors directori . same web app run without problem version 5 . 0 . 16 . tomcat seem us servic provid mechan 5 . 0 . 25 i have properti file c : java jakarta tomcat 5 . 0 . 25 work catalina localhost diabet loader meta inf servic ( can t find ani document thi ) . i m us more than parser won t thi caus problem tomcat set onli parser xslt processor here ani comment ar gratefulli receiv . thank , peter nevil xml parser load problem contain

tld config class ( org . apach . catalina . startup ) ask class loader all parent class loader order get url assum url ar us file protocol . when tomcat embed , sometim url ar alwai us file protocol new file ( ) fail . given patch skip url ar us file protocol ( avoid ugli npe new file ( url i . uri ( ) ) ; call tld config scan url ar file

hi , i am memori profil webapp my compani becaus we suspect ha memori leak when redeploi . thi webapp ha redeploi sever time week secur reason ( most time undeploi ) memori leak forc us shutdown tomcat onc week avoid oom except . i m us jvm1 . 5 tomcat 6 . 0 . 13 ( also tri 6 . 0 . 14 todai 6 . 0 . 16 ) , yourkit profil tool . i have made test both linux window . i have creat jmeter test deploi app us manag , make some request app undeploi us again manag app loop . after some redeploy , i got my out memori except . i check my profil tool found my own class were correctli destroi , class retain more memori were ( list heirarchi ) : org . apach . catalina . core . applic context dispatch data org . apach . catalina . core . applic context mapper org . apach . catalina . core . standard context context org . apach . tomcat . util . http . mapper . mapper resourc org . apach . tomcat . util . http . mapper . mapper context cach org . apach . name . resourc . proxi dir context cach org . apach . name . resourc . resourc cach org . apach . name . resourc . cach entri number object each class were exactli number time i had redeploi webapp . i have check content cach entri insid cach entri ha attribut name content ar jsp tld file my app . ar mani cach entri same jsp attribut time webapp ha been reload , so i guess clean cach entri resourc context shutdown . reproduc thi , simpl webapp 2 jsp taglibrari can us . deploi undeploi mani time so you can see how count object grow memori . cleanup org . apach . name . resourc . cach entri resourc ( memori leak )

org . apach . catalina . ssi . ssiprocessor method pars param name broken . i have ssi direct like set var = test valu = blubb method detect three paramet instead two . thi becaus ar two consecut escap charact . although first detect correctli next isn t becaus flag escap still set true , although thi charact isn t escap anymor . you have replac boolean escap = fals ; ( ; b idx cmd . length ( ) quot = 2 ; b idx ) { char c = cmd . char ( b idx ) ; need skip escap charact ( c = = escap ) { escap = true ; b idx ; continu ; } escap = fals ; ( c = = ) quot ; } ( ; b idx cmd . length ( ) quot = 2 ; b idx ) { char c = cmd . char ( b idx ) ; need skip escap charact ( c = = ) { b idx ; continu ; } ( c = = ) quot ; } just remov flag escap suffici , becaus you don t have rememb whether last charact wa escap should have influenc consecut charact . bug still exist head revis repositori . ssi handl escap charact broken

html entiti which ar contain ssi set direct aren t resolv ssi filter ( contrari what done mod includ apach http ) . mod includ resolv all html entiti most attribut valu ssi direct . also resolv . ssi filter tomcat resolv all escap charact which ar escap backslash , html entiti all . apart from , give encod entiti should differ from give encod = none ssi echo direct . should replac all invalid html charact valid html entiti other should do noth . encod especi import you wan t store html comment within ssi variabl . i want store variabl test valu testvalu x set var = test valu = testvalu x mod includ you must write : set var = test valu = 45 ; 45 ; testvalu x 45 ; 45 ; tomcat ssi you must write : set var = test valu = testvalu x should differ whether i output thi variabl echo var = test encod = none which should lead testvalu x , echo var = test encod = entiti which should lead lt ; testvalu quot ; x quot ; gt ; html entiti resolv ssi filter

el express evalu slow due synchron caus jsp factori . get default factori

function mapper impl . function possibl write extern fail class ha just been de serialis serialis again . you look write extern : public void write extern ( object output out ) throw ioexcept { out . write utf ( ( thi . prefix = null ) thi . prefix : ) ; out . write utf ( thi . local name ) ; out . write utf ( thi . m . get declar class ( ) . get name ( ) ) ; out . write utf ( thi . m . get name ( ) ) ; out . write object ( reflect util . type name arrai ( thi . m . get paramet type ( ) ) ) ; } you can see externalis function invok us refer method itself . you look read extern howev : public void read extern ( object input ) throw ioexcept , class found except { thi . prefix = . read utf ( ) ; ( . equal ( thi . prefix ) ) thi . prefix = null ; thi . local name = . read utf ( ) ; thi . owner = . read utf ( ) ; thi . name = . read utf ( ) ; thi . type = ( string ) . read object ( ) ; } you can see doesn t restor method after deserialis . method restor access , howev s serialis perform write extern throw npe ( m still null ) . fix either get method reconstruct soon deserialis complet perhap bit more effici , write extern chang m null externalis us compon method : public void write extern ( object output out ) throw ioexcept { out . write utf ( ( thi . prefix = null ) thi . prefix : ) ; out . write utf ( thi . local name ) ; ( m = = null ) { out . write utf ( thi . owner ) ; out . write utf ( thi . name ) ; out . write object ( thi . type ) ; } els ( thi . m = null ) { out . write utf ( thi . m . get declar class ( ) . get name ( ) ) ; out . write utf ( thi . m . get name ( ) ) ; out . write object ( reflect util . type name arrai ( thi . m . get paramet type ( ) ) ) ; } } function mapper impl . function throw npe certain circumst

add possibl request queue size executor via jmx

author implement realm base , ha resourc permiss method fulli servlet specif compliant . spec ( both 2 . 4 2 . 5 ) state : . . . secur constraint doe contain author constraint shall combin author constraint name impli role allow unauthent access . special case author constraint name role shall combin ani other constraint overrid affect caus access preclud . . . . tomcat thi work fine long aren t weird ( legal ) combin secur constraint same url . exampl : secur constraint web resourc collect url pattern some url url pattern http method post http method web resourc collect auth constraint , allow everyon secur constraint secur constraint web resourc collect url pattern some url url pattern http method post http method web resourc collect role , allow noon auth constraint secur constraint ( we ignor thi kind configur pretti pointless , ) spec dictat post some url index . html should deni access . tomcat grant . ( both 5 . 5 . 23 6 . 0 . 14 do ) exampl 2 : secur constraint web resourc collect url pattern some url url pattern http method post http method web resourc collect role , allow noon auth constraint secur constraint secur constraint web resourc collect url pattern some url url pattern http method post http method web resourc collect auth constraint role name role name auth constraint secur constraint now get interest . strict mode , access some url index . html deni ( regardless web . xml configur secur role role user ha ) . auth onli mode , access alwai grant , strict auth onli mode access grant ar web . xml configur secur role . now mode ar tomcat addit spec , i feel access should have been deni all mode , both stai line spec keep behaviour predict . realm base author via ha resourc permiss fulli servlet spec compliant

servlet input stream still readabl even when close

we re write applic process request us both normal servlet comet processor . normal servlet handl user authent logout ( among other thing ) . onc user ha been authent , client make comet request , which open until server ha someth push client . when user decid log out , we need stop process comet event client . i enabl comet connect manag valv context . xml , hope i would get end event when session goe awai . instead , i get illeg state except : mar 10 , 2008 2 : 05 : 41 pm org . apach . catalina . connector . coyot adapt event sever : except error occur contain dure request process java . lang . illeg state except : cannot creat session after respons ha been commit org . apach . catalina . connector . request . do get session ( request . java : 2301 ) org . apach . catalina . connector . request . get session ( request . java : 2075 ) org . apach . catalina . valv . comet connect manag valv . event ( comet connect manag valv . java : 311 ) org . apach . catalina . core . standard host valv . event ( standard host valv . java : 179 ) org . apach . catalina . valv . valv base . event ( valv base . java : 200 ) org . apach . catalina . core . standard engin valv . event ( standard engin valv . java : 128 ) org . apach . catalina . connector . coyot adapt . event ( coyot adapt . java : 198 ) org . apach . coyot . http11 . http11nio processor . event ( http11nio processor . java : 749 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . event ( http11nio protocol . java : 653 ) org . apach . tomcat . util . net . nio endpoint socket processor . run ( nio endpoint . java : 2080 ) java . util . concurr . thread pool executor worker . run task ( thread pool executor . java : 885 ) java . util . concurr . thread pool executor worker . run ( thread pool executor . java : 907 ) java . lang . thread . run ( thread . java : 619 ) presum my servlet handl logout request , after send respons client , call invalid ( ) http session . subsequ , comet connect manag valu . event ( ) call request . get session ( true ) , result illeg state except . illeg state except when us comet connect manag valv

sever : error start endpoint java . net . bind except : cannot assign request address : 2217 org . apach . tomcat . util . net . jio endpoint . init ( jio endpoint . java : 501 ) org . apach . tomcat . util . net . jio endpoint . start ( jio endpoint . java : 515 ) org . apach . coyot . http11 . http11protocol . start ( http11protocol . java : 203 ) org . apach . catalina . connector . connector . start ( connector . java : 1131 ) org . apach . catalina . core . standard servic . start ( standard servic . java : 531 ) org . apach . catalina . core . standard server . start ( standard server . java : 710 ) org . apach . catalina . startup . catalina . start ( catalina . java : 578 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sai which address bind wa attempt would acceler error resolut quit bit cite attempt address when throw cannot assign request address

head request cannot go through request dispatch includ .

default servlet docu 6 . 0 sai about attibut readm file : directori list present , readm file mai also present list . thi file insert . . . . . thi wa true 5 . 5 . x . 6 . 0 . 14 crash file absent list directori . javax . servlet . servlet except : error open readm resourc org . apach . catalina . servlet . default servlet . get readm ( default servlet . java : 1418 ) thi new behaviour block list big directori tree manag other , where work around nor feasibl . work around 1 : readm file everi subdir , empti ( length = 0 ) none want ( subsequ chang us xsl transform ) work around 2 : chang mai must docu . repair : fix default servlet from web . xml : servlet servlet name default servlet name servlet class org . apach . catalina . servlet . default servlet servlet class init param param name list param name param valu true param valu init param init param param name global xslt file param name param valu d : www serv intra meva dir li . xsl param valu init param init param param name readm file param name param valu readm . htm param valu init param load startup 1 load startup servlet dir list crash readm file present

thi my nio connector configur server . xml connector accept count = 100 enabl lookup = fals port = 80 protocol = org . apach . coyot . http11 . http11nio protocol acceptor thread count = 2 socket . buffer pool = 1 connect timeout = 60000 max keep aliv request = 1 max thread = 200 min spare thread = 25 redirect port = 8443 when i am start my tomcat give follow error consol sever time sever : java . lang . null pointer except org . apach . tomcat . util . net . nio endpoint . set socket option ( nio endpoint . java : 985 ) org . apach . tomcat . util . net . nio endpoint acceptor . run ( nio endpoint . java : 1169 ) java . lang . thread . run ( thread . java : 595 ) error while start tomcat

when log trace mode lower , org . apach . catalina . loader . webapp class loader . find class ( string ) call get class loader ( ) without privileg block . secur enabl , thi caus secur except runtim permiss get class loader grant . webapp class loader . find class call get class loader without privileg

when i regist same class implement servlet context listen twice more context initi method onli get call onc . servlet specif ( 2 . 4 2 . 5 ) sai conform contain ha call listen same order thei ar regist deploy descriptor . case listen class regist twice mention explicitli specif , though . exampl : listen listen class test . servlet context listener1 listen class listen listen listen class test . servlet context listener2 listen class listen listen listen class test . servlet context listener1 listen class listen test . servlet context listener1 test . servlet context listener2 get call , test . servlet context listener1 doe get call again . apach tomcat 5 . 5 . 25 ha same bug . multipl registr same servlet context listen class possibl

set up ssl connector keystor jk format : connector . . . sslenabl = true keystor file = tomcat . keystor keystor type = jk let s sai you need custom truststor ( e . g . authent self sign client certif ) , thi truststor also need some your webapp , onli tomcat . natur thing do configur thi truststor global whole jvm , server . xml . let s also assum thi truststor differ format ( e . g . pkc 12 ) . so befor start tomcat , you do thi : export java opt = djavax . net . ssl . trust store = trust . keystor djavax . net . ssl . trust store type = pkcs12 well , doesn t work . you look tomcat log catalina . out , you see keystor relat except . upon further debug , you discov problem tomcat try open truststor were jk format , even though clearli specifi type pkcs12 java opt abov . tomcat ignor javax . net . ssl . trust store type system properti

obtain follow null pointer except , stack trace below java . lang . null pointer except org . apach . catalina . manag . htmlmanag servlet . list ( htmlmanag servlet . java : 437 ) org . apach . catalina . manag . htmlmanag servlet . do get ( htmlmanag servlet . java : 136 ) code : arg 11 = new integ ( context . get manag ( ) . get max inact interv ( ) 60 ) ; seemingli get manag ( ) return null . htmlmanag servlet null pointer except list context

i ve built small test servlet ( includ below ) show thi behaviour . i upload data tomcat ( configur us http 1 . 1 coyot connector ) us chunk transfer encod put , result ( i . e . what i read us servlet s request . get input stream ( ) corrupt . thi onli happen larg put ( happen everi time i tri ( about 10 ) larg put i wa test someth around 700 k b , anoth thing about 1 mb , doe alwai corrupt same wai . i did see ani corrupt small file ( 50 k b smaller ) , though i didn t test thi extens . total length data read exactli correct ( 712080 byte my first test ) . first point corrupt file , chunk header appear output ( r n1000 r n ) follow correct data from about 700 byte later , second copi ( correct place , i think ) corrupt data ( i . e . correct data , follow chunk header , follow some data repeat , second instanc which correct place so first instanc produc instead correct data point input ) . test servlet follow : import java . io . ; import javax . servlet . ; import javax . servlet . http . ; public class test extend http servlet { public void do put ( http servlet request req , http servlet respons re ) throw servlet except , ioexcept { file output stream fo = new file output stream ( tmp servlet out ) ; input stream = req . get input stream ( ) ; byte buf = new byte 2000 ; int ret ; while ( ( ret = . read ( buf ) ) 0 ) { fo . write ( buf , 0 , ret ) ; } fo . close ( ) ; . close ( ) ; print writer pw = re . get writer ( ) ; pw . println ( done ) ; pw . flush ( ) ; pw . close ( ) ; } } coyot connector doe correctli deal larg put when us chunk transfer encod

myjsp . jsp : hello tag1 tag1 . tag : tag2 tag2 . tag : world crash ( null pointer ) while try load tag2 . class , call tag file processor . load tag file . veri initi analysi : tag file processor . load tag file creat wrapper , ctxt . get tag file jar url ( tag file path ) return null nest . tag . thu jsp compil context . compil jsp cctx . packag file = = fals , so out date test wrong so tag2 . tag compil , thu class cannot load . problem also appear tag packag . jar , so more go . work around creat dummi . jsp call . tag leaf first order so . class file ar creat . cannot jspc precompil jsp nest . tag file

java . lang . null pointer except from org . apach . jasper . compil . servlet writer . print multi ln ( ) valid jspx empti jsp : scriptlet element

imposs invok remov role other mbean method set attribut mbean server caus same bug manag bean . java both line 545 ( get setter method ) 604 ( get invok method ) : object = thi ; must replac : object = bean ; fortun get getter method correct . mbean server invok issu

i ll attach sampl web applic reproduc error . note thi error onli occur when us tomcat 6 . 0 . x ( i . e . work jetti us sun s el ri ) . moreov doesn t matter which jsf implement you re us reproduc error ( i just want mention s definit bug my face even though follow stack trace show face except ) . except stack trace : javax . face . face except : except while call broadcast compon : { compon path : class : javax . face . compon . uiview root , view id : home . jsp class : javax . face . compon . html . html form , id : j id jsp 923754602 1 class : javax . face . compon . html . html command button , id : j id jsp 923754602 3 } javax . face . compon . uicompon base . broadcast ( uicompon base . java : 494 ) javax . face . compon . uicommand . broadcast ( uicommand . java : 105 ) javax . face . compon . uiview root . broadcast phase ( uiview root . java : 292 ) javax . face . compon . uiview root . process ( uiview root . java : 209 ) javax . face . compon . uiview root . process applic ( uiview root . java : 117 ) org . apach . myfac . lifecycl . invok applic executor . execut ( invok applic executor . java : 32 ) org . apach . myfac . lifecycl . lifecycl impl . execut phase ( lifecycl impl . java : 95 ) org . apach . myfac . lifecycl . lifecycl impl . execut ( lifecycl impl . java : 70 ) javax . face . webapp . face servlet . servic ( face servlet . java : 144 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 233 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 175 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 128 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 102 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 263 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 844 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 584 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 447 ) java . lang . thread . run ( thread . java : 619 ) caus : org . apach . jasper . el . jsp elexcept : home . jsp ( 12 , 3 ) { number bean . number } java . lang . illeg argument except : argument type mismatch org . apach . jasper . el . jsp valu express . set valu ( jsp valu express . java : 94 ) org . apach . myfac . event . set properti action listen . process action ( set properti action listen . java : 72 ) javax . face . event . action event . process listen ( action event . java : 48 ) javax . face . compon . uicompon base . broadcast ( uicompon base . java : 489 ) . . . 20 more caus : java . lang . illeg argument except : argument type mismatch sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) javax . el . bean elresolv . set valu ( bean elresolv . java : 108 ) javax . el . composit elresolv . set valu ( composit elresolv . java : 68 ) org . apach . myfac . el . unifi . resolv . face composit elresolv . access 501 ( face composit elresolv . java : 46 ) org . apach . myfac . el . unifi . resolv . face composit elresolv 6 . invok ( face composit elresolv . java : 132 ) org . apach . myfac . el . unifi . resolv . face composit elresolv . invok ( face composit elresolv . java : 148 ) org . apach . myfac . el . unifi . resolv . face composit elresolv . set valu ( face composit elresolv . java : 128 ) org . apach . el . parser . ast valu . set valu ( ast valu . java : 114 ) org . apach . el . valu express impl . set valu ( valu express impl . java : 249 ) org . apach . jasper . el . jsp valu express . set valu ( jsp valu express . java : 85 ) . . . 23 more miss el coercion caus argument type mismatch

under certain condit , resourc cach implement us servlet jsp engin ( org . apach . name . resourc ) doe detect file cach ha been modifi therefor return previou content file . thi happen onli when file content ar modifi file length doesn t chang until time first chang file detect after server startup reproduc problem , put attach test . jsp test . txt root web app do follow . ( i us tomcat 6 s trunk test ) cat test . txt abcd telnet . 9080 try 0 . 0 . 0 . 0 . . . connect . . escap charact . get test . jsp http 1 . 0 http 1 . 1 200 ok server : apach coyot 1 . 1 set cooki : jsessionid = ; path = content type : text html content length : 26 date : wed , 23 mai 2007 23 : 03 : 05 gmt connect : close file content = abcd connect . close foreign host . cat test . txt ( chang content size ) efgh telnet . 9080 try 0 . 0 . 0 . 0 . . . connect . . escap charact . get test . jsp http 1 . 0 http 1 . 1 200 ok server : apach coyot 1 . 1 set cooki : jsessionid = ; path = content type : text html content length : 26 date : wed , 23 mai 2007 23 : 04 : 24 gmt connect : close file content = abcd servlet context . get resourc stream return stale data

http spec violat when gener http redirect folder without trail slash

org . apach . el . lang . evalu context doesn t pass local wrap elcontext doe org . apach . jasper . el . elcontext wrapper . thi prohibit us local s origin purpos . el evalu context wrapper hide local

class org . apach . el . lang . elarithmet ha follow code snippet : throw new illeg argument except ( messag factori . get ( el . convert , obj , obj type ) ) ; kei el . convert doesn t exist org . apach . el . messag . result , i m receiv except : java . util . miss resourc except : can t find resourc bundl java . util . properti resourc bundl , kei el . convert java . util . resourc bundl . get object ( resourc bundl . java : 325 ) java . util . resourc bundl . get string ( resourc bundl . java : 285 ) org . apach . el . util . messag factori . get arrai ( messag factori . java : 67 ) org . apach . el . util . messag factori . get ( messag factori . java : 47 ) org . apach . el . lang . elarithmet . coerc ( elarithmet . java : 367 ) org . apach . el . lang . elarithmet . add ( elarithmet . java : 238 ) org . apach . el . parser . ast plu . get valu ( ast plu . java : 24 ) org . apach . el . valu express impl . get valu ( valu express impl . java : 186 ) org . apach . el . lang . elarithmet . coerc throw miss resourc except kei el . convert

html manag webapp done work correctli when click expir session button . idl param miss from form . follow html show thi bug . . . form method = post action = manag html expir path = small nbsp ; input type = submit valu = expir session nbsp ; idl ge ; nbsp ; input type = text name = expir size = 5 valu = 30 nbsp ; minut nbsp ; small form name text input should idl . cannot expir session via html manag webapp

us context class loader config option doesn t work right . ignor when set user class name role class name s respect when login context creat , insuffici , becaus all need class ar necessarili load until login context . login ( ) call patch follow . i m abl keep everyth relat jaasrealm my webapp . jaasrealm us context class loader ha problem

class org . apach . catalina . connector . respons reset intern hold coyot respons output buffer dure reset ( ) : public void reset ( ) { ( includ ) return ; ignor ani call from includ servlet coyot respons . reset ( ) ; output buffer . reset ( ) ; } anyon ha alreadi set charact encod ( e . g . utf 8 ) alreadi got writer , than all follow invoc request . set charact encod ( ) do noth , becaus intern save flag us writer reset . thi veri annoi , becaus coyot respons . reset ( ) , reset charact encod iso8859 1 . so i have chang chang reset charat encod utf 8 . i ll think you reset respons , you should also reset us writer flag add anoth special flag , work thi circumst . respons . set charact encod ( ) fail after respons . get writer ( ) respons . reset (

servlet context . get resourc stream ( ) doe follow api spec path

context war file exist server . xml , manag upload new . war file , doe expand , necessari directori doe exist , directori exist , overwritten , so you see old applic . see server . xml host name = xxx app base = webapp unpack war = true context path = yyi . . . i don t have context yyi server . xml , autodeploi work expect . even you sai , remov context from manag applic , alwai applic view , you can t remov . final , never clean up work directori applic yyi , which i guess , just subsequ error abov behaviour . autodeploy unpack war = true doe work , when context war file exist server . xml

2 compress relat attribut http connector ar : compress = off forc integ val document state integ val implement : compress = min compress size = integ val min compress size = integ val ( document 5 . 5 . 12 doesnt mention thi all , read thi server . xml ) problem documen give impress onli set compress = some integ val suffici , howev wai code written , valu min compress size alwai overrid valu specifi compress field . even min compress size isnt set , still get default valu 2048 overrid whatev valu wa compress field . i look implement http11 connector found follow code might culprit : org . apach . coyot . http11 . http11base protocol . http11connect handler . init processor . set compress ( proto . compress ) ; processor . set compress min size ( proto . compress min size ) ; sinc set compress min size call after compress min size , valu overrid valu read from compress atttribut . i have look code tomcat 6 . 0 also , problem appear still present . compress min compress size attribut properli implement

tomcat throw java . lang . illeg state except due attempt respons . send redirect ( ) after time matter ha come gone . . . , thi appear symptom bad . jsp pars runtim . = = = = = = = = = = = = = = = = = = = = = = = = = = org . apach . jasper . jasper except : except jsp : buslog . jsp : 42 39 : ( session . get attribut ( auth ) = = null ) { 40 : session . set attribut ( messag user , authent fail . ) ; 41 : you . should pars thi ( ) ; 42 : respons . send redirect ( . index . jsp ) ; 43 : } 44 : 45 : ( session . get attribut ( auth ) = null ) { = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = line ar comment out sourc , should conceiv caus runtim error . chang respons . send redirect ( . . . ) respons . send abend omg ( . . . ) suppress error . i am provid complet sourc necessari . build execut environ ar net bean 5 . 5 . 1 bundl tomcat 5 . 5 . 17 . improp pars respons . send redirect ( ) jsp sourc

fix litmu warn webdav servlet

i wa get some rather unhelp error messag when try deploi web . xml includ illeg servlet name . i track them down thi part org apach catalina core standard wrapper . java : } catch ( except ex ) { log . info ( error regist servlet jmx thi ) ; } thi should probabl chang : log . info ( error regist servlet jmx ex ) ; same thing catch block ten line below thi . i first notic thi 5 . 5 . 23 , thi code still present 6 . 0 trunk . standard wrapper . regist jmx ( ) doesn t log except correctli

webdav servlet return incorrect valu href properti when map url prefix , instead

apr sendfil thread leak memori ad sendfil data object hash map fail remov them . apr sendfil thread leak memori

standard context . java read public string find statu page ( int statu ) { return ( ( string ) statu page . get ( new integ ( statu ) ) ) ; } thi wrong should public string find statu page ( int statu ) { return ( ( error page ) statu page . get ( new integ ( statu ) ) ) . get locat ( ) ; } regard , lg class cast except org . apach . catalina . core . standard context . find statu page ( int )

abstract replic map . member disappear execut more than necess .

keystor file paramet , when specifi rel , treat rel catalina base catalina . base properti nio end point

org . apach . catalina . core . applic dispatch . do includ ( servlet request request , servlet respons respons ) , after invok ( ) call perform includ , request respons object ar normal unwrap . howev , servlet except ioexcept thrown , unwrap doe take place . thi lead problem environ which cross context includ ar perform . exampl , 1 . web app perform includ servlet web app b 2 . servlet web app b throw servlet except 3 . web app catch servlet except attempt forward error jsp . step 3 abov fail due fact request ha been unwrap . activ request contain servlet context web app b jsp file found . after fail includ , request respons unwrap

activ check doe work correctli when tomcat restart

hi all , i had servlet map contain plu sign ( thei were creat jsp c ) , e . g . : servlet map servlet name org . apach . jsp . suchergebni 005fbu 002bbb jsp servlet name url pattern suchergebni bu bb . jsp url pattern servlet map thi map doe work ( refer class present ) when i chang origin file name jsp plu sign ar replac minu sign follow map result : servlet map servlet name org . apach . jsp . suchergebni 005fbu 002dbb jsp servlet name url pattern suchergebni bu bb . jsp url pattern servlet map now map work . therefor i assum bug handl servlet map plu sign url pattern . plu sign url pattern servlet map doe work

bug exampl code dummi cart . java

tomcat version : 6 . 0 . 13 ( 6 . 0 . 13 avail version field ) when try process data comet processor . event ( ) either dure begin event dure read event , imposs guarante all data ha been read befor return ( sinc new data mai arriv between last statement befor return , return statement itself ) . howev , coyot processor doe thi check : } els ( error read request . get avail ( ) ) { thi wa read all byte have been read , data wa read from connector , error error = true ; log . error ( sm . get string ( coyot adapt . read ) ) ; } caus sever error comet request break when thi race condit manifest itself . i am us follow code accord aio . html descript read data my comet event handler : while ( request . get input stream ( ) . avail ( ) 0 ) { read some data } more data avail return ; i am experienc error describ certain condit ( rapid arriv fragment data ) : sever : servlet did read all avail byte dure process read event race condit when us avail ( ) read comet processor . event (

applic follw web . xml can deploi . servlet servlet name sampl servlet name servlet class sampl . servlet servlet class secur role ref role name user role name secur role ref servlet servlet map . . . . servlet map secur role role name user role name secur role java . lang . illeg argument except : can t convert argument : null occur . specif sai : secur role ref element declar secur role refer compon deploy compon code . consist option descript , secur role name us code ( role name ) , option link secur role ( role link ) . role link option . role link tag web . xml can omit .

jasper output detail when jasper cannot find map between gener servlet code ( mistak ) former jsp . exampl jsp follow . ( import class jsp found . ) page import = . exist . class jasper output detail compil error specif case .

have follow web . xml : env entri env entri name test env entri name env entri type java . lang . string env entri type env entri valu test env entri valu env entri follow your context descriptor : resourc link name = test global = test type = java . lang . string caus npe context load . java . lang . null pointer except org . apach . catalina . deploi . name resourc . add environ ( name resourc . java : 188 ) thi assum you have entri test global name resourc section server . xml link . thi work 5 . 5 . 20 . longer work 5 . 5 . 23 . same env entri ( web . xml ) resourc link ( context ) name caus npe

when we deploi 20 so web app time , we invari end up app two each server ha compil error due code gener like thi : static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 0 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 1 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 2 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 3 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 4 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 5 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 6 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 7 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 0 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 1 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 2 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 3 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 4 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 5 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 6 ; static privat org . apach . jasper . runtim . protect function mapper jspx fnmap 7 ; thi look like might simpl unsynchron access static curr func elfunct mapper , i m far from expert thi code unfortun lack time becom . : ) thi onli appear happen when we mass deploi app , we can resolv delet gener . java file manual restart affect app . duplic jsp function mapper variabl

304 respons should consist includ etag header

rev 535915 chang behavior error report valv tomcat6 produc error report when respons . send error ( ) call . exampl , us thi code servlet s servic ( ) doe produc error report : respons . send error ( http servlet respons . sc gone , error occur ) ; underli caus valv s check respons . commit ( ) wa replac respons . app commit ( ) . latter return true , which caus valv s invok ( ) method immedi return instead produc report . error report valv doe provid error report

realm base init ( ) need cleanup

duplic jsp temp variabl declar when jsp : attribut us conjunct custom tag

html tabl tr wrong format when stop ( last ) tomcat web applic manag . tomcat web applic manag tabl error

potenti null pointer except org . apach . catalina . valv . access log valv

when us form custom encod ( e . g . multipart form data ) , content type restor after redirect login page ( auth method = form ) . reproduc : page post us multipart form data encod ( anyth other than applic x www form urlencod ) result page protect login page ( auth method = form ) invok . even though multipart post data exist ( verifi read input stream request from result page ) content type request alwai applic x www form urlencod . thi onli happen when redirect login page first . doe happen alreadi log . post content type incorrect multipart form after login

org . apach . catalina . startup . embed direct api creat nio connector . thi would veri help all applic which us tomcat embed mode requir comet processor . request : support nio embed tomcat

apr byte receiv byte sent ar alwai 0 . apr bytess bytesreceiv perform data collect

you instal tomcat web applic directori space name , exampl c : program file vd tomcat tomcat c : program file vd consol web applic . tld file ar insid meta inf directori jar file load . problem file treatment insid tld config class . . . i have attach patch correct . thi bug found tomcat 6 too you instal tomcat directori space ignor tld file insid jar file

jsp throw unavail except twice , illeg state except occur . first access : jsp throw unavail except . second access : jsp throw unavail except again illeg state except occur tomcat return statu code : 500 client . problem illeg state except occur . problem jsp can call even though cannot us . jsp throw unavail except twice , illeg state except occur .

when unavail except thrown from servlet : init , tomcat doesn t output stack trace unavail except . caus problem lost . tomcat should output stack trace invok method standard wrapper valu . tomcat doesn t output stack trace unavail except .

( thi bug also present coyot sourc 6 . 0 . 10 . ) http header content type : text abc ; charset = utf 8 ; xyz = 3 request . get charact encod ( ) return utf 8 ; xyz = 3 tomcat 4 . 1 . 24 return utf 8 . tomcat 4 . 1 . 24 , request . get charact encod us pars charact encod defin jakarta tomcat 4 . 1 . 24 src catalina src share org apach catalina util request util . java correctli handl case other content type paramet . tomcat 5 . 5 . 23 , howev , request . get charact encod us get charset from content type defin from apach tomcat 5 . 5 . 23 src connector util java org apach tomcat util http content type . java which doe search possibl termin semicolon charset , thu erron includ addit charact charset . code 5 . 5 . 23 ha comment begin basic return everyth after ; charset = pleas consid us code from 4 . 1 . 24 thi problem show up when content type wa multipart mix client specifi charset paramet content type ; howev , occur ani content type where charset specifi last paramet . request . get charact encod mispars charset = utf 8 ; xyz = 3

we us follow log . properti our web applic : handler = 1tivoli . java . util . log . file handler , 2product . java . util . log . file handler handler root logger . handler = 1tivoli . java . util . log . file handler , 2product . java . util . log . file handler 1tivoli . java . util . log . file handler . level = info 1tivoli . java . util . log . file handler . pattern = var log product tivoli g . log limit output 1mb 1tivoli . java . util . log . file handler . limit = 1048576 limit rotat 10 log . . . 1tivoli . java . util . log . file handler . count = 10 1tivoli . java . util . log . file handler . append = true 1tivoli . java . util . log . file handler . formatt = de . custom . product . tivoli . tivoli formatt 2product . java . util . log . file handler . level = finest 2product . java . util . log . file handler . pattern = var log product product g . log limit output 1mb 2product . java . util . log . file handler . limit = 1048576 limit rotat 5 log . . . 2product . java . util . log . file handler . count = 5 2product . java . util . log . file handler . append = true 2product . java . util . log . file handler . formatt = java . util . log . simpl formatt when us apach tomcat 5 . 5 . 23 everi line logfil duplic . debug i found tivoli formatt actual creat twice . root logger ha actual 4 handler two intend . thi doe allow us upgrad beyond 5 . 5 . 20 . found linux64bit window xp , both jdk 1 . 5 r11 java . util . log duplic sinc 5 . 5 . 23 . 5 . 5 . 20 ok

when jsp access second time , jsp destroi method call even servlet except thrown from init method class extend http jsp page . thi violat java servlet specif 2 . 4 , srv . 2 . 3 . 2 . 1 . call jsp destroi method violat about java servlet specif 2 . 4 , srv . 2 . 3 . 2 . 1 .

i tri deploi webapp us context . xml file under manag webapp receiv thi error : java . io . file found except : opt apach tomcat 6 . 0 . 2 conf catalina localhost mywebapp3 . xml ( file directori ) java . io . file output stream . open ( nativ method ) java . io . file output stream . init ( file output stream . java : 179 ) java . io . file output stream . init ( file output stream . java : 131 ) org . apach . catalina . manag . manag servlet . copi intern ( manag servlet . java : 1570 ) org . apach . catalina . manag . manag servlet . copi ( manag servlet . java : 1530 ) org . apach . catalina . manag . manag servlet . deploi ( manag servlet . java : 803 ) org . apach . catalina . manag . htmlmanag servlet . deploi intern ( htmlmanag servlet . java : 249 ) org . apach . catalina . manag . htmlmanag servlet . do get ( htmlmanag servlet . java : 96 ) javax . servlet . http . http servlet . servic ( http servlet . java : 690 ) javax . servlet . http . http servlet . servic ( http servlet . java : 803 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 290 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 206 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 228 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 175 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 525 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 128 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 212 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 818 ) org . apach . coyot . http11 . http11protocol http11connect handler . process ( http11protocol . java : 624 ) org . apach . tomcat . util . net . jio endpoint worker . run ( jio endpoint . java : 445 ) java . lang . thread . run ( thread . java : 613 ) i did check notic apach tomcat 6 . 0 . 2 conf catalina directori longer exist version 6 . did someth chang error when deploi xml configur file url

variabl assign s own valu .

( still happen 6 . 0 . 9 , though isn t option bugzilla ) i us backup manag session replic turn debug log , i get thi except when i try invalid session : java . lang . class cast except : org . apach . catalina . ha . session . backup manag cannot cast org . apach . catalina . ha . session . delta manag org . apach . catalina . ha . session . delta session . expir ( delta session . java : 361 ) org . apach . catalina . ha . session . delta session . expir ( delta session . java : 352 ) org . apach . catalina . session . standard session . expir ( standard session . java : 660 ) org . apach . catalina . session . standard session . invalid ( standard session . java : 1112 ) org . apach . catalina . session . standard session facad . invalid ( standard session facad . java : 150 ) bug easi find sourc . debug log enabl , tri cast manag delta manag without instanceof , even though do instanceof immedi after : public void expir ( boolean notifi , boolean notifi cluster ) { string expir id = get id intern ( ) ; super . expir ( notifi ) ; ( notifi cluster ) { ( log . debug enabl ( ) ) log . debug ( sm . get string ( delta session . notifi , ( ( delta manag ) manag ) . get name ( ) , new boolean ( primari session ( ) ) , expir id ) ) ; ( manag instanceof delta manag ) { ( ( delta manag ) manag ) . session expir ( expir id ) ; } } } class cast except backup manag debug log

i try test cluster function . i got problem : someth like follow apear catalina home log catalina . out sever : unabl start replic context java . lang . class cast except : org . apach . name . resourc . proxi dir context cannot cast java . io . serializ org . apach . catalina . tribe . tipi . abstract replic map map entri . set valu ( abstract replic map . java : 1060 ) i didn t chang ani file catalina home except server . xml , ani thing i chang server . xml uncom line : cluster class name = org . apach . catalina . ha . tcp . simpl tcp cluster . i add context configur file test . xml catalina home conf catalina localhost floll content arai bonc 01 conf cat catalina localhost test . xml context class name = org . apach . catalina . ha . context . replic context path = test doc base = var www cluster test debug = 0 privileg = true reload = true web . xml file var www cluster test ha distribut element i am worri about i can t explain problem clearli my poor english . so i past stepe i do follow : arai bonc 01 apach tomcat 6 . 0 . 2 which java usr java jdk1 . 6 . 0 bin java arai bonc 01 apach tomcat 6 . 0 . 2 java version java version 1 . 6 . 0 rc java ( tm ) se runtim environ ( build 1 . 6 . 0 rc b104 ) java hot spot ( tm ) client vm ( build 1 . 6 . 0 rc b104 , mix mode , share ) arai bonc 01 apach tomcat 6 . 0 . 2 echo java home usr java jdk1 . 6 . 0 arai bonc 01 apach tomcat 6 . 0 . 2 echo classpath arai bonc 01 apach tomcat 6 . 0 . 2 unam linux bonc 01 2 . 6 . 9 34 . el 1 wed mar 8 00 : 07 : 35 cst 2006 i686 i686 i386 gnu linux root bonc 01 local cat etc redhat releas cent os releas 4 . 3 ( final ) arai bonc 01 apach tomcat 6 . 0 . 2 cd conf arai bonc 01 conf cat server . xml note : server itself contain , so you mai defin subcompon valv thi level . document doc config server . html server port = 8005 shutdown = shutdown apr librari loader . document doc apr . html listen class name = org . apach . catalina . core . apr lifecycl listen sslengin = initi jasper prior webapp ar load . document doc jasper howto . html listen class name = org . apach . catalina . core . jasper listen jmx support tomcat server . document doc non exist . html listen class name = org . apach . catalina . mbean . server lifecycl listen listen class name = org . apach . catalina . mbean . global resourc lifecycl listen global jndi resourc document doc jndi resourc howto . html global name resourc edit user databas can also us user databas realm authent user resourc name = user databas auth = contain type = org . apach . catalina . user databas descript = user databas can updat save factori = org . apach . catalina . user . memori user databas factori pathnam = conf tomcat user . xml global name resourc servic collect more connector share singl contain note : servic itself contain , so you mai defin subcompon valv thi level . document doc config servic . html servic name = catalina connector repres endpoint which request ar receiv respons ar return . document : java http connector : doc config http . html ( block non block ) java ajp connector : doc config ajp . html apr ( http ajp ) connector : doc apr . html defin non ssl http 1 . 1 connector port 8080 connector port = 8080 protocol = http 1 . 1 max thread = 150 connect timeout = 20000 redirect port = 8443 defin ssl http 1 . 1 connector port 8443 thi connector us jsse configur , when us apr , connector should us open ssl style configur describ apr document connector port = 8443 protocol = http 1 . 1 max thread = 150 scheme = http secur = true client auth = fals ssl protocol = tl defin ajp 1 . 3 connector port 8009 connector port = 8009 protocol = ajp 1 . 3 redirect port = 8443 engin repres entri point ( within catalina ) process everi request . engin implement tomcat stand alon analyz http header includ request , pass them appropri host ( virtual host ) . document doc config engin . html you should set jvm rout support load balanc via ajp ie : engin name = standalon default host = localhost jvm rout = jvm1 engin name = catalina default host = localhost cluster , pleas take look document : doc cluster howto . html ( simpl how ) doc config cluster . html ( refer document ) cluster class name = org . apach . catalina . ha . tcp . simpl tcp cluster request dumper valv dump us debug inform about request respons data receiv sent tomcat . document : doc config valv . html valv class name = org . apach . catalina . valv . request dumper valv thi realm us user databas configur global jndi resourc under kei user databas . ani edit ar perform against thi user databas ar immedi avail us realm . realm class name = org . apach . catalina . realm . user databas realm resourc name = user databas defin default virtual host note : xml schema valid work xerc 2 . 2 . host name = localhost app base = webapp unpack war = true auto deploi = true xml valid = fals xml namespac awar = fals singl sign valv , share authent between web applic document : doc config valv . html valv class name = org . apach . catalina . authent . singl sign access log process all exampl . document : doc config valv . html valv class name = org . apach . catalina . valv . fast common access log valv directori = log prefix = localhost access log . suffix = . txt pattern = common resolv host = fals host engin servic server arai bonc 01 conf mkdir catalina arai bonc 01 conf ln s usr local tomcat conf localhost catalina localhost arai bonc 01 conf cat catalina localhost test . xml context class name = org . apach . catalina . ha . context . replic context path = test doc base = var www cluster test debug = 0 privileg = true reload = true context arai bonc 01 conf cd . . arai bonc 01 apach tomcat 6 . 0 . 2 ls bin conf lib licens log notic releas note run . txt temp webapp work arai bonc 01 apach tomcat 6 . 0 . 2 rm log arai bonc 01 apach tomcat 6 . 0 . 2 bin catalina . sh version us catalina base : home arai download apach tomcat 6 . 0 . 2 us catalina home : home arai download apach tomcat 6 . 0 . 2 us catalina tmpdir : home arai download apach tomcat 6 . 0 . 2 temp us jre home : usr java jdk1 . 6 . 0 server version : apach tomcat 6 . 0 . 2 server built : nov 16 2006 12 : 31 : 06 server number : 6 . 0 . 2 . 0 os name : linux os version : 2 . 6 . 9 34 . el architectur : i386 jvm version : 1 . 6 . 0 rc b104 jvm vendor : sun microsystem inc . arai bonc 01 apach tomcat 6 . 0 . 2 bin startup . sh us catalina base : home arai download apach tomcat 6 . 0 . 2 us catalina home : home arai download apach tomcat 6 . 0 . 2 us catalina tmpdir : home arai download apach tomcat 6 . 0 . 2 temp us jre home : usr java jdk1 . 6 . 0 arai bonc 01 apach tomcat 6 . 0 . 2 cat log catalina . out info : initi coyot http 1 . 1 http 8080 dec 13 , 2006 4 : 07 : 39 pm org . apach . catalina . startup . catalina load info : initi process 2532 ms dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . core . standard servic start info : start servic catalina dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . core . standard engin start info : start servlet engin : apach tomcat 6 . 0 . 2 dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . ha . tcp . simpl tcp cluster start info : cluster about start dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . tribe . transport . receiv base bind info : receiv server socket bound : 127 . 0 . 0 . 1 : 4000 dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . tribe . membership . mcast servic impl setup socket info : set cluster mcast so timeout 500 dec 13 , 2006 4 : 07 : 40 pm org . apach . catalina . tribe . membership . mcast servic impl wait member info : sleep 1000 millisecond establish cluster membership , start level : 4 dec 13 , 2006 4 : 07 : 41 pm org . apach . catalina . tribe . membership . mcast servic impl wait member info : done sleep , membership establish , start level : 4 dec 13 , 2006 4 : 07 : 41 pm org . apach . catalina . tribe . membership . mcast servic impl wait member info : sleep 1000 millisecond establish cluster membership , start level : 8 dec 13 , 2006 4 : 07 : 42 pm org . apach . catalina . tribe . membership . mcast servic impl wait member info : done sleep , membership establish , start level : 8 dec 13 , 2006 4 : 07 : 42 pm org . apach . catalina . core . standard host start info : xml valid disabl dec 13 , 2006 4 : 07 : 42 pm org . apach . catalina . tribe . tipi . abstract replic map init info : initi abstract replic map context name : test dec 13 , 2006 4 : 07 : 43 pm org . apach . catalina . ha . context . replic context start sever : unabl start replic context java . lang . class cast except : org . apach . name . resourc . proxi dir context cannot cast java . io . serializ org . apach . catalina . tribe . tipi . abstract replic map map entri . set valu ( abstract replic map . java : 1060 ) org . apach . catalina . tribe . tipi . abstract replic map map entri . init ( abstract replic map . java : 1005 ) org . apach . catalina . tribe . tipi . abstract replic map . put ( abstract replic map . java : 859 ) org . apach . catalina . core . applic context . set attribut ( applic context . java : 756 ) org . apach . catalina . core . applic context facad . set attribut ( applic context facad . java : 334 ) org . apach . catalina . core . standard context . start ( standard context . java : 4296 ) org . apach . catalina . ha . context . replic context . start ( replic context . java : 55 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 760 ) org . apach . catalina . core . contain base . add child ( contain base . java : 740 ) org . apach . catalina . core . standard host . add child ( standard host . java : 525 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 626 ) org . apach . catalina . startup . host config . deploi descriptor ( host config . java : 553 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 488 ) org . apach . catalina . startup . host config . start ( host config . java : 1138 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 311 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 120 ) org . apach . catalina . core . contain base . start ( contain base . java : 1022 ) org . apach . catalina . core . standard host . start ( standard host . java : 719 ) org . apach . catalina . core . contain base . start ( contain base . java : 1014 ) org . apach . catalina . core . standard engin . start ( standard engin . java : 443 ) org . apach . catalina . core . standard servic . start ( standard servic . java : 451 ) org . apach . catalina . core . standard server . start ( standard server . java : 710 ) org . apach . catalina . startup . catalina . start ( catalina . java : 552 ) sun . reflect . nativ method accessor impl . invoke0 ( nativ method ) sun . reflect . nativ method accessor impl . invok ( nativ method accessor impl . java : 39 ) sun . reflect . deleg method accessor impl . invok ( deleg method accessor impl . java : 25 ) java . lang . reflect . method . invok ( method . java : 597 ) org . apach . catalina . startup . bootstrap . start ( bootstrap . java : 288 ) org . apach . catalina . startup . bootstrap . main ( bootstrap . java : 413 ) dec 13 , 2006 4 : 07 : 43 pm org . apach . catalina . core . contain base add child intern sever : contain base . add child : start : lifecycl except : fail start replic context : java . lang . class cast except : org . apach . name . resourc . proxi dir context cannot cast java . io . serializ org . apach . catalina . ha . context . replic context . start ( replic context . java : 58 ) unabl start replic context

refer : org . apach . coyot . http11 . http11processor . java would help develop get inform when some requir header inform miss . eg when header . get valu ( host ) ; return null http11 true . couldn t you add log . debug statement inform user about miss header field ( exampl http11processor . java : 1391 ) add debug statement when some necessari header inform miss

org . apach . catalina . realm . jaasrealm doe verifi ani class name ar set through set role class name ( ) set user class name ( ) . incorrect class name ( e . g . typo ) configur context . xml , thi unnot jaasrealm . result dure authent , when subject s princip ar check against configur class name , princip ar recognis , therefor ad subject . fact incorrect configur class name current detect log make veri hard find sourc problem . can easili fix check class name two method mention abov . class must exist , must implement java . secur . princip , which current enforc check code . incorrect user role classnam ar silent ignor .

class org . apach . jasper . compil . jdtcompil : public char get content ( ) { char result = null ; try { input stream reader reader = new input stream reader ( new file input stream ( sourc file ) , ctxt . get option ( ) . get java encod ( ) ) ; reader reader = new buffer reader ( reader ) ; ( reader = null ) { char char = new char 8192 ; string buffer buf = new string buffer ( ) ; int count ; while ( ( count = reader . read ( char , 0 , char . length ) ) 0 ) { buf . append ( char , 0 , count ) ; } result = new char buf . length ( ) ; buf . get char ( 0 , result . length , result , 0 ) ; } } catch ( ioexcept e ) { log . error ( compil error , e ) ; } return result ; } variabl reader close after us . i updat jsp file frequent , exhaust system file handler . too mani file error come . i test redhat linux , same problem occur tomcat 5 tomcat 6 . jdtcompil : : get content doe close reader

when digest read tomcat user . xml file except throw , creat new lifecycl except . first paramet thi except messag string . thi string hardcod memori realm . read xml , so i thing log messag wrong too i think must us string manag . actual implement : digest digest = get digest ( ) ; try { synchron ( digest ) { digest . push ( thi ) ; digest . pars ( file ) ; } } catch ( except e ) { throw new lifecycl except ( memori realm . read xml , e ) ; } final { digest . reset ( ) ; } fix : digest digest = get digest ( ) ; try { synchron ( digest ) { digest . push ( thi ) ; digest . pars ( file ) ; } } catch ( except e ) { throw new lifecycl except ( sm . get string ( memori realm . read xml ) , e ) ; } final { digest . reset ( ) ; } wrong messag except memori realm

unmodifi sinc header doesn t work enoughli . fail case : unmodifi sinc header valu : 1000000 ( millisecond ) last modifi valu target resourc : 1001000 ( millisecond ) thi case , respons s statu code should sc precondit fail , result so . caus : default servlet check unmodifi sinc : ( last modifi ( header valu 1000 ) ) { i think should : ( last modifi = ( header valu 1000 ) ) { unmodifi sinc failur

servlet 2 . 4 specif sai : valu posit integ 0 , contain must load initi servlet applic deploi . contain must guarante servlet mark lower integ ar load befor servlet mark higher integ . i think servlet valu 0 load startup tag must load first . howev , tomcat load servlet last . servlet valu 0 load startup tag must load first .

i suggest littl messag improv . log level differ same messag . messag servlet . servic ( ) servlet { 0 } threw except output eight place , messag level same . org . apach . catalina . core . applic dispatch invok . . . wrapper . get logger ( ) . error ( sm . get string ( applic dispatch . servic except , wrapper . get name ( ) ) , e ) ; . . . wrapper . get logger ( ) . error ( sm . get string ( applic dispatch . servic except , wrapper . get name ( ) ) , e ) ; . . . wrapper . get logger ( ) . error ( sm . get string ( applic dispatch . servic except , wrapper . get name ( ) ) , root caus ) ; . . . wrapper . get logger ( ) . error ( sm . get string ( applic dispatch . servic except , wrapper . get name ( ) ) , e ) ; org . apach . catalina . core . standard wrapper valv invok contain . get logger ( ) . warn ( sm . get string ( standard wrapper . servic except , wrapper . get name ( ) ) , e ) ; . . . contain . get logger ( ) . warn ( sm . get string ( standard wrapper . servic except , wrapper . get name ( ) ) , e ) ; . . . contain . get logger ( ) . error ( sm . get string ( standard wrapper . servic except , wrapper . get name ( ) ) , root caus ) ; . . . contain . get logger ( ) . error ( sm . get string ( standard wrapper . servic except , wrapper . get name ( ) ) , e ) ; ar ani reason us get logger ( ) . warn ( ) i think would better all them us get logger ( ) . error ( . . . ) . log level differ same messag .

onli 1 instanc jsp factori object ( jsp factori impl ) creat . consequ singl simpl pool page context object all jsp request so everi jsp request must synchron lock insid simpl pool when get releas page context instanc . moreov , pool ha fix capac after , code jsp factori impl first acquir lock see ar ani free object pool , fail which new page context object creat . instead singl process wide pool , per thread pool page context object can us jsp factori impl . avoid simpl pool . get put synchron jsp factori impl

tomcat version : 6 . 0 . x trunk everi gener jsp ha try { jspx factori = jsp factori . get default factori ( ) ; respons . set content type ( text html ) ; jsp servic method . us jsp factori . get default factori dure request process should avoid static synchron method . i have diff address thi attach thi bug . unnecessari synchron caus jsp factori . get default factori while servic jsp

srv 6 . 2 . 5 servlet 2 . 5 spec introduc support servlet name filter map . tc6 doe current support valu specifi . i attach patch shortli . filter map doesn t support servlet name

try us nio connector instead apr connector us tomcat6 head , i get illeg argument except while call send ack . look intern nio output buffer . send ack ( ) , us byte buffer . wrap ( ) creat new byte buffer us thi byte buffer call write socket . check secur nio channel . write ( ) byte buffer store comment line 372 secur nio channel . java fix problem . ( src = buf handler . get write buffer ( ) ) throw new illeg argument except ( you can onli write us applic write buffer provid handler . ) ; i guess check here valid reason , better fix would veri like consist fix send ack ad condit test case send ack ( ) . grave : cannot find messag associ kei standard wrapper . acknowledg except java . lang . illeg argument except : you can onli write us applic write buffer provid handler . org . apach . tomcat . util . net . secur nio channel . write ( secur nio channel . java : 372 ) org . apach . tomcat . util . net . nio selector pool . write ( nio selector pool . java : 111 ) org . apach . coyot . http11 . intern nio output buffer . write socket ( intern nio output buffer . java : 434 ) org . apach . coyot . http11 . intern nio output buffer . send ack ( intern nio output buffer . java : 418 ) org . apach . coyot . http11 . http11nio processor . action ( http11nio processor . java : 1028 ) org . apach . coyot . respons . action ( respons . java : 183 ) org . apach . coyot . respons . acknowledg ( respons . java : 310 ) org . apach . catalina . connector . respons . send acknowledg ( respons . java : 1154 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 169 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 175 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 128 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 109 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 212 ) org . apach . coyot . http11 . http11nio processor . process ( http11nio processor . java : 888 ) org . apach . coyot . http11 . http11nio protocol http11connect handler . process ( http11nio protocol . java : 624 ) org . apach . tomcat . util . net . nio endpoint worker . run ( nio endpoint . java : 1467 ) java . lang . thread . run ( thread . java : 595 ) nio connector : illeg argument except : you can onli write us applic write buffer provid handler

ar coupl small bug compress filter class ar trigger us filter web sphere 5 . 1 6 . here ar patch . compress respons stream should compress output stream respons ha been commit ( becaus cannot write content encod : gzip header , browser displai compress output ) compress servlet respons wrapper caus null pointer except you flush befor write anyth fix us compress filter web sphere app server

conf web . xml s jsp servlet init paramet includ check interv , whose valu explain follow : develop fals check interv greater than zero , background compil ar enabl . i add follow paramet would think background compil would disabl ( valu greater than zero ) . init param param name check interv param name param valu 0 param valu init param init param param name develop param name param valu fals param valu init param howev , valu chang 300 follow warn output : dec 30 , 2006 7 : 13 : 57 pm org . apach . jasper . embed servlet option init warn : warn : invalid valu init param check interv . us default valu 300 second accord comment web . xml 0 wa valid valu . either comment valid check wrong . my understand them . jsp servlet s check interv paramet cannot set 0 implicitli

us inspect : request . get auth type ( ) ( java . lang . string ) client cert http servlet request . client cert auth ( java . lang . string ) client cert api sai thei should same object ( = = should work ) request . get auth type ( ) return differ string from http servlet request . client cert auth

when us singl sign valv ( org . apach . catalina . authent . singl sign ) via http cooki jsessionidsso transmit without secur attribut , result transmit ani content purpos error request via http from same server . content sso cooki confidenti ( lead automat log session other context http non http ) thi should never happen . sorri have patch . i ve instal complet sourc distribut my develop environ , seem point chang ar org . apach . catalina . authent . authent base . regist ( . . . ) , code interest ( from 5 . 5 . 30 sourc distribut ) cooki cooki = new cooki ( constant . singl sign cooki , sso id ) ; cooki . set max ag ( 1 ) ; cooki . set path ( ) ; hre . add cooki ( cooki ) ; hre org . apach . catalina . http request , i ve look through code find org . apach . catalina . request . set secur ( ) . . . secur ( ) ( though thi mention javadoc . . . set secur ( ) ) i suppos need anoth chang provid secur request http request , thi difficult tell onli from editor . secur ( ) wa , d cooki . set secur ( hre . secur ( ) ) miss statement abov . . . singl sign cooki doe honor http access : login inform disclosur

jasper doe nt displai full path file 404 found error page

latest tc6 code , i m see problem did exist earlier tc6 driver . sorri i can t put finger when thi problem aros . i look relev sourc file ( like jsp runtim context ) haven t found sourc problem . here s issu ( testcas attach ) . app veri simpl : instal servlet context listen purpos ad custom elresolv . accomplish thi via : public void context initi ( servlet context event evt ) { servlet context context = evt . get servlet context ( ) ; jsp applic context jsp context = jsp factori . get default factori ( ) . get jsp applic context ( context ) ; jsp context . add elresolv ( new chip elresolv ( ) ) ; } problem jsp factori . get default factori ( ) return null ; see below . oct 4 , 2006 5 : 32 : 18 pm org . apach . catalina . core . apr lifecycl listen lifecycl ev ent info : apach tomcat nativ librari which allow optim perform produ ction environ wa found java . librari . path : c : java for6 . 0build jdk 15 java jre bin ; . ; c : java for6 . 0build jdk15 java bin ; c : mantis2 . 1 manti bin ; c : se tup ibas ; c : perl bin ; c : window system32 ; c : window ; c : window system32 wbem ; c : python22 ; c : program file pc doctor window servic ; c : cvsnt 2 . 0 . 4 ; c : ecli pse ; w : ; w : bin ; c : program file quick time qtsystem ; c : diskeep ; c : cmvc ex ; c : cmvc ex bin ; ; c : cmvcdc50 ; c : cmvcdc50 ; c : cmvcdc50 ; oct 4 , 2006 5 : 32 : 18 pm org . apach . coyot . http11 . http11protocol init info : initi coyot http 1 . 1 http 8080 oct 4 , 2006 5 : 32 : 19 pm org . apach . catalina . startup . catalina load info : initi process 1234 ms oct 4 , 2006 5 : 32 : 19 pm org . apach . catalina . core . standard servic start info : start servic catalina oct 4 , 2006 5 : 32 : 19 pm org . apach . catalina . core . standard engin start info : start servlet engin : apach tomcat 6 . 0 . 0 dev oct 4 , 2006 5 : 32 : 19 pm org . apach . catalina . core . standard host start info : xml valid disabl oct 4 , 2006 5 : 32 : 19 pm org . apach . catalina . startup . host config deploi war info : deploi web applic archiv elresolv test . war chip listen . context initi evt = javax . servlet . servlet context event sourc = org . apach . catalina . core . applic context facad 3fbe3fb chip listen . context initi context = org . apach . catalina . core . applic c ontext facad 3fbe3fb chip listen . context initi jsp factori . get default factori ( ) = null oct 4 , 2006 5 : 32 : 20 pm org . apach . catalina . core . standard context start sever : error listen start oct 4 , 2006 5 : 32 : 20 pm org . apach . catalina . core . standard context start sever : context elresolv test startup fail due previou error oct 4 , 2006 5 : 32 : 21 pm org . apach . coyot . http11 . http11protocol start info : start coyot http 1 . 1 http 8080 oct 4 , 2006 5 : 32 : 21 pm org . apach . jk . common . channel socket init info : jk : ajp13 listen 0 . 0 . 0 . 0 : 8009 oct 4 , 2006 5 : 32 : 21 pm org . apach . jk . server . jk main start info : jk run id = 0 time = 0 63 config = null oct 4 , 2006 5 : 32 : 21 pm org . apach . catalina . startup . catalina start info : server startup 2657 ms thi easili reproduc when you deploi elresolv test . war befor server ha start ( i assum jsp factori . set default factori ( ) hasn t been invok time listen ar instal ) . you deploi war after server start , problem doe manifest app work until you stop restart server . default jsp factori initi earli enough

jsp comil output all tag requir object upper case letter . conform xhtml lower case requir , all tag ar hard code gener . output tag jsp : plugin conform xhtml .

org . apach . juli . file handler creat programmat parametr constructor public file handler ( string directori , string prefix , string suffix ) , file handler ignor custom constructor paramet , creat log handler default configur write log file { catalina home } bin log name juli . yyyi mm dd . log ( yyyi , mm dd ar substitut actual year , month date ) look like problem fact parametr constructor call default constructor . default constructor turn perform handler configur from log manag properti creat log file base thi default configur . thi make custom constructor paramet effect ignor . org . apach . juli . file handler doe allow programmat creation us parametr constructor

org . apach . jasper . runtim . jsp factori impl ha privat static final string spec version = 2 . 0 ; should : privat static final string spec version = 2 . 1 ; jsp factori impl ha spec version = 2 . 0

tomcat leak memori everi request

exampl : form method = post action = test . ex test1 input type = hidden valu = test2 input type = submit form thi code doe invok test . ex without pass test1 command line paramet exampl work apach httpd ms ii fix : cgiservlet . java ( get . equal ( req . get method ( ) ) post . equal ( req . get method ( ) ) head . equal ( req . get method ( ) ) ) return ; post request ignor command line paramet

solari you can have file directori name call b xxx i yyi . us tomcat s list featur , you get directori list file name bold ital . i am familiar javascript cross site script secur problem , i believ tomcat escap xml charact like prevent client browser interpret html code ar intend interpret default error page . i think same should done list , warn should ad document us you have control over file directori name you list . list page doe escap xml charact

sometim dure tomcat 5 develop , standard class loader org . apach . catalina . loader packag wa strip down , now just urlclass loader . i work code extend standard class loader ( we us automat reload jar file ) , dure upgrad from tomcat 4 tomcat 5 . 5 found difficultli try figur out what had happen code . i end up have instal svn do svn log figur out why code wa remov . when code wa strip down , comment java file ( therefor javadoc api ) remain ident , so javadoc api class veri mislead . instanc , comment sai class implement reload , when fact doe . class comment should updat reflect state code . i can t see thi veri high prioriti , would like easi fix peopl whom ar code regularli , would make javadoc much more readabl peopl extend standard class loader own purpos . mislead comment standard class loader

tomcat lose request paramet

method class loader log manag . replac ( string ) charg replac system properti begin properti also modifi end properti due call trim . thi impli logger handler formatt reli properti end some spase ( includ n ) have differ behaviour jdk log manger tomcat class loader log manag modifi verstion thi method could : protect string replac ( string str ) { start modif string result = str . trim ( ) ; comment out int len = str . length ( ) ; int st = 0 ; while ( ( st len ) ( str . char ( st ) = ) ) { st ; } string result = ( st 0 ) str . substr ( st ) : str ; end modif ( result . start ( { ) ) { int po = result . index ( } ) ; ( po = 1 ) { string prop name = result . substr ( 2 , po ) ; string replac = system . get properti ( prop name ) ; ( replac = null ) { result = replac result . substr ( po 1 ) ; } } } return result ; } class loader log manag remov n end log . properti valu

jdbcrealm . get password throw null pointer except i m us tomcat 5 . 5 . 20 postgresql 8 . 1 407 . jdbc3 . jar postgresql 8 . 1 . 4 ubuntu dapper . authent two user simultan http digest caus sometim follow error 401 unauthor repli : 30 . 10 . 2006 14 : 24 : 54 org . apach . catalina . realm . jdbcrealm get password sever : except perform authent org . postgresql . util . psqlexcept : error : invalid messag format org . postgresql . core . v3 . queri executor impl . receiv error respons ( queri executor impl . java : 1525 ) org . postgresql . core . v3 . queri executor impl . process result ( queri executor impl . java : 1309 ) org . postgresql . core . v3 . queri executor impl . execut ( queri executor impl . java : 188 ) org . postgresql . jdbc2 . abstract jdbc2statement . execut ( abstract jdbc2statement . java : 452 ) org . postgresql . jdbc2 . abstract jdbc2statement . execut flag ( abstract jdbc2statement . java : 354 ) org . postgresql . jdbc2 . abstract jdbc2statement . execut queri ( abstract jdbc2statement . java : 258 ) org . apach . catalina . realm . jdbcrealm . get password ( jdbcrealm . java : 546 ) org . apach . catalina . realm . realm base . get digest ( realm base . java : 1156 ) org . apach . catalina . realm . realm base . authent ( realm base . java : 365 ) org . apach . catalina . authent . digest authent . find princip ( digest authent . java : 282 ) org . apach . catalina . authent . digest authent . authent ( digest authent . java : 175 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 490 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 126 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 107 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 148 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 869 ) org . apach . coyot . http11 . http11base protocol http11connect handler . process connect ( http11base protocol . java : 664 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 595 ) 30 . 10 . 2006 14 : 24 : 54 org . apach . catalina . connector . coyot adapt servic sever : except error occur contain dure request process java . lang . null pointer except org . apach . catalina . realm . jdbcrealm . get password ( jdbcrealm . java : 568 ) org . apach . catalina . realm . jdbcrealm . get princip ( jdbcrealm . java : 594 ) org . apach . catalina . realm . realm base . authent ( realm base . java : 398 ) org . apach . catalina . authent . digest authent . find princip ( digest authent . java : 282 ) org . apach . catalina . authent . digest authent . authent ( digest authent . java : 175 ) org . apach . catalina . authent . authent base . invok ( authent base . java : 490 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 126 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 107 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 148 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 869 ) org . apach . coyot . http11 . http11base protocol http11connect handler . process connect ( http11base protocol . java : 664 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 595 ) jdbcrealm . get password throw null pointer except

org . apach . jasper . compil . valid . check xml attribut ( ) , valid defer valu method rais except when rtexprvalu attribut legitim . stacktrac org . apach . jasper . jasper except : org . apach . jasper . jasper except : index . jsp ( 83 , 0 ) accord tld attribut direct tag file , attribut item doe accept ani express org . apach . jasper . servlet . jsp servlet wrapper . handl jsp except ( jsp servlet wrapper . java : 565 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 354 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 320 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 266 ) javax . servlet . http . http servlet . servic ( http servlet . java : 803 ) relev code check xml attribut ( ) ( defer ( tld attr j . defer method ( ) tld attr j . defer valu ( ) ) ) { onli defer express ar allow thi attribut err . jsp error ( n , jsp . error . attribut . custom . non rt expr , tld attr j . get name ( ) ) ; } testcas c : each var = k item = { color } li font color = { k } thi line { k } font . c : each tld jstl 1 . 2 sai item can rtexprvalu also defer valu . so abov usag correct . attach testcas war . summari i don t think thi code realli necessari ; least , need relax allow tai . can request time ( ) valu . jasper except rais against valid attribut

tomcat should enforc requir from servlet 2 . 4 specif srv . 8 . 2 srv . 8 . 2 us request dispatch us request dispatch , servlet call either includ method forward method request dispatch interfac . paramet method can either request respons argument were pass via servic method servlet interfac , instanc subclass request respons wrapper class have been introduc version 2 . 3 specif . latter case , wrapper instanc must wrap request respons object contain pass servic method . contain provid must ensur dispatch request target servlet occur same thread same vm origin request justif : = = = = = = = = = = = = = = absens thi enforc lead softwar bee develop follow specif . softwar cannot deploi later contain which conform abov paragraph henc must chang befor deploy . thi somehow contradict idea have standard base infrastructur . tomcat should enforc requir from servlet 2 . 4 specif srv . 8 . 2

first , servlet cgi . jar need exist servlet must map : exampl : servlet map servlet name cgi servlet name url pattern . pl url pattern servlet map test perl cgi script : usr bin perl print content type : text plain , n n ; print hello world , from perl n ; perl script place www root ( test . pl ) other ani subfold ( test test . pl cgi bin test . pl , etc . ) cgi script subfold run fine . cgi script www root gener except : java . lang . string index out bound except : string index out rang : 1 java . lang . string . substr ( string . java : 1768 ) java . lang . string . substr ( string . java : 1735 ) org . apach . catalina . servlet . cgiservlet cgienviron . find cgi ( cgiservlet . java : 948 ) org . apach . catalina . servlet . cgiservlet cgienviron . set cgienviron ( cgiservlet . java : 1015 ) org . apach . catalina . servlet . cgiservlet cgienviron . init ( cgiservlet . java : 766 ) org . apach . catalina . servlet . cgiservlet . do get ( cgiservlet . java : 584 ) javax . servlet . http . http servlet . servic ( http servlet . java : 689 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) problem thi line ( line 948 cgiservlet . java ) : cginam = current locat . get parent ( ) . substr ( web app root dir . length ( ) ) file . separ name ; problem web app root dir 1 char longer than current locat . get parent ( ) becaus web app root dir end file . separ ( thi case , ) . remov extra file . separ from web app root dir result differ string relat except elsewher . here s fix work : cginam = ( current locat . get parent ( ) file . separ ) . substr ( web app root dir . length ( ) ) name ; ( necessari , fix can made more adapt check see realli doe have file . separ end . . . add . . . otherwis , let , etc . ) ( side note , i have more bug fix ; env var script filenam isn t defin should requir php4 5 i ll submit differ bug fix . ) servlet cgi throw index out bound except certain cgi

find class intern , possibl entri . manifest set null anoth thread right befor call defin packag ( packag name , entri . manifest , entri . code base ) . datarac org . apach . catalina . loader . webapp class loader

class jdbcaccess log valv exampl tabl hold access log valu . thi tabl column ts which defin null . thi onli work my sql , becaus thi valu never written valv other databas complain about column which fill valu . wrong mislead document jdbcaccess log valv

i wa attempt creat filter valv could place front axi web servic would handl secur accord ws secur specif . turn out rabbit trail , i did find fix bug i discov along wai . i ran problem read post data ( web servic request ) from org . apach . catalina . connector . request object expos filter valv interfac . thi chunk code prototyp valv didn t work : privat byte chunk get postbodi ( request request ) throw ioexcept { byte chunk retval = new byte chunk ( request . get content length ( ) ) ; byte chunk bodi = new byte chunk ( request . get content length ( ) ) ; int byte read ; do { byte read = request . get coyot request ( ) . do read ( bodi ) ; retval . append ( bodi ) ; } while ( byte read = 0 ) ; put data back pipe . request . get coyot request ( ) . action ( action code . action req set bodi replai , retval ) ; return retval ; } thi code work design , howev problem occur later when axi attempt pars web servic request . i don t rememb exact axi error , i wa abl track problem down bug org . apach . coyot . http11 . filter . save request input filter class . do read method wa properli implement return 1 when appropri . here my modifi version do read method : public int do read ( byte chunk chunk , org . apach . coyot . request request ) throw ioexcept { int write length = 0 ; ( chunk . get limit ( ) 0 chunk . get limit ( ) input . get length ( ) ) { write length = chunk . get limit ( ) ; } els { write length = input . get length ( ) ; } ( input . get offset ( ) = input . get end ( ) ) return 1 ; input . substract ( chunk . get buffer ( ) , 0 , write length ) ; chunk . set offset ( 0 ) ; chunk . set end ( write length ) ; return write length ; } thi bug won t show up unless someon tri us filter valv do someth web servic . s too like becaus s what we have soaphandl . can t read post data from within filter valv

i run thi problem t5 when tring add remov add valv standard engin . what i understand empti pipelin ha : basic = standard engin valv ( exampl ) ; first = null ; you add valv you get basic = standard engin valv first = my valv ( my valv . next = standard engin valv ) you remov valv you get basic = standard engin valv first = standard engin valv note standard engin valv first too here . i try add new valv given actual code add valv valv ad becaus ( see ) current = basic current . get next ( ) = null ; add valv ( valv valv ) { add thi valv set associ thi pipelin ( first = = null ) { first = valv ; valv . set next ( basic ) ; } els { valv current = first ; while ( current = null ) { ( current . get next ( ) = = basic ) { current . set next ( valv ) ; valv . set next ( basic ) ; break ; } current = current . get next ( ) ; } } } bug standard pipelin . remov valv ( valv valv ) t5 . 5 . 16

environ entri ar chang web . xml , applic context restart , valu jndi context ar old valu . environ entri ar chang via tomcat admin interfac , valu provid context ar correct . follow code can us check environ : try { initi context ic = new initi context ( ) ; name enumer enum = ic . list bind ( java : comp env ) ; while ( enum . ha more ( ) ) { bind bind = ( bind ) enum . next ( ) ; jndi . set properti ( bind . get name ( ) , bind . get object ( ) ) ; system . out . println ( jndi set : bind . get name ( ) = bind . get object ( ) ) ; } } catch ( name except e ) { system . err . println ( unabl read jndi set , e ) ; } web . xml fragment look follow : env entri env entri name databas url env entri name env entri valu jdbc : hsqldb : hsql : localhost env entri valu env entri type java . lang . string env entri type env entri jndi env entri reload when context reload

code below doesn t make sens : snip catch ( ioexcept e ) { log ( caught except e ) ; throw new ioexcept ( e . string ( ) ) ; } snip should throw e ; . imho , seem need log thi except here , so cach block can remov . cgiservlet eat root caus

bug : illeg messag output log when listen applic implement servlet request listen interfac throw runtim except from request initi method request destroi method . messag : cannot find messag associ kei request listen valv . request init caus : kei exist properti file org . apach . catalina . valv . local string . properti , logic refer other properti file org . apach . catalina . core . local string . properti messag kei request listen valv . request init ha refer correctli .

step reproduc : 1 . autodeploi web applic defin context server . xml 2 . start tomcat server 3 . us tomcat manag undeploi applic you get ok undeploi applic context path web applic messag , applic undeploi , onli stop . you try stop server after , fail i have us share instal ( catalina base dir ) , i guess thi won t work standalon tomcat isntal either . undeploi fail when context defin server . xml server fail stop

accord jsp 2 . 0 specif , custom tag prefix name should type xml : name . howev , tomcat 5 . 5 . 8 , name legal java identifi , compil error occur . instanc , tomcat won t accept da te t ag legal name tag . tag name ar xml : name java identifi ar accept

i get org . apach . jasper . jasper except : error : function string must us prefix when default namespac specifi when try compil follow within jsp page : foo : set var = bar valu = thi { silli string ( foo our own tablib , seem jasper seem think string provid valu attribut contain some jsp el which doe . i chang page : c : set var = bar valu = thi { silli string ( i do get thi error . howev i need us my own taglib . foo . tld file , valu attribut set ha rtexprvalu = true . i set thi fals problem goe awai . howev i notic c . tld standard . jar also ha rtexprvalu = true valu attribut set . why differ behaviour we also wish have rtexprvalu = true . incorrect pars tag attribut

set parent ( ) call nest tag tag file ( . tagx )

http 8080 processor24 error 26902165 dispatch servlet . servic wrapper ( ) could complet request org . apach . jasper . jasper except : unabl compil class jsp org . apach . jasper . jsp compil context . compil ( jsp compil context . java : 565 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 293 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 291 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 241 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . applic dispatch . invok ( applic dispatch . java : 672 ) org . apach . catalina . core . applic dispatch . process request ( applic dispatch . java : 463 ) org . apach . catalina . core . applic dispatch . do forward ( applic dispatch . java : 398 ) org . apach . catalina . core . applic dispatch . forward ( applic dispatch . java : 301 ) org . springframework . web . servlet . view . intern resourc view . render merg output model ( intern resourc view . java : 97 ) org . springframework . web . servlet . view . abstract view . render ( abstract view . java : 250 ) org . springframework . web . servlet . dispatch servlet . render ( dispatch servlet . java : 928 ) org . springframework . web . servlet . dispatch servlet . do dispatch ( dispatch servlet . java : 705 ) org . springframework . web . servlet . dispatch servlet . do servic ( dispatch servlet . java : 625 ) org . springframework . web . servlet . framework servlet . servic wrapper ( framework servlet . java : 386 ) org . springframework . web . servlet . framework servlet . do get ( framework servlet . java : 346 ) javax . servlet . http . http servlet . servic ( http servlet . java : 689 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 213 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 178 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 126 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 107 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 148 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 856 ) org . apach . coyot . http11 . http11protocol http11connect handler . process connect ( http11protocol . java : 744 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 595 ) http 8080 processor24 error 26902165 wirelessapp . invok ( ) servlet . servic ( ) servlet wirelessapp threw except java . io . ioexcept : tmp file . renam ( class file ) fail org . apach . jasper . compil . smap util sdeinstal . instal ( smap util . java : 245 ) org . apach . jasper . compil . smap util . instal smap ( smap util . java : 164 ) org . apach . jasper . compil . ant compil . gener class ( ant compil . java : 267 ) org . apach . jasper . compil . compil . compil ( compil . java : 288 ) org . apach . jasper . compil . compil . compil ( compil . java : 267 ) org . apach . jasper . compil . compil . compil ( compil . java : 255 ) org . apach . jasper . jsp compil context . compil ( jsp compil context . java : 556 ) org . apach . jasper . servlet . jsp servlet wrapper . servic ( jsp servlet wrapper . java : 293 ) org . apach . jasper . servlet . jsp servlet . servic jsp file ( jsp servlet . java : 291 ) org . apach . jasper . servlet . jsp servlet . servic ( jsp servlet . java : 241 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . applic dispatch . invok ( applic dispatch . java : 672 ) org . apach . catalina . core . applic dispatch . process request ( applic dispatch . java : 463 ) org . apach . catalina . core . applic dispatch . do forward ( applic dispatch . java : 398 ) org . apach . catalina . core . applic dispatch . forward ( applic dispatch . java : 301 ) org . springframework . web . servlet . view . intern resourc view . render merg output model ( intern resourc view . java : 97 ) org . springframework . web . servlet . view . abstract view . render ( abstract view . java : 250 ) org . springframework . web . servlet . dispatch servlet . render ( dispatch servlet . java : 928 ) org . springframework . web . servlet . dispatch servlet . do dispatch ( dispatch servlet . java : 705 ) org . springframework . web . servlet . dispatch servlet . do servic ( dispatch servlet . java : 625 ) org . springframework . web . servlet . framework servlet . servic wrapper ( framework servlet . java : 386 ) org . springframework . web . servlet . framework servlet . do get ( framework servlet . java : 346 ) javax . servlet . http . http servlet . servic ( http servlet . java : 689 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 213 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 178 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 126 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 107 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 148 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 856 ) org . apach . coyot . http11 . http11protocol http11connect handler . process connect ( http11protocol . java : 744 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 595 ) java . io . ioexcept : tmp file . renam ( class file ) fail when compil new jsp ( upon redeploi )

after form authent intercept post request protect resourc , origin request properli restor upon success login when us mod jk . when connectiong tomcat directli ( 8080 ) , post request restor expect . i ve test thi mod jk 1 . 2 . 15 1 . 2 . 18 . seem problem orgin request save properli . i ( think ) i ve narrow down issu form authent . java . bodi . string ( ) wa return null . ( buffer wa null ) so look like root problem noth read from input stream . dure test i revert old wai ad request paramet ( save . add paramet ( ) ) see thei were inde work . i also tri , input stream = new buffer input stream ( request . get input stream ( ) ) ; which didn t work . . from form authent . java : protect void save request ( request request , session session ) throw ioexcept { . . . ( post . equal ignor case ( request . get method ( ) ) ) { byte chunk bodi = new byte chunk ( ) ; bodi . set limit ( request . get connector ( ) . get max save post size ( ) ) ; byte buffer = new byte 4096 ; int byte read ; input stream = request . get input stream ( ) ; while ( ( byte read = . read ( buffer ) ) = 0 ) { bodi . append ( buffer , 0 , byte read ) ; } save . set bodi ( bodi ) ; } . . . } mod jk , post request bodi ar restor success login when us mod jk

scenario : jsp tag ( tagfil , taglib ) activ reload web . xml clean work directori start tomcat load jsp tomcat gener compil load jsp tagfil class . after check interv second background compil thread jsp runtim context load tagfil class ( onli them ) again again . thi produc lot work garbag collector . ( perman class unload tagfil class ) breakpoint method load tag file ( ) jsp servlet wrapper . java show thi . perhap reload flag must set fals after load tag file jsp servlet wrapper . java : . . . ( reload ) { tag handler class = ctxt . load ( ) ; reload = fals ; perhap , thi solv problem i am shure } . . . after restart server problem present becaus jsp servlet wrapper instanti tagfil therefor backround compil task doe check tagfil . perman reload tagfil class without chang tagfil

hello , i think small bug tomcat 5 . 0 5 . 5 ( least i could see alreadi mani version tomcat ) . i us ssi org . apach . catalina . ssi . ssiservlet param name virtual webapp rel param name param valu 1 param valu all my page ( . html ) ar process ssi url pattern . html url pattern normal get request , ssi compil page everyth just ok . howev , head request same page ( need compil page ) ssi still tri do gener number except ( see enclos ) . thi error critic overload my catalina . out file . i do think difficult fix . i alreadi report thi error tomcat dev , decid creat formal bug report asf bugzilla see wa alreadi fix . thi big error , annoi . thank best regard , igor tetko apr 28 , 2006 11 : 26 : 45 am org . apach . catalina . core . applic context log sever : includ couldn t includ file : style . html java . io . ioexcept : couldn t find file : incl style . html org . apach . catalina . ssi . ssiservlet extern resolv . get file text ( ssiservlet extern resolv . java : 537 ) org . apach . catalina . ssi . ssimedi . get file text ( ssimedi . java : 155 ) org . apach . catalina . ssi . ssiinclud . process ( ssiinclud . java : 44 ) org . apach . catalina . ssi . ssiprocessor . process ( ssiprocessor . java : 146 ) org . apach . catalina . ssi . ssiservlet . process ssi ( ssiservlet . java : 221 ) org . apach . catalina . ssi . ssiservlet . request handler ( ssiservlet . java : 187 ) org . apach . catalina . ssi . ssiservlet . do get ( ssiservlet . java : 123 ) javax . servlet . http . http servlet . do head ( http servlet . java : 270 ) javax . servlet . http . http servlet . servic ( http servlet . java : 706 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . applic dispatch . invok ( applic dispatch . java : 672 ) org . apach . catalina . core . applic dispatch . do includ ( applic dispatch . java : 574 ) org . apach . catalina . core . applic dispatch . includ ( applic dispatch . java : 499 ) org . apach . catalina . ssi . ssiservlet extern resolv . get file text ( ssiservlet extern resolv . java : 519 ) org . apach . catalina . ssi . ssimedi . get file text ( ssimedi . java : 155 ) org . apach . catalina . ssi . ssiinclud . process ( ssiinclud . java : 44 ) org . apach . catalina . ssi . ssiprocessor . process ( ssiprocessor . java : 146 ) org . apach . catalina . ssi . ssiservlet . process ssi ( ssiservlet . java : 221 ) org . apach . catalina . ssi . ssiservlet . request handler ( ssiservlet . java : 187 ) org . apach . catalina . ssi . ssiservlet . do get ( ssiservlet . java : 123 ) javax . servlet . http . http servlet . do head ( http servlet . java : 270 ) javax . servlet . http . http servlet . servic ( http servlet . java : 706 ) javax . servlet . http . http servlet . servic ( http servlet . java : 802 ) org . apach . catalina . core . applic filter chain . intern do filter ( applic filter chain . java : 252 ) org . apach . catalina . core . applic filter chain . do filter ( applic filter chain . java : 173 ) org . apach . catalina . core . standard wrapper valv . invok ( standard wrapper valv . java : 213 ) org . apach . catalina . core . standard context valv . invok ( standard context valv . java : 178 ) org . apach . catalina . core . standard host valv . invok ( standard host valv . java : 126 ) org . apach . catalina . valv . error report valv . invok ( error report valv . java : 105 ) org . apach . catalina . valv . fast common access log valv . invok ( fast common access log valv . java : 495 ) org . apach . catalina . core . standard engin valv . invok ( standard engin valv . java : 107 ) org . apach . catalina . connector . coyot adapt . servic ( coyot adapt . java : 148 ) org . apach . coyot . http11 . http11processor . process ( http11processor . java : 869 ) org . apach . coyot . http11 . http11base protocol http11connect handler . process connect ( http11base protocol . java : 664 ) org . apach . tomcat . util . net . pool tcp endpoint . process socket ( pool tcp endpoint . java : 527 ) org . apach . tomcat . util . net . leader follow worker thread . run ( leader follow worker thread . java : 80 ) org . apach . tomcat . util . thread . thread pool control runnabl . run ( thread pool . java : 684 ) java . lang . thread . run ( thread . java : 613 ) ssi doe correctli process head request

tomcat server side includ ( ssi ) do work singl quot

patch : cgiservlet doe termin child after timeout

given follow page : page context . set attribut ( t , foo ) ; { t } out . print ( page context . get express evalu ( ) . evalu ( { t } , string . class , page context . get variabl resolv ( ) , null ) ) ; you notic { t } print out fine when jsp doe resolv us scriplet print noth . saniti check , i test thi work glassfish ensur i wasn t do anyth odd . i m try find root caus ; haven t found yet , so i m log case anyon els ha itch scratch . legaci el support resolv variabl correctli

hi all , my web app need have thread . current thread ( ) . get context class loader ( ) alwai right . when applic unload seem case . my class ar under t5 s share directori ( so all my servlet . get class ( ) . get class loader ( ) = = share classload i . e . : standard calss loader . my understand when execut code my web app thread . current thread ( ) . get context class loader ( ) should alwai give webapp loader us standard context . problem occur standard wrapper . unload ( ) befor call servlet . destroi ( ) method . . . . class loader old ctx class loader = thread . current thread ( ) . get context class loader ( ) ; class loader class loader = instanc . get class ( ) . get class loader ( ) ; print stream out = system . out ; ( swallow output ) { system log handler . start captur ( ) ; } call servlet destroi ( ) method try { instanc support . fire instanc event ( instanc event . befor destroi event , instanc ) ; thread . current thread ( ) . set context class loader ( class loader ) ; ( system . get secur manag ( ) = null ) { secur util . do privileg ( destroi , instanc ) ; secur util . remov ( instanc ) ; } els { instanc . destroi ( ) ; } . . . . code , instanc variabl my servlet have been load share classload . so classload set thread right . should classload relat standard context . get loader ( ) thi problem occur when i try close my t5 do window i suppos occur when i uninstal ani web app from my t5 . i notic problem t5 5 . 5 . 16 i verifi s same code 5 . 5 . 17 . so probabl problem still best regard david gagnon wrong class loader when my servlet . destroi ( ) call my servlet t5 share directori

hi , i encount strang problem my tomcat cluster webapp deploy . server . xml server port = 8005 shutdown = shutdown listen class name = org . apach . catalina . core . apr lifecycl listen listen class name = org . apach . catalina . mbean . server lifecycl listen listen class name = org . apach . catalina . mbean . global resourc lifecycl listen listen class name = org . apach . catalina . storeconfig . store config lifecycl listen global jndi resourc global name resourc environ name = simpl valu type = java . lang . integ valu = 30 resourc name = user databas auth = contain type = org . apach . catalina . user databas descript = user databas can updat save factori = org . apach . catalina . user . memori user databas factori pathnam = conf tomcat user . xml global name resourc defin tomcat stand alon servic servic name = catalina defin non ssl http 1 . 1 connector port 8080 connector address = polen integ port = 8080 max http header size = 8192 max thread = 300 min spare thread = 25 max spare thread = 100 enabl lookup = fals accept count = 100 connect timeout = 20000 disabl upload timeout = true defin ajp 1 . 3 connector port 8009 connector port = 8009 address = polen integ . sofinco . fr min processor = 20 max processor = 0 max thread = 350 min spare thread = 50 max spare thread = 100 enabl lookup = fals redirect port = 8080 protocol = ajp 1 . 3 disabl upload timeout = true engin name = catalina default host = localhost jvm rout = uxdev103 realm class name = org . apach . catalina . realm . user databas realm resourc name = user databas host name = localhost app base = webapp unpack war = true auto deploi = true xml valid = fals xml namespac awar = fals cluster definit cluster class name = org . apach . catalina . cluster . tcp . simpl tcp cluster do cluster log = true cluster log name = clusterlog expir session shutdown = fals us dirti flag = true notifi listen replic = true membership class name = org . apach . catalina . cluster . mcast . mcast servic mcast addr = 228 . 0 . 0 . 4 mcast bind address = 127 . 0 . 0 . 1 mcast cluster domain = polen integ mcast port = 45564 mcast frequenc = 1000 mcast drop time = 30000 receiv class name = org . apach . catalina . cluster . tcp . replic listen tcp listen address = polen integ tcp selector timeout = 100 tcp thread count = 6 sender class name = org . apach . catalina . cluster . tcp . replic transmitt replic mode = fastasyncqueu do transmitt process stat = true do process stat = fals do wait ack stat = fals wait ack = fals keep aliv max request count = 1 valv class name = org . apach . catalina . cluster . tcp . replic valv filter = . . gif ; . . js ; . . css ; . . png ; . . jpeg ; . . jpg ; . . htm ; . . html ; . . txt ; valv class name = org . apach . catalina . cluster . session . jvm rout binder valv enabl = true cluster listen class name = org . apach . catalina . cluster . session . cluster session listen cluster listen class name = org . apach . catalina . cluster . session . jvm rout session idbind listen deploy class name = org . apach . catalina . cluster . deploi . farm war deploy temp dir = home tomcat polen integ tmp war temp deploi dir = { catalina . base } webapp watch dir = home tomcat polen integ tmp war listen watch enabl = true cluster host engin servic server when i am try deploi dsitribut ( onli when thi flag enabl ) i get follow error : info contain background processor standard engin catalina org . apach . catalina . startup . host config deploi web applic archiv po len . war info contain background processor standard engin catalina org . apach . catalina . loader . webapp class loader illeg access : thi web appli cation instanc ha been stop alreadi . could load java . io . print stream . eventu follow stack trace caus error t hrown debug purpos well attempt termin thread which caus illeg access , ha function impact . java . lang . illeg state except org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1238 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1198 ) java . lang . class loader . load class intern ( unknown sourc ) org . apach . log4j . helper . log log . error ( log log . java : 142 ) org . apach . log4j . helper . pattern parser date pattern convert . convert ( pattern parser . java : 447 ) org . apach . log4j . helper . pattern convert . format ( pattern convert . java : 64 ) org . apach . log4j . pattern layout . format ( pattern layout . java : 503 ) org . apach . log4j . writer append . sub append ( writer append . java : 301 ) org . apach . log4j . roll file append . sub append ( roll file append . java : 234 ) org . apach . log4j . writer append . append ( writer append . java : 159 ) org . apach . log4j . append skeleton . do append ( append skeleton . java : 230 ) org . apach . log4j . helper . append attach impl . append loop append ( append attach impl . java : 65 ) org . apach . log4j . categori . call append ( categori . java : 203 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . info ( log4jlogg . java : 133 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 976 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) info contain background processor standard engin catalina org . apach . catalina . loader . webapp class loader illeg access : thi web applic ation instanc ha been stop alreadi . could load java . io . print stream . eventu follow stack trace caus error th rown debug purpos well attempt termin thread which caus illeg access , ha function impact . java . lang . illeg state except org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1238 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1198 ) java . lang . class loader . load class intern ( unknown sourc ) org . apach . log4j . helper . log log . error ( log log . java : 142 ) org . apach . log4j . helper . pattern parser date pattern convert . convert ( pattern parser . java : 447 ) org . apach . log4j . helper . pattern convert . format ( pattern convert . java : 64 ) org . apach . log4j . pattern layout . format ( pattern layout . java : 503 ) org . apach . log4j . writer append . sub append ( writer append . java : 301 ) org . apach . log4j . roll file append . sub append ( roll file append . java : 234 ) org . apach . log4j . writer append . append ( writer append . java : 159 ) org . apach . log4j . append skeleton . do append ( append skeleton . java : 230 ) org . apach . log4j . helper . append attach impl . append loop append ( append attach impl . java : 65 ) org . apach . log4j . categori . call append ( categori . java : 203 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . info ( log4jlogg . java : 133 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 976 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 759 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) info contain background processor standard engin catalina org . apach . catalina . loader . webapp class loader illeg access : thi web applic ation instanc ha been stop alreadi . could load org . apach . log4j . spi . vector writer . eventu follow stack trace caus error thrown debug purpos well attempt termin thread which caus illeg access , ha functi onal impact . java . lang . illeg state except org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1238 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1198 ) java . lang . class loader . load class intern ( unknown sourc ) org . apach . log4j . spi . log event . init ( log event . java : 154 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . error ( log4jlogg . java : 193 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 990 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 759 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) info contain background processor standard engin catalina org . apach . catalina . loader . webapp class loader illeg access : thi web applic ation instanc ha been stop alreadi . could load org . apach . log4j . spi . vector writer . eventu follow stack trace caus error thrown debug purpos well attempt termin thread which caus illeg access , ha functi onal impact . java . lang . illeg state except org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1238 ) org . apach . catalina . loader . webapp class loader . load class ( webapp class loader . java : 1198 ) java . lang . class loader . load class intern ( unknown sourc ) org . apach . log4j . spi . log event . init ( log event . java : 154 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . error ( log4jlogg . java : 193 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 990 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 759 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) error contain background processor standard engin catalina org . apach . common . model . registri null compon catalina : type = jsp monitor , name = jsp , web modul = localhost polen , j2eeapplic = none , j2eeserv = none error contain background processor standard engin catalina org . apach . catalina . startup . host config error deploi web applic arc hive polen . war java . lang . class def found error : org apach log4j spi vector writer org . apach . log4j . spi . log event . init ( log event . java : 154 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . error ( log4jlogg . java : 193 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 990 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 759 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) error contain background processor standard engin catalina org . apach . catalina . startup . host config error deploi web applic arch iv polen . war java . lang . class def found error : org apach log4j spi vector writer org . apach . log4j . spi . log event . init ( log event . java : 154 ) org . apach . log4j . categori . forc log ( categori . java : 388 ) org . apach . log4j . categori . log ( categori . java : 853 ) org . apach . common . log . impl . log4jlogg . error ( log4jlogg . java : 193 ) org . apach . catalina . cluster . session . delta manag . start ( delta manag . java : 990 ) org . apach . catalina . core . contain base . set manag ( contain base . java : 431 ) org . apach . catalina . core . standard context . start ( standard context . java : 4125 ) org . apach . catalina . core . contain base . add child intern ( contain base . java : 759 ) org . apach . catalina . core . contain base . add child ( contain base . java : 739 ) org . apach . catalina . core . standard host . add child ( standard host . java : 524 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 809 ) org . apach . catalina . startup . host config . deploi war ( host config . java : 698 ) org . apach . catalina . startup . host config . deploi app ( host config . java : 472 ) org . apach . catalina . startup . host config . check ( host config . java : 1190 ) org . apach . catalina . startup . host config . lifecycl event ( host config . java : 292 ) org . apach . catalina . util . lifecycl support . fire lifecycl event ( lifecycl support . java : 119 ) org . apach . catalina . core . contain base . background process ( contain base . java : 1305 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1569 ) org . apach . catalina . core . contain base contain background processor . process children ( contain base . java : 1578 ) org . apach . catalina . core . contain base contain background processor . run ( contain base . java : 1558 ) java . lang . thread . run ( unknown sourc ) i have tri deploi via web manag applic simpl copi my war webapp directori . . . luck , i put distribut flag applic web . xml config file , i encount thi error ; i need restart manual tomcat instanc . . . after thi restart applic correctli deploi without ani error . . . cours i disabl cluster server . xml , problem . . . simpl deploi fail cluster ( distribut flag )

