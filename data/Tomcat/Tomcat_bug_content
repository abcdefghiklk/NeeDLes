wrong import statement generation while using extends attribute page directive
ternary operator doesn work expected inside attributes jspx pages
provide way prevent looking system classloader before webapp classloaders
order invocation method server endpoint config configurator
jsp factory get page context jsp writer default buffer throws illegal argument exception
async context does timeout http nio connector
null pointer exception when running jspc from shell script jsp cservlet context java 344 return url object resource mapped specified context relative path param path context relative path desired resource exception malformed urlexception resource path properly formed override public url get resource string path throws malformed urlexception path starts throw new malformed urlexception path path does start tld cache java 124 private long get last modified tld resource path tld resource path long result new long result result try url url servlet context get resource tld resource path get webapp path usr java jdk1 45 bin java classpath home tomcat apache tomcat rc10 lib catalina storeconfig jar home tomcat apache tomcat rc10 lib tomcat websocket jar home tomcat apache tomcat rc10 lib tomcat i18n es jar home tomcat apache tomcat rc10 lib catalina tribes jar home tomcat apache tomcat rc10 lib catalina ha jar home tomcat apache tomcat rc10 lib tomcat i18n ja jar home tomcat apache tomcat rc10 lib jsp api jar home tomcat apache tomcat rc10 lib tomcat util jar home tomcat apache tomca rc10 lib tomcat jni jar home tomcat apache tomcat rc10 lib jasper jar home tomcat apache tomcat rc10 lib websocket api jar home tomcat apache tomcat rc10 lib ecj jar home tomcat apache tomcat rc10 lib tomcat i18n fr jar home tomcat apache tomcat rc10 lib tomcat api jar home tomcat apache tomcat rc10 lib tomcat coyote jar home tomcat apache tomcat rc10 lib servlet api jar home tomcat apache tomcat rc10 lib jasper el jar home tomcat apac he tomcat rc10 lib catalina jar home tomcat apache tomcat rc10 lib tomcat dbcp jar home tomcat apache tomcat rc10 lib tomcat jdbc jar home tomcat apache tomcat rc10 lib annotations api jar home tomcat apache tomcat rc10 ib tomcat util scan jar home tomcat apache tomcat rc10 lib catalina ant jar home tomcat apache tomcat rc10 lib el api jar home tomcat apache tomcat rc10 lib tomcat spdy jar home tomcat apache tomcat rc10 bin tomcat juli jar ho me tomcat apache tomcat rc10 bin bootstrap jar home tomcat apache tomcat rc10 bin commons daemon jar home tomcat apache tomcat rc10 webapps examples web inf lib jstl jar home tomcat apache tomcat rc10 webapps examples web inf li standard jar home java source head work jsp compile shared web inf lib ant jar org apache jasper jsp home java source head work tomcat80 uriroot home java source head work jsp compile shared home java source head work jsp compile shared web inf jsp dialog qb axes dlg jsp home java source head work jsp compile shared web inf jsp dialog qb manual gecoding dlg jsp home java source head work jsp compile shared web inf jsp fmtdlg jsp home java source head work jsp compile shared web inf jsp index jsp home java source head work jsp compile shared web inf jsp joindlg jsp home java source head work jsp compile shared web inf jsp producer jsp home java source head work jsp compile shared web inf jsp simplefilter jsp home java source head work jsp compile shared web inf jsp jsp home java source head work jsp compile shared web inf jsp binddows test view jsp home java source head work jsp compile shared web inf jsp jsp home java source head work jsp compile shared web inf jsp jsp home java source head work jsp compile shared web inf jsp ajax response jsp home java source head work jsp compile shared web inf jsp fontdlg jsp home java source head work jsp compile shared web inf jsp join fields jsp home java source head work jsp compile shared web inf jsp tree component jsp home java source head work jsp compile shared web inf jsp waiting banner jsp home java source head work jsp compile shared web inf jsp bid folderblock bid folder block init jsp home java source head work jsp compile shared web inf jsp bid folderblock bid folder block boot jsp home java source head work jsp compile shared web inf jsp bid bid empty content jsp home java source head work jsp compile shared web inf jsp bid xml bid url properties jsp home java source head work jsp compile shared web inf jsp bid xml bid ibfspath hrefs jsp home java source head work jsp compile shared web inf jsp bid xml bid xmlresponse jsp home java source head work jsp compile shared web inf jsp bid xml bid status response jsp home java source head work jsp compile shared web inf jsp bid favorites bid favorites tree jsp home java source head work jsp compile shared web inf jsp bid favorites bid favorites block boot jsp home java source head work jsp compile shared web inf jsp bid favorites bid favorites block init jsp home java source head work jsp compile shared web inf jsp bid favorites bid favorites tree boot jsp home java source head work jsp compile shared web inf jsp bid favorites bid list xml jsp home java source head work jsp compile shared web inf jsp bid index jsp home java source head work jsp compile shared web inf jsp bid views bid internal page jsp home java source head work jsp compile shared web inf jsp bid views bid search tree boot jsp home java source head work jsp compile shared web inf jsp bid views bid satree boot jsp home java source head work jsp compile shared web inf jsp bid views bid bi frame jsp home java source head work jsp compile shared web inf jsp bid views bid init view jsp home java source head work jsp compile shared web inf jsp bid views bid show toolbar jsp home java source head work jsp compile shared web inf jsp bid views bid external page jsp home java source head work jsp compile shared web inf jsp bid views bid satree bi frame jsp home java source head work jsp compile shared web inf jsp bid views bid init bindows jsp home java source head work jsp compile shared web inf jsp bid views bid search tree bi frame jsp home java source head work jsp compile shared web inf jsp bid recents bid recents tree boot jsp home java source head work jsp compile shared web inf jsp bid recents bid recents tree jsp home java source head work jsp compile shared web inf jsp bid recents bid list xml jsp home java source head work jsp compile shared web inf jsp bid error jsp home java source head work jsp compile shared web inf jsp bid groups bid list xml jsp home java source head work jsp compile shared web inf jsp bid search bid search list xml jsp home java source head work jsp compile shared web inf jsp bid search bid list xml jsp home java source head work jsp compile shared web inf jsp bid tree bid mr properties xml jsp home java source head work jsp compile shared web inf jsp bid tree bid flat list xml jsp home java source head work jsp compile shared web inf jsp bid tree bid plain text jsp home java source head work jsp compile shared web inf jsp bid tree bid list xml jsp exception thread main java lang null pointer exception org apache jasper servlet jsp cservlet context get resource jsp cservlet context java 344 org apache jasper compiler tld cache get last modified tld cache java 124 org apache jasper compiler tld cache init tld cache java 70 org apache jasper jsp init servlet context jsp java 1468 org apache jasper jsp execute jsp java 1321 org apache jasper jsp main jsp java 269 java lang null pointer exception org apache jasper servlet jsp cservlet context get resource jsp cservlet context java 344
split access log valve extract formatting logic abstract access log valve
when using write listener non blocking io servlet async api container makes first call write possible per spec when using write listener non blocking io servlet http upgrade api container does make initial call write possible when fixing bug worth checking initial call data available well initial call write possible made container when using http upgrade
broken response from nio connector tomcat 50
honor order when reporting xml parsing errors warnings xml error handler class
reloadable context reloaded repeatedly web inf lib contains non jar files
test ssonon login basic flawed incomplete
webapp deployment fails dirname ends war because considered zip archive tomcat tries deploy dir zip archive even when directory name ends war
tomcat auto deployer working root applications
seeing issues non blocking io when writing lots data
error message unhelpful when web xml references tld file doesn exist
jsps longer compile java
add 172 16 12 range default internal proxies
do parse web fragment xml files when empty absolute ordering
add ability provide custom sslcontext websocket client
tomcat spnego incompatible ibm jdk accept security context needs wrapped around privileged action order server side
found problem setting buffer size servlet response call response set buffer size 000 000 send about 20 000 characters response chunked even though should response sent several chunks contains transfer encoding chunked response header my case response should fully buffered server sent whole containing content length header causes problem my application because want use larger buffer able redirect error page error occurs during rendering response able reproduce tomcat 39 40 42 47 tomcat 37 works fine expected easily reproducable using jsp follows response set buffer size 1000 1000 int 100 int 100 response get writer write response get writer write br response set buffer size does seem work properly
code string path servlet context get real path test file folder named test exist webroot path return null int tomcat return correct value ex data oschina webapp test servlet context get real path returns null
spnego we check request get user principal returns prinicpal we do do fresh happens even when returned generic principal has remaining life time less than zero causes issues delegating credential credential valid any more can we add additional check when credental has expired put same session does get renewed after remaining life time less than zero
enabling manager app process description inadequate
whenever try authenticate gssapi ldap server ssl connection ldaps following exception thrown javax naming service unavailable exception myserver 636 socket closed remaining name dc example dc org com sun jndi ldap connection read reply connection java 452 com sun jndi ldap ldap client get search reply ldap client java 631 com sun jndi ldap ldap client search ldap client java 554 com sun jndi ldap ldap ctx do search ldap ctx java 1985 com sun jndi ldap ldap ctx search aux ldap ctx java 1847 com sun jndi ldap ldap ctx search ldap ctx java 1772 steps reproduce configure valve org apache catalina spnego server xml store delegated credential true configure realm org apache catalina realm jndirealm server xml ssl connection url ldaps myserver 636 configure auth method spnego security constraints security roles web xml add required keystores jdk ldaps connection try authenticate debugged jndirealm figured out changing line 2082 from context add environment javax security sasl qop auth conf context add environment javax security sasl qop auth would solve problem also tested fix new written jndirealm sure fix causes other security issues jndirealm gssapi ldap ssl connection causes exception
use ibatis my project config file path include tomcat can find file command line show could find resource ibatis code send type xml path include relative char eg classloader find zhe file
flushing async context response writer after client abort exception broken pipe causes request state leak
tomcat spnego incompatible ibm jdk case keytab based initiate accept
put listener class name org apache catalina core apr lifecycle listener sslengine off you server xml put apr connector some weeks later your server xml connector protocol org apache coyote http11 http11apr protocol port https port connection timeout 20000 max http header size 24576 max threads 250 uriencoding utf buffer size 4096 scheme https secure true sslenabled true sslprotocol tlsv1 sslcipher suite high adh file ssl cert file key file ssl cert key file sslpassword ssl password start your tomcat receive following confusing message nov 06 2013 30 39 pm org apache coyote http11 http11apr protocol start severe error starting endpoint java lang exception socket bind failed 226 adresse bereits im zugriff org apache tomcat util net apr endpoint init apr endpoint java 671 org apache tomcat util net apr endpoint start apr endpoint java 851 org apache coyote http11 http11apr protocol start http11apr protocol java 139 org apache catalina connector connector start connector java 1196 org apache catalina core standard service start standard service java 540 org apache catalina core standard server start standard server java 754 org apache catalina startup catalina start catalina java 595 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 57 sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 606 org apache catalina startup bootstrap start bootstrap java 289 org apache catalina startup bootstrap main bootstrap java 414 nov 06 2013 30 39 pm org apache catalina core standard service start severe failed start connector connector http 8444 lifecycle exception service get name catalina protocol handler start failed java lang exception socket bind failed 226 adresse bereits im zugriff org apache catalina connector connector start connector java 1203 org apache catalina core standard service start standard service java 540 org apache catalina core standard server start standard server java 754 org apache catalina startup catalina start catalina java 595 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 57 sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 606 org apache catalina startup bootstrap start bootstrap java 289 org apache catalina startup bootstrap main bootstrap java 414 course correct port availble ssl engine has been turned off should check stratup which says illegal state disabling sslengine apr lifecycle listener leads misleading error message startup when ssl connector delcared
additional quote entity html element attribute evaluated tagx attribute contains el expression
remote endpoint async send text string send handler can cause stack overflow errors contradicts oracle java doc
web application containing own tld within its web inf directory fails render jsp page referencing tld tomcat installed directory spaces path program files after moving entire tomcat installation directory path without spaces tomcat8 application can render same jsp page following stacktrace printed note 20 file path org apache jasper jasper exception jsp layouts standard jsp line column 69 file file program 20files apache tomcat rc5 webapps mywebapp web inf tlds mywebapp tags tld found org apache jasper compiler default error handler jsp error default error handler java 42 org apache jasper compiler error dispatcher dispatch error dispatcher java 276 org apache jasper compiler error dispatcher jsp error error dispatcher java 92 org apache jasper compiler tag library info impl init tag library info impl java 166 org apache jasper compiler parser parse taglib directive parser java 410 org apache jasper compiler parser parse directive parser java 476 org apache jasper compiler parser parse elements parser java 1451 org apache jasper compiler parser parse parser java 138 org apache jasper compiler parser controller do parse parser controller java 242 org apache jasper compiler parser controller parse parser controller java 102 org apache jasper compiler compiler generate java compiler java 198 org apache jasper compiler compiler compile compiler java 373 org apache jasper compiler compiler compile compiler java 353 org apache jasper compiler compiler compile compiler java 340 org apache jasper jsp compilation context compile jsp compilation context java 606 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 357 org apache jasper servlet jsp servlet service jsp file jsp servlet java 403 org apache jasper servlet jsp servlet service jsp servlet java 347 javax servlet http http servlet service http servlet java 728 java version used oracle jdk update 45 64 bit active tomcat connector http nio 8080 tld cannot loaded catalina home contains spaces
tomcat may have all permissions granted method webapp class loader get thread try access root thread group order list all threads you should either manage security exception avoid access parent thread group thread which start tomcat webapp class loader get thread want access root thread group
working tomcat 20 error javax faces context exception handler wrapper javax faces component update model exception java lang class cast exception unable add object type java lang integer array objects type int java lang class cast exception unable add object type java lang integer array objects type int javax el array elresolver set value array elresolver java 94 com sun faces el demux composite elresolver set value demux composite elresolver java 255 com sun faces el demux composite elresolver set value demux composite elresolver java 281 org apache el parser ast value set value ast value java 158 org apache el value expression impl set value value expression impl java 249 com sun faces facelets el tag value expression set value tag value expression java 131 javax faces component uiinput update model uiinput java 818 javax faces component uiinput process updates uiinput java 735 javax faces component uidata iterate uidata java 2001 javax faces component uidata process updates uidata java 1253 javax faces component uicomponent base process updates uicomponent base java 1242 javax faces component uiform process updates uiform java 281 javax faces component uicomponent base process updates uicomponent base java 1242 javax faces component uicomponent base process updates uicomponent base java 1242 javax faces component uiview root process updates uiview root java 1231 com sun faces lifecycle update model values phase execute update model values phase java 78 com sun faces lifecycle phase do phase phase java 101 com sun faces lifecycle lifecycle impl execute lifecycle impl java 118 javax faces webapp faces servlet service faces servlet java 593 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 javax el array elresolver set value supporting arrays primitives
am testing what happens when encode decode exceptions occur during jsr 356 our case we do use annotation we extend endpoint implement whole thingworx message forcing decode exception occur expecting my error called actual decode exception instead got null stepping following code tomcat message ws session session null result actual decode exception cause lost can message decoded object payload try payload decode message catch decode exception de ws session session get local error session de return tracing further up stack found util get message handlers initializing passing null session decoder match get text decoders size message handler result result new message handler result new pojo message handler whole text listener null endpoint config decoder match get text decoders new object false message handler result type text results add result please let me know can provide any more details bob jsr 356 message handling null pointer being thrown when decode exception caught pojo message handler whole base message
websocket npe util decoder match during application start
server class loader used server creation
patch support gzipped versions static resources default servlet
file specified web xml via call set web xml cannot created example directory does exist jsp fails silently jsp fails silently directory generated web xml does exist
function constant attribute tag plugin manager seems broken value order status returns false value order state name returns true according javadoc should exact opposite problem seems node literal function el null should probably el null function being used elsewhere return true attribute specified its value translation time constant public boolean tag plugin manager constant attribute string attribute node jsp attribute attr get node attribute attribute attr null return false return attr literal return true value string literal known translation time public boolean literal return expression el null named attribute tag plugin manager constant attribute broken
current method set webapp loader first via reflection because private think set urlstream handler factory should move catalina start first static field can move catalina so we could have static method catalina prevent set urlstream handler factory call while first starting clean way avoid set urlstream handler factory call
status manager servlet destroy should call bean server remove notification listener because init method call bean server add notification listener status manager servlet does remove jmx notification listener
facilitate weaving allowing class file transformer added webpp class loader
servlet request interface provides two methods iterate through request parameters enumeration string get parameter names map string string get parameter map underlying tomcat hash map which fails preserve order parameters specified request alternate should used preserve request order linked hash map example capable preserving insertion order servlet v3 speaks only relative ordering query string data post body data however section 17 13 html v4 01 titled processing form data clearly states control names values listed order appear document therefore do see valid either rationalize tomcat receive request ordered list parameters represent them guaranteed preserve order difficult rationalize order servlet request parameters preserved
concurrent issue tag file processor
java org apache catalina spnego java problems logged exception exception does show up logging exception only shows up hack java org apache catalina local strings properties catalina jar add placeholder reproduce configure sp nego kerberos mess up your principal com sun security jgss krb5 accept jaas config try login see you get something like fine org apache catalina spnego authenticate failed validate client supplied ticket fix java org apache catalina local strings properties please add following lines spnego ticket validate fail failed validate client supplied ticket spnego service login fail unable login service principal spnego java you can verify exceptions indeed passed log validate reproduce again see you now get failed validate client supplied ticket gssexception failure unspecified gss api level mechanism level invalid argument 400 cannot find key appropriate type decrypt ap rep rc4 hmac exception super helpful least something spnego resource file missing placeholders exceptions
default servlet serving multiple encodings
comet connection manager valve adding http servlet request http session which preventing session being serialized clustered setup we re resolving locally using serializable connection list class transient request public class connection list implements serializable transient request connection list null connection list request connection list connection list connection list public request get return connection list comet connection manager valve adding non serializable request session
potential null pointer exception compiled jsps expected el result primitive type
add validation query timeout property
race condition http session invalidate http servlet request get session boolean
jssesocket factory converts alias lower case condition coded follows private static final string default keystore type jks jssesocket factory default keystore type equals keystore type alias alias lower case locale english intention downcase only jks store aliases comparison should made jks constant happens contain jks present using specific comparator would both clarify code protect against possible change default albeit very unlikely jssesocket factory converts alias lower case condition unwise
want my initial pool some size empty start even fails create all some connections pool fails create initial connections some reason just throws exceptions workaround have set initial pool size can handy add flag ignore just log them exceptions occur while creating initial connections add flag ignore exceptions while creating initial pool
org apache tomcat jdbc pool connection pool close should call thread interrupted because interrupt already reset code thrown interrupted exception catch interrupted exception ex get pool properties get propagate interrupt state thread current thread interrupt else thread interrupted lost interruption
async listener timeout called when timeout occurs when traffic routed via ajp connector configured ajp nio protocol protocol async listener timeout called via ajp ajp nio protocol connector
jndirealm throws exception after timeout connection reset
ajp send body status 304
would nice org apache catalina startup tomcat add web app would process web application meta inf context xml found current skips meta inf context xml loading does appear offer any hook enable standard context instantiated initialized null config file single call add web app process web application context config embedded tomcat add web app
missing html closing tags manager application
possible related 53353 when having invalid contenttype like jsp directive page language java content type text html note trailing tomcat throws null pointer exception like java lang null pointer exception org apache tomcat util http parser http parser parse media type http parser java 217 org apache tomcat util http parser media type cache parse media type cache java 54 org apache catalina connector response set content type response java 805 org apache catalina connector response facade set content type response facade java 245 javax servlet servlet response wrapper set content type servlet response wrapper java 123 after removing extra entering charset like jsp directive page language java content type text html charset utf works expected my desired behaviour would don crash npe other tomcat versions seem handly different null pointer exception caused invalid content type trailing semicolon
el spec section 22 constructor reference states class name reference followed arguments parenthesis boolean true denotes invocation constructor class supplied arguments leads me believe following test should work test public void test import03 elprocessor processor new elprocessor object result processor get value integer 1000 integer class assert assert equals integer value 1000 result fails following error javax el elexception function integer found org apache el parser ast function get value ast function java 136 org apache el value expression impl get value value expression impl java 188 javax el elprocessor get value elprocessor java 45 org apache el parser test ast identifier test import03 test ast identifier java 53 thanks el constructor throws exception
non blocking api all data read being called twice
ws filter calls ws server container find mapping foo bar which turn calls new uri template path path contains repeated segments causes following code uri template constructor throw exception segment old segments put segment new segment index segment old null throw new illegal argument exception sm get string uri template duplicate name segment would valid duplicates were uri variable names when plain path segments path foo bar causes illegal argument exception when ws server container creates uri template
get principal context username gss credential method jndirealm designed allow delegated credentials applied directory server connection part spnego done manipulation number directory context environment parameters however currently implemented environment parameters forcibly cleared after get user call regardless whether values were even changed use delegated credential returned false container realm defined use gssapi only first spnego request succeed all subsequent requests fail exception javax naming naming exception ldap error code 000004dc ldap err dsid 0c0906dc comment order perform operation successful bind must completed connection data v1db0 exception due context security being cleared get principal resulting attempted simple bind username password anonymous workaround ensure connection name connection password parameters specified realm definition however one using gssapi shouldn necessary certainly defeats purpose using gssapi first place code should preserve pre existing environment parameters context before changing them restore those values afterwards rather than just clearing settings completely jndirealm get principal context username gss credential corrupts realm context
using persistent manager jdbcstore store sessions my database my object my session which instance org apache el method expression impl class implements interface read external method uses org apache el util reflection util name string which use thread current thread get context class loader its class loader seems incorrect because method return standard class loader which cannot find my classes web inf lib directory my webapp problem method expression impl class which use method jdbcstore which does set thread context class loader webapp class loader here stacktrace severe error processing request java lang illegal state exception erreur lors de la de la session org apache catalina session persistent manager base swap persistent manager base java 713 org apache catalina session persistent manager base find session persistent manager base java 503 org apache catalina connector request requested session id valid request java 2391 org apache catalina connector coyote adapter parse session cookies id coyote adapter java 954 org apache catalina connector coyote adapter post parse request coyote adapter java 688 org apache catalina connector coyote adapter service coyote adapter java 402 org apache coyote http11 abstract process abstract java 1002 org apache coyote abstract protocol abstract connection handler process abstract protocol java 585 org apache tomcat util net jio endpoint socket processor run jio endpoint java 312 java util concurrent thread pool executor run worker thread pool executor java 1145 java util concurrent thread pool executor worker run thread pool executor java 615 java lang thread run thread java 722 caused java lang class found exception javax faces event action event java net urlclass loader run urlclass loader java 366 java net urlclass loader run urlclass loader java 355 java security access controller do privileged native method java net urlclass loader find class urlclass loader java 354 java lang class loader load class class loader java 423 java lang class loader load class class loader java 356 java lang class name0 native method java lang class name class java 266 org apache el util reflection util name reflection util java 62 org apache el util reflection util type array reflection util java 88 org apache el method expression impl read external method expression impl java 290 java io object input stream read external data object input stream java 1835 java io object input stream read ordinary object object input stream java 1794 java io object input stream read object0 object input stream java 1348 java io object input stream read object object input stream java 370 com sun facelets el tag method expression read external tag method expression java 101 java io object input stream read external data object input stream java 1835 java io object input stream read ordinary object object input stream java 1794 java io object input stream read object0 object input stream java 1348 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream default read fields object input stream java 1989 java io object input stream read serial data object input stream java 1913 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream read object object input stream java 370 java util array list read object array list java 733 sun reflect generated method accessor90 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 601 java io object stream class invoke read object object stream class java 1004 java io object input stream read serial data object input stream java 1891 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream read array object input stream java 1704 java io object input stream read object0 object input stream java 1342 java io object input stream default read fields object input stream java 1989 java io object input stream read serial data object input stream java 1913 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream read object object input stream java 370 java util hash map read object hash map java 1155 sun reflect generated method accessor89 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 601 java io object stream class invoke read object object stream class java 1004 java io object input stream read serial data object input stream java 1891 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream read object object input stream java 370 java util hash map read object hash map java 1155 sun reflect generated method accessor89 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 601 java io object stream class invoke read object object stream class java 1004 java io object input stream read serial data object input stream java 1891 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream default read fields object input stream java 1989 java io object input stream default read object object input stream java 499 org ajax4jsf application ajax state holder read object ajax state holder java 204 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 57 sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 601 java io object stream class invoke read object object stream class java 1004 java io object input stream read serial data object input stream java 1891 java io object input stream read ordinary object object input stream java 1796 java io object input stream read object0 object input stream java 1348 java io object input stream read object object input stream java 370 org apache catalina session standard session read object standard session java 1595 org apache catalina session standard session read object data standard session java 1060 org apache catalina session jdbcstore load jdbcstore java 657 org apache catalina session persistent manager base swap persistent manager base java 707 11 more cannot deserialize session when contains objects using persistent manager
ws filter compatible async sample applications
context config validate security roles emits three info log messages which contain warning
apache tomcat has created some very important enhancements logging we should exploit them please make org apache juli async file handler org apache juli one line formatter defaults shipped conf logging properties enhancements have been vetted over 20 releases apache tomcat let give them some first class status please make async file handler one line formatter default logging properties
described user list tomcat unlike tomcat 42 throws illegal argument exception upon calling servlet context get real path seems tc8 expects argument provided get real path non empty string believe servlet context get real path should allow empty string argument ognjen stack trace error java lang illegal argument exception java lang illegal argument exception org apache catalina webresources abstract resource set check path abstract resource set java 39 org apache catalina webresources dir resource set get resource dir resource set java 91 org apache catalina webresources standard root get resource internal standard root java 176 org apache catalina webresources cached resource validate cached resource java 62 org apache catalina webresources cache get resource cache java 78 org apache catalina webresources standard root get resource standard root java 163 org apache catalina core standard context get real path standard context java 4528 org apache catalina core application context get real path application context java 398 org apache catalina core application context facade get real path application context facade java 335 org apache axis2 deployment war based axis configurator init war based axis configurator java 103 org apache axis2 transport http axis servlet init config context axis servlet java 584 org apache axis2 transport http axis servlet init axis servlet java 454 org apache catalina core standard wrapper init servlet standard wrapper java 1235 org apache catalina core standard wrapper load servlet standard wrapper java 1148 org apache catalina core standard wrapper load standard wrapper java 1044 org apache catalina core standard context load startup standard context java 5025 org apache catalina core standard context start internal standard context java 5322 org apache catalina util lifecycle base start lifecycle base java 150 org apache catalina core container base add child internal container base java 726 org apache catalina core container base add child container base java 702 org apache catalina core standard host add child standard host java 698 org apache catalina startup host config deploy war host config java 968 org apache catalina startup host config deploy war run host config java 1742 java util concurrent executors runnable adapter call executors java 471 java util concurrent future task sync inner run future task java 334 java util concurrent future task run future task java 166 java util concurrent thread pool executor run worker thread pool executor java 1145 java util concurrent thread pool executor worker run thread pool executor java 615 java lang thread run thread java 724 webresources class abstract resource set throws exception upon callong servlet context get real path
issue digest flow working error thrown function sequence error package name org apache catalina realm class name jdbcrealm method name string get password string username snapshot from above mentioned method stmt credentials db connection username rs stmt execute query due connection commit resultset nullified db connection commit while executing statement throws function sequence error rs next db credentials rs get string above explanation has been validate placing 41 catalina jar where above changes due fix 55071 bug below snapshot error observed while trying digest jul 31 2013 43 40 pm org apache catalina realm jdbcrealm get password severe exception performing java sql sqlexception times ten times ten 11 odbc driver function sequence error com timesten jdbc jdbc odbc create sqlexception jdbc odbc java 3238 com timesten jdbc jdbc odbc standard error jdbc odbc java 3387 com timesten jdbc jdbc odbc sqlfetch jdbc odbc java 921 com timesten jdbc jdbc odbc result set next jdbc odbc result set java 409 org apache catalina realm jdbcrealm get password jdbcrealm java 558 org apache catalina realm realm base get digest realm base java 1189 org apache catalina realm realm base authenticate realm base java 409 com kodiak digest kn digest kn digest info authenticate kn digest java 733 com kodiak digest kn digest authenticate kn digest java 275 org apache catalina base invoke base java 574 org apache catalina valves access log valve invoke access log valve java 953 org apache catalina core standard host valve invoke standard host valve java 171 org apache catalina valves error report valve invoke error report valve java 99 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 408 org apache coyote http11 abstract process abstract java 1023 org apache coyote abstract protocol abstract connection handler process abstract protocol java 589 org apache tomcat util net jio endpoint socket processor run jio endpoint java 312 java util concurrent thread pool executor run worker thread pool executor java 1145 java util concurrent thread pool executor worker run thread pool executor java 615 java lang thread run thread java 724 jul 31 2013 43 40 pm org apache catalina realm jdbcrealm get password severe exception performing java sql sqlexception times ten times ten 11 odbc driver function sequence error com timesten jdbc jdbc odbc create sqlexception jdbc odbc java 3238 com timesten jdbc jdbc odbc standard error jdbc odbc java 3387 com timesten jdbc jdbc odbc sqlfetch jdbc odbc java 921 com timesten jdbc jdbc odbc result set next jdbc odbc result set java 409 org apache catalina realm jdbcrealm get password jdbcrealm java 558 org apache catalina realm realm base get digest realm base java 1189 org apache catalina realm realm base authenticate realm base java 409 localhost 2013 07 31 log 50l 3800c cheers mahaaboob jdbcrealm digest flow working throws function sequence error
when ws browser client disconnects unexpectedly snake sample user just closes browser loads another page you get ugle error logs tomcat server 2013 07 27 12 04 34 424 error 31847 nio 8080 exec org apache tomcat websocket ws session failed send close message remote endpoint java io ioexception java util concurrent execution exception java io eofexception org apache tomcat websocket ws remote endpoint impl base start message block ws remote endpoint impl base java 221 org apache tomcat websocket ws session send close message ws session java 466 org apache tomcat websocket ws session close ws session java 430 org apache tomcat websocket server ws http upgrade handler close ws http upgrade handler java 172 org apache tomcat websocket server ws http upgrade handler access 200 ws http upgrade handler java 45 org apache tomcat websocket server ws http upgrade handler ws read listener data available ws http upgrade handler java 198 org apache coyote http11 upgrade abstract servlet input stream data available abstract servlet input stream java 169 org apache coyote http11 upgrade abstract processor upgrade dispatch abstract processor java 95 org apache coyote abstract protocol abstract connection handler process abstract protocol java 630 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor do run nio endpoint java 1585 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1543 java util concurrent thread pool executor run worker thread pool executor java 1145 java util concurrent thread pool executor worker run thread pool executor java 615 java lang thread run thread java 724 caused java util concurrent execution exception java io eofexception org apache tomcat websocket ws remote endpoint impl base future send handler get ws remote endpoint impl base java 779 org apache tomcat websocket ws remote endpoint impl base start message block ws remote endpoint impl base java 217 14 common frames omitted caused java io eofexception null org apache tomcat websocket server ws remote endpoint impl server do close ws remote endpoint impl server java 126 org apache tomcat websocket ws remote endpoint impl base close ws remote endpoint impl base java 531 org apache tomcat websocket server ws remote endpoint impl server write possible ws remote endpoint impl server java 107 org apache tomcat websocket server ws remote endpoint impl server do write ws remote endpoint impl server java 71 org apache tomcat websocket ws remote endpoint impl base write message part ws remote endpoint impl base java 353 org apache tomcat websocket ws remote endpoint impl base start message ws remote endpoint impl base java 254 org apache tomcat websocket ws remote endpoint impl base start message block ws remote endpoint impl base java 211 14 common frames omitted presumably expected relatively normal so expect lot less noise error log ugly error log when ws client disconnects unexpectedly
like fact sci scanning off default tomcat embedded instance lik eto able switch might even possible already api non obvious maybe method tomcat associated friendly helper would also nice tomcat sci scan embedded tomcat
concurrent issue tag plugin manager
include jasper initializer test environment added entry testclasses meta inf services picked up when parent classloader searched because path directory jar file would picked up scan all directories extension enabled should necessary search semantically equivalent service loader which does locate servlet container initializer parent classloader may found
did some load test thread got stuck see dump basically just simulate 100 users connect disconnect nio thread locked
bug ws server container leading npe
jsp property group contains multiple include prelude elements happen refer same file only one include performed same applies codas happens because web xml stores linked hash set rather than list when multiple jsp property group combined jsp config uses vector so preserves duplicates required jsp spec have test case before committing fix would like confirmation web xml behaviour incorrect duplicate preludes codas same jsp property group ignored
jsp property same all url patterns group current code creates new one each iteration unnecessary work jsp config
test suite should include tests jsp ant task add test cases jsp
change how servlet context created missed tld locations cache jsp does initialize tld locations cache resulting npe
jsp throws class found exception from digester
websocket soe nio endpoint
websocket npe clear handler ws remote endpoint impl server java 156
abstract overwrites date header even when set application
xml syntax jsp text does error sub elements from other namespaces
jsp jsp config now reads version jsp config information from servlet context uses get major version which returns maximum version supported container should use get effective version use version web application servlet context get jsp config descriptor can return null jsp config web xml jsp config does allow throw npe web xml application npe incorrect version detection jsp
digester uses sax2 features still based sax1 default handler upgrading default handler2 would able handle base uris when resolving entities would have default lexical handler using lexical handler would allow respond directly start dtd event reports doctype present so would need infer from first attempt resolve entity upgrade digester based default handler2 use lexical handler detect public id
duplicate exists both schema resolver parser utils my entity resolver also basic version digester common entity resolver can used catalina jasper
javax servlet resources package does contain jsp xsds referenced from web app web common xsds define elements like jsp config schema location references between servlet jsp xsds invalid
severe servlet content initializer licensed apache software foundation asf under one more could created
see sometimes failing connections due ioexception see below happens when trying send thousands binary messages 1024 bytes each without any delay between subsequent messages having look code async channel wrapper secure write task run 219 think correct assume all bytes buffer written shall produce ioexception think case shall attempt write rest bytes cycle here one exception got during test exception java io ioexception java util concurrent execution exception java io ioexception only wrote 460 098 bytes org apache tomcat websocket ws remote endpoint impl base start message block ws remote endpoint impl base java 204 org apache tomcat websocket ws remote endpoint impl base send bytes ws remote endpoint impl base java 113 org apache tomcat websocket ws remote endpoint basic send binary ws remote endpoint basic java 43 websockets test manager test thread run websockets test manager java 271 caused java util concurrent execution exception java io ioexception only wrote 460 098 bytes org apache tomcat websocket ws remote endpoint impl base future send handler get ws remote endpoint impl base java 729 org apache tomcat websocket ws remote endpoint impl base start message block ws remote endpoint impl base java 202 more caused java io ioexception only wrote 460 098 bytes org apache tomcat websocket async channel wrapper secure write task run async channel wrapper secure java 220 java util concurrent thread pool executor run worker thread pool executor java 1145 java util concurrent thread pool executor worker run thread pool executor java 615 java lang thread run thread java 789 websocket problem writing many subsequent binary messages
use ipvhosts true incorrect get request local name
npe pojo method mapping get message handler
missing ws protocol header session negotiated headers
subprotocols available annotated
ping pong messages should have identical application data
configured server xml like connection timeout disable upload timeout false connection upload timeout 200 maybe stupid configure like connection timeout can make disable upload timeout false cause java lang illegal argument exception timeout can negative sun nio ch socket adaptor set so timeout socket adaptor java 361 org apache coyote http11 http11nio processor set socket timeout http11nio processor java 251 because disable upload timeout endpoint get so timeout set socket timeout endpoint get so timeout another thing configure connection timeout nio blocking selector read byte buffer buf nio channel socket long read timeout read timeout case socket read buf make timeout true read timeout keycount timedout system current time millis time read timeout throw socket timeout exception thank you connection timeout causes timeout can negative
have test which adds message handler which gets notified text messages its method message string text throws some exception runtime exception message handler never ever notified again any new text messages received session suppose happens because exception actually kills underlying thread which notification has happened think client side shall more robust expect prepared exceptions coming from calls user code jsr 356 websocket message handler never gets notified again after throws exception
incorrect parameter name remote ip valve examples
connection timeout causes high cpu
ability bundle jaas webappp
when configure disable upload timeout false connection timeout 20000 connection upload timeout 30000 found connection upload timeout doesn work because code internal nio input buffer read socket try nio endpoint key attachment att nio endpoint key attachment socket get attachment false att null throw new ioexception key must cancelled read pool read socket get buf handler get read buffer socket selector att get timeout catch eofexception eof read finally selector null pool put selector att get timeout connection timeout connection upload timeout so nio blocking selector read read timeout connection timeout nio connection upload timeout can work
wasted work attribute names enumerator constructor
wasted work error report valve get partial servlet stack trace
ability configure rmi bind address
fix msg byte encoder decoder test encoding decoding websocket test
add ability report time taken prepare response
tomcat does shut down lifecycle listener throws exception
encoders init destroy methods never called
iae thrown during deployment server end point having multiple text decoders
basic parser associated unit tests
tomcat jar scanning does work when tomcat started java web start
usually error security hole security constraints defined some all http methods given url situation detected web application start log log uncovered http methods combined security constraints
wasted work validate visitor expression
wasted work abstract replicated map exclude from set
wasted work webdav servlet locked
wasted work test non login basic do test basic
juli make class loader log manager get property try unprefixed property prefixed one does exist
cors filter
currently ant deploy task does support separate parameter version thanks urlencoder workaround apps empty context possible define version using like setting path some context some version apps empty context we receive error case deploy url tomcat manager text username username password password path root 12345 war pathtowar result failed deploy application context path root 12345 case deploy url tomcat manager text username username password password path 12345 war pathtowar result failed deploy application context path 12345 deploy root webapp version through text manager using ant
testing found re created upon re via logout login username password same request problem stemmed from req ssoid note reset upon request logout whereas indicates logout from any web app should logout from all web apps when req ssoid note removed upon logout subsequent login username password same request re create jsessionid current web app fails re create since req sso id note still lingers request base java adjustment logout request removes req ssoid note so subsequent login username password work same request override public void logout request request throws servlet exception register request request get response null null null null request remove note constants req ssoid note ll upload diff patch against trunk 40 re created upon re same request logout login username password
ssl handshake asycn channel wrapper secure does handle sslengine result status buffer underflow sslengine result status buffer overflow states
file name parameter relative vs absolute fila name parameter jsr 000315 java servlet final release javadocs different from javax api tomcat refers jsr 000315 java servlet final release javadocs parameters file name name file which stream written file created relative location specified multipart config javax api tomcat refers param file name location which uploaded part should stored relative locations relative link javax servlet multipart config element get location tomcat implemented specified so can process absolute path should only accept relative path specified jsr 000315 java servlet final release javadocs multi part config location set write string relative path throws file found exception default location needs set order avoid exception example os windows8 part write test java io ioexception java io file found exception test access denied org apache catalina core application part write application part java 123 servlet multipart multiple upload servlet do post multiple upload servlet java 76 javax servlet http http servlet service http servlet java 647 javax servlet http http servlet service http servlet java 728 org apache catalina core application filter chain internal do filter application filter chain java 305 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina core standard wrapper valve invoke standard wrapper valve java 222 org apache catalina core standard context valve invoke standard context valve java 123 org apache catalina base invoke base java 472 org apache catalina core standard host valve invoke standard host valve java 171 org apache catalina valves error report valve invoke error report valve java 99 org apache catalina valves access log valve invoke access log valve java 947 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 408 org apache coyote http11 abstract process abstract java 1009 org apache coyote abstract protocol abstract connection handler process abstract protocol java 589 org apache tomcat util net jio endpoint socket processor run jio endpoint java 312 java util concurrent thread pool executor worker run task thread pool executor java 895 java util concurrent thread pool executor worker run thread pool executor java 918 java lang thread run thread java 662 javax servlet http part write string file name properly implemented
class loading issue tag plugin tag plugin manager
concurrent issue spdy net support socket
make compress configurable spdy proxy protocol
http request broken up across multiple packets first packet contains get request up terminating first line request included next packet tomcat incorrectly throws http 505 version supported response http11nio protocol connector only default http connector does exhibit problem example request packet get http packet host localhost packet connection close response http 505 http version supported server apache coyote date thu 09 may 2013 20 23 58 gmt connection close following python program reproduces problem me both tomcat 37 tomcat 39 usr bin python import socket import time socket socket connect localhost 8080 sendall get http time sleep make sure above goes out its own packet sendall host localhost sendall connection close print makefile read moving from second sendall end first sendall causes tomcat respond correctly http11nio protocol generates http 505 responses valid requests request split across multiple packets
enhancements test form
jsp include page blabla flush true failed compile under security manager
bug occurs when form data posted multipart form data using servlet api get posted files servlet we set encoding request set character encoding utf invoke request get parts invoke string text request get parameter utf characters text have been garbled order method calls significant get parameter called before get parts correct encoding used however order which you invoke methods should matter multipart form data always read correct encoding
async scenario request start async when client goes away trying write response raises ioexception call async context complete order finalize clean up request soon after following exception occurs java lang illegal state exception calling async error valid request async state completing org apache coyote async state machine async error async state machine java 304 org apache coyote http11 abstract action abstract java 793 org apache coyote request action request java 373 org apache catalina core async context impl set error state async context impl java 441 org apache catalina connector coyote adapter async dispatch coyote adapter java 312 org apache coyote http11 abstract async dispatch abstract java 1509 org apache coyote http11 http11nio processor async dispatch http11nio processor java 221 org apache coyote abstract protocol abstract connection handler process abstract protocol java 619 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor do run nio endpoint java 1581 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1540 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 looks like attempt maybe send error event async listener async context complete has already been called calling async context complete reasonable way handle ioexception from response order finalize request release any resorces associated illegal state exception calling async error valid request async state completing
mapping application context root returns 404 after reload
according servlet javadoc servlet context get jsp config descriptor must return null when jsp returns jsp config related aggregated from web xml web fragment xml descriptor files web application represented servlet context null exists servlet context get jsp config descriptor should return null when jsp
according servlet javadoc javax servlet session cookie config setter methods must throw illegal state exception when invoked after phase set comment string set domain string set http only boolean set max age int set name string set path string set secure boolean throws java lang illegal state exception servlet context from which session cookie config acquired has already been initialized session cookie config set xxx methods must throw illegal state exception when invoked after phase
input parse media type multipart signed protocol application pkcs7 signature micalg sha 256 boundary part 121 929034657 exception trace java lang null pointer exception org apache tomcat util http parser http parser parse media type http parser java 215 org apache tomcat util http parser media type cache parse media type cache java 54 org apache catalina connector response set content type response java 806 org apache catalina connector response check special header response java 1119 org apache catalina connector response set header response java 1446 org apache catalina connector response facade set header response facade java 535 nullpointer exception http parser parse media type
webapp class loader loaded child can throw concurrent modification exception
ws filter performs several validations web socket requests before checking registered endpoint think check registered endponts delegation next filter should take place first filter should do further processing mapped endpoint url example sock js protocol test send post request connection upgrade headers ws version header expects back 405 invalid http method where ws filter sends 426 even though has endpoint mapped url ws filter performs handshake validation even doesn have mapped endpoint
tag plugin each doesn support csv items
el like expressions jsp scriptlet break compilation jsp xml documents
one http request use post method tomcat calls do get what really strage only tested 23 32 32 32 more than 23 know must very strange issue tomcat has so many release can believe didn see my own eyes so attache image cve 2013 2071 runtime exception complete async listener make org apache catalina connector request recycled orginally reported message post tomcat called do get
use base file name root work directory default webapp instead
npe ws server container matching path
looks related 54659 54724 possibly new issue reproduce open chat sample page send message two close browser tab following exception appears log doesn seem step from anything done application java lang illegal state exception web socket session has been closed method apart from close may called closed session org apache tomcat websocket ws session check state ws session java 516 org apache tomcat websocket ws session get message handlers ws session java 191 org apache tomcat websocket pojo pojo endpoint base close pojo endpoint base java 113 org apache tomcat websocket ws session fire endpoint close ws session java 392 org apache tomcat websocket ws session close ws session java 370 org apache tomcat websocket server ws http upgrade handler close ws http upgrade handler java 166 org apache tomcat websocket server ws http upgrade handler access 200 ws http upgrade handler java 44 org apache tomcat websocket server ws http upgrade handler ws read listener data available ws http upgrade handler java 192 org apache coyote http11 upgrade abstract servlet input stream data available abstract servlet input stream java 169 org apache coyote http11 upgrade abstract processor upgrade dispatch abstract processor java 94 org apache coyote abstract protocol abstract connection handler process abstract protocol java 618 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor do run nio endpoint java 1581 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1537 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 illegal state exception chat sample
whenever web socket container used connect server endpoint following message appears when tomcat shuts down severe web application websocket test appears have started thread named thread has failed stop very likely create memory leak message repeated different threads don have proof caused use web socket container messages don appear when isn used endpoint used connect very simple sends message when session opened echo endpoint server side prints response closes when message echoed back possible thread memory leak use web socket container
caused java lang class cast exception org apache tomcat websocket server ws server container template path match cannot cast java lang comparable java util tree map compare tree map java 1188 java util tree map put tree map java 531 java util tree set add tree set java 255 org apache tomcat websocket server ws server container add endpoint ws server container java 144 org apache tomcat websocket server ws sci startup ws sci java 118 org apache catalina core standard context start internal standard context java 5195 org apache catalina util lifecycle base start lifecycle base java 150 11 more reproducible when path defined path example override public set server endpoint config get endpoint configs set class extends endpoint endpoint classes logger debug detected jsr356server endpoint config class get name return new hash set server endpoint config add server endpoint config builder create class path configurator build jsr356 java lang class cast exception org apache tomcat websocket server ws server container template path match
url query string can work over spdy
folder without web fragment xml should impact status
type based endpoint ws servlet instantiates endpoint via reflection instead using configurator done pojo endpoint server sec get configurator get endpoint instance sec get endpoint class type based endpoint cannot deployed instance
ioexception new frame received after close control frame raised after pressing disconnect exception can detected adding error method echo endpoint ioexception echo web socket example
statement cache interceptor does forward calls statement close which causes memory leaks
server side create data source using org apache tomcat jdbc pool data source factory ex resource auth container description name jdbc test tomcat jdbc factory org apache tomcat jdbc pool data source factory type javax sql data source username sa password super secret driver class name org h2 driver url jdbc h2 mem test min idle initial size web application create jsp file add following page import javax naming session false doctype html html head title display password title head body h1 string tomcat jdbc h1 data source javax sql data source ctx lookup java comp env jdbc test tomcat jdbc out println data source string body html access jsp your browser output from string data source display password configured resource tag example output string tomcat jdbc org apache tomcat jdbc pool data source 75cae120 connection pool default auto commit null default read only null default transaction isolation default catalog null driver class name org h2 driver max active 100 max idle 100 min idle initial size max wait 30000 test borrow false test return false time between eviction runs millis 5000 num tests per eviction run min evictable idle time millis 60000 test while idle false test connect false password super secret url jdbc h2 mem test username sa validation query null validator class name null validation interval 30000 access underlying connection allowed true remove abandoned false remove abandoned timeout 60 log abandoned false connection properties null init sql null jdbc interceptors null jmx enabled true fair queue true use equals true abandon when percentage full max age use lock false data source null data source jndi null suspect timeout alternate username allowed false commit return false rollback return false use disposable connection facade true log validation errors false propagate interrupt state false data source password exposed applications via string method
spec java doc says once session closed longer valid use applications calling any its methods once session has been closed result illegal state exception being thrown developers should retrieve any information from session during endpoint close session close reason method course rules closeable also apply here calling session close more than once should have effect subsequent times actually three problems here none methods throw illegal state exception session closed instead return things like basic remote example some methods endpoint notice concurrent exceptions from socket block forever waiting four countdown clear session state never actually changed state closed unless session close called however session close never actually called can find though look harder before make changes even session close state incorrectly changed state closed before endpoint close called when should changed after working patch ws session does throw illegal state exception closed when methods called
remote endpoint blocks indefinitely send object called binary stream text stream encoders
java web socket says message methods can have input stream reader parameters close can have close reason parameters
official schemes web socket ws wss ws web socket container only allows http https
prefer locale english over locale us case conversion
have defined server end point server endpoint value ws mid rid uid when using path param message values null other annotations like open close print values specified url message public void text message path param mid long mid path param rid integer rid path param uid long uid session session string message boolean pair log debug text mid rid uid message session get request uri path param working message
hello think ve found file descriptor leak file tomcat trunk java org apache catalina startup context config java method get global web xml source stream from file web xml closed private web xml get default web xml fragment 1284 input source global web xml get global web xml source 1337 parse global web xml present 1338 global web xml null 1339 unusual enough log 1340 log info sm get string context config default missing 1341 else 1342 parse web xml global web xml web xml default fragment false 1343 here full stack trace java io file input stream init file input stream java 109 org apache catalina startup context config get web xml source context config java 1837 org apache catalina startup context config get global web xml source context config java 1744 org apache catalina startup context config get default web xml fragment context config java 1417 org apache catalina startup context config web config context config java 1253 org apache catalina startup context config configure start context config java 878 org apache catalina startup context config lifecycle event context config java 369 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 90 org apache catalina core standard context start internal standard context java 5173 org apache catalina util lifecycle base start lifecycle base java 150 org apache catalina core container base add child internal container base java 901 org apache catalina core container base add child container base java 877 org apache catalina core standard host add child standard host java 633 org apache catalina startup host config deploy war host config java 977 org apache catalina startup host config deploy apps host config java 542 org apache catalina startup host config check host config java 1462 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache tomcat util modeler base model mbean invoke base model mbean java 301 com sun jmx interceptor default mbean server interceptor invoke default mbean server interceptor java 836 com sun jmx mbeanserver jmx mbean server invoke jmx mbean server java 761 org apache catalina manager manager servlet check manager servlet java 1445 org apache catalina manager htmlmanager servlet upload htmlmanager servlet java 301 org apache catalina manager htmlmanager servlet do post htmlmanager servlet java 208 javax servlet http http servlet service http servlet java 647 javax servlet http http servlet service http servlet java 728 org apache catalina core application filter chain internal do filter application filter chain java 305 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina filters csrf prevention filter do filter csrf prevention filter java 213 org apache catalina core application filter chain internal do filter application filter chain java 243 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina filters set character encoding filter do filter set character encoding filter java 108 org apache catalina core application filter chain internal do filter application filter chain java 243 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina core standard wrapper valve invoke standard wrapper valve java 222 org apache catalina core standard context valve invoke standard context valve java 123 org apache catalina base invoke base java 581 org apache catalina core standard host valve invoke standard host valve java 171 org apache catalina valves error report valve invoke error report valve java 99 org apache catalina valves access log valve invoke access log valve java 931 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 407 org apache coyote http11 abstract process abstract java 1004 org apache coyote abstract protocol abstract connection handler process abstract protocol java 589 org apache tomcat util net apr endpoint socket processor run apr endpoint java 1822 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 662 file descriptor leak web xml loading
implement part get submitted file name from servlet spec 57
when access log valve added catalina host jmx add vale operation host object name valve start default file date format changing attribute valve through jmx object name has effect because valve already started executing rotate operation valve does also have effect steps reproduce start tomcat server add host using jmx add valve host using jmx set valve attribute file date format something else than yyyy mm dd example yy mm actual results access log file format include default file date format yyyy mm dd expected results access log file format yy mm from example access log valve file date format can changed through jmx
https bio nio connector does enable tls tls default
spec says server container provider get server container should public implemented package private tomcat
something wrong when send binary data websocket see org apache catalina websocket ws outbound do write bytes byte buffer boolean think write content upgrade outbound write buffer array buffer limit upgrade outbound flush should change write content upgrade outbound write buffer array buffer array offset buffer limit upgrade outbound flush example byte bts new byte byte buffer bf byte buffer wrap bts out write binary message bf mean write client fact sent something wrong when send binary data websocket
setup tomcat ajp connector behind mod proxy ajp form based when session expires post request submitted tomcat shows login form user logs tries restore original post request doing tries swallow ajp message body before replacing body request original post request body tries read first bytes ajp message message length blocks forever waiting those bytes form hangs re post request behind mod proxy ajp
fatal error when trying send data web socket conection closed
hi all manager status xml true informations about memory pools incorrect every row all values initial committed maximum used same memory pools name eden space type heap memory initial 143130624 committed 143130624 maximum 143130624 used 143130624 name survivor space type heap memory initial 17891328 committed 17891328 maximum 17891328 used 17891328 name tenured gen type heap memory initial 357957632 committed 357957632 maximum 357957632 used 357957632 name code cache type non heap memory initial 163840 committed 8421376 maximum 33554432 used 163840 name perm gen type non heap memory initial 12582912 committed 23330816 maximum 67108864 used 12582912 name perm gen shared ro type non heap memory initial 10485760 committed 10485760 maximum 10485760 used 10485760 name perm gen shared rw type non heap memory initial 12582912 committed 12582912 maximum 12582912 used 12582912 instead gui page values correct manager status xml true
custom webapp class loader created delegate true parent first classloading model used everything works here expected however jsp classpath always constructed following manner custom webapp class loader urls parent urls parent parent urls whereas expected me delegate true parent urls should come first webapp loader doesn honor delegate attr while constructing jsp classpath
request contains uri ends multi byte character which missing byte extra bytes left buffer which reused future request problem comes from two different things b2cconverter tries convert byte chunk which ends character underflow does convert last character left buffer b2cconver b2cconverter org apache catalina connector request recycled rest objects looks like done based comment above declaration issue b2cconverter can demonstrated code below which what done inside coyote adapter convert uri code b2cconverter conv new b2cconverter utf byte chunk bc new byte chunk char chunk cc new char chunk byte bytes 0x61 0x62 0x63 0x64 69 73 77 bc append bytes bytes length cc allocate bc get length conv convert bc cc cc get buffer length cc get end system out println cc cc recycle bc recycle bc append bytes bytes length cc allocate bc get length conv convert bc cc cc get buffer length cc get end system out println cc code b2cconverter recycled everything else request would prevent previous request from corrupting next request doesn fix issue character dropped from initial decode tried playing b2cconverter only way could get convert get everything ignoring limit argument reading end stream looks like tomcat8 moving direction move nio however tried playing latest b2cconverter still seeing issues given byte sequence b2cconverter character decode underflow leaves bytes buffer
part class missing
completed servlet spec change session id http session id listener
error report valve doesn respect http servlet response send error int sc string msg
extensible el interpreter
chunked input filter returning eof when client closes connection without sending end chunk
concerned components org apache catalina digest org apache catalina digest nonce info scenario client sends two requests within one millisecond digest creates each request nonce well nonce info instance two nonces equal were created within same millisecond when writing data cache method generate nonce second nonce info instance overwrites first one same key problem two client threads send second request digest header both requests nc nonce count equal nonce has been newly created nonce info first request array seen set true index nonce count offset seen length second request same nonce info instance used instance retrieved from map nonces using nonce key both requests same key used consequently method nonce count valid returns false seen nonce count offset seen length has already been set true therefore fails although client has sent valid digest header conclusion working multi threaded clients many requests digest does function reliably digest nonce count valid fails case simultaneous asynchronous requests same client
jmx connection may load servlet invalid class loader
trunk r1441188 running test suite apr connector native 26 windows 32 bit jdk 7u11 encountered following when running org apache catalina loader test virtual context test second re run test same issue happened so something specific here have encountered issue rest testsuite yet feb 01 2013 07 26 am org apache tomcat util net apr endpoint poller run warning unexpected poller error java lang null pointer exception org apache tomcat util net apr endpoint apr socket wrapper access 200 apr endpoint java 2198 org apache tomcat util net apr endpoint poller run apr endpoint java 1632 java lang thread run thread java 722 code apr endpoint poller run apr endpoint java 1632 1628 int rv 1629 timeouts remove desc 1630 apr socket wrapper wrapper connections get 1631 long value desc 1632 wrapper poller flags wrapper poller flags int desc suspect wrapper null here above code specific tomcat trunk present when happened test hung 15 minutes 1000 secs waiting socket read when time out passed continued run all other tests testcase test additional web inf classes paths took 006 735 sec caused error read timed out java net socket timeout exception read timed out java net socket input stream socket read0 native method java net socket input stream read socket input stream java 150 java net socket input stream read socket input stream java 121 java io buffered input stream fill buffered input stream java 235 java io buffered input stream read1 buffered input stream java 275 java io buffered input stream read buffered input stream java 334 sun net www http http client parse httpheader http client java 633 sun net www http http client parse http http client java 579 sun net www protocol http http get input stream http java 1322 java net http get response code http java 468 org apache catalina startup tomcat base test method url tomcat base test java 247 org apache catalina startup tomcat base test get url tomcat base test java 219 org apache catalina startup tomcat base test get url tomcat base test java 213 org apache catalina startup tomcat base test get url tomcat base test java 202 org apache catalina loader test virtual context assert page contains test virtual context java 326 org apache catalina loader test virtual context assert page contains test virtual context java 320 org apache catalina loader test virtual context test additional web inf classes paths test virtual context java 311 null pointer exception apr endpoint poller run
observed when testing tomcat trunk r1438747 win xp 32 bit jdk 7u11 running test ws web socket container apr tomcat native 26 rc occurred npe webapp class loader check thread local map leaks uncaught caused lifecycle exception ultimately failure stop tomcat stderr severe child container failed during stop java util concurrent execution exception org apache catalina lifecycle exception failed stop component standard engine tomcat standard host localhost standard context java util concurrent future task sync inner get future task java 252 java util concurrent future task get future task java 111 org apache catalina core container base stop internal container base java 974 org apache catalina util lifecycle base stop lifecycle base java 232 org apache catalina core container base stop child call container base java 1404 org apache catalina core container base stop child call container base java 1393 java util concurrent future task sync inner run future task java 334 java util concurrent future task run future task java 166 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 caused org apache catalina lifecycle exception failed stop component standard engine tomcat standard host localhost standard context org apache catalina util lifecycle base stop lifecycle base java 236 more caused org apache catalina lifecycle exception failed stop component webapp loader org apache catalina util lifecycle base stop lifecycle base java 236 org apache catalina core standard context stop internal standard context java 5365 org apache catalina util lifecycle base stop lifecycle base java 232 more caused java lang null pointer exception sun reflect unsafe field accessor impl ensure obj unsafe field accessor impl java 54 sun reflect unsafe object field accessor impl get unsafe object field accessor impl java 36 java lang reflect field get field java 372 org apache catalina loader webapp class loader check thread local map leaks webapp class loader java 2247 org apache catalina loader webapp class loader check thread locals leaks webapp class loader java 2188 org apache catalina loader webapp class loader clear references webapp class loader java 1731 org apache catalina loader webapp class loader stop webapp class loader java 1641 org apache catalina loader webapp loader stop internal webapp loader java 491 org apache catalina util lifecycle base stop lifecycle base java 232 more testcase testcase test small text buffer client text message took 328 sec caused error failed stop component standard server org apache catalina lifecycle exception failed stop component standard server org apache catalina util lifecycle base stop lifecycle base java 236 org apache catalina startup tomcat stop tomcat java 336 org apache catalina startup tomcat base test tear down tomcat base test java 163 caused org apache catalina lifecycle exception failed stop component standard service tomcat org apache catalina util lifecycle base stop lifecycle base java 236 org apache catalina core standard server stop internal standard server java 766 org apache catalina util lifecycle base stop lifecycle base java 232 caused org apache catalina lifecycle exception failed stop component standard engine tomcat org apache catalina util lifecycle base stop lifecycle base java 236 org apache catalina core standard service stop internal standard service java 501 org apache catalina util lifecycle base stop lifecycle base java 232 caused org apache catalina lifecycle exception child container failed during stop org apache catalina core container base stop internal container base java 981 org apache catalina util lifecycle base stop lifecycle base java 232 thoughts we should catch throwables those check leaks methods should cause failed stop component failure method many calls table array member should evaluated only once so does become null unexpectedly runtime exception webapp class loader check thread local map leaks causes lifecycle exception
public string string string builder buf new string builder org apache catalina tribes membership member impl might better use get class get name cover static member any other sub classes might arise tribes membership member impl string might better using get class get name
performance tuning solution resolve too many cascaded jsp context wrapper issue
param destination member destination length believe should param destination member destination length incorrect param javadoc tribes group group channel send methods
file name information detail error when compiling java file generated from tag file
get password method data source realm does log enough information when encounters sql error catch block catch sqlexception container log error sm get string data source realm get password exception username finally would really helpful have some details what sqlexception am getting have resorted subclassing get password attempt figure out what going wrong data source realm should provide more info sqlexception
hi have servlet annotated properties injection target declarations web xml when try request servlet receive javax naming name found exception name env entry1 bound context unable find env entry1 org apache naming naming context lookup naming context java 820 org apache naming naming context lookup naming context java 154 org apache naming naming context lookup naming context java 831 org apache naming naming context lookup naming context java 168 org apache catalina core default instance manager lookup method resource default instance manager java 622 org apache catalina core default instance manager process annotations default instance manager java 466 org apache catalina core default instance manager new instance default instance manager java 157 org apache catalina core default instance manager new instance default instance manager java 138 org apache catalina core standard wrapper load servlet standard wrapper java 1137 org apache catalina core standard wrapper allocate standard wrapper java 858 org apache catalina core standard wrapper valve invoke standard wrapper valve java 136 org apache catalina core standard context valve invoke standard context valve java 123 org apache catalina base invoke base java 472 org apache catalina core standard host valve invoke standard host valve java 171 org apache catalina valves error report valve invoke error report valve java 99 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 407 org apache coyote http11 abstract process abstract java 1004 org apache coyote abstract protocol abstract connection handler process abstract protocol java 589 org apache tomcat util net jio endpoint socket processor run jio endpoint java 310 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 680 problem when application uses injection target declarations org apache catalina core default instance manager populate annotations cache class map string string only first setter method evaluated rest skipped would like propose patch test case looking forward your comments regards violeta injection fails when part servlet properties uses resource other uses injection target
hi have servlet one field primitive type field annotated resource public class my servlet extends http servlet resource mapped name private int env entry protected void do get http servlet request req http servlet response resp throws servlet exception ioexception when request servlet receive following exception severe allocate exception servlet my servlet javax naming naming exception cannot create resource instance org apache naming factory resource env factory get object instance resource env factory java 117 javax naming spi naming manager get object instance naming manager java 304 org apache naming naming context lookup naming context java 843 org apache naming naming context lookup naming context java 154 org apache naming naming context lookup naming context java 831 org apache naming naming context lookup naming context java 168 org apache catalina core default instance manager lookup field resource default instance manager java 581 org apache catalina core default instance manager process annotations default instance manager java 470 org apache catalina core default instance manager new instance default instance manager java 157 org apache catalina core default instance manager new instance default instance manager java 138 org apache catalina core standard wrapper load servlet standard wrapper java 1137 org apache catalina core standard wrapper allocate standard wrapper java 858 org apache catalina core standard wrapper valve invoke standard wrapper valve java 136 org apache catalina core standard context valve invoke standard context valve java 123 org apache catalina base invoke base java 472 org apache catalina core standard host valve invoke standard host valve java 171 org apache catalina valves error report valve invoke error report valve java 99 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 407 org apache coyote http11 abstract process abstract java 1004 org apache coyote abstract protocol abstract connection handler process abstract protocol java 589 org apache tomcat util net jio endpoint socket processor run jio endpoint java 310 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 680 because method below primitive types converted wrappers field interpreted env entry resource env ref org apache catalina startup web annotation set add resource context resource string string attaching patch solves issue test case looking forward your comments regards violeta field primitive type annotated resource recognized env entry
support required disable tls compression prevent against crime attacks
bug fix 52953 introduces null pointer exception realm base java line 409 when user found jdbc
tag plugin manager init throws npe when used ant jasper task
nio bio connectors share most jsse based differ handling ciphers ssl enabled protocols attributes nio connector sets configured values both attributes directly sslengine which fail immediately any them unsupported makes creating portable superset collection ciphers impossible ibm jdks do support many cipher suite names used jsse vice versa usually tls vs ssl prefixes differ supported options differ between java etc bio connector attempts filter specified values down those supported ssl has issues well none specified ciphers protocols supported silently use defaults ssl which can lead unexpectedly unwittingly insecure propose modify nio connector use same logic bio connector filter requested ciphers protocols supported values placing operations sslutil interface modify ciphers protocols filtering logic treat explicit list unsupported options setting supported ciphers protocols warn when done also fail visibly errors ssl connections attempted nio bio connectors handle unsupported ssl ciphers ssl enabled protocols differently
ve found interesting mal functioning application where just copied mapping portion web xml new created servlet forgot change de uri tomcat deployed application without any warning when running application only last referenced servlet working like mapping first has been overwritten last xml file made additional tests using annotations servlets behavior having more than one servlet same mapping causes random access one another cannot determine predictable way order prevent breaking existing applications would like have just big warning log startup deployment application have more than one servlet mapped same url examples problem example web xml servlet servlet name print dacte servlet servlet name servlet class br com simfrete v1 web print dacte servlet servlet class servlet servlet servlet name cotacao report servlet servlet name servlet class br com simfrete v1 web cotacao report servlet servlet class servlet servlet mapping servlet name print dacte servlet servlet name url pattern secure relatorios action url pattern servlet mapping servlet mapping servlet name cotacao report servlet servlet name url pattern secure relatorios action url pattern servlet mapping example annotations java servlet files web servlet name pdf report print url patterns secure relatorios do report public class pdf report print extends abstract base servlet web servlet name print boleto servlet url patterns secure relatorios do report public class print boleto servlet extends http servlet having servlets same url should least cause warning
implement support post construct pre destroy elements web xml
activate ssi tomcat restart tomcat create any html file comment like put html file webapp folder tomcat when you now go html file via tomcat you get nullpointer exception ssiservlet class other necessary ssi classes cannot found nullpointer exception after activating ssi loading any html file specific comment
tomcat websocket api now allows send ping frame server 33 via ws outbound never reports receipt pong see stream inbound data method else op code constants opcode pong op intended use pings heartbeat messages allowing ping without informing server extension returned pong leaves out half utility would suggest changes stream inbound fix data method else op code constants opcode pong pong frame get pay load add method pong byte buffer buffer protected void pong byte buffer buffer op which may now override handle pong receipt heartbeat logic necessary data marked final so alternate workaround websocket stream inbound never reports receipt pong
remote ip filter class code publishes new request attributes access log see below 821 request attributes enabled 822 request set attribute access log remote addr attribute 823 request get remote addr 824 request set attribute access log remote host attribute 825 request get remote host 826 request set attribute access log protocol attribute 827 request get protocol 828 request set attribute access log server port attribute 829 integer value request get server port 830 problem source values should come from request request get remote addr request get remote host etc written above remote ip filter simply republishes current values access log therefore does display correct values remote ip filter does correctly set request attributes access log
mapper listener lifecycle event check state parent before calling register wrapper
request contains content includes bom my case content type application xml charset utf 16 content has bom ff fe when fetched utilizing buffered reader from get reader first request serviced ajp thread works correctly encoded correctly only characters fetched however any subsequent request thread which includes bom has bom being delivered application appears via review tomcat code recycle method b2cconverter simply ensures socket data has been completely flushed underlying input stream doesn get reset don really know way do without re ensure subsequent requests bom consumed proved test adding call reset within recycle method which re instantiates underlying input streams problem resolved itself ve temporarily resolved issue my application code using request get input stream using request get character encoding encoding content inside my application retrieving content contains bom via request get reader issue
how reproduce from inside context initialized method servlet context listener instance call context add filter null new arbitrary filter path prefix add mapping url patterns null false path prefix what happens dec 12 2012 59 03 pm org apache catalina core standard context filter start severe exception starting filter null java lang null pointer exception org apache tomcat util modeler util object name value needs quote util java 26 org apache catalina core application filter config register jmx application filter config java 421 org apache catalina core application filter config init filter application filter config java 282 org apache catalina core application filter config init application filter config java 108 org apache catalina core standard context filter start standard context java 4650 org apache catalina core standard context start internal standard context java 5306 org apache catalina util lifecycle base start lifecycle base java 150 org apache catalina core container base add child internal container base java 901 org apache catalina core container base add child container base java 877 org apache catalina core standard host add child standard host java 633 org apache catalina startup host config deploy descriptor host config java 657 org apache catalina startup host config deploy descriptor run host config java 1637 java util concurrent executors runnable adapter call executors java 471 java util concurrent future task sync inner run future task java 334 java util concurrent future task run future task java 166 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 dec 12 2012 59 03 pm org apache catalina core standard context start internal severe error filter start dec 12 2012 59 03 pm org apache catalina core standard context start internal severe context startup failed due previous errors what should happen either null allowed filter name throw illegal argument exception context add filter allowed filter name handle null values gracefully util object name value needs quote throws npe anonymous filters
use absolute ordering element does disable servlet container initializer classpath scanning discussed also issue 53619 however does seem require having least one web fragment name listed other words would absolute ordering turn off all web fragments since none named workaround list web fragment even doesn exist shouldn necessary empty absolute ordering should turn off all web fragments
npe mapping method el
jsp unloading null pointer exception when using tag files
posted mailing list oct 28 2011 didn end up creating report until now have same error tomcat problem description have exception appended below think would nice have more information about what going had more context would help me find cause my problem much more quickly example exception indicated what file resource having problem would speed up immensely how reproduce jar file contained war file web inf lib folder change manifest mf file jar file put line only class path note space after period which what causes error during load application exception which have appended end message show up suggested improvement my suggestion would modify extension validator validate application around line 195 location actually knows about what resource would nice ioexception caught information about resource added exception probably wrapping exception because have gone through overhead getting version tomcat running from source changes have been compiled tested think suggestion relatively straight forward here suggested code changes first code change move definition resource outside try catch locate manifests all bundled jars resource resource null added naming enumeration binding ne null second code change make existing declaration resource just assignment resource resource obj modified input stream resource stream content manifest jmanifest get manifest input stream third code change add catch clause re throw catch naming exception nex jump out check application because has resources catch ioexception ioex added throw new ioexception validation problem resource string ioex added finally problem resource may have proper string would suggest changing file dir context 898 inner class file resource have string method something along lines public string string added return file null null file string added added note about original email thread konstantin kolinko said sure about file resource string adding catch ioexception looks like doable finally here exception 28 oct 2011 11 03 03 am org apache catalina core standard context start internal severe error dependency check java io ioexception invalid header field java util jar attributes read attributes java 410 java util jar manifest read manifest java 199 java util jar jar input stream init jar input stream java 83 java util jar jar input stream init jar input stream java 60 org apache catalina util extension validator get manifest extension validator java 394 org apache catalina util extension validator validate application extension validator java 195 org apache catalina core standard context start internal standard context java 5037 org apache catalina util lifecycle base start lifecycle base java 148 org apache catalina core container base start internal container base java 1033 org apache catalina core standard host start internal standard host java 774 org apache catalina util lifecycle base start lifecycle base java 148 org apache catalina core container base start internal container base java 1033 org apache catalina core standard engine start internal standard engine java 291 org apache catalina util lifecycle base start lifecycle base java 148 org apache catalina core standard service start internal standard service java 443 org apache catalina util lifecycle base start lifecycle base java 148 org apache catalina core standard server start internal standard server java 727 org apache catalina util lifecycle base start lifecycle base java 148 org apache catalina startup catalina start catalina java 621 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 57 sun reflect delegating method accessor impl invoke delegating method accessor impl java 43 java lang reflect method invoke method java 616 org apache catalina startup bootstrap start bootstrap java 322 org apache catalina startup bootstrap main bootstrap java 450 only java util jar attributes read reported which attribute had problem we really business enhance exception reporting jar file error
exception jmx remote lifecycle listener destroy server
npe body content impl
npe data source register jmx although data source created set jmx enabled false
found while debugging version 29 found our slow query report jmx mbean being deregistered during webapp shutdown tracked down npe interceptor properties being set done setup connection prior pool close callback connection pool close boolean pool closed callback produces npe slow query report jmx code pool properties interceptor definition proxies get pool properties get jdbc interceptors array int proxies length try proxies get interceptor class new instance pool closed catch exception log debug unable inform interceptor pool closure code npe slow query report jmx null contains key code public object name get object name class clazz string pool name throws malformed object name exception npe get properties contains key object name attribute code sounds reasonable set properties any time you need instantiate interceptors done connection pool init pool code jdbc interceptor interceptor proxies get interceptor class new instance interceptor set properties proxies get properties interceptor pool started code slow query report jmx mbean failure due npe properties set during pool close callback
error report valve invoked non error responses too
jdbc connection pool runs out connections when context reload true enabled tomcat
javadoc org apache naming java java urlcontext factory context factory java namespace important note factory must associated java url prefix which can done either ul li adding java naming factory url pkgs org apache catalina util naming property jndi properties file li li setting environment variable named context url pkg prefixes its value including org apache catalina util naming package name more detail about can found jndi link javax naming spi naming manager get urlcontext java lang string java util hashtable li ul author remy maucherat version id org apache catalina util naming very old package name correct name both tc6 tc7 org apache naming java urlcontext factory javadoc refers defunct package names initial context properties
methods calls send error int null internally thus generating html page without message mentioned docs one could assume response empty one could duplicate first paragraph send error int string method alter server defaults creating response look like html formatted server error page any specific message setting content type text html further error page declaration has been made web application status code passed served back might need improvement case am native speaker moreover would add method effectively same calling send error int null plus add see send error int string though java docs seems verbatim copy oracle servlet api does reveal information explicitly should provide patch doc available svn apache org improve http servlet response send error int java doc description
processing java io reader out tagplugin
add display perm gen memory pool usage status page manager webapp
does allow realms nested more than levels deep
http connector incorrectly throws exception invalid modified since header
minor enhancements http client test helper class
clearly shown org apache catalina core async context impl dispatch servlet context string override public void dispatch servlet context context string path log debug enabled log debug dispatch check request get attribute async request uri null request set attribute async request uri request get request uri request get query string request set attribute async context path request get context path request set attribute async servlet path request get servlet path request set attribute async query string request get query string value async request uri same request get request uri must equal each other defined servlet dispatched request parameters async path info missing wrong javax servlet async request uri information javax servlet async path info missing
servlet spec violation async timeout processing
ws outbound missing ping method
servlet type env entry can any type which has public constructor taking single string character argument tomcat only accepts fixed list types see naming context listener from line 813 legal web xml accepted tomcat env entry env entry name location env entry name env entry type java io file env entry type env entry value var lib tomcat env entry value env entry env entry rejects legal types
spnego stateless ness incompatible stateful clients
web fragment sorting incorrectly detects circular reference
upgrade response transfer encoding chunked invalid
performance tuning solution page context impl xml escape
cgiservlet different parameter pass shell environment
comet event end event sent suspended socket disconnect when running tomcat native tcnative dll windows vista windows server 2008 newer
target class object class generator generates new string quoted attribute value tag handler how about using quoted directly same when target class object class creating string instance cause some overhead from memory allocation hash code recaluation when used key hash map here detail code param target class which coerce given string param string value param attr name name attribute whose value being supplied param prop editor class property editor given attribute param named attribute true given attribute named attribute specified using jsp attribute standard action false otherwise private string convert string class string string attr name class prop editor class boolean named attribute string quoted named attribute quoted quote prop editor class null string class name get canonical name return class name org apache jasper runtime jsp runtime library get value from bean info property editor class name class attr name quoted prop editor class get canonical name class else string class return quoted else boolean class return jsp util coerce primitive boolean named attribute else boolean class return jsp util coerce boolean named attribute else byte class return jsp util coerce primitive byte named attribute else byte class return jsp util coerce byte named attribute else char class return jsp util coerce char named attribute else character class return jsp util coerce character named attribute else double class return jsp util coerce primitive double named attribute else double class return jsp util coerce double named attribute else float class return jsp util coerce primitive float named attribute else float class return jsp util coerce float named attribute else int class return jsp util coerce int named attribute else integer class return jsp util coerce integer named attribute else short class return jsp util coerce primitive short named attribute else short class return jsp util coerce short named attribute else long class return jsp util coerce primitive long named attribute else long class return jsp util coerce long named attribute else object class return new string quoted else string class name get canonical name return class name org apache jasper runtime jsp runtime library get value from property editor manager class name class attr name quoted new string instance generated constant string generator convert string
page context tag files generated java code when using code generation jstl tagplugin set
tribes stack using tcp ping interceptor tcp failure detector message dispatch interceptor static membership interceptor do work well static cluster first side ie one thread call tcp failure detector heartbeat call check members false call perform basic check synchronized membership perform basic check missing static node add missing member membership membership member alive here second thread have some time work check member alive remove since doesn exist second side ie another thread some call channel get members like what done abstract replicated map call call tcp failure detector get members one could return wrong value since can contains unavailable nodes note synchronize membership isn use tcp failure detector get member get members has members neither membership equivalent method maybe because too heavy lock every thread while tcp failure detector check node alive must issue abstract replicated map since without tcp failure detector node could disapear while replicated map try use replicated map use always channel send options default where value channel send options use ack so message sent missing node fail exception personnaly override tcp failure detector heartbeat avoid perform basic check use static tcp ping interceptor call perform forced check doesn fix replicated map issue better fix could avoid adding missing member membership list add method like member alive member impl membership without side effect add member tcp failure detector perform basic check check new method before adding node doesn fix abstract replicated map issue which work always acknoledge from other nodes same code tomcat best regards arnoud replicated map don like tcp failure detector static
connectors jk java org apache jk common handler request java coyote request scheme mb assigned places 1st place 400 boolean ssl msg get byte 401 ssl 402 xxx req set secure true 403 req scheme set string https 404 2nd place 518 case ajp constants sc ssl cert 519 req scheme set string https similar assignments sc ssl cipher sc ssl session cases below seems do make sense because packet bit field designated telling whether ssl so 1st place enough adding 2nd place may pose potential bug packet bit ssl field being suffixes sc ssl key value pairs can later incorrect trigger wrong redirection message pointing https location simple correction honor bit ssl field packet delete lines 2nd place assigning https even though chances spurious packet low best we can have threat free semantic correct tomcat code same lines code remain maybe code which case please kindly point out thanks suggestion code improvement avoiding potential bug
during load test tomcat 30 we occasionally see npes from access log valve some requests being executed part load test call http session invalidate mention because code question appears susceptible manipulation session think fix should simple check null return value request get session internal course our access log pattern includes logging session id java lang null pointer exception org apache catalina valves access log valve session id element add element access log valve java 1733 org apache catalina valves access log valve log access log valve java 955 org apache catalina core access log adapter log access log adapter java 51 org apache catalina core standard engine log access standard engine java 332 org apache catalina core container base log access container base java 1270 org apache catalina core container base log access container base java 1270 org apache catalina connector coyote adapter service coyote adapter java 441 org apache coyote http11 abstract process abstract java 1002 org apache coyote abstract protocol abstract connection handler process abstract protocol java 585 org apache tomcat util net jio endpoint socket processor run jio endpoint java 312 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 existing code convenience protected static class session id element implements access log element override public void add element string builder buf date date request request response response long time request null request get session false null buf append request get session internal false line 1733 get id internal else buf append else buf append possible fix request get session false null session internal session request get session internal false internal session null buf append internal session get id internal else buf append else buf append npe access log valve
comment end tag preceded directly dash causes jsp fail compilation
default servlet directory listings aliased directories do seem work
servlet container initializer can add mapping because default servlet loaded first first reported 51278 public final class sample servlet container initializer implements servlet container initializer public void startup final set class final servlet context ctx throws servlet exception final xml web application context app ctx new xml web application context app ctx set config location web inf dispatcher servlet servlet xml final servlet registration dynamic dispatcher ctx add servlet dispatcher servlet new dispatcher servlet app ctx dispatcher set load startup final set string conflict set dispatcher add mapping final string conflict conflict set out println conflict prints test case follows attached unable override default servlet when using tomcat embedded mode
under parallel deployment when older version application has zero sessions shut down release tomcat jvm resources christopher schultz suggested approaches might possible tomcat user list modify parallel deployment code register mbean notification listener filters useful events expiring session outgoing webapp when listener receives notification check current state session count suppose you could make part your filter step session count start new thread stops outgoing webapp de registers listener install session event listener counts down sessions you ll have get count from jmx suppose until equal starts new thread etc install timer thread polls intervals minute see all sessions dead starts thread etc first idea seems cleanest though tomcat might actually fire mbean events things like session count changing shut down old versions parallel deployment
performance tuning solution jsp reader
201 private void close outbound connection ws frame frame throws ioexception 202 try 203 get ws outbound close frame 204 finally 205 do close constants opcode close 206 207 line 205 uses close opcode instead valid status constants status sure exact context called seems only called when last frame from client close frame thus constants status normal may order frame opcode could inspected mapped appropriate status normal shutdown etc thanks michael stream inbound close outbound connection ws frame closes opcode instead status
behaviour security constraints
infinte loop cause file dir context cdi weld project when using eclipse server modules without publishing
first column table lists web applications tomcat manager webapp contains links those applications href examples examples when link clicked browser navigates examples results 302 redirect examples would better change link point directly examples href examples examples am changing link address only text because path web application displayed column used manager commands elsewhere does have additional change webapp links manager point appname instead appname
apr 22 2007 11 53 32 am org apache coyote http11 process severe error finishing request java lang array index out bounds exception 28 org apache coyote http11 filters chunked input filter parse chunk header chunked input filter java 256 org apache coyote http11 filters chunked input filter do read chunked input filter java 129 org apache coyote http11 filters chunked input filter end chunked input filter java 179 org apache coyote http11 internal input buffer end request internal input buffer java 368 org apache coyote http11 process java 894 org apache coyote http11 http11base protocol handler process connection http11base protocol java 664 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 595 array index out bounds exception parse chunk header
static resources jsp files under web inf lib jar meta inf resources found
class org apache catalina core application filter registration methods add mapping servlet names add mapping url patterns have inverted logic how register filter context parameter match after passed true filter placed context using add filter map before method match after context add filter map before filter map else context add filter map filter map logic should ultimate both methods match after context add filter map before filter map else context add filter map filter map match after context add filter map filter map else context add filter map before filter map svn rev trunk 1375614 dynamic filter registration mapping logic inverted
some gzipped responses result java io ioexception corrupt gzip trailer during gunzip
have jar which contains web fragment tlds when starting server get message org apache jasper compiler tld locations cache tld scan jar info least one jar scanned tlds yet contained tlds enable debug logging logger complete list jars were scanned tlds were found them skipping unneeded jars during scanning can improve startup time jsp compilation time so far so good when adding tomcat util scan default jar scanner jars skip property web fragment won scanned either log message should only printed when tlds web fragments could found jar misleading log output when jars skip cointains web fragments
hit tomcat 20 different urls seconds test some wait minutes do again always get exception get intermitent connection interrupted messages browser here full trace aug 10 2012 33 14 pm org apache catalina connector coyote adapter event severe null aug 10 2012 33 14 pm org apache catalina connector coyote adapter event java lang null pointer exception org apache coyote http11 http11apr processor action internal http11apr processor java 277 org apache coyote http11 abstract action abstract java 846 org apache coyote response action response java 172 org apache catalina connector coyote adapter event coyote adapter java 229 org apache coyote http11 http11apr processor event http11apr processor java 133 org apache coyote abstract protocol abstract connection handler process abstract protocol java 581 org apache tomcat util net apr endpoint socket processor run apr endpoint java 1770 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 aug 10 2012 33 14 pm org apache coyote http11 http11apr processor event severe error processing request java lang null pointer exception org apache coyote http11 http11apr processor action internal http11apr processor java 277 org apache coyote http11 abstract action abstract java 846 org apache coyote request action request java 346 org apache catalina connector request get remote addr request java 1281 org apache catalina connector request get remote host request java 1296 org apache catalina valves access log valve host element add element access log valve java 1327 org apache catalina valves access log valve log access log valve java 953 org apache catalina core access log adapter log access log adapter java 51 org apache catalina core container base log access container base java 1263 org apache catalina core container base log access container base java 1270 org apache catalina connector coyote adapter event coyote adapter java 250 org apache coyote http11 http11apr processor event http11apr processor java 133 org apache coyote abstract protocol abstract connection handler process abstract protocol java 581 org apache tomcat util net apr endpoint socket processor run apr endpoint java 1770 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 additional information hp proliant dl360 two 3ghz processors cent os one app runs websockets under bleading edge atmosphere grails 20 urls come from chrome firefox java lang null pointer exception org apache coyote http11 http11apr processor action internal http11apr processor java 277
only last url pattern from jsp property group processed
now jasper codes only supports jar url relative url may enough common web applications while possible third party uses other protocol url like file protocol based url so jsp files always recompiled each access target page codes located compiler out dated method possible provide more generic handlering url jsp file always recompiled using file based tld url
send redirect doesn work after dispatch through async context
javadoc fixes
class internal nio output buffer includes field int total currently defined line 227 which between javadoc method body which javadoc applies private synchronized int write socket invalidates method javadoc field used keep running total bytes written method however field actually referenced system out println statement commented out field associated code shcould probably deleted field kept should private should probably changed long course should moved so does invalidate method javadoc internal nio output buffer unused debug code
we have servlet defined servlet servlet name version info servlet servlet name jsp file web inf svnrevision jsp jsp file servlet mapped servlet mapping servlet name version info servlet servlet name url pattern svnrevision url pattern servlet mapping worked fine we changed metadata complete true from now we receive info marking servlet version info servlet unavailable lip 20 2012 11 05 36 am org apache catalina core standard wrapper valve invoke severe allocate exception servlet version info servlet javax servlet servlet exception servlet class has been specified servlet version info servlet org apache catalina core standard wrapper load servlet standard wrapper java 1130 org apache catalina core standard wrapper allocate standard wrapper java 857 org apache catalina core standard wrapper valve invoke standard wrapper valve java 136 org apache catalina core standard context valve invoke standard context valve java 123 org apache catalina core standard host valve invoke standard host valve java 168 org apache catalina valves error report valve invoke error report valve java 98 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 407 org apache coyote ajp ajp nio processor process ajp nio processor java 184 org apache coyote abstract protocol abstract connection handler process abstract protocol java 585 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 metadata complete true servlet defined jsp working
jsp forward action static resources causes illegal state exception when inside classic custom tag
bug virtual webapp feature custom tags badly supported error org apache jasper jasper exception absolute uri http java sun com jsp jstl core cannot resolved either web xml jar files deployed application
support ssl op cipher server preference sslhonor cipher order
according rfc6455 section handling subprotocol requests correct must checked sec web socket protocol instead sec web socket protocol client web socket servlet class wrong websocket subprotocol
added data set message new xbyte buffer tcp ping data false tcp ping interceptor send ping message function protected void send ping message member members members null members length return channel data data new channel data true generates unique id data set address get local member false data set timestamp system current time millis data set options get option flag data set message new xbyte buffer tcp ping data false try super send message members data null catch channel exception log warn unable send tcp ping error also tomcat regards fred message set ping tcp ping interceptor fail null pointer exception channel data get data package length
start int method initializes failure detector resp static members only tcp failure detector resp static membership interceptor found channel interceptors stack without tcp failure detector resp static membership interceptor futur calls send ping fail because failure detector resp static members wasn initialized least new weak reference static membership interceptor null fix v1 initializes weak references containers replace weak reference tcp failure detector failure detector null weak reference static membership interceptor static members null weak reference tcp failure detector failure detector new weak reference tcp failure detector weak reference static membership interceptor static members new weak reference static membership interceptor v2 checks field before send ping becomes protected void send ping failure detector null failure detector get null we have reference failure detector piggy back dude failure detector get check members true else static only static members null static members get null send ping message static members get get members else send ping message get members affect also tomcat regards fred arnoud null pointer exception tcp ping interceptor
out memory while performing context config web config
response normalize char chunk cc introduced 28 introduced bug see bug id 53062 url being encoded resources org apache wicket markup html wicket event reference wicket event js lm 1340711670 which causes illegal argument exception method java lang illegal argument exception org apache catalina connector response normalize response java 1799 org apache catalina connector response absolute response java 1732 org apache catalina connector response encode url response java 1242 org apache catalina connector response facade encode url response facade java 406 org apache wicket protocol http web response encode url web response java 149 org apache wicket protocol http request web request coding strategy encode web request coding strategy java 387 running same application tomcat 27 18 works without issue possible bug response normalize char chunk cc
class org apache catalina tribes group group channel java line 692 org apache catalina tribes group interceptors non blocking coordinator java line 228 org apache catalina tribes group interceptors tcp ping interceptor java line 173 org apache catalina tribes membership mcast service impl java line 542 org apache juli async file handler java line 124 line 146 org apache tomcat util net apr endpoint java line 640 org apache tomcat util net nio blocking selector java line 112 line 177 org apache tomcat util threads thread pool executor java line 187 affect 29 previous release affect also tomcat call interrupt after interrupted exception instead interrupted
method connection pool terminate transaction pooled connection con uses check value boolean viz con get pool properties get default auto commit boolean false 100 safe user sets property follows string value derived from property file set default auto commit new boolean value condition never true even value false although better use boolean value value which would have same problem code ought work regardless connection pool terminate transaction unsafe check boolean
hi properties rollback return commit return which critical cleaning up connections after used returned pool does work when default auto commit property set when set true code segment connection pool class has protected boolean terminate transaction pooled connection con try con get pool properties get default auto commit boolean false full logic wrapped first statement see correct because actual default auto commit value when we don set property can either auto commit true false which depends database driver also even when we have default setting provided user has freedom change auto commit flag either true false beginning when get connection from pool so we should reading pool properties place just check current live connection auto commit value act accordingly so suppose fix should simply remove outer statement cheers anjana rollback return commit return does work without default auto commit false
my nodes running tomcat 26 using custom session manager which extends delta manager my start internal method first calls super start internal performs few additional reviewed code delta manager start internal calls get all cluster sessions which turn calls wait send all sessions which requires either get state transfered return true timeout so should able trust second node starts initial sync up all session data from first node has completed prior start internal method exiting thus prior my however case can confirm repeatedly logging value find sessions length during my see number going up appears race condition between processing message containing actual session data transfer complete message after tracing through little further see state transfered set true handle all session callback method callback being called prior session data itself even being received here debug logging output slightly scrubbed which shows out order messaging jul 2012 20 41 pm org apache catalina ha session delta manager get all cluster sessions info manager wwwtest requesting session state from org apache catalina tribes membership member impl operation timeout session state has been received within 60 seconds jul 2012 20 41 pm org apache catalina ha session delta manager message received fine manager wwwtest received session message type session state transfered from org apache catalina tribes membership member impl jul 2012 20 41 pm org apache catalina ha session delta manager handle all session fine manager wwwtest received from node 6789b939 000 session state transfered jul 2012 20 41 pm org apache catalina ha session delta manager message received fine manager wwwtest received session message type all session data from org apache catalina tribes membership member impl jul 2012 20 41 pm org apache catalina ha session delta manager handle all session data fine manager wwwtest received session state data race condition out order operation session replication node startup
atomicity violation bugs because misusing concurrent collections
hi dev tomcat list described topic byte serving pdfs default servlet issue had tomcat serve pdfs analysing answers could find matter related case file extension today tomcat case sensitive mime type extensions so solution me enter two mime web xml file one pdf another one pdf way would like ask request enhancement make tomcat able due setup file consider case mime type extensions regards vitor rfe mime type extension case sensitive
new servlet global error page error page location error jsp location error page handled tomcat glassfish example works fine global error page handled
28 longer accept our jsp filenames
deploy two different web applications onto tomcat each web application has resource uses use tomcat jdbc connection pool has identical name other one resource name jdbc collision factory org apache tomcat jdbc pool data source factory when starting server you get non fatal error logs instance already exists exception both applications appear still work ok error org apache tomcat jdbc pool data source unable register jdbc pool jmx javax management instance already exists exception tomcat jdbc name jdbc soscvuk context type connection pool host localhost class org apache tomcat jdbc pool data source com sun jmx mbeanserver repository add mbean repository java 453 na 32 com sun jmx interceptor default mbean server interceptor internal add object default mbean server interceptor java 1484 na 32 com sun jmx interceptor default mbean server interceptor register dynamic mbean default mbean server interceptor java 963 na 32 com sun jmx interceptor default mbean server interceptor register object default mbean server interceptor java 917 na 32 com sun jmx interceptor default mbean server interceptor register mbean default mbean server interceptor java 312 na 32 com sun jmx mbeanserver jmx mbean server register mbean jmx mbean server java 482 na 32 org apache tomcat jdbc pool data source register jmx data source java 135 tomcat jdbc jar na org apache tomcat jdbc pool data source pre register data source java 102 tomcat jdbc jar na org apache tomcat util modeler base model mbean pre register base model mbean java 1132 tomcat coyote jar 27 com sun jmx interceptor default mbean server interceptor pre register invoke default mbean server interceptor java 1010 na 32 com sun jmx interceptor default mbean server interceptor register dynamic mbean default mbean server interceptor java 938 na 32 com sun jmx interceptor default mbean server interceptor register object default mbean server interceptor java 917 na 32 com sun jmx interceptor default mbean server interceptor register mbean default mbean server interceptor java 312 na 32 com sun jmx mbeanserver jmx mbean server register mbean jmx mbean server java 482 na 32 org apache tomcat util modeler registry register component registry java 742 tomcat coyote jar 27 org apache catalina core naming context listener add resource naming context listener java 1062 catalina jar 27 org apache catalina core naming context listener create naming context naming context listener java 671 catalina jar 27 org apache catalina core naming context listener lifecycle event naming context listener java 270 catalina jar 27 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 catalina jar 27 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 90 catalina jar 27 org apache catalina core standard context start internal standard context java 5161 catalina jar 27 org apache catalina util lifecycle base start lifecycle base java 150 catalina jar 27 org apache catalina core container base add child internal container base java 895 catalina jar 27 org apache catalina core container base add child container base java 871 catalina jar 27 org apache catalina core standard host add child standard host java 615 catalina jar 27 org apache catalina startup host config deploy descriptor host config java 649 catalina jar 27 org apache catalina startup host config deploy descriptor run host config java 1585 catalina jar 27 java util concurrent executors runnable adapter call executors java 441 na 32 java util concurrent future task sync inner run future task java 303 na 32 java util concurrent future task run future task java 138 na 32 java util concurrent thread pool executor worker run task thread pool executor java 886 na 32 java util concurrent thread pool executor worker run thread pool executor java 908 na 32 java lang thread run thread java 662 na 32 two datasources same name different web applications results javax management instance already exists exception
mapped name read when resource when web xml
use error handling when too many active sessions exception happens jsp
tomcat jdbc pool versions tested 27 28 more inquiry let me preface saying we have recently adopted pool very pleased so far currently jmx managed resources like connection pool slow query report jmx registered under same domain tomcat jdbc some users may want employ alternate object naming strategy data source create object name relatively easy change connection pool object name subclass however slow query report jmx due static get object name method requires overriding additional methods which less desirable appears connection pool has constant pool jmx type prefix slow query report jmx appears use data source does any reason slow query report jmx get object name method static what about registering object naming strategy pool various components would use facilitating consistency would mitigate need override just alter object name reference spring mbean exporters object naming strategy interface thanks support consistent jmx object naming strategy across managed resources
jvm crash startup tc native version too old
bean elresolver inner class bean property line 264 has two methods write read throw property found exception current wrong throw new property found exception message ctx property writable new object type get name descriptor get name should use owner get name instead type get name because assembled message property descriptor get name readable type type get name here descriptor get name means property name type get name means property type name owner get name means property owner bean type name course we developer would prefer receive message tells us which bean type doesn contain property because property found exception bean elresolver inner class bean property throws incorrect message while property found
hi scenario following have running tomcat 28 deploy application root context deployment hangs forever when taking tread dump following suspicious localhost start stop daemon prio tid nid 0x2560 waiting condition java lang thread state waiting parking sun misc unsafe park native method parking wait java util concurrent locks reentrant read write lock nonfair sync java util concurrent locks lock support park lock support java 158 java util concurrent locks abstract queued synchronizer park check interrupt abstract queued synchronizer java 811 java util concurrent locks abstract queued synchronizer acquire queued abstract queued synchronizer java 842 java util concurrent locks abstract queued synchronizer acquire abstract queued synchronizer java 1178 java util concurrent locks reentrant read write lock write lock lock reentrant read write lock java 807 org apache catalina core container base remove container listener container base java 1071 org apache catalina core standard engine access log listener uninstall standard engine java 463 org apache catalina core standard engine access log listener container event standard engine java 505 org apache catalina core container base fire container event container base java 1431 org apache catalina core container base add child internal container base java 907 org apache catalina core container base add child container base java 875 org apache catalina core standard host add child standard host java 618 org apache catalina startup host config deploy directory host config java 1100 org apache catalina startup host config deploy directory run host config java 1618 java util concurrent executors runnable adapter call executors java 441 java util concurrent future task sync inner run future task java 303 java util concurrent future task run future task java 138 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 662 you can see read lock acquired org apache catalina core container base fire container event container base java 1425 every listener invoked process container event access log listener invoked org apache catalina core standard engine access log listener uninstall standard engine java 463 latter causes call write lock org apache catalina core container base remove container listener container base java 1071 reentrant read write lock stated upgrade from read write lock possible reentrancy also allows downgrading from write lock read lock acquiring write lock read lock releasing write lock however upgrading from read lock write lock possible regards violeta georgieva deployment application root context hangs forever
found against trunk jun 18 2012 severe java lang stack overflow error org apache catalina core standard context valve event standard context valve java 128 org apache catalina valves valve base event valve base java 204 org apache catalina core standard host valve event standard host valve java 223 org apache catalina valves valve base event valve base java 204 org apache catalina valves valve base event valve base java 204 org apache catalina core standard engine valve event standard engine valve java 110 org apache catalina connector coyote adapter event coyote adapter java 209 org apache coyote http11 http11nio processor event http11nio processor java 124 org apache coyote abstract protocol abstract connection handler process abstract protocol java 569 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1653 org apache tomcat util net nio endpoint process socket nio endpoint java 730 org apache tomcat util net nio endpoint poller add nio endpoint java 1008 org apache tomcat util net nio endpoint poller add nio endpoint java 999 org apache coyote http11 http11nio protocol handler long poll http11nio protocol java 277 org apache coyote abstract protocol abstract connection handler process abstract protocol java 596 org apache coyote http11 http11nio protocol handler process http11nio protocol java 223 stack overflow connector
allowing broken android http digest support
when using servlet container initializer handles types annotation any classes specified handles types annotation available due missing jar file catalina crash java lang array store exception sun reflect annotation type present exception proxy caused java lang array store exception sun reflect annotation type present exception proxy sun reflect annotation annotation parser parse class array annotation parser java 653 sun reflect annotation annotation parser parse array annotation parser java 460 sun reflect annotation annotation parser parse member value annotation parser java 286 sun reflect annotation annotation parser parse annotation annotation parser java 222 sun reflect annotation annotation parser parse annotations2 annotation parser java 69 sun reflect annotation annotation parser parse annotations annotation parser java 52 java lang class init annotations necessary class java 3070 java lang class get annotation class java 3029 org apache catalina startup context config process servlet container initializers context config java 1546 org apache catalina startup context config web config context config java 1222 org apache catalina startup context config configure start context config java 855 org apache catalina startup context config lifecycle event context config java 345 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 90 org apache catalina core standard context start internal standard context java 5161 org apache catalina util lifecycle base start lifecycle base java 150 more line where exception thrown handles types ht sci get class get annotation handles types class servlet container initializer crash catalina dependcy present
incorrect tag xml response when calling manager status xml true
add thread factory executor service used deploy applications
data source factory does support commit return property data source factory all properties data source factory parse pool properties omit commit return property data source factory does support commit return property
allow whitespace around delimiters context aliases readability
during con connect call method protected pooled connection borrow connection long now pooled connection con string username string password connection pool java counting down size pool means connection failure happens here pool size remains same means size show pool full reality pool empty database failure may cause pool hang
ant jasper task fails run when using xml namespaces output errors
allow custom error mapping when manager max active sessions exceeded
possible specify invocation order web filter users forced explicitly specify filter mapping web xml works combination web filter filter name glassfish jboss follows web filter filter name filter1 public class filter1 implements filter web filter filter name filter2 public class filter2 implements filter filter mapping filter name filter1 filter name url pattern url1 url pattern filter mapping filter mapping filter name filter2 filter name url pattern url2 url pattern filter mapping however fails tomcat 27 following confusing exception url pattern been set caused java lang illegal argument exception filter mapping must specify either url pattern servlet name org apache catalina core standard context validate filter map standard context java 3009 org apache catalina core standard context add filter map standard context java 2968 org apache catalina deploy web xml configure context web xml java 1207 org apache catalina startup context config web config context config java 1294 org apache catalina startup context config configure start context config java 855 org apache catalina startup context config lifecycle event context config java 345 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 90 org apache catalina core standard context start internal standard context java 5161 org apache catalina util lifecycle base start lifecycle base java 150 more filter mapping doesn find web filter filter name
trying do jndi lookup inside open method my stream inbound class gives me exception below code works move my jnp jars server lib instead webapp lib code also works fine from anywhere else like do get method error http bio 8080 exec test javax naming initial context exception cannot instantiate class org jnp interfaces naming context factory root exception java lang class found exception org jnp interfaces naming context factory javax naming spi naming manager get initial context naming manager java 657 javax naming initial context get default init ctx initial context java 288 javax naming initial context init initial context java 223 javax naming initial context init initial context java 197 test test stream inbound open test java 103 org apache catalina websocket stream inbound upgrade complete stream inbound java 180 org apache coyote abstract protocol abstract connection handler process abstract protocol java 579 org apache tomcat util net jio endpoint socket processor run jio endpoint java 307 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 662 class found exception when using web socket servlet
new test case basic
illegal state exception when trying render jsp after start async
when using embedded tomcat servlet init method called twice container has been seen apache direct memory unit test have checked normal tomcat launched tomcat maven plugin mvn tomcat7 run case init method correctly called once servlet init method called twice embedded tomcat
web app fails when security role ref does contain role link
when context stop throw lifecycle exception main thread stops start stop threads host engine remain while because start stop threads demon thread result even main thread stops acceptor threads 8080 8009 stopped keep alive time 10 seconds set up now start stop executor new thread pool executor get start stop threads internal get start stop threads internal 10 time unit seconds start stop queue therefore order avoid bind exception waiting 10 seconds required think need make start stop threads demon thread best regards starting immediately after tomcat stop fail bind exception throw
illegal state exception zip file closed resource from webfragment jar jre memory leak prevention listener removed
patch don do chunking connection close
odd when inferring java bean property from setter name injection target
default instance manager populate annotations cache incomplete check used when validating setter method
webapp class loader causes java lang out memory error find resource internal
servlet superclass injection targets ignored
default connect timeout value set 20000 cause issue web socket connection java net socket timeout exception read timed out java net socket input stream socket read0 native method java net socket input stream read socket input stream java 129 org apache coyote http11 upgrade upgrade bio processor read upgrade bio processor java 75 org apache catalina websocket ws frame next frame ws frame java 213 org apache catalina websocket ws input stream next frame ws input stream java 68 org apache catalina websocket stream inbound data stream inbound java 143 org apache coyote http11 upgrade upgrade processor upgrade dispatch upgrade processor java 83 org apache coyote abstract protocol abstract connection handler process abstract protocol java 563 org apache tomcat util net jio endpoint socket processor run jio endpoint java 307 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 680 increasing value delay issue timeout should occurs websocket java net socket timeout exception read timed caused server xml connect timeout
common function connection pool support purging pool all current connections getting all fresh connections oracle ucp websphere pools two examples would great pool supported operation well would useful operation were exposed through jmx too support purging connection pool
web socket issue wrapped requests
regarding connector max connections property
backup manager does replicate session access time
when tcnative starts emits information like catalina out pr 10 2012 54 55 pm org apache catalina core apr lifecycle listener init info loaded apr based apache tomcat native library 23 apr 10 2012 54 55 pm org apache catalina core apr lifecycle listener init info apr capabilities ipv6 true sendfile true accept filters false random true would nice apr version use could also displayed well tcnative version maybe open ssl version too add apr version number tcnative version info log message
reconfigure pool fly using jmx
performance issue expression factory new instance
behaviour resource bundle elresolver
name found exception thrown when field method annotated resource annotation
upgrading maven plugin 26 goal which runs tomcat conf dir embed version generate following npe log org apache catalina util lifecycle base stop lifecycle base java 236 org apache catalina util lifecycle base start lifecycle base java 141 org apache catalina startup catalina start catalina java 645 org apache tomcat maven plugin tomcat7 run abstract run mojo start container abstract run mojo java 679 org apache tomcat maven plugin tomcat7 run abstract run mojo execute abstract run mojo java 365 org apache maven plugin default build plugin manager execute mojo default build plugin manager java 101 org apache maven lifecycle internal mojo executor execute mojo executor java 209 org apache maven lifecycle internal mojo executor execute mojo executor java 153 org apache maven lifecycle internal mojo executor execute mojo executor java 145 org apache maven lifecycle internal lifecycle module builder build project lifecycle module builder java 84 org apache maven lifecycle internal lifecycle module builder build project lifecycle module builder java 59 org apache maven lifecycle internal lifecycle starter single threaded build lifecycle starter java 183 org apache maven lifecycle internal lifecycle starter execute lifecycle starter java 161 org apache maven default maven do execute default maven java 320 org apache maven default maven execute default maven java 156 org apache maven cli maven cli execute maven cli java 544 org apache maven cli maven cli do main maven cli java 197 org apache maven cli maven cli main maven cli java 141 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org codehaus plexus classworlds launcher launcher launch enhanced launcher java 290 org codehaus plexus classworlds launcher launcher launch launcher java 230 org codehaus plexus classworlds launcher launcher main exit code launcher java 409 org codehaus plexus classworlds launcher launcher main launcher java 352 npe 26
code snippet starting line 15 connection pool java version 22 try retrieve existing connection con idle poll timetowait time unit milliseconds catch interrupted exception ex thread interrupted clear flag bail out sqlexception sx new sqlexception pool wait interrupted sx init cause ex throw sx finally waitcount decrement get line marked clear flag bail out wrong because after way calling code find out thread has been interrupted correct behavior should thread current thread interrupt here excerpt from biran goetz java concurrency practice chapter start quotation library code basically two choices propagate interrupted exception often most sensible policy you can get away just propagate interrupted exception your caller could involve catching interrupted exception catching throwing again after performing some brief activity specific cleanup restore interrupt sometimes you cannot throw interrupted exception instance when your code part runnable situations you must catch interrupted exception restore interrupted status calling interrupt current thread so code higher up call stack can see interrupt issued end quotation case borrow connection really choice running confines jdbc interface can definitely restore interrupt status thread connection pool borrow connection swallows interrupt state
class cast exception while removing valve
new unit test digest single sign
code pooled connection java validate int validate action string sql statement stmt null try stmt connection create statement stmt execute query stmt close last validated now return true catch exception ignore log debug enabled log debug unable validate object ignore stmt null try stmt close catch exception ignore2 noop return false so case null invalid query connection always invalidated seems normal without any usefull message except you use debug seems complicated production env so imho adding log warning case null query could usefull case invalid empty slq query connection always invalidated without usefull information
currently error getting connection from pool generic sqlexception thrown only way determine problem result connection pool being exhausted catch sqlexception parse message look pool empty ex get message would like see following subclass sqlexception thrown case empty pool jmx notification sent case empty pool pool exhausted jmx notification exception empty exhausted connection pool
slow query report interceptor does log anything
we have sporadic issues triggering 502 proxy errors using nio connector behind nginx caused dropped connections end streams tomcat tomcat log shows severe error allocating socket processor java lang null pointer exception org apache tomcat util net nio endpoint process socket nio endpoint java 721 org apache tomcat util net nio endpoint poller cancelled key nio endpoint java 1048 org apache tomcat util net nio endpoint poller timeout nio endpoint java 1392 org apache tomcat util net nio endpoint poller run nio endpoint java 1174 java lang thread run thread java 662 looking code process socket see line nio endpoint 721 attachment set comet notify false get reset upon next reg attachment fetched line 720 key attachment attachment key attachment socket get attachment false looking socket get attachement method see method indeed capable returning null null check done although multiple other locations so seems inconsistent npe process socket
incomplete fix resource leak bugs standard manager java
problem description tomcat memory leak detection has following issues most detection fixing code has been tested only sun jvms lot reflection based code does work ibm jdk tests tomcat7 source test org apache catalina loader do seem run successfully incomplete all protection tomcat provides classloader memory leaks some categories threadlocal memory leaks key value displayed correctly warning messages particularly ones dealing indirect references threadlocals org apache catalina loader webapp class loader loaded child object incorrectly traverses object classloader hierarchy instead current classloader hierarchy problem conclusion after extensive testing ibm jdks have cleaned up sanitized some reflection code stop executors timers threads etc ibm jdk added new tests detecting threadlocal leaks thread leaks better thread local leak reporting corrected loaded child method addition expunge stale entries method make code more resilient certain leak detection scenarios various fixes tomcat memory leak detection code
developer captures jsp fragment themselves calls invoke jsp context class attribute enclosing page context elcontext set generated jsp fragment subclass reset its original value afterwards therefore after invoking jsp context any el expressions searching wrong jsp context attribute values org apache jasper compiler generator responsible creating jsp fragment subclass represent compiled fragment generate postamble method emits generated code set jsp context attribute elcontext out printil jsp context get elcontext put context javax servlet jsp jsp context class jsp context however doesn later put back original value you using jsp invoke tag invoke fragment which undoubtedly what most people doing code generated visit node invoke action generator explicitly restores el context out printil jsp context get elcontext put context javax servlet jsp jsp context class get jsp context however you call invoke writer jsp fragment yourself you don get tidy up code suggest resolution have jsp fragment invoke method tidy up after itself puts change jsp context class attribute so should also re put shouldn any need restore el context generated jsp invoke code have tested solution successfully generator jsp fragment invoke does reset elcontext jsp context class
improve client certificate
incomplete fix resource leak bug webapp class loader java
incomplete error message when lookup resource bound naming
org apache jasper jsp execute method uri root null scans all jsp files under uri root checks uri root directory should more desirable check uri root directory first scanning here my suggestion uri root null throw new jasper exception localizer get message jsp error jspc uriroot file uri root new file uri root uri root exists uri root directory throw new jasper exception localizer get message jsp error jspc uriroot dir context null init servlet context explicit pages we ll process all jsp webapp pages size scan files uri root jsp checking uri root option validness
ken cheung computer science phil student observed some code clones tomcat found inconsistent code tomcat trunk java org apache tomcat util net nio blocking selector java 103 try 104 att get write latch null att get write latch get count att start write latch 105 poller add att selection key op write reference 106 att await write latch write timeout time unit milliseconds 107 catch interrupted exception ignore 108 thread interrupted 109 110 att get write latch null att get write latch get count 111 we got interrupted we haven received notification from poller 112 keycount 113 else 114 latch countdown has happened 115 keycount 116 att reset write latch 117 118 119 write timeout keycount 120 timedout system current time millis time write timeout tomcat trunk java org apache tomcat util net nio blocking selector java 164 try 165 att get read latch null att get read latch get count att start read latch 166 poller add att selection key op read reference 167 read timeout 168 att await read latch long max value time unit milliseconds 169 else 170 att await read latch read timeout time unit milliseconds 171 172 catch interrupted exception ignore 173 thread interrupted 174 175 att get read latch null att get read latch get count 176 we got interrupted we haven received notification from poller 177 keycount 178 else 179 latch countdown has happened 180 keycount 181 att reset read latch 182 183 read timeout keycount 184 timedout system current time millis time read timeout quick description two code snippets very similar code you see first code does check read timeout while second code has checker we thought could potential bug hope helps potential bug nio blocking selector java
ken cheung computer science phil student observed some code clones tomcat found inconsistent code tomcat trunk java org apache catalina realm jdbcrealm java 676 driver null 677 try 678 class clazz class name driver name 679 driver driver clazz new instance 680 catch throwable 681 exception utils handle throwable 682 throw new sqlexception get message 683 684 685 686 open new connection 687 properties props new properties 688 connection name null 689 props put user connection name 690 connection password null 691 props put password connection password 692 db connection driver connect connection url props tomcat trunk java org apache catalina valves jdbcaccess log valve java 566 driver null 567 try 568 class clazz class name driver name 569 driver driver clazz new instance 570 catch throwable 571 exception utils handle throwable 572 throw new sqlexception get message 573 574 575 576 open new connection 577 properties props new properties 578 props put auto reconnect true 579 connection name null 580 props put user connection name 581 582 connection password null 583 props put password connection password 584 585 conn driver connect connection url props quick description two code snippets very similar code you see jdbcrealm java does use props put auto reconnect true while jdbcaccess log valve java has we thought could potential bug hope helps potential bug jdbcrealm java jdbcaccess log valve java
imho http servlet request login does need define login config non login used when login config specified http servlet request login when user database realm used generic principal memory user set session base invoke principal registered session set request because memory user set request principal realm base has role always returns false result 403 error returned programmatic login using user database realm returns 403 error
incomplete fix resource leak bug expression factory java
incomplete fix resource leak bug jdtcompiler java
incomplete fix resource leak bug comet connection manager valve java
incomplete fix resource leak bug host config java
incomplete fix resource leak bug memory user database java
class org apache jasper compiler jsp util its method public static string get tag handler class name string path string urn error dispatcher err throws jasper exception uses string constants directly like org apache jsp tag web org apache jsp tag meta you know tag file package name field class org apache jasper constants code should adjusted like below constants tag file package name web constants tag file package name meta org apache jasper compiler jsp util get tag handler class name does use org apache jasper constants tag file package name
incomplete fix resource leak bugs catalina java
would very useful have pool properties class implement java lang cloneable interface we have many databases share same schema username password etc differ only url implementing routing datasource based something like org jdbc datasource abstract data source can just clone pool properties object set one two properties differ clone spring project properties common across all datasources only supplied once make pool properties implement cloneable
mime type javascript incorrect
jasper illegally implements org eclipse jdt internal compiler env icompilation unit from eclipse
nio connector exception invoking method read buf size write buf size jmx proxy servlet
annotation processing web inf classes servlets listeners filters skipped when web app extracted classes do have packages some embedded scenarios
el should coerce string integer equals operation
well defined how dependencies extensions mechanism can used tomcat
form post replay broken ajp
basic data source configured using resource simply list available mbeans exception emitted stdout severe error getting attribute catalina type data source context context host localhost class javax sql data source name jdbc my data source login timeout javax management runtime operations exception exception invoking method login timeout org apache tomcat util modeler base model mbean get attribute base model mbean java 197 com sun jmx interceptor default mbean server interceptor get attribute default mbean server interceptor java 666 com sun jmx mbeanserver jmx mbean server get attribute jmx mbean server java 638 org apache catalina mbeans mbean dumper dump beans mbean dumper java 81 org apache catalina manager jmxproxy servlet list beans jmxproxy servlet java 166 org apache catalina manager jmxproxy servlet do get jmxproxy servlet java 121 javax servlet http http servlet service http servlet java 621 caused java lang unsupported operation exception supported basic data source org apache tomcat dbcp dbcp basic data source get login timeout basic data source java 1083 sun reflect native method accessor impl invoke0 native method exception does cause request fail definitely puts ugly stack trace catalina out might better catch unsupported operation exception emit one line error message one isn severe unsupported operation exception logged when fetching basic data source login timeout
per servlet spec values javax servlet forward request uri javax servlet forward context javax servlet forward servlet path javax servlet forward path info javax servlet forward query string must set values from very first servlet serviced current request however seems tomcat populating path info value last path info serviced request final servlet serviced request possible other value assignments afflicted similar defects ve explicitly tested because issue impossible correctly reconstruct original request uri piecemeal context servlet path path info query string since path info contain path another servlet thus produce probably invalid uri target therefore creating click here retry links impossible without workaround code critical issue here deviation from servlet spec which spells out behavior those attributes when requests forwarded request attribute javax servlet forward path info assigned incorrect value
due changes 1229726 1229727 1229728 output written response filter can truncated up 8192 bytes consider following scenario you have filter invoke get writer before chain do filter request response wrapper response wrapper overrides get writer method returns some buffered writer real one during execution chain do filter forward before forward application dispather calls reset buffer response which turn calls reset output buffer which sets got enc field false field initialized set converter method which called from response get writer since our wrapper response overrides get writer output buffer set converter never called output buffer still has got enc false response close flush buffer methods call output buffer flush since got enc false conv flush buffer called got enc conv null conv flush buffer workaround us implement get writer method response wrapper like public writer get writer writer original writer original response get writer save future processing return our writer maybe you should change flushing something like conv null conv flush buffer because you invoke conv convert without any checks write methods seems like conv never null response output written filter can truncated
when realm available authenticate against npe thrown str start stock 25 modify server xml comment out resource global naming resources comment out realm engine deploy manager app try log java lang null pointer exception org apache catalina realm realm base authenticate realm base java 340 org apache catalina basic authenticate basic java 158 org apache catalina base invoke base java 544 org apache catalina valves error report valve invoke error report valve java 98 org apache catalina connector coyote adapter service coyote adapter java 407 org apache coyote http11 abstract process abstract java 987 org apache coyote abstract protocol abstract connection handler process abstract protocol java 579 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1600 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 680 clearly pathological setup might nice get decent error message instead npe npe when realm resource defined
see 52326 background noting particularly following long sci processing involves expensive classloading larger applications suffer from long startup times thus encouraged shut off via metadata complete true issue intended address classloading based approach handles types processing replacing something faster generally less problematic asm would one way get done classloading based servlet container initializer handles types processing can result long startup times
incorrect byeswritten log after completed async request under http1
severe error finishing response java lang array index out bounds exception java lang system arraycopy native method org apache coyote http11 abstract output buffer write abstract output buffer java 495 org apache coyote http11 abstract output buffer send status abstract output buffer java 337 org apache coyote http11 abstract prepare response abstract java 1418 org apache coyote http11 abstract action abstract java 756 org apache coyote response action response java 168 org apache coyote http11 abstract output buffer end request abstract output buffer java 310 org apache coyote http11 internal output buffer end request internal output buffer java 158 org apache coyote http11 abstract end request abstract java 1586 org apache coyote http11 abstract process abstract java 1022 org apache coyote abstract protocol abstract connection handler process abstract protocol java 579 org apache tomcat util net jio endpoint socket processor run jio endpoint java 307 java util concurrent thread pool executor run worker thread pool executor java 1110 java util concurrent thread pool executor worker run thread pool executor java 603 java lang thread run thread java 722 big application dont know why its happens may due fact twice add some cookie exception
exception logged annotation scanning web apps without web inf classes
do load listeners declared blank spaces tld file
seem rather lot instances where strings bytes cconverted using default charset since default charset unknown its behaviour cannot relied string get bytes new string byte use default charset may cause problems some locales
tc7 ant compiler problems whitespace pathname
currently one can only query beans set get attributes them would good certain operation mbean could called jmxproxy servlet extend jmxproxy allow call mbean operations
java lang illegal argument exception uri scheme file thrown context config get default web xml fragment
arguments fails nested properties
tomcat default realm shares realm instance between web applications resulting info log message from lifecycle
el api currently detected code webapp class loader applications containing el api jar start patch follow add detection el jar webapp class loader
value expression method get value reference should return base object property returns null value expression facelets parameter example some var concrete object property value expression some var return null from method get value reference guess because simple expression some var logicaly should return parent expressions value reference need hierachical value reference lookup made workaround java reflect api my code illustrates problem elcontext el context faces context get current instance get elcontext value reference reference exp get value reference el context reference null exp instanceof tag value expression uel value expression impl orig exp value expression impl tag value expression uel exp get wrapped todo jr find better way get base property code portable because uses tomcat el details field field reflection utils find field orig exp get class el impl var property field set accessible true variable mapper var mapper variable mapper reflection utils get field field orig exp field reflection utils find field orig exp get class el impl node property field set accessible true simple node node simple node reflection utils get field field orig exp var mapper null node null value expression parent exp var mapper resolve variable node get image parent exp null try reference parent exp get value reference el context reference null reference get value reference parent exp catch property found exception log warn property found get message wrong get value reference behaviour facelets parameter expressions
our application we used use tomcat writing our content directly response writer our servlet writer response get writer append we have regularly measured performance our application under stress multiple simultaneous requests per second we recently upgraded tomcat immediately observed performance degradation 10 request roundtrip same machine same tests compared our application deployed tomcat profiling jprofiler showed we got massive amount transient objects java nio heap char buffer produced 400mb within few minutes way we writing response multiple statements append small strings single chars which used work properly experiment we wrapped response writer buffered writer buffer 64k brought our application performance back normal we see either anti pattern usage since tomcat which case please provide some about bug c2bconverter applied per every call coyote writer write methods which generates garbage buffers per every call we know response stream has 8k buffer default nevertheless buffer comes after encoding step too late help garbage perhaps tomcat can buffer before encodes still so much transient objects just pattern eligible use servlet api seems bug me massive garbage production observed when using response writer
org catalina tomcat startup tomcat silence method doesn use host where we add applications
lower log level failed class loading
access log does log size files sent sendfile
non login does honour session timeout single sign valve
url parameter without value should parsed successfully when logging level debug
prevent potential data races org apache catalina tribes transport bio util fast queue size
protect concurrent accesses field org apache catalina tribes transport bio util fast queue remove
field org apache catalina tribes transport bio util fast queue enabled should volatile
anti resource locking unpack wars
coda prelude order respected
null pointer exception tribes transport nio nio receiver listen test run
embeded tomcat using connector random port port
adding alias existing host running tomcat causes class cast exception
add drop additional doc delegate setting webapp class loader
allow explicit use fips mode apr lifecycle listener
servlet context get resource path doesn accept anymore
hello using tomcat jmx interface deploy apps follows call mbean factory create standard context where mbean factory catalina type mbean factory parameters parent catalina type host host localhost path w1 doc base my path app call my app start where my app catalina j2ee type web module name localhost w1 none j2eeserver none result my app succesfully deployed its context available nevertheless see following exceptions server console full stacktraces skipped attached next comment 31 2011 14 05 53 org apache catalina startup context config process context config severe missing context xml file my tomcat base folder conf catalina localhost w1 xml java io file found exception my tomcat base folder conf catalina localhost w1 xml 31 2011 14 05 53 org apache catalina startup context config process context config severe parse error context xml w1 java io file found exception my tomcat base folder conf catalina localhost w1 xml 31 2011 14 05 53 org apache catalina startup context config configure start severe marking application unavailable due previous error 31 2011 14 05 53 org apache catalina core standard context start internal severe error get configured 31 2011 14 05 53 org apache catalina core standard context start internal severe context w1 startup failed due previous errors exceptions looks strange me since don understand why tomcat searches context xml file during jmx deploy do do something wrong deployment workflow regards michael tomcat reports missing context xml wrong location jmx deployment
null pointer exception when jasper tries compile directory
npe exception org apache catalina connector coyote adapter service
send redirect does support protocol relative urls
illegal state exception using compression filter tomcat 21 22
public void do filter event comet event event comet filter chain chain throws ioexception servlet exception process comet event event get http servlet request get remote host event chain use get remote host should get remote addr remote addr filter uses remote host address do filter event
example webapps examples web inf classes async async0 java log file logs localhost 2011 08 07 log java lang illegal state exception calling async complete valid request async state dispatched org apache coyote async state machine async complete async state machine java 221 org apache coyote http11 action internal java 525 org apache coyote http11 abstract action abstract java 773 org apache coyote request action request java 344 org apache catalina core async context impl complete async context impl java 89 async async0 service async0 java 42 javax servlet http http servlet service http servlet java 722 org apache catalina core application filter chain internal do filter application filter chain java 304 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina core application dispatcher invoke application dispatcher java 684 org apache catalina core application dispatcher do include application dispatcher java 593 org apache catalina core application dispatcher include application dispatcher java 530 org apache catalina core async context impl run async context impl java 173 org apache catalina core async context impl do internal dispatch async context impl java 314 org apache catalina core standard wrapper valve invoke standard wrapper valve java 219 org apache catalina core standard context valve invoke standard context valve java 175 org apache catalina base invoke base java 462 org apache catalina core standard host valve invoke standard host valve java 164 org apache catalina valves error report valve invoke error report valve java 100 org apache catalina valves access log valve invoke access log valve java 851 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter async dispatch coyote adapter java 296 org apache coyote http11 abstract async dispatch abstract java 1220 org apache coyote abstract protocol abstract connection handler process abstract protocol java 511 org apache tomcat util net jio endpoint socket processor run jio endpoint java 302 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 619 java lang illegal state exception calling async complete
npe comet processing when shutting down tomcat
infinite loop when shutting down apr endpoint
request get remote addr sometimes returning ip address from previous request we have compared ip address returned from get remote host from headers get remote addr get remote addr returning wrong ip address we believe may come from pooled request objects where sometimes sees previous value remote ip problem doesn occur all time we heavily relying get remote addr verify remote client some our can fixed 2011 09 22 16 49 55 713 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve invoked 2011 09 22 16 49 55 826 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve request get info org apache coyote catalina coyote request 2011 09 22 16 49 56 013 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve request get remote addr 98 138 85 230 2011 09 22 16 49 56 014 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve request get remote host web120016 mail ne1 yahoo com nslookup web120016 mail ne1 yahoo com server 10 72 226 address 10 72 226 53 name web120016 mail ne1 yahoo com address 98 138 85 143 2011 09 22 16 49 56 014 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve request get requested session id null 2011 09 22 16 49 56 015 debug yjava tomcat valves yahoo connection valve threadid 1262 yahoo connection valve request get header accept host ls100 mail vip ne1 yahoo com 4080 content type application ypy yahoo app auth yahoo mail acl yca lsg prod 98 138 85 143 1319282225 content length 574 2011 09 22 16 49 56 015 debug yjava filter address remote iptranslator threadid 1262 got remote address 98 138 85 230 port 46663 request get remote addr sometimes returning ip address from previous request
speedup sessionid generation when running testsuite
http ssl nio won work
bean elresolver varargs handling broken multiple ways
severe error deploying war application expand war error
sun java2d disposer class when loaded starts endless daemon thread can inherit webapp class loader its context loader cause leak when webapp unloaded would useful jre memory leak prevention listener could load class prevent leak improve jre memory leak prevention listener against leak caused sun java2d disposer
ssl property name illegal
seeing occasional race condition happens between nio endpoint poller run http11nio protocol finishing event what happens race condition upon waking up selector can cause selection key marked interest ops read soon could race poller wakeup counter steps can occur which causes my selection key have its interest ops reset soon selector have wakeup called poller0 starts processing its run loop calls events poller0 checks wakeup counter get which evaluates false wakeup counter worker1 finishes event calls poller add event worker1 enqueues poller event reset interest ops worker1 calls wakeup counter increment get increment get wakeup counter fails check call selector wakeup poller0 calls wakeup counter set poller0 calls selector select selector timeout blocks either full time out until another unrelated selection key polled poller0 ultimately gets around calling events again which now resets interest ops selection key processed worker1 simple fix change code wakeup counter get we here means we have other stuff do do non blocking select key count selector select now else wakeup counter set key count selector select selector timeout wakeup counter get set we here means we have other stuff do do non blocking select key count selector select now else key count selector select selector timeout race condition nio endpoint poller causes socket read until selector timeout
ajp cping forward request packet forgery design decision security
landingpage xhtml jsf cdi nullpointer exception
regression cache control headers requests security constraints
default rpc timeout backup manager sets abstract replicated map 15000 msec configurable when receiving map message msg start after new member added publish entry info called all sessions where primary backup node included backup node set session when only one tomcat starts cluster publish entry info called all sessions result rpc message has possibility timeout when acquiring session from restarting tomcat warning unable retrieve remote object key xxx logged session cannot continued make rpc timeout configurable backup manager additionally rpc message timeouted abstract replicated map broadcast add warning message best regards make rpc timeout configurable backup manager
dubious use mkdirs return code juli file handler
when deploy webapp tomcat server use function tomcat add webapp looked code function makes following call ctx add lifecycle listener new default web xml listener when start tomcat default web xml listener activated always does following code so manager set my context gets overriden code public static void init webapp defaults context ctx sessions ctx set manager new standard manager ctx set session timeout 30 so when set standard manager gets overriden code workaround used unregister default web xml listener than add my own context xml specific settings like custom manager deactivating session persistance context war context tomcat add webapp war context path war location lifecycle listener lclisteners war context find lifecycle listeners lifecycle listener default web xmllistener null int lclisteners length lclisteners instanceof default web xml listener default web xmllistener lclisteners war context remove lifecycle listener default web xmllistener standard manager manager new standard manager manager set pathname null disable session persistance manager set pathname sessions ser war context set cookies true war context set cross context true war context set manager manager think its bug using tomcat add webapp method makes impossible set context xml specific settings because always get overriden default values tomcat start tomcat embedded using tomcat add webapp always overrides programmatic context settings default values context start tomcat server
under following npe thrown because set executor calls con get protocol handler get class when protocol handler null would nice report bad instead suffering npe server xml executor name tomcat thread pool name prefix catalina exec max threads 150 min spare threads connector port 12345 redirect port 443 protocol http secure true scheme https proxy port 80 uriencoding utf executor tomcat thread pool catalina out aug 23 2011 18 30 pm org apache catalina connector connector init severe protocol handler failed aug 23 2011 18 30 pm org apache tomcat util digester digester start element severe begin event threw exception java lang null pointer exception org apache catalina startup connector create rule set executor connector create rule java 69 org apache catalina startup connector create rule begin connector create rule java 63 org apache tomcat util digester digester start element digester java 1276 com sun org apache xerces internal parsers abstract saxparser start element abstract saxparser java 501 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 179 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1537 org apache catalina startup catalina load catalina java 555 org apache catalina startup catalina load catalina java 596 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap load bootstrap java 281 org apache catalina startup bootstrap main bootstrap java 449 aug 23 2011 18 30 pm org apache catalina startup catalina load warning catalina start using conf server xml error 104 66 null aug 23 2011 18 30 pm org apache catalina connector connector init severe protocol handler failed aug 23 2011 18 30 pm org apache tomcat util digester digester start element severe begin event threw exception java lang null pointer exception org apache catalina startup connector create rule set executor connector create rule java 69 org apache catalina startup connector create rule begin connector create rule java 63 org apache tomcat util digester digester start element digester java 1276 com sun org apache xerces internal parsers abstract saxparser start element abstract saxparser java 501 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 179 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1537 org apache catalina startup catalina load catalina java 555 org apache catalina startup catalina start catalina java 609 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 322 org apache catalina startup bootstrap main bootstrap java 450 aug 23 2011 18 31 pm org apache catalina startup catalina load warning catalina start using conf server xml error 104 66 null aug 23 2011 18 31 pm org apache catalina startup catalina start severe cannot start server server instance configured bad connector protocol causes null pointer exception when using executor
any webapp calls java awt toolkit get default toolkit launch new thread awt windows awt xawt etc which capture context class loader pinning webapp memory after undeploy redeploy simple addition jre memory leak prevention listener can alleviate condition jre memory leak prevention listener should protect against awt thread creation
separate keep alive connection timeout apr native connector
potential npe coyote adapter log
hard diagnose null pointer exception startup which can bettered appropriate error message info starting servlet engine apache tomcat 19 java lang null pointer exception org apache catalina startup host config filter app paths host config java 493 org apache catalina startup host config deploy apps host config java 466 org apache catalina startup host config start host config java 1322 org apache catalina startup host config lifecycle event host config java 311 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 ok what about protected string filter app paths string unfiltered app paths exception raised string app path unfiltered app paths which means unfiltered app paths passed null filter app paths does check shouldn assertion least problems comes from deploy apps protected void deploy apps file app base app base file config base config base string filtered app paths filter app paths app base list deploy xml descriptors from config base deploy descriptors config base config base list deploy wars loop additional descriptors found deploy wars app base filtered app paths deploy expanded folders deploy directories app base filtered app paths where app base list returns null must because app base does actually denote directory ha indeed server xml points nonexisting app base suggesting add check deploy apps protected void deploy apps file app base app base file config base config base app base exists app base list null throw new illegal argument exception app base app base does exist cannot listed string filtered app paths filter app paths app base list deploy xml descriptors from config base deploy descriptors config base config base list deploy wars loop additional descriptors found deploy wars app base filtered app paths deploy expanded folders deploy directories app base filtered app paths probably violates some i18n requirement though null pointer exception startup org apache catalina startup host config filter app paths due missing app base
possible nullpointer exception request util parse parameters
jasper output message compiling error using lf any os cannot correctly displayed windows notepad think line feed code along os would better though know other text editor solves jasper output message compiling error using lf any os
when try deploy context name xml get following exception severe unable process jndi url jndi localhost sample one web inf classes annotations java io file found exception jndi localhost sample one web inf classes org apache naming resources dir context list dir context ur lconnection java 452 org apache catalina startup context config process annotations jndi cont ext config java 1901 org apache catalina startup context config process annotations url conte xt config java 1828 org apache catalina startup context config web config context config jav 1295 org apache catalina startup context config configure start context confi java 896 org apache catalina startup context config lifecycle event context confi java 322 org apache catalina util lifecycle support fire lifecycle event lifecycl support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle ba se java 89 org apache catalina core standard context start internal standard contex java 5103 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina core container base add child internal container base java 812 org apache catalina core container base add child container base java 78 org apache catalina core standard host add child standard host java 607 org apache catalina startup host config deploy descriptor host config ja va 633 org apache catalina startup host config deploy descriptors host config ava 558 org apache catalina startup host config deploy apps host config java 468 org apache catalina startup host config check host config java 1363 org apache catalina startup host config lifecycle event host config java 294 org apache catalina util lifecycle support fire lifecycle event lifecycl support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle ba se java 89 org apache catalina core container base background process container bas java 1233 org apache catalina core container base container background processor rocess children container base java 1391 org apache catalina core container base container background processor rocess children container base java 1401 org apache catalina core container base container background processor un container base java 1380 java lang thread run thread java 619 would have expected application available uri bug seems list method dir context java method assumes context name does have any characters see developer note just before block have added else condition seems have solved problem me try string file get url get file form hostname contextpath file name contextpath empty otherwise form hostname file name strip off hostname contextpath int start context instanceof proxy dir context equals proxy dir context context get context path start file index else context instanceof proxy dir context start length proxy dir context context get host name length proxy dir context context get context path length seems like bug tomcat below code tomcat how can handle contextpath like sample one cannot start file index file index else start file index file index naming enumeration name class pair enumeration context list file substring start while enumeration has more elements name class pair ncp enumeration next element result add element ncp get name catch naming exception unable deploy applications name xml
clear references jdbc seems causing leaks com oracle ojdbc5 driver
org apache coyote http11 http11nio protocol handler code segment override public void release socket wrapper nio channel socket http11nio processor processor connections remove socket processor null processor recycle recycled processors offer processor should override public void release socket wrapper nio channel socket http11nio processor processor connections remove socket get socket processor null processor recycle recycled processors offer processor type connections concurrent hash map nio channel http11nio processor concurrent hash map socket wrapper nio channel http11nio processor http11nio processor correct release
nothing bad here my compiler lights up connection connection driver connect driver url properties clearly fixed line 267 org apache tomcat jdbc pool pooled connection double assignment typo
current trunk steps reproduce start tomcat go webapps examples web inf web xml uncomment filter mapping timing filter line 75 wait several seconds examples webapp reloaded fails start happens because typo filter name value should timing filter timing filter stack trace logs 04 08 2011 09 39 org apache catalina startup host config check resources warning error during context examples restart java lang illegal argument exception filter mapping specifies unknown filter name timing filter org apache catalina core standard context validate filter map standard context java 2950 org apache catalina core standard context add filter map standard context java 2915 org apache catalina deploy web xml configure context web xml java 1206 org apache catalina startup context config web config context config java 1343 org apache catalina startup context config configure start context config java 896 org apache catalina startup context config lifecycle event context config java 322 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 org apache catalina core standard context start internal standard context java 5103 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina startup host config check resources host config java 1279 org apache catalina startup host config check host config java 1360 org apache catalina startup host config lifecycle event host config java 294 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 org apache catalina core container base background process container base java 1240 org apache catalina core container base container background processor process children container base java 1398 org apache catalina core container base container background processor process children container base java 1408 org apache catalina core container base container background processor run container base java 1387 java lang thread run thread java 662 go web xml edit once again re comment mapping correct typo wait several seconds here issue expected examples webapp should reload successfully actual reload fails following printed logs 04 08 2011 09 59 org apache catalina startup host config check resources info reloading context examples 04 08 2011 09 59 org apache catalina util lifecycle base start info start method called component standard engine catalina standard host localhost standard context examples after start had already been called second call ignored stop tomcat here second issue expected successful shutdown actual 04 08 2011 14 10 org apache catalina startup catalina stop severe catalina stop org apache catalina lifecycle exception invalid lifecycle transition attempted before stop component standard engine catalina standard host localhost standard context examples state starting prep org apache catalina util lifecycle base invalid transition lifecycle base java 387 org apache catalina util lifecycle base stop lifecycle base java 212 org apache catalina core container base stop internal container base java 1072 org apache catalina util lifecycle base stop lifecycle base java 225 org apache catalina core container base stop internal container base java 1072 org apache catalina util lifecycle base stop lifecycle base java 225 org apache catalina core standard service stop internal standard service java 502 org apache catalina util lifecycle base stop lifecycle base java 225 org apache catalina core standard server stop internal standard server java 748 org apache catalina util lifecycle base stop lifecycle base java 225 org apache catalina startup catalina stop catalina java 694 org apache catalina startup catalina catalina shutdown hook run catalina java 847 exception shutdown happens only examples webapp correct when tomcat started broken afterwards already broken startup time nothing happens here third issue when above happens shutdown sequence apparently aborted abnormally expected info stopping protocol handler http bio 8080 etc messages actual messages after severe catalina stop one cited above context fails reload after error web xml corrected
check whether session loaded memory store base process expires calls find session id manager find session keys null loaded true however persistent manager find session id loads session from store when session memory because session loaded from store invalid session persistent manager logs errorlog calls session expire deletes session from store result find session id returns null loaded becomes false session expire called again session deleted from store manager persistent manager necessary call persistent manager base loaded id however avoid regression r1033024 other managers call find session id best regards persistent manager loads session from store calls session expire twice
adding some fields subclass org apache catalina valves access log valve create log elements closest extension point available rather than reimplement would preferable both create access log element methods were protected rather than private simple method matching char you want use falling back super create access log element change access modifiers access log valve make easier extend
ve recently upgraded tomcat used run metadata complete true my web xml servlet decided try some annotation features when turned off metadata complete got verify error trying load one my classes class meant only work tomcat so fact tomcat cannot load class expected what expected tomcat doesn just ignore error continue scanning annotations looking context config check handles types checks virtually every type loading failure except verify error perhaps verify error should added list java lang verify error class org lds stack tomcat decrypt decrypting standard context overrides final method start java lang class loader define class1 native method java lang class loader define class cond class loader java 631 java lang class loader define class class loader java 615 java security secure class loader define class secure class loader java 141 java net urlclass loader define class urlclass loader java 283 java net urlclass loader access 000 urlclass loader java 58 java net urlclass loader run urlclass loader java 197 java security access controller do privileged native method java net urlclass loader find class urlclass loader java 190 java lang class loader load class class loader java 306 java lang class loader load class class loader java 247 java lang class name0 native method java lang class name class java 247 org apache catalina loader webapp class loader load class webapp class loader java 1665 org apache catalina loader webapp class loader load class webapp class loader java 1523 org apache catalina startup context config check handles types context config java 2006 org apache catalina startup context config process annotations stream context config java 1969 org apache catalina startup context config process annotations jar context config java 1858 org apache catalina startup context config process annotations url context config java 1826 org apache catalina startup context config process annotations context config java 1812 org apache catalina startup context config web config context config java 1306 org apache catalina startup context config configure start context config java 896 org apache catalina startup context config lifecycle event context config java 322 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 org apache catalina core standard context start internal standard context java 5103 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina core container base add child internal container base java 812 org apache catalina core container base add child container base java 787 org apache catalina core standard host add child standard host java 607 org apache catalina startup host config deploy descriptor host config java 633 org apache catalina startup host config deploy descriptors host config java 558 org apache catalina startup host config deploy apps host config java 468 org apache catalina startup host config start host config java 1322 org apache catalina startup host config lifecycle event host config java 311 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 org apache catalina util lifecycle base set state internal lifecycle base java 379 org apache catalina util lifecycle base set state lifecycle base java 324 org apache catalina core container base start internal container base java 1041 org apache catalina core standard host start internal standard host java 774 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina core container base start internal container base java 1033 org apache catalina core standard engine start internal standard engine java 291 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina core standard service start internal standard service java 443 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina core standard server start internal standard server java 727 org apache catalina util lifecycle base start lifecycle base java 145 org apache catalina startup catalina start catalina java 621 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 322 org apache catalina startup bootstrap main bootstrap java 450 context config check handles types doesn check verify error when loading class
newline during http header field name obscures next value
make threadname available extended access log valve
invalid lifecycle transition before stop component state initialized mapper listener
after response committed following api throws illegal state exception message exception set http servlet response reset buffer http servlet response send error http servlet response send redirect http servlet response set buffer size understand bug application hoped message set like other exceptions when calling api relates buffer after response committed ise messages thrown
disable drop support sslv2
performance issue when retriving jar files during tld file parsing
lru cache org apache catalina filters csrf prevention filter lru cache use csrf prevention filter base linked hash map from linked hash map java doc note synchronized multiple threads access linked hash map concurrently least one threads modifies map structurally must synchronized externally lru cache does synchronize access map csrf prevention filter lru cache thread save
method org apache catalina startup web rule set add rule instances digester digester code digester add call method full prefix absolute ordering name others add absolute ordering others web common xsd xsd complex type name absolute ordering type xsd annotation xsd please see section details xsd xsd annotation xsd choice min occurs max occurs unbounded xsd element name name type javaee java identifier type min occurs max occurs unbounded xsd element name others type javaee ordering others type min occurs max occurs xsd choice xsd complex type absolute ordering name others should include name element
tomcat crashes tcnative dll frequently
18 packaged candidate release finally unreleased when stop tomcat service only war deployed service takes lot time stop finally killed system having look stderr log see paused right after folowing line info stopping protocol handler http apr went slow loop fill log lines 13 juil 2011 14 30 30 org apache tomcat util net apr endpoint stop internal attention acceptor thread http apr acceptor failed unlock forcing hard socket shutdown 13 juil 2011 14 30 31 org apache tomcat util net apr endpoint stop internal attention acceptor thread http apr acceptor failed unlock forcing hard socket shutdown 13 juil 2011 14 30 32 org apache tomcat util net apr endpoint stop internal attention acceptor thread http apr acceptor failed unlock forcing hard socket shutdown etc about 30 times before killed think issue 16 additional error checking required connector port attribute port
support all protocol combinations sslprotocol apr connector
access log valve which responsible handling access log uses file writer doesn support unicode guess writer like would solve case writer new print writer new output stream writer new file output stream pathname utf true tomcat access log doesn support unicode
npe standard context valve invoke when webapp redeployed while request still being processed
gzip interceptor decompress completly implemented
security config set package definition security property nullsun java
standard context method thread run used most probably mistake since few lines below thread join called wait completion thread so we could either remove join get rid thread using just runnable start thread usage method run instead start start thread
typos comments host manager servlet
tomcat ve noticed request url does require get forwarded login page request contains header our application expects requests processed servlet servlet parses header takes appropriate action possibly redirecting login page allowing request headers contain acceptible token has worked older versions tomcat relevant part our web xml looks like security constraint web resource collection web resource name open web resource name url pattern url pattern several other url patterns web resource collection user data constraint transport guarantee confidential transport guarantee user data constraint notice auth constraint element security constraint observed behavior org apache catalina base invoke here what saw constraints variable contains single constraint matches security constraint from our web xml above line 520 auth required set true because presence header authenticate call line 535 fails redirects login page requests open url include header do reach servlet
found following array index out bounds exception my logfile occurred directly after login my web app without any further user interaction reproducible all am sure whether jasper right component however class jjtelparser state jasper el jar environment tomcat 32 facelets 14 myfaces error rendering view facelets myview xhtml java lang array index out bounds exception java util array list remove array list java 390 org apache el parser jjtelparser state close node scope jjtelparser state java 108 org apache el parser elparser composite expression elparser java 74 org apache el lang expression builder create node internal expression builder java 115 org apache el lang expression builder build expression builder java 172 org apache el lang expression builder create value expression expression builder java 216 org apache el expression factory impl create value expression expression factory impl java 68 com sun facelets el eltext eltext variable apply eltext java 161 com sun facelets compiler attribute instruction apply attribute instruction java 60 com sun facelets compiler handler apply handler java 95 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jstl core handler apply handler java 54 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jsf component handler apply next handler component handler java 360 com sun facelets tag jsf component handler apply component handler java 190 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jsf component handler apply next handler component handler java 360 com sun facelets tag jsf component handler apply component handler java 190 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jsf component handler apply next handler component handler java 360 org apache myfaces custom aliasbean alias beans scope tag handler apply next handler alias beans scope tag handler java 52 com sun facelets tag jsf component handler apply component handler java 190 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag ui composition handler apply composition handler java 124 com sun facelets compiler namespace handler apply namespace handler java 49 com sun facelets compiler encoding handler apply encoding handler java 39 com sun facelets impl default facelet include default facelet java 248 com sun facelets impl default facelet include default facelet java 294 com sun facelets impl default facelet include default facelet java 273 com sun facelets impl default facelet context include facelet default facelet context java 140 com sun facelets tag ui include handler apply include handler java 66 com sun facelets tag ui define handler apply definition define handler java 64 com sun facelets tag ui composition handler apply composition handler java 136 com sun facelets impl default facelet context template manager apply default facelet context java 337 com sun facelets impl default facelet context include definition default facelet context java 307 com sun facelets tag ui insert handler apply insert handler java 68 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jsf component handler apply next handler component handler java 360 com sun facelets tag jsf component handler apply component handler java 190 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag jsf component handler apply next handler component handler java 360 com sun facelets tag jsf component handler apply component handler java 190 com sun facelets tag composite facelet handler apply composite facelet handler java 47 com sun facelets tag ui composition handler apply composition handler java 124 com sun facelets compiler namespace handler apply namespace handler java 49 com sun facelets compiler encoding handler apply encoding handler java 39 com sun facelets impl default facelet include default facelet java 248 com sun facelets impl default facelet include default facelet java 294 com sun facelets impl default facelet include default facelet java 273 com sun facelets impl default facelet context include facelet default facelet context java 140 com sun facelets tag ui composition handler apply composition handler java 116 com sun facelets compiler namespace handler apply namespace handler java 49 com sun facelets compiler encoding handler apply encoding handler java 39 com sun facelets impl default facelet apply default facelet java 95 com sun facelets facelet view handler build view facelet view handler java 596 com sun facelets facelet view handler render view facelet view handler java 651 org ajax4jsf application view handler wrapper render view view handler wrapper java 100 org ajax4jsf application ajax view handler render view ajax view handler java 176 org apache myfaces lifecycle render response executor execute render response executor java 41 org apache myfaces lifecycle lifecycle impl render lifecycle impl java 140 org apache myfaces custom ppr pprlifecycle wrapper render pprlifecycle wrapper java 84 javax faces webapp faces servlet service faces servlet java 187 com foo client web servlets faces servlet wrapper service faces servlet wrapper java 125 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 org ajax4jsf webapp base xmlfilter do xml filter base xmlfilter java 206 org ajax4jsf webapp base filter handle request base filter java 290 org ajax4jsf webapp base filter process uploads handle request base filter java 388 org ajax4jsf webapp base filter do filter base filter java 515 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 org apache myfaces webapp filter extensions filter do filter extensions filter java 392 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com foo client web filters login filter do filter login filter java 219 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com foo client web filters cache filter do filter cache filter java 110 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com foo client web filters encoding filter do filter encoding filter java 54 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com foo client web filters timer filter do filter timer filter java 80 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 233 org apache catalina core standard context valve invoke standard context valve java 191 org apache catalina base invoke base java 470 org apache catalina core standard host valve invoke standard host valve java 127 org apache catalina valves error report valve invoke error report valve java 102 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 298 org apache coyote http11 process java 859 org apache coyote http11 handler process java 588 org apache tomcat util net jio endpoint worker run jio endpoint java 489 java lang thread run thread java 662 array index out bounds exception from org apache el parser jjtelparser state
servlet request listener fails access request parameters when expect header sent
async thread calls async context get response after async timeout gets null reference following example leads npe servlet spec very clear behavior adopt after timeout don think null should returned maybe illegal state exception instead seems case complete called after timeout package test import java io ioexception import java io print writer import javax servlet async context import javax servlet async event import javax servlet async listener import javax servlet servlet exception import javax servlet servlet response import javax servlet annotation web servlet import javax servlet http http servlet import javax servlet http http servlet request import javax servlet http http servlet response servlet class my servlet web servlet value my servlet async supported true public class my servlet extends http servlet implements async listener private static final long serial version uid 1l protected void do get http servlet request request http servlet response response throws servlet exception ioexception final async context async context request start async request response async context add listener async context set timeout 10 1000 async context start new runnable override public void run system out println entering async thread try thread sleep 20 1000 system out println asyncthread about write response servlet response response2 async context get response print writer writer response2 get writer writer write hello world system out println asyncthread about complete async context complete catch exception print stack trace override public void complete async event evt throws ioexception system out println complete evt override public void error async event evt throws ioexception system out println error evt override public void start async async event evt throws ioexception system out println start async evt override public void timeout async event evt throws ioexception system out println timeout evt evt get async context get response get writer write timed out evt get async context complete calling async context get response returns null after async timeout
session type changes from backup primary
allow more flexibility adding webapps org apache catalina startup tomcat
formatter assigned org apache juli file handler logging properties fails load file handler starts without formatter fails npe later reproduce assign some bogus value 1catalina org apache juli file handler formatter when tomcat starts following printed console java util logging error manager java lang null pointer exception org apache juli file handler open writer file handler java 377 org apache juli file handler init file handler java 99 org apache juli file handler init file handler java 90 think we can more tolerant error fall back default formatter commit fix shortly avoid null pointer exception juli file handler formatter
java lang illegal argument exception session config element limited occurrence
embedding class cannot launch webapp jsp servlet
access log valve date time element can currently configured only which output date time common log format adding capability configure time format one could override least time formatter property class could go further allow overriding all day month year time formatter properties enhancement log currenlty provide ability log processing time millis via accurate log order which requests received cannot determined without capabilities logging format milliseconds using element enhancement allow time format access log valve
handling type correctly handled server startup leads incorrect classes set passed initializers
ssi regular expressions working
we have environment couple load balanced tomcats fronted httpd someone accesses manager application through load balancer know which load balanced tomcats end up situations others well would nice manager could tell hostname ip address machine running patch show hostname ip address manager webapp
occasionally we got errors like following 2011 05 30 03 40 17 697 error pool thread org apache catalina ha session delta manager manager localhost unable receive message through tcp channel java lang null pointer exception java io object output stream block data output stream get utflength object output stream java 2106 java io object output stream block data output stream write utf object output stream java 1977 java io object output stream write utf object output stream java 849 org apache catalina ha session delta request write external delta request java 267 org apache catalina ha session delta request serialize delta request java 287 org apache catalina ha session delta manager serialize delta request delta manager java 716 org apache catalina ha session delta manager request completed delta manager java 1224 org apache catalina ha session delta session expire delta session java 403 org apache catalina ha session delta manager handle session expired delta manager java 1546 org apache catalina ha session delta manager message received delta manager java 1452 org apache catalina ha session delta manager message data received delta manager java 1173 org apache catalina ha session cluster session listener message received cluster session listener java 92 org apache catalina ha tcp simple tcp cluster message received simple tcp cluster java 901 org apache catalina ha tcp simple tcp cluster message received simple tcp cluster java 882 org apache catalina tribes group group channel message received group channel java 269 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group interceptors tcp failure detector message received tcp failure detector java 110 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group channel coordinator message received channel coordinator java 241 org apache catalina tribes transport receiver base message data received receiver base java 225 org apache catalina tribes transport nio nio replication task drain channel nio replication task java 188 org apache catalina tribes transport nio nio replication task run nio replication task java 91 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 662 looks like tomcat affected npe comes from trying write null session id why does tomcat try send something from handling received session expired message npe delta request write external delta request java 267 when handling remote session expiration
web dav lock refresh request may cause null pointer exception because imho wrong check line 1332 webdav servlet java 1056763 2011 01 08 18 56 57z markt suggest line 1332 should renew null potential null pointer exception org apache catalina servlets webdav servlet line 1336
sure bug just my mis coding ve been using embedded component tomcat 29 integration testing something like server new embedded tomcat test 7890 jvm peer peer cache lifecycle listener p2p listener new peer peer cache lifecycle listener p2p listener set property mcast port 19991 server get embedded add lifecycle listener p2p listener session manager new delta session manager server get root context set manager session manager here embedded tomcat class simply wrapper embedded passing context port jvm route nothing special add listener which should programmatic equivalent having following server xml snippet server listener class name peer peer cache lifecycle listener server delta session manager performs custom session management thus extends manager base implements lifecycle session manager during start delta session manager initialize listener doing lifecycle fire lifecycle event start event null listener picks up event starts all works nicely under tomcat breaks under tomcat 12 my initial shows lifecycle event being fired reaching embedded component which where listener registered removing overridden lifecycle methods from embedded so lifecyle processing happens lifecycle base seems work triggered event reaches my listener org apache catalina startup embedded overrides lifecycle incorrectly
intermittent java lang illegal argument exception session config element limited occurrence
when output buffer do flush gets exception do flush gets stuck true
patch add version parameter ant task
startup time tomcat 14 10x higher than 12 few shared jars tomcat lib few webapps issue very simple reproduce simply add 10 empty directories tomcat webapps example metro webservices jars tomcat lib my machine startup time increase from secs default installation 35 secs when using tomcat 12 startup time about secs my machine test case startup time too high few jars lib few webapps
npe during form when form login config missed
max connections honors config when acceptor thread count
ant task find leaks patch add find leaks ant task
ssl seems failing when content type header set image svg xml ve only seen failure when ssl running solaris machine uname sun os hostname removed generic 108528 18 sun4u sparc sunw ultra 60 when attempted windows we were unable duplicate error reliably fails when attempted specific solaris machine get chance ll try create test case see can reproduce other solaris machines show stopper release being made today so pressed time basically what happens we re using jsp page create svg file because we have set content type header image svg xml when mime type set value page fails load internet explorer sp1 message connection failed something similar when attempt made opera opera responded crashing mozilla successfully downloaded file though however when resetting mime type page text plain all three browsers can access page without failure back revving tomcat version 29 we were able resolve issue access page all three browsers ll try create test case later today verify isn just our svg jsp failing any creates svg currently pressed time sorry ie plugins cannot access components through tomcat over ssl
performance data source proxy create pool should use more fine grained
otherwise may very hard find what wrong warn app base existing file directory
add system property makes possible jsp pages extends page directive take advantage tag pooling
some async examples work correctly
query stats has issues
svn trunk jdbc interceptor options taken account
app configured server xml like code host name www myapp pl app base usr lib tomcat webapps unpack wars false auto deploy false xml validation false xml namespace aware false context doc base var www myapp path cache max size 5120 cache ttl 60000 caching allowed true context context path manager privileged true doc base usr lib tomcat webapps manager context host code tomcat manager application list button expire sessions available only manager application button expire sessions path think bug htmlmanager servlet java part code context get path equals context get path writer print message format format manager app row button section args else context get available deployed writer print message format format started deployed apps row button section args else context get available deployed writer print message format format started nondeployed apps row button section args else context get available deployed writer print message format format stopped deployed apps row button section args else writer print message format format stopped nondeployed apps row button section args code expire sessions button visible context configured server xml
missing deprecated comments
spurious deprecated tags servlet context
serializable exception org apache catalina realm generic principal
reported fhanik dev list com sun security jgss krb5 accept configurable while has attribute login config name seems place code where omits entry renaming entry jaas conf setting login config name fail validate ticket problem code here gss context manager create context manager create credential null default lifetime new oid accept only should look like final gssmanager manager gssmanager get instance final privileged exception action action new privileged exception action public run throws gssexception return manager create credential null default lifetime new oid accept only gss context manager create context subject do lc get subject action best filip spnego login config name does work
also true tomcat jmx remote lifecycle listener does support jaas based when required only supports file based extras jmx remote lifecycle listener does support jaas based
first all know has been bug regarding similar problem before fixed currently bugs occurs even tomcat version 32 we have problem tomcat runnign parameter org apache jasper runtime body content impl limit buffer true after tomcat has just started everything fine after one two days lot array index out bounds exception occur random pages application tomcats started without parameter don seem have problem we weren able reproduce bug locally appears only our production system could concurrency problem only shows lot going platform can provide two small stackstraces can show classes where problem occurs caused java lang array index out bounds exception org apache jasper runtime body content impl write unknown source java io print writer write print writer java 382 org apache jasper runtime jsp writer impl flush buffer unknown source org apache jasper runtime page context impl release unknown source org apache jasper runtime jsp factory impl internal release page context unknown source org apache jasper runtime jsp factory impl release page context unknown source org apache jsp members lists short incoming short list jsp jsp service incoming short list jsp java 796 org apache jasper runtime http jsp base service unknown source javax servlet http http servlet service unknown source caused java lang array index out bounds exception java lang string get chars string java 854 org apache jasper runtime body content impl write unknown source org apache jasper runtime body content impl write unknown source org apache jasper runtime body content impl print unknown source org apache taglibs standard tag common fmt message support do end tag message support java 203 org apache jsp members profiles profile jsp jspx meth fmt 005fmessage 005f2 profile jsp java 4897 org apache jsp members profiles profile jsp jsp service profile jsp java 481 org apache jasper runtime http jsp base service unknown source javax servlet http http servlet service unknown source array index out bounds exception after setting org apache jasper runtime body content impl limit buffer true
org apache catalina startup tomcat creates contexts add them host directly would nice we could set name context before adding host including patch overloads methods add webapp add context take name parameter allow set context name through tomcat embeded class before adding host
npe apr endpoint java
hi am using jmeter test plan uses jdbc request prepared statement query type when running am getting following error jmeter log file 2010 10 28 11 30 31 info jmeter threads jmeter thread thread started jdbc users 2010 10 28 12 13 38 error jmeter threads jmeter thread error while processing sampler prepared select customer jdbc request java lang null pointer exception org apache jmeter protocol jdbc sampler jdbcsampler get string from result set jdbcsampler java 415 org apache jmeter protocol jdbc sampler jdbcsampler result sets string jdbcsampler java 268 org apache jmeter protocol jdbc sampler jdbcsampler sample jdbcsampler java 208 org apache jmeter threads jmeter thread process sampler jmeter thread java 348 org apache jmeter threads jmeter thread run jmeter thread java 243 java lang thread run thread java 619 query below can expected return number records select from customer where id param set use instead select statement results returned so query itself fault have retrieved code v2 tag identify root cause npe create patch bug report includes patch against trunk issue also trunk root cause due org apache jmeter protocol jdbc sampler jdbcsampler sample entry code path prepared statements types starting line 204 has call org hsqldb jdbc jdbcprepared statement execute update which returns result set side effect call set jdbcprepared statement current result set field member null jdbcsampler does keep result set reference instead discarded call next line 208 string sb result sets string pstmt true null again tries get result set line 267 causes null pointer exception because jdbcprepared statement current result set field set null earlier looking code path callable statement type line 190 shows better handling queries return result set two lines 207 208 replaced boolean has result set pstmt execute string sb result sets string pstmt has result set null fixes defect regards jeremy whiting red hat jdbcsampler discards result set from prepared statement
when my web application has http session listener configured its web xml classes session created called when user assigned new session however method also called when user itself session assigned new id whether actually new session can disputed point bug when session removed due timeout example single session destroyed call executed when http session listener manages some kind external resource behaviour leads resource leak because session created called twice while session removed only called once aware reason changing session id somehow understand why session created called again after all new session id must some way session listener notified old session longer exists same behaviour seen tomcat probably well didn test http session listener session created called second time when user matching session destroyed call
access logs written org apache catalina valves access log valve being written servlet async requests reproduce handle request marking servlet web servlet async supported true send some traffic notice nothing being written access logs access log valve log called org apache catalina context log access from source version 11 org apache catalina connector coyote adapter java line 416 async context impl async con impl async context impl request get async context async con impl null async true else comet response finish response post parse success log only processing invoked post parse request failed has already logged context request get mapping data context log access request response system current time millis req get start time false req action action code post request null async case log access isn called here ve searched through code don see log access being called anywhere else except error cases so looks like async case missing call log access somewhere access logs servlet async requests
standard jar scanner ignores web fragment xml files unpacked jars ending jar
patch more specific error message missing file
patch ensure rethrown exceptions retain original cause
when connector stopped connection keep alive state next request received connection processed connection closed when request received should rejected outstanding questions what return code any should sent back client reading request starts before connector stopped should request allowed complete should rejected current keep alive request processed after connector stop
enhancement set security provider within ajp apr processor
jsp compiler initializes classes during compile which can result failures
fiddled around while have determined best my ability real bug have jndi datasource connected postgresql server have two jndi resources reader writer so later can implement system replication etc deal writes reads different connections summarize after using system two connections postgres get reused one reader writer under load number increases slowly go back down usually end up two idle connections one reader one writer left under load you reload context where datasource context specific datasource number connections jump two when used each reload produces more connections min until restart server appears after reload persisted connections get abandoned orphaned eventually hit my max connections cannot aquire any more system fails have tried abandond collection parameters have added debug logging my code ensure am indeed calling close connections checkout even exceptions error cases under normal useage without reloads connection leakage happens solaris machine 27 hotfix 22096 tar gz applied let me know more information required have development environment can let somone attach jdb hammer thing since production system help getting repro wayne reloading context orphans currently open jndi datasource connections
stream handler factory can registered once per vm tomcat registers dir context stream handler factory jndi protocol however web applications running inside want register handlers custom scheme currently possible can dir context stream handler factory enhanced allow applications register stream handler custom schemes might have better can made property context xml file already can enhanced future enabling web applications register own stream handlers
null pointer exception thrown base register method null principal
test pool async junit java sql sqlexception tomcat pool 10 wait pool empty unable fetch connection none available 10 use junit org apache tomcat jdbc pool connection pool borrow connection connection pool java 615 junit org apache tomcat jdbc pool connection pool get connection async connection pool java 143 junit org apache tomcat jdbc pool data source proxy get connection async data source proxy java 122 junit org apache tomcat jdbc test fairness test test thread run fairness test java 231 test failures windows 24 thread system
org apache naming resources dir context raises file found exception lines 311 344 382 396 would more helpful provided message string example change line 344 throw new file found exception get url get file would make easier diagnose mistakes server unhelpful file found exception raised
failonerror boolean attribute manager ant tasks would nice have allow more flexible operation within ant build files attach patch next week also fixes unecessary crs during response read print missing url encoding some tasks failonerror attribute ant tasks
developer accidentally placed tab character after port number properties file tomcat instance prevented tomcat from listening port difficult track down whether tomcat running seems like properties file reader could easily trim excess whitespace before trying use entries major error from minor whitespace error properties file
think some values returned lifecycle state available wrong am certain must destroy should return false because state later than stopped think stopping prep should return false because we can get from failed state think starting should return false because too early return true result following complete list states return true available started must stop lifecycle state available more restrictive
summary says all entered reminder would good do implement ssl nio connector
embedded tomcat sometimes throws exception when calling destroy method java lang illegal argument exception null source java util event object init event object java 56 javax management notification init notification java 184 org apache catalina core standard context destroy internal standard context java 5433 org apache catalina util lifecycle base destroy lifecycle base java 285 org apache catalina core container base remove child container base java 969 org apache catalina core container base destroy internal container base java 1108 org apache catalina util lifecycle base destroy lifecycle base java 285 org apache catalina core container base remove child container base java 969 org apache catalina core container base destroy internal container base java 1108 org apache catalina util lifecycle base destroy lifecycle base java 285 org apache catalina core standard service destroy internal standard service java 593 org apache catalina util lifecycle base destroy lifecycle base java 285 org apache catalina core standard server destroy internal standard server java 786 org apache catalina util lifecycle base destroy lifecycle base java 285 org apache catalina startup tomcat destroy tomcat java 323 su msk jet nioproxy rule config embedded webserver stop embedded webserver java 26 think standard context destroy internal misses check get object name null embedded tomcat destroy throws java lang illegal argument exception
currently role base attribute must fxed location directory simple change would allow role base specified relative user dn my enhancement suggestion would change role base definition follows role base base entry role search specified search base top level directory context specified may optionally include pattern replacements name parts user name returned javax naming name get example realm defintion server xml you could specify role base role base ou groups majority code accomplish would jndirealm get roles could look like string base null role base format null name parser np context get name parser name name np parse dn string name parts new string name size int idx idx name size idx name parts idx name get idx base role base format format name parts perform configured search process results debug log searching role base base attribute role name log filter expression filter naming enumeration results context search base filter controls thank you art jndirealm role base pattern enahncement
appears jndirealm able locate roles must anonymous accessible believe security purposes should necessary we validating user binding directory case roles could accessible any bound user particular user discussed very briefly tomcat user list sounds like had been discussed previously whatever reason idea rejected anyhow submit bug either code which requires roles anonymous which does make clear case least tomcat servlet jsp container realm how seems reasonable me we binding directory authenticate we would have user access roles perhaps should more explicetly state case hope would accepted enhancement am going attempt attach modified jndirealm uses connection obtain roles thank you art jndi roles must anonymous accessible
servlet probably incorrectly closes writer outputstream response attempts read from request ajp connector sends get body chunk mod jk worker starts series very confusing between worker tomcat worker doesn read until makes its next request after making its next request reads sends response length same time tomcat responds request made worker another get body chunk which worker also responds message length really weird thing happens tomcat replays first request made worker point based what looking tcpdump get too confused work out exactly what happening ajp connector sends get body chunk when reading after response closed
deviation from servlet3 spec concerning resource lookup from meta inf resources
hi sorry my english use tomcat apr 20 noticed from heap dump many org apache tomcat util net socket wrapper objects which kept connections atribute org apache coyote ajp ajp apr protocol ajp connection handler object don understand why so many objects representing old connections which active my example 300000 objects created after days tomcat work has someone forgotten clean hash map from time time best regards sergiusz brzezinski ajp connection handler keeps many connections causing memory leak
custom error pages cdi weld problem
string containes char sequence being resolved correctly following situation span class faces context external context request request uri contains item url activepage template item label key span exception javax el elexception faces template main layout xhtml java lang method exception java lang string contains java lang string com sun faces facelets compiler attribute instruction write attribute instruction java 87 com sun faces facelets compiler encode begin java 75 com sun faces renderkit html basic html basic renderer encode recursive html basic renderer java 285 com sun faces renderkit html basic output link renderer encode children output link renderer java 125 javax faces component uicomponent base encode children uicomponent base java 848 javax faces component uicomponent encode all uicomponent java 1613 com sun faces facelets component repeat renderer encode children repeat renderer java 97 com sun faces facelets component uirepeat process uirepeat java 496 com sun faces facelets component uirepeat encode children uirepeat java 926 javax faces component uicomponent encode all uicomponent java 1613 javax faces render renderer encode children renderer java 168 javax faces component uicomponent base encode children uicomponent base java 848 javax faces component uicomponent encode all uicomponent java 1613 javax faces component uicomponent encode all uicomponent java 1616 javax faces component uicomponent encode all uicomponent java 1616 com sun faces application view facelet view handling strategy render view facelet view handling strategy java 380 com sun faces application view multi view handler render view multi view handler java 126 com ocpsoft pretty faces application pretty view handler render view pretty view handler java 157 com sun faces lifecycle render response phase execute render response phase java 127 com sun faces lifecycle phase do phase phase java 101 com sun faces lifecycle lifecycle impl render lifecycle impl java 139 javax faces webapp faces servlet service faces servlet java 313 org apache catalina core application filter chain internal do filter application filter chain java 306 org apache catalina core application filter chain do filter application filter chain java 210 com reardeninc tigris ui facesutil faces filter do filter faces filter java 86 org apache catalina core application filter chain internal do filter application filter chain java 244 org apache catalina core application filter chain do filter application filter chain java 210 org primefaces webapp filter file upload filter do filter file upload filter java 79 org apache catalina core application filter chain internal do filter application filter chain java 244 org apache catalina core application filter chain do filter application filter chain java 210 com ocpsoft pretty pretty filter do filter pretty filter java 100 org apache catalina core application filter chain internal do filter application filter chain java 244 org apache catalina core application filter chain do filter application filter chain java 210 org apache catalina core standard wrapper valve invoke standard wrapper valve java 240 org apache catalina core standard context valve invoke standard context valve java 161 org apache catalina base invoke base java 496 org apache catalina core standard host valve invoke standard host valve java 164 org apache catalina valves error report valve invoke error report valve java 100 org apache catalina valves access log valve invoke access log valve java 541 org apache catalina core standard engine valve invoke standard engine valve java 118 org apache catalina connector coyote adapter service coyote adapter java 383 org apache coyote http11 process java 243 org apache coyote http11 handler process java 188 org apache tomcat util net jio endpoint socket processor run jio endpoint java 288 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 680 caused java lang method exception java lang string contains java lang string java lang class get method class java 1605 javax el bean elresolver invoke bean elresolver java 405 javax el composite elresolver invoke composite elresolver java 161 org apache el parser ast value get value ast value java 159 org apache el parser ast choice get value ast choice java 45 org apache el value expression impl get value value expression impl java 189 com sun faces facelets el eltext eltext variable string eltext java 207 com sun faces facelets compiler attribute instruction write attribute instruction java 82 46 more el parser needs more dynamic
servlet request listener defined when invoked after call async context dispatch dispatcher type returned from servlet request request rather than async when actual servlet invoked type correctly set async listener intended invoked each dispatch dispatcher type should match value returned filter servlet invalid dispatch type servlet request listener async dispatch
roles command doesn work
context parameters being overridden parameters from web application deployment descriptor even through override attribute set false example lines from context file context path path doc base path docbase cookies true parameter name parameter name value test1 override false context lines from web xml context param description default value parameter name description param name parameter name param name param value test2 param value context param now servlet context get init parameter parameter name returns test2 context parameters being overridden parameters from web application deployment descriptor
http servlet request get auth type returns null though request
our jsp pages compiled build time turn gen string char array optimization switch some cases longer lines generated java code than javac compiler can process provides following error message javac compiling 1609 source files jspc classes javac jspc src org apache jsp web 002d inf 005f app pages terms conditions 005fms 005f my jsp java 96 constant string too long jasper can generate uncompilable source code gen string char array turned
validator class name validation fails set last validated timestamp
jndirealm invokes get attributes attribute ids prevents using domain login
debug log message embedded java typo initial context factory alread set attached patch against 29 tag issue exists tc6 trunk typo embedded java log message
when using jsp mapped servlet web xml cyrillic characters allowed web xml
request util urldecode throws illegal argument exception urls xx code last character
please make class org apache catalina core application context facade non final so can subclassed need extend application context facade so mobicents sip servlet working top tomcat integrate weld thanks george make class org apache catalina core application context facade non final
when stopping tomcat using services msc error message displayed windows could stop apache tomcat service local computer error 109 pipe has been ended despite error tomcat appears stop normally problem encountered 29 error when stopping tomcat using services msc
internal nio input buffer expands its buffer while reading request line effectively ignoring max http header size setting internal nio input buffer should honor max http head size
update tomcat use jre provided solutions cve 2009 3555 available
servlet annotations scanned unpack wars false
remove redundant object jsp runtime library
npe tag file processor when tag file expanded directory jar
version tomcat component catalina os windows 64bit overview parallel deployment works like charm non clustered environment when deploying versioned app appname version war farm deployer directory seems filename encoding delimiter translated correctly identify war file file system translated 23 23 reproduce create version app file deploy file watched farm deployer directory expected result versioned app copyied cluster members deployed actual result versioned app copyied cluster members catalina log displays following error messages container background processor standard engine catalina info org apache catalina ha deploy farm war deployer installing webapp shop 201101261 from apache tomcat7 cluster webapps shop 201101261 war container background processor standard engine catalina info org apache catalina ha deploy farm war deployer cluster wide remove web app shop 201101261 container background processor standard engine catalina error org apache catalina ha deploy farm war deployer unable install war file java io file found exception apache tomcat7 cluster webapps shop 23 23201101261 war das system kann die angegebene datei nicht finden java io file input stream open native method java io file input stream init file input stream java 106 org apache catalina ha deploy file message factory init file message factory java 152 org apache catalina ha deploy file message factory get instance file message factory java 175 org apache catalina ha deploy farm war deployer install farm war deployer java 372 org apache catalina ha deploy farm war deployer file modified farm war deployer java 468 org apache catalina ha deploy war watcher check war watcher java 95 org apache catalina ha deploy farm war deployer background process farm war deployer java 591 org apache catalina ha tcp simple tcp cluster background process simple tcp cluster java 627 org apache catalina core container base background process container base java 1200 org apache catalina core container base container background processor process children container base java 1393 org apache catalina core container base container background processor process children container base java 1403 org apache catalina core container base container background processor run container base java 1382 java lang thread run thread java 662 container background processor standard engine catalina info org apache catalina startup host config deploying web application archive shop 201101261 war relevant server xml host name sbwebapp1 app base catalina base cluster webapps unpack wars true auto deploy true cluster class name org apache catalina ha tcp simple tcp cluster channel send options manager class name org apache catalina ha session delta manager expire sessions shutdown true notify listeners replication false state transfer timeout channel class name org apache catalina tribes group group channel membership class name org apache catalina tribes membership mcast service address 228 port 45564 frequency 500 drop time 3000 receiver class name org apache catalina tribes transport nio nio receiver address 192 168 222 220 port 4000 auto bind 100 selector timeout 5000 max threads sender class name org apache catalina tribes transport replication transmitter transport class name org apache catalina tribes transport nio pooled parallel sender sender interceptor class name org apache catalina tribes group interceptors tcp failure detector interceptor class name org apache catalina tribes group interceptors message interceptor class name org apache catalina tribes group interceptors throughput interceptor channel valve class name org apache catalina ha tcp replication valve filter gif js jpg png htm html css txt swf flv valve class name org apache catalina ha session jvm route binder valve cluster listener class name org apache catalina ha session jvm route session idbinder listener cluster listener class name org apache catalina ha session cluster session listener deployer class name org apache catalina ha deploy farm war deployer temp dir catalina base cluster temp deploy dir catalina base cluster webapps watch dir catalina base cluster deploy watch enabled true cluster access log processes all example docs config valve html note pattern used equivalent using pattern common valve class name org apache catalina valves access log valve directory logs prefix ajp access suffix log pattern quot quot resolve hosts false host farm deployer doesn support parallel deployment
keep alive protection doesn work
tribes byte message class used transfer byte payloads context tribes framework due how message deserialized data loss hence corruption message size exceeds underlying buffer size solution replace object input read byte call object input read fully byte fix attached tribes byte message get corrupted message size exceeds underlying buffer size
latest tomcat codes saw new thread created listener start filter start load startup two methods bind thread unbind thread marked private how about making those methods protected so other containers could use those two methods own works thanks make bind thread unbind thread method protected
session related errors prevent clean recycle request response objects coyote adapter
error running cgi executable tomcat 30
when various forms eviction run connection pool connection pool size goes negative appears concurrency problem attached unit test illustrates issue connection pool size corruption when evictions enabled
redundant null checks before instanceof equals
sample build xml uses wrong manager url
class new instance called even when following method servlet context add filter method called javax servlet filter registration dynamic add filter java lang string javax servlet filter filter leads exception runtime args constructor filter pasted below ll supply simple patch fixes issue me severe exception starting filter test filter java lang exception test test filter java lang class new instance0 class java 340 java lang class new instance class java 308 org apache catalina core default instance manager new instance default stance manager java 119 org apache catalina core application filter config get filter applicatio filter config java 252 org apache catalina core application filter config set filter def applica tion filter config java 372 org apache catalina core application filter config init application fi lter config java 98 org apache catalina core standard context filter start standard context java 4382 org apache catalina core standard context call standard context java 5040 org apache catalina core standard context call standard context java 5035 java util concurrent future task sync inner run future task java 303 java util concurrent future task run future task java 138 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 662 class new instance used dynamic instance filters causing exception
following exception reported via work warning exception processing cluster org apache catalina ha tcp simple tcp cluster 68e4e358 background process java util concurrent modification exception java util hash map hash iterator next entry hash map java 810 java util hash map entry iterator next hash map java 851 java util hash map entry iterator next hash map java 849 org apache catalina ha deploy war watcher check war watcher java 87 org apache catalina ha deploy farm war deployer background process farm war deployer java 609 org apache catalina ha tcp simple tcp cluster background process simple tcp cluster java 596 org apache catalina core container base background process container base java 1302 org apache catalina core container base container background processor process children container base java 1601 org apache catalina core container base container background processor process children container base java 1610 org apache catalina core container base container background processor run container base java 1590 java lang thread run thread java 636 root cause removing entry directly from map rather than from iterator have patch ll apply shortly concurrent modification exception removing war via farm war deployer
small jsps do set content length use chunked encoding access log valve configured
npe replication valve
org apache catalina realm memory rule set begin dosen validate attribute values before adding user memory realm username name present null username used which can cause odd problems later basically method should check parameters passed memory realm add user null before calling method memory user rule doesn validate user attributes
am using eclipse do my development am running tomcat 24 from within eclipse one nice features eclipse anything you display system out comes out blue anything you send system err displayed red however when tomcat running catalina overrides system err makes point system out very inconvinient because its much harder search severe error messages list millions trivial ones system err gets overriden output system out
hi jasper generated java files compiled template those files very unaesthetic could demonstrate nice side effects using simple page import mypackage jspfactory you should use full qualified names instead bunch import staments example jspx factory jsp factory get default factory would become jspx factory javax servlet jsp jsp factory get default factory you don already do you should use reference where possible don know what spec says about conflict shouldn bad idea use full qualified names instead imports full qualified names instead imports
illegal argument exception occurs when setting max active smaller than
missing override annotations
servlet can set headers cookies after writing data servlet output stream once servlet writes data headers committed however cookie example writes some data first before doing add cookie response reason why code works all even above bug cookie example only writing small amount data before doing response add cookie data still held buffer yet sent over wire hence headers yet committed so pure luck example works you can easily expose bug writing say 20k characters example before response add cookie called you see cookies adding response actually sent back client fix simple move up response add cookie before response get writer cookie example setting cookie after writing data
ant tasks give null pointer exception when error occurs masking true error
bad use get class could potentially lead concurrency bugs future
you set initial size can obtain connection using get connection async method
ability configure datasource server level have shared amongst all applications server each application supplying own credentials datasource type supported dbcp called shared datasource request shared datasource dbcp
prop find 404 error after mk col succes
apr get remote host returns null unknown clients
neither change session id message nor session expired message set timestamp messages received during cluster sessions delta manager startup because timestamp set dropped made patch add timestamp change session id session expired message best regards change session id message received during cluster session dropped
multiple forwarded headers handled remote ip valve
we ve been running tomcat 29 fc8 21 tens thousands long polling threads which usually work fine every few days though we experience sudden lockup nio connector has restarted have been seen accompanied following stack trace exception thread http 8082 client poller java lang null pointer exception org apache tomcat util net nio endpoint poller run nio endpoint java 1620 java lang thread run thread java 662 looking source seems issue likely race condition where access called null attachment probably while process being cancelled while iterator null iterator has next selection key sk selection key iterator next key attachment attachment key attachment sk attachment npe attachment access iterator remove process key sk attachment while occasional nio connector lockups high load
jndirealm support configuring ldap size limit count limit search controls
according el spec ch expressions when string containing big integer have evaluated follows coerce both big decimal apply operator actual though instead coercing string big decimal does two coercions string double big decimal which produces different result reproduce run following jsp page page context set attribute page context set attribute new java math big integer used explicitly coerce arguments big decimal page context set attribute new java math big decimal br br br br br actual result expected result think minor issue though reproducible current tc6 well maybe el lang elarithmetic add object object should delegate bigdecimal instead double types arguments el evaluation floating point string value vs big integer loses precision
get connection method class data source proxy ignoring credentials
engine level clustering name cluster manager host name context name simple tcp cluster get manager name string manager follows public string get manager name string name manager manager string cluster name name cluster name null cluster name manager get container get name get container instanceof engine container context manager get container context null context instanceof context container host context context get parent host null host instanceof host cluster name null cluster name index cluster name host get name cluster name return cluster name method cluster name index checked because context name becomes context name version web application has version name cluster manager doesn become format host name context name result engine level clustering doesn work correctly best regards engine level clustering does work correctly web application has version
provide capability declare request response session other variables jsp service function final tunable feature just like others tomcat web xml file why need feature use request response session variables anonymous classes example declaration iterator through elements which includes some other jsp file statically usage iterator other jsp file final request response session other variables
class name attribute included realm tag server xml server dies cryptic null pointer exception would nice produced more meaningful error message like missing class name attribute realm tag realm without class name server xml produces null pointer exception
once user principal object supposed cached duration user session especially important when using jdbcrealm jndirealm reduce load external services most basic digest call base register cache principal however register does nothing session object does already exist so caching does occur when application does create session object itself problem can seen setting security constraint tomcat docs browsing tomcat external service hit every request problem does occur form based login because form caches principal itself creates new session necessary do probably best fix would change base register create new session calling get session request true instead get session request false however perhaps reason why being done though so cannot see what alternative change concrete classes make sure session exists before calling register basic java 23 mar 2002 17 52 16 0000 12 basic java jul 2002 12 46 30 0000 160 160 string password parse password principal context get realm authenticate username password principal null session session get session request true register request response principal constants basic method username password return true similar patches would required digest course do always cache principal
two examples using string byte array which unlikely produce desired output ha deploy file message factory write message log message uses string msg get data which byte array coyote ajp ajp message dump use string msg which type byte string byte array probably correct
first access jspx page causes classloader leak jsp document parser
hi when verifying fix 50360 ran issue expired sessions during process expires dec 10 2010 12 59 32 am org apache catalina core container base background process warning exception processing manager de javakaffee web msm memcached backup session manager background process java lang illegal state exception get creation time session already invalidated org apache catalina session standard session get creation time standard session java 1096 org apache catalina session manager base remove manager base java 802 org apache catalina session standard session expire standard session java 840 org apache catalina session standard session valid standard session java 655 org apache catalina session manager base process expires manager base java 609 org apache catalina session manager base background process manager base java 594 de javakaffee web msm memcached backup session manager background process memcached backup session manager java 1130 org apache catalina core container base background process container base java 1214 afaics memcached backup session manager could override remove session session boolean update calling super remove session false invalid sessions another option would change standard session expire standard session java 840 so does invoke manager remove true manager remove false even better change manager base remove manager base java 802 invoke some session get creation time internal which skips validation what do you think cheers martin standard session expire causes illegal state exception get creation time session already invalidated
consider following example dl each items page context response header names var name each items page context response get headers name var value dt name dt dd value dd each each dl name string name class name also proves get headers name call however results org apache jasper el jsp elexception test jsp 23 12 page context response get headers name java lang method exception org apache catalina connector response facade get headers java lang object another example which also results method exception which suggests object been passed argument set var name value test page context response get header name works all fine glassfish v3 scoped el variable treated object
provide option treat application www form urlencoded encoded parameters put request similar manner application www form urlencoded parameters post request provide option parse application www form urlencoded put requests
embedded stop internal sets state starting should stopping
org apache catalina ha cluster message base serializable consider declaring serial version uid similarly org apache catalina ha session replicated session org apache catalina ha session serializable principal org apache catalina session standard session org apache catalina tribes tipis abstract replicated map map message org apache tomcat util modeler managed bean missing serial version uids
memory leaks protection does detect leaks triggered jsp pages code
add missing setter getter abstract xxxprotocol
reproducible using default chat example ie chat servlet examples jsp chat following additional changes enabled http11nio conf server xml connector address port 8080 protocol org apache coyote http11 http11nio protocol connection timeout 20000 enable lookups false accept count 100 disable upload timeout true max threads 15 min spare threads 15 max spare threads 15 recycle facades true enabled comet valve conf context xml valve class name org apache catalina valves comet connection manager valve problem comet event event type error subtype timeout comet event event type end never being fired can confirmed logs messages events never printed worked tomcat 29 aside what most complete robust way do async io tomcat today servlet comet processor comet processor async timeout events being fired
minor glitch display negative ttl session detail jsp
when dispatch method called inside timeout function async listener exception thrown severe exception error occurred container during request processing java lang illegal state exception calling dispatch async valid request async state timing out org apache coyote async state machine async dispatch async state machine java 220 org apache coyote http11 http11nio processor action internal http11nio processor java 672 org apache coyote http11 abstract action abstract java 937 org apache coyote request action request java 348 org apache catalina core async context impl dispatch async context impl java 173 org apache catalina core async context impl dispatch async context impl java 135 org apache catalina core async context impl dispatch async context impl java 130 com juriy snowball snow servlet timeout snow servlet java 23 org apache catalina core async listener wrapper fire timeout async listener wrapper java 45 org apache catalina core async context impl timeout async context impl java 109 org apache catalina connector coyote adapter async dispatch coyote adapter java 270 org apache coyote http11 http11nio processor async dispatch http11nio processor java 232 org apache coyote http11 http11nio protocol handler event http11nio protocol java 305 org apache tomcat util net nio endpoint socket processor run nio endpoint java 1526 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 619 sample code below protected void service http servlet request request http servlet response response throws servlet exception ioexception async context context request start async context set timeout 3000 context add listener new async listener public void complete async event async event throws ioexception public void timeout async event async event throws ioexception system out println hitting timeout async event get async context dispatch public void error async event async event throws ioexception public void start async async event async event throws ioexception looks like servlet allows do call here quotation explicitly states flow timeouted async contexts page 18 event asynchronous operation times out container must run through following steps invoke async listener timeout method all async listener instances registered servlet request which asynchronous operation initiated none listeners called async context complete any async context dispatch methods perform error dispatch status code equal http servlet response sc internal server error matching error page found error page did call async context complete any async context dispatch methods container must call async context complete second step assumes call dispatch timeout allowed call async context dispatch timeout callback throws exception
reproduce login manager webapp click server status complete server status links tc6 complete server status page lists servlets each deployed application current tc7 does list them only summary information each webapp displayed looking status manager servlet status transformer classes code iterate over servlets still probably jmx names have changed working any more manager detailed status page does display servlets
javax el composite elresolver issue
performance issue after revision 746425
recursive dependency between tomcat catalina ha tomcat catalina
class cast exception occurs context xml contains resource link
tribes bio sender scheduling task excecutors
trying register wrapper welcome file mapper before context registered mapper
jre memory leak prevention listener invokes methods known pin context class loader memory order avoid having webapp class loader pin itself may cause undesirable behavior embedded environments instead jmlpl could use security context temporarily set current context class loader system class loader solve embedded situation without client having remember take care jre memory leak prevention listener should cause memory leaks using system class loader
rpc channel sends answer without requesting ack
org apache catalina session store base has hidden dependency persistent manager
while calling method destory standard context directly seems method destory internal called twice lifecycle mbean base two stacktraces below lifecycle mbean base unregister object name line 191 lifecycle mbean base destroy internal line 73 container base destroy internal line 1109 standard context destroy internal line 5114 lifecycle base destroy line 271 container base remove child container line 963 container base destroy internal line 1106 standard context destroy internal line 5114 lifecycle base destroy line 271 lifecycle mbean base unregister object name line 191 lifecycle mbean base destroy internal line 73 container base destroy internal line 1109 standard context destroy internal line 5114 lifecycle base destroy line 271 destory method called twice while child destoryed directly
possible npes simple tcpcluster
small enhancement file handler java which allow susers disable log rotation setting rotation attribute false add option disable log rotation file handler
lot mapper listener registered container listener standard context
context config unnecessary null checks
symptom all processor threads spin madly tomcat processor 20 daemon prio 10 tid 0x09210800 nid 0x51fb runnable 0x61b76000 java lang thread state runnable java util hash map get entry hash map java 347 java util hash map contains key hash map java 335 org apache catalina security security util do privilege security util java 227 org apache catalina core application filter chain internal do filter application filter chain java 230 org apache catalina core application filter chain access 000 application filter chain java 56 org apache catalina core application filter chain run application filter chain java 189 java security access controller do privileged native method org apache catalina core application filter chain do filter application filter chain java 185 cause org apache catalina security security util object cache hash map access synchronized javadoc hash map says note synchronized multiple threads access hash map concurrently least one threads modifies map structurally must synchronized externally proposed solution change object cache concurrent hash map lack org apache catalina security security util
standard pipeline destroyed two times
violation jsp el spec version when coerce enum string
manager app wrongly localized
when metadata complete false add groovy all jar app lib throw java lang reflect invocation target exception sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 290 org apache catalina startup bootstrap main bootstrap java 418 caused java lang class format error groovy jmx builder package info illegal jvm constant class name groovy jmx builder package info java lang class loader define class1 native method java lang class loader define class cond class loader java 632 java lang class loader define class class loader java 616 java security secure class loader define class secure class loader java 141 org apache catalina loader webapp class loader find class internal webapp class loader java 2804 org apache catalina loader webapp class loader find class webapp class loader java 1144 org apache catalina loader webapp class loader load class webapp class loader java 1639 org apache catalina loader webapp class loader load class webapp class loader java 1517 org apache catalina startup context config check handles types context config java 1952 org apache catalina startup context config process annotations stream context config java 1915 org apache catalina startup context config process annotations jar context config java 1802 org apache catalina startup context config process annotations url context config java 1761 org apache catalina startup context config process annotations context config java 1747 org apache catalina startup context config web config context config java 1252 org apache catalina startup context config configure start context config java 881 org apache catalina startup context config lifecycle event context config java 315 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina util lifecycle base fire lifecycle event lifecycle base java 89 org apache catalina core standard context start internal standard context java 4700 org apache catalina util lifecycle base start lifecycle base java 140 org apache catalina core container base start internal container base java 1028 org apache catalina core standard host start internal standard host java 773 org apache catalina util lifecycle base start lifecycle base java 140 org apache catalina core container base start internal container base java 1028 org apache catalina core standard engine start internal standard engine java 278 org apache catalina util lifecycle base start lifecycle base java 140 org apache catalina core standard service start internal standard service java 429 org apache catalina util lifecycle base start lifecycle base java 140 org apache catalina core standard server start internal standard server java 662 org apache catalina util lifecycle base start lifecycle base java 140 org apache catalina startup catalina start catalina java 592 more when metadata complete false throw illegal jvm constant class name
cannot compile recursive tag ant uses class from webapp
latest trunck can configure context when metadata complete true version
you deploy war contex xml meta inf context xml has resource tag tomcat don boot gives error java lang null pointer exception org apache catalina core standard context get object key properties name only standard context java 5570 org apache catalina core standard context set naming resources standard context java 1757 org apache catalina core standard context get naming resources standard context java 1735 org apache catalina startup set next naming rule end set next naming rule java 99 org apache tomcat util digester digester end element digester java 1058 com sun org apache xerces internal parsers abstract saxparser end element abstract saxparser java 601 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 180 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1544 org apache catalina startup catalina load catalina java 524 org apache catalina startup catalina load catalina java 560 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap load bootstrap java 260 org apache catalina startup bootstrap main bootstrap java 414 29 09 2010 13 50 37 org apache catalina startup catalina load aviso catalina start using conf server xml java lang null pointer exception org apache tomcat util digester digester create saxexception digester java 2688 org apache tomcat util digester digester create saxexception digester java 2714 org apache tomcat util digester digester end element digester java 1061 com sun org apache xerces internal parsers abstract saxparser end element abstract saxparser java 601 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 180 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1544 org apache catalina startup catalina load catalina java 524 org apache catalina startup catalina load catalina java 560 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap load bootstrap java 260 org apache catalina startup bootstrap main bootstrap java 414 caused java lang null pointer exception org apache catalina core standard context get object key properties name only standard context java 5570 org apache catalina core standard context set naming resources standard context java 1757 org apache catalina core standard context get naming resources standard context java 1735 org apache catalina startup set next naming rule end set next naming rule java 99 org apache tomcat util digester digester end element digester java 1058 20 more 29 09 2010 13 50 37 org apache tomcat util digester set properties rule begin aviso set properties rule server service engine host context setting property source org eclipse jst jee server did find matching property 29 09 2010 13 50 37 org apache tomcat util digester digester end element grave end event threw exception java lang null pointer exception org apache catalina core standard context get object key properties name only standard context java 5570 org apache catalina core standard context set naming resources standard context java 1757 org apache catalina core standard context get naming resources standard context java 1735 org apache catalina startup set next naming rule end set next naming rule java 99 org apache tomcat util digester digester end element digester java 1058 com sun org apache xerces internal parsers abstract saxparser end element abstract saxparser java 601 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 180 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1544 org apache catalina startup catalina load catalina java 524 org apache catalina startup catalina start catalina java 573 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 288 org apache catalina startup bootstrap main bootstrap java 415 29 09 2010 13 50 37 org apache catalina startup catalina load aviso catalina start using conf server xml java lang null pointer exception org apache tomcat util digester digester create saxexception digester java 2688 org apache tomcat util digester digester create saxexception digester java 2714 org apache tomcat util digester digester end element digester java 1061 com sun org apache xerces internal parsers abstract saxparser end element abstract saxparser java 601 com sun org apache xerces internal parsers abstract xmldocument parser empty element abstract xmldocument parser java 180 com sun org apache xerces internal impl xmldocument fragment scanner impl scan start element xmldocument fragment scanner impl java 1343 com sun org apache xerces internal impl xmldocument fragment scanner impl fragment content driver next xmldocument fragment scanner impl java 2755 com sun org apache xerces internal impl xmldocument scanner impl next xmldocument scanner impl java 648 com sun org apache xerces internal impl xmldocument fragment scanner impl scan document xmldocument fragment scanner impl java 511 com sun org apache xerces internal parsers parse java 808 com sun org apache xerces internal parsers parse java 737 com sun org apache xerces internal parsers xmlparser parse xmlparser java 119 com sun org apache xerces internal parsers abstract saxparser parse abstract saxparser java 1205 com sun org apache xerces internal jaxp saxparser impl parse saxparser impl java 522 org apache tomcat util digester digester parse digester java 1544 org apache catalina startup catalina load catalina java 524 org apache catalina startup catalina start catalina java 573 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 288 org apache catalina startup bootstrap main bootstrap java 415 caused java lang null pointer exception org apache catalina core standard context get object key properties name only standard context java 5570 org apache catalina core standard context set naming resources standard context java 1757 org apache catalina core standard context get naming resources standard context java 1735 org apache catalina startup set next naming rule end set next naming rule java 99 org apache tomcat util digester digester end element digester java 1058 20 more 29 09 2010 13 50 37 org apache catalina startup catalina start grave cannot start server server instance configured here my contex xml obs some values were replaced xxxx xml version encoding utf context privileged true reloadable true watched resource web inf web xml watched resource watched resource meta inf context xml watched resource resource name jdbc bestfork auth container type com mchange v2 c3p0 combo pooled data source factory org apache naming factory bean factory user xxx password xxxx driver class org postgresql driver jdbc url jdbc postgresql localhost 5432 xxxxx min pool size max pool size 30 acquire increment idle connection test period 100 max idle time 30 resource name mail session auth container type javax mail session mail smtp host xxxx mail smtp auth true username xxx password xxx mail user xxxx mail password xxxx mail smtp port 587 mail transport protocol smtp mail debug true realm class name org apache catalina realm jdbcrealm driver name org postgresql driver connection url jdbc postgresql localhost 5432 xxxx connection name xxxx connection password xxxx user table usuario user name col usuario cpf user cred col usuario senha user role table usuario papel role name col papel nome digest md5 context null pointer exception context xml present resource
resources served from web inf lib jar meta inf resources metadata complete true set web xml
make private immutable fields final
bad division around user role new request login logout methods
data race application context
double check locking possible data race jsp servlet wrapper
double check idiom possible data race
found following warnning messages oct 2010 25 27 pm org apache catalina startup set all properties rule begin warning set all properties rule server service connector setting property min spare threads 31 did find matching property ajp connector configs following connector port 8009 protocol ajp redirect port 8443 min spare threads 100 when used http connector min spare threads able used org apache coyote ajp ajp protocol doesn set min spare threads org apache tomcat util net jio endpoint made patch patch made based abstract best regards when ajp connector used min spare threads cannot used
resource name jndi name
servlet container initializer can actually add listeners
problems async listener resource injection
lazy without any data race ast integer ast floating point ast string
when standard server store config called all exceptions were getting swallowed lead impresssion working correctly when saved either through manager application manager save through jconsole ve removed catch throwable block thrown exception upon finding registerd mbean patch standard server swallows error store config
cluster when using delta manager memory leak can occur
nio selector issue linux platform
log format rmi ports can improved remove
jdbc leak prevention class can register unregistered jcbc driver
when viewing either connector objects thread pool objects via jmx name executor shown would helpful were exposed via jmx so links between connectors thread pools executors could determined connector thread pool link executor exposed via jmx
tomcat often configure executor min spare threads work around memory leak issues upon redeployment sometimes especially development when refresh page my webapp safari chrome firefox some resources page take several seconds 10s served though static resources should come less than 50ms instance over 15 requests page html others resources like js css images sometimes have take 10s after analysis found org apache catalina core standard thread executor task queue offer runnable statement parent get active count parent get pool size sometimes true unexpectedly here scenario thread pool executor empty user refreshes page accesses empty cache his web browser page uses more than 10 15 resources browser establishes one tcp connection new thread created after browser receives response decides load many resources possible parallel establishes up tcp connections my tests acceptor thread calls standard thread executor execute process each incoming connection each call standard thread executor task queue offer runnable being called you study sources java thread pool executor you can see small delay between time new thread created thus increasing pool size time starts working its first task increasing active count since my case connections established rapid burst calls task queue offer sometimes faster than small delay so we do have parent get active count parent get pool size thus task enqueued instead forcing creation thread serve since keep alive enabled tomcat threads take care only one tcp connection time requests queue must wait keep alive timeout so thread returned pool serve pending tasks 25s keep alive time out means some requests take more than 25s served eventhough pool never full server quite idle other facts about issue although my test case starts empty pool can occur even loaded server thing triggers issue burst new tcp connections problem less severe lower keep alive timeout keepalive disabled any case also depends time taken serve current requests issue also affects tomcat less severe because tc7 threads returned pool after each http request even tcp connection kept alive impact would same tc6 keep alive disabled race condition standard thread executor requests sometimes enqueued instead creating new threads
startup bootstrap uses jasper util exception utils class placed bootstrap jar causing rather nasty failures anything goes wrong during initial should fairly simple matter updating build xml include wasn sure whether including jasper classes bootstrap done thing tomcat util exception utils identical too looks like wrong thing grab exception utils class missing from bootstrap jar
javadoc corrections
install tomcat service windows specify server port server xml start service stop service following printed catalina 2010 04 27 log 27 04 2010 17 49 13 org apache catalina startup catalina stop server severe shutdown port configured shut down server through os signal server shut down just message tomcat stops regardless after printing message catalina stop server performs system exit which results tomcat shutdown think when service launcher stops tomcat catalina server null can used two use cases could improvements how stop tomcat call catalina stop case would better use wait 10000 instead sleep 10000 standard server await so could woken notify all call use interrupt call wake up we know thread system exit would work regardless all suppose jsvc may show same behaviour have tried using shutdown port windows service works prints error message
when file found error occurs does tell you which file caused error
http requires vary response header sent consistently all responses change based upon different aspects request my pages has both compressed uncompressed variants available negotiated accept encoding request header sends different vary headers each accept encoding when response compressed when can cause problems downstream caches because cannot consistently determine what cache key given uri my server xml content service name catalina connector port 8080 proxy port 80 max http header size 8192 protocol org apache coyote http11 max threads 200 min spare threads 25 max post size max spare threads 75 enable lookups false keep alive timeout 3000 max keep alive requests 100 redirect port 8443 accept count 100 connection timeout 8000 disable upload timeout true compression compression min size 2048 compressable mime type text html text xml text javascript text css engine name catalina default host localhost host name localhost app base webapps unpack wars false auto deploy false debug xml validation false xml namespace aware false host engine service tomcat doesn send vary consistently when gzip enabled
when running tomcat security manager access control exception thrown during undeployment stack trace caused java security access control exception access denied java lang runtime permission get class loader java security access control context check permission access control context java 323 java security access controller check permission access controller java 546 java lang security manager check permission security manager java 532 java lang class get class loader class java 594 org apache catalina loader jdbc leak prevention clear jdbc driver jdbc leak prevention java 49 assume default catalina policy should updated take case account access control exception when undeploying application
class coyote ajp constants contains public static non empty string arrays method trans array response trans array header trans array response trans array only appears locally so could made private others used index lookups so get index methods could used protect them coyote ajp constants constant arrays mutable
jstl support
backup manager used when primary node switched delta session primary session changed true non primary node changes primary node when primary node stopped we get non primary session primary node stopped primary node switched abstract replicated map when primary node switched map owner backup manager object made primay called however primary session does change true method backup manager object made primay public void object made primay object key object value value null value instanceof delta session delta session session delta session value synchronized session session access session end access we get non primary session primary node switched however primary session does change true only change primary node made patch contains following primary session set true backup manager object made primay when get called non primary node map owner object made primay called best regards when non primary node changes primary node primary session changed true
jmx descriptor
method based jndi env injections worked correctly patch attached see java ee section ee annotations injections patch provided solves problem wrong jndi name method resource injections
when using mssql has been noticed physical connections being closed when data source proxy close boolean all called method invokes org apache tomcat jdbc pool pooled connection disconnent which calls connection close however when used sqlserver connection attribute proxy object type com microsoft sqlserver jdbc sqlserver connection pool proxy which wraps physical connection type com microsoft sqlserver jdbc sqlserver connection calling close proxy object only notifies pool manager connection released back pool does close underlying physical connection what pooled connection disconnent currently reads private void disconnect boolean finalize discarded return set discarded true connection null try connection close catch exception ignore log debug enabled log debug unable close underlying sql connection ignore connection null xa connection null last connected finalize parent finalize logic changed following would properly closed xaconnection mssql private void disconnect boolean finalize discarded return set discarded true connection null try xa connection null xa connection close else connection close catch exception ignore log debug enabled log debug unable close underlying sql connection ignore connection null xa connection null last connected finalize parent finalize issue closing mssql
java lang unsupported operation exception get name method should never called
shutdown ajp connector do work
explanation several files have compile time generics related warnings displayed org apache tomcat util bcel classfile patch cleans up several those warnings correcting generics related compile warning org apache tomcat util bcel classfile files
constructor takes parent class loader has copy doc string from constructor does take parent class loader javadoc web app class loader constructor has copy paste error
externalize strings catalina base catalina home
sso cookies should made http only default org apache catalina base register 798 response add cookie cookie 798 response add cookie internal cookie true sso cookie should added http only
patch allow gzip output filter send partial result when flush buffer called
have two web applications neither declare realm context xml both configured web xml using standard tomcat methods have enabled tomcat valve host have added realm host well host name localhost app base webapps unpack wars true auto deploy true realm class name org apache catalina realm jaasrealm app name sso user class names role class names use context class loader false single sign valve share between web applications docs config valve html valve class name org apache catalina single sign access log processes all example docs config valve html valve class name org apache catalina valves access log valve directory logs prefix localhost access log suffix txt pattern common resolve hosts false have added jaas sso app jaas conf file server am certain realm jaas conf all configured properly web applications do require user authenticate before accessing application have one application still am required authenticate before accessing other application have exact same working tomcat environment identical operate tomcat server org apache catalina single sign valve does function
put jsp file jar file test whether tomcat supports viewing from browser failed fail access resources jsp files from jar file which supported servlet
jsp new element default content type under jsp property group works incorrectly tomcat trunk
method does validate class name described method validate classname per srv we must restrict loading classes from j2se java classes servlet api javax servlet webapp class loader validate name does validate javax servlet
patch generics warnings rawtypes
patch attached thanks correcting some generics related warnings
even set web xml servlet3 changed from true false annotation process jar context config process annotations follows context config process annotations protected void process annotations set web xml fragments web xml fragment fragments fragment metadata complete web xml annotations new web xml url url fragment get url process annotations url url annotations set web xml set new hash set web xml set add annotations merge annotations fragment fragment takes priority fragment merge set annotations created new web xml false default annotations merged fragment fragment becomes false because fragment merged web xml web application even set web xml changed from true false following necessary annotations set true best regards annotation process jar should impact web xml
expression factory impl create method expression el spec conform
100 sessions shared across nodes 25 active sessions per node delta manager reports 100 current sessions per node 25 active copies sessions from other nodes back manager reports 25 consistency should report 50 25 active sessions plus 25 so backed up node backup manager reports too few current sessions
request get attribute names slows down some applications
when starting new thread from start async runnable infinite amount do posts generated
remove last references removed parameter expires active fix expires filter docs remove remaining expires active reference
proposal port mod expires java expires filter servlet filter
ha session simple tcp replication manager start internal ignores exception when invoking thread sleep only needs ignore interrupted exception simple tcp replication manager start internal ignores exception
catalina loader webapp class loader start ignores exception however probably only needs ignore security exception loader webapp class loader start ignores exception
current ssi module all none all option expose all legacy apache ssi directive echo printenv exec documented allowing ssi allow execution arbitrary programs using exec result safe way expose sites projects containing ssi directive without taking security risk reviewing every file exec directive cmd option major risk even apache you have option allowing safe include include exec include exec allow pages served even when content reviewed when users allowed upload content site have big site which need converted jsp would like use ssi servlet allow transition over time extra risk from from exec cmd make impossible deploy ssi my request modify ssi follow default only allow safe directive exec cmd eliminate risk from arbitrary execution commands del also remove many potentail load problems cmd should only allowed using directive like allow unsafe exec which default false think change make easier use ssi feature without exposing server big risk risk associated safer version ssi similar risk from running jsp pages ssi servlet should support safe
make string manager fields final
add default char set filter adds default charset each request assumes iso 8859 default charset attached patch makes configurable introducing encoding parameter parameter can take one two special values default system every other value interpreted name character set utf meaning two special values follows default use iso 8859 value also used parameter specified empty system jvm asked default charset charset usually set system locale together functional change two minor changes one bigger changes hidden first use annotation override overriden methods second use keyword static response wrapper since has reference outer class third somewhat bigger change use http servlet response set character encoding encoding instead manipulating content type add encoding parameter add default char set filter
compression filter example should support http proxies cache gzipped content better sending vary accept encoding header
connectors do bind ports catalina load only later start
when setting absolute path default context xml context config context config cannot found
patch response class fix space deprecated white space
context correctly stopped shutdown
webapps deployed accessing url returns 200 ok content instead 404
environment tomcat beta ie8 simplest webapp only have test jsp below request get session get id app installed root context test jsp works fine firefox when using ie8 always different session id where refresh test page btw test jsp works find tomcat ie8 unabled store data http session root context
type exception report message description server encountered internal error prevented from fulfilling request exception javax servlet servlet exception javax management attribute found exception cannot find attribute start time org apache catalina deploy naming resources d1c778 org apache catalina manager status manager servlet do get status manager servlet java 292 javax servlet http http servlet service http servlet java 621 javax servlet http http servlet service http servlet java 722 root cause javax management attribute found exception cannot find attribute start time org apache catalina deploy naming resources d1c778 org apache tomcat util modeler managed bean get getter managed bean java 493 org apache tomcat util modeler base model mbean get attribute base model mbean java 180 com sun jmx interceptor default mbean server interceptor get attribute default mbean server interceptor java 666 com sun jmx mbeanserver jmx mbean server get attribute jmx mbean server java 638 org apache catalina manager status transformer write context status transformer java 656 org apache catalina manager status transformer write detailed state status transformer java 590 org apache catalina manager status manager servlet do get status manager servlet java 287 javax servlet http http servlet service http servlet java 621 javax servlet http http servlet service http servlet java 722 complete server status status all causes stack trace
cannot expire selected session manager webapp
remote ip valve remote ip header vs remote ipheader
after r889716 session id changed default change session id true delta manager doesn notify other cluster nodes therefore non primary node keeps having old session id can replicate change session attribute notified new session id workaround override change session id method notify change session id backup manager ok problem delta manager only best regards after session id changed session replication does work
static info properties appear contain legacy packages minor corrections info properties
memory leak protection stopping time threads should optional disabled default
context class reload tomcat fails lifecycle exception invalid lifecycle transition attempted before start component org apache catalina session persistent manager xxx state destroyed context class reload fails persistent manager
occurs tomcat rc3 26 using manager html deploy war test one its page should deployed properly stop webapp start webapp test one its page failure tomcat returns 404 notes using reload instead stop start ok does fix webapp present when tomcat started stop start works normally work around undeploy webapp redeploy webapp unavailable after deploy stop start
servlet ch says custom cookie name affects url rewriting
using jar scanner scan all directories true causes tomcat start
javax servlet http cookie set domain string pattern has following code domain pattern lower case result depends default locale would safer use fixed locale local english javax servlet http cookie set domain uses default charset
using jdbc pool version connect data source requiring unless explicitly set username password pool properties object empty string opposed leaving them null null pointer exception thrown lines 215 216 pooled connection connect using driver null pointer exception pooled connection when username password null
lower case upper case may work ok all locales
lower case upper case may work ok all locales
lower case upper case may work ok all locales
servlet container initializer startup set class class set expect class
context config check handles types throws class def found error which isn caught when class being analysed initialised class class references present classpath when mysql connector jar v5 scanned attempt load following class occurs com mchange v2 c3p0 query connection tester java lang class def found error com mchange v2 c3p0 query connection tester java lang class loader define class1 native method java lang class loader define class class loader java 698 java security secure class loader define class secure class loader java 124 java net urlclass loader define class urlclass loader java 260 java net urlclass loader access 000 urlclass loader java 56 java net urlclass loader run urlclass loader java 195 java security access controller do privileged native method java net urlclass loader find class urlclass loader java 188 java lang class loader load class class loader java 315 java lang class loader load class class loader java 250 java lang class loader load class internal class loader java 398 java lang class name0 native method java lang class name class java 247 also class name used here referencing webapp class loader instead calling webapp class loader load class directly error thrown during detection servlet container initializer
pool properties default value max idle integer max value default max active 100 results warning message being logged value max idle set match max active lines 393 394 connection pool default max idle should match max active shouldn see max idle max active message default props
you call data source factory parse pool properties method passing properties object suspect timeout property set key value pair never passed pool properties set suspect timeout method data source factory parse pool properties doesn look suspect timeout
field org apache tomcat util utils path separator should final util utils path separator should final
when dynamically adding filter name set when calling method add mapping url patterns application filter registration java java lang illegal argument exception filter mapping specifies unknown filter name null org apache catalina core standard context validate filter map standard context java 2650 org apache catalina core standard context add filter map before standard context java 2622 org apache catalina core application filter registration add mapping url patterns application filter registration java 102 org pidster tomcat test7 dyn test dynamics listener context initialized test dynamics listener java 105 filter name set when dynamically added
when dynamically adding filter context exception thrown java lang array index out bounds exception java lang system arraycopy native method org apache catalina core standard context add filter map before standard context java 2629 org apache catalina core application filter registration add mapping servlet names application filter registration java 75 index out bounds exception thrown when dynamically adding filter
jasper can load tld files through servlet context from jar file load tlds from jar file url jar file must passed however some environments osgi might easy provide url jar file would nice abstract way jasper looking up embedded tlds so different ways looking up tlds within jar files bundles whatever could used jar abstraction jasper
inefficient use key set iterator standard context java
incorrect lazy static field org apache catalina realm realm base md5helper org apache catalina session standard session session context org apache catalina startup tld config tld jars org apache catalina util extension validator container available extensions org apache tomcat util modeler modules mbeans descriptors digester source digester fields should probably all made volatile possible incorrect lazy
incorrect lazy update static fields org apache catalina startup bootstrap daemon org apache catalina startup context config context digester findbugs says method contains lazy static field after field set object stored location further updated accessed setting field visible other threads soon set futher accesses method set field serve initialize object you have very serious bug unless something else prevents any other thread from accessing stored object until fully initialized even you feel confident method never called multiple threads might better set static field until value you setting fully populated initialized incorrect lazy update static fields
junit test ignores failures threads
avoid raw type warning tag support
transmission duplicated session delta manager handle get all sessions
attached patch adds boolean attribute prestartmin spare threads executor element allows admin prestart minspare threads executor during start tomcat default value false which old behaviour patch executor xml can created interest committing patch add prestartmin spare threads attribute executor
naming factory send mail factory get object instance contains impossible cast from javax mail internet mime message javax mail internet mime part findbugs impossible cast naming factory send mail factory get object instance
backup manager start internal when constructor lazy replicated map throws exception sessions lazy replicated map actually abstract replicated map init has possibility throwing runtime exception backup manager stop internal class cast exception thrown because abstract replicated map breakdown executed regardless type sessions should changed follows avoid class cast exception skip sessions instanceof lazy replicated map lazy replicated map map lazy replicated map sessions map null map breakdown skip problem exists tomcat7 best regards class cast exception backup manager stop internal
backup manager stop internal follows protected synchronized void stop internal throws lifecycle exception super stop internal lazy replicated map map lazy replicated map sessions map null map breakdown cluster remove manager tomcat rc1 super stop internal called first standard manager stop internal super class session stored expire all active sessions storing session unnecessary backup manager when session expired session deleted from all cluster nodes result all primary sessions own node has deleted from all cluster nodes instance node1 session primary session proxy session backup node2 session backup session primary session proxy node3 session proxy session backup session primary node1 stopped becomes following node1 stopped node2 session primary session backup node3 session backup session primary session expired should following node1 stopped node2 session primary session primary session backup node3 session backup session backup session primary problem tomcat6 because executes super stop after lazy replicated map breakdown made patch against trunk best regards all primary sessions deleted backup manager stop internal
findbugs says method contains lazy non volatile static field because compiler processor may reorder instructions threads guaranteed see completely initialized object method can called multiple threads you can make field volatile correct problem digest md5helper possible incorrect lazy
inefficient use string loop
findbugs says bug org apache jasper runtime jsp factory impl page context pool needs static avoid deadly embrace org apache jasper runtime jsp factory impl local pool pattern id sic threadlocal deadly embrace type sic category correctness class inner class should probably static inner class serious danger deadly embrace between inner class thread local outer class because inner class isn static retains reference outer class thread local contains reference instance inner class inner outer instance both reachable eligible garbage collection runtime jsp factory impl page context pool needs static
catalina realm realm base authenticate string username byte credentials has following code return authenticate username credentials string looks wrong credentials byte array should probably return authenticate username new string credentials charset realm base authenticate uses string byte array
unused imports
javadoc corrections
fix up some raw types
missing annotations
currently mbean factory doesn have method creating new standard service mbean would become issue future enhancements jmx support tomcat per discussions mark enhancement suggested starting point possible future enhancements jmx support jmx enhancement provision mbean factory create standard service
catalina tribes io channel data use secure random uuid mutable public static field only used instance method so need static probably need public either could private field setter better final field set constructor channel data use secure random uuid public static mutable field
when session stored standard manager do unload method invalid session stored instance http session invalidate executed while executing standard manager do unload session valid false stored session valid false restored standard manager do load registers session map sessions however one can invalidate session valid false standard session invalidate standard session valid can expire session throws illegal state exception return immediately consequently session valid false never deleted from session map sessions made patch session already invalid expire session prevent memory leak best regards keiichi memory leak http session
addition javadoc servlet annotations
jasper tagplugins jstl util special characters mutable public static array used outside class far can tell so should made private util special characters should private
protected class user doesn check argument roles null
steps reproduce login tomcat manager application select web application has several sessions inactive more than minutes text field next expire sessions button print press expire sessions sample observed result ok session information application context path myapp default maximum session inactive interval 30 minutes minutes 16 sessions minutes sessions minutes sessions minutes sessions minutes sessions minutes sessions minutes sessions 10 minutes sessions minutes expired sessions actually some sessions were expired even above message prints expected result all sessions idle time minutes had expired bug following lines manager servlet sessions print writer string int lines 1176 1179 idle time idle 60 sessions expire idle patch would replace idle expired because idle time minutes submitted from web form expired counter timeout argument misprocessed when expiring sessions from tomcat manager
blank page dropped connection when running tc7 tcnative apr
add remote ip filter test case
enhance remote ip valve remote ip filter logging
think memory leak protection web app class loader clear references thread locals which detects clears thread locals would prevent gc web app class loader instance has issues regarding concurrency enumerates threads looks internal structures thread class memory barrier would ensure consistent state thread local map being examined so possible thread local thread properly cleaned up application current thread undeploying application does see up date state because between those threads much more severe after detecting leak invokes java lang thread local thread local map remove thread local thread thread local map instance invocation done thread thread undeploys app remove method thread safe all nor expunge stale entries method which may also invoked clear thread local map so webapp being undeployed while other applications continue receive heavy load requests could corrupt internal structures thread local map instance propose keep detection leaks make actual clearing optional disabled default avoid encountering big problems production idea improve clearing safe way thread provoking leak one tomcat worker threads we could mark dirty have background task would end threads renew those threads pool web app class loader clear thread local map concurrency issues
session listeners called cluster node start
two parts log warning info message tomcat ignores bundled context xml favour one catalina base engine name host name make extraction copying context xml configurable probably via new attribute extract xml host context xml expansion deployment improvements
cluster regression when replication fails once replication can never done again
you know jsp writer impl write method always invoked jsp file frequently found its performance poor because too many sub method were invoked well after copying two sub method code write method performance improved observably improve jsp writer impl performance inline sub method
tomcat breaks serving large files 8mb under high load high threading
jsp compilation context assumes tagfile path starting meta inf jars without checking
jndirealm java parsing roles correctly
seems bug least how tomcat handles error page tomcat 20 define my error page like web xml error page exception type java lang exception exception type location unexpected errors jsp location error page response has already been committed tomcat does system console feb 2010 59 04 pm org apache catalina core standard wrapper valve invoke severe servlet service servlet jsp threw exception java lang null pointer exception org apache jsp cpe jsp jsp service cpe jsp java 693 org apache jasper runtime http jsp base service http jsp base java 70 javax servlet http http servlet service http servlet java 717 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 374 org apache jasper servlet jsp servlet service jsp file jsp servlet java 342 org apache jasper servlet jsp servlet service jsp servlet java 267 javax servlet http http servlet service http servlet java 717 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 com expedience provisioning web servlet filters auth filter do filter auth filter java 133 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com expedience provisioning web servlet filters request volume filter do filter request volume filter java 141 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 com expedience provisioning web servlet filters startup check filter do filter startup check filter java 65 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 233 org apache catalina core standard context valve invoke standard context valve java 191 org apache catalina core standard host valve invoke standard host valve java 128 org apache catalina valves error report valve invoke error report valve java 102 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 293 org apache coyote http11 process java 849 org apache coyote http11 handler process java 583 org apache tomcat util net jio endpoint worker run jio endpoint java 454 java lang thread run thread java 619 feb 2010 59 04 pm org apache catalina core standard host valve custom severe exception processing error page exception type java lang exception location unexpected errors jsp java lang illegal state exception cannot reset buffer after response has been committed org apache catalina connector response reset buffer response java 691 org apache catalina core standard host valve custom standard host valve java 409 org apache catalina core standard host valve throwable standard host valve java 271 org apache catalina core standard host valve invoke standard host valve java 142 org apache catalina valves error report valve invoke error report valve java 102 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 293 org apache coyote http11 process java 849 org apache coyote http11 handler process java 583 org apache tomcat util net jio endpoint worker run jio endpoint java 454 java lang thread run thread java 619 doesn put any error text broken page page just shows how ever far got before encountered error behavior doesn seem correct seems like should least behave same way does when error page defined jsp page page error page unexpected errors jsp response has already been committed just appends error page onto end response ideal nothing else can done far know response has been committed clears buffer writes error page which looks nice pretty like should suggest error handling code error page defined web xml should check response has been committed try clear buffer already committed just append end same way jsp error handler does inconsistent error page behavior
jsp servlet wrapper get servlet context throws null pointer exception
24 access control exception protected function mapper first access certain jsp
22rc array index out bounds exception from jasper when compilation error inside cdata block
when overriding default servlet given application global xslt file path need relative tomcat root example init param param name global xslt file param name param value webapps quercus web inf listing xsl param value init param would nice path could relative application context global xslt file parameter default servlet
commented out security constraint commented out servlet tag add web xml mappings true jsp servlet servlet mapping tags placed incorrectly tomcat start due being inside comment basically seems web xml parsed correctly when using add web xml mappings you cannot have above tags commented out new servlet tags placed incorrectly comment tags respected add web xml mappings does place servlet tags correctly
directory contains file readable tomcat process eg file permissions dangling symlink tomcat throws null pointer exception returns 500 internal server error client throwing npe certainly wrong returning 500 further information unhelpful behavior should fixed generally interfaces type least list inaccessible files windows explorer unix ls bsd ftp client only return error when one attempts access file markt suggests alternative simply ignoring inaccessible files notes could cause issues user tries upload file name suggests better error reporting stack severe servlet service servlet webdav threw exception java lang null pointer exception org apache catalina servlets webdav servlet parse properties unknown source org apache catalina servlets webdav servlet do propfind unknown source org apache catalina servlets webdav servlet service unknown source javax servlet http http servlet service unknown source method parse properties java org apache catalina servlets webdav servlet java org npe happens when cache entry attributes null case find property my testing possibly other cases too following breadcrumbs via cache entry resources lookup cache path leads eventually java org apache naming resources file dir context java public attributes get attributes string name string attr ids throws naming exception building attribute list file file file name file null throw new naming exception sm get string resources found name protected file file string name file file new file base name file exists file can read do useful stuff else return null ouch web dav servlet returns 500 files readable
deploy task throws out memory errors when deploying large war files
have soak test constant load initially stable within hour ever increasing number blocked threads develops vast majority threads jsp rendering blocked jsp factory get default factory server eventually crashes we running java upon code inspection appears real reason get default factory set default factory setter called only once upon startup when sub class loads patching jar tried three other experiments removing synchronized keyword entirely locking inner static class instead jsp factory class using volatile static member variable both experiments showed vastly better stability able double throughput server without seeing increasing number blocked threads experiment yielded same behavior original code thus other code jsp factory class rather seem some sort contention java lang class monitor using volatile would preserve multi threading semantics while avoiding contributing instability issue unnecessary jsp factory get default factory contributes stability problems
improve binary stream processing webapp class loader find resource internal
remote ip valve examples refer connector package
code save method reads try fos new file output stream file get absolute path oos new object output stream new buffered output stream fos catch ioexception oos null oos can only null here try oos close catch ioexception ignore throw presumably catch statement should try close fos instead similarly load method line 280 281 code catch ioexception ois null however ois last object created try clause so must null probably code should check close bis fis end load method code says close input stream ois null however ois cannot null point note bugs were detected eclipse compiler catalina session file store save load close bugs
org apache catalina startup catalina incorrectly duplicates super class member
string cache use entry set rather than key set get
remote ip valve request secure request scheme forced false http forwarded proto http
remote ip filter request secure request scheme forced false http forwarded proto http
enc used public static string urldecode byte bytes string enc return urldecode bytes null false request util urldecode byte bytes string enc
null pointer exception jndirealm
set header does replace previous value server
tomcat juli logging files which can declared webapp web inf classes logging properties closed when webapp reloaded stopped even undeployed files last closed when tomcat shut down restarted also true normally used handler org apache juli file handler which opens new file every day closes old windows has following effects webapp undeployed files which open moment locked cannot deleted until tomcat someday stopped restarted webapp reloaded file opened second time so file has two open handles next day file handler closes one handle file kept locked through other handle cannot deleted every time webapp reloaded associated logfile opened again closed has consequence after reloading webapps few times tomcat must restarted from time time when tomcat shutdown unnecessary other open files closed get shutdown time modification time means any old log files receive current modification time which irritating steps verify windows example undeploy create examples webapp tomcat 20 examples web inf classes logging properties handlers org apache juli file handler org apache juli file handler level fine org apache juli file handler directory catalina base logs org apache juli file handler prefix servlet examples start tomcat undeploy examples using manager actual results file catalina base logs servlet examples date log cannot deleted nor next day expected file catalina base logs servlet examples date log can deleted very cumbersome workaround working reload get head method custom formatter extended track handlers along classloader webapp webapp different new classloader detected close method handlers assigned old classloader called so assigned file proper closed formatter get tail result appended have set severity minor because tomcat can used without webapp logging bug because logging same logfile can useless multiple open described above which should considered buggy juli webapp logging files closed when webapp stopped reloaded undeployed
some properties files non unique property keys normally should unique file java org apache catalina realm local strings properties duplicate key jaas realm user principal success jaas realm user principal success principal valid user class we use user principal jaas realm user principal success subject username returned user principal duplicate key jaas realm user principal failure jaas realm user principal failure valid user principal found jaas realm user principal failure subject username did return valid user principal file java org apache catalina realm local strings es properties duplicate key jaas realm user principal success jaas realm user principal success el principal es una clase u00e1lida de usuario la vamos usar como usuario principal jaas realm user principal success el asunto para el nombre de usuario devolvi u00f3 usuario principal duplicate key jaas realm user principal failure jaas realm user principal failure se ha hallado usuario principal jaas realm user principal failure el asunto para el nombre de usuario devolvi u00f3 un usuario principal u00e1lido file java org apache catalina startup local strings properties duplicate key context config jndi url context config jndi url connection created url dir context context config jndi url unable process jndi url annotations duplicate key web xml merge conflict filter web xml merge conflict filter servlet defined multiple fragments including fragment name located web xml merge conflict filter filter defined multiple fragments including fragment name located file java org apache jasper resources local strings properties duplicate key jsp error page invalid buffer jsp error page invalid buffer page directive invalid value buffer jsp error page invalid buffer page directive invalid buffer size duplicate key jsp error xml invalid high surrogate jsp error xml invalid high surrogate high surrogate bits utf sequence must exceed 0x10 found 0x jsp error xml invalid high surrogate high surrogate bits utf sequence must exceed 0x10 found 0x file java org apache jasper resources local strings es properties duplicate key jsp error page invalid buffer jsp error page invalid buffer directiva page valor incorrecto para u00fafer jsp error page invalid buffer directiva page valor incorrecto para buffer duplicate key jsp error xml invalid high surrogate jsp error xml invalid high surrogate los bits de surrogaci u00f3n alta en secuencai utf deben de exceder 0x10 pero se hall u00f3 0x jsp error xml invalid high surrogate surrogaci u00f3n alta de bits en secuencia utf debe de exceder 0x10 pero se hall u00f3 0x file java org apache jasper resources local strings ja properties duplicate key jsp error page invalid buffer jsp error page invalid buffer page u6307 u793a u5b50 buffer u5c5e u6027 u306e u5024 u304c u7121 u52b9 u3067 u3059 jsp error page invalid buffer page u6307 u793a u5b50 u7121 u52b9 u306a u30d0 u30c3 u30d5 u30a1 u30b5 u30a4 u30ba u3067 u3059 duplicate key jsp error xml invalid high surrogate jsp error xml invalid high surrogate utf u30b7 u30fc u30b1 u30f3 u30b9 u306e u30cf u30a4 u30b5 u30ed u30b2 u30fc u30c8 u30d3 u30c3 u30c8 u306f0x10 u3092 u8d8a u3048 u3066 u306f u3044 u3051 u307e u305b u3093 u304c u30010x u304c u898b u3064 u304b u308a u307e u3057 u305f jsp error xml invalid high surrogate utf u30b7 u30fc u30b1 u30f3 u30b9 u306e u30cf u30a4 u30b5 u30ed u30b2 u30fc u30c8 u30d3 u30c3 u30c8 u306f0x10 u3092 u8d8a u3048 u3066 u306f u3044 u3051 u307e u305b u3093 u304c u30010x u304c u898b u3064 u304b u308a u307e u3057 u305f file java org apache tomcat util net res local strings properties duplicate key endpoint poll fail endpoint poll fail socket poll event endpoint poll fail critical poller failure restarting poller file java org apache tomcat util net res local strings es properties duplicate key endpoint poll fail endpoint poll fail conector evento de encuesta endpoint poll fail fallo cr u00edtico de encuestador reiniciando encuestador file java org apache tomcat util net res local strings properties duplicate key endpoint poll fail endpoint poll fail socket poll event endpoint poll fail critical poller failure restarting poller file java org apache tomcat util net res local strings es properties duplicate key endpoint poll fail endpoint poll fail conector evento de encuesta endpoint poll fail fallo cr u00edtico de encuestador reiniciando encuestador duplicate property keys various files
suppress warnings unchecked document reduce scope
tomcat 20 something like following line jsp causes exception out value fn trim world after removing closing curly brace from literal world world jsp works behaviour seems specific 20 18 16 line above works fine example exception org apache jasper jasper exception exception occurred processing jsp page test jsp line 11 meta http equiv content type content text html charset utf head 10 body 11 out value fn trim world 12 body 13 html stacktrace org apache jasper servlet jsp servlet wrapper handle jsp exception jsp servlet wrapper java 505 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 416 org apache jasper servlet jsp servlet service jsp file jsp servlet java 342 org apache jasper servlet jsp servlet service jsp servlet java 267 javax servlet http http servlet service http servlet java 717 root cause javax el elexception error parsing fn trim world org apache el lang expression builder create node internal expression builder java 125 org apache el lang expression builder build expression builder java 150 org apache el lang expression builder create value expression expression builder java 194 org apache el expression factory impl create value expression expression factory impl java 68 org apache jasper runtime page context impl proprietary evaluate page context impl java 934 org apache jsp test jsp jspx meth 005fout 005f0 test jsp java 98 org apache jsp test jsp jsp service test jsp java 72 org apache jasper runtime http jsp base service http jsp base java 70 javax servlet http http servlet service http servlet java 717 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 374 org apache jasper servlet jsp servlet service jsp file jsp servlet java 342 org apache jasper servlet jsp servlet service jsp servlet java 267 javax servlet http http servlet service http servlet java 717 root cause org apache el parser parse exception encountered illegal character line column 11 expecting one integer literal floating point literal string literal true false null empty identifier org apache el parser elparser generate parse exception elparser java 2142 org apache el parser elparser jj consume token elparser java 2024 org apache el parser elparser function elparser java 1207 org apache el parser elparser non literal elparser java 1114 org apache el parser elparser value prefix elparser java 1016 org apache el parser elparser value elparser java 965 org apache el parser elparser unary elparser java 947 org apache el parser elparser elparser java 711 org apache el parser elparser math elparser java 631 org apache el parser elparser compare elparser java 443 org apache el parser elparser equality elparser java 337 org apache el parser elparser elparser java 281 org apache el parser elparser elparser java 225 org apache el parser elparser choice elparser java 182 org apache el parser elparser expression elparser java 174 org apache el parser elparser dynamic expression elparser java 146 org apache el parser elparser composite expression elparser java 43 org apache el lang expression builder create node internal expression builder java 93 org apache el lang expression builder build expression builder java 150 org apache el lang expression builder create value expression expression builder java 194 org apache el expression factory impl create value expression expression factory impl java 68 org apache jasper runtime page context impl proprietary evaluate page context impl java 934 org apache jsp test jsp jspx meth 005fout 005f0 test jsp java 98 org apache jsp test jsp jsp service test jsp java 72 org apache jasper runtime http jsp base service http jsp base java 70 javax servlet http http servlet service http servlet java 717 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 374 org apache jasper servlet jsp servlet service jsp file jsp servlet java 342 org apache jasper servlet jsp servlet service jsp servlet java 267 javax servlet http http servlet service http servlet java 717 closing curly brace literal string incorrectly treated expression terminator
currently connector mbeans registered unregistered connector classes themselves server lifecycle mbean utils also codes connector mbeans suppose used double check question codes creating connector object name same mbean utils always assume address property string type sometimes class cast exception would thrown keep same logic creating objectnames connector mbeans
implement header powered suggested servlet
support latest jsr245 proposal make el self contained
am encountering problem session does time out shorter than setting web xml simple scenario where problem occurs am using persistent manager following context manager class name org apache catalina session persistent manager max idle swap 120 store class name org apache catalina session file store manager context am setting session timeout five minutes session config session timeout session timeout session config scenario create session 120 seconds pass session does swap out addition 120 seconds pass get session session does swap access time session memory updated addition 90 seconds pass get session because access time session has been updated session should able acquired however session can acquired cause store base process expires invoked between store base process expire deletes session saved store store base process expires follows store base process expires public void process expires int keys length try standard session session standard session load keys session null continue session valid continue persistent manager base manager loaded keys recycle old backup session session recycle else expire swapped out session session expire remove session get id internal catch exception session saved store loaded standard session valid executed standard session expire true invoked session passes session time out standard session valid standard session expire true invokes manager remove session result session deleted from session map word session memory deleted invalidating old session store result session does time out shorter than setting web xml made patch against trunk best regards session does time out shorter than setting web xml when persistent manager used
bad file descriptor ioexception cgiservlet some programs
when context path empty tomcat startup file found exception
lock fields should final
persistent manager using filestore can return different session objects linked same session id when tomcat restarted
make remote ip filter parameters consistent remote ip valve
memory leak when using ssl java security manager
when tomcat receives post request session has timedout forward form based login page form login page forward fails some reason error login page instance tomcat return empty http response without any error code tomcat log says unexpected error forwarding login page contains detailed stacktrace would expect error show up browser well least 500 status empty response when forward login page fails
when call get clients method exception java lang array store exception java util hash map entry maybe method should public list client get clients return java util arrays list clients values array new client instead public list client get clients return java util arrays list clients entry set array new client can get clients from tomcat bayeux
log used org apache tomcat bayeux request publish request defined so class can complied successfully should something like private static final log log log factory get log publish request class publish request java can compiled
javadoc fixes connector request java
clustering fails serializing javax security auth subject see stack below looked little tomcat code java org apache catalina connector request java line 1752 tomcat puts javax security auth subject session you use memory user my case think must use because use rmi solution possible making memory user serializable putting session attribute mark thomas markt apache dot org suggested note session tomcat user mailinglist ve never seen notes sessions memory user comes from security constraint my web xml jul 2009 53 52 pm org apache catalina ha session delta session write object severe cannot serialize session attribute javax security auth subject session java io serializable exception org apache catalina users memory user java io object output stream write object0 object output stream java 1156 java io object output stream write object object output stream java 326 java util linked list write object linked list java 943 sun reflect generated method accessor216 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 java io object stream class invoke write object object stream class java 945 java io object output stream write serial data object output stream java 1461 java io object output stream write ordinary object object output stream java 1392 java io object output stream write object0 object output stream java 1150 java io object output stream access 300 object output stream java 143 java io object output stream put field impl write fields object output stream java 1668 java io object output stream write fields object output stream java 454 javax security auth subject secure set write object subject java 1281 sun reflect generated method accessor215 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 java io object stream class invoke write object object stream class java 945 java io object output stream write serial data object output stream java 1461 java io object output stream write ordinary object object output stream java 1392 java io object output stream write object0 object output stream java 1150 java io object output stream default write fields object output stream java 1509 java io object output stream default write object object output stream java 416 java util collections synchronized collection write object collections java 1602 sun reflect generated method accessor214 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 java io object stream class invoke write object object stream class java 945 java io object output stream write serial data object output stream java 1461 java io object output stream write ordinary object object output stream java 1392 java io object output stream write object0 object output stream java 1150 java io object output stream default write fields object output stream java 1509 java io object output stream default write object object output stream java 416 javax security auth subject write object subject java 919 sun reflect generated method accessor213 invoke unknown source sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 java io object stream class invoke write object object stream class java 945 java io object output stream write serial data object output stream java 1461 java io object output stream write ordinary object object output stream java 1392 java io object output stream write object0 object output stream java 1150 java io object output stream write object object output stream java 326 org apache catalina ha session delta session write object delta session java 714 org apache catalina ha session delta session write object data delta session java 475 org apache catalina ha session delta session write object data delta session java 472 org apache catalina ha session delta manager serialize sessions delta manager java 733 org apache catalina ha session delta manager send sessions delta manager java 1513 org apache catalina ha session delta manager handle get all sessions delta manager java 1479 org apache catalina ha session delta manager message received delta manager java 1310 org apache catalina ha session delta manager message data received delta manager java 1093 org apache catalina ha session cluster session listener message received cluster session listener java 87 org apache catalina ha tcp simple tcp cluster message received simple tcp cluster java 901 org apache catalina ha tcp simple tcp cluster message received simple tcp cluster java 882 org apache catalina tribes group group channel message received group channel java 269 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group interceptors tcp failure detector message received tcp failure detector java 110 org apache catalina tribes group channel interceptor base message received channel interceptor base java 79 org apache catalina tribes group channel coordinator message received channel coordinator java 241 org apache catalina tribes transport receiver base message data received receiver base java 225 org apache catalina tribes transport nio nio replication task drain channel nio replication task java 188 org apache catalina tribes transport nio nio replication task run nio replication task java 91 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 619 clustering fails serializing javax security auth subject
generics fixes
replicated context start throws null pointer exception
el support javadoc generics fixes
patch fix generics javax el package helpers
application context facade generics fixes
catalina core application filter factory match dispatcher filter map filter map dispatcher type type fails check type async extra case ought added don know what should contain so cannot provide patch application filter factory match dispatcher fails check async
possible npe org apache tomcat util modeler registry
patch fix generics javax packages
patch fix generics catalina
tld config keeps internal list application listeners
hex utils exposes public array
org apache catalina tribes group interceptors message dispatch interceptor run should volatile used communicate between running threads tribes group interceptors message dispatch interceptor run should volatile
org apache tomcat util net nio blocking selector block poller run should volatile used communicate between running threads org apache tomcat util net nio blocking selector block poller run volatile
below original destroy subcontext name name method public void destroy subcontext name name throws naming exception check writable while name empty name get length name name get suffix name empty throw new naming exception sm get string naming context invalid name naming entry entry naming entry bindings get name get entry null throw new name found exception sm get string naming context name bound name get name size entry type naming entry context context entry value unbind name get suffix else throw new naming exception sm get string naming context context expected else entry type naming entry context context entry value close bindings remove name get else throw new context exception sm get string naming context context expected however method invokes unbind method rather than invokes itself recursively name size entry type naming entry context context entry value unbind name get suffix else throw new naming exception sm get string naming context context expected should name size entry type naming entry context context entry value destroy subcontext name get suffix else throw new naming exception sm get string naming context context expected org apache naming naming context destroy subcontext method doesn invoke itself recursively invoke unbind method
domain does work membership domain filter interceptor
annotation doesn become effective metadata complete false effective
naming context listener fails add itself property change listener all naming resources
operating systems where dev urandom exists org apache catalina session manager base use source data get random bytes you stop context undeploy host number file descriptors have dev urandom open tomcat remains constant example you use manager application stop undeploy context number file descriptors dev urandom same before stop file descriptor use determined using lsof examining proc pid fd directory linux same issue seen you undeploy virtual host you undeploy deploy context remove add virtual host file descriptors dev urandom increase each time because manager base does close data input stream holds dev urandom patch shown below resolves issue stopping context undeploying virtual host close session manager reference dev urandom apache tomcat 28 src container catalina src share org apache catalina session manager base java 2009 07 24 13 35 00 000000000 0600 apache tomcat 28 gls container catalina src share org apache catalina session manager base java 2009 08 20 13 38 03 000000000 0600 688 10 688 17 public void destroy oname null registry get registry null null unregister component oname random null try random close catch ioexception ioe random null initialized false oname null don clear log since required case attributes changed eg via jmx whilst manager stopped manager base leaks fd dev urandom when context stopped
noticed only when running debugger breakpoint set stack overflow error error translated java reflection mechanism invocation target exception which caught silently ignored utils connector initialize sets jk home property http11nio protocol http11nio protocol sets jk home property nio endpoint nio endpoint recursively invokes its own set property method via utils set property causing stack overflow using embedded tomcat using nio connector does happen standard connector happens 18 20 haven tested earlier versions stack overflow error nio endpoint set property when setting jk home
org apache catalina core container base get logger synchronised yet all other methods which access org apache catalina core container base logger synch seems wrong org apache catalina core container base logger should probably private prevent unsynch access subclasses similar apply log name log name javadoc get logger states can return null does appear possible sure method ever returns parent logger either org apache catalina core container base get logger thread safe
jsp runtime context jsp reload count synchronised when updated when read get jsp reload count instance accessed from multiple threads returned value may current value could arbitrarily stale acceptable javadoc should say so otherwise getter needs synch field needs volatile just use atomic integer various other fields neither final nor synchronized classpath code source etc far can tell could easily made final only written constructor jsp runtime context synch problems
xbyte buffer privatize public fields fix javadoc
unused imports
loggers should final
public arrays should private
fields should final
loggers should final
org apache tomcat jni address apr anyaddr should final org apache tomcat jni address apr anyaddr should final
org apache catalina tribes io channel data empty data array should final org apache catalina tribes io channel data empty data array should final
java files don have al headers
some misspellings found javax servlet package
some misspellings found org apache coyote package org apache el package
some misspellings found org apache jasper package org apache juli package
some misspellings can find org apache naming package
some misspellings can find org apache tomcat package
javadoc fixes
tomcat javadoc unthrown exception fixes
some misspellings can find org apache catalina package
service ref factory class performs impossible null check service interface class line 238 237 class service interfaces service interface class get interfaces 238 service interface class null were null line 237 would generate npe service ref factory impossible null check service interface class
misspellings javadoc comment various classes package org apache core
add deprecated annotations deprecated elements
line 99 construct instance code rule set code default matching pattern prefix default fargment setting public web rule set fragment misspelled fargment line 614 rule check code login config code occuring only time within web xml final class set login config extends rule occurring misspelled occuring line 635 rule check code jsp config code occuring only time within web xml final class set jsp config extends rule occurring misspelled occuring line 656 rule check code session config code occuring only time within web xml final class set session config extends rule occurring misspelled occuring misspellings javadoc class org apache catalina startup web rule set
line 194 attribute value used turn off tld namespace awarenes private boolean tld namespace aware false awareness misspelled awarenes line 261 get server xml lt host gt attribute xml namespace aware return true namespace awarenes enabled public boolean get tld namespace aware return tld namespace aware awareness misspelled awarenes misspellings javadoc class org apache catalina startup tld config
line 50 construct set next rule specified method name param method name method name parent method call param param type java class parent method argument you wish use primitive type specify corresonding java wrapper class instead code java lang boolean code code boolean code parameter public set next naming rule string method name string param type misspelled corresonding one misspelling javadoc class org apache catalina startup set next naming rule
protected synchronized void stop line 1059 removing sercurity role security misspelled sercurity protected input source get web xml source string filename string path line 1354 param filename name file possibly one more leading path segemnts read param path location filename relative return segments misspelled segemnts two misspellings javadoc class org apache catalina startup context config
line 146 attribute value used turn off xml namespace awarenes protected boolean xml namespace aware false awareness misspelled awarenes line 268 get server xml lt host gt attribute xml namespace aware return true namespace awarenes enabled public boolean get xml namespace aware return xml namespace aware awareness misspelled awarenes line 366 has specified application been deployed note applications defined server xml have been deployed return code true code application has been deployed code false code applciation has been deployed does exist public boolean deployed string name application misspelled applciation line 1328 add new context managed us entry point admin webapp other jmx context controlers public void manage app context context controllers misspelled controlers line 1382 remove webapp from our control entry point admin webapp other jmx context controlers public void unmanage app string context path controllers misspelled controlers misspellings javadoc class org apache catalina startup host config
line 230 return true redirction standard streams enabled public boolean redirect streams return redirect streams redirection misspelled redirction line 875 initialize naming should only enable java env root naming tomcat embeded application already defines those shouldn do xxx should separated you may want enable java initial context reverse xxx can we guess lookup java something returned assume false xxx we have major problem current setting java url protected void init naming embedded mispelled embeded two misspellings javadoc class org apache catalina startup embeded
code cleanup patch removes some obsolete null checks
below javadoc class org apache catalina startup bootstrap boostrap loader catalina application constructs class loader use loading catalina internal classes accumulating all jar files found server directory under catalina home starts regular execution container purpose roundabout approach keep catalina internal classes any other classes depend xml parser out system class path therefore visible application level classes author craig mc clanahan author remy maucherat version revision 831860 date 2009 11 02 19 00 01 0800 mon 02 nov 2009 first word ommits letter sould bootstrap boostrap bootstrap misspelled boostrap javadoc class org apache catalina startup bootstrap
below javadoc class org apache catalina startup catalina startup shutdown shell program catalina following command line options recognized ul li config pathname set pathname file processed relative path specified interpreted relative directory pathname specified catalina base system property conf server xml li help display usage information li stop stop currently running instance catalina should do same thing embedded using server xml file author craig mc clanahan author remy maucherat version revision 752323 date 2009 03 11 08 46 54 0800 wed 11 mar 2009 however doesn allude nonmaing option start option below usage method same class print usage information application protected void usage system out println usage java org apache catalina startup catalina config pathname nonaming start stop complete either lacks help option javadoc class org apache catalina startup catalina complete usage method
string command start args length command args args length command equals startd args start daemon load args daemon start else command equals stopd args stop daemon stop should string command start args length command args args length command equals startd args args length start daemon load args daemon start else command equals stopd args args length stop daemon stop please refer following usage method org apache catalina startup catalina protected void usage system out println usage java org apache catalina startup catalina config pathname nonaming start stop org apache catalina startup bootstrap main method handles startd stopd wrongly
translation error messag when using template text
npe response contains null content encoding header
email exchange involved ranier see attachment he suggested log bugzilla so am using tomcat 20 windows xp sp3 latest java jvm do get method servlet trying see all request attributes see sendfile supported attribute set specifically request attribute org apache tomcat sendfile support my first pass just used http servlet request get attribute names dump all names attributes expecting see one listed got attributes listed all actually got attribute via get attribute org apache tomcat sendfile support which worked so get attribute names returning names all attributes so either get attribute names needs fixed return names all attributes code change tomcat doc needs updated some way say thatget attribute names only returns certain attributes blah blah doc change again my original email ranier reply attached thanks http servlet request get attribute names does return names all attributes
tomcat polls context xml files changes previously existing context xml missing instant tomcat polls application undeployed some text editors notably vi its derivatives create backup files renaming original file creating new file writing edited contents file therefore race condition small non zero probability user editing saving context xml using editor see webapp undeployed messages tomcat users indicate situation has occurred production server least once undoubtedly rare suggested fixes examine directory presence backup files context xml do undeploy one found even context xml missing horribly ugly makes semantics backup file very peculiar actually only way prevent race anything else only makes less likely heavily loaded system one where context xml being edited via network file share interval between old context xml being renamed new one being created may arbitrarily long only undeploy file missing period time discussion around period tomcat users mark thomas suggested polling again after 500ms suggested remembering state between polls only undeploying file missing two successive polls cleaner fix explain complete solution does remove possibility race aside may well similar issue where tomcat polls context xml being written finds has changed reads part written version mitigation files involved typically small may well written one very few operations however tomcat should probably assume any file change atomic editing context xml may cause unwanted undeploy webapp
jsp file name common headers jsp cotent example include file common headers jsp meta http equiv content type content text html charset utf meta http equiv cache control content store meta http equiv pragma content cache meta http equiv expires content link href css css css rel stylesheet type text css console output java lang stack overflow error java text date format format date format java 275 java text format format format java 140 java text message format subformat message format java 1288 java text message format format message format java 795 java util logging simple formatter format simple formatter java 50 java util logging stream handler publish stream handler java 179 java util logging console handler publish console handler java 88 java util logging logger log logger java 458 java util logging logger do log logger java 480 java util logging logger logp logger java 680 org apache juli logging direct jdklog log direct jdklog java 167 org apache juli logging direct jdklog error direct jdklog java 135 org apache jasper compiler jsp reader push file jsp reader java 606 org apache jasper compiler jsp reader init jsp reader java 141 org apache jasper compiler jsp reader init jsp reader java 119 org apache jasper compiler parser controller determine syntax encoding parser controller java 399 org apache jasper compiler parser controller do parse parser controller java 207 org apache jasper compiler parser controller parse parser controller java 137 org apache jasper compiler parser process include directive parser java 339 org apache jasper compiler parser parse include directive parser java 376 org apache jasper compiler parser parse directive parser java 484 org apache jasper compiler parser parse tag file directives parser java 1784 org apache jasper compiler parser parse parser java 127 exist 18 stack overflow error include
html pages should use get restart web apps
you receive rewritten url os uss unix mainframe tomcat does properly decode jsessionid portion url problem org apache catalina connector coyote adapter parse session id method two string object do specify encdoding use string sid new string uri bc get buffer start session id start semicolon2 session id start well second string method consequently os uses its default encoding which think ebcdic recompile hardcoded utf encoding jsessionid decodes properly am suggesting literally official fix string sid new string uri bc get buffer start session id start semicolon2 session id start utf decoding jsessionid bug os
cite address you attempt listen just port proper exception chaining following info currently lost java net bind exception cannot assign requested address java net plain socket impl socket bind native method java net plain socket impl bind plain socket impl java 359 java net server socket bind server socket java 319 java net server socket init server socket java 185 javax net ssl sslserver socket init sslserver socket java 106 com privasphere net ssl sslserver socket impl init sslserver socket impl java 106 com privasphere net ssl sslserver socket factory impl create server socket sslserver socket factory impl java 71 org apache tomcat util net jsse jssesocket factory create socket jssesocket factory java 100 org apache tomcat util net pool tcp endpoint init endpoint pool tcp endpoint java 295 org apache coyote http11 http11base protocol init http11base protocol java 139 org apache catalina connector connector initialize connector java 1017 org apache catalina core standard service initialize standard service java 578 provide better insight bind exception cannot assign requested address
seems webapp class loader stopped noformat caused java lang null pointer exception org apache catalina loader webapp class loader find resources webapp class loader java 994 java lang class loader get resources class loader java 1016 noformat all did launch server add context ask load resource from its classpath bit more complicated than so ll try narrow down needed null pointer exception embedded tomcat
wrong argument redirect path set chars mapper internal map wrapper
when displaying thread pools status manager servlet ignores executors uses standard thread pool information each connector causes incorrect information displayed when connector configured use executor related topic appears connector executor link exposed via jmx which need fix manager ignores executors status pages
when part webapp requires ssl connection client certificate should ssl request client certificate from browser added webapp already uses ssl connector login config id login config auth method client cert auth method realm name wps realm name login config security constraint id security constraint web resource collection id web resource collection web resource name url pattern login cert do url pattern http method delete http method http method get http method http method post http method http method put http method http method head http method web resource collection user data constraint id user data constraint transport guarantee confidential transport guarantee user data constraint security constraint requests login cert do require ssl connection isn one client certificate requested ssl does occur when resource client cert auth requested
change tomcat set silent set silent boolean nicer clients have java bean type setter doesn seem make sense you can set something unset change tomcat set silent set silent boolean
why static add servlet methods tomcat static can see don use any state from instance isn cleaner use instance method so api uniform everything want do tomcat instance goes through instance would more consistent follow pattern add servlet string string string search context name instead requiring instance passed static method static utility methods tomcat should instance methods
local repository boolean replace false string before repository while repository index catalina home token replace true repository repository substring get catalina home repository substring catalina home token length else repository get catalina home repository substring catalina home token length while repository index catalina base token replace true repository repository substring get catalina base repository substring catalina base token length else repository get catalina base repository substring catalina base token length replace log debug enabled log debug expanded before replace last line should log debug expanded before repository logging statement error org apache catalina startup bootstrap java
received arithmetic exception zero when expiring sessions via tomcat manager webapp exception thrown only session timeout set webapp web xml moreover exception also thrown regardless idle parameter value expire path xxx idle mm long session timeout result exception stacktrace error 19 08 2009 00 18 22 http 80 exec 33 org apache catalina core application context 669 htmlmanager manager servlet sessions contextpath java lang arithmetic exception zero org apache catalina manager manager servlet sessions manager servlet java 1133 org apache catalina manager htmlmanager servlet sessions htmlmanager servlet java 573 org apache catalina manager htmlmanager servlet expire sessions htmlmanager servlet java 660 org apache catalina manager htmlmanager servlet do get htmlmanager servlet java 118 org apache catalina manager htmlmanager servlet do post htmlmanager servlet java 157 javax servlet http http servlet service http servlet java 637 javax servlet http http servlet service http servlet java 717 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 233 org apache catalina core standard context valve invoke standard context valve java 191 org apache catalina base invoke base java 525 org apache catalina core standard host valve invoke standard host valve java 128 org apache catalina valves error report valve invoke error report valve java 102 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 286 org apache coyote http11 http11nio processor process http11nio processor java 880 org apache coyote http11 http11nio protocol handler process http11nio protocol java 719 org apache tomcat util net nio endpoint socket processor run nio endpoint java 2081 java util concurrent thread pool executor worker run task thread pool executor java 886 java util concurrent thread pool executor worker run thread pool executor java 908 java lang thread run thread java 619 arithmetic exception zero when expiring sessions via manager
web applications use servlet mapping welcome file ignored server returns either directory listing 404 listing disabled have jsf servlet defined servlet mapping jsf go faces servlet have index jsf listed welcome file get 404 directory listing disabled also have custom servlet defined its mapping set welcome file its mapping get 404 well welcome file ignores servlet mapping
patch fix unsafe public string array abstract create statement interceptor
fix occasional test failure test concurrency
files fair blocking queue java multi lock fair blocking queue java use throws unsupported operation should throws unsupported operation exception javadoc errors exception name misspelt
some test cases test tomcat start tomcat server creates directory tree tomcat 8080 work which deleted when test finishes test cases do clear up afterwards
test tomcat set up creates work directory does delete tear down test tomcat fails delete work directory
unable use nested type tld
tomcat don remember last rev number my current machine when log4j classpath web app configured log debug level jasper dumps whole http post request body debug traces consumes http servlet request input stream which arrives unusable user beginning jsp code using http servlet request get input stream stream already its end workaround disable debug traces japser class log4j properties jasper should consume http servlet request input stream whatever mode runs jasper log4j web app classpath debug level enabled prevents reading http post stream from jsp
appears valve interface javadoc hasn been updated since around tc here snip what currently available from tc website 20 would guess response generated control returned call next valve pipeline one executing context invoke next modify http headers included response after invoke next method has returned perform any actions output stream associated specified response after invoke next method has returned invoke next method has existed valve interface many versions believe replacement get next invoke request response happy provide doc patch get next invoke request response expected replacement invoke next request response note docs also have same problem please let me know should log separately valve interface javadocs invoke method references non existent method
when web app class loader stops manually sets all static final variables null clear references method results npes any thread stopped expecting its final static variables null particularly problem hot deploys since unload fails terminating deploy web app class loader clear references code break running threads
cluster nodes being load balanced sticky sessions particular node becomes unavailable any sessions bound node must particularly case mod jk sessions bound whichever node failover occurred because jessionid still contain jvm route original failed node thus placing session state losing sticky properties am attaching patch trigger session rebind itself new node jvmroutes don match replace jessionid browser cookie sticky sessions using persistent manager enter state node failover
tomcat can replicate session when started
public void expire boolean notify mark session being expired needed expiring return man land here synchronized manager null return expiring true potential syncro problem standard session expire boolean
mcast service impl executor dispatching events
issue custom jaas login module logout method never called guess has been never implemented correctly least since tomcat thing according jaas spec login context logout supposed invoke logout method each login module configured login context so somebody should sure call login context logout method caller method could either server client so either tomcat should provide some means access login context clients tomcat should take call method itself guess solution could tomcat associate instance login context user session tomcat could invoke login context logout when session being invalidated both when session times out invalidated explicitely hope am correctly interpreting jaas spec jaas contract login module broken
delta session ignores notify listeners replication when backup manager used
bugs tomcat
using jndirealm authenticate open ldap 28 within open ldap ve configured user password attribute each user contain md5 digest each prefixed string md5 am ldap expert any means believe prefix standard convention anyway assuming convention jndirealm needs strip off md5 portion much like does sha1 see attached patch which accomplishes verified works my environment jndirealm java able handle md5 password
some test cases assume jdbc provider supports select valid sql statement however always case derby requires table name select from solution provided patches use validation query defined properties set up test rather than always using select remove db specific sql statements from test cases select
pooled connection connect fails check null return from java sql driver connect method can result npe when connection used later pooled connection connect fails check null connection
patch adds additional entries catalina policy file specifically catalina base shared directory added given equal permissions catalina home common java io tmpdir now readable javax servlet context tempdir now readable think compliant spec must allowed directory specified java io tmpdir which what tomcat points javax servlet context tempdir now read write delete again think spec requires additional entries default catalina policy file
cannot join cluster membership
delta manager doesn do session replication notify session listeners replication false
delta request never reset use backup manager
fails re deploying when we update context xml
standard session fire container event checks string class name why just use instanceof check here cannot override standard context embedding case because standard session fire container event
think access log valve has race condition problem
code around line 1075 else action code action code action req local addr attribute local addr null local addr socket get local address get host address fails check socket null since checked everywhere else method probably bug method parse host also references socket without checking null within class only called process socket which guarantees won null however once process returns normally socket set null parse host method public so may called when socket null perhaps parse host method should private possible npe action
hi using tribes cluster module my own application which has nothing do tomcat using member alive time value sort all cluster members bug produces following have nodes were started almost same time both nodes claim other node started before them node1 remote members 52 63 57 110 4001 ready true suspect false failing false alive time 1526 local member 52 63 57 109 4000 ready true suspect false failing false alive time 1236 node2 remote members 52 63 57 109 4000 ready true suspect false failing false alive time 2021 local member 52 63 57 110 4001 ready true suspect false failing false alive time 1069 my code do following member members group channel get members print remote members member local member group channel get local member true print local local member code due timing issues should possible other way around every node claim started before other case issue occurs because when mcast service started assigns start time local member public class mcast service public void start int level local member set service start time system current time millis impl new mcast service impl local member impl start level creates starts mcast service impl which also stores new service start time public class mcast service impl protected long service start time public void start int level service start time system current time millis so we have different start times both times used get local member impl get service start time used public class mcast service public member get local member boolean alive alive local member null impl null local member set member alive time system current time millis impl get service start time return local member when member transmited throw network member impl get service start time used public class member impl public byte get data boolean getalive boolean reset reset data pkg null look cache first data pkg null getalive you surprised system current time millis shows up profiler long alive system current time millis get service start time xbyte buffer bytes long alive data pkg tribes mbr begin length return data pkg produces weird behaviour imho fix should setting same service start time both components issue affecting seriously my code would appreciate you could fix asap ve verified same code present trunk repository regards ariel service start time different member impl from mcast service impl
do caching resources like docu say string manager
standard host valve status html escapes error message
shutdown does unregister all mbeans
nested groups jndi realm non recursive
javax servlet http http session methods get attribute get value get attribute names get value names etc throw illegal state exception called session has been invalidated so following code jsp page session invalidate object obj page context find attribute foo illegal state exception thrown because page context find attribute eventually calls session get attribute session has been invalidated session has been invalidated should simply ignored when method needs process various scopes page request session application impacts following methods page context impl public int get attributes scope final string name which calls private int do get attribute scope string name public object find attribute final string name which calls private object do find attribute string name public void remove attribute final string name which calls private void do remove attribute string name fix catch illegal state exception ignore when processing attribute session scope code simply follows through process application scope need worry about set attribute because always invoked specific scope spec already states java lang illegal state exception must thrown when called invalidated session page context set attribute foo value foo page context session scope java lang illegal state exception scope page context session scope page requested does participate session session has been invalidated same time fix should done method do remove attribute string name where try catch block exception appears unnecessary private void do remove attribute string name try remove attribute name page scope remove attribute name request scope session null try remove attribute name session scope catch illegal state exception ex session has been invalidated ignore fall through application scope remove attribute name application scope catch exception ex we remove much we can simply ignore possible exceptions here full analysis starting remove attribute final string name we check null throw npe necessary we call do remove attribute name do remove attribute name we call remove attribute name scope each scope remove attribute final string name final int scope calls do remove attribute name scope do remove attribute name scope page scope attributes remove won throw exception request scope request remove attribute documented exception thrown session scope throws illegal state exception session null app scope context remove attribute documented exception thrown null value name already checked remove attribute final string name we throw npe so situation removing attr from page request scope throwing npe won happen do remove attribute name we already check session null before calling remove attribute name session scope so normally illegal state exception thrown except invalidated case when removing attribute from application servlet context scope any registered listeners notified code does see appserv webtier src java org apache catalina core application context remove attribute already catches any throwable listener may throw try catch block therefore unnecessary moreover any removal actions from different scopes could have thrown exception each them would have needed wrapped inside own try catch so ensure exception one scope does cause any subsequent removals bypassed do remove attribute string name has therefore been modified follows private void do remove attribute string name remove attribute name page scope remove attribute name request scope session null try remove attribute name session scope catch illegal state exception ex session has been invalidated ignore fall through application scope remove attribute name application scope changes done glassfish ymmv jasper diffs page context impl java dec 2005 18 54 30 0000 page context impl java 16 dec 2005 00 11 21 0000 452 452 13 return request scope session null try session get attribute name null return session scope catch illegal state exception ex session has been invalidated ignore fall through application scope context get attribute name null 495 500 14 return session null try session get attribute name null return catch illegal state exception ex session has been invalidated ignore fall through application scope null return return context get attribute name 559 19 569 18 private void do remove attribute string name try remove attribute name page scope remove attribute name request scope session null try remove attribute name session scope catch illegal state exception ex session has been invalidated ignore fall through application scope remove attribute name application scope catch exception ex we remove much we can simply ignore possible exceptions remove attribute name application scope public jsp writer get out invalidated session causes page context methods fail
jsp compiled startup when used servlet
active directory can respond query search result relative we discovered happening directory hosted across many servers when user base sufficient identify single server get user search jndirealm assumes search result relative goes about creating dn user appending together various bits names gets back definitely wrong absolute names which url form ldap server encoded user dn discovered issue tomcat cursory look svn repo tomcat reveals bug also present have patch issue which attach patch jndirealm fails parse absolute names
limit buffer setting causes arraycopy errors
server incorrectly reports 501 error bad method name should report 400 error
org apache catalina loader webapp class loader throws exception related java bug 6434149
jsp plugin type applet generates type application java applet instead type application java applet firefox java plugin cannot display java applets because added jsp plugin error
shtml files locked when using windows closing reader solves problem reader closed
small fix task thread factory
small fix task queue
use jk module submit some data post method bytes received always show zero see source file jk coyote handler java inovke method public int invoke msg msg msg context ep throws ioexception ep log time enabled ep set long msg context timer pre request system current time millis request req ep get request response res req get response log debug enabled log debug invoke req res req request uri string res set note ep note ep ep set status msg context jk status head request info rp req get request processor rp set stage constants stage service try adapter service req res catch exception ex log info error servicing request req ex ep get status msg context jk status closed res finish req recycle req update counters see line res recycle ep recycle ep get status msg context jk status error return error ep set status msg context jk status new rp set stage constants stage keepalive return ok request object recycled byte read property must set zero next line begin update counters may bug bytes received problem
synchronize target can changed midway
jmxaccessor task string constants should final
various public string arrays org apache jasper constants although array variables final any code can change any array constants org apache jasper constants public arrays mutable
some platforms os sure device file dev urandom can pass exists test throws ioexception some kind when trying open current code manager base set random file doesn handle which results every call get random try again log error failed close random following changes method add proper error handling correct my changes marked kjw public void set random file string hack you can use static file genarate same session ids good strange debugging globals security enabled random data input stream access controller do privileged new privileged set random file else try dev random source file new file dev random source exists return random new data input stream new file input stream random read long log debug enabled log debug opening dev random source catch ioexception ex log debug error reading dev random source ex kjw random null kjw opened try random close catch exception log warn failed close random kjw dev random source null kjw don try again random null manager base set random file error handling fix
manager xml interface hard coded path xsl
using java string manager
problem access log valve tc5 well tc6 all platforms system clock my linux machine ubuntu my case just before us time change march started tomcat see following messages my tomcat access log after accessing tomcat jsp example pages time dst transition 08 mar 2009 01 56 20 0700 get jsp examples jsp2 simpletag book jsp http 200 1738 http 8080 processor24 08 mar 2009 03 01 22 0700 get jsp examples jsp2 tagfiles hello jsp http 200 2213 68 http 8080 processor25 note offset 0700 both before after dst transition following tomcat restart offset correct 08 mar 2009 03 19 42 0600 get jsp examples jsp2 jspx basic jspx http 200 1919 780 http 8080 processor25 08 mar 2009 03 19 59 0600 get jsp examples jsp2 jspx svgexample html http 200 2239 http 8080 processor25 08 mar 2009 03 19 59 0600 get jsp examples jsp2 jspx text rotate jpg http 200 26729 http 8080 processor25 btw ran tzupdater before my tests linwin01 512 java jar tzupdater jar tzupdater version 12 b01 jre time zone data version tzdata2009a embedded time zone data version tzdata2009a problem org apache catalina valves access log valve which contains following its start method initialize time zone date formatters current date timezone time zone get default time zone dst calculate time zone offset timezone get raw offset calendar calendar calendar get instance timezone int offset calendar get calendar dst offset time zone dst calculate time zone offset timezone get raw offset offset based what ive seen int offset calendar get calendar dst offset returns when current time daylight savings time my timezone 3600000 60 60 1000 when current time daylight savings looks like code assumes always offset daylight savings current timezone have idea some locations timezones where daylight savings time does have hour offset because non dst time period time zone dst time zone dst set same value dst time period believe set correctly so transition autumn works correctly think only problem when moving ahead springtime unless software has been running months so which caused offset set correctly access log valve reports correct time incorrect offset following spring dst transition
problem jsp init method called twice definition jsp background compilations enable default web xml define check interval define development false define jsp servlet load startup tag web xml proposing org apache jasper compiler compiler java public void compile boolean compile class boolean jspc mode throws file found exception jasper exception exception compile class file target file new file ctxt get class file name target file exists long target last modified target file last modified jsw null jsw set servlet class last modified time target last modified last method regards yuichiro jsp init method called twice
avoid redundant standard context
fgrep new random system current time millis gives places where random initialized seed current time millis unnecessary because better seed happens default random constructor seed from current time useless
when calling invalidate valid http session object comet connection manager valve methods session destroy http session event se event request request response response comet event event called concurrently so either comet event event type end event sub type session end never signaled via session destroyed http session object has become invalid attribute holding comet requests can set removed via event have configured comet connection manager valve valve element context xml also listener element my applications web xml see stacktrace session destroy bit faster exception error occurred container during request processing java lang illegal state exception remove attribute session already invalidated org apache catalina session standard session remove attribute standard session java 1206 org apache catalina session standard session remove attribute standard session java 1181 org apache catalina session standard session facade remove attribute standard session facade java 140 org apache catalina valves comet connection manager valve event comet connection manager valve java 335 org apache catalina core standard host valve event standard host valve java 179 org apache catalina valves valve base event valve base java 200 org apache catalina core standard engine valve event standard engine valve java 128 org apache catalina connector coyote adapter event coyote adapter java 198 org apache coyote http11 http11nio processor event http11nio processor java 750 org apache coyote http11 http11nio protocol handler event http11nio protocol java 653 org apache tomcat util net nio endpoint socket processor run nio endpoint java 2081 java util concurrent thread pool executor worker run task thread pool executor java 885 java util concurrent thread pool executor worker run thread pool executor java 907 java lang thread run thread java 637 comet connection manager valve concurrent access session object when calling http session invalidate
java while started error keep alive parsing request header try disable upload timeout kept alive keep alive timeout socket set so timeout keep alive timeout else so timeout socket set so timeout so timeout input buffer parse request line request set start time system current time millis kept alive true disable upload timeout socket set so timeout timeout disable upload timeout flag allows servlet container use different longer connection timeout while servlet being executed which end allows either servlet longer amount time complete its execution longer timeout during data upload specified attribute set true code above waiting new http request precedes servlet processing logic seems odd me must set disable timeout false get my keep alive timeout set set must implicitely enable upload timeout whether need seems me disable timeout unneccessary following line disable upload timeout kept alive do you agree thanks insight why disable upload timeout keep alive timeout correlated http11 connector
following files tomcat trunk don have al headers far can tell should modules jdbc pool sign sh modules jdbc pool test org apache tomcat jdbc test starvation test java missing al headers
when options http request made tomcat directory has default file like index jsp tomcat reports full list allowed verbs when fact most them allowed example request generic img directory options img http cookie jsessionid content length accept accept language en us connection keep alive user agent mozilla compatible msie windows nt sv1 net clr 4322 info path returns http 200 ok server apache coyote allow get head post put delete trace options content length date mon 24 apr 2006 15 11 16 gmt connection close which shows several destructive options available put delete request delete put correctly returns 403 forbidden result delete img http cookie jsessionid content length accept accept language en us connection keep alive user agent mozilla compatible msie windows nt sv1 net clr 4322 info path returns http 403 forbidden server apache coyote content type text html charset utf content length 964 date mon 24 apr 2006 15 12 31 gmt connection close because initial options request returns list containing dangerous verbs directory flagged serious security most scanners false positive issue does occur when directory has default file options user management http cookie jsessionid content length accept accept language en us connection keep alive user agent mozilla compatible msie windows nt sv1 net clr 4322 info path returns http 200 ok server apache coyote set cookie jsessionid path content type text html charset iso 8859 date mon 24 apr 2006 15 14 27 gmt connection close options request directory default file reports incorrect list allowed http verbs
doc base path contains webapps backslash inserted
server xml set client auth want tomcat user xml create role user ssl certificate metadata web xml private url my webseite create security constraint like one security constraint web resource collection web resource name app web resource name url pattern protected jsp url pattern web resource collection auth constraint role name tomcat role name auth constraint user data constraint transport guarantee confidential transport guarantee user data constraint security constraint login config auth method client cert auth method login config security role role name tomcat role name security role my results try access restricted jsp page when right client certificate browser keystore works when wrong client certificate get http status 401 cannot authenticate provided credentials ok too when client certificate get http status 400 client certificate chain request 400 usually stands bad request bad syntax bug case expect get http status 401 wrong http code failed client cert
taglib pool bug when tag used jsp attribute
webdav servlet
tagx files don compile document page encoding casing differs
compiled tag files from different tag libraries share same package
jspwiki jsp compilation prevented org apache jasper constants jsp package name
jdbcrealm open throws null pointer exception specified driver doesn handle specified jdbc url
context 2f name causes tomcat crash shutdown several years ago worked integrating tomcat our web application management during process fixed several tomcat bugs apparently never sent fixes upstream oops our application needs deployed create url looks like product customername servlet worked several people irc get tomcat5 do we had previously been using path parameter context xml file element tomcat appears feature removed from tomcat5 tomcat5 does recurse when reading xml context files irc after several suggestions which would work our environment put 2f context xml file name product xml does work however when you try shutdown tomcat 18 you get crash nov 2008 10 56 17 pm org apache coyote http11 pause info pausing coyote http http 8180 nov 2008 10 56 18 pm org apache catalina core standard service stop info stopping service catalina nov 2008 10 56 18 pm org apache catalina startup host config undeploy apps warning error while removing context product java lang null pointer exception org apache catalina core container base remove child container base java 915 org apache catalina startup host config undeploy apps host config java 1191 org apache catalina startup host config stop host config java 1162 org apache catalina startup host config lifecycle event host config java 313 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 117 org apache catalina core container base stop container base java 1086 org apache catalina core container base stop container base java 1098 org apache catalina core standard engine stop standard engine java 448 org apache catalina core standard service stop standard service java 584 org apache catalina core standard server stop standard server java 744 org apache catalina startup catalina stop catalina java 628 org apache catalina startup catalina catalina shutdown hook run catalina java 671 nov 2008 10 56 18 pm org apache coyote http11 destroy info stopping coyote http http 8180 context 2f name causes tomcat crash shutdown
coerce el expression java lang object breaks expression
farm war deployer has following code line 152 econtainer null econtainer instanceof engine clearly something wrong condition farm war deployer has nonsense condition
potential memory leak tag handlers jsp id consumer
persistent cookies written 18 do work internet explorer safari
case privileged action exception thrown private static void execute final method method final object target object final object target arguments principal principal method false assumption catch block privileged action exception get exception return invocation target exception could also illegal access exception possibly other types exceptions well here stack trace provoked catalina shutdown when enabled security manager java lang class cast exception java lang illegal access exception cannot cast java lang reflect invocation target exception org apache catalina security security util execute security util java 278 org apache catalina security security util do privilege security util java 218 org apache catalina security security util do privilege security util java 178 org apache catalina core application filter config release application filter config java 326 org apache catalina core standard context filter stop standard context java 3744 org apache catalina core standard context stop standard context java 4513 org apache catalina core container base remove child container base java 924 org apache catalina startup host config undeploy apps host config java 1191 org apache catalina startup host config stop host config java 1162 org apache catalina startup host config lifecycle event host config java 313 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 117 org apache catalina core container base stop container base java 1086 org apache catalina core container base stop container base java 1098 org apache catalina core standard engine stop standard engine java 448 org apache catalina core standard service stop standard service java 584 org apache catalina core standard server stop standard server java 744 org apache catalina startup catalina stop catalina java 628 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap stop bootstrap java 300 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache commons daemon support daemon loader stop daemon loader java 200 invalid cast security util
svn property patches
iterator from javax el composite elresolver get feature descriptor must return null values
addendum version 13 available combobox above scenario menu decribed tree structure rendering menu done tagfile render menuitem which renders current item either leaf item clicking causes action node item clicking opens another next level submenu rendering submenu done calling tagfile again from within its body worked fine tomcat make clear see following pseudo code original code voluminous tagfile render menuitem tagx jsp root jsp directive attribute name menu item choose when test menu item node div node menu item label div each var sub item items menu item children going cause problem tomcat6 tags render menuitem menu item sub item each when otherwise div leaf menu item label div otherwise choose jsp root faulty behaviour tomcat 13 generated java source tagfile reveals body do tag method empty therefore emits html compilation itself silently done error warning shown logfiles jsp generation error recursive tagfile structure
add host alias using jmx doesn take affect until restart
context path application contains slashes method get path without context class org apache catalina ssi ssiservlet external resolver simply cuts from second slash so url do tries include do instead do patch include context path strip path off line 419 string context get path without context norm context get context path normalized line 356ff protected string get path without context final string context path final string servlet path servlet path starts context path return servlet path substring context path length return servlet path ssi virtual include broken context path slashes
cannot access principal via subject get subject access controller get context problem method internal do filter application filter chain call filter chain code determinate principal don use globals security enabled final servlet request req request final servlet response res response principal principal http servlet request req get user principal object args new object req res security util do privilege do filter filter class type args args null else manner security util do privilege called principal null method execute create subject principals call subject do privileged subject pea null do propagate principals obtain subject without principals calling subject get subject access controller get context attachment we send our solution cannot access principal via subject get subject access controller get context
issue when using include directive inside tag files inside jar files
create servlet does following response set header bug value response send error http servlet response sc bad request use tomcat default error page 400 responses response contain header bug value value however create custom error page response headers do contain bug header response here my web xml example error page error code 400 error code location 400 jsp location error page 400 jsp contains plain html html body h3 custom 400 error page h3 body html extra response headers sent when using custom error page
servlet response writer does respect line separator system property
how reproduce bug configure tomcat connector uriencoding utf attribute make simple page write out any request parameter configure page protected form based try access page site page jsp xx yy zz tt where xx yy zz value utf charset when page being accessed first time after parameter incorrectly interpreted seems iso8859 anything else utf subsequent access same uri site page jsp xx yy zz tt gives perfect result also tried use boby encoding uri true request set character encoding utf nothing changed uriencoding doesn affect after form redirect
default file item class pacakge org apache tomcat util http fileupload creates byte array output stream full threshold size every control submitted form have form 63 controls checkboxes text boxes one file input set threshold 20 meg allow upload large image files memory get out memory exception since tries allocate 63 lots 20m although only control requires requested size think would much more sensible create byte array output stream initial size only few kilobytes size increases its size data written file upload memory usage
session incorrectly expired due thread unsafe code
tomcat running security manager jsp uses page context forward default annotation processor code can called untristed code call stack process annotations method contains line field fields instance get class get declared fields get declared fields subject security checks so throws java security access control exception default annotation processor part code catlina lib directory which granted all permissions standard policy file however because untrusted jsp code stack permissions used call get declared fields should wrapped access controller do privileged call avoid exception default annotation processor process annotations should use do privileged call get declared fields
after looking user list post noticed consistent other getters like get name propose changing public string get etag boolean strong strong strong etag must always calculated resources strong etag null return strong etag attributes null attribute attribute attributes get etag attribute null try strong etag attribute get string catch naming exception value attribute return strong etag else weak etag content lenght last modified weak etag null weak etag get content length get last modified return weak etag updated resource attributes get etag
xxx comments below seem say same thing sure what xxx represents parse additional request parameters protected boolean post parse request org apache coyote request req request request org apache coyote response res response response throws exception xxx processor needs set correct scheme port prior point ajp13 protocols dont make sense get port from connector xxx processor may have set correct scheme port prior point ajp13 protocols dont make sense get port from connector otherwise use connector req scheme null use processor specified scheme determine secure state request set secure req scheme equals https duplicate comment code coyote adapter java
provide support renaming jsessionid
error processing tld file webapp xml parser
farm war deployer fails properly unpack copied war target node
we use apache mod jk 26 load balancer tomcat cluster we use custom http error codes like 450 purposes those codes get remapped 500 error code 450 rfc2616 described valid return code so bug custom error codes worked fine apache 41 mod jk 25 you can easily reproduce bug writing simple jsp page following line response set status 450 custom http error codes get remapped 500er codes
currently default servlet accepts ranges request header doesn indicate its response returning accept ranges bytes although required http setting header required order adobe acrobat plugin correctly handle linearized pdf which can speed download allowing random access pdf file although strictly necessary according can think any reason why header safe set response from default servlet which always dealing static files doing so has negative impact serving large pdf files so filing bug rather than rfe return accept ranges from default servlet
ran situation where tomcat execute appropriate filters request has been forwarded using handy urlrewrite filter from tuckey org when forwarded request internally filters had matching url pattern web xml file dispatcher setting both request forward were invoked tracing code hours later found problem lies inside application dispatcher code set dispatcher request path attr state attribue servlet path meant only matches using servlet path would match longer more exact urls would fail match example using following filter mapping filter mapping filter name my filter filter name url pattern app level mycode do url pattern dispatcher request dispatcher dispatcher forward dispatcher filter mapping would match request forwarded app level mycode do which should changing url pattern app would match app level would since servlet path app example fix quite simple application dispatcher java code method process request which only called forwards change following statement state outer request set attribute application filter factory dispatcher request path attr servlet path use request uri instead follows state outer request set attribute application filter factory dispatcher request path attr request uri resolves problem let all examples above correctly match run filter forward believe includes also broken same manner similar changes do include method application dispatcher java likely resolve issue well though have tested personally nice see resolved 17 thanks andrzej matching relevant servlet filters fails when request forwarded
access log valve doesn correctly handles combined log format patch
selector closed
contribution bayeux tomcat
extension validator doesn handle wrapped lines manifest mf
public void include string relative url path boolean flush throws servlet exception ioexception include relative url path false xxx just calls itself seems perhaps should just guess public void include string relative url path boolean flush throws servlet exception ioexception invoking jsp ctxt include relative url path false xxx came up me when had tag file had include using tomcat looking source jsp context wrapper java looks like issue well svn trunk jsp context wrapper contains infinite loop include string relative url path boolean flush
function length found
sometimes jsp java code which have been generated jasper has duplicate variable names therefore jsp cannot compiled tomcat delivers http status code 500 you get error message like org apache jasper jasper exception unable compile class jsp error occurred line 10 jsp file test1 jsp duplicate local variable jspx temp0 set var jsp attribute name value new java util date string jsp attribute set 10 set var 11 jsp attribute name value new java util date string jsp attribute 12 set 13 h1 test h1 reason error generation variable names like jspx temp0 which created jsp attribute tags beginning parsing jsp file counter reset every time jsp attribute tag occurs counter used build variable name jspx temp counter thereafter counter incremented counter static member jsp util class suppose thread which created jspx temp4 counter now second thread thread starts resets counter afterwards thread creates jspx temp0 jspx temp3 counter now thread stops thread continues next variable name thread jspx temp4 which already exists therefore generated java class cannot compiled jasper creates duplicate variable names
add parameters finer tuning http11apr protocol thread usage
improve apr lifecycle listener error messages
running debian sid kernel 22 use tomcat 14 together apr 11 special tomcat out box start up tomcat get following error log debugging apr revealed problem ipv6 apr socket create assigns af inet6 socket apr socket bind tries bind af inet address which fails info loaded apache tomcat native library 10 sep 2007 05 16 pm org apache catalina core apr lifecycle listener init info apr capabilities ipv6 true sendfile true accept filters false random true sep 2007 05 16 pm org apache coyote http11 http11apr protocol init severe error initializing endpoint java lang exception socket bind failed 22 invalid argument org apache tomcat util net apr endpoint init apr endpoint java 612 org apache coyote http11 http11apr protocol init http11apr protocol java 121 org apache catalina connector connector initialize connector java 1059 regards erik socket bind fails tomcat startup when using apr
check permisson
we found field count allocated accessed allocate deallocate without any protections locks here trace log thread http 8081 id 23 read org apache catalina core standard wrapper allocate 820 org apache catalina core standard wrapper valve invoke 129 org apache catalina core standard context valve invoke 175 org apache catalina core standard host valve invoke 128 org apache catalina valves error report valve invoke 104 org apache catalina core standard engine valve invoke 109 org apache catalina connector coyote adapter service 261 org apache coyote http11 process 844 org apache coyote http11 handler process 581 org apache tomcat util net jio endpoint worker run 447 java lang thread run 735 thread http 8081 id 26 write org apache catalina core standard wrapper deallocate 871 org apache catalina core standard wrapper valve invoke 298 org apache catalina core standard context valve invoke 175 org apache catalina core standard host valve invoke 128 org apache catalina valves error report valve invoke 104 org apache catalina core standard engine valve invoke 109 org apache catalina connector coyote adapter service 261 org apache coyote http11 process 844 org apache coyote http11 handler process 581 org apache tomcat util net jio endpoint worker run 447 java lang thread run 735 thread http 8081 http 8081 access count allocated parallel since increment decrement atomic we think potential race condition race conditions field count allocated class org apache catalina core standard wrapper
tried config my webapp authenticate user client cert auth method verified my jaas login module using basic auth method successfully user login after studying tomcat 20 source found problem caused realm base java jaasrealm java client cert auth method used call jaasrealm authenticate certs jaasrealm didn override authenticate certs realm base authenticate used only validate certs call get principal get principal string being called get principal however jaasrealm function always return null means tomcat can use jaasrealm client cert auth method thanks butler client cert jaasrealm working
jaasrealm working digest
startup tomcat discovers main port already bound another process fails tries execute shutdown code some situations sure which org apache jk server jkmain instance variable env null point which causes null pointer exception when jkmain pause called see stacktrace below since occurring within shutdown hook thread can result dirty shutdown jvm ve observed tomcat 20 looked over code 26 looks like same problem still present fortunately solution very simple just add following test beginning jkmain pause env null return stacktrace severe standard server await create 8006 java net bind exception address already use jvm bind java net plain socket impl socket bind native method java net plain socket impl bind plain socket impl java 359 java net server socket bind server socket java 319 java net server socket init server socket java 185 org apache catalina core standard server await standard server java 372 org apache catalina startup catalina await catalina java 615 org apache catalina startup catalina start catalina java 575 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 585 org apache catalina startup bootstrap start bootstrap java 294 org apache catalina startup bootstrap main bootstrap java 432 aug 2008 25 34 pm org apache coyote http11 http11base protocol pause info pausing coyote http http 8000 aug 2008 25 34 pm org apache catalina connector connector pause severe protocol handler pause failed java lang null pointer exception org apache jk server jk main pause jk main java 678 org apache jk server jk coyote handler pause jk coyote handler java 162 org apache catalina connector connector pause connector java 1031 org apache catalina core standard service stop standard service java 491 org apache catalina core standard server stop standard server java 743 org apache catalina startup catalina stop catalina java 601 org apache catalina startup catalina catalina shutdown hook run catalina java 644 null pointer exception during shutdown jkmain pause
jdbcrealm get roles bad causes hangs digest jdbcrealm caches prepared statement prepared roles missing jdbcrealm digest allow two threads call get roles so t1 do stmt execute query while t2 does stmt set string user name plus another execute query same prepared statement object worst case jdbc driver gets confused blocks forever waiting server response causing all other threads try access db hang observed postgre sql 603 jdbc4 jdbc driver org postgresql jdbc2 abstract execute abstract java 451 org postgresql jdbc2 abstract execute flags abstract java 350 org postgresql jdbc2 abstract execute query abstract java 254 org apache catalina realm jdbcrealm get roles jdbcrealm java 631 org apache catalina realm jdbcrealm get principal jdbcrealm java 596 org apache catalina realm realm base authenticate realm base java 399 org apache catalina digest find principal digest java 283 org apache catalina digest authenticate digest java 176 jdbcrealm get roles bad causes hangs digest
startup listener error message unhelpful
coyote reader read line returns null some post request bodies multiple max line length size
potential null pointer exception org apache catalina servlets cgiservlet
use latest svn snapshot store deployable wars webapps dist aside webapps my setup bash ls catalina base conf logs temp tomcat dist webapps webapps dist work bash ls webapps dist sample war bash cat conf catalina localhost sample xml context doc base catalina base webapps dist sample war ends up warnung doc base home juergen java tomcat webapps dist sample war inside host app base has been specified ignored doc base ignored even its subdir app base
hi override state transfer timeout manager class name org apache catalina ha session delta manager state transfer timeout 10 expire sessions shutdown false notify listeners replication true delta manager continues log default timeout value ie operation timeout session state has been received within 60 seconds 2008 07 01 14 31 30 419 warn org apache catalina ha session delta manager manager localhost manager requesting session state from org apache catalina tribes membership member impl tcp 10 64 104 55 15000 10 64 104 55 15000 alive 18586 id 62 91 70 63 111 50 70 33 104 41 48 32 91 34 83 55 payload command domain operation timeout session state has been received within 60 seconds 2008 07 01 14 31 35 310 warn org apache catalina ha cluster listener context manager doesn exist localhost host manager actually uses correct timeout value ie timing out after 10 100 ms 2008 07 01 14 31 40 518 error org apache catalina ha session delta manager manager localhost manager session state send 01 07 08 14 31 received timing out after 10 100 ms only incorrect message quite annoying especially coupled fact above only documented tomcat where syntax subtly different delta manager always reports default timeout value receiving session state startup
tomcat chooses wrong host using mod jk
mcast service impl does close its socket stop claims merely calls leave group which sufficient stop receiving messages does close socket causes file descriptor leak each time service stopped add socket close after leave group mcast service impl leaks sockets
dir context format date header values per http spec
http post requests handled correctly more than one space between post url
jsp file has byte order marks attribute set utf upper case file has byte order marks compilation workes fine code 12 32 16 946 error jsp servlet service servlet jsp threw exception org apache jasper jasper exception dialog jsp page encoding specified xml prolog utf different from specified page directive utf org apache jasper compiler default error handler jsp error default error handler java 40 org apache jasper compiler error dispatcher dispatch error dispatcher java 407 org apache jasper compiler error dispatcher jsp error error dispatcher java 236 org apache jasper compiler validator directive visitor compare page encodings validator java 362 org apache jasper compiler validator directive visitor visit validator java 197 org apache jasper compiler node page directive accept node java 590 org apache jasper compiler node nodes visit node java 2338 org apache jasper compiler node visitor visit body node java 2388 org apache jasper compiler node visitor visit node java 2394 org apache jasper compiler node root accept node java 489 org apache jasper compiler node nodes visit node java 2338 org apache jasper compiler validator validate validator java 1700 org apache jasper compiler compiler generate java compiler java 178 org apache jasper compiler compiler compile compiler java 306 org apache jasper compiler compiler compile compiler java 286 org apache jasper compiler compiler compile compiler java 273 org apache jasper jsp compilation context compile jsp compilation context java 566 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 316 org apache jasper servlet jsp servlet service jsp file jsp servlet java 336 org apache jasper servlet jsp servlet service jsp servlet java 265 javax servlet http http servlet service http servlet java 803 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core application dispatcher invoke application dispatcher java 654 org apache catalina core application dispatcher process request application dispatcher java 445 org apache catalina core application dispatcher do forward application dispatcher java 379 org apache catalina core application dispatcher forward application dispatcher java 292 de cit jsp control dispatch servlet forward dispatch servlet java 286 de cit jsp control dispatch servlet do get dispatch servlet java 272 javax servlet http http servlet service http servlet java 690 javax servlet http http servlet service http servlet java 803 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 de cit util javax servlet validation filter do filter validation filter java 108 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 de cit util javax servlet jsp xhtml content type filter do filter xhtml content type filter java 36 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 org jboss web tomcat filters reply header filter do filter reply header filter java 96 org apache catalina core application filter chain internal do filter application filter chain java 235 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 230 org apache catalina core standard context valve invoke standard context valve java 175 org jboss web tomcat security security association valve invoke security association valve java 179 org apache catalina base invoke base java 432 org jboss web tomcat security jacc context valve invoke jacc context valve java 84 org apache catalina core standard host valve invoke standard host valve java 127 org apache catalina valves error report valve invoke error report valve java 102 org jboss web tomcat service jca cached connection valve invoke cached connection valve java 157 org apache catalina single sign invoke single sign java 420 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 262 org apache coyote ajp ajp processor process ajp processor java 437 org apache coyote ajp ajp protocol ajp connection handler process ajp protocol java 366 org apache tomcat util net jio endpoint worker run jio endpoint java 446 java lang thread run thread java 619 code case insensitive camparison org apache jasper compiler validator compare page encodings seems fix problem code compares page encodings specified various places throws exception case page encoding mismatch param page dir enc value page encoding attribute page directive param page dir page directive node throws jasper exception case page encoding mismatch private string compare page encodings string page dir enc node page directive page dir throws jasper exception node root root page dir get root string config enc root get jsp config page encoding compare page encoding attribute page directive encoding specified jsp config element whose url pattern matches page treat utf 16 utf 16be utf 16le identical config enc null page dir enc equals ignore case config enc page dir enc upper case starts utf 16 config enc upper case starts utf 16 err jsp error page dir jsp error config pagedir encoding mismatch config enc page dir enc else return config enc compare page encoding attribute page directive encoding specified xml prolog only xml syntax only jsp document contains xml prolog encoding declaration treat utf 16 utf 16be utf 16le identical root xml syntax root encoding specified prolog root bom present string page enc root get page encoding page dir enc equals ignore case page enc page dir enc upper case starts utf 16 page enc upper case starts utf 16 err jsp error page dir jsp error prolog pagedir encoding mismatch page enc page dir enc else return page enc return page dir enc code jsp compilation exception page encoding utf file byte order marks
using seam seam app depends upon seam application being initialized before you can do much anything seam said seam puts some hooks session did activate session did passivate events because when start up my app getting seam illegal state exception because context initialized event fired after session did activate so seam yet initialized session hooks being fired what makes me think bug session passivate being correctly called before context destroyed so would seem session did activate being called before context initialized would inconsistent behavior so sum up think tomcat should fire context session events following order context initialized session did activate session passivate context destroyed side note tomcat follows what think completely wrong consistent order firing events order session did activate context initialized context destroyed session passivate session did activate called before context initialized
jsp text gets confused other text elements jsp tag file
suspicious url pattern warnings logged wrong webapp one actually using them log events coming from security collection java suspicious url pattern warning logged wrong webapp
have set compression compressable mime type text html server xml appears value compressable mime type being ignored my xml responses all coming back gzipped switch compression off responses gzipped soon turn regardless value compressable mime type xml responses coming back gzipped full connector tag follows note just example have tried many values compressable mime type do include text xml responses still compressed connector port 7630 address jboss bind address max threads 20 min spare threads max spare threads 10 strategy ms max http header size 8192 empty session path true enable lookups false redirect port 7643 accept count 16 connection timeout 20000 disable upload timeout true compression off compressable mime type text html text javascript application javascript application javascript compressable mime type attribute ignored
tomcat start located launched from path pound character somewhere you ll find all informations given mail thread tomcat user including some developer specific informations one part problem usage file url really appreciate problem could fixed worked around see mail thread hints btw same applies version probably earlier versions too thanks tomcat path pound sign class found exception
reproduce copy expanded file xxx war file folder tomcat webapps xxx war bug tomcat load app twice webapp expanded folder named webapps xxx war loaded twice
session statistics command manager fails unknown command sessions
class cast exception due bad tag handler pool name generation two different tags
non compliant annotations
when jsp compiler forks javac process should check see what currently endorsed directories check system property java endorsed dirs otherwise classes end up missing jsp pages do properly compile we experienced problem when we explicitly set java endorsed dirs property command line jsp compiler did use when javac forked have patched org apache jasper compiler compiler support src original jakarta tomcat jasper jasper2 src share org apache jasper compiler compiler java tue jun 15 17 30 35 2004 src org apache jasper compiler compiler java thu sep 16 00 05 14 2004 349 358 349 369 extdirs set path exts javac set extdirs extdirs info append extension dir exts add endorsed directories string endorsed system get property java endorsed dirs endorsed null javac specific argument endorsed arg javac create compiler arg endorsed arg set line djava endorsed dirs endorsed info append endorsed dir endorsed else info append endorsed dirs specified configure compiler object javac set encoding java encoding javac set classpath path javac set debug ctxt get options get class debug info true should probably check ctxt get options get fork well since always fork doesn matter me java endorsed dirs used when jsp compilation forked
trying use jstl version tomcat have both saxon crimson my web app we have crimson saxon our webapp lib tomcat tries use crimson xml parser when reading web xml compiling jsp we get prefix error org apache jasper jasper exception h3 validation error messages from tag library validator h3 null java lang illegal state exception can declare any more prefixes context h3 validation error messages from tag library validator fmt h3 null java lang illegal state exception can declare any more prefixes context we remove crimson tomcat uses saxon aelfred parser fails reading web xml javax xml parsers parser exception aelfred parser namespace aware we remove saxon crimson we okay defaults xerces tomcat endorsed directory seems me tomcat using parser my web app read web xml rather than using xerces from endorsed directory same web app runs without problems version 16 tomcat seems using service provider mechanism 25 have property files java jakarta tomcat 25 work catalina localhost diabetes loader meta inf services can find any documents using more than one parser won cause problems tomcat setting only one parser xslt processor here any comments gratefully received thanks peter neville xml parser loading problems container
tld config class org apache catalina startup asking class loader all parent class loader order get urls assume urls using file protocol when tomcat embedded sometimes url always using file protocol new file fail given patch skip urls using file protocol avoids ugly npe new file urls uri call tld config scan url files
hi am memory profiling webapp my company because we suspect has memory leaks when redeploying webapp has redeployed several times week security reasons most time undeployed memory leaks forced us shutdown tomcat once week avoid oom exception using jvm1 tomcat 13 also tried 14 today 16 yourkit profiling tool have made test both linux windows have created jmeter test deploy app using manager make some request app undeploy using again manager app loop after some got my out memory exception checked my profiling tool found my own classes were correctly destroyed classes retaining more memory were ones listed heirarchy org apache catalina core application context dispatch data org apache catalina core application context mapper org apache catalina core standard context context org apache tomcat util http mapper mapper resources org apache tomcat util http mapper mapper context cache org apache naming resources proxy dir context cache org apache naming resources resource cache org apache naming resources cache entry number objects each class were exactly number times had redeployed webapp have checked contents cache entry inside cache entry has attribute name contents jsps tld files my app many cache entry same jsp attribute times webapp has been reloaded so guess cleaning cache entry resources context shutdown reproduce simple webapp jsp taglibrary can used deploy undeploy many times so you can see how count objects grows memory cleanup org apache naming resources cache entry resources memory leak
org apache catalina ssi ssiprocessor method parse param names broken have ssi directive like set var test value blubb method detects three parameters instead two because two consecutive escaped characters although first one detected correctly next one isn because flag escaped still set true although character isn escaped anymore you have replace boolean escaped false idx cmd length quotes idx char cmd char idx need skip escaped characters escaped escaped true idx continue escaped false quotes idx cmd length quotes idx char cmd char idx need skip escaped characters idx continue quotes just removing flag escaped sufficient because you don have remember whether last character escaped should have influence consecutive characters bug still exists head revision repository ssi handling escaped characters broken
html entities which contained ssi set directive aren resolved ssi filter contrary what done mod include apaches http mod include resolves all html entities most attribute values ssi directives also resolves ssi filter tomcat resolves all escaped character which escaped backslash html entities all apart from giving encoding entity should different from giving encoding none ssi echo directive one should replace all invalid html characters valid html entities other one should do nothing encoding especially important you wan store html comment within ssi variable want store variable test value testvalue set var test value testvalue mod include you must write set var test value 45 45 testvalue 45 45 tomcats ssi you must write set var test value testvalue should difference whether output variable echo var test encoding none which should lead testvalue echo var test encoding entity which should lead lt testvalue quot quot gt html entities resolved ssi filter
el expression evaluation slow due caused jsp factory get default factory
function mapper impl function possible write external fail class has just been de serialised serialised again you look write external public void write external object output out throws ioexception out write utf prefix null prefix out write utf local name out write utf get declaring class get name out write utf get name out write object reflection util type name array get parameter types you can see externalises function invoked using reference method itself you look read external however public void read external object input throws ioexception class found exception prefix read utf equals prefix prefix null local name read utf owner read utf name read utf types string read object you can see doesn restore method after method restored accessed however performed write external throw npe still null fix either get method soon completes perhaps bit more efficient write external change null externalises using components method public void write external object output out throws ioexception out write utf prefix null prefix out write utf local name null out write utf owner out write utf name out write object types else null out write utf get declaring class get name out write utf get name out write object reflection util type name array get parameter types function mapper impl function throws npe certain
add possibility request queue size executor via jmx
realm base has resource permission method fully servlet compliant spec both states security constraint does contain constraint shall combine constraints name imply roles allow access special case constraint names roles shall combine any other constraints override affects cause access precluded tomcat works fine long aren weird legal combinations security constraints same urls example security constraint web resource collection url pattern some url url pattern http method post http method web resource collection auth constraint allow everyone security constraint security constraint web resource collection url pattern some url url pattern http method post http method web resource collection roles allow noone auth constraint security constraint we ignore kind pretty pointless spec dictates post some url index html should denied access tomcat grants both 23 14 do example security constraint web resource collection url pattern some url url pattern http method post http method web resource collection roles allow noone auth constraint security constraint security constraint web resource collection url pattern some url url pattern http method post http method web resource collection auth constraint role name role name auth constraint security constraint now gets interesting strict mode access some url index html denied regardless web xml configured security roles roles user has auth only mode access always granted strict auth only mode access granted web xml configured security roles now modes tomcat addition spec feel access should have been denied all modes both stay line spec keep behaviour predictable realm base via has resource permission fully servlet spec compliant
servlet input stream still readable even when closed
we re writing application processes requests using both normal servlet comet processor normal servlet handles user logout among other things once user has been client makes comet request which open until server has something push client when user decides log out we need stop processing comet events client enabled comet connection manager valve context xml hoping would get end event when session goes away instead get illegal state exception mar 10 2008 05 41 pm org apache catalina connector coyote adapter event severe exception error occurred container during request processing java lang illegal state exception cannot create session after response has been committed org apache catalina connector request do get session request java 2301 org apache catalina connector request get session request java 2075 org apache catalina valves comet connection manager valve event comet connection manager valve java 311 org apache catalina core standard host valve event standard host valve java 179 org apache catalina valves valve base event valve base java 200 org apache catalina core standard engine valve event standard engine valve java 128 org apache catalina connector coyote adapter event coyote adapter java 198 org apache coyote http11 http11nio processor event http11nio processor java 749 org apache coyote http11 http11nio protocol handler event http11nio protocol java 653 org apache tomcat util net nio endpoint socket processor run nio endpoint java 2080 java util concurrent thread pool executor worker run task thread pool executor java 885 java util concurrent thread pool executor worker run thread pool executor java 907 java lang thread run thread java 619 presumably my servlet handles logout request after sending response client calls invalidate http session subsequently comet connection manager value event calls request get session true resulting illegal state exception illegal state exception when using comet connection manager valve
severe error starting endpoint java net bind exception cannot assign requested address 2217 org apache tomcat util net jio endpoint init jio endpoint java 501 org apache tomcat util net jio endpoint start jio endpoint java 515 org apache coyote http11 start java 203 org apache catalina connector connector start connector java 1131 org apache catalina core standard service start standard service java 531 org apache catalina core standard server start standard server java 710 org apache catalina startup catalina start catalina java 578 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 saying which address bind attempted would accelerate error resolution quite bit cite attempted address when throwing cannot assign requested address
head requests cannot go through request dispatch include
default servlet docu says about attibute readme file directory listing presented readme file may also presented listing file inserted true 14 crashes file absent listed directory javax servlet servlet exception error opening readme resource org apache catalina servlets default servlet get readme default servlet java 1418 new behaviour blocks listing big directory trees managed others where work around nor feasible work around readme file every subdir empty length none wanted subsequent changes used xsl transformers work around change may must docu repair fix default servlet from web xml servlet servlet name default servlet name servlet class org apache catalina servlets default servlet servlet class init param param name listings param name param value true param value init param init param param name global xslt file param name param value www serv intra meva dir li xsl param value init param init param param name readme file param name param value readme htm param value init param load startup load startup servlet dir listing crashes readme file present
my nio connector server xml connector accept count 100 enable lookups false port 80 protocol org apache coyote http11 http11nio protocol acceptor thread count socket buffer pool connection timeout 60000 max keep alive requests max threads 200 min spare threads 25 redirect port 8443 when am starting my tomcat giving following error console several time severe java lang null pointer exception org apache tomcat util net nio endpoint set socket options nio endpoint java 985 org apache tomcat util net nio endpoint acceptor run nio endpoint java 1169 java lang thread run thread java 595 error while starting tomcat
when logging trace mode lower org apache catalina loader webapp class loader find class string calls get class loader without privileged block security enabled cause security exception runtime permission get class loader granted webapp class loader find class calls get class loader without privileges
when register same class implementing servlet context listener twice more its context initialized methods only gets called once servlet say conforming container has call listeners same order registered deployment descriptor case one listener class registered twice mentioned explicitly though example listener listener class test servlet context listener1 listener class listener listener listener class test servlet context listener2 listener class listener listener listener class test servlet context listener1 listener class listener test servlet context listener1 test servlet context listener2 get called test servlet context listener1 does get called again apache tomcat 25 has same bug multiple same servlet context listener class possible
set up ssl connector keystore jks format connector sslenabled true keystore file tomcat keystore keystore type jks let say you need custom truststore self signed client certificates truststore also needed some your webapps only tomcat natural thing do configure truststore globally whole jvm server xml let also assume truststore different format pkcs 12 so before starting tomcat you do export java opts djavax net ssl trust store trusted keystore djavax net ssl trust store type pkcs12 well doesn work you look tomcat logs catalina out you see keystore related exception upon further debugging you discover problem tomcat trying open truststore were jks format even though clearly specified type pkcs12 java opts above tomcat ignores javax net ssl trust store type system property
obtained following null pointer exception stack trace below java lang null pointer exception org apache catalina manager htmlmanager servlet list htmlmanager servlet java 437 org apache catalina manager htmlmanager servlet do get htmlmanager servlet java 136 code args 11 new integer context get manager get max inactive interval 60 seemingly get manager returning null htmlmanager servlet null pointer exception listing context
ve built small test servlet included below shows behaviour upload data tomcat configured use http coyote connector using chunked transfer encoding put result what read using servlet request get input stream corrupted only happens large puts happens every time tried about 10 large put testing something around 700 another thing about mb does always corrupt same way did see any corruption small files 50 smaller though didn test extensively total length data read exactly correct 712080 bytes my first test first point corruption file chunk header appears output n1000 followed correct data from about 700 bytes later second copy correct place think corrupt data correct data followed chunk header followed some data repeated second instance which correct place so first instance being produced instead correct data point input test servlet follows import java io import javax servlet import javax servlet http public class test extends http servlet public void do put http servlet request req http servlet response res throws servlet exception ioexception file output stream fos new file output stream tmp servlet out input stream req get input stream byte buf new byte 2000 int ret while ret read buf fos write buf ret fos close close print writer pw res get writer pw println done pw flush pw close coyote connector does correctly deal large put when using chunked transfer encoding
myjsp jsp hello tag1 tag1 tag tag2 tag2 tag world crashes null pointer while trying load tag2 class called tag file processor load tag file very initial analysis tag file processor load tag file creates wrapper ctxt get tag file jar url tag file path returns null nested tag thus jsp compilation context compile jsp cctx packaged file false so out dated test wrong so tag2 tag compiled thus class cannot loaded problem also appears tags packaged jar so more going work around create dummy jsp calls tags leaf first order so class files created cannot jspc precompile jsps nested tag files
java lang null pointer exception from org apache jasper compiler servlet writer print multi ln validation jspx empty jsp scriptlet element
impossible invoke remove role other mbean methods set attribute mbean server cause same bug managed bean java both lines 545 get setter method 604 get invoke method object must replace object bean fortunately get getter method correct mbean server invoke issue
ll attach sample web application reproducing error note error only occurs when using tomcat works jetty uses sun el ri moreover doesn matter which jsf you re using reproduce error just wanted mention definitely bug my faces even though following stack trace shows faces exception exception stack trace javax faces faces exception exception while calling broadcast component component path class javax faces component uiview root view id home jsp class javax faces component html html form id id jsp 923754602 class javax faces component html html command button id id jsp 923754602 javax faces component uicomponent base broadcast uicomponent base java 494 javax faces component uicommand broadcast uicommand java 105 javax faces component uiview root broadcast phase uiview root java 292 javax faces component uiview root process uiview root java 209 javax faces component uiview root process application uiview root java 117 org apache myfaces lifecycle invoke application executor execute invoke application executor java 32 org apache myfaces lifecycle lifecycle impl execute phase lifecycle impl java 95 org apache myfaces lifecycle lifecycle impl execute lifecycle impl java 70 javax faces webapp faces servlet service faces servlet java 144 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 233 org apache catalina core standard context valve invoke standard context valve java 175 org apache catalina core standard host valve invoke standard host valve java 128 org apache catalina valves error report valve invoke error report valve java 102 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 263 org apache coyote http11 process java 844 org apache coyote http11 handler process java 584 org apache tomcat util net jio endpoint worker run jio endpoint java 447 java lang thread run thread java 619 caused org apache jasper el jsp elexception home jsp 12 number bean number java lang illegal argument exception argument type mismatch org apache jasper el jsp value expression set value jsp value expression java 94 org apache myfaces event set property action listener process action set property action listener java 72 javax faces event action event process listener action event java 48 javax faces component uicomponent base broadcast uicomponent base java 489 20 more caused java lang illegal argument exception argument type mismatch sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 javax el bean elresolver set value bean elresolver java 108 javax el composite elresolver set value composite elresolver java 68 org apache myfaces el unified resolver faces composite elresolver access 501 faces composite elresolver java 46 org apache myfaces el unified resolver faces composite elresolver invoke faces composite elresolver java 132 org apache myfaces el unified resolver faces composite elresolver invoke faces composite elresolver java 148 org apache myfaces el unified resolver faces composite elresolver set value faces composite elresolver java 128 org apache el parser ast value set value ast value java 114 org apache el value expression impl set value value expression impl java 249 org apache jasper el jsp value expression set value jsp value expression java 85 23 more missing el coercion causes argument type mismatch
under certain conditions resource cache used servlet jsp engine org apache naming resource does detect file its cache has been modified therefore returns previous contents file happens only when file contents modified file length doesn change until time first change file detected after server startup reproduce problem put attached test jsp test txt root web app do following used tomcat trunk test cat test txt abcd telnet 9080 trying connected escape character get test jsp http http 200 ok server apache coyote set cookie jsessionid path content type text html content length 26 date wed 23 may 2007 23 03 05 gmt connection close file contents abcd connection closed foreign host cat test txt change contents size efgh telnet 9080 trying connected escape character get test jsp http http 200 ok server apache coyote set cookie jsessionid path content type text html content length 26 date wed 23 may 2007 23 04 24 gmt connection close file contents abcd servlet context get resource stream returns stale data
http spec violation when generating http redirects folders without trailing slash
org apache el lang evaluation context doesn pass locale wrapped elcontext does org apache jasper el elcontext wrapper prohibits using locale original purpose el evaluation context wrapper hides locale
class org apache el lang elarithmetic has following code snippet throw new illegal argument exception message factory get el convert obj obj type key el convert doesn exist org apache el messages result receiving exception java util missing resource exception can find resource bundle java util property resource bundle key el convert java util resource bundle get object resource bundle java 325 java util resource bundle get string resource bundle java 285 org apache el util message factory get array message factory java 67 org apache el util message factory get message factory java 47 org apache el lang elarithmetic coerce elarithmetic java 367 org apache el lang elarithmetic add elarithmetic java 238 org apache el parser ast plus get value ast plus java 24 org apache el value expression impl get value value expression impl java 186 org apache el lang elarithmetic coerce throws missing resource exception key el convert
html manager webapp done work correctly when clicking expire sessions button idle param missing from form following html shows bug form method post action manager html expire path small nbsp input type submit value expire sessions nbsp idle ge nbsp input type text name expire size value 30 nbsp minutes nbsp small form name text input should idle cannot expire session via html manager webapp
use context class loader config option doesn work right ignored when setting user class names role class names respected when login context created insufficient because all needed classes necessarily loaded until login context login called patch follow able keep everything related jaasrealm my webapp jaasrealm use context class loader has problems
class org apache catalina connector response resets internal hold coyote response output buffer during reset public void reset included return ignore any call from included servlet coyote response reset output buffer reset anyone has already set character encoding utf already got writer than all following invocations request set character encoding do nothing because internal save flag using writer reseted very annoying because coyote response reset resets character encoding iso8859 so have change change reset charater encoding utf ll think you reset response you should also reset using writer flag add another special flag works response set character encoding fails after response get writer response reset
servlet context get resource stream does follow api specs path
context war file exists server xml manager uploads new war file does expand necessary directory does exist directory exists overwritten so you see old application see server xml host name xxx app base webapps unpack wars true context path yyy don have context yyy server xml autodeploy works expected even you say remove context from manager application always application view you can remove finally never cleans up work directory application yyy which guess just subsequent error above behaviour unpack wars true does work when context war file exists server xml
compression related attributes http connector compression off force integer val states integer val implemented compression min compression size integer val min compression size integer val 12 doesnt mention all read server xml problem documenation gives impression only setting compression some integer val sufficient however way code written value min compression size always overrides value specified compression field even min compression size isnt set still get default value 2048 override whatever value compression field looked http11 connector found following code might culprit org apache coyote http11 http11base protocol handler init processor set compression proto compression processor set compression min size proto compression min size since set compression min size called after compression min size its value override value read from compression atttribute have looked code tomcat also problems appears still present compression min compression size attribute properly implemented
tomcat throwing java lang illegal state exception due attempted response send redirect after time matters has come gone appears symptom bad jsp parsing runtime org apache jasper jasper exception exception jsp buslog jsp 42 39 session get attribute auth null 40 session set attribute message user failed 41 you should parse 42 response send redirect index jsp 43 44 45 session get attribute auth null lines commented out source should conceivably cause runtime error changing response send redirect response send abend omg suppresses error am willing provide complete source necessary build execution environments net beans bundled tomcat 17 improper parsing response send redirect jsp source
fix litmus warning webdav servlet
getting some rather unhelpful error messages when trying deploy web xml included illegal servlet names tracked them down part org apache catalina core standard wrapper java catch exception ex log info error registering servlet jmx should probably changed log info error registering servlet jmx ex same thing catch block ten lines below one first noticed 23 code still present trunk standard wrapper register jmx doesn log exceptions correctly
webdav servlet returns incorrect values href property when mapped url prefix instead
apr sendfile thread leaks memory adding sendfile data objects its hash map failing remove them apr sendfile thread leaks memory
standard context java reads public string find status page int status return string status pages get new integer status wrong should public string find status page int status return error page status pages get new integer status get location regards lg class cast exception org apache catalina core standard context find status page int
abstract replicated map member disappeared executed more than necessity
keystore file parameter when specified relative treated relative catalina base catalina base property nio end point
org apache catalina core application dispatcher do include servlet request request servlet response response after invoke called perform include request response objects normally unwrapped however servlet exception ioexception thrown unwrapping does take place leads problems environments which cross context includes being performed example web app performs include servlet web app servlet web app throws servlet exception web app catches servlet exception attempts forward error jsp step above fail due fact request has been unwrapped active request contain servlet context web app jsp file found after failed include request response unwrapped
activity check does work correctly when tomcat restarted
hi all had servlet mappings contain plus signs were created jsp servlet mapping servlet name org apache jsp suchergebnis 005fbu 002bbb jsp servlet name url pattern suchergebnis bu bb jsp url pattern servlet mapping mapping does work referred class present when change original file names jsps plus signs replaced minus signs following mapping results servlet mapping servlet name org apache jsp suchergebnis 005fbu 002dbb jsp servlet name url pattern suchergebnis bu bb jsp url pattern servlet mapping now mapping works therefore assume bug handling servlet mappings plus signs url pattern plus sign url pattern servlet mapping does work
bug example code dummy cart java
tomcat version 13 13 available version field when trying process data comet processor event either during begin event during read event impossible guarantee all data has been read before returning since new data may arrive between last statement before return return statement itself however coyote processor does check else error read request get available read all bytes have been read data read from connector error error true log error sm get string coyote adapter read causing severe error comet request break when race condition manifests itself am using following code according aio html description read data my comet event handler while request get input stream available read some data more data available return am experiencing error described certain conditions rapid arrival fragmented data severe servlet did read all available bytes during processing read event race condition when using available reading comet processor event
application follwing web xml can deployed servlet servlet name sample servlet name servlet class sample servlet servlet class security role ref role name users role name security role ref servlet servlet mapping servlet mapping security role role name users role name security role java lang illegal argument exception can convert argument null occurred says security role ref element declares security role reference components deployment components code consists optional description security role name used code role name optional link security role role link role link optional role link tag web xml can omitted
jasper output details when jasper cannot find mappings between generated servlet code mistakes former jsp one example jsp following imported class jsp found page import exist class jasper output details compilation error specific case
having following web xml env entry env entry name test env entry name env entry type java lang string env entry type env entry value test env entry value env entry following your context descriptor resource link name test global test type java lang string causes npe context load java lang null pointer exception org apache catalina deploy naming resources add environment naming resources java 188 assumes you have entry test global naming resources section server xml link worked 20 longer works 23 same env entry web xml resource link context names causes npe
when we deploy 20 so web apps time we invariably end up app two each server has compilation errors due code generated like static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap static private org apache jasper runtime protected function mapper jspx fnmap looks like might simple access static curr func elfunction mapper far from expert code lack time become one only appears happen when we mass deploy apps we can resolve deleting generated java file manually restarting affected app duplicate jsp function mapper variables
304 response should consistently include etag header
rev 535915 changed behavior error report valve tomcat6 produce error report when response send error called example using code servlet service does produce error report response send error http servlet response sc gone error occurred underlying cause valve check response committed replaced response app committed latter returns true which causes valve invoke method immediately return instead producing report error report valve does provide error report
realm base init needs cleanup
duplicate jsp temp variable declaration when jsp attribute used conjunction custom tags
html table tr wrong formating when stop last tomcat web application manager tomcat web application manager table error
potential null pointer exception org apache catalina valves access log valve
when using form custom encoding multipart form data content type restored after redirect login page auth method form reproduce page posts using multipart form data encoding anything other than application www form urlencoded result page protected login page auth method form invoked even though multipart post data exists verified reading input stream request from result page content type request always application www form urlencoded only happens when redirected login page first does happen already logged post content type incorrect multipart forms after login
org apache catalina startup embedded direct api create nio connector would very helpful all applications which use tomcat embedded mode require comet processor request support nio embedded tomcat
apr bytes received bytes sent always apr bytessent performance data collected
you install tomcat web application directory spaces name example program files vds tomcat tomcat program files vds console web application tld files inside meta inf directory jar files loaded problem file treatment inside tld config class have attached patch correction bug found tomcat too you install tomcat directory spaces ignores tld files inside jar files
jsp throws unavailable exception twice illegal state exception occurs first access jsp throws unavailable exception second access jsp throws unavailable exception again illegal state exception occurs tomcat returns status code 500 client problem illegal state exception occurs problem jsp can called even though cannot used jsp throws unavailable exception twice illegal state exception occurs
when unavailable exception thrown from servlet init tomcat doesn output stack trace unavailable exception cause problem lost tomcat should output stack trace invoke method standard wrapper value tomcat doesn output stack trace unavailable exception
bug also present coyote source 10 http header content type text abc charset utf xyz request get character encoding returns utf xyz tomcat 24 returns utf tomcat 24 request get character encoding uses parse character encoding defined jakarta tomcat 24 src catalina src share org apache catalina util request util java correctly handles case other content type parameters tomcat 23 however request get character encoding uses get charset from content type defined from apache tomcat 23 src connectors util java org apache tomcat util http content type java which does search possible terminating semicolon charset thus erroneously including additional characters charset code 23 has comment begins basically return everything after charset please consider using code from 24 problem showed up when content type multipart mixed client specified charset parameter content type however occur any content type where charset specified last parameter request get character encoding misparses charset utf xyz
we use followwing logging properties our web application handlers 1tivoli java util logging file handler 2product java util logging file handler handlers root logger handlers 1tivoli java util logging file handler 2product java util logging file handler 1tivoli java util logging file handler level info 1tivoli java util logging file handler pattern var log product tivoli log limit output 1mb 1tivoli java util logging file handler limit 1048576 limit rotation 10 logs 1tivoli java util logging file handler count 10 1tivoli java util logging file handler append true 1tivoli java util logging file handler formatter de customer product tivoli tivoli formatter 2product java util logging file handler level finest 2product java util logging file handler pattern var log product product log limit output 1mb 2product java util logging file handler limit 1048576 limit rotation logs 2product java util logging file handler count 2product java util logging file handler append true 2product java util logging file handler formatter java util logging simple formatter when using apache tomcat 23 every line logfiles duplicated debugging found tivoli formatter actually created twice root logger has actually handlers two intended does allow us upgrade beyond 20 found linux64bit windows xp both jdk r11 java util logging duplicated since 23 20 ok
when jsp accessed second time jsp destroy method called even servlet exception thrown from init method class extends http jsp page violates java servlet srv call jsp destroy method violates about java servlet srv
tried deploy webapp using context xml file under manager webapp received error java io file found exception opt apache tomcat conf catalina localhost mywebapp3 xml file directory java io file output stream open native method java io file output stream init file output stream java 179 java io file output stream init file output stream java 131 org apache catalina manager manager servlet copy internal manager servlet java 1570 org apache catalina manager manager servlet copy manager servlet java 1530 org apache catalina manager manager servlet deploy manager servlet java 803 org apache catalina manager htmlmanager servlet deploy internal htmlmanager servlet java 249 org apache catalina manager htmlmanager servlet do get htmlmanager servlet java 96 javax servlet http http servlet service http servlet java 690 javax servlet http http servlet service http servlet java 803 org apache catalina core application filter chain internal do filter application filter chain java 290 org apache catalina core application filter chain do filter application filter chain java 206 org apache catalina core standard wrapper valve invoke standard wrapper valve java 228 org apache catalina core standard context valve invoke standard context valve java 175 org apache catalina base invoke base java 525 org apache catalina core standard host valve invoke standard host valve java 128 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 212 org apache coyote http11 process java 818 org apache coyote http11 handler process java 624 org apache tomcat util net jio endpoint worker run jio endpoint java 445 java lang thread run thread java 613 did checked noticed apache tomcat conf catalina directory longer exists version did something changed error when deploying xml file url
variable assigned own value
still happening though isn option bugzilla use backup manager session replication turn debug logging get exception when try invalidate session java lang class cast exception org apache catalina ha session backup manager cannot cast org apache catalina ha session delta manager org apache catalina ha session delta session expire delta session java 361 org apache catalina ha session delta session expire delta session java 352 org apache catalina session standard session expire standard session java 660 org apache catalina session standard session invalidate standard session java 1112 org apache catalina session standard session facade invalidate standard session facade java 150 bug easy find source debug logging enabled tries cast manager delta manager without instanceof even though doing instanceof immediately after public void expire boolean notify boolean notify cluster string expired id get id internal super expire notify notify cluster log debug enabled log debug sm get string delta session notifying delta manager manager get name new boolean primary session expired id manager instanceof delta manager delta manager manager session expired expired id class cast exception backup manager debug logging
try test cluster function got problem something like following apears catalina home logs catalina out severe unable start replicated context java lang class cast exception org apache naming resources proxy dir context cannot cast java io serializable org apache catalina tribes tipis abstract replicated map map entry set value abstract replicated map java 1060 didn change any file catalina home except server xml any thing changed server xml uncomment line cluster class name org apache catalina ha tcp simple tcp cluster add context file test xml catalina home conf catalina localhost flolling content aray bonc 01 conf cat catalina localhost test xml context class name org apache catalina ha context replicated context path test doc base var www cluster test debug privileged true reloadable true web xml file var www cluster test has element am worrying about can explain problem clearly my poor english so paste stepes do following aray bonc 01 apache tomcat which java usr java jdk1 bin java aray bonc 01 apache tomcat java version java version rc java tm se runtime environment build rc b104 java hot spot tm client vm build rc b104 mixed mode sharing aray bonc 01 apache tomcat echo java home usr java jdk1 aray bonc 01 apache tomcat echo classpath aray bonc 01 apache tomcat uname linux bonc 01 34 el wed mar 00 07 35 cst 2006 i686 i686 i386 gnu linux root bonc 01 local cat etc redhat release cent os release final aray bonc 01 apache tomcat cd conf aray bonc 01 conf cat server xml note server itself container so you may define valves level docs config server html server port 8005 shutdown shutdown apr library loader docs apr html listener class name org apache catalina core apr lifecycle listener sslengine initialize jasper prior webapps loaded docs jasper howto html listener class name org apache catalina core jasper listener jmx support tomcat server docs non existent html listener class name org apache catalina mbeans server lifecycle listener listener class name org apache catalina mbeans global resources lifecycle listener global jndi resources docs jndi resources howto html global naming resources editable user database can also used user database realm authenticate users resource name user database auth container type org apache catalina user database description user database can updated saved factory org apache catalina users memory user database factory pathname conf tomcat users xml global naming resources service collection one more connectors share single container note service itself container so you may define valves level docs config service html service name catalina connector represents endpoint which requests received responses returned java http connector docs config http html blocking non blocking java ajp connector docs config ajp html apr http ajp connector docs apr html define non ssl http connector port 8080 connector port 8080 protocol http max threads 150 connection timeout 20000 redirect port 8443 define ssl http connector port 8443 connector uses jsse when using apr connector should using open ssl style described apr connector port 8443 protocol http max threads 150 scheme https secure true client auth false ssl protocol tls define ajp connector port 8009 connector port 8009 protocol ajp redirect port 8443 engine represents entry point within catalina processes every request engine tomcat stand alone analyzes http headers included request passes them appropriate host virtual host docs config engine html you should set jvm route support load balancing via ajp ie engine name standalone default host localhost jvm route jvm1 engine name catalina default host localhost clustering please take look docs cluster howto html simple how docs config cluster html reference cluster class name org apache catalina ha tcp simple tcp cluster request dumper valve dumps useful debugging information about request response data received sent tomcat docs config valve html valve class name org apache catalina valves request dumper valve realm uses user database configured global jndi resources under key user database any edits performed against user database immediately available use realm realm class name org apache catalina realm user database realm resource name user database define default virtual host note xml schema validation work xerces host name localhost app base webapps unpack wars true auto deploy true xml validation false xml namespace aware false single sign valve share between web applications docs config valve html valve class name org apache catalina single sign access log processes all example docs config valve html valve class name org apache catalina valves fast common access log valve directory logs prefix localhost access log suffix txt pattern common resolve hosts false host engine service server aray bonc 01 conf mkdir catalina aray bonc 01 conf ln usr local tomcat conf localhost catalina localhost aray bonc 01 conf cat catalina localhost test xml context class name org apache catalina ha context replicated context path test doc base var www cluster test debug privileged true reloadable true context aray bonc 01 conf cd aray bonc 01 apache tomcat ls bin conf lib license logs notice release notes running txt temp webapps work aray bonc 01 apache tomcat rm logs aray bonc 01 apache tomcat bin catalina sh version using catalina base home aray download apache tomcat using catalina home home aray download apache tomcat using catalina tmpdir home aray download apache tomcat temp using jre home usr java jdk1 server version apache tomcat server built nov 16 2006 12 31 06 server number os name linux os version 34 el architecture i386 jvm version rc b104 jvm vendor sun microsystems inc aray bonc 01 apache tomcat bin startup sh using catalina base home aray download apache tomcat using catalina home home aray download apache tomcat using catalina tmpdir home aray download apache tomcat temp using jre home usr java jdk1 aray bonc 01 apache tomcat cat logs catalina out info initializing coyote http http 8080 dec 13 2006 07 39 pm org apache catalina startup catalina load info processed 2532 ms dec 13 2006 07 40 pm org apache catalina core standard service start info starting service catalina dec 13 2006 07 40 pm org apache catalina core standard engine start info starting servlet engine apache tomcat dec 13 2006 07 40 pm org apache catalina ha tcp simple tcp cluster start info cluster about start dec 13 2006 07 40 pm org apache catalina tribes transport receiver base bind info receiver server socket bound 127 4000 dec 13 2006 07 40 pm org apache catalina tribes membership mcast service impl setup socket info setting cluster mcast so timeout 500 dec 13 2006 07 40 pm org apache catalina tribes membership mcast service impl wait members info sleeping 1000 milliseconds establish cluster membership start level dec 13 2006 07 41 pm org apache catalina tribes membership mcast service impl wait members info done sleeping membership established start level dec 13 2006 07 41 pm org apache catalina tribes membership mcast service impl wait members info sleeping 1000 milliseconds establish cluster membership start level dec 13 2006 07 42 pm org apache catalina tribes membership mcast service impl wait members info done sleeping membership established start level dec 13 2006 07 42 pm org apache catalina core standard host start info xml validation disabled dec 13 2006 07 42 pm org apache catalina tribes tipis abstract replicated map init info initializing abstract replicated map context name test dec 13 2006 07 43 pm org apache catalina ha context replicated context start severe unable start replicated context java lang class cast exception org apache naming resources proxy dir context cannot cast java io serializable org apache catalina tribes tipis abstract replicated map map entry set value abstract replicated map java 1060 org apache catalina tribes tipis abstract replicated map map entry init abstract replicated map java 1005 org apache catalina tribes tipis abstract replicated map put abstract replicated map java 859 org apache catalina core application context set attribute application context java 756 org apache catalina core application context facade set attribute application context facade java 334 org apache catalina core standard context start standard context java 4296 org apache catalina ha context replicated context start replicated context java 55 org apache catalina core container base add child internal container base java 760 org apache catalina core container base add child container base java 740 org apache catalina core standard host add child standard host java 525 org apache catalina startup host config deploy descriptor host config java 626 org apache catalina startup host config deploy descriptors host config java 553 org apache catalina startup host config deploy apps host config java 488 org apache catalina startup host config start host config java 1138 org apache catalina startup host config lifecycle event host config java 311 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 120 org apache catalina core container base start container base java 1022 org apache catalina core standard host start standard host java 719 org apache catalina core container base start container base java 1014 org apache catalina core standard engine start standard engine java 443 org apache catalina core standard service start standard service java 451 org apache catalina core standard server start standard server java 710 org apache catalina startup catalina start catalina java 552 sun reflect native method accessor impl invoke0 native method sun reflect native method accessor impl invoke native method accessor impl java 39 sun reflect delegating method accessor impl invoke delegating method accessor impl java 25 java lang reflect method invoke method java 597 org apache catalina startup bootstrap start bootstrap java 288 org apache catalina startup bootstrap main bootstrap java 413 dec 13 2006 07 43 pm org apache catalina core container base add child internal severe container base add child start lifecycle exception failed start replicated context java lang class cast exception org apache naming resources proxy dir context cannot cast java io serializable org apache catalina ha context replicated context start replicated context java 58 unable start replicated context
reference org apache coyote http11 java would helpful developers get informed when some required header information missing eg when headers get value host returns null http11 true couldn you add log debug statement informs user about missing header fields example java 1391 add debug statement when some necessary header information missing
org apache catalina realm jaasrealm does verify any class names set through set role class names set user class names incorrect class name typo configured context xml unnoticed jaasrealm result during when subject principals checked against configured class names principals recognised therefore added subject fact incorrect configured class name currently detected logged makes very hard find source problem can easily fixed checking class names two methods mentioned above class must exist must implement java security principal which currently enforced checked code incorrect user role classnames silently ignored
class org apache jasper compiler jdtcompiler public char get contents char result null try input stream reader reader new input stream reader new file input stream source file ctxt get options get java encoding reader reader new buffered reader reader reader null char chars new char 8192 string buffer buf new string buffer int count while count reader read chars chars length buf append chars count result new char buf length buf get chars result length result catch ioexception log error compilation error return result variable reader closed after use update jsp files frequently exhaust system file handler too many files errors come test redhat linux same problem occured tomcat tomcat jdtcompiler get contents does close reader
when digester read tomcat user xml file exception throw created new lifecycle exception first parameter exception message string string hardcoded memory realm read xml so thing log message wrong too think must used string manager actual digester digester get digester try synchronized digester digester push digester parse file catch exception throw new lifecycle exception memory realm read xml finally digester reset fixed digester digester get digester try synchronized digester digester push digester parse file catch exception throw new lifecycle exception sm get string memory realm read xml finally digester reset wrong message exception memory realm
unmodified since header doesn work enoughly failed case unmodified since header value 1000000 milliseconds last modified value target resource 1001000 milliseconds case response status code should sc precondition failed result so caused default servlet check unmodified since last modified header value 1000 think should last modified header value 1000 unmodified since failure
servlet says value positive integer container must load initialize servlet application deployed container must guarantee servlets marked lower integers loaded before servlets marked higher integers think servlet value load startup tag must loaded first however tomcat loads servlet last servlet value load startup tag must loaded first
suggest little message improvement log level different same messages message servlet service servlet threw exception output eight places message level same org apache catalina core application dispatcher invoke wrapper get logger error sm get string application dispatcher service exception wrapper get name wrapper get logger error sm get string application dispatcher service exception wrapper get name wrapper get logger error sm get string application dispatcher service exception wrapper get name root cause wrapper get logger error sm get string application dispatcher service exception wrapper get name org apache catalina core standard wrapper valve invoke container get logger warn sm get string standard wrapper service exception wrapper get name container get logger warn sm get string standard wrapper service exception wrapper get name container get logger error sm get string standard wrapper service exception wrapper get name root cause container get logger error sm get string standard wrapper service exception wrapper get name any reasons using get logger warn think would better all them use get logger error log level different same messages
only instance jsp factory object jsp factory impl created consequently single simple pool page context objects all jsp requests so every jsp request must synchronize lock inside simple pool when getting releasing page context instance moreover pool has fixed capacity after code jsp factory impl first acquire lock see any free objects pool failing which new page context object created instead single process wide pool per thread pool page context objects can used jsp factory impl avoid simple pool get put jsp factory impl
tomcat version trunk every generated jsp has try jspx factory jsp factory get default factory response set content type text html its jsp service method use jsp factory get default factory during request processing should avoided static synchronized method have diff addresses attach bug unnecessary caused jsp factory get default factory while servicing jsps
srv servlet spec introduces support servlet name filter mapping tc6 does currently support value specified attach patch shortly filter mapping doesn support servlet name
trying use nio connector instead apr connector using tomcat6 head get illegal argument exception while call send ack looking internal nio output buffer send ack uses byte buffer wrap create new byte buffer uses byte buffer call write socket check secure nio channel write byte buffer one stored commenting line 372 secure nio channel java fixes problem src buf handler get write buffer throw new illegal argument exception you can only write using application write buffer provided handler guess check here valid reason better fix would very likely consist fixing send ack adding condition test case send ack grave cannot find message associated key standard wrapper acknowledge exception java lang illegal argument exception you can only write using application write buffer provided handler org apache tomcat util net secure nio channel write secure nio channel java 372 org apache tomcat util net nio selector pool write nio selector pool java 111 org apache coyote http11 internal nio output buffer write socket internal nio output buffer java 434 org apache coyote http11 internal nio output buffer send ack internal nio output buffer java 418 org apache coyote http11 http11nio processor action http11nio processor java 1028 org apache coyote response action response java 183 org apache coyote response acknowledge response java 310 org apache catalina connector response send response java 1154 org apache catalina core standard wrapper valve invoke standard wrapper valve java 169 org apache catalina core standard context valve invoke standard context valve java 175 org apache catalina core standard host valve invoke standard host valve java 128 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 109 org apache catalina connector coyote adapter service coyote adapter java 212 org apache coyote http11 http11nio processor process http11nio processor java 888 org apache coyote http11 http11nio protocol handler process http11nio protocol java 624 org apache tomcat util net nio endpoint worker run nio endpoint java 1467 java lang thread run thread java 595 nio connector illegal argument exception you can only write using application write buffer provided handler
couple small bugs compression filter classes triggered using filter web sphere here patches compression response stream should compress output stream response has been committed because cannot write content encoding gzip header browser displays compressed output compression servlet response wrapper causes null pointer exception you flush before writing anything fixes use compression filter web sphere app server
conf web xml jsp servlet init parameters include check interval whose value explained follows development false check interval greater than zero background compilations enabled add following parameters one would think background compilations would disabled value greater than zero init param param name check interval param name param value param value init param init param param name development param name param value false param value init param however value changed 300 following warning outputted dec 30 2006 13 57 pm org apache jasper embedded servlet options init warning warning invalid value init param check interval use default value 300 seconds according comment web xml valid value either comment validity check wrong my them jsp servlet check interval parameter cannot set implicitly
using inspect request get auth type java lang string client cert http servlet request client cert auth java lang string client cert api says should same object should work request get auth type returns different string from http servlet request client cert auth
when using single sign valve org apache catalina single sign via https cookie transmitted without secure attribute resulting being transmitted any content purpose error requested via http from same server content sso cookie confidential lead logged sessions other contexts https non https should never happen sorry have patch ve installed complete source distribution my development environment seems points change org apache catalina base register code interest being from 30 source distribution cookie cookie new cookie constants single sign cookie sso id cookie set max age cookie set path hres add cookie cookie hres org apache catalina http request ve looked through code find org apache catalina request set secure secure though mentioned javadoc set secure suppose needs another change provide secure request http request difficult tell only from editor secure cookie set secure hres secure missing statements above single sign cookie does honor https access login information disclosure
jasper does nt display full path file 404 found error page
latest tc6 code seeing problem did exist earlier tc6 drivers sorry can put finger when problem arose looked relevant source files like jsp runtime context haven found source problem here issue testcase attached app very simple installs servlet context listener purpose adding custom elresolver accomplishes via public void context initialized servlet context event evt servlet context context evt get servlet context jsp application context jsp context jsp factory get default factory get jsp application context context jsp context add elresolver new chips elresolver problem jsp factory get default factory returning null see below oct 2006 32 18 pm org apache catalina core apr lifecycle listener lifecycle ev ent info apache tomcat native library which allows optimal performance produ ction environments found java library path java for6 0build jdk 15 java jre bin java for6 0build jdk15 java bin mantis2 mantis bin se tup ibase perl bin windows system32 windows windows system32 wbem python22 program files pc doctor windows services cvsnt ecli pse bin program files quick time qtsystem diskeeper cmvc exe cmvc exe bin cmvcdc50 cmvcdc50 cmvcdc50 oct 2006 32 18 pm org apache coyote http11 init info initializing coyote http http 8080 oct 2006 32 19 pm org apache catalina startup catalina load info processed 1234 ms oct 2006 32 19 pm org apache catalina core standard service start info starting service catalina oct 2006 32 19 pm org apache catalina core standard engine start info starting servlet engine apache tomcat dev oct 2006 32 19 pm org apache catalina core standard host start info xml validation disabled oct 2006 32 19 pm org apache catalina startup host config deploy war info deploying web application archive elresolver test war chips listener context initialized evt javax servlet servlet context event source org apache catalina core application context facade 3fbe3fbe chips listener context initialized context org apache catalina core application ontext facade 3fbe3fbe chips listener context initialized jsp factory get default factory null oct 2006 32 20 pm org apache catalina core standard context start severe error listener start oct 2006 32 20 pm org apache catalina core standard context start severe context elresolver test startup failed due previous errors oct 2006 32 21 pm org apache coyote http11 start info starting coyote http http 8080 oct 2006 32 21 pm org apache jk common channel socket init info jk ajp13 listening 8009 oct 2006 32 21 pm org apache jk server jk main start info jk running id time 63 config null oct 2006 32 21 pm org apache catalina startup catalina start info server startup 2657 ms easily reproducible when you deploy elresolver test war before server has started assume jsp factory set default factory hasn been invoked time listeners being installed you deploy war after server starts problem does manifest app works until you stop restart server default jsp factory initialized early enough
jsp comiler outputs all tag required object upper case letters conform xhtml lower case required all tags hard coded generator output tag jsp plugin conform xhtml
org apache juli file handler created parametrized constructor public file handler string directory string prefix string suffix file handler ignores custom constructor parameters creates log handler default writes log file catalina home bin logs name juli yyyy mm dd log yyyy mm dd substituted actual year month date looks like problem fact parametrized constructor calls default constructor default constructor turn performs handler from log manager properties creates log file based default makes custom constructor parameters effectively ignored org apache juli file handler does allow programmatic creation using parametrized constructor
org apache jasper runtime jsp factory impl has private static final string spec version should private static final string spec version jsp factory impl has spec version
tomcat leaks memory every request
example form method post action test exe test1 input type hidden value test2 input type submit form code does invoke test exe without passing test1 command line parameter example works apache httpd ms iis fix cgiservlet java get equals req get method post equals req get method head equals req get method return post request ignores command line parameters
solaris you can have file directory name called xxx yyy using tomcat listings feature you get directory listing file name bold italics am familiar javascript cross site scripting security problems believe tomcat escapes xml characters like prevent client browsers interpret html codes intended interpreted default error page think same should done listings warning should added use you have control over file directory names you list listings page does escape xml characters
sometime during tomcat development standard class loader org apache catalina loader package stripped down now just urlclass loader work code extends standard class loader we use automatic reloading jar files during upgrade from tomcat tomcat found difficultly trying figure out what had happened code ended up having install svn do svn log figure out why code removed when code stripped down comments java file therefore javadoc api remained identical so javadoc api class very misleading instance comments say class implements reloader when fact does class comments should updated reflect state code can see being very high priority would likely easy fix people whom code regularly would make javadoc much more readable people extend standard class loader own purposes misleading comments standard class loader
tomcat loses request parameters
method class loader log manager replace string charge replacing system properties begining property also modify end property due call trim implies logger handler formatter relies properties endding some spases including have different behaviour jdk log manger tomcat class loader log manager modified verstion method could protected string replace string str start modification string result str trim commented out int len str length int st while st len str char st st string result st str substring st str end modification result starts int pos result index pos string prop name result substring pos string replacement system get property prop name replacement null result replacement result substring pos return result class loader log manager remove end logging properties values
jdbcrealm get password throws null pointer exception using tomcat 20 postgresql 407 jdbc3 jar postgresql ubuntu dapper two users http digest causes sometimes following errors 401 unauthorized reply 30 10 2006 14 24 54 org apache catalina realm jdbcrealm get password severe exception performing org postgresql util error invalid message format org postgresql core v3 query executor impl receive error response query executor impl java 1525 org postgresql core v3 query executor impl process results query executor impl java 1309 org postgresql core v3 query executor impl execute query executor impl java 188 org postgresql jdbc2 abstract execute abstract java 452 org postgresql jdbc2 abstract execute flags abstract java 354 org postgresql jdbc2 abstract execute query abstract java 258 org apache catalina realm jdbcrealm get password jdbcrealm java 546 org apache catalina realm realm base get digest realm base java 1156 org apache catalina realm realm base authenticate realm base java 365 org apache catalina digest find principal digest java 282 org apache catalina digest authenticate digest java 175 org apache catalina base invoke base java 490 org apache catalina core standard host valve invoke standard host valve java 126 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 107 org apache catalina connector coyote adapter service coyote adapter java 148 org apache coyote http11 process java 869 org apache coyote http11 http11base protocol handler process connection http11base protocol java 664 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 595 30 10 2006 14 24 54 org apache catalina connector coyote adapter service severe exception error occurred container during request processing java lang null pointer exception org apache catalina realm jdbcrealm get password jdbcrealm java 568 org apache catalina realm jdbcrealm get principal jdbcrealm java 594 org apache catalina realm realm base authenticate realm base java 398 org apache catalina digest find principal digest java 282 org apache catalina digest authenticate digest java 175 org apache catalina base invoke base java 490 org apache catalina core standard host valve invoke standard host valve java 126 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 107 org apache catalina connector coyote adapter service coyote adapter java 148 org apache coyote http11 process java 869 org apache coyote http11 http11base protocol handler process connection http11base protocol java 664 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 595 jdbcrealm get password throws null pointer exception
org apache jasper compiler validator check xml attributes validation deferred values methods raising exception when rtexprvalue attribute legitimate stacktrace org apache jasper jasper exception org apache jasper jasper exception index jsp 83 according tld attribute directive tag file attribute items does accept any expressions org apache jasper servlet jsp servlet wrapper handle jsp exception jsp servlet wrapper java 565 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 354 org apache jasper servlet jsp servlet service jsp file jsp servlet java 320 org apache jasper servlet jsp servlet service jsp servlet java 266 javax servlet http http servlet service http servlet java 803 relevant code check xml attributes deferred tld attrs deferred method tld attrs deferred value only deferred expressions allowed attribute err jsp error jsp error attribute custom non rt expr tld attrs get name testcase each var items colors li font color line font each tld jstl says items can rtexprvalue also deferred value so above usage correct attaching testcase war summary don think code really necessary least needs relaxed allow tai can request time values jasper exception raised against valid attribute
tomcat should enforce requirements from servlet srv srv using request dispatcher use request dispatcher servlet calls either include method forward method request dispatcher interface parameters methods can either request response arguments were passed via service method servlet interface instances subclasses request response wrapper classes have been introduced version latter case wrapper instances must wrap request response objects container passed service method container provider must ensure dispatch request target servlet occurs same thread same vm original request absense enforcement leads software beeing developed following software cannot deployed later container which conforms above paragraph hence must changed before deployment somehow contradicts idea having standards based tomcat should enforce requirements from servlet srv
first servlets cgi jar needs exist servlet must mapped example servlet mapping servlet name cgi servlet name url pattern pl url pattern servlet mapping test perl cgi script usr bin perl print content type text plain print hello world from perl one perl script placed www root test pl other any subfolder test test pl cgi bin test pl etc cgi script subfolder run fine cgi script www root generate exception java lang string index out bounds exception string index out range java lang string substring string java 1768 java lang string substring string java 1735 org apache catalina servlets cgiservlet find cgi cgiservlet java 948 org apache catalina servlets cgiservlet set cgiservlet java 1015 org apache catalina servlets cgiservlet init cgiservlet java 766 org apache catalina servlets cgiservlet do get cgiservlet java 584 javax servlet http http servlet service http servlet java 689 javax servlet http http servlet service http servlet java 802 problem line line 948 cgiservlet java cginame current location get parent substring web app root dir length file separator name problem web app root dir char longer than current location get parent because web app root dir ends file separator case removing extra file separator from web app root dir result different string related exception elsewhere here fix works cginame current location get parent file separator substring web app root dir length name necessary fix can made more adaptive checking see really does have file separator end add otherwise let etc side note have one more bug fix env var script filename isn defined should required php4 ll submit different bug fix servlet cgi throws index out bounds exception certain cgi
find class internal possible entry manifest set null another thread right before calling define package package name entry manifest entry code base datarace org apache catalina loader webapp class loader
class jdbcaccess log valve example table hold access log values table column ts which defined null only work my sql because value never written valve other databases complain about column which filled value wrong misleading jdbcaccess log valve
attempting create filter valve could placed front axis web service would handle security according ws security turned out rabbit trail did find fix bug discovered along way ran problems reading post data web service request from org apache catalina connector request object exposed filter valve interfaces chunk code prototype valve didn work private byte chunk get postbody request request throws ioexception byte chunk retval new byte chunk request get content length byte chunk body new byte chunk request get content length int bytes read do bytes read request get coyote request do read body retval append body while bytes read puts data back pipe request get coyote request action action code action req set body replay retval return retval code works designed however problem occurs later when axis attempted parse web service request don remember exact axis error able track problem down bug org apache coyote http11 filters saved request input filter class do read method properly implemented return when appropriate here my modified version do read method public int do read byte chunk chunk org apache coyote request request throws ioexception int write length chunk get limit chunk get limit input get length write length chunk get limit else write length input get length input get offset input get end return input substract chunk get buffer write length chunk set offset chunk set end write length return write length bug won show up unless someone tries use filter valve do something web services too likely because what we have soaphandlers can read post data from within filter valve
run problem t5 when tring add remove add valve standard engine what understand empty pipeline has basic standard engine valve example first null you add valve you get basic standard engine valve first my valve my valve next standard engine valve you remove valve you get basic standard engine valve first standard engine valve note standard engine valve first too here try add new valve given actual code add valve valve added because see current basic current get next null add valve valve valve add valve set associated pipeline first null first valve valve set next basic else valve current first while current null current get next basic current set next valve valve set next basic break current current get next bug standard pipeline remove valve valve valve t5 16
environment entries changed web xml application context restarted values jndi context old values environment entries changed via tomcat admin interface values provided context correct following code can used check environment try initial context ic new initial context naming enumeration enum ic list bindings java comp env while enum has more binding binding binding enum next jndi set property binding get name binding get object system out println jndi setting binding get name binding get object catch naming exception system err println unable read jndi settings web xml fragment looks follows env entry env entry name database url env entry name env entry value jdbc hsqldb hsql localhost env entry value env entry type java lang string env entry type env entry jndi env entry reload when context reloaded
code below doesn make sense snip catch ioexception log caught exception throw new ioexception string snip should throw imho seems need log exception here so cache block can removed cgiservlet eats root cause
bug illegal message output log when listener application implements servlet request listener interface throws runtime exception from request initialized method request destroyed method message cannot find message associated key request listener valve request init cause key exists properties file org apache catalina valves local strings properties logic refers other properties file org apache catalina core local strings properties message key request listener valve request init has referred correctly
steps reproduce autodeploy web application defining its context server xml start tomcat server use tomcat manager undeploy application you get ok undeployed application context path web application message application undeployed only stopped you try stop server after fail have used shared installation catalina base dir guess won work standalone tomcat isntallation either undeploying fails when context defined server xml server fails stop
according jsp custom tag prefix name should type xml name however tomcat name legal java identifier compilation error occurs instance tomcat won accept da te ag legal name tag tag names xml name java identifier accepted
get org apache jasper jasper exception error function string must used prefix when default namespace specified when trying compile following within jsp page foo set var bar value silly string foo our own tablib seems jasper seems think string provided value attribute contains some jsp el which does change page set var bar value silly string do get error however need use my own taglib foo tld file value attribute set has rtexprvalue true set false problem goes away however noticed tld standard jar also has rtexprvalue true value attribute set why difference behaviour we also wish have rtexprvalue true incorrect parsing tag attributes
set parent called nested tags tag file tagx
http 8080 processor24 error 26902165 dispatcher servlet service wrapper could complete request org apache jasper jasper exception unable compile class jsp org apache jasper jsp compilation context compile jsp compilation context java 565 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 293 org apache jasper servlet jsp servlet service jsp file jsp servlet java 291 org apache jasper servlet jsp servlet service jsp servlet java 241 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core application dispatcher invoke application dispatcher java 672 org apache catalina core application dispatcher process request application dispatcher java 463 org apache catalina core application dispatcher do forward application dispatcher java 398 org apache catalina core application dispatcher forward application dispatcher java 301 org web servlet view internal resource view render merged output model internal resource view java 97 org web servlet view abstract view render abstract view java 250 org web servlet dispatcher servlet render dispatcher servlet java 928 org web servlet dispatcher servlet do dispatch dispatcher servlet java 705 org web servlet dispatcher servlet do service dispatcher servlet java 625 org web servlet framework servlet service wrapper framework servlet java 386 org web servlet framework servlet do get framework servlet java 346 javax servlet http http servlet service http servlet java 689 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core standard wrapper valve invoke standard wrapper valve java 213 org apache catalina core standard context valve invoke standard context valve java 178 org apache catalina core standard host valve invoke standard host valve java 126 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 107 org apache catalina connector coyote adapter service coyote adapter java 148 org apache coyote http11 process java 856 org apache coyote http11 handler process connection java 744 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 595 http 8080 processor24 error 26902165 wirelessapp invoke servlet service servlet wirelessapp threw exception java io ioexception tmp file rename class file failed org apache jasper compiler smap util sdeinstaller install smap util java 245 org apache jasper compiler smap util install smap smap util java 164 org apache jasper compiler ant compiler generate class ant compiler java 267 org apache jasper compiler compiler compile compiler java 288 org apache jasper compiler compiler compile compiler java 267 org apache jasper compiler compiler compile compiler java 255 org apache jasper jsp compilation context compile jsp compilation context java 556 org apache jasper servlet jsp servlet wrapper service jsp servlet wrapper java 293 org apache jasper servlet jsp servlet service jsp file jsp servlet java 291 org apache jasper servlet jsp servlet service jsp servlet java 241 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core application dispatcher invoke application dispatcher java 672 org apache catalina core application dispatcher process request application dispatcher java 463 org apache catalina core application dispatcher do forward application dispatcher java 398 org apache catalina core application dispatcher forward application dispatcher java 301 org web servlet view internal resource view render merged output model internal resource view java 97 org web servlet view abstract view render abstract view java 250 org web servlet dispatcher servlet render dispatcher servlet java 928 org web servlet dispatcher servlet do dispatch dispatcher servlet java 705 org web servlet dispatcher servlet do service dispatcher servlet java 625 org web servlet framework servlet service wrapper framework servlet java 386 org web servlet framework servlet do get framework servlet java 346 javax servlet http http servlet service http servlet java 689 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core standard wrapper valve invoke standard wrapper valve java 213 org apache catalina core standard context valve invoke standard context valve java 178 org apache catalina core standard host valve invoke standard host valve java 126 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina core standard engine valve invoke standard engine valve java 107 org apache catalina connector coyote adapter service coyote adapter java 148 org apache coyote http11 process java 856 org apache coyote http11 handler process connection java 744 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 595 java io ioexception tmp file rename class file failed when compiling new jsp upon redeploy
after form intercepts post request protected resource original request properly restored upon successful login when using mod jk when connectiong tomcat directly 8080 post request restored expected ve tested mod jk 15 18 seems problem orginal request saved properly think ve narrowed down issue form java body string returning null buffer null so looks like root problem nothing read from input stream during testing reverted old way adding request parameters saved add parameter see were indeed worked also tried input stream new buffered input stream request get input stream which didn work from form java protected void save request request request session session throws ioexception post equals ignore case request get method byte chunk body new byte chunk body set limit request get connector get max save post size byte buffer new byte 4096 int bytes read input stream request get input stream while bytes read read buffer body append buffer bytes read saved set body body mod jk post request bodies restored successful login when using mod jk
scenario jsp tag tagfile taglib activate reloading web xml clean work directory start tomcat load jsp tomcat generates compiles load jsp tagfile classes after check interval seconds background compile thread jsp runtime context loads tagfile classes only them again again produces lot work garbage collector permanently class unloading tagfile classes breakpoint method load tag file jsp servlet wrapper java show perhaps reload flag must set false after loading tag file jsp servlet wrapper java reload tag handler class ctxt load reload false perhaps solves problem am shure after restarting server problem present because jsp servlet wrapper instantiated tagfile therefore backround compile task does check tagfile permanently reloading tagfile classes without changes tagfile
hello think small bug tomcat least could see already many versions tomcat use ssi org apache catalina ssi ssiservlet param name virtual webapp relative param name param value param value all my pages html processed ssi url pattern html url pattern normal get request ssi compiles page everything just ok however head request same page need compile page ssi still tries do generates number exceptions see enclosed error critical overloads my catalina out file do think difficult fix already reported error tomcat dev decided create formal bug report asf bugzilla see already fixed big error annoying thanks best regards igor tetko apr 28 2006 11 26 45 am org apache catalina core application context log severe include couldn include file styles html java io ioexception couldn find file incl styles html org apache catalina ssi ssiservlet external resolver get file text ssiservlet external resolver java 537 org apache catalina ssi ssimediator get file text ssimediator java 155 org apache catalina ssi ssiinclude process ssiinclude java 44 org apache catalina ssi ssiprocessor process ssiprocessor java 146 org apache catalina ssi ssiservlet process ssi ssiservlet java 221 org apache catalina ssi ssiservlet request handler ssiservlet java 187 org apache catalina ssi ssiservlet do get ssiservlet java 123 javax servlet http http servlet do head http servlet java 270 javax servlet http http servlet service http servlet java 706 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core application dispatcher invoke application dispatcher java 672 org apache catalina core application dispatcher do include application dispatcher java 574 org apache catalina core application dispatcher include application dispatcher java 499 org apache catalina ssi ssiservlet external resolver get file text ssiservlet external resolver java 519 org apache catalina ssi ssimediator get file text ssimediator java 155 org apache catalina ssi ssiinclude process ssiinclude java 44 org apache catalina ssi ssiprocessor process ssiprocessor java 146 org apache catalina ssi ssiservlet process ssi ssiservlet java 221 org apache catalina ssi ssiservlet request handler ssiservlet java 187 org apache catalina ssi ssiservlet do get ssiservlet java 123 javax servlet http http servlet do head http servlet java 270 javax servlet http http servlet service http servlet java 706 javax servlet http http servlet service http servlet java 802 org apache catalina core application filter chain internal do filter application filter chain java 252 org apache catalina core application filter chain do filter application filter chain java 173 org apache catalina core standard wrapper valve invoke standard wrapper valve java 213 org apache catalina core standard context valve invoke standard context valve java 178 org apache catalina core standard host valve invoke standard host valve java 126 org apache catalina valves error report valve invoke error report valve java 105 org apache catalina valves fast common access log valve invoke fast common access log valve java 495 org apache catalina core standard engine valve invoke standard engine valve java 107 org apache catalina connector coyote adapter service coyote adapter java 148 org apache coyote http11 process java 869 org apache coyote http11 http11base protocol handler process connection http11base protocol java 664 org apache tomcat util net pool tcp endpoint process socket pool tcp endpoint java 527 org apache tomcat util net leader follower worker thread run leader follower worker thread java 80 org apache tomcat util threads thread pool control runnable run thread pool java 684 java lang thread run thread java 613 ssi does correctly process head request
tomcat server side includes ssi do work single quotes
patch cgiservlet does terminate child after timeout
given following page page context set attribute foo out print page context get expression evaluator evaluate string class page context get variable resolver null you notice prints out fine when jsp does resolve using scriplet prints nothing sanity check tested worked glassfish ensure wasn doing anything odd trying find root cause haven found yet so logging case anyone else has itch scratch legacy el support resolving variables correctly
hi all my web app needs have thread current thread get context class loader always right when application unload seem case my classes under t5 shared directory so all my servlet get class get class loader shared classloader standard calss loader my when executing code my web app thread current thread get context class loader should always give webapp loader used standard context problem occurs standard wrapper unload before calling servlet destroy method class loader old ctx class loader thread current thread get context class loader class loader class loader instance get class get class loader print stream out system out swallow output system log handler start capture call servlet destroy method try instance support fire instance event instance event before destroy event instance thread current thread set context class loader class loader system get security manager null security util do privilege destroy instance security util remove instance else instance destroy code instance variable my servlet have been loaded shared classloader so classloader set thread right one should classloader related standard context get loader problem occurs when try close my t5 dos windows suppose occurs when uninstall any web app from my t5 notice problem t5 16 verified same code 17 so probably problem still best regards david gagnon wrong class loader when my servlet destroy called my servlet t5 shared directory
hi encounter strange problem my tomcat cluster webapps deployment server xml server port 8005 shutdown shutdown listener class name org apache catalina core apr lifecycle listener listener class name org apache catalina mbeans server lifecycle listener listener class name org apache catalina mbeans global resources lifecycle listener listener class name org apache catalina storeconfig store config lifecycle listener global jndi resources global naming resources environment name simple value type java lang integer value 30 resource name user database auth container type org apache catalina user database description user database can updated saved factory org apache catalina users memory user database factory pathname conf tomcat users xml global naming resources define tomcat stand alone service service name catalina define non ssl http connector port 8080 connector address polen integ port 8080 max http header size 8192 max threads 300 min spare threads 25 max spare threads 100 enable lookups false accept count 100 connection timeout 20000 disable upload timeout true define ajp connector port 8009 connector port 8009 address polen integ sofinco fr min processors 20 max processors max threads 350 min spare threads 50 max spare threads 100 enable lookups false redirect port 8080 protocol ajp disable upload timeout true engine name catalina default host localhost jvm route uxdev103 realm class name org apache catalina realm user database realm resource name user database host name localhost app base webapps unpack wars true auto deploy true xml validation false xml namespace aware false cluster definition cluster class name org apache catalina cluster tcp simple tcp cluster do cluster log true cluster log name clusterlog expire sessions shutdown false use dirty flag true notify listeners replication true membership class name org apache catalina cluster mcast mcast service mcast addr 228 mcast bind address 127 mcast cluster domain polen integ mcast port 45564 mcast frequency 1000 mcast drop time 30000 receiver class name org apache catalina cluster tcp replication listener tcp listen address polen integ tcp selector timeout 100 tcp thread count sender class name org apache catalina cluster tcp replication transmitter replication mode do transmitter processing stats true do processing stats false do wait ack stats false wait ack false keep alive max request count valve class name org apache catalina cluster tcp replication valve filter gif js css png jpeg jpg htm html txt valve class name org apache catalina cluster session jvm route binder valve enabled true cluster listener class name org apache catalina cluster session cluster session listener cluster listener class name org apache catalina cluster session jvm route session idbinder listener deployer class name org apache catalina cluster deploy farm war deployer temp dir home tomcat polen integ tmp war temp deploy dir catalina base webapps watch dir home tomcat polen integ tmp war listen watch enabled true cluster host engine service server when am trying deploy only when flag enabled get following errors info container background processor standard engine catalina org apache catalina startup host config deploying web application archive po len war info container background processor standard engine catalina org apache catalina loader webapp class loader illegal access web appli cation instance has been stopped already could load java io print stream eventual following stack trace caused error hrown debugging purposes well attempt terminate thread which caused illegal access has functional impact java lang illegal state exception org apache catalina loader webapp class loader load class webapp class loader java 1238 org apache catalina loader webapp class loader load class webapp class loader java 1198 java lang class loader load class internal unknown source org apache log4j helpers log log error log log java 142 org apache log4j helpers pattern parser date pattern converter convert pattern parser java 447 org apache log4j helpers pattern converter format pattern converter java 64 org apache log4j pattern layout format pattern layout java 503 org apache log4j writer appender sub append writer appender java 301 org apache log4j rolling file appender sub append rolling file appender java 234 org apache log4j writer appender append writer appender java 159 org apache log4j appender skeleton do append appender skeleton java 230 org apache log4j helpers appender attachable impl append loop appenders appender attachable impl java 65 org apache log4j category call appenders category java 203 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger info log4jlogger java 133 org apache catalina cluster session delta manager start delta manager java 976 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source info container background processor standard engine catalina org apache catalina loader webapp class loader illegal access web applic ation instance has been stopped already could load java io print stream eventual following stack trace caused error th rown debugging purposes well attempt terminate thread which caused illegal access has functional impact java lang illegal state exception org apache catalina loader webapp class loader load class webapp class loader java 1238 org apache catalina loader webapp class loader load class webapp class loader java 1198 java lang class loader load class internal unknown source org apache log4j helpers log log error log log java 142 org apache log4j helpers pattern parser date pattern converter convert pattern parser java 447 org apache log4j helpers pattern converter format pattern converter java 64 org apache log4j pattern layout format pattern layout java 503 org apache log4j writer appender sub append writer appender java 301 org apache log4j rolling file appender sub append rolling file appender java 234 org apache log4j writer appender append writer appender java 159 org apache log4j appender skeleton do append appender skeleton java 230 org apache log4j helpers appender attachable impl append loop appenders appender attachable impl java 65 org apache log4j category call appenders category java 203 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger info log4jlogger java 133 org apache catalina cluster session delta manager start delta manager java 976 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child internal container base java 759 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source info container background processor standard engine catalina org apache catalina loader webapp class loader illegal access web applic ation instance has been stopped already could load org apache log4j spi vector writer eventual following stack trace caused error thrown debugging purposes well attempt terminate thread which caused illegal access has functi onal impact java lang illegal state exception org apache catalina loader webapp class loader load class webapp class loader java 1238 org apache catalina loader webapp class loader load class webapp class loader java 1198 java lang class loader load class internal unknown source org apache log4j spi logging event init logging event java 154 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger error log4jlogger java 193 org apache catalina cluster session delta manager start delta manager java 990 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child internal container base java 759 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source info container background processor standard engine catalina org apache catalina loader webapp class loader illegal access web applic ation instance has been stopped already could load org apache log4j spi vector writer eventual following stack trace caused error thrown debugging purposes well attempt terminate thread which caused illegal access has functi onal impact java lang illegal state exception org apache catalina loader webapp class loader load class webapp class loader java 1238 org apache catalina loader webapp class loader load class webapp class loader java 1198 java lang class loader load class internal unknown source org apache log4j spi logging event init logging event java 154 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger error log4jlogger java 193 org apache catalina cluster session delta manager start delta manager java 990 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child internal container base java 759 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source error container background processor standard engine catalina org apache commons modeler registry null component catalina type jsp monitor name jsp web module localhost polen none j2eeserver none error container background processor standard engine catalina org apache catalina startup host config error deploying web application arc hive polen war java lang class def found error org apache log4j spi vector writer org apache log4j spi logging event init logging event java 154 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger error log4jlogger java 193 org apache catalina cluster session delta manager start delta manager java 990 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child internal container base java 759 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source error container background processor standard engine catalina org apache catalina startup host config error deploying web application arch ive polen war java lang class def found error org apache log4j spi vector writer org apache log4j spi logging event init logging event java 154 org apache log4j category forced log category java 388 org apache log4j category log category java 853 org apache commons logging impl log4jlogger error log4jlogger java 193 org apache catalina cluster session delta manager start delta manager java 990 org apache catalina core container base set manager container base java 431 org apache catalina core standard context start standard context java 4125 org apache catalina core container base add child internal container base java 759 org apache catalina core container base add child container base java 739 org apache catalina core standard host add child standard host java 524 org apache catalina startup host config deploy war host config java 809 org apache catalina startup host config deploy wars host config java 698 org apache catalina startup host config deploy apps host config java 472 org apache catalina startup host config check host config java 1190 org apache catalina startup host config lifecycle event host config java 292 org apache catalina util lifecycle support fire lifecycle event lifecycle support java 119 org apache catalina core container base background process container base java 1305 org apache catalina core container base container background processor process children container base java 1569 org apache catalina core container base container background processor process children container base java 1578 org apache catalina core container base container background processor run container base java 1558 java lang thread run unknown source have tried deployed via web manager application simple copy my war webapps directory luck put flag application web xml config file encounter error need restart manually tomcat instance after restart application correctly deployed without any error course disable cluster server xml problem simple deploy failed cluster flag
