public void set extends string value node page directive page superclass top level class package explicitly import done compiler assume extended class same pkg generated servlet value index add import value page info set extends value
while has next has next has next has next string trimmed id trim int result reserved words compare id return true something left el expression buffer other than white spaces private boolean has next skip spaces return has next char skip spaces private void skip spaces while has next char expression char index break index test public void test ternary01 throws jasper exception do test parser true true false test public void test ternary02 throws jasper exception do test parser true false test public void test ternary03 throws jasper exception do test parser eq1 true false test public void test ternary04 throws jasper exception do test parser eq true false test public void test ternary05 throws jasper exception note invalid el do test parser aeq1 true false test public void test ternary06 throws jasper exception do test parser do eq1 true false test public void test ternary07 throws jasper exception do test parser do eq true false
parent get parent system get system class loader security manager system get security manager class loader get parent null get system class loader parent class loader string class get class loader null get system class loader while get parent null get parent j2se class loader security manager system get security manager parent get parent system get system class loader security manager system get security manager security manager system get security manager protected class loader parent null system class loader protected final class loader system webapp class loader result new webapp class loader parent class loader loader parent loader null loader system url loader get resource name class loader loader parent loader null loader system url loader get resource name class loader loader parent loader null loader system stream loader get resource stream name class loader loader parent loader null loader system stream loader get resource stream name system get resource resource name null clazz system load class name class loader loader parent loader null loader system clazz class name name false loader class loader loader parent loader null loader system clazz class name name false loader parent null
sub protocols empty sub protocol sec get configurator get negotiated subprotocol sec get subprotocols sub protocols endpoint ep try class clazz sec get endpoint class endpoint class assignable from clazz ep endpoint sec get configurator get endpoint instance clazz else ep new pojo endpoint server catch exception throw new servlet exception endpoint ep try class clazz sec get endpoint class endpoint class assignable from clazz ep endpoint sec get configurator get endpoint instance clazz else ep new pojo endpoint server catch exception throw new servlet exception
buffer size jsp writer default buffer buffer size constants default buffer size test public void test default buffer size throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home context ctx tomcat add webapp null test app dir get absolute path add servlet tomcat add servlet ctx bug56010 new bug56010 ctx add servlet mapping bug56010 bug56010 tomcat start byte chunk res get url http localhost get port test bug56010 string result res string assert assert true result contains ok public static class bug56010 extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception page context page context jsp factory get default factory get page context req resp null false jsp writer default buffer true jsp writer out page context get out constants default buffer size out get buffer size resp get writer println ok else resp get writer println fail
public void access access system current time millis
url url servlet context get resource tld resource path get webapp path conn url open connection result conn get last modified file equals url get protocol reading last modified time opens input stream so we need make sure closed again otherwise tld file locked until gc runs conn get input stream close valve interface generates web server access log detailed line contents matching configurable pattern syntax available patterns similar supported href http httpd apache org apache http server code mod log config code module additional feature automatic rollover log files when date changes also supported patterns logged message may include constant text any following replacement strings which information from specified response substituted ul li remote ip address li local ip address li bytes sent excluding http headers bytes were sent li bytes sent excluding http headers li remote host name ip address code enable lookups code connector false li request protocol li remote logical username from identd always returns li request method li local port li query string prepended exists otherwise empty string li first line request li http status code response li user session id li date time common log format format li format date time any format supported simple date format li remote user li requested url path li local server name li time taken process request millis li time taken process request seconds li current request thread name can compare later stacktraces ul addition caller can specify one following aliases commonly utilized patterns ul li common code code li combined code referer user agent code ul also support write information from cookie incoming header session something else servlet request br modeled after href http httpd apache org apache http server log syntax li code xxx code incoming headers li code xxx code outgoing response headers li code xxx code specific cookie li code xxx code xxx attribute servlet request li code xxx code xxx attribute http session li code xxx code xxx enhanced simple date format pattern see reference document details supported time patterns log rotation can off dictated code rotatable code property conditional logging also supported can done code condition unless code code condition code properties value returned from servlet request get attribute condition unless yields non null value logging skipped value returned from servlet request get attribute condition yields null value logging skipped code condition code attribute synonym code condition unless code provided backwards extended attributes coming from get attribute call you ensure newline control characters author craig mc clanahan author jason brittain author remy maucherat author takayuki kaneko author peter rossbach version id
super true enabled component protected boolean enabled true pattern used format our access log lines protected string pattern null size our global date format cache private static final int global cache size 300 size our thread local date format cache private static final int local cache size 60 cache structure formatted timestamps based seconds cache consists entries consecutive range seconds length range configurable implemented based cyclic buffer new entries shift range one cache clf format access log standard format hash map caches additional formats used simple date format although cache supports specifying locale when retrieving formatted timestamp each format always use locale given when format first used new locales can only used new formats clf format always formatted using locale code en us code cache threadsafe can used without via thread local instances global cache cache can created parent cache build cache hierarchy access parent cache threadsafe class uses small thread local first level cache bigger synchronized global second level cache protected static class date format cache protected class cache clf log format private static final string lfformat dd mmm yyyy hh mm ss second used retrieve clf format most recent invocation private long previous seconds long min value value clf format retrieved most recent invocation private string previous format first second contained cache private long first long min value last second contained cache private long last long min value index first cyclic cache private int offset helper object able call simple date format format private final date current date new date protected final string cache private simple date format formatter private boolean clf false private cache parent null private cache cache parent null parent private cache string format cache parent format null parent private cache string format locale loc cache parent cache new string cache size int cache size cache null loc null loc cache default locale format null clf true format lfformat formatter new simple date format format locale us else formatter new simple date format format loc formatter set time zone time zone get default parent parent private string get format internal long time long seconds time 1000 first step we have seen timestamp during previous call we need clf return previous value seconds previous seconds return previous format second step try locate cache previous seconds seconds int index offset int seconds first cache size index index cache size seconds first seconds last cache index null found so remember next call return previous format cache index return previous format third step found cache adjust cache add item else seconds last cache size seconds first cache size first seconds last first cache size index offset int cache size cache null else seconds last int seconds last cache index cache size cache size null first seconds cache size last seconds offset index cache size else seconds first int first seconds cache index cache size null first seconds last seconds cache size offset index last step format new timestamp either using parent cache locally parent null synchronized parent previous format parent get format internal time else current date set time time previous format formatter format current date clf string builder current new string builder 32 current append current append previous format current append previous format current string cache index previous format return previous format number cached entries private int cache size private final locale cache default locale private final date format cache parent protected final cache lfcache private final hash map string cache format cache new hash map protected date format cache int size locale loc date format cache parent cache size size cache default locale loc parent parent cache parent cache null parent null synchronized parent parent cache parent get cache null null lfcache new cache parent cache private cache get cache string format locale loc cache cache format null cache lfcache else cache format cache get format cache null cache parent cache null parent null synchronized parent parent cache parent get cache format loc cache new cache format loc parent cache format cache put format cache return cache public string get format long time return lfcache get format internal time public string get format string format locale loc long time return get cache format loc get format internal time global date format cache private static final date format cache global date cache new date format cache global cache size locale get default null thread local date format cache private static final thread local date format cache local date cache new thread local date format cache override protected date format cache initial value return new date format cache local cache size locale get default global date cache system time when we last updated date valve uses log lines private static final thread local date local date new thread local date override protected date initial value return new date list our format types private static enum format type clf sec msec msec frac sdf we doing conditional logging default null value code condition unless code property protected string condition null we doing conditional logging default null value code condition code property protected string condition null name locale used format timestamps log entries log file name suffix protected string locale name locale get default string locale used format timestamps log entries log file name suffix protected locale locale locale get default array access log element used make log message protected access log element log elements null see set request attributes enabled boolean protected boolean request attributes enabled false buffer pool used log message generation pool used reduce garbage generation private synchronized stack char array writer char array writers new synchronized stack log message buffers usually recycled re used prevent excessive memory usage buffer grows beyond size discarded default 256 characters should set larger than typical access log message size private int max log message buffer size 256 public int get max log message buffer size return max log message buffer size public void set max log message buffer size int max log message buffer size max log message buffer size max log message buffer size inherit doc override public void set request attributes enabled boolean request attributes enabled request attributes enabled request attributes enabled inherit doc override public boolean get request attributes enabled return request attributes enabled return returns enabled public boolean get enabled return enabled param enabled enabled set public void set enabled boolean enabled enabled enabled return format pattern public string get pattern return pattern set format pattern first translating any recognized alias param pattern new pattern public void set pattern string pattern pattern null pattern else pattern equals constants access log common alias pattern constants access log common pattern else pattern equals constants access log combined alias pattern constants access log combined pattern else pattern pattern log elements create log elements return whether attribute name look when performing conditional logging null every request logged public string get condition return condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition string condition condition condition return whether attribute name look when performing conditional logging null every request logged public string get condition unless return get condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition unless string condition set condition condition return whether attribute name look when performing conditional logging null every request logged public string get condition return condition set servlet request attribute look perform conditional logging set null log everything param condition set null log everything public void set condition string condition condition condition return locale used format timestamps log entries log file name suffix public string get locale return locale name set locale used format timestamps log entries log file name suffix changing locale only supported long access log valve has logged anything changing locale later can lead inconsistent formatting param locale name locale use public void set locale string locale name locale name locale name locale find locale locale name locale log message summarizing specified request response according format specified code pattern code property param request request being processed param response response being processed exception ioexception input output error has occurred exception servlet exception servlet error has occurred override public void invoke request request response response throws ioexception servlet exception get next invoke request response override public void log request request response response long time get state available get enabled log elements null condition null null request get request get attribute condition condition null null request get request get attribute condition return xxx bit silly we want have start stop time duration consistent would better keep start stop simply request response object remove time duration from interface long start request get coyote request get start time date date get date start time char array writer result char array writers pop result null result new char array writer 128 int log elements length log elements add element result date request response time log result result size max log message buffer size result reset char array writers push result override method returns date object accurate within one second thread calls method get date been less than second since new date created method simply gives out same date again so system doesn spend time creating date objects return date private static date get date long systime date date local date get date set time systime return date find locale name protected static locale find locale string name locale fallback name null name empty return locale get default else locale locale get available locales name equals string return log error sm get string access log valve invalid locale name return fallback set state lifecycle state starting set state lifecycle state stopping access log element writes partial message buffer protected interface access log element public void add element char array writer buf date date request request response response long time write thread name protected static class thread name element implements access log element override public void add element char array writer buf date date request request response response long time request info info request get coyote request get request processor info null buf append info get worker thread name else buf append write local ip address protected static class local addr element implements access log element private static final string local addr value static string init try init inet address get local host get host address catch throwable exception utils handle throwable init 127 local addr value init override public void add element char array writer buf date date request request response response long time buf append local addr value write remote ip address protected class remote addr element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object addr request get attribute remote addr attribute addr null buf append request get remote addr else buf append addr string else buf append request get remote addr write remote host name protected class host element implements access log element override public void add element char array writer buf date date request request response response long time string value null request attributes enabled object host request get attribute remote host attribute host null value host string value null value length value request get remote host value null value length value buf append value write remote logical username from identd always returns protected static class logical user name element implements access log element override public void add element char array writer buf date date request request response response long time buf append write request protocol protected class protocol element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object proto request get attribute protocol attribute proto null buf append request get protocol else buf append proto string else buf append request get protocol write remote user any else protected static class user element implements access log element override public void add element char array writer buf date date request request response response long time request null string value request get remote user value null buf append value else buf append else buf append write date time configurable format default clf format protected class date time element implements access log element format prefix specifying request start time private static final string request start prefix begin format prefix specifying response end time private static final string response end prefix end separator between optional prefix rest format private static final string prefix separator special format seconds since epoch private static final string sec format sec special format milliseconds since epoch private static final string msec format msec special format millisecond part timestamp private static final string msec fraction format msec frac patterns we use replace sss millisecond formatting simple date format our own handling private static final string msec pattern private static final string tripple msec pattern msec pattern msec pattern msec pattern our format description string null clf private final string format whether use begin request end response timestamp private final boolean uses begin format type private final format type type whether we need postprocess adding milliseconds private boolean uses msecs false protected date time element null replace millisecond formatting character some dummy characters order make resulting formatted time stamps cacheable we replace dummy chars later actual milliseconds because relatively cheap private string tidy format string format boolean escape false string builder result new string builder int len format length char int len format char escape result append else result append msec pattern uses msecs true escape escape return result string protected date time element string header string format header boolean uses begin false format type type format type clf format null format equals request start prefix uses begin true format else format starts request start prefix prefix separator uses begin true format format substring else format equals response end prefix uses begin false format else format starts response end prefix prefix separator uses begin false format format substring format length type format type clf else format equals sec format type format type sec else format equals msec format type format type msec else format equals msec fraction format type format type msec frac else type format type sdf format tidy format format format format uses begin uses begin type type override public void add element char array writer buf date date request request response response long time long timestamp date get time long frac uses begin timestamp time switch type case clf buf append local date cache get get format timestamp break case sec buf append long string timestamp 1000 break case msec buf append long string timestamp break case msec frac frac timestamp 1000 frac 100 frac 10 buf append buf append else buf append buf append long string frac break case sdf string temp local date cache get get format format locale timestamp uses msecs frac timestamp 1000 string builder tripple msec new string builder frac 100 frac 10 tripple msec append tripple msec append else tripple msec append tripple msec append frac temp temp replace tripple msec pattern tripple msec temp temp replace msec pattern long string frac buf append temp break write first line request method request uri protected static class request element implements access log element override public void add element char array writer buf date date request request response response long time request null string method request get method method null method means request line buf append else buf append request get method buf append buf append request get request uri request get query string null buf append buf append request get query string buf append buf append request get protocol else buf append write http status code response protected static class http status code element implements access log element override public void add element char array writer buf date date request request response response long time response null approach used reduce gc from string conversion int status response get status 100 status status 1000 buf append char status 100 append char status 10 10 append char status 10 else buf append integer string status else buf append write local port which request received protected class local port element implements access log element override public void add element char array writer buf date date request request response response long time request attributes enabled object port request get attribute server port attribute port null buf append integer string request get server port else buf append port string else buf append integer string request get server port write bytes sent excluding http headers protected static class byte sent element implements access log element private final boolean conversion conversion true write instead public byte sent element boolean conversion conversion conversion override public void add element char array writer buf date date request request response response long time don need flush since trigger log message after response has been committed long length response get bytes written false length protect against nulls unexpected types values may set untrusted applications object start request get attribute globals sendfile file start attr start instanceof long object end request get attribute globals sendfile file end attr end instanceof long length long end long value long start long value length conversion buf append else buf append long string length write request method get post etc protected static class method element implements access log element override public void add element char array writer buf date date request request response response long time request null buf append request get method write time taken process request protected static class elapsed time element implements access log element private final boolean millis millis true write time millis millis false write time seconds public elapsed time element boolean millis millis millis override public void add element char array writer buf date date request request response response long time millis buf append long string time else second buf append long string time 1000 buf append int remains int time 1000 buf append long string remains 100 remains remains 100 buf append long string remains 10 buf append long string remains 10 write time until first byte written commit time millis protected static class first byte time element implements access log element override public void add element char array writer buf date date request request response response long time long commit time response get coyote response get commit time commit time buf append else long delta commit time request get coyote request get start time buf append long string delta write query string prepended exists protected static class query element implements access log element override public void add element char array writer buf date date request request response response long time string query null request null query request get query string query null buf append buf append query write user session id protected static class session id element implements access log element override public void add element char array writer buf date date request request response response long time request null buf append else session session request get session internal false session null buf append else buf append session get id internal write requested url path protected static class request urielement implements access log element override public void add element char array writer buf date date request request response response long time request null buf append request get request uri else buf append write local server name protected static class local server name element implements access log element override public void add element char array writer buf date date request request response response long time buf append request get server name write any string protected static class string element implements access log element private final string str public string element string str str str override public void add element char array writer buf date date request request response response long time buf append str write incoming headers xxx protected static class header element implements access log element private final string header public header element string header header header override public void add element char array writer buf date date request request response response long time enumeration string iter request get headers header iter has more elements buf append iter next element while iter has more elements buf append append iter next element return buf append write specific cookie xxx protected static class cookie element implements access log element private final string header public cookie element string header header header override public void add element char array writer buf date date request request response response long time string value cookie request get cookies null int length header equals get name value get value break buf append value write specific response header xxx protected static class response header element implements access log element private final string header public response header element string header header header override public void add element char array writer buf date date request request response response long time null response iterator string iter response get headers header iterator iter has next buf append iter next while iter has next buf append append iter next return buf append write attribute servlet request xxx protected static class request attribute element implements access log element private final string header public request attribute element string header header header override public void add element char array writer buf date date request request response response long time object value null request null value request get attribute header else value value null value instanceof string buf append string value else buf append value string else buf append write attribute http session xxx protected static class session attribute element implements access log element private final string header public session attribute element string header header header override public void add element char array writer buf date date request request response response long time object value null null request http session sess request get session false null sess value sess get attribute header else value value null value instanceof string buf append string value else buf append value string else buf append parse pattern string create array access log element protected access log element create log elements list access log element list new array list boolean replace false string builder buf new string builder int pattern length char ch pattern char replace code processes behavior do encounter closing ignore ch string builder name new string builder int pattern length pattern char name append pattern char pattern length account which we increment now list add create access log element name string pattern char since we walked more than one character else oh end string pretend we never did do processing old way list add create access log element ch else list add create access log element ch replace false else ch replace true list add new string element buf string buf new string builder else buf append ch buf length list add new string element buf string return list array new access log element create access log element which needs header string protected access log element create access log element string header char pattern switch pattern case return new header element header case return new cookie element header case return new response header element header case return new request attribute element header case return new session attribute element header case return new date time element header default return new string element create access log element protected access log element create access log element char pattern switch pattern case return new remote addr element case return new local addr element case return new byte sent element true case return new byte sent element false case return new elapsed time element true case return new first byte time element case return new host element case return new protocol element case return new logical user name element case return new method element case return new local port element case return new query element case return new request element case return new http status code element case return new session id element case return new date time element case return new elapsed time element false case return new user element case return new request urielement case return new local server name element case return new thread name element default return new string element pattern
state processor async dispatch next dispatch get socket status private final abstract servlet output stream upgrade servlet output stream abstract servlet output stream upgrade servlet output stream container responsible first call write possible only need do setting listener first time rather than changing synchronized fire listener lock fire listener true socket wrapper add dispatch dispatch type non blocking write write internal buffer buffer length make sure ready write possible have consistent view buffer fire listener when determining listener should fire private final socket wrapper long wrapper public apr servlet output stream socket wrapper long wrapper super socket wrapper wrapper wrapper socket wrapper get socket long value lock read lock wrapper get blocking status read lock write lock write lock wrapper get blocking status write lock wrapper get blocking status block wrapper set blocking status block integer value written long value socket wrapper public bio servlet output stream socket wrapper socket wrapper os wrapper get socket get output stream socket wrapper nio channel wrapper nio selector pool pool channel wrapper get socket test public void test first call write possible throws exception do test fixed response fixed response non blocking class private void do test fixed response class extends http upgrade handler upgrade handler class throws exception upgrade connection conn do upgrade upgrade handler class reader conn get reader int read assert assert equals fixed response non blocking fixed response public static class fixed response non blocking implements http upgrade handler public static final char fixed response private servlet input stream sis private servlet output stream sos override public void init web connection connection try sis connection get input stream sos connection get output stream catch ioexception ioe throw new illegal state exception ioe sis set read listener new op read listener sos set write listener new fixed response write listener override public void destroy op private class fixed response write listener extends op write listener override public void write possible try sos write fixed response sos flush catch ioexception ioe throw new illegal state exception ioe
open socket keep alive open socket socket wrapper get socket get poller process sendfile key key attachment socket wrapper true private final set saxparse exception errors new hash set private final set saxparse exception warnings new hash set
public set saxparse exception get errors public set saxparse exception get warnings
jars length jar modification times size log info sm get string webapp class loader jars added resources get context get name return true else jars length jar modification times size log info sm get string webapp class loader jars removed resources get context get name return true int jar count jar count jars have been added removed jar modification times put jar get name long value jar get last modified jar count jar modification times size log info sm get string webapp class loader jars removed resources get context get name return true private static final int short timeout secs private static final long short timeout delay msecs short timeout secs 1000 private static final int long timeout secs 10 private static final long long timeout delay msecs long timeout secs 1000 private static string client auth header private static string server cookies set cookie private static string browser cookies cookie try access unprotected resource without established sso session should permitted public void test accept public non login throws exception
false false 200 try access protected resource without established sso session should rejected sc forbidden 403 status public void test reject protected non login throws exception false true 403 resource should rejected sc forbidden 401 status which followed successful re public void test basic login session timeout throws exception do test basic user pwd context path login uri protected true 401 false 200 wait long enough my session expire thread sleep short timeout delay msecs do test basic user pwd context path login uri protected true 401 false 200 webapp without sending sso session cookie should rejected sc forbidden 403 status public void test basic login reject protected without cookies throws exception do test basic user pwd context path login uri protected true 401 false 200 false true 403 webapp while sending sso session cookie provided first webapp should successful sc ok 200 status public void test basic login accept protected cookies throws exception do test basic user pwd context path login uri protected true 401 false 200 true false 200 webapp while sending sso session cookie provided first webapp should successful sc ok 200 status has expired should successful sc ok 200 status note test run slightly more than minutes do test basic user pwd context path login uri protected true 401 false 200 true false 200 long enough non login session expiry thread sleep short timeout delay msecs do test non login context path nologin uri protected true false 200 wait long enough my non login session expire tear down sso session same time thread sleep long timeout delay msecs false true 403 public void do test non login string uri boolean add cookies boolean expected reject int expected rc throws exception add cookies add cookies req headers use cookie cookies null req headers put client cookie header cookies expected reject assert equals 200 rc save cookies resp headers public void do test basic string user string pwd string uri boolean expected reject1 int expected rc1 boolean expected reject2 int expected rc2 throws exception first access attempt should challenged map string list string req headers1 new hash map map string list string resp headers1 new hash map byte chunk bc new byte chunk int rc get url http prefix get port uri bc req headers1 resp headers1 expected reject1 assert equals expected rc1 rc assert true bc get length assert equals 200 rc assert equals ok bc string return second access attempt should successful string credentials user pwd string base64auth base64 encode base64string credentials get bytes standard charsets iso 8859 string auth line basic base64auth list string auth new array list auth add auth line map string list string req headers2 new hash map req headers2 put client auth header auth map string list string resp headers2 new hash map bc recycle rc get url http prefix get port uri bc req headers2 resp headers2 expected reject2 assert equals expected rc2 rc assert null bc string assert equals 200 rc assert equals ok bc string save cookies resp headers2 setup two webapps every test note super class tear down method stop tomcat tomcat tomcat get tomcat instance set up non login tomcat set up login tomcat private void set up non login tomcat tomcat throws exception context ctxt tomcat add context context path nologin ctxt set session timeout long timeout secs add protected servlet tomcat add servlet ctxt tester servlet1 new tester servlet ctxt add servlet mapping uri protected tester servlet1 ctxt add constraint sc1 add unprotected servlet tomcat add servlet ctxt tester servlet2 new tester servlet ctxt add servlet mapping uri public tester servlet2 ctxt add constraint sc2 ctxt set login config lc ctxt get pipeline add valve new non login private void set up login tomcat tomcat throws exception context ctxt tomcat add context context path login ctxt set session timeout short timeout secs add protected servlet tomcat add servlet ctxt tester servlet3 new tester servlet ctxt add servlet mapping uri protected tester servlet3 add protected servlet context tomcat add servlet basic context tester servlet3 new tester servlet encode url basic context add servlet mapping uri protected tester servlet3 ctxt add constraint sc configure appropriate ctxt set login config lc ctxt get pipeline add valve new basic cookies resp headers get server cookies req headers put browser cookies cookies
context name cn new context name get name context name cn new context name deploy war get name context name cn new context name remove war get name context name cn new context name filename context name cn new context name context get name context name cn new context name context get name context name cn new context name context get name context name cn new context name context get name context name cn new context name get name context name cn new context name name context name cn new context name files context name cn new context name files context name cn new context name files context name previous new context name iter next context name current new context name iter next context name cn new context name context get name public context name string name tmp1 lower case locale english ends war tmp1 lower case locale english ends xml private static final context name app name new context name myapp cn11 new context name root cn12 new context name foo cn13 new context name foo bar cn14 new context name root cn15 new context name foo cn16 new context name foo bar cn18 new context name root bar cn19 new context name root bar cn20 new context name root assert equals foo war cn21 get base name assert equals foo cn22 get base name assert equals foo war cn21 get path assert equals foo cn22 get path assert equals cn21 get version assert equals cn22 get version assert equals foo war cn21 get name assert equals foo cn22 get name assert equals foo war cn21 get display name assert equals foo cn22 get display name do test constructor string cn21 do test constructor string cn22 do compare src new context name src get base name do compare src new context name src get display name do compare src new context name src get name
path should never null path null equals path cn17 new context name root null cn18 new context name root bar cn19 new context name root bar cn20 new context name root assert equals root cn17 get base name assert equals root bar cn18 get base name assert equals root bar cn19 get base name assert equals root cn20 get base name assert equals cn17 get path assert equals root bar cn18 get path assert equals root bar cn19 get path assert equals cn20 get path assert equals cn17 get version assert equals cn18 get version assert equals cn19 get version assert equals cn20 get version assert equals cn17 get name assert equals root bar cn18 get name assert equals root bar cn19 get name assert equals cn20 get name assert equals cn17 get display name assert equals root bar cn18 get display name assert equals root bar cn19 get display name assert equals cn20 get display name do test constructor string cn17 do test constructor string cn18 do test constructor string cn19 do test constructor string cn20
servlet non blocking write listener fire listener false registered write false
tld resource path tld resource path resource path ends jar path points jar file tld presumed inside meta inf taglib tld tld resource path new tld resource path url resource path meta inf taglib tld tld resource path new tld resource path url resource path parse tld store using uri supplied descriptor taglib xml tld tld parser parse tld resource path uri tld resource path map put taglib uri tld resource path tld resource path taglib xml map put tld resource path tld tld get listeners null listeners add all tld get listeners
int urls length tomcat can use url other than file url protocol other than file generate bad file system path so only add file protocol url classpath urls get protocol equals file cpath append urls get file sep td 10 192 168 169 254 127 br default 10 192 168 16 169 254 16 127 allowed 172 16 12 has been enabled default because complex describe regular expressions td
127 td 10 192 168 169 254 127 br default 10 192 168 16 169 254 16 127 allowed 172 16 12 has been enabled default because complex describe regular expressions td 127 10 192 168 169 254 127 10 192 168 169 254 127
map string web xml fragments process jars web fragments protected map string web xml process jars web fragments boolean parse required true set string absolute order application get absolute ordering absolute order null absolute order empty context get xml validation skip parsing when empty absolute ordering validation enabled parse required false new fragment jar scanner callback web xml parser delegate empty absolute ordering element present fragment processing may skipped set string absolute ordering web xml get absolute ordering absolute ordering null absolute ordering empty return web xml fragment jar scanner callback callback new fragment jar scanner callback web xml parser false public fragment jar scanner callback web xml parser web xml parser boolean delegate parse required parse required files webapp property name set configure used sslcontext value should instance sslcontext property present ssl truststore properties ignored public static final string ssl context property org apache tomcat websocket ssl context
create ssl context sslcontext ssl context sslcontext get instance tls trust store string ssl trust store value string user properties get ssl truststore property ssl trust store value null string ssl trust store pwd value string user properties get ssl truststore pwd property ssl trust store pwd value null ssl trust store pwd value ssl truststore pwd default file key store file new file ssl trust store value key store ks key store get instance jks try input stream new file input stream key store file ks load ssl trust store pwd value char array trust manager factory tmf trust manager factory get instance trust manager factory get default algorithm tmf init ks ssl context init null tmf get trust managers null else ssl context init null null null
out token gss context accept sec context decoded decoded length class gets gss credential via privileged action private static class accept action implements privileged exception action byte gsscontext gss context byte decoded accept action gsscontext context byte decoded token gss context context decoded decoded token override public byte run throws gssexception return gss context accept sec context decoded decoded length
bb flush buffer make space len chars len small allocate reserve space too never grow bigger than limit private void make space int count
file file path substring web app mount length true exists return new empty resource root path private final file file root web app path null public empty resource web resource root root string web app path file file file file return null web resource main empty null virtual null result virtual virtual result return new empty resource path get canonical path test public final void test get canonical path exists web resource exists resource root get resource get mount d1 d1 f1 txt string exists canonical path exists get canonical path url exists url exists get url file equals exists url get protocol should have canonical path assert assert null exists canonical path else assert assert null exists canonical path test public final void test get canonical path does exist web resource exists resource root get resource get mount d1 d1 f1 txt web resource does exist resource root get resource get mount d1 dummy txt string does exist canonical path does exist get canonical path url exists url exists get url file equals exists url get protocol should possible construct canonical path resource doesn exist given resource does exist same directory has url file protocol assert assert null does exist canonical path else assert assert null does exist canonical path
gss credential tomcat principal user principal get gss credential gss credential null int left try left gss credential get remaining lifetime catch gssexception log warn sm get string coyote request gss lifetime fail user principal get name left gss credential has expired need re authenticate try logout catch servlet exception should never happen code called logout throws servlet exception return null
log error sm get string memory user database file found file get absolute path qop should used connection ldap server after value used set code javax security sasl qop code environment property ldap connection protected string spengo delegation qop auth conf
public string get spengo delegation qop return spengo delegation qop public void set spengo delegation qop string spengo delegation qop spengo delegation qop spengo delegation qop javax security sasl qop auth conf when jnirealm used spnego delegated
private string list string path boolean do state check do state check check state check state check state check state private web resource get resource string path boolean do state check do state check check state check path path check path path private void check path string path return request util normalize path check state private web resource list resources string path boolean do state check do state check check state private void check state get state available throw new illegal state exception sm get string standard root check state started
atomic boolean error new atomic boolean false res action action code error error comet async else action code action code error atomic boolean param set error else action code action code error atomic boolean param set error else action code action code error atomic boolean param set error private static count down latch new count down latch private static count down latch new count down latch private static count down latch new count down latch private static boolean bug55772is second request false private static boolean state leaked false test public void test bug55772 throws exception tomcat tomcat get tomcat instance tomcat get connector set property processor cache tomcat get connector set property max threads must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt async new ctxt add servlet mapping async tomcat start string request1 get async http host localhost get port connection keep alive cache control max age accept text html application xhtml xml application xml image webp user agent request1 accept encoding gzip deflate sdch accept language en us en fr es cookie something should leak true string request2 get async http host localhost get port connection keep alive cache control max age accept text html application xhtml xml application xml image webp user agent request2 accept encoding gzip deflate sdch accept language en us en fr es try final socket connection new socket localhost get port connection set so linger true writer writer new output stream writer connection get output stream b2cconverter get charset us ascii writer write request1 writer flush await connection close await bug55772is second request true try final socket connection new socket localhost get port connection set so linger true writer writer new output stream writer connection get output stream b2cconverter get charset us ascii writer write request2 writer flush connection get input stream read await state leaked assert fail state leaked between requests private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception bug55772is second request cookie cookies req get cookies cookies null cookies length cookie cookie req get cookies cookie get name equals ignore case something should leak state leaked true count down else req get cookies we have do so tomcat actually parse cookies from request req set attribute org apache catalina async supported boolean true async context async context req start async async context set timeout 5000 count down print writer writer async context get response get writer writer print writer flush count down
property must false spnego work system set property constants use subject creds only property false
ssl context sslcontext make root pool value ssl ssl mode server
result new node jsp attribute tai name uri local name value false el dynamic private static class xml escape non elvisitor extends elparser text builder override public void visit text throws jasper exception output append xml escape get text protected static string xml escape string null return null int len length look any bad characters escape bad character found ascii 34 38 39 60 62 int len char char need escape them quote whole string string builder sb new string builder int len sb append int pos int len char pos sb append pos sb append lt pos else pos sb append pos sb append gt pos else pos sb append pos sb append 039 apos pos else pos sb append pos sb append amp pos else pos sb append pos sb append 034 quot pos pos len sb append pos len return sb string return protected static string xml escape string null return null int len length look any bad characters escape bad character found ascii 34 38 39 60 62 int len char char need escape them quote whole string string builder sb new string builder int len sb append int pos int len char pos sb append pos sb append lt pos else pos sb append pos sb append gt pos else pos sb append pos sb append 039 apos pos else pos sb append pos sb append amp pos else pos sb append pos sb append 034 quot pos pos len sb append pos len return sb string return escape ret value null ret value xml escape ret value string assert assert true result contains quot bar quot result contains 034 bar 034 assert assert true result contains quot foo quot result contains 034 foo 034 licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license performance tests link page context impl private static string bug53867test data new string hello world meta http equiv content language connection has limited network connectivity please use web page access file server resources test public void test bug53867 int 10 do test bug53867 private static void do test bug53867 int count 100000 int bug53867test data length assert assert equals do test bug53867old version bug53867test data page context impl xml escape bug53867test data int 100 int bug53867test data length do test bug53867old version bug53867test data int 100 int bug53867test data length page context impl xml escape bug53867test data long start system current time millis int count int bug53867test data length do test bug53867old version bug53867test data system out println old escape system current time millis start start system current time millis int count int bug53867test data length page context impl xml escape bug53867test data system out println new escape system current time millis start private static string do test bug53867old version string null return null string builder sb new string builder int length char char sb append lt else sb append gt else sb append 039 apos else sb append amp else sb append 034 quot else sb append return sb string executor public static final string executor core size init param org apache tomcat websocket executor core size public static final string executor max size init param org apache tomcat websocket executor max size public static final string executor seconds init param org apache tomcat websocket executor keep alive time seconds
ws server container obj shutdown executor ws remote endpoint server write possible executor service server container get executor service write possible public void write possible clear handler null clear handler ioe clear handler new eofexception protected void timeout clear handler new socket timeout exception private void clear handler throwable use dispatch result runnable result runnables poll null new result runnable result runnables init sh executor service null executor service shutdown can use executor so call runnable directly may strictly compliant all cases during shutdown only close messages going sent so should issue nested calls leading stack overflow described bug 55715 issues nested calls reason separate thread requirement run else executor service execute else null sh result new send result else sh result new send result private static class result runnable implements runnable private final queue result runnable queue private volatile send handler sh private volatile throwable private result runnable queue result runnable queue queue queue private void init send handler sh throwable sh sh override public void run null sh null return runnable queue when has been finished note method takes age finish shouldn any thread safety issues fields cleared above queue add private final executor service executor service executor config int executor core size int executor max size 10 long executor keep alive time seconds 60 value servlet context get init parameter constants executor core size init param value null executor core size integer parse int value value servlet context get init parameter constants executor max size init param value null executor max size integer parse int value value servlet context get init parameter constants executor seconds init param value null executor keep alive time seconds long parse long value use per web application executor any threads web socket server code needs create group all threads under single thread group string buffer thread group name new string buffer web socket server thread group name append servlet context get virtual server name thread group name append equals servlet context get context path thread group name append root else thread group name append servlet context get context path thread group thread group new thread group thread group name string ws thread factory ws thread factory new ws thread factory thread group executor service new thread pool executor executor core size executor max size executor keep alive time seconds time unit seconds new linked blocking queue runnable ws thread factory executor service get executor service return executor service void shutdown executor executor service shutdown try executor service await termination 10 time unit seconds catch interrupted exception ignore interruption carry private static class ws thread factory implements thread factory private final thread group tg private final atomic long count new atomic long private ws thread factory thread group tg tg tg override public thread new thread runnable thread new thread tg set name tg get name count increment get return endpoint timeout
private input stream get resource stream string uri uri starts file return new file input stream new file uri substring string real ctxt get real path uri return ctxt get resource stream uri return ctxt get resource stream uri
while tg get parent null tg tg get parent
value null base get class get component type assignable from value get class private static boolean assignable from class src class target tests setting arrays primitives https issues apache org bugzilla show bug cgi id 55691 test public void test set value08 array elresolver resolver new array elresolver elcontext context new standard elcontext elmanager get expression factory int base new int resolver set value context base new integer integer value assert assert equals integer value base integer value
message handler listener endpoint config endpoint config get message method listener null get message method listener null get message method listener null new pojo message handler whole binary listener null new pojo message handler whole text listener null util get message handlers listener endpoint config
public static class get decoder type class extends decoder decoder return class util get generic type decoder class decoder else arg type instanceof type return type arg type get raw type test public void test get encoder type simple generic type assert assert equals list class util get encoder type simple encoder generic type class private static class simple encoder generic type implements encoder text list string override public void init endpoint config endpoint config op override public void destroy op override public string encode list string object throws encode exception return null private static final string path generics ep echo generics ep test public void test generics coders throws exception set up utility classes generics server server new generics server singleton configurator set instance server server config listener set pojo clazz generics server class tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener new application listener server config listener class get name false tomcat add servlet ctx default new default servlet ctx add servlet mapping default web socket container ws container container provider get web socket container tomcat start generics client client new generics client uri uri new uri ws localhost get port path generics ep session session ws container connect server client uri array list string list new array list list add str1 list add str2 session get basic remote send object list should take very long int while 20 server received size client received size break thread sleep 100 check messages were received assert assert equals server received size assert assert equals server received peek string str1 str2 assert assert equals client received size assert assert equals client received peek string str1 str2 session close client endpoint decoders list string decoder class encoders list string encoder class public static class generics client private queue object received new concurrent linked queue message public void rx list string received add server endpoint value path generics ep decoders list string decoder class encoders list string encoder class configurator singleton configurator class public static class generics server private queue object received new concurrent linked queue message public list string rx list string received add echo message back return public static class list string encoder implements encoder text list string override public void init endpoint config endpoint config server add life cycle event get class get name init override public void destroy server add life cycle event get class get name destroy override public string encode list string str throws encode exception string buffer sbuf new string buffer sbuf append string str sbuf append append sbuf delete char sbuf last index append return sbuf string public static class list string decoder implements decoder text list string override public void init endpoint config endpoint config server add life cycle event get class get name init override public void destroy server add life cycle event get class get name destroy override public list string decode string str throws decode exception list string lst new array list str str substring str length string strings str split string strings lst add return lst override public boolean decode string str return str starts str ends
digester set class loader standard server class get class loader digester set use context class loader true digester set class loader thread current thread get context class loader init param param name gzip param name param value true param value init param should serve gzip versions files default set true protected boolean gzip true
get servlet config get init parameter gzip null gzip boolean parse boolean get servlet config get init parameter gzip serve gzipped version file present gzip check gzip request resource file path ends gz web resource gzip resource resources get resource path gz gzip resource exists gzip resource file gzip resource set mime type content type response add header content encoding gzip resource gzip resource check user agent supports gzip encoding param request servlet request we processing return boolean true user agent supports gzip encoding false user agent does support gzip encoding protected boolean check gzip http servlet request request enumeration string headers request get headers accept encoding while headers has more elements string header headers next element header index gzip return true return false verify serving gzipped resources from context root test public void test gzipped file throws exception tomcat tomcat get tomcat instance file app dir new file test webapp file gzip index new file app dir index html gz long gzip size gzip index length file index new file app dir index html long index size index length app dir relative server home tomcat add webapp null app dir get absolute path tomcat start test gzip client gzip client new test gzip client get port gzip client reset gzip client set request new string get index html http crlf host localhost crlf connection close crlf accept encoding gzip crlf crlf gzip client connect gzip client process request assert true gzip client response200 list string response headers gzip client get response headers assert true response headers contains content length gzip size gzip client reset gzip client set request new string get index html http crlf host localhost crlf connection close crlf crlf gzip client connect gzip client process request assert true gzip client response200 response headers gzip client get response headers assert true response headers contains content type text html assert false response headers contains content encoding gzip assert true response headers contains content length index size private static class test gzip client extends simple http client public test gzip client int port set port port override public boolean response body ok return true add bug 54095 bug add support default servlet serving gzipped versions static resources directly from disk alternative tomcat compressing them each request patch philippe marschall markt add property name gzip gzipped version file exists file code gz code appended file name located alongside original file tomcat serve gzipped file user agent supports gzip option enabled true property
protected void init web xml throw new jasper exception ioe fix bug 55251 bug do allow jsp task fail silently web xml web xml fragment can generated markt fix
return expression el null named attribute private static tomcat urlstream handler factory instance new tomcat urlstream handler factory obtain reference singleton instance
get instance internal true private static tomcat urlstream handler factory get instance internal boolean register double checked locking ok because instance volatile instance null synchronized tomcat urlstream handler factory class instance null instance new tomcat urlstream handler factory register return instance private final boolean registered returns code true code factory already registered jvm successfully registered result call code false code factory disabled prior call public static void register calling method loads class which turn triggers all necessary registration since jvm only allows single call link url set urlstream handler factory urlstream handler factory tomcat needs register handler provide mechanism allow applications register own handlers public static void add user factory urlstream handler factory factory instance user factories add factory private tomcat urlstream handler factory url set urlstream handler factory
actions necessary extends urlclass loader implements lifecycle
holds class file transformers decorating class loader copy write array list thread safe expensive writes those should rare very fast reads since actually used importantly class loader never block iterating over transformers while loading class private final list class file transformer transformers new copy write array list adds specified class file transformer class loader transformer able modify bytecode any classes loaded class loader after invocation method param transformer transformer add class loader override public void add transformer class file transformer transformer transformer null throw new illegal argument exception sm get string webapp class loader add transformer illegal argument get context name transformers contains transformer same instance transformer already added bail out log warn sm get string webapp class loader add transformer duplicate transformer get context name return transformers add transformer log info sm get string webapp class loader add transformer transformer get context name removes specified class file transformer from class loader longer able modify byte code any classes loaded class loader after invocation method however any classes already modified transformer remain transformed param transformer transformer remove override public void remove transformer class file transformer transformer transformer null return transformers remove transformer log info sm get string webapp class loader remove transformer transformer get context name return returns copy class loader without any class file transformers tool often used java persistence api providers inspect entity classes absence any something can guaranteed within context link class file transformer link class file transformer transform class loader string class protection domain byte transform method returned class loader resource cache have been cleared so classes already instrumented retained returned return transformer free copy class loader override public webapp class loader copy without transformers webapp class loader loader new webapp class loader parent loader anti jarlocking anti jarlocking loader resources resources loader delegate delegate loader last jar accessed last jar accessed loader repository path repository path loader repository repository loader jar path jar path loader loader dir loader dir loader canonical loader dir canonical loader dir loader started started loader need convert need convert loader clear references static clear references static loader clear references stop threads clear references stop threads loader clear references stop timer threads clear references stop timer threads loader clear references log factory release clear references log factory release loader clear references http client keep alive thread clear references http client keep alive thread loader repository urls repository urls clone loader jar files jar files clone loader jar real files jar real files clone loader jar names jar names clone loader last modified dates last modified dates clone loader paths paths clone loader found resources put all found resources loader permission list add all permission list loader loader pc put all loader pc return loader transformers size sb append class file transformers class file transformer transformer transformers sb append transformer append name ends class string class path temp path class protected resource entry find resource internal string name string path boolean class resource path ends class anti jarlocking path ends class class class resource entry binary content null transformers size resource class just being loaded decorate any attached transformers string class name name ends class file suffix name substring name length class file suffix length name string internal name class name replace class file transformer transformer transformers try byte transformed transformer transform internal name null null entry binary content transformed null entry binary content transformed catch illegal class format exception log error sm get string webapp class loader transform error name return null string name triggers replace class private final hash map string array list string param hash values new hash map
-1
jsp servlet wrapper wrapper rctxt get wrapper wrapper uri jsp servlet wrapper wrapper rctxt get wrapper wrapper uri
log debug sm get string spnego ticket validate fail log error sm get string spnego service login fail
serve resource request response true serve resource request response false param request servlet request we processing param content should content included boolean content copy resource render result writer param encoding encoding use when reading source input stream protected void copy web resource resource input stream print writer writer throws ioexception file encoding null reader new input stream reader resource input stream file encoding
request requests request session get attribute comet requests attribute requests session set attribute comet requests attribute new requests reqs request session get attribute comet requests attribute new connection infos request reqs request se get session get attribute comet requests attribute private static class connection list implements serializable private static final long serial version uid 1l private transient request connection list null private connection list request connection list connection list connection list public request get return connection list bug 52558 bug refactor code comet connection manager valve code so does prevent session from being serialized when running cluster markt fix fix
string target type expected type get canonical name target type boolean class get name target type byte class get name target type character class get name target type short class get name target type integer class get name target type long class get name target type float class get name target type double class get name target type attribute name validation query timeout required false int timeout seconds before connection validation queries fail works calling code java sql statement set query timeout seconds code statement executes code validation query code pool itself doesn timeout query still up jdbc driver enforce query timeouts value less than equal zero disable feature default value code code attribute
error true return null value properties get property prop timeout value null pool properties set validation query timeout integer parse int value inherit doc override public void set validation query timeout int validation query timeout pool properties set validation query timeout validation query timeout override public int get validation query timeout return get pool properties get validation query timeout inherit doc timeout seconds before connection validation queries fail value less than equal zero disable feature defaults return timeout value seconds public int get validation query timeout timeout seconds before connection validation queries fail value less than equal zero disable feature defaults public void set validation query timeout int validation query timeout private volatile int validation query timeout override public int get validation query timeout return validation query timeout inherit doc override public void set validation query timeout int validation query timeout validation query timeout validation query timeout inherit doc int validation query timeout pool properties get validation query timeout validation query timeout stmt set query timeout validation query timeout override public int get validation query timeout return get pool properties get validation query timeout override public void set validation query timeout int validation query timeout get pool properties set validation query timeout validation query timeout attribute name validation query timeout description timeout seconds before connection validation queries fail type java lang integer writeable false private static int timeout 10 private static boolean timeout set private static final string long query select from test test test test test before public void set up throws sqlexception driver manager register driver new mock driver use our mock driver datasource set driver class name mock driver class get name datasource set url mock driver url required trigger validation query execution datasource set initial size datasource set test borrow true datasource set validation interval datasource set validation query select datasource set validation query timeout timeout timeout 10 timeout set false after public void tear down throws sqlexception driver manager deregister driver new mock driver test public void test validation query timeout enabled throws exception because test borrow true triggers validation query datasource get connection assert assert true timeout set test public void test validation query timeout disabled throws exception datasource set validation query timeout because test borrow true triggers validation query datasource get connection assert assert false timeout set test public void test validation query timeout query timeout interceptor throws exception int interceptor timeout 30 datasource set jdbc interceptors query timeout interceptor class get name query timeout interceptor timeout because test borrow true triggers validation query connection con datasource get connection assert assert true timeout set increase expected timeout 30 which what we set interceptor timeout 30 now create statement make sure query timeout set interceptor statement st con create statement assert assert equals interceptor timeout st get query timeout st close st con prepare statement assert assert equals interceptor timeout st get query timeout st close st con prepare call assert assert equals interceptor timeout st get query timeout st close con close pull another connection check timeout 10 timeout set false datasource get connection assert assert true timeout set test depends execution time validation query specifically needs run longer than second pass fails test expected sqlexception class public void test validation query timeout connection throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test connect true datasource set validation interval datasource set validation query long query datasource set validation query timeout datasource get connection test expected sqlexception class public void test validation invalid connection throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test borrow true datasource set initial size datasource set test connect true datasource set validation interval datasource set validation query select datasource set validation query timeout datasource get connection test public void test long validation query time throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false connection con datasource get connection statement stmt null long start end try stmt con create statement set query timeout sec keeps test from slowing things down too much stmt set query timeout assert our long query takes longer than one second run requirement other tests run properly start system current time millis stmt execute long query catch sqlexception ex finally end system current time millis stmt null stmt close con null con close assert assert true start end assert assert true end start 1000 test public void test validation query timeout borrow throws exception use our mock driver datasource set driver class name org h2 driver datasource set url jdbc h2 h2 test query timeout db close exit false required trigger validation query execution datasource set test borrow true datasource set validation interval datasource set validation query long query datasource set validation query timeout assert even though validation query times out we still get connection connection con datasource get connection assert assert null con statement st con create statement result set rs st execute query select rs close st close con close mock driver connection statement use verify set query timeout called public static class mock driver implements java sql driver public static final string url jdbc tomcat mock public mock driver override public boolean accepts url string url throws sqlexception return url null url equals mock driver url override public connection connect string url properties info throws sqlexception return new mock connection info override public int get major version return override public int get minor version return override public driver property info get property info string url properties info throws sqlexception return null override public boolean jdbc compliant return false override public logger get parent logger throws sqlfeature supported exception return null public static class mock connection extends org apache tomcat jdbc test driver connection public mock connection properties info super info override public statement create statement throws sqlexception return new mock statement public static class mock statement extends org apache tomcat jdbc test driver statement override public void set query timeout int seconds throws sqlexception super set query timeout seconds assert assert equals timeout seconds timeout set true
expiring return true expiring return true expiring string expired id get id internal notify cluster expired id null manager null manager instanceof delta manager delta manager dmanager delta manager manager catalina cluster cluster dmanager get cluster cluster message msg dmanager request completed expired id true msg null cluster send msg super expire notify notify cluster log debug enabled log debug sm get string delta session notifying cluster manager manager get name boolean value primary session expired id manager instanceof delta manager delta manager manager session expired expired id expiring return true expiring return true return valid check see expire progress has previously been called expiring valid double check locking expiring valid need volatile expiring valid set valid false set valid false return valid expiring
jssesocket factory default keystore type equals keystore type attribute name ignore exception pre load required false boolean flag whether ignore error connection creation while initializing pool set true you want ignore error connection creation while initializing pool set false you want fail pool throwing exception default value code false code attribute
jmx pool null jmx pool notify org apache tomcat jdbc pool jmx connection pool notify init get stack trace close true throw prop value properties get property prop value null pool properties set ignore exception pre load boolean parse boolean value inherit doc override public boolean ignore exception pre load return get pool properties ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load get pool properties set ignore exception pre load ignore exception pre load set true you want ignore error connection creation while initializing pool set false you want fail pool throwing exception param ignore exception pre load set true you want ignore error connection creation while initializing pool public void set ignore exception pre load boolean ignore exception pre load see pool set ignore exception pre load boolean public boolean ignore exception pre load private volatile boolean ignore exception pre load false inherit doc override public boolean ignore exception pre load return ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load ignore exception pre load ignore exception pre load public boolean ignore exception pre load return get pool properties ignore exception pre load inherit doc override public void set ignore exception pre load boolean ignore exception pre load get pool properties set ignore exception pre load ignore exception pre load inherit doc override
else thread interrupted else thread interrupted
else action code action code async settimeout param null return long timeout long param long value socket wrapper set timeout timeout reset timeouts methods called async dispatch provides mechanism those connector currently only nio need reset timeouts from async timeouts standard http timeouts once async processing completes protected abstract void reset timeouts methods called prepare response protected abstract void output byte src int offset int length throws ioexception methods called prepare response protected abstract void output byte src int offset int length throws ioexception else action code action code async settimeout param null return long timeout long param long value socket wrapper set timeout timeout protected void reset timeouts op ajp apr native connector only uses timeout value time socket wrapper async timeouts override else action code action code async settimeout param null return long timeout long param long value final key attachment ka key attachment socket wrapper get socket get attachment false keep alive timeout ka set timeout timeout protected void reset timeouts nio connector uses timeout configured wrapper poller therefore needs reset once asycn processing has finished final nio endpoint key attachment attach nio endpoint key attachment socket wrapper get socket get attachment false error attach null async state machine async dispatching long so timeout endpoint get so timeout reset timeout keep alive timeout attach set timeout keep alive timeout else attach set timeout so timeout override else action code action code async settimeout param null return long timeout long param long value we piggy backing worker thread set timeout socket wrapper set timeout timeout protected void reset timeouts op ajp bio connector only uses timeout value socket wrapper async timeouts override
container log warn sm get string jndi realm exception container log warn sm get string jndi realm exception container log warn sm get string jndi realm exception container log warn sm get string jndi realm exception container log warn sm get string jndi realm exception container log warn sm get string jndi realm exception should any response body swallowed sent client private boolean swallow response false
swallow response false responses certain status codes permitted include response body int status code response get status status code 200 status code 204 status code 205 status code 304 entity body swallow response true responses head requests permitted incude response body message bytes method mb request method method mb equals head entity body swallow response true response message append int response get status int len chunk get length hardcoded byte marshaling overhead adjust allowed size packet size default constants max packet size int chunk size constants max send size packet size constants max packet size int off while len int time len time chunk size time chunk size len time response message reset response message append byte constants jk ajp13 send body chunk response message append bytes chunk get bytes chunk get offset off time response message end output response message get buffer response message get len off time bytes written chunk get length bug 55453 test public void test304with body throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug55453 new body servlet ctx add servlet mapping bug55453 tomcat start simple ajp client ajp client new simple ajp client ajp client set port get port ajp client connect validate cpong ajp client cping tester ajp message forward message ajp client create forward message forward message end tester ajp message response headers ajp client send message forward message null expect messages headers end validate response headers response headers 304 validate response end ajp client read message true double check connection still open validate cpong ajp client cping ajp client disconnect private static class body servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status 304 resp get writer print body permitted 304 response
web application any web inf web xml packaged application processed normally normal web fragment ctx set config file get webapp config file path url string base org apache catalina core container base default base get host get name base host get name base base ctx base logger get logger base set level level warning protected url get webapp config file string path string url file doc base new file path doc base directory return get webapp config file from directory doc base url else return get webapp config file from jar doc base url private url get webapp config file from directory file doc base string url url result null file web app context xml new file doc base constants application context xml web app context xml exists try result web app context xml uri url catch malformed urlexception logger get logger get logger name get host url log level warning unable determine web application context xml doc base return result private url get webapp config file from jar file doc base string url url result null jar file jar null try jar new jar file doc base jar entry entry jar get jar entry constants application context xml entry null result new url jar doc base uri string constants application context xml catch ioexception logger get logger get logger name get host url log level warning unable determine web application context xml doc base finally jar null try jar close catch ioexception ignore return result test public void test get webapp config file from directory tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment dir context test public void test get webapp config file from directory negative tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment dir context test public void test get webapp config file from jar tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment context war test public void test get webapp config file from jar negative tomcat tomcat new tomcat assert null tomcat get webapp config file test deployment context war test public void test bug51526 throws exception tomcat tomcat get tomcat instance file app file new file test deployment context war standard context context standard context tomcat add webapp null test app file get absolute path tomcat start assert equals war context context get session cookie name
td tr
string value string value read token quoted string input true else parameters put attribute lower case locale english test public void test bug55454 throws ioexception string input text html charset utf string reader sr new string reader input media type http parser parse media type sr assert equals text get type assert equals html get subtype assert true get parameter count assert equals utf get parameter value charset assert equals utf get charset assert equals text html charset utf string
call constructor static method obj ctx get import handler resolve class local name obj null return ctx get elresolver invoke ctx new elclass class obj init null ast method parameters children get parameters ctx obj ctx get import handler resolve static local name obj null return ctx get elresolver invoke ctx new elclass class obj local name null ast method parameters children get parameters ctx licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test import01 elprocessor processor new elprocessor object result processor get value integer 1000 integer class assert assert equals integer value 1000 result test public void test import02 elprocessor processor new elprocessor processor get elmanager get elcontext get import handler import static java lang integer value object result processor get value value 1000 integer class assert assert equals integer value 1000 result
finished ready return available atomic boolean result new atomic boolean false coyote request action action code request body fully read result return result get input buffer input buffer servlet wlistener error invoked test public void test bug55438non blocking read write empty read throws exception tomcat tomcat get tomcat instance must have real doc base just use temp standard context ctx standard context tomcat add context system get property java io tmpdir nbread write servlet servlet new nbread write servlet string servlet name nbread write servlet class get name tomcat add servlet ctx servlet name servlet ctx add servlet mapping servlet name tomcat start map string list string res headers new hash map int rc post url false new bytes streamer override public byte next return new byte override public int get length return override public int available return http localhost get port new byte chunk res headers null assert assert equals http servlet response sc ok rc web servlet async supported true public class nbread write servlet extends tester servlet private static final long serial version uid 1l public volatile test read write listener rwlistener override protected void service http servlet request req http servlet response resp throws servlet exception ioexception step start async async context actx req start async actx set timeout long max value step notify read servlet input stream req get input stream rwlistener new test read write listener actx set read listener rwlistener public volatile boolean error invoked false error invoked true private class test read write listener implements read listener async context ctx private final string builder body new string builder public test read write listener async context ctx ctx ctx override public void data available throws ioexception servlet input stream ctx get request get input stream string byte new byte 8192 int read do read read read break new string read while ready log info read body append override public void all data read throws ioexception log info all data read servlet output stream output ctx get response get output stream output set write listener new write listener override public void write possible throws ioexception servlet output stream output ctx get response get output stream output ready log info writing body string output write body string get bytes utf ctx complete override public void error throwable throwable log info read write listener error throwable print stack trace override public void error throwable throwable log info read listener error throwable print stack trace private final map string segment segments new linked hash map
set string param names new hash set param names add segment throw new illegal argument exception sm get string uri template duplicate parameter segment segment old segments put segment new segment index segment old null throw new illegal argument exception sm get string uri template duplicate name segment candidate get segments values iterator iterator segment target segments segments values iterator private map string segment get segments method name test duplicate bug pattern dls dead local store public void test duplicate throws exception
hashtable preserved environment null preserve current context environment parameters preserved environment context get environment try context remove from environment context security catch naming exception ignore try context remove from environment javax security sasl server catch naming exception ignore try context remove from environment javax security sasl qop catch naming exception ignore private void restore environment parameter dir context context string parameter name hashtable preserved environment try context remove from environment parameter name preserved environment null preserved environment contains key parameter name context add environment parameter name preserved environment get parameter name catch naming exception ignore
class loader old thread context cl thread current thread get context class loader class loader null else standard session session standard session manager create empty session session read object data ois session set manager manager return session try standard session session standard session manager create empty session session read object data ois session set manager manager return session close input stream try ois close catch ioexception ignore thread current thread set context class loader old thread context cl class loader old thread context cl thread current thread get context class loader thread current thread set context class loader class loader thread current thread set context class loader old thread context cl filter registration fr servlet context add filter
-1
log info sm get string context config role auth roles log info sm get string context config role runas run log info sm get string context config role link link
set formatter new simple formatter set formatter new simple formatter
web resources api expects all paths start special case consistency earlier tomcat versions equals path path
db connection commit db connection commit
log error sm get string ws session send close fail ioe
process callback url true extract jar name one found string jar name get jar name urls skip jars known interesting jar name null jar scan filter check scan type jar name log debug sm get string jar scan classloader jar scan urls process callback urls webapp jar scan classloader fail urls ioe jar directory has been skipped log trace sm get string jar scan classloader jar scan urls private void process jar scanner callback callback url url boolean webapp throws ioexception else directory scan all directories file metainf new file get absolute file file separator meta inf metainf directory else file metainf new file get absolute file file separator meta inf metainf directory callback scan webapp extract jar name present from url private string get jar name url url string name null string path url get path int end path index constants jar ext end int start path last index end name path substring start end else scan all directories int start path last index name path substring start return name comma separated list jar file name patterns skip when scanning tlds specified default obtained from code tomcat util scan standard jar scan filter jars skip code system property comma separated list jar file name patterns scan when scanning tlds specified default obtained from code tomcat util scan standard jar scan filter jars scan code system property comma separated list jar file name patterns skip when scanning pluggable features specified default obtained from comma separated list jar file name patterns scan when scanning pluggable features specified default obtained from used scan web application jar files typically used during web application start identify files tlds web fragment xml files must processed part web application expanded jar files default code false code tomcat directory expanded jar file private page info page info
page info page info page visit new node visitor override public void visit node custom tag throws jasper exception invoke plugin visit body private void invoke plugin node custom tag private static class node visitor extends node visitor private tag plugin manager manager private page info page info public node visitor tag plugin manager manager page info page info manager manager page info page info override public void visit node custom tag throws jasper exception manager invoke plugin page info visit body
process servlet container initializers ordered fragments added web fragment xml priority order protected void process servlet container initializers set web xml fragments web xml fragment fragments url url fragment get url jar jar null input stream null list servlet container initializer detected scis null jar equals url get protocol jar jar factory new instance url jar get input stream sci location else file equals url get protocol string path url get path file file new file path sci location file exists new file input stream file null detected scis get servlet container initializers catch ioexception ioe log error sm get string context config servlet container initializer fail url context get name ok false return finally null try close catch ioexception ignore jar null jar close continue detected scis null servlet container initializer sci detected scis initializer class map put sci new hash set class handles types ht null try ht sci get class get annotation handles types class catch exception log debug enabled log info sm get string context config sci debug url else log info sm get string context config sci info url ht null class types ht value types null class type types type annotation handles types annotations true else handles types non annotations true set servlet container initializer scis type initializer map get type scis null scis new hash set type initializer map put type scis scis add sci extract name servlet container initializer param resource where name defined return class name throws ioexception protected list servlet container initializer get servlet container initializers input stream throws ioexception list servlet container initializer initializers new array list null string line null try buffered reader br new buffered reader new input stream reader utf while line br read line null line line trim line length int line index continue line line substring trim initializers add get servlet container initializer line catch unsupported encoding exception should never happen utf does ignore return null return initializers protected servlet container initializer get servlet container initializer string class name throws ioexception servlet container initializer sci null try class clazz class name class name true context get loader get class loader sci servlet container initializer clazz new instance catch class found exception log error sm get string context config invalid sci class name throw new ioexception catch exception log error sm get string context config invalid sci class name throw new ioexception catch illegal access exception log error sm get string context config invalid sci class name throw new ioexception return sci licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license variation java jar service loader respects exclusion rules web applications primarily intended use loading servlet container initializers defined servlet does attempt lazy loading container required introspect all discovered servlet context defines ordered libs only jars web inf lib named set included search provider files ordered libs defined all jars searched provider files providers defined resources parent class loader always returned provider classes loaded using context class loader see javax servlet servlet container initializer see java util service loader private static final string lib web inf lib private static final string services meta inf services private static final charset utf8 charset name utf private final servlet context context construct loader load services from servlet context param context context use public webapp service loader servlet context context context context load providers service type param service type type service load return unmodifiable collection service providers throws ioexception problem loading any service public collection load class service type throws ioexception string config file services service type get name set string services found new hash set class loader loader context get class loader servlet context has ordered libs use specify set jars from web inf lib should used loading services suppress warnings unchecked list string ordered libs list string context get attribute servlet context ordered libs ordered libs null handle ordered libs directly string lib ordered libs url jar url context get resource lib lib jar url null should happen just ignore continue string base jar url external form url url base ends url new url base config file else url new url jar base config file try parse config file services found url catch file found exception provider file found ok parent class loader all others loader loader get parent enumeration url resources loader null resources class loader get system resources config file else resources loader get resources config file while resources has more elements parse config file services found resources next element load discovered services services found empty return collections empty list return load services service type services found private void parse config file set string services found url url throws ioexception try input stream url open stream buffered reader reader new buffered reader new input stream reader utf8 string line while line reader read line null int line index line line substring line line trim line length continue services found contains line continue services found add line private collection load services class service type set string services found throws ioexception class loader loader context get class loader list services new array list services found size string service class services found try class clazz class name service class true loader services add service type cast clazz new instance catch class found exception exception illegal access exception class cast exception throw new ioexception return collections unmodifiable collection services licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test webapp throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments empty absolute ordering standard context ctxt standard context tomcat add context null test app dir get absolute path ctxt add lifecycle listener new context config tomcat start webapp service loader servlet container initializer loader new webapp service loader ctxt get servlet context collection servlet container initializer initializers loader load servlet container initializer class
long write timeout att get timeout long write timeout att get timeout long write timeout att get timeout long write timeout att get timeout set write timeout so timeout public void set write timeout long write timeout write timeout write timeout public long get write timeout return write timeout private long write timeout
ws session null
private final set string include codas new linked hash set public set string get include codas return include codas private final set string include preludes new linked hash set public set string get include preludes return include preludes test public void test bug55262 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res get url http localhost get port test bug5nnnn bug55262 jsp string result res string pattern prelude pattern compile prelude pattern multiline pattern dotall pattern coda pattern compile coda pattern multiline pattern dotall assert true prelude matcher result matches assert true coda matcher result matches assert assert equals property groups size jsp property group descriptor group descriptor property groups iterator next group descriptor group iterator next assert assert equals group descriptor get include preludes size assert assert equals group descriptor get include codas size licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private jsp property group group new jsp property group test public void test bug55262 group add include prelude prelude group add include prelude prelude group add include coda coda group add include coda coda assert assert equals group get include preludes size assert assert equals group get include codas size jsp property group jsp property group url pattern bug5nnnn bug55262 jsp url pattern include prelude bug5nnnn bug55262 prelude jspf include prelude include prelude bug5nnnn bug55262 prelude jspf include prelude include coda bug5nnnn bug55262 coda jspf include coda include coda bug5nnnn bug55262 coda jspf include coda default content type text plain default content type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
vector string include preludes new vector include preludes add all jsp property group get include preludes vector string include codas new vector include codas add all jsp property group get include codas jsp property property new jsp property jsp property group get xml jsp property group get el ignored jsp property group get scripting invalid jsp property group get page encoding include preludes include codas jsp property group get deferred syntax allowed literal jsp property group get trim directive whitespaces jsp property group get default content type jsp property group get buffer jsp property group get error undeclared namespace vector string include preludes new vector include preludes add all jsp property group get include preludes vector string include codas new vector include codas add all jsp property group get include codas jsp property property new jsp property jsp property group get xml jsp property group get el ignored jsp property group get scripting invalid jsp property group get page encoding include preludes include codas jsp property group get deferred syntax allowed literal jsp property group get trim directive whitespaces jsp property group get default content type jsp property group get buffer jsp property group get error undeclared namespace licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private jsp jspc private file output dir before public void init jspc new jsp output dir new file output jspc test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out test public void precompile webapp throws ioexception file app dir new file test webapp file webapp out new file output dir app dir get name precompile app dir webapp out verify webapp out private void verify file webapp out now just check some expected files exist assert assert true new file webapp out generated web xml exists assert assert true new file webapp out org apache jsp el 002das 002dliteral jsp java exists assert assert true new file webapp out org apache jsp tld 002dversions jsp java exists private void precompile file app dir file webapp out throws ioexception remove webapp out webapp out mkdirs jspc set uriroot app dir string jspc set output dir webapp out string jspc set validate xml false jspc set web xml new file webapp out generated web xml string jspc execute private void remove file base throws ioexception base exists return files walk file tree base path new simple file visitor path override public file visit result visit file path file basic file attributes attrs throws ioexception files delete file return file visit result continue override public file visit result post visit directory path dir ioexception exc throws ioexception files delete dir return file visit result continue add create test cases jsp patch jeremy boynes markt add
-1
tld locations cache tld locations cache get instance context
use class classloader ant have set tccl its own web xml parser set class loader get class get class loader sets class loader used creating descriptor objects param class loader class loader used creating descriptor objects public void set class loader class loader class loader web digester set class loader class loader web fragment digester set class loader class loader protected abstract log get log
else status socket status stop try upgrade servlet input stream close catch ioexception ioe get log debug sm get string abstract processor close fail ioe try upgrade servlet output stream close catch ioexception ioe get log debug sm get string abstract processor os close fail ioe return socket state closed private static final log log log factory get log apr processor class override protected log get log return log private static final log log log factory get log bio processor class override protected log get log return log private static final log log log factory get log nio processor class override protected log get log return log socket handshake complete suppress null warnings key block since key can null block
clear handler new socket timeout exception null sh result new send result else sh result new send result
add date header headers set value date set string fast http date format get current date
string current prefix get prefix current get qname jsp uri equals uri text action equals current get local name jsp equals current prefix href onclick window alert quot foo quot foo href onclick window alert quot bar quot bar
ctxt get major version ctxt get major version ctxt get minor version ctxt get minor version
public id null return false public id equals org apache catalina startup constants web dtd public id 22 return true else return false version null return update major minor version expected format allow any number digits just case string major null string minor null int split version index split major only major version else major version substring split minor version substring split major null major length major version else try major version integer parse int major catch number format exception nfe log warn sm get string web xml version nfe major version nfe major version minor null minor length minor version else try minor version integer parse int minor catch number format exception nfe log warn sm get string web xml version nfe minor version nfe skip else org apache catalina startup constants web schema public id 31 equals ignore case public id org apache catalina startup constants web fragment schema public id 31 equals ignore case public id major version minor version public id public id else org apache catalina startup constants web schema public id 30 equals ignore case public id org apache catalina startup constants web fragment schema public id 30 equals ignore case public id major version minor version public id public id else org apache catalina startup constants web schema public id 25 equals ignore case public id major version minor version public id public id else org apache catalina startup constants web schema public id 24 equals ignore case public id major version minor version public id public id else org apache catalina startup constants web dtd public id 23 equals ignore case public id major version minor version public id public id else org apache catalina startup constants web dtd public id 22 equals ignore case public id major version minor version public id public id else datatypes equals public id occur when validation enabled dependencies traced back ignore else unrecognised public id log warn sm get string web xml unrecognised public id public id reader set property http xml org sax properties lexical handler resolve requested external entity param public id public identifier entity being referenced param system id system identifier entity being referenced exception saxexception parsing exception occurs public input source resolve entity string public id string system id throws saxexception sax log debug resolve entity public id system id public id null public id public id log debug trying resolve using system id system id resolve system id against base uri absolute base uri null try uri uri new uri system id uri absolute entity url new uri base uri resolve uri string catch urisyntax exception log debug enabled log debug invalid uri base uri system id error handler methods override public void start dtd string name string public id string system id throws saxexception set public id public id error handler methods licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version assert assert equals xml identifiers web 22 public desc get public id test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version assert assert equals xml identifiers web 23 public desc get public id test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version test public void test webapp throws exception digester digester digester factory new digester true true new web rule set false digester push new web xml web xml desc web xml digester parse new file test webapp web inf web xml assert assert equals desc get version reset assert assert equals webxml get major version assert assert equals webxml get minor version assert assert equals webxml get major version assert assert equals webxml get minor version major only webxml set version assert assert equals webxml get major version assert assert equals webxml get minor version minor digit webxml set version reset webxml set version assert assert equals webxml get major version assert assert equals webxml get minor version minor only webxml set version reset webxml set version assert assert equals webxml get major version assert assert equals webxml get minor version leading training zeros webxml set version reset webxml set version 002 500 assert assert equals 500 webxml get minor version webxml set public id org apache catalina startup constants web dtd public id 22 webxml set public id org apache catalina startup constants web dtd public id 23 public void test parse public id version24 webxml set public id org apache catalina startup constants web schema public id 24 public void test parse public id version25 webxml set public id org apache catalina startup constants web schema public id 25 public void test parse public id version30 webxml set public id org apache catalina startup constants web schema public id 30 public void test parse public id version31 webxml set public id org apache catalina startup constants web schema public id 31 licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license resolver locally cached xml resources private final class base private final map string string public ids private final map string string system ids constructor providing mappings public system identifiers local resources each map contains mapping from well known identifier resource path further resolved using base class using class get resource string param base class use locate local copies param public ids mapping public identifiers local resources param system ids mapping system identifiers local resources public local resolver class base map string string public ids map string string system ids base base public ids public ids system ids system ids override public input source resolve entity string public id string system id throws saxexception ioexception return resolve entity null public id null system id override public input source resolve entity string name string public id string base uri string system id throws saxexception ioexception string resolved resolve public id system id base uri resolved null return null url url base get resource resolved url null resolved url external form input source new input source resolved set public id public id return override public input source get external subset string name string base uri throws saxexception ioexception return null private string resolve string public id string system id string base uri try resolving using public id string resolved public ids get public id resolved null return resolved try resolving using system id system id null return null system id resolve base uri system id resolved system ids get system id resolved null return resolved fall back supplied system id return system id private static string resolve string base uri string system id try base uri null return system id uri system uri new uri system id system uri absolute return system id return new uri base uri resolve system uri string catch urisyntax exception return system id licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license defines constants well known public system identifiers documented servlet jsp from w3c public static final string xml 2001 xsd http www w3 org 2001 xml xsd public static final string datatypes public datatypes public static final string xsd 10 public w3c dtd xmlschema 200102 en from j2ee public static final string web 22 public sun microsystems inc dtd web application en public static final string web 22 system http java sun com dtd web app dtd public static final string tld 11 public sun microsystems inc dtd jsp tag library en public static final string tld 11 system http java sun com dtd web dtd from j2ee public static final string web 23 public sun microsystems inc dtd web application en public static final string web 23 system http java sun com dtd web app dtd public static final string tld 12 public sun microsystems inc dtd jsp tag library en public static final string tld 12 system http java sun com dtd web dtd from j2ee public static final string web 24 xsd http java sun com xml ns j2ee web app xsd public static final string tld 20 xsd http java sun com xml ns j2ee web xsd public static final string webservices 11 xsd http www ibm com webservices xsd j2ee web services xsd from java ee public static final string web 25 xsd http java sun com xml ns javaee web app xsd public static final string tld 21 xsd http java sun com xml ns javaee web xsd public static final string webservices 12 xsd http java sun com xml ns javaee javaee web services xsd from java ee public static final string web 30 xsd http java sun com xml ns javaee web app xsd public static final string web fragment 30 xsd http java sun com xml ns javaee web fragment xsd public static final string webservices 13 xsd http java sun com xml ns javaee javaee web services xsd from java ee public static final string web 31 xsd http xmlns jcp org xml ns javaee web app xsd public static final string web fragment 31 xsd http xmlns jcp org xml ns javaee web fragment xsd public static final string webservices 14 xsd http xmlns jcp org xml ns javaee javaee web services xsd private xml identifiers licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private final map string string public ids new hash map private final map string string system ids new hash map private local resolver resolver new local resolver servlet context class public ids system ids private string web 22 local private string web 31 local private string webcommon 31 local before public void init public ids put xml identifiers web 22 public javax servlet resources web app dtd system ids put xml identifiers web 31 xsd javax servlet resources web app xsd web 22 local get class get resource javax servlet resources web app dtd external form web 31 local get class get resource javax servlet resources web app xsd external form webcommon 31 local get class get resource javax servlet resources web common xsd external form test public void unknown null id null throws ioexception saxexception assert assert null resolver resolve entity null null test public void unknown public id null throws ioexception saxexception assert assert null resolver resolve entity unknown null test public void unknown system id returned throws ioexception saxexception input source source resolver resolve entity null unknown assert assert equals null source get public id assert assert equals unknown source get system id test public void unknown system id resolved against base uri throws ioexception saxexception input source source resolver resolve entity null null http example com home html unknown assert assert equals null source get public id assert assert equals http example com unknown source get system id test public void public id resolved throws ioexception saxexception input source source resolver resolve entity xml identifiers web 22 public xml identifiers web 22 system assert assert equals xml identifiers web 22 public source get public id assert assert equals web 22 local source get system id test public void system id ignored when public id resolved throws ioexception saxexception input source source resolver resolve entity xml identifiers web 22 public unknown assert assert equals xml identifiers web 22 public source get public id assert assert equals web 22 local source get system id test public void system id resolved throws ioexception saxexception input source source resolver resolve entity null xml identifiers web 31 xsd assert assert equals null source get public id assert assert equals web 31 local source get system id test public void relative system id resolved against base uri throws ioexception saxexception input source source resolver resolve entity null null web 31 local web common xsd assert assert equals null source get public id assert assert equals webcommon 31 local source get system id test public void absolute system id overrides base uri throws ioexception saxexception input source source resolver resolve entity null null http example com home html xml identifiers web 31 xsd assert assert equals null source get public id assert assert equals web 31 local source get system id manifest tomcat manifests jsp api jar manifest notice tomcat manifests jsp api jar notice license tomcat manifests jsp api jar license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license target namespace http java sun com xml ns j2ee xmlns j2ee http java sun com xml ns j2ee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd jsp xsds 17 03 18 03 xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web app xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all j2ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location j2ee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type j2ee taglib type min occurs max occurs unbounded xsd element name jsp property group type j2ee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base j2ee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name url pattern type j2ee url pattern type max occurs unbounded xsd element name el ignored type j2ee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type j2ee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type j2ee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type j2ee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type j2ee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type j2ee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type j2ee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type j2ee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license actual sun xsd stripped down xsd can found http java sun com xml ns javaee jsp xsd xsd contains only functional elements programatic use target namespace http java sun com xml ns javaee xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd include schema location javaee xsd xsd complex type name jsp config type xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd element name page encoding type javaee string min occurs xsd element name scripting invalid type javaee true false type min occurs xsd element name xml type javaee true false type min occurs xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd element name include coda type javaee path type min occurs max occurs unbounded xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd element name trim directive whitespaces type javaee true false type min occurs xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd sequence xsd element name taglib uri type javaee string xsd element name taglib location type javaee path type xsd sequence xsd attribute name id type xsd id xsd complex type target namespace http java sun com xml ns javaee xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd id xsd xsd annotation xsd annotation xsd do alter remove copyright notices header copyright 2003 2009 sun microsystems inc all rights reserved contents file subject terms either gnu general public license version only gpl common development distribution license cddl collectively license you may use file except compliance license you can obtain copy license https glassfish dev java net public cddl gpl html glassfish bootstrap legal license txt see license specific language governing permissions limitations under license when distributing software include license header notice each file include license file glassfish bootstrap legal license txt sun designates particular file subject classpath exception provided sun gpl version section license file accompanied code applicable add following below license header fields enclosed brackets replaced your own identifying information portions copyrighted year name copyright owner contributor you wish your version file governed only cddl only gpl version indicate your decision adding contributor elects include software distribution under cddl gpl version license you don indicate single choice license recipient has option distribute your version file under either cddl gpl version extend choice license its licensees provided above however you add gpl version code therefore elected gpl version license option applies only new code made subject option copyright holder xsd xsd annotation xsd annotation xsd apache software foundation elects include software under cddl license xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web common xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all java ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location javaee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes control whether character sequence allowed when used string literal control whether template text containing only whitespaces must removed from response output indicate default content type information indicate default buffering model jsp writer control whether error should raised use undeclared namespaces jsp page xsd xsd annotation xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type javaee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type javaee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type javaee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type javaee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd annotation xsd character sequence reserved el expressions consequently translation error occurs character sequence used string literal unless element enabled true disabled false default xsd xsd annotation xsd element xsd element name trim directive whitespaces type javaee true false type min occurs xsd annotation xsd indicates template text containing only whitespaces must removed from response output has effect jsp documents xml syntax disabled false default xsd xsd annotation xsd element xsd element name default content type type javaee string min occurs xsd annotation xsd valid values default content type those content type page directive specifies default response content type page directive does include content type attribute xsd xsd annotation xsd element xsd element name buffer type javaee string min occurs xsd annotation xsd valid values buffer those buffer page directive specifies buffering should used output response so size buffer use xsd xsd annotation xsd element xsd element name error undeclared namespace type javaee true false type min occurs xsd annotation xsd default behavior when tag unknown namespace used jsp page regular syntax silently ignore set true error must raised during translation time when undeclared tag used jsp page disabled false default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type javaee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type javaee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type target namespace http xmlns jcp org xml ns javaee xmlns javaee http xmlns jcp org xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd annotation xsd do alter remove copyright notices header copyright 2009 2013 oracle its affiliates all rights reserved contents file subject terms either gnu general public license version only gpl common development distribution license cddl collectively license you may use file except compliance license you can obtain copy license https glassfish dev java net public cddl gpl html packager legal license txt see license specific language governing permissions limitations under license when distributing software include license header notice each file include license file packager legal license txt gpl classpath exception oracle designates particular file subject classpath exception provided oracle gpl version section license file accompanied code applicable add following below license header fields enclosed brackets replaced your own identifying information portions copyright year name copyright owner contributor you wish your version file governed only cddl only gpl version indicate your decision adding contributor elects include software distribution under cddl gpl version license you don indicate single choice license recipient has option distribute your version file under either cddl gpl version extend choice license its licensees provided above however you add gpl version code therefore elected gpl version license option applies only new code made subject option copyright holder xsd xsd annotation xsd annotation xsd apache software foundation elects include software under cddl license xsd xsd annotation xsd annotation xsd xml schema jsp deployment descriptor types jsp schema contains all special structures datatypes necessary use jsp files from web application contents schema used web common xsd file define jsp specific content xsd xsd annotation xsd annotation xsd following conventions apply all java ee deployment descriptor elements unless indicated otherwise elements specify pathname file within same jar file relative filenames those starting considered relative root jar file namespace absolute filenames those starting also specify names root jar file namespace general relative names preferred exception war files where absolute names preferred consistency servlet api xsd xsd annotation xsd include schema location javaee xsd xsd complex type name jsp config type xsd annotation xsd jsp config type used provide global information jsp files web application has two subelements taglib jsp property group xsd xsd annotation xsd sequence xsd element name taglib type javaee taglib type min occurs max occurs unbounded xsd element name jsp property group type javaee jsp property group type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name jsp file type xsd annotation xsd jsp file element contains full path jsp file within web application beginning xsd xsd annotation xsd simple content xsd restriction base javaee path type xsd simple content xsd complex type xsd complex type name jsp property group type xsd annotation xsd jsp property group type used group number files so can given global property information all files so described deemed jsp files following additional properties can described control whether el ignored control whether scripting elements invalid indicate page encoding information indicate resource jsp document xml prelude coda automatic includes control whether character sequence allowed when used string literal control whether template text containing only whitespaces must removed from response output indicate default content type information indicate default buffering model jsp writer control whether error should raised use undeclared namespaces jsp page xsd xsd annotation xsd sequence xsd group ref javaee description group xsd element name url pattern type javaee url pattern type max occurs unbounded xsd element name el ignored type javaee true false type min occurs xsd annotation xsd can used easily set elignored property group jsp pages default el evaluation enabled web applications using servlet greater web xml disabled otherwise xsd xsd annotation xsd element xsd element name page encoding type javaee string min occurs xsd annotation xsd valid values page encoding those page encoding page directive translation time error name different encodings page encoding attribute page directive jsp page jsp element matching page also translation time error name different encodings prolog text declaration document xml syntax jsp element matching document legal name same encoding through mulitple mechanisms xsd xsd annotation xsd element xsd element name scripting invalid type javaee true false type min occurs xsd annotation xsd can used easily disable scripting group jsp pages default scripting enabled xsd xsd annotation xsd element xsd element name xml type javaee true false type min occurs xsd annotation xsd true denotes group resources match url pattern jsp documents thus must interpreted xml documents false resources assumed jsp documents unless another property group indicates otherwise xsd xsd annotation xsd element xsd element name include prelude type javaee path type min occurs max occurs unbounded xsd annotation xsd include prelude element context relative path must correspond element web application when element present given path included include directive beginning each jsp page jsp property group xsd xsd annotation xsd element xsd element name include coda type javaee path type min occurs max occurs unbounded xsd annotation xsd include coda element context relative path must correspond element web application when element present given path included include directive end each jsp page jsp property group xsd xsd annotation xsd element xsd element name deferred syntax allowed literal type javaee true false type min occurs xsd annotation xsd character sequence reserved el expressions consequently translation error occurs character sequence used string literal unless element enabled true disabled false default xsd xsd annotation xsd element xsd element name trim directive whitespaces type javaee true false type min occurs xsd annotation xsd indicates template text containing only whitespaces must removed from response output has effect jsp documents xml syntax disabled false default xsd xsd annotation xsd element xsd element name default content type type javaee string min occurs xsd annotation xsd valid values default content type those content type page directive specifies default response content type page directive does include content type attribute xsd xsd annotation xsd element xsd element name buffer type javaee string min occurs xsd annotation xsd valid values buffer those buffer page directive specifies buffering should used output response so size buffer use xsd xsd annotation xsd element xsd element name error undeclared namespace type javaee true false type min occurs xsd annotation xsd default behavior when tag unknown namespace used jsp page regular syntax silently ignore set true error must raised during translation time when undeclared tag used jsp page disabled false default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name taglib type xsd annotation xsd taglib type defines syntax declaring deployment descriptor tag library available application can done override implicit map entries from tld files from container xsd xsd annotation xsd sequence xsd element name taglib uri type javaee string xsd annotation xsd taglib uri element describes uri identifying tag library used web application body taglib uri element may either absolute uri relative uri should entries web xml same taglib uri value xsd xsd annotation xsd element xsd element name taglib location type javaee path type xsd annotation xsd taglib location element contains location resource relative root web application where find tag library description file tag library xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license dtd defining java server pages tag library descriptor tld xml file format syntax tag library jar file containing valid instance tag library descriptor taglib tld file meta inf subdirectory along appropriate implementing classes other resources required implement tags defined therein use subject license terms jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives should user discernable xmlns cdata fixed http java sun com j2ee dtds web dtd itself most likely different langage embedded sql statements scriptlet expression optional licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license dtd defining java server pages tag library descriptor tld xml file format syntax tag library jar file containing valid instance tag library descriptor taglib tld file meta inf subdirectory along appropriate implementing classes other resources required implement tags defined therein use subject license terms sun microsystems inc dtd jsp tag library en doctype taglib public sun microsystems inc dtd jsp tag library en http java sun com dtd web dtd jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives intended displayed tools should user discernable display name small icon large icon description validator listener tag xmlns cdata fixed http java sun com jsp tag library descriptor javax servlet jsp tagext tag javax servlet jsp tagext tag extra info tools use tag small icon large icon description variable attribute example itself most likely different langage embedded sql statements time value give name variable one name given name from attribute required java lang string default true default defined nested default declare scope description scriptlet expression optional scriptlet expression optional licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license target namespace http java sun com xml ns j2ee xmlns j2ee http java sun com xml ns j2ee xmlns xsd http www w3 org 2001 xmlschema xmlns xml http www w3 org xml 1998 namespace element form default qualified attribute form default unqualified version xsd annotation xsd xsd xsd annotation xsd annotation xsd cdata xml schema jsp taglibrary descriptor all taglibrary descriptors must indicate tag library schema using taglibrary namespace http java sun com xml ns j2ee indicating version schema using version element shown below taglib xmlns http java sun com xml ns j2ee xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location version taglib instance documents may indicate published version schema using xsi schema location attribute j2ee namespace following location http java sun com xml ns j2ee web xsd xsd xsd annotation xsd include schema location j2ee xsd xsd element name taglib type j2ee tld taglib type xsd annotation xsd taglib tag document root definition taglib provided tld taglib type xsd xsd annotation xsd unique name tag name uniqueness xsd annotation xsd taglib element contains among other things tag tag file elements name subelements elements must each unique xsd xsd annotation xsd selector xpath j2ee tag j2ee tag file xsd field xpath j2ee name xsd unique xsd unique name function name uniqueness xsd annotation xsd taglib element contains function elements name subelements elements must each unique xsd xsd annotation xsd selector xpath j2ee function xsd field xpath j2ee name xsd unique xsd element xsd complex type name body content type xsd annotation xsd specifies type body valid tag value used jsp container validate tag invocation has correct body syntax page composition tools assist page author providing valid tag body currently four values specified tagdependent body tag interpreted tag itself most likely different language embedded sql statements jsp body tag contains nested jsp syntax empty body must empty scriptless body accepts only template text el expressions jsp action elements scripting elements allowed xsd xsd annotation xsd simple content xsd restriction base j2ee string xsd enumeration value tagdependent xsd enumeration value jsp xsd enumeration value empty xsd enumeration value scriptless xsd restriction xsd simple content xsd complex type xsd complex type name extensible type abstract true xsd annotation xsd extensible type abstract base type used define type extension elements instance documents must substitute known type define extension using xsi type attribute define actual type extension elements xsd xsd annotation xsd attribute name id type xsd id xsd complex type xsd complex type name function type xsd annotation xsd function element used provide information each function tag library exposed el function element may have several subelements defining description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique name function function class provides name java class implements function function signature provides signature java language java method used implement function example optional informal description example use function function extension zero more extensions provide extra information about function tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd annotation xsd unique name function xsd xsd annotation xsd element xsd element name function class type j2ee fully qualified class type xsd annotation xsd provides fully qualified class name java class containing static method implements function xsd xsd annotation xsd element xsd element name function signature type j2ee string xsd annotation xsd provides signature static java method used implement function syntax function signature element follows function signature return type method name parameters return type type method name identifier parameters parameter parameter parameters parameter type where type basic type fully qualified java class name including package name per type production java language second edition chapter 18 identifier java identifier per identifier production java language second edition chapter 18 example java lang string nick name java lang string int xsd xsd annotation xsd element xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use function xsd xsd annotation xsd element xsd element name function extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd function extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag file type xsd annotation xsd defines action tag library implemented tag file tag file element has two required subelements description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique action name path where find tag file implementing action relative root web application root jar file tag library packaged jar must begin web inf tags tag file resides war meta inf tags tag file resides jar example optional informal description example use tag tag extension zero more extensions provide extra information about tag tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd element name path type j2ee path type xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use tag xsd xsd annotation xsd element xsd element name tag extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd tag extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag type xsd annotation xsd tag defines unique tag tag library has one attribute id tag element may have several subelements defining description optional tag specific information display name short name intended displayed tools icon optional icon element can used tools name unique action name tag class tag handler class implementing javax servlet jsp tagext jsp tag tei class optional subclass javax servlet jsp tagext tag extra info body content body content type variable optional scripting variable information attribute all attributes action evaluated prior invocation dynamic attributes whether tag supports additional attributes dynamic names true tag class must implement javax servlet jsp tagext dynamic attributes interface defaults false example optional informal description example use tag tag extension zero more extensions provide extra information about tag tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name name type j2ee tld canonical name type xsd element name tag class type j2ee fully qualified class type xsd annotation xsd defines subclass javax serlvet jsp tagext jsp tag implements request time semantics tag required xsd xsd annotation xsd element xsd element name tei class type j2ee fully qualified class type min occurs xsd annotation xsd defines subclass javax servlet jsp tagext tag extra info tag optional given class consulted translation time xsd xsd annotation xsd element xsd element name body content type j2ee body content type xsd annotation xsd specifies format body tag default jsp jsp because invalid setting simple tag handlers longer default jsp reasonable default simple tag handlers scriptless tag can have body xsd xsd annotation xsd element xsd element name variable type j2ee variable type min occurs max occurs unbounded xsd element name attribute type j2ee tld attribute type min occurs max occurs unbounded xsd element name dynamic attributes type j2ee generic boolean type min occurs xsd element name example type j2ee xsd string type min occurs xsd annotation xsd example element contains informal description example use tag xsd xsd annotation xsd element xsd element name tag extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd tag extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld attribute type xsd annotation xsd attribute element defines attribute nesting tag attributre element may have several subelements defining description description attribute name name attribute required whether attribute required optional rtexprvalue whether attribute runtime attribute type type attributes fragment whether attribute fragment xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd element name name type j2ee java identifier type xsd element name required type j2ee generic boolean type min occurs xsd annotation xsd defines nesting attribute required optional present default false attribute optional xsd xsd annotation xsd element xsd choice xsd sequence xsd element name rtexprvalue type j2ee generic boolean type min occurs xsd annotation xsd defines nesting attribute can have scriptlet expressions value value attribute may dynamically calculated request time opposed static value determined translation time present default false attribute has static value xsd xsd annotation xsd element xsd element name type type j2ee fully qualified class type min occurs xsd annotation xsd defines java type attributes value static values those determined translation time type always java lang string xsd xsd annotation xsd element xsd sequence xsd element name fragment type j2ee generic boolean type min occurs xsd annotation xsd true attribute type javax jsp tagext jsp fragment representing dynamic content can re evaluated many times needed tag handler omitted false default still type java lang string xsd xsd annotation xsd element xsd choice xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld canonical name type xsd annotation xsd defines canonical name tag attribute being defined name must conform lexical rules nmtoken xsd xsd annotation xsd simple content xsd restriction base j2ee xsd nmtokentype xsd simple content xsd complex type xsd complex type name tld extension type xsd annotation xsd tld extension type used indicate extensions specific tld element used elements designate extension block targeted specific extension designated set extension elements declared namespace namespace identifies extension tool processes extension type extension element abstract therefore concrete type must specified tld using xsi type attribute each extension element xsd xsd annotation xsd sequence xsd element name extension element type j2ee extensible type max occurs unbounded xsd sequence xsd attribute name namespace use required type xsd any uri xsd attribute name id type xsd id xsd complex type xsd complex type name tld taglib type xsd annotation xsd taglib tag document root defines description simple string describing use taglib should user discernable display name display name element contains short name intended displayed tools icon optional icon can used tools tlib version version tag library short name simple default short name could used jsp authoring tool create names mnemonic value example may used prefered prefix value taglib directives uri uri uniquely identifying taglib validator optional tag library validator information listener optional event listener tag tags tag library tag file tag files tag library function zero more el functions defined tag library taglib extension zero more extensions provide extra information about taglib tool consumption xsd xsd annotation xsd sequence xsd group ref j2ee description group xsd element name tlib version type j2ee dewey version type xsd annotation xsd describes version number taglibrary described dewey decimal xsd xsd annotation xsd element xsd element name short name type j2ee tld canonical name type xsd annotation xsd defines simple default name could used jsp authoring tool create names example may used preferred prefix value taglib directives do use white space do start digits underscore xsd xsd annotation xsd element xsd element name uri type j2ee xsd any uritype min occurs xsd annotation xsd defines public uri uniquely identifies version taglibrary leave empty does apply xsd xsd annotation xsd element xsd element name validator type j2ee validator type min occurs xsd element xsd element name listener type j2ee listener type min occurs max occurs unbounded xsd element xsd element name tag type j2ee tag type min occurs max occurs unbounded xsd element name tag file type j2ee tag file type min occurs max occurs unbounded xsd element name function type j2ee function type min occurs max occurs unbounded xsd element name taglib extension type j2ee tld extension type min occurs max occurs unbounded xsd annotation xsd taglib extensions tool use only must affect behavior container xsd xsd annotation xsd element xsd sequence xsd attribute name version type j2ee dewey version type fixed use required xsd annotation xsd describes jsp version number taglibrary requires order function dewey decimal xsd xsd annotation xsd attribute xsd attribute name id type xsd id xsd complex type xsd complex type name validator type xsd annotation xsd validator can used validate conformance jsp page using tag library defined validator type xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd element name validator class type j2ee fully qualified class type xsd annotation xsd defines tag library validator class can used validate conformance jsp page using tag library xsd xsd annotation xsd element xsd element name init param type j2ee param value type min occurs max occurs unbounded xsd annotation xsd init param element contains name value pair param xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name variable scope type xsd annotation xsd type defines scope scripting variable see tag extra info details allowed values nested begin end xsd xsd annotation xsd simple content xsd restriction base j2ee string xsd enumeration value nested xsd enumeration value begin xsd enumeration value end xsd restriction xsd simple content xsd complex type xsd complex type name variable type xsd annotation xsd variable type provides information scripting variables defined using tag translation time error tag has one more variable subelements have tag extra info class returns non null value from call get variable info subelements variable type form description optional description variable name given variable name constant name from attribute name attribute whose translation time value give name variable one name given name from attribute required variable class name class variable java lang string default declare whether variable declared true default scope scope scripting varaible defined nested default xsd xsd annotation xsd sequence xsd element name description type j2ee description type min occurs max occurs unbounded xsd choice xsd element name name given type j2ee java identifier type xsd annotation xsd name scripting variable xsd xsd annotation xsd element xsd element name name from attribute type j2ee java identifier type xsd annotation xsd name attribute whose translation time value give name variable xsd xsd annotation xsd element xsd choice xsd element name variable class type j2ee fully qualified class type min occurs xsd annotation xsd optional name class scripting variable default java lang string xsd xsd annotation xsd element xsd element name declare type j2ee generic boolean type min occurs xsd annotation xsd whether scripting variable defined see tag extra info details element optional true default xsd xsd annotation xsd element xsd element name scope type j2ee variable scope type min occurs xsd annotation xsd element optional nested default xsd xsd annotation xsd element xsd sequence xsd attribute name id type xsd id xsd complex type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xsd contains only programatic elements required xsd from sun includes other copyrighted information please refer http java sun com xml ns javaee web xsd fully documented latest xsd xmlns javaee http java sun com xml ns javaee xmlns xsd http www w3 org 2001 xmlschema element form default qualified attribute form default unqualified version xsd include schema location javaee xsd xsd element name taglib type javaee tld taglib type xsd unique name tag name uniqueness xsd selector xpath javaee tag javaee tag file xsd field xpath javaee name xsd unique xsd unique name function name uniqueness xsd selector xpath javaee function xsd field xpath javaee name xsd unique xsd element xsd complex type name body content type xsd simple content xsd restriction base javaee string xsd enumeration value tagdependent xsd enumeration value jsp xsd enumeration value empty xsd enumeration value scriptless xsd restriction xsd simple content xsd complex type xsd complex type name extensible type abstract true xsd attribute name id type xsd id xsd complex type xsd complex type name function type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element xsd element name function class type javaee fully qualified class type xsd element xsd element name function signature type javaee string xsd element xsd element name example type javaee xsd string type min occurs xsd element xsd element name function extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag file type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element name path type javaee path type xsd element name example type javaee xsd string type min occurs xsd element xsd element name tag extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tag type xsd sequence xsd group ref javaee description group xsd element name name type javaee tld canonical name type xsd element name tag class type javaee fully qualified class type xsd element xsd element name tei class type javaee fully qualified class type min occurs xsd element xsd element name body content type javaee body content type xsd element xsd element name variable type javaee variable type min occurs max occurs unbounded xsd element name attribute type javaee tld attribute type min occurs max occurs unbounded xsd element name dynamic attributes type javaee generic boolean type min occurs xsd element name example type javaee xsd string type min occurs xsd element name tag extension type javaee tld extension type min occurs max occurs unbounded xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld attribute type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd element name name type javaee java identifier type xsd element name required type javaee generic boolean type min occurs xsd element xsd choice xsd sequence xsd sequence min occurs xsd element name rtexprvalue type javaee generic boolean type xsd element xsd element name type type javaee fully qualified class type min occurs xsd element xsd sequence xsd choice xsd element name deferred value type javaee tld deferred value type min occurs xsd element xsd element name deferred method type javaee tld deferred method type min occurs xsd element xsd choice xsd sequence xsd element name fragment type javaee generic boolean type min occurs xsd element xsd choice xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld canonical name type xsd simple content xsd restriction base javaee xsd nmtokentype xsd simple content xsd complex type xsd complex type name tld deferred method type xsd sequence xsd element name method signature type javaee string min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld deferred value type xsd sequence xsd element name type type javaee fully qualified class type min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name tld extension type xsd sequence xsd element name extension element type javaee extensible type max occurs unbounded xsd sequence xsd attribute name namespace use required type xsd any uri xsd attribute name id type xsd id xsd complex type xsd complex type name tld taglib type xsd sequence xsd group ref javaee description group xsd element name tlib version type javaee dewey version type xsd element xsd element name short name type javaee tld canonical name type xsd element xsd element name uri type javaee xsd any uritype min occurs xsd element xsd element name validator type javaee validator type min occurs xsd element xsd element name listener type javaee listener type min occurs max occurs unbounded xsd element xsd element name tag type javaee tag type min occurs max occurs unbounded xsd element name tag file type javaee tag file type min occurs max occurs unbounded xsd element name function type javaee function type min occurs max occurs unbounded xsd element name taglib extension type javaee tld extension type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name version type javaee dewey version type fixed use required xsd attribute xsd attribute name id type xsd id xsd complex type xsd complex type name validator type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd element name validator class type javaee fully qualified class type xsd element xsd element name init param type javaee param value type min occurs max occurs unbounded xsd element xsd sequence xsd attribute name id type xsd id xsd complex type xsd complex type name variable scope type xsd simple content xsd restriction base javaee string xsd enumeration value nested xsd enumeration value begin xsd enumeration value end xsd restriction xsd simple content xsd complex type xsd complex type name variable type xsd sequence xsd element name description type javaee description type min occurs max occurs unbounded xsd choice xsd element name name given type javaee java identifier type xsd element xsd element name name from attribute type javaee java identifier type xsd element xsd choice xsd element name variable class type javaee fully qualified class type min occurs xsd element xsd element name declare type javaee generic boolean type min occurs xsd element xsd element name scope type javaee variable scope type min occurs xsd element xsd sequence xsd attribute name id type xsd id xsd complex type javax servlet jsp resources jsp xsd javax servlet jsp resources jsp xsd javax servlet jsp resources jsp xsd javax servlet jsp resources jsp xsd apache license version january 2004 http www apache org licenses terms conditions use reproduction distribution definitions license shall mean terms conditions use reproduction distribution defined sections through document licensor shall mean copyright owner entity authorized copyright owner granting license legal entity shall mean union acting entity all other entities control controlled under common control entity purposes definition control means power direct indirect cause direction management entity whether contract otherwise ii ownership fifty percent 50 more outstanding shares iii beneficial ownership entity you your shall mean individual legal entity exercising permissions granted license source form shall mean preferred form making including limited software source code source files object form shall mean any form resulting from mechanical translation source form including limited compiled object code generated conversions other media types work shall mean work authorship whether source object form made available under license indicated copyright notice included attached work example provided appendix below derivative works shall mean any work whether source object form based derived from work which editorial revisions annotations elaborations other represent whole original work authorship purposes license derivative works shall include works remain separable from merely link bind name interfaces work derivative works thereof contribution shall mean any work authorship including original version work any additions work derivative works thereof submitted licensor inclusion work copyright owner individual legal entity authorized submit behalf copyright owner purposes definition submitted means any form electronic verbal written sent licensor its including limited electronic mailing lists source code control systems issue tracking systems managed behalf licensor purpose discussing improving work excluding marked otherwise designated writing copyright owner contribution contributor shall mean licensor any individual legal entity behalf whom contribution has been received licensor subsequently incorporated within work grant copyright license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable copyright license reproduce prepare derivative works publicly display publicly perform sublicense distribute work derivative works source object form grant patent license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable except stated section patent license make have made use offer sell sell import otherwise transfer work where license applies only those patent claims licensable contributor necessarily infringed contribution alone combination contribution work which contribution submitted you institute patent litigation against any entity including cross claim counterclaim lawsuit alleging work contribution incorporated within work constitutes direct contributory patent infringement any patent licenses granted you under license work shall terminate date litigation filed you may reproduce distribute copies work derivative works thereof any medium without source object form provided you meet following conditions you must give any other recipients work derivative works copy license you must cause any modified files carry prominent notices stating you changed files you must retain source form any derivative works you distribute all copyright patent trademark attribution notices from source form work excluding those notices do pertain any part derivative works work includes notice text file part its distribution any derivative works you distribute must include readable copy attribution notices contained within notice file excluding those notices do pertain any part derivative works least one following places within notice text file distributed part derivative works within source form provided along derivative works within display generated derivative works wherever third party notices normally appear contents notice file purposes only do modify license you may add your own attribution notices within derivative works you distribute alongside addendum notice text from work provided additional attribution notices cannot construed modifying license you may add your own copyright statement your may provide additional different license terms conditions use reproduction distribution your any derivative works whole provided your use reproduction distribution work otherwise complies conditions stated license submission unless you explicitly state otherwise any contribution submitted inclusion work you licensor shall under terms conditions license without any additional terms conditions above nothing herein shall supersede modify terms any separate license agreement you may have executed licensor regarding trademarks license does grant permission use trade names trademarks service marks product names licensor except required reasonable customary use describing origin work reproducing content notice file disclaimer warranty unless required applicable law agreed writing licensor provides work each contributor provides its basis without warranties conditions any kind either express implied including without limitation any warranties conditions title non infringement fitness particular purpose you solely responsible determining using work assume any risks associated your exercise permissions under license limitation liability event under legal theory whether tort including negligence contract otherwise unless required applicable law deliberate grossly negligent acts agreed writing shall any contributor liable you damages including any direct indirect special incidental damages any character arising result license out use inability use work including limited damages loss goodwill work stoppage computer failure malfunction any all other commercial damages losses even contributor has been advised possibility damages accepting warranty additional liability while work derivative works thereof you may choose offer charge fee acceptance support warranty indemnity other liability obligations rights consistent license however accepting obligations you may act only your own behalf your sole behalf any other contributor only you agree indemnify defend hold each contributor harmless any liability incurred claims asserted against contributor reason your accepting any warranty additional liability end terms conditions appendix how apply apache license your work apply apache license your work attach following boilerplate notice fields enclosed brackets replaced your own identifying information don include brackets text should enclosed appropriate comment syntax file format we also recommend file class name description purpose included same printed page copyright notice easier within third party archives copyright yyyy name copyright owner licensed under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license jsp xsd jsp xsd contributor means each individual entity creates contributes creation contributor version means combination original software prior used contributor any made particular contributor covered software means original software combination files containing original software files containing each case including portions thereof executable means covered software any form other than source code initial developer means individual entity first makes original software available under license larger work means work which combines covered software portions thereof code governed terms license license means document licensable means having right grant maximum extent possible whether time initial grant subsequently acquired any all rights conveyed herein means source code executable form any following any file results from addition deletion from modification contents file containing original software previous any new file contains any part original software previous modification any new file contributed otherwise made available under terms license 10 original software means source code executable form computer software code originally released under license 11 patent claims means any patent claim now owned hereafter acquired including without limitation method process apparatus claims any patent licensable grantor 12 source code means common form computer software code which made associated included code 13 you your means individual legal entity exercising rights under complying all terms license legal entities you includes any entity which controls controlled under common control you purposes definition control means power direct indirect cause direction management entity whether contract otherwise ownership more than fifty percent 50 outstanding shares beneficial ownership entity initial developer grant conditioned upon your compliance section below subject third party intellectual property claims initial developer hereby grants you world wide royalty free non exclusive license under intellectual property rights other than patent trademark licensable initial developer use reproduce modify display perform sublicense distribute original software portions thereof without part larger work under patent claims infringed making using selling original software make have made use practice sell offer sale otherwise dispose original software portions thereof licenses granted sections effective date initial developer first distributes otherwise makes original software available third party under terms license section above patent license granted code you delete from original software caused modification original software ii combination original software other software devices contributor grant conditioned upon your compliance section below subject third party intellectual property claims each contributor hereby grants you world wide royalty free non exclusive license under intellectual property rights other than patent trademark licensable contributor use reproduce modify display perform sublicense distribute created contributor portions thereof either unmodified basis other covered software part larger work under patent claims infringed making using selling made contributor either alone combination its contributor version portions combination make use sell offer sale have made otherwise dispose made contributor portions thereof combination made contributor its contributor version portions combination licenses granted sections effective date contributor first distributes otherwise makes available third party section above patent license granted any code contributor has deleted from contributor version caused third party contributor version ii combination made contributor other software except part contributor version other devices under patent claims infringed covered software absence made contributor availability source code any covered software you distribute otherwise make available executable form must also made available source code form source code form must distributed only under terms license you must include copy license every copy source code form covered software you distribute otherwise make available you must inform recipients any covered software executable form how can obtain covered software source code form reasonable manner through medium customarily used software exchange you create which you contribute governed terms license you represent you believe your your original creation you have sufficient rights grant rights conveyed license required notices you must include notice each your identifies you contributor modification you may remove alter any copyright patent trademark notices contained within covered software any notices licensing any descriptive text giving attribution any contributor initial developer application additional terms you may offer impose any terms any covered software source code form alters restricts applicable version license recipients rights hereunder you may choose offer charge fee warranty support indemnity liability obligations one more recipients covered software however you may do so only your own behalf behalf initial developer any contributor you must make absolutely clear any warranty support indemnity liability obligation offered you alone you hereby agree indemnify initial developer every contributor any liability incurred initial developer contributor result warranty support indemnity liability terms you offer distribution executable versions you may distribute executable form covered software under terms license under terms license your choice which may contain terms different from license provided you compliance terms license license executable form does attempt limit alter recipient rights source code form from rights set forth license you distribute covered software executable form under different license you must make absolutely clear any terms which differ from license offered you alone initial developer contributor you hereby agree indemnify initial developer every contributor any liability incurred initial developer contributor result any terms you offer larger works you may create larger work combining covered software other code governed terms license distribute larger work single product case you must make sure requirements license fulfilled covered software new versions sun microsystems inc initial license steward may publish revised new versions license from time time each version given version number except provided section one other than license steward has right modify license effect new versions you may always continue use distribute otherwise make covered software available under terms version license under which you originally received covered software initial developer includes notice original software prohibiting from being distributed otherwise made available under any subsequent version license you must distribute make covered software available under terms version license under which you originally received covered software otherwise you may also choose use distribute otherwise make covered software available under terms any subsequent version license published license steward modified versions when you initial developer you want create new license your original software you may create use modified version license you rename license remove any references name license steward except note license differs from license otherwise make clear license contains terms which differ from license covered software provided under license basis without warranty any kind either expressed implied including without limitation warranties covered software free defects merchantable fit particular purpose non infringing entire risk quality performance covered software you should any covered software prove defective any respect you initial developer any other contributor assume cost any necessary servicing repair correction disclaimer warranty constitutes essential part license use any covered software authorized hereunder except under disclaimer license rights granted hereunder terminate you fail comply terms herein fail cure breach within 30 days becoming aware breach provisions which nature must remain effect beyond termination license shall survive you assert patent infringement claim excluding declaratory judgment actions against initial developer contributor initial developer contributor against whom you assert claim referred participant alleging participant software meaning contributor version where participant contributor original software where participant initial developer directly indirectly infringes any patent any all rights granted directly indirectly you participant initial developer initial developer participant all contributors under sections license shall upon 60 days notice from participant terminate expiration 60 day notice period unless within 60 day period you withdraw your claim respect participant software against participant either unilaterally pursuant written agreement participant event termination under sections above all end user licenses have been validly granted you any distributor hereunder prior termination excluding licenses granted you any distributor shall survive termination under under legal theory whether tort including negligence contract otherwise shall you initial developer any other contributor any distributor covered software any supplier any parties liable any person any indirect special incidental damages any character including without limitation damages lost profits loss goodwill work stoppage computer failure malfunction any all other commercial damages losses even party shall have been informed possibility damages limitation liability shall apply liability death personal injury resulting from party negligence extent applicable law prohibits limitation some do allow exclusion limitation incidental damages so exclusion limitation may apply you covered software commercial item term defined 48 101 oct 1995 consisting commercial computer software term defined 48 252 227 7014 commercial computer software terms used 48 12 212 sept 1995 consistent 48 12 212 48 227 7202 through 227 7202 june 1995 all government end users acquire covered software only those rights set forth herein government rights clause lieu supersedes any other far dfar other clause provision addresses government rights computer software under license license represents complete agreement concerning subject matter hereof any provision license held provision shall reformed only extent necessary make enforceable license shall governed law jurisdiction specified notice contained within original software except extent applicable law any provides otherwise excluding jurisdiction conflict law provisions any litigation relating license shall subject jurisdiction courts located jurisdiction venue specified notice contained within original software losing party responsible costs including without limitation court costs reasonable attorneys fees expenses application united nations convention contracts sale goods expressly excluded any law regulation which provides language contract shall construed against drafter shall apply license you agree you alone responsible compliance united states export regulations export control laws regulation any other countries when you use distribute otherwise make available any covered software between initial developer contributors each party responsible claims damages arising directly indirectly out its utilization rights under license you agree work initial developer contributors distribute equitable basis nothing herein intended shall deemed constitute any admission liability notice pursuant section common development distribution license cddl code released under cddl shall governed laws state california excluding conflict law provisions any litigation relating license shall subject jurisdiction federal courts northern district california state courts state california venue lying santa clara county california jsp xsd jsp xsd name apache license version common development distribution license cddl version name url http www apache org licenses license txt http www opensource org licenses cddl1 txt url comments apache license version applies all files apart from jsp xsd jsp xsd which cddl version applies comments javaee xsd javaee web services xsd javaee web services client xsd javaee xsd javaee web services xsd javaee web services client xsd web app xsd web common xsd web fragment xsd javaee xsd javaee web services xsd javaee web services client xsd web app xsd web common xsd web fragment xsd which cddl version applies
-1
-1
servlet container initializer sci null sci get servlet container initializer sci null initializer class map put sci new hash set class handles types ht null try ht sci get class get annotation handles types class catch exception log debug enabled log info sm get string context config sci debug url else log info sm get string context config sci info url ht null class types ht value types null class type types type annotation handles types annotations true else handles types non annotations true set servlet container initializer scis type initializer map get type scis null scis new hash set type initializer map put type scis scis add sci protected servlet container initializer get servlet container initializer string class name null buffered reader br new buffered reader new input stream reader utf line br read line line null line trim length class name line trim return initializers protected servlet container initializer get servlet container initializer string class name throws ioexception class clazz class name class name true context get loader get class loader sci servlet container initializer clazz new instance
future integer socket channel write socket write buffer integer socket write get socket write int value bytes produced throw new ioexception sm get string async channel wrapper secure write fail integer value socket write int value integer value bytes produced
local name mb recycle
else decoder match has matches public static final string ws protocol header name lower ws protocol header name lower case locale english
header names always stored lower case constants ws protocol header name header names case insensitive so always use lower case licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test ws subprotocols throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener new application listener config class get name false tomcat add servlet ctx default new default servlet ctx add servlet mapping default tomcat start web socket container ws container container provider get web socket container tomcat start session ws session ws container connect server tester programmatic endpoint class client endpoint config builder create preferred subprotocols arrays list sp3 build new uri ws localhost get port sub protocols endpoint path basic assert assert true ws session open ws session get negotiated subprotocol null assert assert true ws session get negotiated subprotocol empty ws session close ws session ws container connect server tester programmatic endpoint class client endpoint config builder create preferred subprotocols arrays list sp2 build new uri ws localhost get port sub protocols endpoint path basic assert assert true ws session open assert assert equals sp2 ws session get negotiated subprotocol assert assert array equals new string sp1 sp2 sub protocols endpoint subprotocols array new string ws session close server endpoint value echo subprotocols sp1 sp2 public static class sub protocols endpoint public static string path basic echo public static list string subprotocols open public void process open suppress warnings unused session session endpoint config epc subprotocols server endpoint config epc get subprotocols public static class config extends ws listener override public void context initialized servlet context event sce super context initialized sce server container sc server container sce get servlet context get attribute constants server container servlet context attribute try sc add endpoint sub protocols endpoint class catch deployment exception throw new illegal state exception
subprotocols arrays list annotation subprotocols
application data application data
set socket timeout endpoint get so timeout
mh pong message new ws pong message control buffer binary mh instanceof message handler partial message handler partial string mh message message buffer text string last else caller ensures last true branch used message handler whole string mh message message buffer text string message buffer text clear mh instanceof message handler partial message handler partial byte buffer mh message msg last else caller ensures last true branch used message handler whole byte buffer mh message msg td remote ipproxies header td remote ip proxies header forwarded remote ip proxies header forwarded remote ip proxies header forwarded remote ip proxies header forwarded
-1
socket get socket set so timeout endpoint get so timeout extends realm base protected boolean use context class loader true
login context new login context app name callback handler load custom jaas protected get config try jaas loaded return jaas synchronized config file null jaas loaded true return null url resource thread current thread get context class loader get resource config file uri uri resource uri class sun config file class class name com sun security auth login config file constructor constructor sun config file get constructor uri class config constructor new instance uri jaas config jaas loaded true return jaas catch urisyntax exception ex throw new runtime exception ex catch method exception ex throw new runtime exception ex catch security exception ex throw new runtime exception ex catch exception ex throw new runtime exception ex catch illegal access exception ex throw new runtime exception ex catch illegal argument exception ex throw new runtime exception ex catch invocation target exception ex throw new runtime exception ex get cause catch class found exception ex throw new runtime exception ex attribute name config file required false name jaas file use realm searched using code class loader get resource string code so possible bundled within web application specified default jvm global jaas willbe used attribute
nio endpoint key attachment att nio endpoint key attachment socket get attachment false att null throw new ioexception key must cancelled read pool read socket get buf handler get read buffer socket selector att get timeout
int special attributes length break
int elements length break protected string rmi bind address null get inet address which platform rmi server exported return textual inet address public string get rmi bind address return rmi bind address set inet address which platform rmi server exported param rmi bind address textual inet address public void set rmi bind address string rmi bind address rmi bind address rmi bind address
rmi bind address null throw new illegal state exception sm get string jmx remote lifecycle listener ssl rmi bind address force server bind address required rmi bind address null try ssf new rmi server bind socket factory inet address get name rmi bind address catch unknown host exception log error sm get string jmx remote lifecycle listener invalid rmi bind address rmi bind address rmi server port platform env hash map string object env mbean server mbean server locate registry create registry rmi registry port implements rmiclient socket factory serializable public static class rmi server bind socket factory implements rmiserver socket factory private final inet address bind address public rmi server bind socket factory inet address address bind address address override public server socket create server socket int port throws ioexception return new server socket port bind address attribute name rmi bind address required false address interface used jmx rmi server setting option code true code incompatible setting system property code com sun management jmxremote ssl code code true code attribute
msg string client received peek get data msg string msg new msg string msg set data message one reply flip bb position bb position
write time until first byte written commit time millis protected static class first byte time element implements access log element override public void add element char array writer buf date date request request response response long time long commit time response get coyote response get commit time commit time buf append else long delta commit time request get coyote request get start time buf append long string delta case return new first byte time element private long commit time commited commit time system current time millis return time response committed based system current time millis return time response committed public long get commit time return commit time commited true commit time li time taken commit response millis li
mapper listener stop log error catalina start
protected void set encoders list class extends encoder encoders class extends encoder encoder clazz encoders instance init endpoint config protected final void close encoder entry entry encoder entries entry get encoder destroy do close protected abstract void close protected void close boolean secure list class extends encoder encoders map string object user properties ws remote endpoint set encoders encoders user properties put all user properties client endpoint get encoders client endpoint get user properties path parameters secure endpoint config get encoders endpoint config get user properties protected void close session close thread sleep 100 assert assert true server life cycle event called msg string encoder class get name init assert assert true server life cycle event called msg string decoder class get name init assert assert true server life cycle event called msg byte encoder class get name init assert assert true server life cycle event called msg byte decoder class get name init assert assert true server life cycle event called msg string encoder class get name destroy assert assert true server life cycle event called msg string decoder class get name destroy assert assert true server life cycle event called msg byte encoder class get name destroy assert assert true server life cycle event called msg byte decoder class get name destroy static hash map string boolean life cycles called new hash map public static void add life cycle event string event life cycles called put event boolean true public static boolean life cycle event called string event boolean called life cycles called get event return called null false called boolean value op op op op op op op op
boolean found binary decoder match false boolean found text decoder match false index byte buffer index byte buffer else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get declaring class get name break index string index string else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get declaring class get name extends base
string username null string password null bc starts ignore case basic bc set offset bc get offset byte decoded base64 decode base64 bc get buffer bc get offset bc get length get username password int colon int decoded length decoded colon break colon username new string decoded b2cconverter iso 8859 else username new string decoded colon b2cconverter iso 8859 password new string decoded colon decoded length colon b2cconverter iso 8859 bc set offset bc get offset principal context get realm authenticate username password principal null register request response principal http servlet request basic auth username password return true request could so reissue challenge parser http header basic per rfc 2617 section base64 encoded credentials per rfc 2045 section protected static class basic credentials only method supported parser note we include single white space its delimiter private static final string method basic private byte chunk private int initial offset private int base64blob offset private int base64blob length private string username null private string password null parse http header basic per rfc 2617 section base64 encoded credentials per rfc 2045 section param input header value parse place throws illegal argument exception header does conform rfc 2617 public basic credentials byte chunk input throws illegal argument exception input initial offset input get offset parse method byte decoded parse base64 parse credentials decoded trivial accessor return decoded username token string which never code null code can empty public string get username return username trivial accessor return decoded password token string code null code password found credentials public string get password return password method string case insensitive must hae least one space character delimiter private void parse method throws illegal argument exception starts ignore case method step past auth method name base64blob offset initial offset method length base64blob length get length method length else possible permitted throw new illegal argument exception header method basic decode base64 user pass token which rfc 2617 states can longer than 76 characters per line limit defined rfc 2045 base64 decoder ignore embedded line break characters well surplus surrounding white space private byte parse base64 throws illegal argument exception byte decoded base64 decode base64 get buffer base64blob offset base64blob length restore original offset set offset initial offset decoded null throw new illegal argument exception basic credentials base64 return decoded extract mandatory username token separate from optional password token tolerate surplus surrounding white space private void parse credentials byte decoded throws illegal argument exception int colon int decoded length decoded colon break colon username new string decoded b2cconverter iso 8859 password remain null else username new string decoded colon b2cconverter iso 8859 password new string decoded colon decoded length colon b2cconverter iso 8859 tolerate surplus white space around credentials password length password password trim tolerate surplus white space around credentials username length username username trim licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test basic basic credentials inner class associated base64 decoder private static final string nice method basic private static final string user name userid private static final string password secret test cases good basic auth credentials base64 strings can have zero one two trailing pad characters test public void test good credentials throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password test public void test good credentials password throws exception final basic auth header auth header new basic auth header nice method user name null basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert null credentials get password test public void test good crib throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password test public void test good crib user only throws exception final string base64 crib xnlcmlk final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert null credentials get password test public void test good crib one pad throws exception final string password1 secrets final string base64 crib xnlcmlk nl y3jld hm final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password1 credentials get password rfc 2045 says base64 encoded string should represented lines more than 76 characters however rfc 2617 says base64 user pass token limited 76 char line also says all line breaks including mandatory ones should ignored during decoding test case has line break base64 string see also test good crib base64big below test public void test good crib line wrap throws exception final string user long aaaabbbbcccc dddd 80 characters final string base64 crib qujdrevgr0h jskt wvph ym nk zwzna glqa2xtbm9wc xjzd hv2d3h5ej ax mj m0 nty3odkr l0fbqufcqk final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user long credentials get username rfc 2045 says base64 encoded string should represented lines more than 76 characters however rfc 2617 says base64 user pass token limited 76 char line test public void test good crib base64big throws exception our decoder accepts long token without complaint final string user long aaaabbbbcccc dddd 80 characters final string base64 crib qujdrevgr0h jskt wvph ym nk zwzna glqa2xtbm9wc xjzd hv2d3h5ej ax mj m0 nty3odkr l0fbqufcqk new line final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user long credentials get username verify parser follows rfc2617 treating auth scheme token case insensitive test public void test auth method case basic throws exception final string method ic final basic auth header auth header new basic auth header method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser rejects invalid method test public void test auth method bad method throws exception final string method bad method final basic auth header auth header new basic auth header method user name password suppress warnings unused basic basic credentials credentials null try credentials new basic basic credentials auth header get header assert fail illegal argument exception expected catch exception assert assert true instanceof illegal argument exception assert assert true get message contains header method confirm basic parser tolerates excess white space after method rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat tolerates any amount white within limits http header sizes test public void test auth method extra leading space throws exception final basic auth header auth header new basic auth header nice method user name password final basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password invalid decoded credentials cases test public void test wrong password throws exception final string pwd wrong wrong final basic auth header auth header new basic auth header nice method user name pwd wrong basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password test public void test missing username throws exception final string empty user name final basic auth header auth header new basic auth header nice method empty user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals empty user name credentials get username assert assert equals password credentials get password test public void test short username throws exception final string short user name final basic auth header auth header new basic auth header nice method short user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals short user name credentials get username assert assert equals password credentials get password test public void test short password throws exception final string short password final basic auth header auth header new basic auth header nice method user name short password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals short password credentials get password test public void test password has space embedded throws exception final string password space abc def final basic auth header auth header new basic auth header nice method user name password space basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password space credentials get password test public void test password has colon embedded throws exception final string password colon abc def final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password test public void test password has colon leading throws exception final string password colon abcdef final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password test public void test password has colon trailing throws exception final string password colon abcdef final basic auth header auth header new basic auth header nice method user name password colon basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password colon credentials get password confirm basic parser tolerates excess white space after base64 blob rfc2617 does define case asks servers tolerant kind client deviation test public void test auth method extra trailing space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser tolerates excess white space around username inside base64 blob rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space test public void test user extra space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password confirm basic parser tolerates excess white space around username within base64 blob rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space test public void test password extra space throws exception final basic auth header auth header new basic auth header nice method user name password basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password invalid base64 string tests refer rfc2045 section non trailing should trigger premature termination decoder returning truncated string eventually result assert failure test public void test bad base64inline equals throws exception final string base64 crib xnlcmlk nl y3j ao final string truncated pwd secr final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password assert assert equals truncated pwd credentials get password legal base64 character rfc says must ignored decoder scramble decoded string eventually result assert failure test public void test bad base64char throws exception final string base64 crib xnlcmlk nl 3jld hm final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert same password credentials get password legal base64 character rfc says must ignored decoder very strange case because next character pad which terminates string normally likely certain decoded password damaged subsequent fail test public void test bad base64last char throws exception final string base64 crib xnlcmlk nl y3jld final string possibly damaged pwd secret final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals possibly damaged pwd credentials get password trailing third illegal however rfc says decoder must terminate soon first pad detected so error detected unless payload has been damaged some way test public void test bad base64too many equals throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password should multiple encoded characters however rfc says decoder should pad input string zero bits out next boundary error detected unless payload has been damaged some way particular crib has damage test public void test bad base64bad length throws exception final string base64 crib xnlcmlk nl y3jld final basic auth header auth header new basic auth header nice method base64 crib basic basic credentials credentials new basic basic credentials auth header get header assert assert equals user name credentials get username assert assert equals password credentials get password encapsulate logic generate http header basic note only used internally so need validate arguments private final class basic auth header private final string http auth private final byte header http auth get bytes b2cconverter iso 8859 private byte chunk auth header private int initial offset method creates valid base64 blob private basic auth header string method string username string password method username password null method creates valid base64 blobs optional trailing data private basic auth header string method string username string password string extra blob prefix method string user credentials password null password length username username password byte credentials bytes user credentials get bytes b2cconverter iso 8859 string base64auth base64 encode base64string credentials bytes byte base64bytes base64auth get bytes b2cconverter iso 8859 byte extra bytes extra blob null extra blob length null extra blob get bytes b2cconverter iso 8859 try auth header append base64bytes base64bytes length extra bytes null auth header append extra bytes extra bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message emulate tomcat server offset points method header auth header set offset initial offset method allows injection cribbed base64 blobs without any validation contents private basic auth header string method string fake base64 prefix method byte fake bytes fake base64 get bytes b2cconverter iso 8859 try auth header append fake bytes fake bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message emulate tomcat server offset points method header auth header set offset initial offset construct common header private void prefix string method auth header new byte chunk auth header set bytes header header length initial offset header length string method method byte method bytes method get bytes b2cconverter iso 8859 try auth header append method bytes method bytes length catch ioexception ioe throw new illegal state exception unable extend byte chunk ioe get message private byte chunk get header return auth header using white space around username credential request rejected 401 sc unauthorized status todo rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space return sc ok cookies http servlet response sc unauthorized using white space around password credential request rejected 401 sc unauthorized status todo rfc2617 does define separation syntax between auth scheme basic credentials tokens tomcat should tolerate any reasonable amount white space return sc ok cookies http servlet response sc unauthorized
url str starts file url str starts jndi
check constraints uncovered http methods needs after scis listeners may change constraints ok check constraints uncovered methods private void check constraints uncovered methods todo add option lower log level any uncovered method warnings debug todo implement adding constraints deny uncovered methods set string covered patterns new hash set map string set string url method map new hash map map string set string url omitted method map new hash map first build lists covered patterns those patterns might uncovered security constraint constraint constraints security collection collections constraint find collections security collection collection collections string patterns collection find patterns string methods collection find methods string omitted methods collection find omitted methods simple case methods methods length omitted methods length string pattern patterns covered patterns add pattern continue pre calculate so we don do every iteration following loop list string om new null omitted methods length om new arrays list omitted methods only need process uncovered patterns string pattern patterns covered patterns contains pattern methods length build interset omitted methods pattern set string om url omitted method map get pattern om null om new hash set url method map put pattern om om retain all om new else build union methods pattern set string url method map get pattern null new hash set url method map put pattern string method methods add method now check potentially uncovered patterns map entry string set string entry url method map entry set string pattern entry get key covered patterns contains pattern fully covered ignore any partial coverage url omitted method map remove pattern continue set string omitted methods url omitted method map get pattern set string methods entry get value omitted methods null string builder msg new string builder string method methods msg append method msg append log error sm get string standard context uncovered http method pattern msg string trim continue long every omitted method method pattern fully covered omitted methods remove all methods omitted methods size string builder msg new string builder string method omitted methods msg append method msg append log error sm get string standard context uncovered http omitted method pattern msg string trim
break break
int mbrs length
header index token break header index token break
break break
class loader class loader thread current thread get context class loader string result null prefix defined look prefixed property first name prefix name return result private string find property string name class loader class loader thread current thread get context class loader simple property replacement mostly folder names result null result replace result licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link filter enable client side cross origin requests implementing w3c cors ross rigin esource haring resources each link http servlet request request inspected per appropriate response headers added link http servlet response default also sets following request attributes help determine nature request downstream ul li cors cors request flag determine request cors request set code true code cors request code false code otherwise li li cors request origin origin url url page from where request originated li li cors request type type request possible values ul li simple request which preceded pre flight request li li actual request which preceded pre flight request li li pre flight pre flight request li li cors normal same origin request li li invalid cors cross origin request which invalid li ul li li cors request headers request headers sent access control request headers header pre flight request li ul see href http www w3 org tr cors cors private static final log log log factory get log cors filter class private static final string manager sm string manager get manager constants package link collection origins consisting zero more origins allowed access resource private final collection string allowed origins determines any origin allowed make request private boolean any origin allowed link collection methods consisting zero more methods supported resource private final collection string allowed http methods link collection headers consisting zero more header field names supported resource private final collection string allowed http headers link collection exposed headers consisting zero more header field names headers other than simple response headers resource might use can exposed private final collection string exposed headers supports credentials flag indicates whether resource supports user credentials request true when resource does false otherwise private boolean supports credentials indicates seconds how long results pre flight request can cached pre flight result cache private long preflight max age determines request should decorated private boolean decorate request public cors filter allowed origins new hash set allowed http methods new hash set allowed http headers new hash set exposed headers new hash set override public void do filter final servlet request servlet request final servlet response servlet response final filter chain filter chain throws ioexception servlet exception servlet request instanceof http servlet request servlet response instanceof http servlet response throw new servlet exception sm get string cors filter only http safe downcast point http servlet request request http servlet request servlet request http servlet response response http servlet response servlet response determines cors request type cors filter corsrequest type request type check request type request adds cors specific attributes request decorate request cors filter decorate request request type switch request type case simple handles simple cors request handle simple cors request response filter chain break case actual handles actual cors request handle simple cors request response filter chain break case pre flight handles pre flight cors request handle preflight cors request response filter chain break case cors handles normal request cross origin request handle non cors request response filter chain break default handles cors request violates handle invalid cors request response filter chain break override public void init final filter config filter config throws servlet exception initialize defaults parse store default allowed origins default allowed http methods default allowed http headers default exposed headers default supports credentials default preflight maxage default decorate request filter config null string config allowed origins filter config get init parameter param cors allowed origins string config allowed http methods filter config get init parameter param cors allowed methods string config allowed http headers filter config get init parameter param cors allowed headers string config exposed headers filter config get init parameter param cors exposed headers string config supports credentials filter config get init parameter param cors support credentials string config preflight max age filter config get init parameter param cors preflight maxage string config decorate request filter config get init parameter param cors request decorate parse store config allowed origins config allowed http methods config allowed http headers config exposed headers config supports credentials config preflight max age config decorate request handles cors request type link corsrequest type simple param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception see href http www w3 org tr cors resource requests simple cross origin request actual request redirects protected void handle simple cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception cors filter corsrequest type request type check request type request request type cors filter corsrequest type simple request type cors filter corsrequest type actual throw new illegal argument exception sm get string cors filter wrong type2 cors filter corsrequest type simple cors filter corsrequest type actual final string origin request get header cors filter request header origin final string method request get method section origin allowed origin handle invalid cors request response filter chain return allowed http methods contains method handle invalid cors request response filter chain return section add single access control allow origin header any origin allowed supports credentials resource doesn support credentials any origin allowed make cors request return header response add header cors filter response header access control allow origin else resource supports credentials add single access control allow origin header value origin header value response add header cors filter response header access control allow origin origin section resource supports credentials add single access control allow credentials header case sensitive string true value supports credentials response add header cors filter response header access control allow credentials true section list exposed headers empty add one more access control expose headers headers values header field names given list exposed headers exposed headers null exposed headers size string exposed headers string join exposed headers response add header cors filter response header access control expose headers exposed headers string forward request down filter chain filter chain do filter request response handles cors pre flight request param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception protected void handle preflight cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception corsrequest type request type check request type request request type corsrequest type pre flight throw new illegal argument exception sm get string cors filter wrong type1 corsrequest type pre flight name lower case final string origin request get header cors filter request header origin section origin allowed origin handle invalid cors request response filter chain return section string access control request method request get header cors filter request header access control request method access control request method null http methods contains access control request method trim handle invalid cors request response filter chain return else access control request method access control request method trim section string access control request headers header request get header cors filter request header access control request headers list string access control request headers new linked list access control request headers header null access control request headers header trim empty string headers access control request headers header trim split string header headers access control request headers add header trim lower case section allowed http methods contains access control request method handle invalid cors request response filter chain return section access control request headers empty string header access control request headers allowed http headers contains header handle invalid cors request response filter chain return section supports credentials response add header cors filter response header access control allow origin origin response add header cors filter response header access control allow credentials true else any origin allowed response add header cors filter response header access control allow origin else response add header cors filter response header access control allow origin origin section preflight max age response add header cors filter response header access control max age string value preflight max age section response add header cors filter response header access control allow methods access control request method section 10 allowed http headers null allowed http headers empty response add header cors filter response header access control allow headers join allowed http headers do forward request down filter chain handles request cors request valid request cross origin request just forwards request down filter chain param request link http servlet request object param response link http servlet response object param filter chain link filter chain object throws ioexception throws servlet exception private void handle non cors final http servlet request request final http servlet response response final filter chain filter chain throws ioexception servlet exception let request pass filter chain do filter request response handles cors request violates param request link http servlet request object param response link http servlet response object param filter chain link filter chain object private void handle invalid cors final http servlet request request final http servlet response response final filter chain filter chain string origin request get header cors filter request header origin string method request get method string access control request headers request get header request header access control request headers response set content type text plain response set status http servlet response sc forbidden response reset buffer log debug enabled debug so need i18n string builder message new string builder invalid cors request origin message append origin message append method message append method access control request headers null message append access control request headers message append access control request headers log debug message string override public void destroy noop decorates link http servlet request cors attributes ul li cors cors request flag determine request cors request set code true code cors request code false code otherwise li li cors request origin origin url li li cors request type type request values code simple code code preflight code code cors code code invalid cors code li li cors request headers request headers sent access control request headers header pre flight request li ul param request link http servlet request object param cors request type link corsrequest type object protected static void decorate final http servlet request request final corsrequest type cors request type request null throw new illegal argument exception sm get string cors filter null request cors request type null throw new illegal argument exception sm get string cors filter null request type switch cors request type case simple request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case break case actual request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case break case pre flight request set attribute cors filter http request attribute cors request boolean true request set attribute cors filter http request attribute origin request get header cors filter request header origin request set attribute cors filter http request attribute request type cors request type name lower case string headers request get header request header access control request headers headers null headers request set attribute cors filter http request attribute request headers headers break case cors request set attribute cors filter http request attribute cors request boolean false break default don set any attributes break joins elements link set string where each element separated provided separator param elements link set containing elements join together param join separator character used separating elements return joined link string code null code elements link set null protected static string join final collection string elements final string join separator string separator elements null return null join separator null separator join separator string builder buffer new string builder boolean first true string element elements first buffer append separator else first false element null buffer append element return buffer string determines request type param request protected corsrequest type check request type final http servlet request request corsrequest type request type corsrequest type invalid cors request null throw new illegal argument exception sm get string cors filter null request string origin header request get header request header origin section section origin header null origin header empty request type corsrequest type invalid cors else valid origin origin header request type corsrequest type invalid cors else string method request get method method null http methods contains method options equals method string access control request method header request get header request header access control request method access control request method header null access control request method header empty request type corsrequest type pre flight else access control request method header null access control request method header empty request type corsrequest type invalid cors else request type corsrequest type actual else get equals method head equals method request type corsrequest type simple else post equals method string content type request get content type content type null content type content type lower case trim simple http request content type values contains content type request type corsrequest type simple else request type corsrequest type actual else complex http methods contains method request type corsrequest type actual else request type corsrequest type cors return request type checks origin allowed make cors request param origin origin return code true code origin allowed code false code otherwise private boolean origin allowed final string origin any origin allowed return true origin header case sensitive match any allowed origins return true else return false return allowed origins contains origin parses each param value populates variables param provided overrides default param allowed origins link string comma separated origins param allowed http methods link string comma separated http methods param allowed http headers link string comma separated http headers param exposed headers link string comma separated headers needs exposed param supports credentials true support credentials needs enabled param preflight max age amount seconds user agent allowed cache result pre flight request throws servlet exception private void parse store final string allowed origins final string allowed http methods final string allowed http headers final string exposed headers final string supports credentials final string preflight max age final string decorate request throws servlet exception allowed origins null allowed origins trim equals any origin allowed true else any origin allowed false set string set allowed origins parse string set allowed origins allowed origins clear allowed origins add all set allowed origins allowed http methods null set string set allowed http methods parse string set allowed http methods allowed http methods clear allowed http methods add all set allowed http methods allowed http headers null set string set allowed http headers parse string set allowed http headers set string lower case headers new hash set string header set allowed http headers string lower case header lower case lower case headers add lower case allowed http headers clear allowed http headers add all lower case headers exposed headers null set string set exposed headers parse string set exposed headers exposed headers clear exposed headers add all set exposed headers supports credentials null any value other true false supports credentials boolean parse boolean supports credentials preflight max age null try preflight max age empty preflight max age long parse long preflight max age else preflight max age 0l catch number format exception throw new servlet exception sm get string cors filter invalid pre flight max age decorate request null any value other true false decorate request boolean parse boolean decorate request takes comma separated list returns set string param data comma separated list strings return set string private set string parse string set final string data string splits data null data length splits data split else splits new string set string set new hash set splits length string split splits set add split trim return set checks given origin valid criteria ul li encoded character present origin valid li li origin should valid link uri li ul param origin see href http tools ietf org html rfc952 rfc952 protected static boolean valid origin string origin checks encoded characters helps prevent crlf injection origin contains return false uri origin uri try origin uri new uri origin catch urisyntax exception return false scheme uri null return false return true otherwise return origin uri get scheme null determines any origin allowed make cors request return code true code enabled false otherwise public boolean any origin allowed return any origin allowed returns link set headers should exposed browser public collection string get exposed headers return exposed headers determines supports credentials enabled public boolean supports credentials return supports credentials returns preflight response cache time seconds return time cache seconds public long get preflight max age return preflight max age returns link set allowed origins allowed make requests return link set public collection string get allowed origins return allowed origins returns link set http methods allowed make requests return link set public collection string get allowed http methods return allowed http methods returns link set headers support resource return link set public collection string get allowed http headers return allowed http headers cors response headers access control allow origin header indicates whether resource can shared based returning value origin request header response public static final string response header access control allow origin access control allow origin access control allow credentials header indicates whether response request can exposed when omit credentials flag unset when part response preflight request indicates actual request can include user credentials public static final string response header access control allow credentials access control allow credentials access control expose headers header indicates which headers safe expose api cors api public static final string response header access control expose headers access control expose headers access control max age header indicates how long results preflight request can cached preflight result cache public static final string response header access control max age access control max age access control allow methods header indicates part response preflight request which methods can used during actual request public static final string response header access control allow methods access control allow methods access control allow headers header indicates part response preflight request which header field names can used during actual request public static final string response header access control allow headers access control allow headers cors request headers origin header indicates where cross origin request preflight request originates from public static final string request header origin origin access control request method header indicates which method used actual request part preflight request public static final string request header access control request method access control request method access control request headers header indicates which headers used actual request part preflight request public static final string request header access control request headers access control request headers request attributes prefix cors request attribute public static final string http request attribute prefix cors attribute contains origin request public static final string http request attribute origin http request attribute prefix request origin boolean value suggesting request cors request public static final string http request attribute cors request http request attribute prefix cors request type cors request type link corsrequest type public static final string http request attribute request type http request attribute prefix request type request headers sent access control request headers header pre flight request public static final string http request attribute request headers http request attribute prefix request headers constants enumerates varies types cors requests also provides utility methods determine request type protected static enum corsrequest type simple http request shouldn pre flighted simple http request needs pre flighted actual pre flight cors request get meta information before non simple http request sent pre flight cors request normal request cors invalid cors request qualifies cors request fails valid one invalid cors link collection http methods case sensitive see href http tools ietf org html rfc2616 section http tools ietf org html rfc2616 section public static final collection string http methods new hash set arrays list options get head post put delete trace connect link collection non simple http methods case sensitive public static final collection string complex http methods new hash set arrays list put delete trace connect link collection simple http methods case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http methods new hash set arrays list get post head link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http request headers new hash set arrays list accept accept language content language link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http response headers new hash set arrays list cache control content language content type expires last modified pragma link collection simple http request headers case sensitive see href http www w3 org tr cors terminology http www w3 org tr cors terminology public static final collection string simple http request content type values new hash set arrays list application www form urlencoded multipart form data text plain defaults default all origins allowed make requests public static final string default allowed origins default following methods supported get post head options public static final string default allowed http methods get post head options default time duration cache pre flight response 30 mins public static final string default preflight maxage 1800 default support credentials turned public static final string default supports credentials true default following headers supported origin accept requested content type access control request method access control request headers public static final string default allowed http headers origin accept requested content type access control request method access control request headers default none headers exposed response public static final string default exposed headers default request decorated cors attributes public static final string default decorate request true filter config init param name key retrieve allowed origins from link filter config public static final string param cors allowed origins cors allowed origins key retrieve support credentials from link filter config public static final string param cors support credentials cors support credentials key retrieve exposed headers from link filter config public static final string param cors exposed headers cors exposed headers key retrieve allowed headers from link filter config public static final string param cors allowed headers cors allowed headers key retrieve allowed methods from link filter config public static final string param cors allowed methods cors allowed methods key retrieve preflight max age from link filter config public static final string param cors preflight maxage cors preflight maxage key determine request should decorated public static final string param cors request decorate cors request decorate licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private filter chain filter chain new tester filter chain tests get request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple get throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests post request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple post throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set content type text plain request set method post tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests head request treated simple request see http www w3 org tr cors simple method throws ioexception throws servlet exception test public void test do filter simple head throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method head tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case test presence specific origin response when used throws ioexception throws servlet exception test public void test do filter simple specific header throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests prsence origin response when supports credentials enabled alongwith any origin throws ioexception throws servlet exception test public void test do filter simple any origin supports credentials throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true response get header cors filter response header access control allow credentials equals true assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests presence origin response when supports credentials enabled alongwith any origin throws ioexception throws servlet exception test public void test do filter simple any origin supports credentials disabled throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs any origin assert assert null response get header cors filter response header access control allow credentials assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case tests presence exposed headers response configured throws ioexception throws servlet exception test public void test do filter simple exposed headers throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config exposed headers cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true response get header cors filter response header access control expose headers equals tester filter configs exposed headers assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case checks options request processed pre flight throws ioexception throws servlet exception test public void test do filter preflight throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type checks options request processed pre flight where any origin enabled throws ioexception throws servlet exception test public void test do filter preflight any origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type checks options request processed pre flight throws ioexception throws servlet exception test public void test do filter preflight invalid origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www example com request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals response get status http servlet response sc forbidden test public void test do filter preflight negative max age throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config negative max age cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert null response get header cors filter response header access control max age assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type test public void test do filter preflight credentials throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert true response get header cors filter response header access control allow credentials equals true assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type test public void test do filter preflight without credentials specific origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config specific origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals tester filter configs https www apache org assert assert null response get header cors filter response header access control allow credentials assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type pre flight name lower case assert assert true request get attribute cors filter http request attribute request headers equals content type negative test when cors request arrives null origin test public void test do filter null origin throws ioexception servlet exception tester http servlet request request new tester http servlet request request set method post request set content type text plain tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type cors request type cors filter do filter request response filter chain assert assert false boolean request get attribute cors filter http request attribute cors request boolean value test public void test do filter invalid corsorigin allowed throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin www google com request set method post tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status test expected servlet exception class public void test do filter null request null response throws ioexception servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter null null filter chain test expected servlet exception class public void test do filter null request response throws ioexception servlet exception tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter null response filter chain test expected servlet exception class public void test do filter request null response throws ioexception servlet exception tester http servlet request request new tester http servlet request cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request null filter chain test public void test init default filter config throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init null cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert true boolean request get attribute cors filter http request attribute cors request boolean value assert assert true request get attribute cors filter http request attribute origin equals tester filter configs https www apache org assert assert true request get attribute cors filter http request attribute request type equals cors filter corsrequest type simple name lower case test expected servlet exception class public void test init invalid filter config throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get filter config invalid max preflight age we don get exception point all mocked objects worked expected tests non simple request given simple request handler throws ioexception throws servlet exception test expected illegal argument exception class public void test simple throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter handle simple cors request response filter chain when non preflight request given pre flight request handler throws ioexception throws servlet exception test expected illegal argument exception class public void test preflight throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter handle preflight cors request response filter chain test expected illegal argument exception class public void test decorate null request null corsrequest type cors filter decorate null null test expected illegal argument exception class public void test decorate null request valid corsrequest type cors filter decorate null cors filter corsrequest type simple test expected illegal argument exception class public void test decorate valid request null request type tester http servlet request request new tester http servlet request cors filter decorate request null test public void test decorate corsrequest type cors tester http servlet request request new tester http servlet request cors filter decorate request cors filter corsrequest type cors assert assert false boolean request get attribute cors filter http request attribute cors request boolean value test public void test decorate corsrequest type invalid cors tester http servlet request request new tester http servlet request cors filter decorate request cors filter corsrequest type invalid cors assert assert null request get attribute cors filter http request attribute cors request test public void test check simple request type any origin throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type simple request type happy path test when valid cors simple request arrives throws servlet exception test public void test check simple request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type simple request type happy path test when valid cors simple request arrives throws servlet exception test public void test check actual request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method put cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type happy path test when valid cors simple request arrives throws servlet exception test public void test check actual request type method postnot simple headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method post request set content type application json cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers content type request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type when valid cors pre flight request arrives access control request method throws servlet exception throws ioexception test public void test check pre flight request type acrm throws servlet exception ioexception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type actual request type when valid cors pre flight request arrives empty access control request method throws servlet exception throws ioexception test public void test check pre flight request type empty acrm throws servlet exception ioexception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type section throws servlet exception throws ioexception test public void test check pre flight request type invalid request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method polite request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type unsupported request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method trace request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type unsupported request headers throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs https www apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers answer request set method options cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status section section throws servlet exception throws ioexception test public void test check pre flight request type any origin credentials throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers origin request set method options cors filter cors filter new cors filter cors filter init tester filter configs get filter config any origin supports credentials disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals assert assert null response get header cors filter response header access control allow credentials test public void test check pre flight request type origin allowed throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin www ebay com request set header cors filter request header access control request method put request set method options cors filter cors filter new cors filter cors filter init tester filter configs get secure filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status happy path test when valid cors pre flight request arrives throws servlet exception test public void test check pre flight request type empty headers throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs http tomcat apache org request set header cors filter request header access control request method put request set header cors filter request header access control request headers request set method options cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type pre flight request type negative test when cors request arrives empty origin throws servlet exception test public void test check corsrequest type empty origin throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type tests failure when different domain used allowed list origins throws servlet exception throws ioexception test public void test check invalid origin throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin www example com request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status tests failure when different sub domain used allowed list origins throws servlet exception throws ioexception test public void test check invalid origin allowed subdomain throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http commons apache org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status put allowed request method throws servlet exception throws ioexception test public void test check invalid request method throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http tomcat apache org request set method put cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status when request method null throws servlet exception test public void test check null request method throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http tomcat apache org request set method null cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type http tomcat apache org allowed origin https tomcat apache org because scheme doesn match throws servlet exception test public void test check scheme variance throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin https tomcat apache org request set method post cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type http tomcat apache org allowed origin http tomcat apache org 8080 because ports doesn match throws servlet exception throws ioexception test public void test check port variance throws servlet exception ioexception tester http servlet request request new tester http servlet request tester http servlet response response new tester http servlet response request set header cors filter request header origin http tomcat apache org 8080 request set method get cors filter cors filter new cors filter cors filter init tester filter configs get specific origin filter config cors filter do filter request response filter chain assert assert equals http servlet response sc forbidden response get status tests failure when invalid link http servlet request encountered throws servlet exception test expected illegal argument exception class public void test check request type null throws servlet exception http servlet request request null cors filter cors filter new cors filter cors filter check request type request test public void test join set string elements new linked hash set string separator elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test join single element set string elements new linked hash set string separator elements add world string join cors filter join elements separator assert assert true world equals join test public void test join sep null set string elements new linked hash set string separator null elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test join elements null set string elements null string separator string join cors filter join elements separator assert assert null join test public void test join one null element set string elements new linked hash set string separator elements add null elements add peace string join cors filter join elements separator assert assert true peace equals join test public void test join all null elements set string elements new linked hash set string separator elements add null elements add null string join cors filter join elements separator assert assert true equals join test public void test join all empty elements set string elements new linked hash set string separator elements add elements add string join cors filter join elements separator assert assert true equals join test public void test join pipe separator set string elements new linked hash set string separator elements add world elements add peace string join cors filter join elements separator assert assert true world peace equals join test public void test filter config throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get default filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter any origin allowed assert assert true cors filter get exposed headers size assert assert true cors filter supports credentials assert assert true cors filter get preflight max age 1800 test expected servlet exception class public void test filter config invalid preflight age throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get filter config invalid max preflight age test public void test string parser empty throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get empty filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter get exposed headers size assert assert false cors filter supports credentials assert assert true cors filter get preflight max age init param null default value used throws servlet exception test public void test string parser null throws servlet exception cors filter cors filter new cors filter cors filter init tester filter configs get null filter config assert assert true cors filter get allowed http headers size assert assert true cors filter get allowed http methods size assert assert true cors filter get allowed origins size assert assert true cors filter any origin allowed assert assert true cors filter get exposed headers size assert assert true cors filter supports credentials assert assert true cors filter get preflight max age 1800 test public void test valid origin assert assert true cors filter valid origin http www w3 org test public void test valid origin crlf assert assert false cors filter valid origin http www w3 org test public void test valid origin encoded crlf1 assert assert false cors filter valid origin http www w3 org 0d 0a test public void test valid origin encoded crlf2 assert assert false cors filter valid origin http www w3 org 0d 0a test public void test valid origin encoded crlf3 assert assert false cors filter valid origin http www w3 org 0d 0ad 0d 0aa test public void test check invalid crlf1 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf2 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf3 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org 0d 0a request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test check invalid crlf4 throws servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin http www w3 org 0d 0a request set method get cors filter cors filter new cors filter cors filter init tester filter configs get default filter config cors filter corsrequest type request type cors filter check request type request assert assert equals cors filter corsrequest type invalid cors request type test public void test decorate request disabled throws ioexception servlet exception tester http servlet request request new tester http servlet request request set header cors filter request header origin tester filter configs https www apache org request set method get tester http servlet response response new tester http servlet response cors filter cors filter new cors filter cors filter init tester filter configs get filter config decorate request disabled cors filter do filter request response filter chain assert assert true response get header cors filter response header access control allow origin equals https www apache org assert assert null request get attribute cors filter http request attribute cors request assert assert null request get attribute cors filter http request attribute origin assert assert null request get attribute cors filter http request attribute request headers assert assert null request get attribute cors filter http request attribute request type test public void test destroy nothing test op licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license override public void do filter servlet request request servlet response response throws ioexception servlet exception op licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final string https www apache org https www apache org public static final string http tomcat apache org http tomcat apache org public static final string exposed headers custom header any origin public static final string any origin public static final tester servlet context mock servlet context new tester servlet context public static filter config get default filter config final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config any origin supports credentials final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials true final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config any origin supports credentials disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials false final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config specific origin supports credentials disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins http tomcat apache org https www apache org final string exposed headers cors filter default exposed headers final string support credentials false final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config exposed headers final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get secure filter config final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string allowed origins https www apache org final string exposed headers cors filter default exposed headers final string support credentials true final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get null filter config return generate filter config null null null null null null null public static filter config get specific origin filter config final string allowed origins https www apache org http tomcat apache org final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get specific origin filter config negative max age final string allowed origins https www apache org http tomcat apache org final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods put final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config invalid max preflight age final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age abc final string decorate request cors filter default decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get empty filter config final string allowed http headers final string allowed http methods final string allowed origins final string exposed headers final string support credentials final string preflight max age final string decorate request return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request public static filter config get filter config decorate request disabled final string allowed http headers cors filter default allowed http headers final string allowed http methods cors filter default allowed http methods final string allowed origins cors filter default allowed origins final string exposed headers cors filter default exposed headers final string support credentials cors filter default supports credentials final string preflight max age cors filter default preflight maxage final string decorate request false return generate filter config allowed http headers allowed http methods allowed origins exposed headers support credentials preflight max age decorate request private static filter config generate filter config final string allowed http headers final string allowed http methods final string allowed origins final string exposed headers final string support credentials final string preflight max age final string decorate request filter config filter config new filter config override public string get filter name return cors filter override public servlet context get servlet context return mock servlet context override public string get init parameter string name cors filter param cors allowed headers equals ignore case name return allowed http headers else cors filter param cors allowed methods equals ignore case name return allowed http methods else cors filter param cors allowed origins equals ignore case name return allowed origins else cors filter param cors exposed headers equals ignore case name return exposed headers else cors filter param cors support credentials equals ignore case name return support credentials else cors filter param cors preflight maxage equals ignore case name return preflight max age else cors filter param cors request decorate equals ignore case name return decorate request return null override public enumeration string get init parameter names return null return filter config licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private map string object attributes new hash map private map string list string headers new hash map private string method private string content type override public object get attribute string name return attributes get name override public enumeration string get attribute names return collections enumeration attributes key set override public string get character encoding throw new runtime exception implemented override public void set character encoding string env throws unsupported encoding exception override public int get content length throw new runtime exception implemented override public string get content type return content type public void set content type string content type content type content type override public servlet input stream get input stream throws ioexception throw new runtime exception implemented override public string get parameter string name throw new runtime exception implemented override public enumeration string get parameter names throw new runtime exception implemented override public string get parameter values string name throw new runtime exception implemented override public map string string get parameter map throw new runtime exception implemented override public string get protocol throw new runtime exception implemented override public string get scheme throw new runtime exception implemented override public string get server name throw new runtime exception implemented override public int get server port throw new runtime exception implemented override public buffered reader get reader throws ioexception throw new runtime exception implemented override public string get remote addr throw new runtime exception implemented override public string get remote host throw new runtime exception implemented override public void set attribute string name object attributes put name override public void remove attribute string name attributes remove name override public locale get locale throw new runtime exception implemented override public enumeration locale get locales throw new runtime exception implemented override public boolean secure throw new runtime exception implemented override public request dispatcher get request dispatcher string path throw new runtime exception implemented override public string get real path string path throw new runtime exception implemented override public int get remote port throw new runtime exception implemented override public string get local name throw new runtime exception implemented override public string get local addr throw new runtime exception implemented override public int get local port throw new runtime exception implemented override public string get auth type throw new runtime exception implemented override public cookie get cookies throw new runtime exception implemented override public long get date header string name throw new runtime exception implemented override public string get header string name list string list headers get name list null return list get return cors filter join new hash set list return null public void set header string name string value list string values new array list values add value headers put name values override public enumeration string get headers string name throw new runtime exception implemented override public enumeration string get header names return collections enumeration headers key set override public int get int header string name throw new runtime exception implemented override public string get method return method public void set method string method method method override public string get path info throw new runtime exception implemented override public string get path translated throw new runtime exception implemented override public string get context path throw new runtime exception implemented override public string get query string throw new runtime exception implemented override public string get remote user throw new runtime exception implemented override public boolean user role string role throw new runtime exception implemented override public principal get user principal throw new runtime exception implemented override public string get requested session id throw new runtime exception implemented override public string get request uri throw new runtime exception implemented override public string buffer get request url throw new runtime exception implemented override public string get servlet path throw new runtime exception implemented override public http session get session boolean create throw new runtime exception implemented override public http session get session throw new runtime exception implemented override public boolean requested session id valid throw new runtime exception implemented override public boolean requested session id from cookie throw new runtime exception implemented override public boolean requested session id from url throw new runtime exception implemented override public boolean requested session id from url throw new runtime exception implemented override public long get content length long throw new runtime exception implemented override public servlet context get servlet context throw new runtime exception implemented override public async context start async throws illegal state exception throw new runtime exception implemented override public async context start async servlet request servlet request servlet response servlet response throws illegal state exception throw new runtime exception implemented override public boolean async started throw new runtime exception implemented override public boolean async supported throw new runtime exception implemented override public async context get async context throw new runtime exception implemented override public dispatcher type get dispatcher type throw new runtime exception implemented override public string change session id throw new runtime exception implemented override public boolean authenticate http servlet response response throws ioexception servlet exception throw new runtime exception implemented override public void login string username string password throws servlet exception throw new runtime exception implemented override public void logout throws servlet exception throw new runtime exception implemented override public collection part get parts throws ioexception servlet exception throw new runtime exception implemented override public part get part string name throws ioexception servlet exception throw new runtime exception implemented override public extends http upgrade handler upgrade class http upgrade handler class throws ioexception throw new runtime exception implemented private print writer pw private list string header names new array list private list string header values new array list private int status
override public print writer get writer throws ioexception pw null pw new print writer new string writer return pw override public string get header string name int index header names index name index return header values get index return null override public void set header string name string value int index header names index name index header values set index value else header names add name header values add value override public void add header string name string value header names add name header values add value override public int get status return status override public void set status int status status status public print writer get writer throws ioexception return null override public string get header string name return null override override public int get status return public void add header string name string value noop override public void set header string name string value noop override override public void set status int status noop subsection name introduction filter triggers parameters parsing request rejects request some parameters were skipped during parameter parsing because parsing errors request size limitations code max parameter count code attribute href http html connector filter can used ensure none parameter values submitted client lost note parameter parsing may consume body http request so caution needed servlet protected filter uses code request get input stream code code request get reader code calls general risk breaking web application adding filter so high because parameter parsing does check content type request before consuming request body note post requests parsed correctly code set character encoding filter code filter must configured above one see character encoding page faq details request rejected http status code 400 bad request subsection subsection name filter class name filter class name failed request filter strong code org apache catalina filters failed request filter code strong subsection subsection name parameters failed request filter does support any parameters subsection
context path web application we managing protected string path null public string get path return path public void set path string path path path string builder sb new string builder deploy path sb append urlencoder encode path get charset
request remove note constants req ssoid note
private handshake status handshake status private status result status handshake status handshake status ssl engine get handshake status handshake status check result true socket read buffer position handshake status check result false private handshake status check result sslengine result result boolean wrap throws sslexception result get status status ok return result get handshake status
application part part new application part item mce private final multipart config element mce public application part file item file item multipart config element mce mce mce file new file mce get location file name
class plugin class class name plugin class str
ctx get executor execute ch input thread private boolean compress false
spdy context set tls comprression false false public boolean compress return compress public void set compress boolean compress compress compress add experimental support sdpy includes from sheldon shao costin add
parsing request line phase mark current buffer position mark current buffer position public static final string crlf test case https issues apache org bugzilla show bug cgi id 54947 test public void test bug54947 client new client do request assert true client response200 assert true client response body ok bug 54947 test client private class extends simple http client private exception do request tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root bug54947 new tester servlet root add servlet mapping test bug54947 try tomcat start set port tomcat get connector get local port open connection connect string request new string request get http localhost 8080 test http cr request lf connection close crlf crlf set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok get response body null return false get response body contains ok return false return true public void test get throws exception do test get get false
public void test post continue throws exception do test post get false public void test post continue throws exception do test post get true public void test post continue post redirect throws exception do test post post false public void test post continue post redirect throws exception do test post post true private void do test string resource method string redirect method boolean use continue throws exception form auth client client new form auth client first request resource client do resource request resource method string login uri client extract body uri form auth client login param tag form auth client login resource string original session id null server use cookies client should use cookies original session id client get session id else original session id client extract path session id login uri second request login page client do login request assert true client response302 string redirect uri client get redirect uri third request follow redirect client do resource request redirect method string protected uri client extract body uri form auth client resource param tag form auth client protected resource string new session id null server use cookies client should use cookies new session id client get session id else new session id client extract path session id protected uri boolean session id changed original session id equals new session id assert true session id changed server change sessid subsequent requests direct resource int client do resource request resource method assert true client response body ok encapsulate logic needed run suitably configured tomcat instance send http request process server response private static final string login page security check private string protected page index jsp private string protected location examples jsp security protected private string session id null private form auth client throws exception set use cookies client should use cookies ctx set cookies server should use cookies perhaps does work until tomcat has started ctx set session timeout timeout mins valve pipeline only established after tomcat starts valve valves ctx get pipeline get valves valve valve valves valve instanceof base base valve set change session id server should change sessid break private void do resource request string method throws exception string request tail request head append method append append protected location append protected page get equals method request head append role bar next add constant http headers any optional http headers session id null request head append cookie jsessionid append session id append crlf finally posts only deal request content request tail null request tail role bar request head append content length append crlf request head append crlf request tail role bar else request tail crlf string request new string request request head string request request tail do request request private void do login request throws exception string builder request head new string builder 128 request head append post append protected location append login page append http append crlf request head append host localhost append crlf request head append connection close append crlf get use continue request head append expect 100 continue append crlf session id null request head append cookie jsessionid append session id append crlf request head append content type application www form urlencoded append crlf request head append content length 35 append crlf request username tomcat password tomcat string new session id get session id new session id null session id new session id verify server response html body page we expect based dialogue position within do test request count first request should result login page assert contains get response body title login page examples title return true else request count second request should result redirect return true else subsequent requests should result protected page role parameter should have reached page string body get response body assert contains body title protected page examples title assert contains body input type text name role value bar return true return full path extract session id path element exists given url private string extract path session id string url string session id null int start url index session parameter start start start session parameter start length string remainder url substring start string tokenizer parser new string tokenizer remainder session path parameter tails parser has more elements session id parser next token else session id url substring start return session id fail response body check failure public abstract output buffer cause loading constants int foo constants http 11 bytes
-1
encoding parameters default encoding http conn get connection http conn get connection test public void test bug54984 throws exception tomcat tomcat get tomcat instance context root tomcat add context system get property java io tmpdir root set allow casual multipart parsing true tomcat add servlet root bug54984 new root add servlet mapping bug54984 tomcat start http conn get connection http localhost get port parse parameters before parse parts prepare request bug54984 conn check response bug54984 conn conn disconnect conn get connection http localhost get port prepare request bug54984 conn check response bug54984 conn conn disconnect private http get connection throws ioexception final string query http localhost get port private static class extends http servlet private static final long serial version uid 1l override protected void do post http servlet request req http servlet response resp throws servlet exception ioexception req set character encoding utf req get request uri ends parse parameters before parse parts req get parameter names req get part part resp get writer println part req get parameter part private void prepare request bug54984 http conn throws exception string boundary system current time millis conn set request property content type multipart form data boundary boundary print writer writer null try writer new print writer new output stream writer conn get output stream utf true writer append boundary append writer append content disposition form data name part writer append content type text plain charset utf writer append writer append append writer flush writer append writer flush writer append boundary append finally writer null writer close private void check response bug54984 http conn throws exception list string response new array list int status conn get response code status http http ok buffered reader reader null try reader new buffered reader new input stream reader conn get input stream string line null while line reader read line null response add line assert true response contains part catch exception reader null reader close else fail ok status expected status
test public void test bug54928 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async servlet servlet new async servlet wrapper tomcat add servlet ctx async servlet set async supported true ctx add servlet mapping async async tomcat start simple http client client new simple http client override public boolean response body ok return true string request get async http simple http client crlf host simple http client crlf simple http client crlf client set port get port client set request new string request client connect client send request int 10 system out println client read line client disconnect wait server thread stop while servlet get thread alive thread sleep 250 private static class async servlet extends http servlet private static final long serial version uid 1l hack won work generally servlets expected handle more than one request private thread public thread get thread return override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp set character encoding utf final output stream os resp get output stream final async context async ctxt req start async async ctxt set timeout 3000 new thread new runnable override public void run while true try os write test get bytes b2cconverter utf os flush thread sleep 1000 catch exception async ctxt complete break set name test bug54928 start
string name path
return context get jsp config descriptor test public void test get jsp config descriptor throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context standard context standard context tomcat add webapp null test app dir get absolute path servlet context servlet context standard context get servlet context assert assert null servlet context get jsp config descriptor tomcat start assert assert null servlet context get jsp config descriptor
session cookie config new application session cookie config context private final session cookie config session cookie config new application session cookie config context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise comment context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise domain name context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise http only context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise max age context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise name context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise path context get path context get state equals lifecycle state starting prep throw new illegal state exception sm get string application session cookie config ise secure context get path licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private application session cookie config application session cookie config private final custom context context new custom context before public void set up throws exception application session cookie config new application session cookie config context test public void test set comment init phase context set state lifecycle state starting prep application session cookie config set comment test assert true application session cookie config get comment equals test test expected illegal state exception class public void test set comment init phase context set state lifecycle state started application session cookie config set comment test test public void test set domain init phase context set state lifecycle state starting prep application session cookie config set domain test assert true application session cookie config get domain equals test test expected illegal state exception class public void test set domain init phase context set state lifecycle state started application session cookie config set domain test test public void test set http only init phase context set state lifecycle state starting prep application session cookie config set http only true assert true application session cookie config http only test expected illegal state exception class public void test set http only init phase context set state lifecycle state started application session cookie config set http only true test public void test set max age init phase context set state lifecycle state starting prep application session cookie config set max age assert true application session cookie config get max age test expected illegal state exception class public void test set max age init phase context set state lifecycle state started application session cookie config set max age test public void test set name init phase context set state lifecycle state starting prep application session cookie config set name test assert true application session cookie config get name equals test test expected illegal state exception class public void test set name init phase context set state lifecycle state started application session cookie config set name test test public void test set path init phase context set state lifecycle state starting prep application session cookie config set path test assert true application session cookie config get path equals test test expected illegal state exception class public void test set path init phase context set state lifecycle state started application session cookie config set path test test public void test set secure init phase context set state lifecycle state starting prep application session cookie config set secure true assert true application session cookie config secure test expected illegal state exception class public void test set secure init phase context set state lifecycle state started application session cookie config set secure true private static class custom context extends standard context private lifecycle state state override public lifecycle state get state return state override public synchronized void set state lifecycle state state state state
private static skip constant result skip constant string reader input string constant throws ioexception int len constant length reset input mark skip lws while 32 reset input reset return private static skip constant result skip constant string reader input string constant throws ioexception int len constant length int skip lws input false int input read skip lws while 32 input read int input read skip lws while 32 input read use mark reset skip fails when reading last character input input mark int input read go back so first character available read again input reset int input read skip lws while 32 input read int input read skip lws while 32 input read string lws lws values do test lws parameters private void do test string lws parameter parameters throws ioexception sb append string return string public string string string lws sb append lws sb append lws sb append lws sb append lws sb append lws
while iter has next object entry iter next loaded child entry return true catch concurrent modification exception log warn sm get string webapp class loader clazz get name get context name
validate rest headers reject request validation fails check see web socket has matching mapping ws server container sc ws server container get server container string path string path info req get path info path info null path req get servlet path else path req get servlet path path info ws mapping result mapping result sc find mapping path mapping result null endpoint registered requested path let application handle might redirect forward example chain do filter request response return validate rest headers reject request validation fails need endpoint instance progress further ws server container sc ws server container get server container string path string path info req get path info path info null path req get servlet path else path req get servlet path path info ws mapping result mapping result sc find mapping path mapping result null endpoint registered requested path let application handle might redirect forward example chain do filter request response return
string ctxt generate java source else items instanceof string ctxt generate java source iter iterator new string tokenizer string items test public void test bug54888 throws exception byte chunk res new byte chunk int rc get url http localhost get port test bug5nnnn bug54888 jsp res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok assert assert true body contains ok assert assert true body contains ok licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license page encoding iso 8859 session true import java io reader java io string reader body each items var foo ok foo each body
tag dependent nesting assert equals http servlet response sc internal server error rc assert null test public void test bug54801 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug5nnnn bug54801a jspx bc null assert assert equals http servlet response sc ok rc bc recycle rc get url http localhost get port test bug5nnnn bug54801b jspx bc null assert assert equals http servlet response sc ok rc test public void test bug54821 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug5nnnn bug54821a jspx bc null assert assert equals http servlet response sc ok rc bc recycle rc get url http localhost get port test bug5nnnn bug54821b jspx bc null assert assert equals http servlet response sc ok rc licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license foo out println hello world licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license foo out println hello world licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
catch ioexception ioe listener get class get name ioe catch ioexception ioe listener get class get name ioe catch ioexception ioe listener get class get name ioe catch ioexception ioe listener get class get name ioe private int status 200 test public void test bug54178 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path new wrapper wrapper tomcat add servlet ctx wrapper set async supported true ctx add servlet mapping new tomcat add servlet ctx ctx add servlet mapping tomcat start byte chunk body new byte chunk int rc try rc get url http localhost get port param name bar body null catch ioexception ioe may happen test fails output exception case useful let asserts handle failure ioe print stack trace assert equals http servlet response sc ok rc body recycle rc get url http localhost get port body null assert equals http servlet response sc ok rc assert equals ok body string private static class extends http servlet public static final string param name foo private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception req get parameter param name async context actxt req start async actxt add listener new listener actxt complete private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain print writer pw resp get writer string result req get parameter param name result null pw write ok else pw write fail private static class listener implements async listener override public void complete async event event throws ioexception throw new runtime exception testing bug54178 override public void timeout async event event throws ioexception op override public void error async event event throws ioexception op override public void start async async event event throws ioexception op
string temp get name
note http request includes valid upgrade request mapping result null endpoint registered requested path let application handle might redirect forward example chain do filter request response return fr add mapping url patterns null false template matches null templates equal number segments so matches return null
try session close catch ioexception todo auto generated catch block print stack trace private static final asynchronous channel group asynchronous channel group static asynchronous channel group result null need do right thread context class loader else first web app call trigger leak class loader original thread current thread get context class loader try thread current thread set context class loader async iothread factory class get class loader same settings default asynchronous channel group int initial size runtime get runtime available processors executor service executor service new thread pool executor integer max value long max value time unit milliseconds new synchronous queue runnable new async iothread factory try result asynchronous channel group cached thread pool executor service initial size catch ioexception good reason happen throw new illegal state exception sm get string ws web socket container asynchronous channel group fail finally thread current thread set context class loader original asynchronous channel group result
socket channel asynchronous socket channel open throw new deployment exception todo ioe throw new deployment exception todo create threads async io have right context class loader prevent memory leaks private static class async iothread factory implements thread factory private atomic integer count new atomic integer override public thread new thread runnable thread new thread set name web socket client async io count increment get set context class loader get class get class loader set daemon true return
template matches new tree set template matches new tree set new template path match comparator comparator thread safe so only create single instance private static final template path match comparator instance new template path match comparator public static template path match comparator get instance return instance private template path match comparator hide default constructor licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test bug54807 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener class get name tomcat add servlet ctx default new default servlet ctx add servlet mapping default tomcat start assert assert equals lifecycle state started ctx get state public static class extends ws listener override public void context initialized servlet context event sce super context initialized sce ws server container sc ws server container get server container server endpoint config sec server endpoint config builder create tester echo server basic class param build try sc add endpoint sec catch deployment exception throw new runtime exception
request request uri set bytes frame data frame off value len
else web xml normal folder impact fragment set true
ep endpoint sec get endpoint class new instance catch exception illegal access exception private boolean closed false
closed throw new ioexception sm get string ws frame closed close frame has been received further data should have seen open throw new ioexception sm get string ws frame closed closed true protected boolean open return open channel read response null handler while sis ready
closed true delegate null closed true delegate null licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interceptor counts opened statements used tests private final atomic integer count open new atomic integer private final atomic integer count closed new atomic integer public int get active count return count open get count closed get override protected object create decorator object proxy method method object args object statement constructor constructor string sql throws exception illegal access exception invocation target exception object result statement proxy statement proxy new statement proxy statement statement sql result constructor new instance new object statement proxy statement proxy set actual proxy result statement proxy set connection proxy statement proxy set constructor constructor count open increment get return result private class statement proxy extends statement decorator interceptor statement proxy statement public statement proxy statement delegate string sql super delegate sql override public void close invoked count closed increment get super close invoked public void test statement close1 throws exception init datasource set jdbc interceptors test statement cache interceptor class get name prepared true callable false max statement counter interceptor class get name connection con datasource get connection statement counter interceptor counter find interceptor con statement counter interceptor class prepared statement ps1 ps2 ps1 con prepare statement select assert assert equals counter get active count ps1 close assert assert equals statement goes cache closed counter get active count ps1 con prepare statement select assert assert equals reusing statement from cache counter get active count ps2 con prepare statement select assert assert equals reusing statement from cache counter get active count ps2 close assert assert equals statement goes cache closed counter get active count ps1 close cache has max following tests bz 54732 assert assert equals statement does go cache closed counter get active count con close assert assert equals connection returned pool statement cache counter get active count datasource close assert assert equals pool cleared all statements cache closed counter get active count test public void test statement close2 throws exception init datasource set jdbc interceptors test statement cache interceptor class get name prepared false callable false max 10 statement counter interceptor class get name connection con datasource get connection statement counter interceptor counter find interceptor con statement counter interceptor class prepared statement ps1 con prepare statement select assert assert equals counter get active count ps1 close assert assert equals statement pooled closes immediately counter get active count test helper method finds interceptor instance interceptor chain proxied class param proxy proxy class param clazz interceptor class we looking return instance code clazz code private static extends jdbc interceptor find interceptor object proxy class clazz jdbc interceptor interceptor jdbc interceptor proxy get invocation handler proxy while interceptor null clazz instance interceptor return clazz cast interceptor interceptor interceptor get next return null
int fields length string name prefix fields substring upper case locale english fields substring buf append fields buf append invoke new object shouldn happen print stack trace
check state check state check state check state check state check state check state check state check state check state check state check state check state check state check state check state check state fire endpoint close close reason fire endpoint close close reason private void fire endpoint close close reason close reason fire close event thread thread current thread class loader cl get context class loader set context class loader application class loader try local endpoint close close reason finally set context class loader cl fire close event thread thread current thread class loader cl get context class loader set context class loader application class loader try local endpoint close close reason finally set context class loader cl check state check state check state check state check state check state private void check state open throw new illegal state exception sm get string ws session closed set s3a get open sessions while set size count set s3a get open sessions set size assert fail were set size open sessions assert assert equals expected set size while set size expected count set s3a get open sessions assert assert equals set size private int get open count set session sessions int result session session sessions session open result return result
writer get send writer encoder text stream encoder encode obj output stream os get send stream encoder binary stream encoder encode obj os
method mapping get close args path parameters session protected final boolean unwrap session session object params int index payload boolean unwrap unwrap unwrap boolean unwrap int index boolean int index session super pojo method session params index payload unwrap unwrap session session object params int index payload boolean unwrap super pojo method session params index payload unwrap index boolean session session object params int index payload boolean unwrap super pojo method session params index payload unwrap index boolean boolean unwrap int index session super pojo method session params index payload unwrap decoded unwrap required unwrap only ever applies byte buffers unwrap byte buffer bb byte buffer message byte array new byte bb remaining bb get array payload array protected object convert message return message private final boolean input stream int index payload boolean unwrap int index session super pojo method session params index payload unwrap index session else decoder text stream class assignable from decoder clazz input stream input stream protected object convert byte buffer message byte array new byte message remaining message get array input stream return new byte array input stream array else return array override session session object params int index payload boolean unwrap super pojo method session params index payload unwrap index session int index payload boolean unwrap int index session super pojo method session params index payload unwrap else decoder text stream class assignable from decoder clazz protected object convert string message return new string reader message override open params get path params open false close params get path params close false error params get path params error true return build args open params path parameters session null session session return build args close params path parameters session null return build args error params path parameters session throwable private static pojo path param get path params method boolean error else close type equals close reason class result new pojo path param type null throwable throwable else type equals close reason class result close reason private int index input stream private int index reader else types reader class index reader index reader else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name else types input stream class index input stream index input stream else throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name index reader index payload throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name else index payload index reader index input stream index payload throw new illegal argument exception sm get string pojo method mapping duplicate message param get name get class get name else index payload index input stream index reader index boolean throw new illegal argument exception sm get string pojo method mapping partial reader get name get class get name index input stream index boolean throw new illegal argument exception sm get string pojo method mapping partial input stream get name get class get name config params index byte array true index session index session
http equals ignore case scheme https equals ignore case scheme http equals ignore case scheme uri uri new uri http localhost get port new uri http localhost get port new uri http tester echo server config path async new uri http localhost get port new uri http localhost get port blocking config path new uri http localhost get port new uri http localhost get port uri uri new uri http localhost get port uri uri new uri http localhost get port param one
uriencoding lower uriencoding lower case locale us charset name lower case locale us charset alias lower case locale us charset string lower case enc enc lower case locale us integer type field types get field lower case locale us parameters put attribute lower case locale us value parameters put attribute lower case locale us return parameters get parameter lower case locale us string name prefix fields substring upper case locale us session cookie name lower case locale us licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final string param one abcde private static final string param two 12345 private static final string param three true test public void test throws exception set up utility classes server server new server singleton configurator set instance server server config listener set pojo clazz server class tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir ctx add application listener server config listener class get name web socket container ws container container provider get web socket container tomcat start client client new client uri uri new uri http localhost get port param one param two param three session session ws container connect server client uri session get basic remote send text op session close give server 5s close int count while count 50 server closed break count thread sleep 100 count 50 assert fail server did process close event within seconds client sending close message check errors list string errors server get errors string error errors system err println error assert assert equals found errors errors size client endpoint public static final class client server endpoint value one two three configurator singleton configurator class public static final class server private final list string errors new array list private volatile boolean closed open public void open path param one string p1 path param two int p2 path param three boolean p3 check params open p1 p2 p3 message public void message suppress warnings unused string msg path param one string p1 path param two int p2 path param three boolean p3 check params message p1 p2 p3 close public void close path param one string p1 path param two int p2 path param three boolean p3 check params close p1 p2 p3 closed true public list string get errors return errors public boolean closed return closed private void check params string method string p1 int p2 boolean p3 check param method param one p1 check param method param two integer string p2 check param method param three boolean string p3 private void check param string method string expected string actual expected equals actual errors add method method expected expected actual
-1
parses given source stores parsed data given web xml byte stream closed end parse operation param source input source containing xml data parsed param dest object common elements web xml web fragment xml param fragment specifies whether source web fragment xml web xml input stream source get byte stream null try close catch throwable exception utils handle throwable null try close catch ioexception ioe ignore stream null try stream close catch throwable exception utils handle throwable part represents uploaded file gets file name submitted upload returns code null file name available part file upload return submitted file name code null public string get submitted file name
part get filename null calls link get submitted file name deprecated use link get submitted file name from servlet instead deprecated public string get filename return get submitted file name public string get filename filename extract filename war part get header content disposition adapted from file upload base get file name private string extract filename string cd string file name null cd null string cdl cd lower case locale english cdl starts form data cdl starts attachment parameter parser parser new parameter parser parser set lower case names true parameter parser can handle null input map string string params parser parse cd params contains key filename file name params get filename file name null file name file name trim else even value parameter present so we return empty file name rather than file name file name return file name
file date format file date format rotate log file necessary public void rotate rotatable only do logfile switch check once second max long systime system current time millis systime rotation last checked 1000 synchronized systime rotation last checked 1000 rotation last checked systime string ts date check change date ts date file date formatter format new date systime date has changed switch log files date stamp equals ts date close true date stamp ts date open rotatable only do logfile switch check once second max long systime system current time millis systime rotation last checked 1000 synchronized systime rotation last checked 1000 rotation last checked systime string ts date check change date ts date file date formatter format new date systime date has changed switch log files date stamp equals ts date close true date stamp ts date open format null format set file date format format string ciphers ssf get supported cipher suites string cipher ciphers
return context get default get cipher suites return context get default get cipher suites return context get default get protocols static server container get server container
-1
output stream write buffer array buffer limit
swallow any request body since we replacing need do before headers restored ajp connector uses content length header determine how much data needs read request body byte buffer new byte 4096 input stream request create input stream while read buffer ignore request body swallow any request body since we replacing byte buffer new byte 4096 input stream request create input stream while read buffer ignore request body
send any partial data we have do flush false closed throw new ioexception sm get string outbound closed
writer write usage used usage get init
delegate loader null skip webapp loader now delegation enabled loader loader get parent delegate delegation enabled go back add webapp paths loader get class loader loader null build class path servlet context classpath loader
else conv recycle todo servlet3 add comments obtains value specified mime header part param name header name return header value code null code header present changes session id session associated request method does create new session object only changes id current session return new session id allocated session see http session id listener since servlet public string change session id
-1
default behavior method call change session id wrapped request object override public string change session id return get http servlet request change session id licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface notified when link http session id changes receive notification events class must configured deployment descriptor web application annotated link javax servlet annotation web listener registered calling add listener method link javax servlet servlet context see http session event see http servlet request change session id since servlet notification session id has been changed param se notification event param old session id old session id public void session id changed http session event se string old session id changes session id session associated request return old session id before changed see javax servlet http http session id listener since servlet override public string change session id session session get session internal false session null throw new illegal state exception sm get string coyote request change session id manager manager get context get manager manager change session id session string new session id session get id change session id new session id return new session id override public string change session id request null throw new illegal state exception sm get string request facade null request return request change session id instanceof http session id listener listener instanceof http session id listener results instanceof http session id listener notify session listeners replication object listeners get context get application event listeners listeners null listeners length http session event event new http session event session get session object listener listeners listener instanceof http session id listener continue http session id listener id listener http session id listener listener try id listener session id changed event msg get session id catch throwable log error sm get string standard session session event object listeners context get application event listeners listeners null listeners length http session event event new http session event session get session object listener listeners listener instanceof http session id listener continue http session id listener id listener http session id listener listener try id listener session id changed event old id catch throwable log error sm get string standard session session event public string change session id return get request change session id override add bug 54552 bug servlet implement code http session id listener code code http servlet request change session id code patch provided nick williams markt add
do nothing report specified status code return custom error status codes should result blank response test public void test bug54536 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54536 new ctx add servlet mapping bug54536 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert equals error status rc string body res string assert assert null body assert assert true body body contains error message private static final class extends http servlet private static final long serial version uid 1l private static final int error status 999 private static final string error message sky falling override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp send error error status error message licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license defines interface expression language interpreter allows users provide custom el interpreter can optimise el processing application example performing code generation simple expressions returns string representing code inserted servlet generated jsp default creates call link org apache jasper runtime page context impl proprietary evaluate string class javax servlet jsp page context org apache jasper runtime protected function mapper boolean other may produce more optimised code param expression string containing zero more expressions param expected type expected type interpreted result param fnmapvar variable pointing function map param xml escape true result should do xml escaping return string representing call el interpreter public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides link instances jsp compilation search order follows ol li instance class name provided servlet context attribute li li class named servlet context parameter li li default li ol public static final string el interpreter class name class get name private static final default instance new default obtain correct el interpreter given web application public static get servlet context context throws exception result null search servlet context attribute set application cached previous call method object attribute context get attribute el interpreter class name attribute instanceof return attribute else attribute instanceof string result create instance context string attribute servlet context init parameter result null string class name context get init parameter el interpreter class name class name null result create instance context class name default result null result default instance cache result next time context set attribute el interpreter class name result return result private static create instance servlet context context string class name throws exception return context get class loader load class class name new instance private factory utility class hide default constructor public static class default implements override public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape return jsp util interpreter call tag file expression expected type fnmapvar xml escape private final el interpreter
jsp util interpreter call tag file expected type attr get el get map name false jsp util interpreter call tag file get type get text string class get el get map name false attr value jsp util interpreter call tag file attr value map name false generator servlet writer out compiler compiler el interpreter null try el interpreter factory get compiler get compilation context get servlet context catch exception err jsp error jsp error el interpreter class get message el interpreter el interpreter licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static class simple implements override public string interpreter call jsp compilation context context boolean tag file string expression class expected type string fnmapvar boolean xml escape return expression test public void test bug54239 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp context ctx tomcat add webapp null test app dir get absolute path tomcat start servlet context context ctx get servlet context interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof default context remove attribute class get name context set attribute class get name simple class get name interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple context remove attribute class get name simple simple interpreter new simple context set attribute class get name simple interpreter interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple assert assert true interpreter simple interpreter context remove attribute class get name context set init parameter class get name simple class get name interpreter factory get context assert assert null interpreter assert assert true interpreter instanceof simple context remove attribute class get name
read bytes handle option trailer headers
last timestamp used generate nonce each nonce should get unique timestamp protected long last timestamp protected final object last timestamp lock new object synchronized last timestamp lock current time last timestamp last timestamp current time else current time last timestamp test public void bug54521 throws lifecycle exception digest digest new digest digest set container new tester context digest start request request new tester request final int count 1000 set string nonces new hash set int count nonces add digest generate nonce request assert assert equals count nonces size private static class tester request extends request override public string get remote addr return 127
make sure servlet loaded right class loader class loader old thread current thread get context class loader class loader webapp class loader context get parent get loader get class loader thread current thread set context class loader webapp class loader finally thread current thread set context class loader old return single thread model
socket poller protected async timeout async timeout null public async timeout get async timeout return async timeout thread timeout thread new thread new async timeout poller stop async timeout stop private volatile boolean async timeout running true while running while paused running protected void stop async timeout running false private volatile boolean poller running true protected void stop poller running false notify destroy socket desc while running while connection count add list size get so timeout running get so timeout maintain 1000 running private volatile boolean sendfile running true sendfile running false while running maintain time 1000000l running
catch security exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch field exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch class found exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch illegal argument exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch illegal access exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch invocation target exception log warn sm get string webapp class loader check thread locals leaks fail get context name catch method exception log warn sm get string webapp class loader check thread locals leaks fail get context name
string builder buf new string builder org apache catalina tribes membership member impl private servlet context servlet context null private elcontext el context null private page context root jsp ctxt
jsp context instanceof jsp context wrapper root jsp ctxt jsp context wrapper jsp context root jsp ctxt else root jsp ctxt invoking jsp ctxt return invoking jsp ctxt get attribute name scope invoking jsp ctxt set attribute name value scope invoking jsp ctxt get attribute name request scope invoking jsp ctxt get attribute name session scope invoking jsp ctxt get attribute name application scope invoking jsp ctxt remove attribute name request scope invoking jsp ctxt remove attribute name session scope invoking jsp ctxt remove attribute name application scope invoking jsp ctxt remove attribute name scope return invoking jsp ctxt get attributes scope name return invoking jsp ctxt get attribute names scope scope return invoking jsp ctxt get out return invoking jsp ctxt get session return invoking jsp ctxt get response return invoking jsp ctxt get servlet context return invoking jsp ctxt get elcontext
param destination member destination length param destination member destination length
integer value details get java line number
username username sm get string data source realm get roles exception username username
injections get method get name break public void test bug54448 throws exception assert page contains test test servlet env entry private int env entry resp get writer print env entry env entry env entry env entry name env entry2 env entry name env entry type java lang integer env entry type env entry value env entry value injection target injection target class org apache catalina startup tester servlet annotations injection target class injection target name env entry2 injection target name injection target env entry env entry env entry name env entry3 env entry name env entry type java lang integer env entry type env entry value 33 env entry value injection target injection target class org apache catalina startup tester servlet annotations injection target class injection target name env entry3 injection target name injection target env entry
target type convert primitive type target type private class convert primitive type class clazz clazz equals char class return character class else clazz equals int class return integer class else clazz equals boolean class return boolean class else clazz equals double class return double class else clazz equals byte class return byte class else clazz equals short class return short class else clazz equals long class return long class else clazz equals float class return float class else return clazz string default type field get type get canonical name string default type method get parameter types get canonical name string default name string default type private static string get type resource annotation string default type string type annotation type get canonical name type null type equals java lang object return type converts primitive type its wrapper param clazz class evaluated return parameter primitive type returns its wrapper otherwise returns same class public static class convert primitive type class clazz clazz equals char class return character class else clazz equals int class return integer class else clazz equals boolean class return boolean class else clazz equals double class return double class else clazz equals byte class return byte class else clazz equals short class return short class else clazz equals long class return long class else clazz equals float class return float class else return clazz test public void test bug54448 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments context context tomcat add webapp null test app dir get absolute path tomcat add servlet context test servlet org apache catalina startup tester servlet annotations context add servlet mapping test servlet test servlet tomcat enable naming tomcat start assert page contains test test servlet env entry licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l resource mapped name private int env entry override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print env entry env entry
disable ssl compression public boolean get ssldisable compression return apr endpoint endpoint get ssldisable compression public void set ssldisable compression boolean disable apr endpoint endpoint set ssldisable compression disable don use compression even supported public static final int ssl op compression 0x00020000 return true ssl op defined currently used testing weather ssl op allow unsafe legacy supported open ssl param op ssl op test return true ssl op supported open ssl library disables compression ssl stream thwarts crime attack possibly improves performance compressing content jpeg etc protected boolean ssldisable compression false set code true code disable ssl compression thwarts crime attack public void set ssldisable compression boolean ssldisable compression ssldisable compression ssldisable compression public boolean get ssldisable compression return ssldisable compression disable compression requested ssldisable compression boolean disable compression supported false try disable compression supported ssl has op ssl ssl op compression disable compression supported sslcontext set options ssl context ssl ssl op compression catch unsatisfied link error ignore disable compression supported open ssl does support ciphers ordering log warn sm get string endpoint warn disable compression ssl version string attribute name ssldisable compression required false disables compression set code true code open ssl supports disabling comprssion default code false code which inherits default compression setting open ssl attribute
string md5a1 get digest username realm lower case locale english md5a1 md5a1 lower case locale english
constructors return null
private string enabled ciphers private string enabled protocols sslcontext ssl context get sslcontext ssl context null sslengine engine get sslcontext create sslengine get ciphers array length engine set enabled cipher suites get ciphers array return engine get enabled cipher suites else return new string determine which cipher suites protocols enable enabled ciphers ssl util get enableable ciphers ssl context enabled protocols ssl util get enableable protocols ssl context get ciphers array length engine set enabled cipher suites get ciphers array get ssl enabled protocols array length engine set enabled protocols get ssl enabled protocols array determines ssl cipher suites enabled param requested ciphers comma separated list requested ciphers param supported ciphers array supported ciphers return array ssl cipher suites enabled null none requested ciphers supported protected string get enabled ciphers string requested ciphers string supported ciphers string result null allow all supported ciphers equals requested ciphers return supported ciphers requested ciphers null vector string vec null string cipher requested ciphers int index requested ciphers index index int from index while index cipher requested ciphers substring from index index trim cipher length check see requested cipher among supported ciphers may enabled int supported ciphers null supported ciphers length supported ciphers equals cipher vec null vec new vector vec add element cipher break from index index index requested ciphers index from index while cipher requested ciphers substring from index cipher null cipher cipher trim cipher length check see requested cipher among supported ciphers may enabled int supported ciphers null supported ciphers length supported ciphers equals cipher vec null vec new vector vec add element cipher break requested ciphers empty return context get default get cipher suites list string ciphers new array list string requested ciphers ciphers retain all arrays list context get supported get cipher suites vec null result new string vec size vec copy result else result ssl proxy get default cipher suites return result string requested ciphers endpoint get ciphers enabled ciphers get enabled ciphers requested ciphers ssl proxy get supported cipher suites set ssl protocol variants enabled param socket sslserver socket param protocols protocols use protected void set enabled protocols sslserver socket socket string protocols protocols null socket set enabled protocols protocols determines ssl protocol variants enabled param socket socket get supported list from param requested protocols array requested protocol names all which must non null non zero length return array ssl protocol variants enabled null none requested protocol variants supported protected string get enabled protocols sslserver socket socket string requested protocols string supported protocols socket get supported protocols string enabled protocols null requested protocols null requested protocols length vector string vec null string protocol requested protocols check see requested protocol among supported protocols may enabled int supported protocols null supported protocols length supported protocols equals protocol vec null vec new vector vec add element protocol break vec null enabled protocols new string vec size vec copy enabled protocols return enabled protocols enabled ciphers null socket set enabled cipher suites enabled ciphers string requested protocols endpoint get ssl enabled protocols array set enabled protocols socket get enabled protocols socket requested protocols comma separated list encryption ciphers socket allowed use default default ciphers jvm used note usually means weak export grade ciphers included list available ciphers ciphers specified using jsse cipher naming convention special value code all code enable all supported ciphers include many secure code all code intended testing purposes only connections specified only protocols listed supported specified jvm default used permitted values may obtained from jvm allowed values
servlet mappings put url pattern servlet name test expected illegal argument exception class public void test bug54387a multiple servlets may mapped same url pattern web xml webxml new web xml webxml add servlet mapping foo webxml add servlet mapping foo test expected illegal argument exception class public void test bug54387b multiple servlets may mapped same url pattern web xml webxml new web xml web xml f1 new web xml web xml f2 new web xml hash set web xml fragments new hash set fragments add f1 fragments add f2 f1 add servlet mapping foo f2 add servlet mapping foo webxml merge fragments test public void test bug54387c multiple servlets may mapped same url pattern main web xml takes priority web xml webxml new web xml web xml f1 new web xml web xml f2 new web xml hash set web xml fragments new hash set fragments add f1 fragments add f2 f1 add servlet mapping foo f2 add servlet mapping foo webxml add servlet mapping foo main webxml merge fragments
add post construct method definition given class existing definition specified class illegal argument exception thrown param clazz fully qualified class name param method post construct method name throws illegal argument exception fully qualified class name method name code null code already post construct method definition given class public void add post construct method string clazz string method add pre destroy method definition given class existing definition specified class illegal argument exception thrown param clazz fully qualified class name param method post construct method name throws illegal argument exception fully qualified class name method name code null code already pre destroy method definition given class public void add pre destroy method string clazz string method removes post construct method definition given class exists otherwise action taken param clazz fully qualified class name public void remove post construct method string clazz removes pre destroy method definition given class exists otherwise action taken param clazz fully qualified class name public void remove pre destroy method string clazz returns method name specified post construct method given class exists otherwise code null code returned param clazz fully qualified class name return method name specified post construct method given class exists otherwise code null code returned public string find post construct method string clazz returns method name specified pre destroy method given class exists otherwise code null code returned param clazz fully qualified class name return method name specified pre destroy method given class exists otherwise code null code returned public string find pre destroy method string clazz returns map keys fully qualified class names classes have post construct methods values method names classes empty map returned return map keys fully qualified class names classes have post construct methods values method names public map string string find post construct methods returns map keys fully qualified class names classes have pre destroy methods values method names classes empty map returned return map keys fully qualified class names classes have pre destroy methods values method names public map string string find pre destroy methods private final map string string post construct methods private final map string string pre destroy methods post construct methods catalina context find post construct methods pre destroy methods catalina context find pre destroy methods string post construct from xml post construct methods get clazz get name string pre destroy from xml pre destroy methods get clazz get name method annotation present post construct class post construct null method get parameter types length modifier static method get modifiers method get exception types length method get return type get name equals void throw new illegal argument exception invalid post construct annotation post construct method method annotation present pre destroy class pre destroy null method get parameter types length modifier static method get modifiers method get exception types length method get return type get name equals void throw new illegal argument exception invalid pre destroy annotation pre destroy method else post construct from xml null throw new illegal argument exception post construct method post construct from xml class clazz get name declared deployment descriptor cannot found else pre destroy from xml null throw new illegal argument exception pre destroy method pre destroy from xml class clazz get name declared deployment descriptor cannot found private static method find post construct method current post construct string post construct from xml method method return find lifecycle callback current post construct post construct from xml method post construct class private static method find pre destroy method current pre destroy string pre destroy from xml method method return find lifecycle callback current pre destroy pre destroy from xml method pre destroy class private static method find lifecycle callback method current method string method name from xml method method class extends annotation annotation method result current method method name from xml null method get name equals method name from xml valid lifecycle callback method throw new illegal argument exception invalid annotation get name annotation result method else method annotation present annotation current method null valid lifecycle callback method throw new illegal argument exception invalid annotation get name annotation result method return result private map string string post construct methods new hash map private map string string pre destroy methods new hash map override public void add post construct method string clazz string method clazz null method null throw new illegal argument exception sm get string standard context required post construct methods get clazz null throw new illegal argument exception sm get string standard context duplicate clazz post construct methods put clazz method fire container event add post construct method clazz override public void remove post construct method string clazz post construct methods remove clazz fire container event remove post construct method clazz override public void add pre destroy method string clazz string method clazz null method null throw new illegal argument exception sm get string standard context predestroy required pre destroy methods get clazz null throw new illegal argument exception sm get string standard context predestroy duplicate clazz pre destroy methods put clazz method fire container event add pre destroy method clazz override public void remove pre destroy method string clazz pre destroy methods remove clazz fire container event remove pre destroy method clazz override public string find post construct method string clazz return post construct methods get clazz override public string find pre destroy method string clazz return pre destroy methods get clazz override public map string string find post construct methods return post construct methods override public map string string find pre destroy methods return pre destroy methods post construct elements private map string string post construct methods new hash map public void add post construct methods string clazz string method post construct methods contains key clazz post construct methods put clazz method public map string string get post construct methods return post construct methods pre destroy elements private map string string pre destroy methods new hash map public void add pre destroy methods string clazz string method pre destroy methods contains key clazz pre destroy methods put clazz method public map string string get pre destroy methods return pre destroy methods post construct methods empty entry string string entry post construct methods entry set sb append post construct append element sb indent4 lifecycle callback class entry get key append element sb indent4 lifecycle callback method entry get value sb append post construct sb append pre destroy methods empty entry string string entry pre destroy methods entry set sb append pre destroy append element sb indent4 lifecycle callback class entry get key append element sb indent4 lifecycle callback method entry get value sb append pre destroy sb append entry string string entry post construct methods entry set context add post construct method entry get key entry get value entry string string entry pre destroy methods entry set context add pre destroy method entry get key entry get value post construct methods empty web xml fragment fragments merge lifecycle callback fragment get post construct methods temp get post construct methods fragment post construct methods return false post construct methods put all temp get post construct methods pre destroy methods empty web xml fragment fragments merge lifecycle callback fragment get pre destroy methods temp get pre destroy methods fragment pre destroy methods return false pre destroy methods put all temp get pre destroy methods private static boolean merge lifecycle callback map string string fragment map map string string temp map web xml fragment string map name entry string string entry fragment map entry set final string key entry get key final string value entry get value temp map contains key key value null value equals temp map get key log error sm get string web xml merge conflict string map name key fragment get name fragment get url return false else temp map put key value return true override public void add post construct method string clazz string method op override public void add pre destroy method string clazz string method op override public void remove post construct method string clazz op override public void remove pre destroy method string clazz op override public string find post construct method string clazz return null override public string find pre destroy method string clazz return null override public map string string find post construct methods return null override public map string string find pre destroy methods return null digester add rule full prefix post construct new lifecycle callback rule add post construct methods true digester add call param full prefix post construct lifecycle callback class digester add call param full prefix post construct lifecycle callback method digester add rule full prefix pre destroy new lifecycle callback rule add pre destroy methods false digester add call param full prefix pre destroy lifecycle callback class digester add call param full prefix pre destroy lifecycle callback method rule fails more than one post construct pre destroy methods configured per class private final boolean post construct public lifecycle callback rule string method name int param count boolean post construct super method name param count post construct post construct override public void end string namespace string name throws exception object params object digester peek params params null params length web xml web xml web xml digester peek post construct web xml get post construct methods contains key params throw new illegal argument exception web rule set sm get string web rule set duplicate params else web xml get pre destroy methods contains key params throw new illegal argument exception web rule set sm get string web rule set predestroy duplicate params super end namespace name determines method valid lifecycle callback method param method method test return code true code method valid lifecycle callback method else code false code public static boolean valid lifecycle callback method method method get parameter types length modifier static method get modifiers method get exception types length method get return type get name equals void return false return true test expected illegal argument exception class public void test add post construct method null class name new standard context add post construct method null test expected illegal argument exception class public void test add post construct method null method name new standard context add post construct method null test expected illegal argument exception class public void test add post construct method conflicts standard context standard context new standard context standard context add post construct method standard context add post construct method test expected illegal argument exception class public void test add pre destroy method null class name new standard context add pre destroy method null test expected illegal argument exception class public void test add pre destroy method null method name new standard context add pre destroy method null test expected illegal argument exception class public void test add pre destroy method conflicts standard context standard context new standard context standard context add pre destroy method standard context add pre destroy method override public void add post construct method string clazz string method op override public void add pre destroy method string clazz string method op override public void remove post construct method string clazz op override public void remove pre destroy method string clazz op override public string find post construct method string clazz return null override public string find pre destroy method string clazz return null override public map string string find post construct methods return null override public map string string find pre destroy methods return null assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get major version assert equals 500 webxml get minor version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get version assert equals webxml get major version assert equals webxml get minor version assert equals webxml get version test public void test bug54379 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments context context tomcat add webapp null test app dir get absolute path tomcat add servlet context test servlet org apache catalina startup tester servlet life cycle methods context add servlet mapping test servlet test servlet tomcat enable naming tomcat start assert page contains test test servlet post construct1 test public void test lifecycle methods definitions throws exception post construct pre destroy parse new web xml web xml false true conflicting post construct definitions parse new web xml web xml false false licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l private string result override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print result post construct protected void post construct result post construct pre destroy protected void pre destroy result pre destroy protected void post construct1 result post construct1 protected void pre destroy1 result pre destroy1 licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete true post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct lifecycle callback method post construct pre destroy lifecycle callback class test test servlet lifecycle callback class lifecycle callback method pre destroy lifecycle callback method pre destroy licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete true post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct1 lifecycle callback method post construct post construct lifecycle callback class test test servlet lifecycle callback class lifecycle callback method post construct2 lifecycle callback method post construct post construct lifecycle callback class org apache catalina startup tester servlet life cycle methods lifecycle callback class lifecycle callback method post construct1 lifecycle callback method post construct pre destroy lifecycle callback class org apache catalina startup tester servlet life cycle methods lifecycle callback class lifecycle callback method pre destroy1 lifecycle callback method pre destroy
string command null first letter command cmd substring first letter last letter return command
op private void do pong byte buffer payload need call pong using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try pong payload finally set context class loader cl intended overridden sub classes wish notified when pong received default op param payload payload included pong protected void pong byte buffer payload op
request get remote addr request get remote host request get protocol integer value request get server port noop prevents npe during testing test public void test request attributes access log throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto filter def add init parameter remote ip header my forwarded filter def add init parameter http server port 8080 mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set header my forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify assert assert equals org apache catalina access log server port integer value 8080 actual request get attribute access log server port attribute assert assert equals org apache catalina access log remote addr 140 211 11 130 actual request get attribute access log remote addr attribute assert assert equals org apache catalina access log remote host 140 211 11 130 actual request get attribute access log remote host attribute noop prevents npe during testing test public void test request attributes access log throws exception prepare remote ip valve remote ip valve new remote ip valve remote ip valve set remote ip header forwarded remote ip valve set protocol header forwarded proto remote addr host tracker valve remote addr host tracker valve new remote addr host tracker valve remote ip valve set next remote addr host tracker valve request request new mock request request set coyote request new org apache coyote request client ip request set remote addr 192 168 10 request set remote host 192 168 10 request get coyote request get mime headers add value forwarded set string 140 211 11 130 protocol request set server port 8080 request get coyote request scheme set string http test remote ip valve invoke request null verify assert assert equals org apache catalina access log server port integer value 8080 request get attribute access log server port attribute assert assert equals org apache catalina access log remote addr 140 211 11 130 request get attribute access log remote addr attribute assert assert equals org apache catalina access log remote host 140 211 11 130 request get attribute access log remote host attribute
register wrapper wrapper obj register context context obj
private charset decoder decoder decoder reset public void reset throws ioexception destroy reader iis iis new intermediate input stream conv new read convertor iis get charset encoding public read convertor intermediate input stream charset charset super charset
filter name null filter name equals throw new illegal argument exception sm get string application context invalid filter name filter name servlet name null servlet name equals throw new illegal argument exception sm get string application context invalid servlet name servlet name private static final string manager sm string manager get manager constants package filter name null filter name equals throw new illegal argument exception sm get string filter def invalid filter name filter name private static final string manager sm string manager get manager constants package servlet name null servlet name equals throw new illegal argument exception sm get string servlet def invalid servlet name servlet name test expected illegal argument exception class public void test add filter filter name null get servlet context add filter null filter null test expected illegal argument exception class public void test add filter filter name empty string get servlet context add filter filter null test expected illegal argument exception class public void test add servlet servlet name null get servlet context add servlet null servlet null test expected illegal argument exception class public void test add servlet servlet name empty string get servlet context add servlet servlet null private servlet context get servlet context tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context standard context standard context tomcat add webapp null test app dir get absolute path return standard context get servlet context licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test case link filter def test expected illegal argument exception class public void test set filter name null new filter def set filter name null test expected illegal argument exception class public void test set filter name empty string new filter def set filter name test public void test set filter name filter def filter def new filter def filter def set filter name test assert assert equals test expected filter name test filter def get filter name licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test case link servlet def test expected illegal argument exception class public void test set servlet name null new servlet def set servlet name null test expected illegal argument exception class public void test set servlet name empty string new servlet def set servlet name test public void test set servlet name servlet def servlet def new servlet def servlet def set servlet name test assert assert equals test expected servlet name test servlet def get servlet name
public void add absolute ordering string fragment name public void add absolute ordering string fragment name create absolute ordering absolute ordering null absolute ordering new linked hash set web xml web xml web xml digester peek web xml create absolute ordering digester get logger debug enabled digester get logger debug web xml get class get name set absolute ordering byte chunk res new byte chunk int rc get url http localhost get port test res null check return code assert equals http servlet response sc ok rc check context assert equals ok custom default servlet res string byte chunk bc new byte chunk int rc get url http localhost get port test bug51396 jsp bc null assert equals http servlet response sc ok rc assert true bc string contains ok byte chunk res new byte chunk int rc get url http localhost get port test bug53574 res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok private void assert page contains string page url string expected body throws ioexception assert page contains page url expected body http servlet response sc ok private void assert page contains string page url string expected body int expected status throws ioexception byte chunk res new byte chunk int sc get url http localhost get port page url res null assert assert equals expected status sc expected status http servlet response sc ok string result res string assert assert true result result index expected body licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version metadata complete false display name tomcat test application display name description used part tomcat unit tests when full web application required description absolute ordering
suppress warnings null non match class null null always ambiguous return null short cut null always assignable object el null can always coerced valid value primitive src null return true sb append types get name append
element get valid
primarily used error reporting string jar name null jar get name lower case locale english ends jar manifest resource mre new manifest resource jar get name jmanifest manifest resource application catch ioexception ioe throw new ioexception jar jar name ioe
else when running service call stop new thread so make sure correct class loader used prevent range class found exceptions thread current thread set context class loader daemon catalina loader
write string method cannot inherited from writer class because must suppress exceptions override public void write string throws ioexception simple fix bugzilla 35410 calling other write function so init buffer anyways null write else write length
oname create object name name oname null register jmx
proxies get interceptor class new instance pool closed
status code 400 response get content written test public void test bug54220do set found throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54220 new false ctx add servlet mapping bug54220 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert null res string assert assert equals http servlet response sc ok rc test public void test bug54220set found throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug54220 new true ctx add servlet mapping bug54220 tomcat start byte chunk res new byte chunk int rc get url http localhost get port res null assert assert null res string assert assert equals http servlet response sc found rc private static final class extends http servlet private static final long serial version uid 1l private boolean set found private boolean set found set found set found override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception set found resp set status http servlet response sc found
protected class pool cleaner extends timer task protected connection pool pool protected volatile boolean run true pool pool pool closed pool get size run false else system current time millis last run sleep time catch end run java naming factory url pkgs org apache catalina util naming property sends error response client using specified status server defaults creating response look like html formatted server error page containing specified message setting content type text html leaving cookies other headers unmodified error page declaration has been made web application status code passed served back preference suggested msg parameter clearing buffer response has already been committed method throws illegal state exception after using method response should considered committed should written
-1
-1
suppress warnings null escaped buffer cannot null string result escape xml buffer char array buffer length result null return buffer else return result suppress warnings null escaped buffer cannot null public static string escape xml char array buffer int length int length buffer length char array buffer buffer char array return buffer string str object name ctxt get temporary variable name ctxt generate java source string str val name null ctxt generate java source ctxt generate java source null ctxt generate java source str val name ctxt generate attribute value ctxt generate java source string ctxt generate java source string str def name null str val name str def name str escape xml name public static boolean output jsp writer out string value string default value boolean escape xml throws ioexception string value null value default value null escape xml org apache jasper tagplugins jstl util escape xml out write return false page encoding iso 8859 session false out value session does exist ok out out value session does exist ok out
sorted map string memory pool mxbean memory pool mbeans new tree map memory pool mxbean mbean management factory get memory pool mxbeans string sort key mbean get type mbean get name memory pool mbeans put sort key mbean writer write table border thead tr th memory pool th th type th th initial th th total th th maximum th th used th tr thead tbody memory pool mxbean memory pool mbean memory pool mbeans values memory usage usage memory pool mbean get usage writer write tr td writer print memory pool mbean get name writer write td td writer print memory pool mbean get type writer write td td writer print format size long value usage get init true writer write td td writer print format size long value usage get committed true writer write td td writer print format size long value usage get max true writer write td td writer print format size long value usage get used true usage get max writer write usage get used 100 usage get max writer write td tr writer write tbody table memory pool mxbean memory pool mbean memory pool mbeans values memory usage usage memory pool mbean get usage writer write memorypool writer write name memory pool mbean get name writer write type memory pool mbean get type writer write usage init usage get init writer write usage committed usage get committed writer write usage max usage get max writer write usage used usage get init memory pools br xsl apply templates select memorypool hr xsl template match memorypool table tr td name xsl value select name td td type xsl value select type td td initial xsl value select usage init td td committed xsl value select usage committed td td maximum xsl value select usage max td td used xsl value select usage used td tr table xsl template private static final int max nested realm levels integer get integer org apache catalina startup realm rule set max nested realm levels int value
digester add object create prefix realm null must specified element class name digester add set properties prefix realm digester add set next prefix realm set realm org apache catalina realm digester add object create prefix realm realm null must specified element class name digester add set properties prefix realm realm digester add set next prefix realm realm add realm org apache catalina realm property name org apache catalina startup realm rule set max nested realm levels combined realm allows nested realms property controls maximum permitted number levels nesting specified default value code code used property
long modified since req get date header header ifmodsince
expect server reply 100 continue interim response public list string get response body uri elements return body uri elments send component parts request tolerant simply skip null entries send request first first false else thread sleep request pause writer write request part writer flush
request set attribute async request uri request get request uri request get query string request set attribute async path info request get path info
listeners container calls complete complete srv search error dispatch servlet response instanceof http servlet response http servlet response servlet response set status http servlet response sc internal server error host host host context get parent valve std host valve host get pipeline get basic std host valve instanceof standard host valve standard host valve std host valve throwable request request get response started request async dispatching complete async error page may dispatch another resource flag helps ensure infinite error handling loop entered boolean error start response error request set attribute request dispatcher error exception throwable request response request async async start request get attribute request dispatcher error exception null protect against npes context destroyed during long running request error page processing response set suspended false throwable throwable request get attribute request dispatcher error exception null throwable request response else status request response private void throwable request request response response state async state timing out alv validate access log 200 do test timeout true null do test timeout false null do test timeout true nonasync do test timeout false nonasync test public void test timeout listener throws exception should work do test timeout null null private void do test timeout boolean complete timeout string dispatch url new timeout servlet complete timeout dispatch url expected append timeout servlet get timeout complete timeout expected append timeout complete timeout dispatch url null private final boolean complete timeout public timeout servlet boolean complete timeout string dispatch url ac add listener new tracking listener false complete timeout dispatch url timeout servlet timeout new timeout servlet true null test public void test timeout error dispatch none throws exception do test timeout error dispatch null null test public void test timeout error dispatch non async throws exception do test timeout error dispatch boolean false null test public void test timeout error dispatch async start throws exception do test timeout error dispatch boolean true error page async mode complete test public void test timeout error dispatch async complete throws exception do test timeout error dispatch boolean true error page async mode complete test public void test timeout error dispatch async dispatch throws exception do test timeout error dispatch boolean true error page async mode dispatch private void do test timeout error dispatch boolean async error error page async mode mode throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path timeout servlet timeout new timeout servlet null null wrapper w1 tomcat add servlet ctx time timeout w1 set async supported true ctx add servlet mapping async time non async servlet non async new non async servlet wrapper w2 tomcat add servlet ctx non async non async w2 set async supported true ctx add servlet mapping error nonasync non async async error page async error page new async error page mode wrapper w3 tomcat add servlet ctx async error page async error page w3 set async supported true ctx add servlet mapping error async async error page async error null error page ep new error page ep set error code 500 async error boolean value ep set location error async else ep set location error nonasync ctx add error page ep ctx add application listener tracking request listener class get name tester access log valve alv new tester access log valve ctx get pipeline add valve alv tester access log valve alv global new tester access log valve tomcat get host get pipeline add valve alv global tomcat start byte chunk res new byte chunk try get url http localhost get port async res null catch ioexception ioe ignore expected some error conditions string builder expected new string builder async error null error handler just get 500 response expected append request initialized timeout servlet get note error handler response reset lost async error null async error boolean value expected append async error page get mode error page async mode complete expected append op else mode error page async mode complete expected append complete else mode error page async mode dispatch expected append dispatch non async servlet get else expected append non async servlet get expected append request destroyed assert assert equals expected string res string check access log alv global validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time alv validate access log 500 timeout servlet async timeout timeout servlet async timeout timeout margin request time private static enum error page async mode complete complete dispatch private static class async error page extends http servlet private static final long serial version uid 1l private final error page async mode mode public async error page error page async mode mode mode mode override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception print writer writer resp get writer writer write async error page get resp flush buffer final async context ctxt req get async context switch mode case complete writer write complete ctxt complete break case dispatch writer write dispatch ctxt dispatch error nonasync break case complete writer write op break default impossible break
send control message data constants opcode pong send ping message client param data optional message throws ioexception error occurs writing client public synchronized void ping byte buffer data throws ioexception send control message data constants opcode ping generic function send either ping pong param data optional message param opcode byte include opcode throws ioexception error occurs writing client private synchronized void send control message byte buffer data byte opcode throws ioexception upgrade outbound write 0x8a
logger error sm get string naming invalid env entry type env get name private static final string jndi name test name private static final string jndi value test value environment set type jndi value get class get name environment set name jndi name environment set value jndi value string value string env ctx lookup jndi name jndi value equals value test public void test bug54096 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir enable jndi disabled default tomcat enable naming context environment environment new context environment environment set type bug54096env class get name environment set name bug54096 name environment set value bug54096 value ctx get naming resources add environment environment context environment environment new context environment environment set type bug54096env class get name environment set name bug54096 name environment set value bug54096 value ctx get naming resources add environment environment ctx add application listener class get name tomcat start assert equals lifecycle state started ctx get state public static class bug54096env private final string value public bug54096env string value value value public string get value return value public static class bug54096env private final char value public bug54096env char value value value public char get value return value public static final class implements servlet context listener override public void context destroyed servlet context event sce noop override public void context initialized servlet context event sce javax naming context init ctx try init ctx new initial context javax naming context env ctx javax naming context init ctx lookup java comp env validate entry bug54096env value bug54096env env ctx lookup bug54096 name bug54096 value equals value get value throw new runtime exception validate entry bug54096env value bug54096env env ctx lookup bug54096 name bug54096 value char value get value throw new runtime exception catch naming exception throw new runtime exception
private pattern keep alive user agents null public string get keep alive user agents pattern keep alive user agents null return null else return pattern public void set keep alive user agents string keep alive user agents keep alive user agents null keep alive user agents length keep alive user agents null else keep alive user agents pattern compile keep alive user agents pattern keep alive user agents null message bytes ua request get coyote request get mime headers get value user agent ua null matcher ua string matches response set header connection close attribute name always use session required false should session always used once user may offer some performance benefits since session can used cache principal hence removing need authenticate user every request also help clients assume server cache user however also performance cost creating gc ing session alternative solution see code keep alive user agents code set default value code false code used attribute attribute name keep alive user agents required false some clients most browsers expect server cache user information connection do resend credentials every request tomcat do unless http session available session availble either application creates one code always use session code enabled alternative creating session attribute may used define user agents which http keep alive disabled means connection only used single request hence ability cache user information per connection performance cost disabling http keep alive attribute should regular expression matches entire user agent string code chrome code specified regular expression defined user agents have http keep alive disabled attribute
list string order new linked list start adding all fragments order doesn matter order add all fragments key set now go through move elements start end depending specify others web xml fragment fragments values string name fragment get name fragment get before ordering contains web xml order others move beginning order remove name order add name else fragment get after ordering contains web xml order others move end order remove name order add name now apply remaining ordering string name fragment get name before equals web xml order others order contains before order index before order index name order remove name order add order index before name after equals web xml order others order contains after order index after order index name order remove name order add order index after name finally check ordering applied correctly errors indicates circular references string name fragment get name string before fragment get before ordering before equals web xml order others order contains before order index before order index name throw new illegal argument exception sm get string web xml merge conflict order string after fragment get after ordering after equals web xml order others order contains after order index after order index name throw new illegal argument exception sm get string web xml merge conflict order build ordered list string name order ordered fragments add fragments get name stage decouple groups so ordering requirements each fragment group only refer other fragments group ordering requirements outside group handled processing groups order note only after ordering requirements considered ok because processing stage decouple other groups before set decouple other groups others set decouple other groups after set stage order each group note only after ordering requirements considered ok because processing stage order fragments ordered fragments before set order fragments ordered fragments others set order fragments ordered fragments after set public void set up throws exception fragments new hash map private void do relative ordering test relative ordering test runner runner confirm we have all 720 possible input orders set string orders new hash set test all possible input orders since some bugs were discovered depended input order int int int int int set up runner init array list web xml source new array list source add all fragments values map string web xml input new linked hash map web xml one source remove input put one get name one web xml two source remove input put two get name two web xml three source remove input put three get name three web xml four source remove input put four get name four web xml five source remove input put five get name five web xml six source remove input put six get name six string order one get name two get name three get name four get name five get name six get name orders add order set web xml ordered web xml order web fragments app input populate positions ordered runner validate get order ordered system out println orders size private string get order set web xml ordered string builder sb new string builder ordered size web xml web xml ordered sb append web xml get name return sb string private void populate positions set web xml ordered list web xml indexed new array list indexed add all ordered pos indexed index pos indexed index pos indexed index pos indexed index pos indexed index pos indexed index add after ordering others add after ordering add before ordering others add after ordering others add before ordering others add before ordering set web xml ordered web xml order web fragments app fragments iterator web xml iter ordered iterator assert equals iter next assert equals iter next assert equals iter next assert equals iter next assert equals iter next assert equals iter next add after ordering others add before ordering add before ordering others add after ordering others add before ordering others set web xml ordered web xml order web fragments app fragments iterator web xml iter ordered iterator number orders possible algorithm order valid fails after change algorithm check see new order also valid assert equals iter next assert equals iter next assert equals iter next assert equals iter next assert equals iter next assert equals iter next public void test order web fragments relative3 third example from spec add after ordering add before ordering others fragments remove fragments remove set web xml ordered web xml order web fragments app fragments iterator web xml iter ordered iterator number orders possible algorithm order valid fails after change algorithm check see new order also valid assert equals iter next assert equals iter next assert equals iter next assert equals iter next public void test order web circular exception exception null try web xml order web fragments app fragments catch exception e1 exception e1 assert true exception instanceof illegal argument exception
status code 204 status code 205 status code 304
private static string xml escape string null string builder sb new string builder int length sb append lt else sb append gt else sb append 039 apos else sb append amp else sb append 034 quot else sb append return sb string private static final hashtable string string shell env new hashtable
-1
status socket status disconnect do nothing here just wait get recycled else processor async state socket state async end
return new string quoted
err dispatcher ctxt get jsp file page info bean repository bean repository string jsp file override public boolean tag file return page info tag file tag being used inside tag file boolean tag file string jsp ctxt null ctxt tag file jsp ctxt get jsp context else jsp ctxt jspx page context ctxt generate java source page context set attribute str var result name scope ctxt generate java source page context remove attribute str var scope ctxt generate java source page context remove attribute str var
member instanceof static member add suspects put member long value system current time millis members instanceof static member add suspects put members long value system current time millis add suspects contains key members membership get member members null avoid temporary adding member continue
request scheme set string https request scheme set string https request scheme set string https
request null request get session false null buf append request get session internal false get id internal else else buf append session get id internal else buf append
set current restart
public naming enumeration name class pair list name name public abstract naming enumeration name class pair list string name throws naming exception enumerates names bound named context along class names objects bound them contents any subcontexts included binding added removed from context its effect enumeration previously returned undefined param name name context list return enumeration names class names bindings context each element enumeration type name class pair exception naming exception naming exception encountered override public naming enumeration name class pair list string name throws naming exception file file file name file null throw new name found exception sm get string resources found name return new naming context enumeration list file iterator enumerates names bound named context along class names objects bound them contents any subcontexts included binding added removed from context its effect enumeration previously returned undefined param name name context list return enumeration names class names bindings context each element enumeration type name class pair exception naming exception naming exception encountered override public naming enumeration name class pair list string name throws naming exception return list get escaped jndi name name enumerates names bound named context along class names objects bound them contents any subcontexts included binding added removed from context its effect enumeration previously returned undefined param name name context list return enumeration names class names bindings context each element enumeration type name class pair exception naming exception naming exception encountered override public naming enumeration name class pair list name name throws naming exception name empty return new naming context enumeration list entries iterator entry entry tree lookup name entry null throw new name found exception sm get string resources found name return new naming context enumeration list entry iterator
servlet set overridable true servlet set overridable true returns true host configured undeploy old versions applications deployed using parallel deployment only takes effect link get auto deploy also returns true public boolean get undeploy old versions set true host should undeploy old versions applications deployed using parallel deployment only takes effect link get auto deploy returns true public void set undeploy old versions boolean undeploy old versions
private boolean undeploy old versions false public boolean get undeploy old versions return undeploy old versions override public void set undeploy old versions boolean undeploy old versions undeploy old versions undeploy old versions override attribute name undeploy old versions description determines old versions applications deployed using parallel deployment undeployed when longer used requires auto deploy enabled type boolean log info enabled log info sm get string host config undeploy app name container context host find child app name try host remove child context catch throwable exception utils handle throwable log warn sm get string host config context remove app name delete other redeploy resources int resources length try file current new file resources current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name deployed remove app name log info enabled log info sm get string host config undeploy app name container context host find child app name try host remove child context catch throwable exception utils handle throwable log warn sm get string host config context remove app name delete all redeploy resources int resources length try file current new file resources current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name delete reload resources well remove any remaining xml descriptor string resources2 app reload resources key set array new string int resources2 length try file current new file resources2 current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path current get absolute path ends xml log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name deployed remove app name private void delete redeploy resources deployed application app string resources int boolean delete reload resources delete redeploy resources log info enabled log info sm get string host config undeploy app name container context host find child app name try host remove child context catch throwable exception utils handle throwable log warn sm get string host config context remove app name delete other redeploy resources int resources length try file current new file resources current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name delete reload resources remove any remaining xml descriptor delete reload resources string resources2 app reload resources key set array new string int resources2 length try file current new file resources2 current current get canonical file never delete per host context xml defaults constants host context xml equals current get name continue only delete resources app base host config base current get absolute path starts host get app base file get absolute path file separator current get absolute path starts host get config base file get absolute path current get absolute path ends xml log debug enabled log debug delete current expand war delete current catch ioexception log warn sm get string host config app name deployed remove app name check old versions applications can now undeployed host get undeploy old versions check undeploy check old versions applications using parallel deployment now unused have active sessions undeploy any found public void check undeploy need ordered set names sorted set string sorted app names new tree set sorted app names add all deployed key set sorted app names size return iterator string iter sorted app names iterator context name previous new context name iter next do context name current new context name iter next current get path equals previous get path current previous same version current always later version context context context host find child previous get name context null manager manager context get manager manager null manager get active sessions log info enabled log info sm get string host config undeploy version previous get name deployed application app deployed get previous get name string resources app redeploy resources key set array new string version unused undeploy completely trick ensure all redeploy resources removed delete redeploy resources app resources true previous current while iter has next operation name check undeploy description undeploy any old versions applications deployed using parallel deployment have active sessions impact action return type void operation href host html host may configured via code undeploy old versions code remove old versions deployed way once longer use attribute name undeploy old versions required false flag determines tomcat part auto deployment process check old unused versions web applications deployed using parallel deployment any found remove them flag only applies code auto deploy code true specified default value false used attribute
faster approach than calling link mark link next char however approach only safe mark only used within jsp reader private int next char mark mark throws jasper exception has more input return int ch current stream current cursor mark init current single file current cursor ch current line current col else current col return ch search given character found mark current cursor cursor point next character private boolean index char mark mark throws jasper exception has more input return null int end current stream length int ch int line current line int col current col int current cursor end ch current stream ch mark update line col ch line col else col ch current update line col return boolean true current update line col return boolean false while stop equals mark reset oldstart method avoids call link mark when doing comparison private boolean mark equals mark another return another equals current similar link reset mark new mark created therefore parameter mark must used other places private void set current mark mark current mark mark mark mark int ch int do ch next char char ch string char reset mark return false while string length return true reset mark reset mark reset mark mark ret null int ch ret mark ch next char ch ret mark ch next char ch limit char mark restart mark int limlen peek char limit char next char else reset restart continue skip return ret mark ret null char first char limit char ret mark ch next char ch ret mark prev ch ch next char else ch limit char prev reset mark reset mark reader other reader ctxt other reader get jsp compilation context stream other stream file id other file id file name other file name base dir other base dir encoding other encoding clone include stack without cloning contents include stack new stack int other include stack size include stack add element other include stack element
do close constants opcode close
found true found false found true results null
temp context set doc base file get path
args href url encoder encode display path
hex utils get dec buf pos result hex utils get dec buf pos 10 11 12 13 14 15 return dec index
jar entry exists meta inf resources context add resource jar url url
context add filter map before filter map else else context add filter map before filter map context add filter map before filter map else else context add filter map before filter map
while len public static final string default jars skip tomcat util scan default jar scanner jars skip public static final string pluggability jars skip org apache catalina startup context config jars skip public static final string tld jars skip org apache catalina startup tld config jars skip list jars skipped when scanning web application jars means jar scanned web fragments scis annotations classes match handles types private static final set string pluggability jars skip new hash set load list jars skip add jars skip constants default jars skip add jars skip constants pluggability jars skip private static void add jars skip string system property name string jar list system get property system property name jar list null string tokenizer tokenizer new string tokenizer jar list while tokenizer has more elements pluggability jars skip add tokenizer next token
context get loader get class loader callback null static set default list jars skip tlds string builder jar list new string builder system get property constants default jars skip string tld jars system get property constants tld jars skip tld jars length jar list length jar list append jar list append tld jars jar list length set tld jars jar list string sets list jars known contain any tlds param jar names list comma separated names jar files known contain any tlds public static synchronized void set tld jars string jar names jar names null tld jars null else tld jars null tld jars new hash set else tld jars clear string tokenizer tokenizer new string tokenizer jar names while tokenizer has more elements tld jars add tokenizer next token sets list jars known contain any tlds param jar names list comma separated names jar files known contain any tlds public static void set tld jars string jar names jar names null tld jars null else tld jars null tld jars new hash set else tld jars clear string tokenizer tokenizer new string tokenizer jar names while tokenizer has more elements tld jars add tokenizer next token mapping global tag library uri location resource path tld associated tag library location returned string array location location jar file location tld private hashtable string tld location mappings private volatile boolean initialized private servlet context ctxt constructor param ctxt servlet context web application which jasper running public tld locations cache servlet context ctxt ctxt ctxt mappings new hashtable string tld location initialized false public static void set tld jars string jar names tld jars new hash set string mapping global tag library uri location resource path tld associated tag library location returned string array location location jar file location tld private hashtable string tld location mappings private volatile boolean initialized private servlet context ctxt constructor param ctxt servlet context web application which jasper running public tld locations cache servlet context ctxt ctxt ctxt mappings new hashtable string tld location initialized false property name tomcat util scan default jar scanner jars skip comma separated list filenames jars tomcat scan information when using href jar scanner html jar scanner note additional system properties enable jars excluded from specific scans rather than all scans coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property property name org apache catalina startup context config jars skip comma separated list additional filenames jars tomcat scan servlet pluggability features coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property property name org apache catalina startup tld config jars skip comma separated list additional filenames jars tomcat scan tlds coded default jars skipped however system property set default tomcat installation via code catalina base catalina properties code file property
comet false comet false
collection string result new hash set jsp property group get url pattern null result add jsp property group get url pattern return result private string url pattern null public void set url pattern string url pattern url pattern url pattern public string get url pattern return url pattern append element sb indent6 url pattern jpg get url pattern context add servlet mapping jsp property group get url pattern jsp servlet name true log debug enabled log debug skiping jsp property group get url pattern servlet jsp servlet name set url pattern
key starts jar
state state new state request response true string context path context get path request uri null wrequest set attribute request dispatcher include request uri request uri context path null wrequest set attribute request dispatcher include context path context path servlet path null wrequest set attribute request dispatcher include servlet path servlet path path info null wrequest set attribute request dispatcher include path info path info wrequest set attribute request dispatcher include query string query string wrequest set context path context path
return return see code java lang exception exception string throwable code see code java lang exception exception throwable code throws org apache catalina util rejected execution exception task deprecated use link set context method removed param container newly associated context see channel send member serializable int error handler see channel send member serializable int error handler exception javax naming invalid attributes exception object did exception javax naming invalid attributes exception object did exception javax naming invalid attributes exception object did exception javax naming invalid attributes exception object did exception javax naming invalid attributes exception creation exception javax naming invalid attributes exception creation parse request javax servlet http http servlet request you may param response associated response param response param original output
int total total written system out println successful write written total
convert jsps web xml test public void test bug53574 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53574 res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body servlet servlet name bug53574 servlet name jsp file web inf jsp bug53574 jsp jsp file servlet servlet mapping servlet name bug53574 servlet name url pattern bug53574 url pattern servlet mapping
base out clear licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void test do forward throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53545 jsp res null assert assert equals http servlet response sc ok rc string body res string assert assert true body contains ok assert assert false body contains fail licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns j2ee http java sun com xml ns j2ee web xsd version tlib version tlib version short name bug53545 short name tag name test name tag class org apache tomcat unittest tags bug53545 tag class body content scriptless body content tag body ok body licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license page encoding iso 8859 body fail bug53545 test fail bug53545 test fail jsp forward page bug53545 html fail bug53545 test fail bug53545 test fail body
override protected string do get real path string path file file file path null file return file get absolute path else return null
ssl honor cipher order set code true code enforce server cipher order instead default which allow client choose preferred cipher public boolean get sslhonor cipher order return apr endpoint endpoint get sslhonor cipher order public void set sslhonor cipher order boolean sslhonor cipher order apr endpoint endpoint set sslhonor cipher order sslhonor cipher order protected boolean sslhonor cipher order false set code true code enforce server cipher order instead default which allow client choose preferred cipher public void set sslhonor cipher order boolean sslhonor cipher order sslhonor cipher order sslhonor cipher order public boolean get sslhonor cipher order return sslhonor cipher order set cipher order client default server sslhonor cipher order boolean order ciphers supported false try order ciphers supported ssl has op ssl ssl op cipher server preference order ciphers supported sslcontext set options ssl context ssl ssl op cipher server preference catch unsatisfied link error ignore order ciphers supported open ssl does support ciphers ordering log warn sm get string endpoint warn honor cipher order ssl version string attribute name sslhonor cipher order required false set code true code enforce server cipher order from code sslcipher suite code setting instead allowing client choose cipher which default attribute
sec web socket protocol client
data set message new xbyte buffer tcp ping data false
failure detector get null failure detector get check members true static membership interceptor smi static members get static only smi null
java class java class cache entry get java class string super class name java class get superclass name string interface name java class get interface names private final java class java class java class java class public java class get java class return java class
string absolute absolute url prevent from going outside our context add query string present back test public void test bug53469a throws exception request req new tester mock request response resp new response resp set request req string result resp encode url bar html assert assert equals bar html result test public void test bug53469b throws exception request req new tester mock request response resp new response resp set request req string result resp encode url bar html assert assert equals bar html result
interrupted catch interrupted exception thread interrupted id null coord msg received get message arrived send coord msg fire interceptor event new coordination event coordination event evt elect abandoned election abandoned waiting timed out fire interceptor event new coordination event coordination event evt elect abandoned election abandoned received message end interrupted instanceof interrupted exception interrupted else error counter do run receiver log warn error receiving mcast package sleeping 500ms else log debug enabled log debug error receiving mcast package do run receiver sleeping 500ms do run receiver try thread sleep 500 catch exception ignore error counter recovery counter error counter recovery thread recover mcast service impl allow thread interrupted back out publish operation after we clear flag thread interrupted catch interrupted exception thread interrupted catch exception while ignore clean interrupt flag thread interrupted catch interrupted exception ignore thread interrupted catch interrupted exception ignore thread interrupted thread interrupted
con get pool properties get default auto commit boolean false parameter only looked link java sql connection get auto commit returns false parameter only looked link java sql connection get auto commit returns false
-1
int send options channel send options msg instanceof session message session message msg get event type session message evt all session data send options channel send options synchronized ack channel send options use ack channel send new member dest msg channel send options channel send destmembers msg channel send options
private map string string parameters boolean found false read only attributes contains key name found attributes contains key name found value attributes get name attributes remove name else parameters contains key name return false parameters put name value return true tomcat attributes contains key name return tomcat attributes get name else else return obj note extensions always matched case insensitive manner
mime mappings put extension mime type return mime mappings get extension
http status code integer error status code which error page active
uri uri new uri jndi get jndiuri host name full path null test public void test bug53467 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk int rc get url http localhost get port test bug53467 jsp res null assert assert equals http servlet response sc ok rc assert assert true res string contains ok licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body
original get key property path null
digester add rule full prefix ejb local ref mapped name new mapped name rule digester add rule full prefix ejb ref mapped name new mapped name rule digester add rule full prefix env entry mapped name new mapped name rule digester add rule full prefix resource env ref mapped name new mapped name rule digester add rule full prefix message destination mapped name new mapped name rule digester add rule full prefix message destination ref mapped name new mapped name rule digester add rule full prefix resource ref mapped name new mapped name rule digester add rule full prefix service ref mapped name new mapped name rule rule sets mapped name resource base public mapped name rule op process body text element param namespace namespace uri matching element empty string parser namespace aware element has namespace param name local name parser namespace aware just element name otherwise param text body text element override public void body string namespace string name string text throws exception resource base resource base resource base digester peek resource base set property mapped name text trim test public void test bug53465 throws exception tomcat tomcat get tomcat instance tomcat enable naming file app dir new file test webapp app dir relative server home org apache catalina context ctxt tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug53465 jsp bc null assert assert equals http servlet response sc ok rc assert assert true bc string contains 10 context environment ce ctxt get naming resources find environment bug53465 assert assert equals name ce get property mapped name env entry description resource testing bug 53465 description env entry name bug53465 env entry name env entry value 10 env entry value env entry type java lang integer env entry type mapped name name mapped name env entry
out printil else log get message ex instanceof runtime exception throw runtime exception ex public static final string pool jmx type prefix tomcat jdbc type
string domain tomcat jdbc public static object name get object name class clazz string pool name throws malformed object name exception object name oname new object name connection pool pool jmx type prefix clazz get name name pool name slow query report jmx get object name slow query report jmx class pool get name
protocol handler apr required apr lifecycle listener apr available throw new lifecycle exception sm get string coyote connector protocol handler apr get protocol handler class name constructor
type get name descriptor get name type get name descriptor get name
container event listeners container protected array list container listener listeners new array list container listener protected final read write lock listeners lock new reentrant read write lock lock write listeners lock write lock write lock try listeners add listener finally write unlock lock read listeners lock read lock read lock try container listener results new container listener listeners size return listeners array results finally read unlock lock write listeners lock write lock write lock try listeners remove listener finally write unlock note two options here take copy listeners fire events outside read lock don take copy fire events inside read lock approach has been used here since holding read lock only prevents writes preferable creating lots array objects since writes occur start stop unless external management tool used holding read lock relatively long time should issue lock read listeners lock read lock read lock try listeners size return container event event new container event type data container listener listener listeners listener container event event finally read unlock
error error
return false nc length
handles types ht sci get class get annotation handles types class
writer write request bytes recieved recieved next stage br parse prepare requst xs attribute name request bytes recieved type xs long use required
private thread group group private atomic integer thread number new atomic integer private string name prefix prop alternate username allowed
value properties get property prop value null pool properties set commit return boolean parse boolean value value properties get property prop value null pool properties set rollback return boolean parse boolean value value properties get property prop value null pool properties set use disposable connection facade boolean parse boolean value value properties get property prop value null pool properties set log validation errors boolean parse boolean value value properties get property prop value null pool properties set propagate interrupt state boolean parse boolean value
skip blanks introduced regexp split poor input kvp kvp trim kvp length continue kv length kv length kv length recursively deletes directory its contents private boolean rmdir file dir dir exists return false dir directory return false file files dir list files null files int files length files directory rmdir files return false else files delete return false return dir delete test public void test aliases throws exception some sample text string fox text quick brown fox jumps over lazy dog string lorem ipsum lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua set up temporary doc base some alternates we can set up aliases file tmp dir new file system get property java io tmpdir tomcat unit test test naming context class get name tmp dir exists remove any old test files tmp dir directory rmdir tmp dir throw new ioexception could delete old temp directory tmp dir else tmp dir delete throw new ioexception could delete old temp file tmp dir file doc base new file tmp dir doc base file alternate1 new file tmp dir alternate1 file alternate2 new file tmp dir alternate2 tmp dir mkdirs throw new ioexception could create temp directory tmp dir doc base mkdir throw new ioexception could create temp directory doc base alternate1 mkdir throw new ioexception could create temp directory alternate1 alternate2 mkdir throw new ioexception could create temp directory alternate2 create file each alternate directory we can attempt access file output stream fos new file output stream new file alternate1 test1 txt fos write fox text get bytes utf fos flush fos close fos new file output stream new file alternate2 test2 txt fos write lorem ipsum get bytes utf fos flush fos close finally create context file dir context ctx new file dir context ctx set doc base doc base get canonical path ctx set aliases a1 alternate1 get canonical path a2 alternate2 get canonical path check first alias object file ctx lookup a1 test1 txt assert assert null file assert assert true file instanceof resource byte buffer new byte 4096 resource res resource file int len res stream content read buffer string contents new string buffer len utf assert equals fox text contents check second alias file ctx lookup a2 test2 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals lorem ipsum contents test aliases spaces around separators ctx set aliases a1 alternate1 get canonical path a2 alternate2 get canonical path check first alias file ctx lookup a1 test1 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals fox text contents check second alias file ctx lookup a2 test2 txt assert assert null file assert assert true file instanceof resource res resource file len res stream content read buffer contents new string buffer len utf assert equals lorem ipsum contents clean up rmdir tmp dir throw new ioexception could clean up temp directory tmp dir whitespace permitted around both code code code code delimiters trimmed therefore aliases attribute value code alias path1 doc base1 br alias path2 doc base2 code equivalent code alias path1 doc base1 alias path2 doc base2 code
con connect driver null protected project project
catch build exception je system err println je jspc die level die level system exit jspc die level sets ant project param project project public void set project final project project project project returns project may code null code running inside ant project return project public project get project return project public void execute throws jasper exception throw new jasper exception ioe throw je
throw new illegal state exception sm get string manager base create session ise
boolean servlet names set false servlet names set servlet names length filter map set filter name filter name fragment add filter mapping filter map private final class loader application class loader public stream inbound application class loader thread current thread get context class loader
binary data ws text data private void do binary data input stream throws ioexception need call close using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try binary data finally set context class loader cl private void do text data reader throws ioexception need call close using web application class loader thread thread current thread class loader cl get context class loader set context class loader application class loader try text data finally set context class loader cl close status close constants opcode close public void upgrade complete open outbound swallow headers swallow headers test public void test bug53339 throws exception tomcat tomcat get tomcat instance tomcat enable naming must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir tomcat add servlet ctx bug53339 new ctx add servlet mapping bug53339 create resource context environment env new context environment env set name bug53339ws inbound jndi name env set type string class get name env set value bug53339ws inbound test message ctx get naming resources add environment env tomcat start web socket client client new web socket client get port send web socket handshake client writer write get http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection upgrade crlf client writer write sec web socket version 13 crlf client writer write sec web socket key todo crlf client writer write crlf client writer flush make sure we got upgrade response string response line client reader read line assert true response line starts http 101 swallow headers string response header line client reader read line while response header line equals response header line client reader read line now we can do web socket string msg client read message assert equals bug53339ws inbound test message msg finished socket client close private static class extends web socket servlet private static final long serial version uid 1l override protected stream inbound create web socket inbound string sub protocol return new bug53339ws inbound private static class bug53339ws inbound extends message inbound public static final string test message test message public static final string jndi name override protected void open ws outbound outbound string msg error try javax naming context init ctx new initial context msg string init ctx lookup java comp env jndi name catch naming exception ignore test checks message sent print stack trace debug purposes test fails char buffer cb char buffer wrap msg try outbound write text message cb catch ioexception ignore test checks message sent override protected void binary message byte buffer message throws ioexception ignore override protected void text message char buffer message throws ioexception ignore
false 200 false 200 true 401 false 200 true 401 false 200 true 401 false 200 true 401 false 200 boolean verify auth scheme case string auth line basic base64auth
request get async context null async request started during forward don close response may written during async handling return test public void test bug53337 throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp file doc base new file system get property java io tmpdir context ctx tomcat add context doc base get absolute path wrapper tomcat add servlet ctx servlet new set async supported true wrapper tomcat add servlet ctx servlet new set async supported true tomcat add servlet ctx servlet new ctx add servlet mapping servlet servlet ctx add servlet mapping servlet servlet ctx add servlet mapping servlet servlet tomcat start string builder url new string builder 48 url append http localhost url append get port url append servlet byte chunk body new byte chunk int rc get url url string body null assert equals http servlet response sc ok rc assert equals ok body string private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception request dispatcher rd req get request dispatcher servlet rd forward req resp private static class extends http servlet private static final long serial version uid 1l override protected void do get final http servlet request req final http servlet response resp throws servlet exception ioexception final async context async req start async just debugging async set timeout 100000 executor service executor executors new single thread executor executor submit new runnable override public void run async dispatch servlet executor shutdown private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print ok
boolean init false init init true simple servlet test servlet instances private static class init count extends http servlet private static final long serial version uid 1l private atomic integer call count new atomic integer override public void init throws servlet exception super init call count increment get override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set content type text plain resp get writer print ok public int get call count return call count int value test public void test bug53301 throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir init count init count new init count tomcat add servlet ctx init count init count ctx add servlet mapping init count tomcat start byte chunk res get url http localhost get port assert equals ok res string assert equals init count get call count
deprecated deprecated digester add call method full prefix servlet security role ref add security role ref digester add call param full prefix servlet security role ref role link digester add call param full prefix servlet security role ref role name
start stop queue private static class start stop thread factory implements thread factory private thread group group private atomic integer thread number new atomic integer private string name prefix public start stop thread factory string name prefix security manager system get security manager group null get thread group thread current thread get thread group name prefix name prefix override public thread new thread runnable thread thread new thread group name prefix thread number get increment thread set daemon true return thread
jar conn set use caches false
message bytes connection value mb headers get value connection boolean connection close present false entity body http11 headers add value constants connection set string constants close private boolean connection close mime headers headers message bytes connection headers get value constants connection connection null return false return connection equals constants close test public void test chunking11no content length throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt content length flushing servlet new content length flushing servlet ctxt add servlet mapping test content length flushing servlet tomcat start byte chunk response body new byte chunk map string list string response headers new hash map string list string int rc get url http localhost get port test response body response headers assert equals http servlet response sc ok rc assert true response headers contains key transfer encoding list string encodings response headers get transfer encoding assert equals encodings size assert equals chunked encodings get test public void test chunking11no content length connection close throws exception tomcat tomcat get tomcat instance must have real doc base just use temp context ctxt tomcat add context system get property java io tmpdir tomcat add servlet ctxt content length connection close flushing servlet new content length connection close flushing servlet ctxt add servlet mapping test content length connection close flushing servlet tomcat start byte chunk response body new byte chunk map string list string response headers new hash map string list string int rc get url http localhost get port test response body response headers assert equals http servlet response sc ok rc assert true response headers contains key connection list string connections response headers get connection assert equals connections size assert equals close connections get assert false response headers contains key transfer encoding assert equals ok response body string flushes content length set should result chunking http private static final class content length flushing servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status http servlet response sc ok resp set content type text plain resp get writer write ok resp flush buffer flushes content length set sets connection close header should result chunking http private static final class content length connection close flushing servlet extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception resp set status http servlet response sc ok resp set content type text event stream resp add header connection close resp flush buffer resp get writer write ok resp flush buffer
string field name character lower case method name char method name substring string builder name new string builder setter get name remove set name delete lowercase first char name set char character lower case name char return name string
injections null method name starts set method name length
boolean class resource path ends class binary stream null else try return entry source open stream catch ioexception ioe ignore return null
map string string injections injection map get clazz get name private map string string assemble injections from class hierarchy class clazz map string string injections new hash map string string map string string current injections null while clazz null current injections injection map get clazz get name current injections null injections put all current injections clazz clazz get superclass return injections
default sets read timeout infinite expects web socket application close connection when longer required applications wishing set explicit timeout may override method return value choice return read timeout milliseconds infinite override public int get read timeout return socket get socket long value true socket get socket long value true socket get socket long value false socket get socket long value false socket timeout set wrapper get socket long value upgrade inbound get read timeout int timeout upgrade inbound get read timeout timeout timeout wrapper get socket set so timeout timeout allow upgraded protocol define read timeout used upgraded connection return read timeout milliseconds infinite int get read timeout wrapper set timeout upgrade inbound get read timeout add specified socket associated pool poller socket added temporary array polled first after maximum amount time equal poll time most cases latency much lower however param socket add poller public void add long socket boolean keep alive keep alive add socket timeout add count get keep alive timeout else add socket timeout add count get so timeout int timeout add socket timeout timeout convert milliseconds microseconds timeout timeout 1000 poll apr pollin add socket timeout 1000 get poller add state socket true get poller add socket get socket long value false private atomic long pool version new atomic long long min value
idle new linked transfer queue pooled connection idle new array blocking queue pooled connection properties get max active false con get connection version get pool version return true check idle false public void check idle boolean ignore min size while idle size get pool properties get min idle unlocked has next con get release time now time con get release time get size get pool properties get min idle protected boolean should release idle long now pooled connection con long time con get connection version get pool version return true else return con get release time now time con get release time get size get pool properties get min idle purges all connections pool connections currently use connections purged when returned pool call also purges connections idle pool only purge used active connections see link purge return public void purge purge return check idle true purges connections when returned from pool call does purge idle connections until used purge idle connections see link purge public void purge return pool version increment get public long get pool version return pool version get inherit doc public void purge try create pool purge catch sqlexception log error unable purge pool inherit doc public void purge return try create pool purge return catch sqlexception log error unable purge pool private volatile long connection version connection version parent get pool version public long get connection version return connection version inherit doc override public void purge pool purge inherit doc override public void purge return pool purge return purges all connections pool connections currently use connections purged when returned pool call also purges connections idle pool only purge used active connections see link purge return public void purge purges connections when returned from pool call does purge idle connections until used purge idle connections see link purge public void purge return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public pool purge test string name super name static final int expected size override public org apache tomcat jdbc pool data source create default data source todo auto generated method stub org apache tomcat jdbc pool data source ds super create default data source ds get pool properties set driver class name driver class get name ds get pool properties set url driver url ds get pool properties set initial size expected size ds get pool properties set max idle expected size ds get pool properties set min idle expected size ds get pool properties set max active expected size ds get pool properties set time between eviction runs millis 30000 ds get pool properties set max age long max value return ds override protected void tear down throws exception driver reset super tear down public void test pool purge throws exception init datasource get connection close assert equals nr connections should expected size expected size datasource get size datasource purge assert equals nr connections should datasource get size tear down public void test pool purge active throws exception init java sql connection con datasource get connection assert equals nr connections should expected size expected size datasource get size datasource purge assert equals nr connections should expected size expected size datasource get size con close assert equals nr connections should datasource get size tear down public void test pool purge return throws exception init java sql connection con datasource get connection assert equals nr connections should expected size expected size datasource get size datasource purge return assert equals nr connections should expected size expected size datasource get size con close assert equals nr connections should expected size expected size datasource get size tear down
small hack until servlet api provides way do request facade req do upgrade inbound
running executor null set max connections get max threads strong max threads strong nio default code 10000 code strong max threads strong nio default code 10000 code
returns true replicate object has been accessed return boolean override public boolean access replicate long repl delta system current time millis get last time replicated max inactive interval repl delta max inactive interval 1000 return true return false access existing object override public void access entry access set primary session false end access protected long get last time replicated protected void set last time replicated long last time replicated check see we need replicate object dirty complete boolean repl complete value instanceof replicated map entry replicated map entry value dirty boolean diff value instanceof replicated map entry replicated map entry value diffable diff msg null access construct access message msg new map message map context name map message msg access false serializable entry get key null null entry get primary entry get backup nodes entry get value instanceof replicated map entry replicated map entry entry get value set last time replicated system current time millis mapmsg get msg type map message msg access map entry entry inner map get mapmsg get key entry null entry set backup nodes mapmsg get backup nodes entry set primary mapmsg get primary entry get value instanceof replicated map entry replicated map entry entry get value access entry public static final int msg access 11 case msg access return msg access return last replicate time return public long get last time replicated set last replicate time param last time replicated public void set last time replicated long last time replicated returns true replicate object has been accessed return boolean public boolean access replicate access existing object public void access entry
minor patch
evictor thread supposed run start now properties pool sweeper enabled pool cleaner new pool cleaner properties get time between eviction runs millis pool cleaner start end protected properties db properties new properties protected string url null protected string driver class name null protected boolean default auto commit null protected boolean default read only null protected int default transaction isolation data source factory unknown protected string default catalog null protected string connection properties protected int initial size 10 protected int max active default max active protected int max idle max active protected int min idle initial size protected int max wait 30000 protected string validation query protected string validator class name protected validator validator protected boolean test borrow false protected boolean test return false protected boolean test while idle false protected int time between eviction runs millis 5000 protected int num tests per eviction run protected int min evictable idle time millis 60000 protected final boolean access underlying connection allowed true protected boolean remove abandoned false protected int remove abandoned timeout 60 protected boolean log abandoned false protected string name tomcat connection pool pool counter add get system identity hash code pool properties class protected string password protected string username protected long validation interval 30000 protected boolean jmx enabled true protected string init sql protected boolean test connect false protected string jdbc interceptors null protected boolean fair queue true protected boolean use equals true protected int abandon when percentage full protected long max age protected boolean use lock false protected interceptor definition interceptors null protected int suspect timeout protected object data source null protected string data source jndi null protected boolean alternate username allowed false protected boolean commit return false protected boolean rollback return false protected boolean use disposable connection facade true protected boolean log validation errors false protected boolean propagate interrupt state false todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub todo auto generated method stub op noop noop noop private static final cache value null tccl factory new cache value private static concurrent map cache key cache value factory cache new concurrent hash map cache key cache value
string class name discover class name tccl cache value cache value class clazz tccl null cache value null tccl factory else cache key key new cache key tccl cache value factory cache get key cache value null cache value new cache value new cache value cache value factory cache put absent key new cache value cache value null cache value new cache value final lock read lock cache value get lock read lock read lock lock class clazz null tccl null clazz class name class name else clazz tccl load class class name try catch class found exception throw new elexception unable find expression factory type class name unable create expression factory type class name unable create expression factory type class name unable create expression factory type class name unable create expression factory type class name key used cache expression factory discovery information per class loader class loader reference never code null because code null tccl handled separately private static class cache key private final int hash private final weak reference class loader ref public cache key class loader cl hash cl hash code ref new weak reference class loader cl override public int hash code return hash override public boolean equals object obj obj return true obj instanceof cache key return false class loader cl ref get cl null return false return cl cache key obj ref get private static class cache value private final read write lock lock new reentrant read write lock private string class name private weak reference class ref public cache value public read write lock get lock return lock public string get factory class name return class name public void set factory class name string class name class name class name public class get factory class return ref null ref get null public void set factory class class clazz ref new weak reference class clazz licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test public void bug53001 expression factory factory expression factory new instance elcontext context new elcontext impl resource bundle rb new tester resource bundle value expression var factory create value expression rb resource bundle class context get variable mapper set variable rb var value expression ve factory create value expression context rb keys string class method expression me factory create method expression context rb get keys enumeration class null ensure we compliant string result1 string ve get value context assert assert equals keys result1 check method expression does return keys object result2 me invoke context null assert assert true result2 instanceof enumeration suppress warnings unchecked enumeration string enumeration string result2 assert assert true has more elements assert assert equals key2 next element assert assert true has more elements assert assert equals key1 next element assert assert false has more elements private static class tester resource bundle extends list resource bundle override protected object get contents return contents private static final object contents key1 value1 key2 value2 private static final string separator
-1
class class class null load class annotation context application listeners class class class null load class annotation context filter defs get filter class class loader class loader context get loader get class loader try class class class loader load class wrapper get servlet class catch class found exception we do nothing catch class def found error we do nothing load class annotation context wrapper get servlet class protected static void load class annotation context context string file string class loader class loader context get loader get class loader class class class null try class class class loader load class file string catch class found exception we do nothing catch class def found error we do nothing class class null return protected static void load fields annotation context context class class class initialize annotations field fields get declared fields class class fields null fields length field field fields field annotation present resource class resource annotation field get annotation resource class string default name class class get name separator field get name string default type field get type get canonical name add resource context annotation default name default type protected static void load methods annotation context context class class class initialize annotations method methods get declared methods class class methods null methods length method method methods method annotation present resource class resource annotation method get annotation resource class check bean naming conventions method string default name class class get name separator default instance manager get name method string default type method get parameter types get canonical name add resource context annotation default name default type add resource context annotation null null annotation type get canonical name equals java lang string annotation type get canonical name equals java lang character annotation type get canonical name equals java lang integer annotation type get canonical name equals java lang boolean annotation type get canonical name equals java lang double annotation type get canonical name equals java lang byte annotation type get canonical name equals java lang short annotation type get canonical name equals java lang long annotation type get canonical name equals java lang float resource set name annotation name resource set type annotation type get canonical name else annotation type get canonical name equals javax xml rpc service service set name annotation name service set type annotation type get canonical name else annotation type get canonical name equals javax sql data source annotation type get canonical name equals javax jms connection factory annotation type get canonical name equals javax jms queue connection factory annotation type get canonical name equals javax jms topic connection factory annotation type get canonical name equals javax mail session annotation type get canonical name equals java net url annotation type get canonical name equals javax resource cci connection factory annotation type get canonical name equals org omg corba orb annotation type get canonical name ends connection factory resource set name annotation name resource set type annotation type get canonical name else annotation type get canonical name equals javax jms queue annotation type get canonical name equals javax jms topic resource set name annotation name resource set type annotation type get canonical name else annotation type get canonical name equals javax resource cci interaction spec annotation type get canonical name equals javax transaction user transaction resource set name annotation name resource set type annotation type get canonical name private static void check bean naming conventions method method method get name starts set method get name length method get parameter types length method get return type get name equals void throw new illegal argument exception invalid method resource injection annotation private static string get type resource annotation string default type string type annotation type get canonical name type null type equals java lang object default type null type default type return type private static string get name resource annotation string default name string name annotation name name null name equals default name null name default name return name private static field get declared fields class class class field fields null globals security enabled final class clazz class class fields access controller do privileged new privileged action field override public field run return clazz get declared fields else fields class class get declared fields return fields private static method get declared methods class class class method methods null globals security enabled final class clazz class class methods access controller do privileged new privileged action method override public method run return clazz get declared methods else methods class class get declared methods return methods private static class load class context context string file string class loader class loader context get loader get class loader class class class null try class class class loader load class file string catch class found exception we do nothing catch class def found error we do nothing return class class
class loader cl get catalina get parent class loader while cl class loader get system class loader attribute name propagate interrupt state required false boolean set true propagate interrupt state thread has been interrupted clearing interrupt state default value code false code backwards attribute
thread interrupted thread interrupted clear flag bail out inherit doc override public boolean get propagate interrupt state return get pool properties get propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state get pool properties set propagate interrupt state propagate interrupt state returns true pool configured propagate interrupt state thread thread waiting connection can have its wait interrupted default clear interrupt flag throw link pool exhausted exception return true pool configured propagate clear thread interrupt state public boolean get propagate interrupt state configure pool propagate interrupt state interrupted threads waiting connection thread waiting connection can have its wait interrupted default clear interrupt flag throw link pool exhausted exception set true behavior change while link pool exhausted exception still thrown threads interrupted state still set param propagate interrupt state set true clear propagate threads interrupted state public void set propagate interrupt state boolean propagate interrupt state protected boolean propagate interrupt state false inherit doc override public boolean get propagate interrupt state return propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state propagate interrupt state propagate interrupt state inherit doc override public boolean get propagate interrupt state return get pool properties get propagate interrupt state inherit doc override public void set propagate interrupt state boolean propagate interrupt state get pool properties set propagate interrupt state propagate interrupt state
stop valve necessary get state available valve instanceof lifecycle try lifecycle valve destroy catch lifecycle exception log error standard pipeline remove valve destroy licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license test digest non login when single sign valve active absence sso support webapp using non login simply cannot access protected resources tests exercise way successfully different webapp under digest triggers additional sso logic both webapps note tests intended exercise sso logic test all its logic paths non sso test suite private static final string user user private static final string pwd pwd private static final string role role private static final string http prefix http localhost private static final string context path nologin nologin private static final string context path digest digest private static final string uri protected protected private static final string uri public anyone can access private static final int short timeout secs private static final long short timeout delay msecs short timeout secs 1000 private static final int long timeout secs 10 private static final long long timeout delay msecs long timeout secs 1000 private static final string client auth header private static final string opaque opaque private static final string nonce nonce private static final string realm realm private static final string cnonce cnonce private static string nc1 00000001 private static string nc2 00000002 private static string qop auth private static string server cookies set cookie private static string browser cookies cookie private list string cookies try access unprotected resource without established sso session should permitted test public void test accept public non login throws exception do test non login context path nologin uri public true false 200 try access protected resource without established sso session should rejected sc forbidden 403 status test public void test reject protected non login throws exception do test non login context path nologin uri protected false true 403 logon access protected resource using digest which establish sso session wait until sso session times out try re access resource should rejected sc forbidden 401 status which followed successful re test public void test digest login session timeout throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true wait long enough my session expire thread sleep long timeout delay msecs must change client nonce succeed do test digest user pwd context path digest uri protected true 401 true true nc2 cnonce qop true logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp without sending sso session cookie should rejected sc forbidden 403 status test public void test digest login reject protected without cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected false true 403 logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp while sending sso session cookie provided first webapp should successful sc ok 200 status test public void test digest login accept protected cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected true false 200 logon access protected resource using digest which establish sso session immediately try access protected resource non login webapp while sending sso session cookie provided first webapp should successful sc ok 200 status wait long enough digest session expire sso session should remain active because non login session has yet expired try access protected resource again before sso session has expired should successful sc ok 200 status finally wait non login session expire try again should rejected sc forbidden 403 status see bugfix https issues apache org bugzilla show bug cgi id 52303 test public void test digest expired accept protected cookies throws exception do test digest user pwd context path digest uri protected true 401 true true nc1 cnonce qop true do test non login context path nologin uri protected true false 200 wait long enough basic session expire long enough non login session expiry thread sleep short timeout delay msecs do test non login context path nologin uri protected true false 200 wait long enough my non login session expire tear down sso session same time thread sleep long timeout delay msecs do test non login context path nologin uri protected false true 403 public void do test non login string uri boolean add cookies boolean expected reject int expected rc throws exception map string list string req headers new hash map string list string map string list string resp headers new hash map string list string byte chunk bc new byte chunk add cookies add cookies req headers int rc get url http prefix get port uri bc req headers resp headers expected reject assert equals expected rc rc assert true bc get length else assert equals 200 rc assert equals ok bc string save cookies resp headers public void do test digest string user string pwd string uri boolean expected reject1 int expected rc1 boolean use server nonce boolean use server opaque string nc1 string cnonce string qop boolean throws exception string digest uri uri list string auth new array list string map string list string req headers1 new hash map string list string map string list string resp headers1 new hash map string list string first access attempt should challenged auth add build digest response user pwd digest uri realm null null nc1 cnonce qop req headers1 put client auth header auth byte chunk bc new byte chunk int rc get url http prefix get port uri bc req headers1 resp headers1 expected reject1 assert equals expected rc1 rc assert true bc get length else assert equals 200 rc assert equals ok bc string save cookies resp headers1 return second request should succeed we use server nonce map string list string req headers2 new hash map string list string map string list string resp headers2 new hash map string list string auth clear use server nonce use server opaque auth add build digest response user pwd digest uri get auth token resp headers1 realm get auth token resp headers1 nonce get auth token resp headers1 opaque nc1 cnonce qop else auth add build digest response user pwd digest uri get auth token resp headers1 realm get auth token resp headers1 nonce null nc1 cnonce qop else auth add build digest response user pwd digest uri get auth token resp headers2 realm null get auth token resp headers1 opaque nc1 cnonce qop req headers2 put client auth header auth bc recycle rc get url http prefix get port uri bc req headers2 resp headers2 assert equals 200 rc assert equals ok bc string save cookies resp headers2 else assert equals 401 rc assert true bc get length override public void set up throws exception super set up create tomcat server using default memory realm tomcat tomcat get tomcat instance associate singe sign valve before contexts single sign sso new single sign tomcat get host get pipeline add valve sso add test user role realm tomcat add user user pwd tomcat add role user role setup both non login login digest webapps set up non login tomcat set up digest tomcat tomcat start private void set up non login tomcat tomcat throws exception must have real doc base webapps just use temp context ctxt tomcat add context context path nologin system get property java io tmpdir ctxt set session timeout long timeout secs add protected servlet tomcat add servlet ctxt tester servlet1 new tester servlet ctxt add servlet mapping uri protected tester servlet1 security collection collection1 new security collection collection1 add pattern uri protected security constraint sc1 new security constraint sc1 add auth role role sc1 add collection collection1 ctxt add constraint sc1 add unprotected servlet tomcat add servlet ctxt tester servlet2 new tester servlet ctxt add servlet mapping uri public tester servlet2 security collection collection2 new security collection collection2 add pattern uri public security constraint sc2 new security constraint do add role which signals access permitted without one sc2 add collection collection2 ctxt add constraint sc2 configure appropriate login config lc new login config lc set auth method none ctxt set login config lc ctxt get pipeline add valve new non login private void set up digest tomcat tomcat throws exception must have real doc base webapps just use temp context ctxt tomcat add context context path digest system get property java io tmpdir ctxt set session timeout short timeout secs add protected servlet tomcat add servlet ctxt tester servlet3 new tester servlet ctxt add servlet mapping uri protected tester servlet3 security collection collection new security collection collection add pattern uri protected security constraint sc new security constraint sc add auth role role sc add collection collection ctxt add constraint sc configure appropriate login config lc new login config lc set auth method digest ctxt set login config lc ctxt get pipeline add valve new digest protected static string get auth token map string list string resp headers string token final string auth prefix final string auth suffix list string auth headers resp headers get base auth header name assume only one string auth header auth headers iterator next string search token auth prefix int start auth header index search search length int end auth header index auth suffix start return auth header substring start end notes from rfc2617 data md5 data kd secret data concat secret data a1 unq username value unq realm value passwd a2 method digest uri value request digest kd a1 unq nonce value nc value unq cnonce value unq qop value a2 private static string build digest response string user string pwd string uri string realm string nonce string opaque string nc string cnonce string qop throws algorithm exception string a1 user realm pwd string a2 get uri string md5a1 digest a1 string md5a2 digest a2 string response qop null response md5a1 nonce md5a2 else response md5a1 nonce nc cnonce qop md5a2 string md5response digest response string builder auth new string builder auth append digest username auth append user auth append realm auth append realm auth append nonce auth append nonce auth append uri auth append uri auth append opaque auth append opaque auth append response auth append md5response auth append qop null auth append qop auth append qop auth append nc null auth append nc auth append nc auth append cnonce null auth append cnonce auth append cnonce auth append return auth string private static string digest string input throws algorithm exception slow should ok only test message digest md5 message digest get instance md5 md5encoder encoder new md5encoder md5 update input get bytes return encoder encode md5 digest extract save server cookies from incoming response protected void save cookies map string list string resp headers we only save cookie values header prefix cookies resp headers get server cookies add all saved cookies outgoing request protected void add cookies map string list string req headers cookies null cookies size req headers put browser cookies cookies
-1
protected boolean use disposable connection facade inherit doc override public void set log validation errors boolean log validation errors log validation errors log validation errors inherit doc override public boolean get log validation errors return log validation errors get pool properties get log validation errors log error custom validation through pool properties get validator failed catch exception ignore log debug enabled log debug unable validate object ignore inherit doc override public void set log validation errors boolean log validation errors get pool properties set log validation errors log validation errors inherit doc override public boolean get log validation errors return get pool properties get log validation errors
throw new sqlexception thread current thread get name throw new sqlexception thread current thread get name public static final string pool empty pool empty
log warn enabled log warn failed query report sql sql time delta ms log warn enabled log warn slow query report sql sql time delta ms
attachment null return false
buffered output stream bos null boolean error false oos new object output stream new buffered output stream fos error true fos null try fos close catch ioexception ignore throw
thread get class get name equals java util timer thread field target field thread get class get declared field target target field set accessible true object target target field get thread target null target get class get canonical name equals java util concurrent thread pool executor worker field executor field target get class get declared field executor field set accessible true object executor executor field get target executor instanceof thread pool executor thread pool executor executor shutdown now field new tasks may scheduled field thread get class get declared field new tasks may scheduled new tasks may scheduled field set accessible true field queue field thread get class get declared field queue queue field set accessible true object queue queue field get thread method clear method queue get class get declared method clear clear method set accessible true synchronized queue new tasks may scheduled field set boolean thread false clear method invoke queue queue notify case queue already empty class tlm class class name java lang thread local thread local map method expunge stale entries method tlm class get declared method expunge stale entries expunge stale entries method set accessible true check thread local map leaks thread local map table field thread local map inheritable thread locals field get threads check thread local map leaks thread local map table field catch invocation target exception log warn sm get string webapp class loader check thread locals leaks fail context name catch method exception log warn sm get string webapp class loader check thread locals leaks fail context name cl
restore el context out printil jsp context get elcontext put context javax servlet jsp jsp context class get jsp context out printil object jspx saved jsp context jsp context get elcontext get context javax servlet jsp jsp context class restore nested jsp context elcontext out printil jsp context get elcontext put context javax servlet jsp jsp context class jspx saved jsp context name class use retrieving user names from x509 certificates protected string x509username retriever class name object extract user names from x509 client certificates protected x509username retriever x509username retriever
gets name class used extract user names from x509 client certificates return name class used extract user names from x509 client certificates public string get x509username retriever class name return x509username retriever class name sets name class used extract user names from x509 client certificates class must implement see x509username retriever param class name name class used extract user names from x509 client certificates public void set x509username retriever class name string class name x509username retriever class name class name x509username retriever create username retriever x509username retriever class name return get principal usercert get subject dn get name private static x509username retriever create username retriever string class name throws lifecycle exception null class name equals class name trim return new x509subject dn retriever try suppress warnings unchecked class extends x509username retriever clazz class extends x509username retriever class name class name return x509username retriever clazz new instance catch class found exception throw new lifecycle exception sm get string realm base create username retriever class found exception class name catch exception throw new lifecycle exception sm get string realm base create username retriever exception class name catch illegal access exception throw new lifecycle exception sm get string realm base create username retriever illegal access exception class name catch class cast exception throw new lifecycle exception sm get string realm base create username retriever class cast exception class name licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license x509username retriever returns certificate entire subject dn username implements x509username retriever public string get username client cert return client cert get subject dn get name licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides interface retrieving user name from gets user name from param cert certificate containing user name return appropriate user name obtained from one more fields certificate public string get username client cert attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute attribute name x509username retriever class name required false when using x509 client certificates specifies class name used retrieve user name from certificate class must implement code org apache catalina realm x509username retriever code interface default use certificate subject dn username attribute
param jarfile jar file checked protected boolean validate jar file file jarfile jar file jar file new jar file jarfile int triggers length class clazz null try parent null clazz parent load class triggers else clazz class name triggers catch exception clazz null clazz null continue string name triggers replace class log debug enabled log debug checking name jar entry jar entry jar file get jar entry name jar entry null log info validate jar file jarfile jar loaded see servlet spec section offending class name jar file close return false jar file close return true
sm get string naming context name bound name get sm get string naming context name bound name get sm get string naming context name bound name get sm get string naming context name bound name get sm get string naming context name bound name get throw new name found exception sm get string naming context name bound name get
context null scan files new file uri root file uri root new file uri root uri root exists uri root directory throw new jasper exception localizer get message jsp error jspc uriroot dir
att await write latch write timeout time unit milliseconds when tomcat started database connection auto reconnect option created used all log activity when tomcat shutdown database connection closed
props put auto reconnect true
principal principal request get user principal
input stream reader isr null br new buffered reader new input stream reader utf isr null isr close catch ioexception ioe ignore try
input stream reader isr null reader new buffered reader new input stream reader ctxt get options get java encoding isr null try isr close catch ioexception ioe ignore
comet event impl comet event request get event comet event impl comet event request get event comet event close finally try comet event close catch ioexception container get logger warn sm get string comet connection manager valve event
file output stream fos null ostream new buffered output stream new file output stream xml 1024 ostream close ostream null istream close istream null catch throwable exception utils handle throwable fos null try fos close catch ioexception ioe ignore fos null catch throwable exception utils handle throwable catch throwable exception utils handle throwable
file input stream fis new file input stream file file input stream fis null fis new file input stream file fis close catch exception try fis close catch throwable exception utils handle throwable throw
class name org apache jsp tag web string builder base new string builder org apache jsp tag meta
file input stream fis null file input stream fis new file input stream file fis close finally fis null try fis close catch ioexception ignore try get port socket socket new socket get address get port output stream stream socket get output stream stream close socket close else log error sm get string catalina stop server finally stream null try stream close catch ioexception ignore socket null try socket close catch ioexception ignore catch ioexception log error catalina stop input stream close finally try input stream close catch ioexception ignore lt param name gt expires type text javascript lt param name gt text javascript expires starting point access time duration 10 minute lt param name gt expires type text javascript lt param name gt
-1
-1
suppress warnings unused new method added interface later jdt versions public boolean ignore optional problems return false
else cause instanceof null pointer exception log debug error getting attribute oname att name rme
servlet context context context get servlet context hack required eclipse serve modules without publishing feature since backs web inf classes multiple locations rather than one file web inf class dir new file process annotations file web inf class dir web xml context get servlet context set attribute merged web xml
else obj0 instanceof boolean obj1 instanceof boolean return coerce boolean obj0 equals coerce boolean obj1 else obj0 get class enum return obj0 equals coerce enum obj1 obj0 get class else obj1 get class enum return obj1 equals coerce enum obj0 obj1 get class else obj0 instanceof string obj1 instanceof string int lex compare coerce string obj0 compare coerce string obj1 return lex compare true false big decimal op obj0 obj1 double op obj0 obj1 big integer op obj0 obj1 long op obj0 obj1 else obj0 instanceof boolean obj1 instanceof boolean return coerce boolean obj0 equals coerce boolean obj1 else obj0 get class enum return obj0 equals coerce enum obj1 obj0 get class else obj1 get class enum return obj1 equals coerce enum obj0 obj1 get class else obj0 instanceof string obj1 instanceof string int lex compare coerce string obj0 compare coerce string obj1 return lex compare true false public void test equals assert true elsupport equals 01 long value test
add folder list catalina ext dirs
end stream false
catch jmruntime exception rme throwable cause rme get cause cause instanceof unsupported operation exception log debug error getting attribute oname att name rme else log error error getting attribute oname att name rme continue att name
request set path info error page get location
reset false public void reset boolean reset writer stream flags got enc false enc null output buffer reset test public void test bug52577 throws exception tomcat tomcat get tomcat instance context root tomcat add context temp dir bug52577 new tomcat add servlet root bug52577 bug52577 root add servlet mapping bug52577 tomcat start byte chunk bc new byte chunk int rc get url http localhost get port bc null null assert equals http servlet response sc ok rc assert equals ok bc string private static class extends http servlet private static final long serial version uid 1l override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception writer resp get writer write ok resp reset buffer write ok
override protected void init internal throws lifecycle exception ensure realm present before any attempt made start one create default null realm necessary get realm super init internal new linked hash map servlet container initializer set class new hash map class set servlet container initializer
cache used longer required so clear java class cache clear type annotation handles types annotations true else handles types non annotations true choice load class handles types non annotations might match handles type populate java class cache class name java class java class cache entry entry java class cache get class name entry get sci set null populate scis cache entry entry entry get sci set size need try load class clazz load class class name clazz null can load class so point continuing return servlet container initializer sci entry get sci set set class classes initializer class map get sci classes null classes new hash set class initializer class map put sci classes classes add clazz handles types annotations map entry class set servlet container initializer entry type initializer map entry set entry get key annotation annotation entry annotation entries java class get annotation entries annotation entry annotation entry annotation entries entry get key get name equals get class name annotation entry get annotation type clazz null clazz load class class name clazz null can load class so point continuing return servlet container initializer sci entry get value initializer class map get sci add clazz break private void populate java class cache string class name java class java class java class cache contains key class name return add class cache java class cache put class name new java class cache entry java class populate java class cache java class get superclass name string iterface java class get interface names populate java class cache iterface private void populate java class cache string class name java class cache contains key class name string name class name replace class input stream context get loader get class loader get resource stream name class parser parser new class parser null try java class clazz parser parse populate java class cache clazz get class name clazz catch class format exception log debug sm get string context config invalid sci handles types class name catch ioexception log debug sm get string context config invalid sci handles types class name private void populate scis cache entry java class cache entry cache entry set servlet container initializer result new hash set servlet container initializer java class java class cache entry get java class super class string super class name java class get superclass name java class cache entry super class cache entry java class cache get super class name avoid infinite loop java lang object cache entry equals super class cache entry cache entry set sci set new hash set servlet container initializer return may null class present could loaded super class cache entry null super class cache entry get sci set null populate scis cache entry super class cache entry result add all super class cache entry get sci set result add all get scis class super class name interfaces string interface name java class get interface names java class cache entry interface entry java class cache get interface name null could mean class present application nothing interest either way nothing do here so move along interface entry null interface entry get sci set null populate scis cache entry interface entry result add all interface entry get sci set result add all get scis class interface name cache entry set sci set result private set servlet container initializer get scis class string class name map entry class set servlet container initializer entry type initializer map entry set class clazz entry get key clazz annotation clazz get name equals class name return entry get value return collections empty set private class load class string class name class clazz null return return return return clazz annotation skip return boolean match false map entry class set servlet container initializer entry type initializer map entry set entry get key annotation annotation entry annotation entries java class get annotation entries annotation entry annotation entry annotation entries entry get key get name equals get class name annotation entry get annotation type match true break else entry get key assignable from clazz match true match servlet container initializer sci entry get value initializer class map get sci add clazz match false return clazz private static class java class cache entry private final java class java class private set servlet container initializer sci set null public java class cache entry java class java class java class java class public java class get java class return java class public set servlet container initializer get sci set return sci set public void set sci set set servlet container initializer sci set sci set sci set return names implemented interfaces public string get interface names return interface names returns super class name class case class java lang object return itself java lang object probably incorrect isn fixed time break existing clients return superclass name public string get superclass name return superclass name config handles types annotations true config handles types non annotations true
byte count
check length before write length check length before write end start check length before write length check length before write len checks see enough space buffer write requested number bytes private void check length before write int length throws illegal state exception pos length buf length throw new illegal state exception sm get string iob error
naming enumeration binding list bindings null naming enumeration binding list bindings context get resources list bindings web inf classes while list bindings has more elements file web inf class dir new file metadata complete true
tld config add application listener text
base64 encode input get bytes charset default charset ip time key get bytes charset default charset server ip time key get bytes charset default charset buffer md5helper digest a2 get bytes charset default charset md update credentials get bytes charset default charset md update credentials get bytes charset default charset pwbc append password get bytes charset default charset return charset default charset lock token str get bytes charset default charset encoding specified let use platform default bytes str get bytes charset default charset charset charset default charset strcerts get bytes charset default charset encoding set bytes encoding name get bytes charset default charset encoding set bytes encoding name get bytes charset default charset encoding set bytes encoding name get bytes charset default charset encoding set bytes encoding name get bytes charset default charset smap get bytes charset default charset object string get bytes charset default charset object string get bytes charset default charset object string get bytes charset default charset byte bb str value get bytes charset default charset
repository repository substring repository repository substring private string utf8decode string input string result null try result urldecoder decode input utf catch unsupported encoding exception uee impossible all jvms required support utf return result
qry request get parameter invoke qry null string op name request get parameter op string ps request get parameter ps string values str ps null values str new string else values str request get parameter ps split invoke operation writer qry op name values str return writer println error ex string writer println error ex string catch exception writer println error string private void invoke operation print writer writer string oname str string op string values str try object name oname new object name oname str mbean operation info method info registry get method info oname op mbean parameter info signature method info get signature string signature types new string signature length object values new object signature length int signature length mbean parameter info pi signature signature types pi get type values registry convert value pi get type values str object ret val bean server invoke oname op values signature types writer println ok operation op returned output writer ret val catch exception ex writer println error ex print stack trace writer private void output string indent print writer writer object result result instanceof object object obj object result output indent writer obj else writer println indent result string subsection name jmx invoke command code invoke code command enables methods called mbeans general form command exmaple call code find connectors code method strong service strong use subsection implements lifecycle listener
file new file new uri global web xml get system id global time stamp last modified catch urisyntax exception file new file new uri host web xml get system id host time stamp last modified catch urisyntax exception
values ast method parameters jjt get child get parameters ctx children length jjt get child instanceof ast method parameters return true test public void test bug52445a method expression me factory create method expression context bean set bean bean bb null new class tester bean class me invoke context null method expression me1 factory create method expression context bean bean say hello null null string actual string me1 invoke context null assert equals hello from bb actual behavior pre add webapp pre methods you may want call three methods class link get default realm link default web xml path link get default web xml listener default memory realm set default created contexts can replaced set realm context protected realm default realm
set custom realm auth called simple default used using internal map must called before adding context public void set default realm realm realm default realm realm engine set realm create default realm default realm null init simple auth ctx set realm default realm complex accessor allows callers class obtain simple realm created default return simple memory realm created default public realm get default realm default realm null init simple auth return default realm initialize memory realm you can replace contexts real one protected void init simple auth default realm new realm base
javax servlet servlet servlet api name starts javax el must never load javax el classes return false
override public value reference get value reference evaluation context ctx variable mapper var mapper ctx get variable mapper var mapper null return null value expression expr var mapper resolve variable image expr null return null return expr get value reference ctx public void test get value reference variable expression factory factory expression factory new instance elcontext context new elcontext impl tester bean bean new tester bean bean set name tomcat value expression var factory create value expression bean tester bean class context get variable mapper set variable bean var value expression var2 factory create value expression context bean name string class context get variable mapper set variable foo var2 value expression ve factory create value expression context foo value expression class now check value reference value reference vr ve get value reference context assert null vr assert equals bean vr get base assert equals name vr get property test
flush convertor one use got enc conv null conv flush buffer conv flush buffer conv flush buffer conv flush buffer conv flush buffer writer wasbeing used may unflushed bytes convertor got enc conv null conv recycle
silence context path silence url private void silence string ctx base get host get name
log warn sm get string context config invalid sci handles types log warn sm get string context config invalid sci handles types log warn sm get string context config invalid sci handles types
length protect against nulls unexpected types values may set untrusted applications object start request get attribute org apache tomcat sendfile start start instanceof long object end request get attribute org apache tomcat sendfile end end instanceof long length long end long value long start long value sendfile used response bytes written separate thread access log valve know how many bytes were actually written case number bytes passed sendfile thread writing recorded access log valve authenticate user making request based specified login return code true code any specified constraint has been satisfied code false code we have created response challenge already param request request we processing param response response we populating param config login describing how should performed
associating request session sso would allow coordinated session invalidation should session webapp user didn log invalidated when another session logged out string sso id string request get note constants req ssoid note sso id null associate sso id get session request true container log debug enabled container log debug user required return true principal means user already so assigned any roles safe say user now because access protected resources only allowed matching role sc forbidden 403 status generated later container log debug enabled container log debug user without any roles return true return method which vendor specific defined http servlet request
value start log debug enabled log debug sm get string parameters empty chunk do flag error continue foo tmp value set bytes bytes value start value end value start orig value append bytes value start value end value start decode value url decode tmp value tmp value set charset charset value tmp value string private int size private boolean check lock false private boolean add false private boolean remove false private boolean mutex false private boolean enabled true
-1
-1
enabled
doc base lower case locale english ends war todo never executed bug code delete new hash set jsp property group descriptor
new hash set jsp property group
avoid npes selector set null stop selector selector selector iterator selection key selector null selector selected keys iterator null selector null remove
protected int port return port number which we listen requests return port number which connector listening requests special value link port zero used method report actual port bound public int get local port return integer get property local port int value sb append get port get port sb append get port description port number which we listen requests public int get local port return endpoint get local port public synchronized int get name index name index name index name counter increment get return name index name append endpoint get port name append get port public abstract int get local port public methods port use override public int get local port long server sock return else long sa try sa address get socket apr local sockaddr addr address get info sa return addr port catch exception return public methods port use override public int get local port server socket server socket null return else return get local port port use override public int get local port server socket channel ssc server sock ssc null return else server socket ssc socket null return else return get local port set port get port port only known after tomcat starts set port get port test public void test port throws exception tomcat tomcat get tomcat instance connector connector1 tomcat get connector connector1 set port connector connector2 new connector connector2 set port tomcat get service add connector connector2 tomcat start int local port1 connector1 get local port int local port2 connector2 get local port assert true local port1 assert true local port2 client set port get port client set port get port set port tomcat get connector get local port client set port get port set port tomcat get connector get local port client new client set port get port public int port set port port client set port get port set port tomcat get connector get local port client set port get port client set port get port set port tomcat get connector get local port set port tomcat get connector get local port http localhost tomcat get connector get port http http http new url http localhost tomcat get connector get port test open connection expected add all arrays list connector mbean names integer string get port protocol test custom error client client new test custom error client client set port get port test custom error client client new test custom error client client set port get port public void set port int port private static int port 8000 return port sub classes may want add connectors new port public int get next port port return get port each test running same port may interfere each other connector set port get next port client client new client client set port get port client client new client client set port get port client client new client client set port get port client client new client client set port get port client client new client client set port get port final client client new client client set port get port public client int port set port port client set port get port set port tomcat get connector get local port client set port get port client set port get port client set port get port client set port get port client set port get port set port tomcat get connector get local port trailer client client new trailer client client set port get port trailer client client new trailer client client set port get port trailer client client new trailer client client set port get port public trailer client int port set port port set port tomcat get connector get port set port tomcat get connector get port set port tomcat get connector get port set port tomcat get connector get port int port get port particular port number particular ip address particular port number particular ip address
new host object real host mapper add host alias alias check we have right number add 16 one duplicate assert equals 15 mapper hosts length assert equals blah7 mapper hosts object check host alias has same data mapper host host mapper hosts iow pos mapper host alias mapper hosts iow pos assert equals host name assert equals alias alias name assert equals host context list alias context list assert equals host object alias object message bytes alias message bytes new instance alias set string alias assert equals foo mapping data path info string assert true mapping data redirect path null mapping data recycle uri set string foo bar bla bobou foo uri chars uri get char chunk set limit mapper map alias uri null mapping data assert equals blah7 mapping data host assert equals context3 mapping data context assert equals wrapper7 mapping data wrapper assert equals foo bar bla mapping data context path string assert equals bobou mapping data wrapper path string strong note strong class loader faithfully follows delegation model recommended system class from webapp repository
found locally flag true class loader delegates parent class loader strong before strong searching its own repositories ordinary non servlet chain java class loaders set code false code default class loader search its own repositories first delegate parent only class resource found locally per servlet protected static string fipsmode off default off valid only when sslengine protected static boolean fips mode active false
log info sm get string apr listener ssl init fips mode active false equals ignore case apr lifecycle listener fipsmode log info sm get string apr listener initializing fips int result ssl fips mode set success defined return value result fips mode active true log info sm get string apr listener initialize fipssuccess else case should handled native method we ll make absolutely sure here log error sm get string apr listener initialize fipsfailed throw new illegal state exception sm get string apr listener initialize fipsfailed ensure sslengine consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late sslengine ensure random seed consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late sslrandom seed public void set fipsmode string fipsmode ensure fips mode consistent used ssl init ssl initialized throw new illegal state exception sm get string apr listener too late fipsmode apr lifecycle listener fipsmode fipsmode public boolean fipsmode active return fips mode active enable disable fips mode param mode enable disable return fips mode set return code public static native int fips mode set int mode
resources lookup path
context set config file config file uri url
catch file found exception fnfe re throw let caller handle result 404 throw fnfe err jsp error jsp error file found fname err jsp error jsp error file found fname
context request get mapping data context log access request response system current time millis req get start time false post parse success context null start comet request failed has already been logged do simple comet test null test public void test simple comet client begin fail throws exception do simple comet test simple comet servlet fail begin test public void test simple comet client read fail throws exception do simple comet test simple comet servlet fail read test public void test simple comet client end fail throws exception do simple comet test simple comet servlet fail end private void do simple comet test string init param throws exception tomcat add servlet root comet new simple comet servlet tester access log valve alv new tester access log valve root get pipeline add valve alv validate response assert equals http 200 ok response assert equals server apache coyote response assert true response starts set cookie jsessionid assert equals content type text plain charset iso 8859 response assert equals transfer encoding chunked response assert true response starts date assert equals response assert equals response assert equals begin response assert equals response assert equals 17 response 10 assert equals client read bytes response 11 assert equals response 12 assert equals 17 response 13 assert equals client read bytes response 14 assert equals response 15 assert equals 17 response 16 assert equals client read bytes response 17 assert equals response 18 assert equals 17 response 19 assert equals client read bytes response 20 assert equals response 21 assert equals response 22 assert equals client end response 23 assert equals response 24 assert equals response 25 expect 26 lines assert equals 26 response length public static final string fail begin fail begin public static final string fail read fail read public static final string fail end fail end private boolean fail begin false private boolean fail read false private boolean fail end false override public void init throws servlet exception fail begin boolean value get servlet config get init parameter fail begin boolean value fail read boolean value get servlet config get init parameter fail read boolean value fail end boolean value get servlet config get init parameter fail end boolean value fail begin throw new ioexception fail begin fail read throw new ioexception fail read fail end throw new ioexception fail end
leading slash has scheme location
configures response body included when redirect response sent client public void set send redirect body boolean enable dtermines context configured included response body part redirect response public boolean get send redirect body print writer writer get writer writer print sm get string coyote response send redirect note request util filter absolute flush buffer private boolean send redirect body false override public boolean get send redirect body return send redirect body override public void set send redirect body boolean send redirect body send redirect body send redirect body attribute name send redirect body required false code true code redirect responses include short response body includes details redirect recommended rfc 2616 disabled default since including response body may cause problems some application component compression filters attribute
process comet event event get http servlet request get remote host
req get async context complete
wrapper null context has been shutdown nothing do here return
long system current time millis 30000 while acceptors alive
boolean create false create true create adapter log request response adapter log request response error adapter log request response adapter log request response adapter log request response cping endpoint paused cping endpoint paused cping endpoint paused adapter log request response adapter log request response adapter log request response adapter log request response adapter log request response error adapter log request response adapter log request response can add 500 access log since has already been written adapter service method adapter log request response licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final long serial version uid 1l private final random random new random override public string get algorithm return insecure override public synchronized void set seed byte seed implemented override public synchronized void set seed long seed super class constructor calls method earlier than our fields initialized ignore call random null return random set seed seed override public synchronized void next bytes byte bytes random next bytes bytes override public byte generate seed int num bytes byte value new byte num bytes next bytes value return value
tomcat new tomcat private static class tomcat fast session ids extends tomcat override public void start throws lifecycle exception use fats insecure session id generation all tests server server get server service service server find services container service get container container find children container find children standard manager standard manager get manager null new standard manager set secure random class org apache catalina startup fast non secure random set manager super start
super param key type key algorithm type name ignored param issuers list acceptable ca issuer subject names null does matter which issuers used ignored param socket socket used connection parameter can null which case method return most generic alias use ignored choose alias authenticate client side secure socket given public key type list certificate issuer authorities recognized peer any param key type key algorithm type name ordered most preferred key type first param issuers list acceptable ca issuer subject names null does matter which issuers used param engine ignored return alias name desired key null matches override public string choose engine client alias string key type principal issuers sslengine engine return delegate choose client alias key type issuers null returns key manager server key alias provided constructor param key type ignored param issuers ignored param engine ignored return alias name desired key override public string choose engine server alias string key type principal issuers sslengine engine return server key alias
var args int var arg index last parameter varags final object varargs array new instance var arg class param count var arg index object varargs array new instance parameter types param count param count var arg index array set varargs parameters var arg index varargs parameters var arg index varargs licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static class foo public string join delimited string delim string strings string builder result new string builder strings null string strings delim null result length result append delim result append return result string public string join string strings return join delimited null strings private foo foo private elcontext el context private bean elresolver bean elresolver before public void setup foo new foo bean elresolver new bean elresolver el context new elcontext private variable mapper variable mapper new variable mapper private map string value expression vars new hash map string value expression override public value expression set variable string arg0 value expression arg1 return vars put arg0 arg1 override public value expression resolve variable string arg0 return vars get arg0 private function mapper function mapper new function mapper override public method resolve function string arg0 string arg1 return null override public variable mapper get variable mapper return variable mapper override public function mapper get function mapper return function mapper override public elresolver get elresolver return bean elresolver tests varargs come after opening argument test public void test join delimited assert assert equals foo join delimited foo bar baz bean elresolver invoke el context foo join delimited null new object foo bar baz tests varargs constitute method only parameters well bogus results due improper matching any vararg method depending order which reflected methods encountered test public void test join assert assert equals foo join foo bar baz bean elresolver invoke el context foo join null new object foo bar baz
null input throw new zip exception sm get string expand war missing jar entry jar entry get name
protect against memory leak caused when code sun java2d disposer code class loaded web application defaults code false code because new thread launched private boolean java2d disposer protection false public boolean protection return java2d disposer protection public void set protection boolean java2d disposer protection java2d disposer protection java2d disposer protection trigger creation java2d disposer thread see https issues apache org bugzilla show bug cgi id 51687 java2d disposer protection try class name sun java2d disposer catch class found exception cnfe ignore case we must running non sun based jre attribute name protection required false enables protection so loading code sun java2d disposer code class web application does result memory leak defaults code false code because thread launched attribute
private string ssl name null public string get ssl name return ssl name public void set ssl name string ssl name ssl get instance ssl name connector set property ssl name attribute name ssl name required false
wakeup counter get else key count selector keys size wakeup counter set
swallow unread body packet present first request get content length long receive usually servlet didn read previous request body log debug enabled log debug unexpected message type continue usually servlet didn read previous request body log debug enabled log debug unexpected message type error true continue usually servlet didn read previous request body log debug enabled log debug unexpected message type continue
saved set method get saved set method get
request secure timeout rpc messages private long rpc timeout default repl timeout
default repl timeout public void set rpc timeout long rpc timeout rpc timeout rpc timeout public long get rpc timeout return rpc timeout result rpc timeout rpc timeout attribute name rpc timeout description timeout rpc messages how long we wait reply type long destination channel get members length return int resp length map member added resp get source message received resp get message resp get source
dir exists dir mkdirs resource file get parent file mkdirs class repository directory class repository mkdirs throw new ioexception sm get string webapp loader mkdir failure dest dir directory dest dir mkdirs throw new ioexception sm get string webapp loader mkdir failure deployed path directory deployed path mkdirs config base directory config base mkdirs app base file exists app base file mkdirs writer println sm client get string host manager servlet app base create fail app base file string name return config base exists config base mkdirs return null dir mkdirs debug log expand cgiscript failed create directories dir get absolute path private file directory file delete file mkdirs private file file string id parent mkdirs dirs directory dirs mkdirs dir exists dir mkdirs log error sm get string access log valve open dir fail dir parent exists parent mkdirs log error sm get string access log valve open dir fail parent return out dir file exists out dir file mkdirs dir exists dir mkdirs parent exists parent mkdirs report error unable create parent null error manager open failure writer null return foo exists foo mkdirs foo exists foo mkdirs doc base exists doc base mkdirs web inf mkdirs web inf mkdirs temp dir exists temp dir mkdirs
ctx set manager new standard manager simple servlet test line registration simple servlet test default session manager public static class hello world session extends http servlet private static final long serial version uid 1l override public void do get http servlet request req http servlet response res throws ioexception http session req get session true get id res get writer write hello world public void test session throws exception tomcat tomcat get tomcat instance must have real doc base just use temp org apache catalina context ctx tomcat add context system get property java io tmpdir you can customize context calling its api tomcat add servlet ctx my servlet new hello world session ctx add servlet mapping my servlet tomcat start byte chunk res get url http localhost get port assert equals hello world res string test
log error sm get string coyote connector protocol handler failed
-1
socket get socket long value socket get socket long value socket get socket long value protected long server pollset protected long pool protected long desc protected long add protected volatile int add count protected boolean comet true create poller some versions apr maximum poller size 62 recompiling apr necessary remove limitation int timeout get keep alive timeout timeout timeout socket properties get so timeout server pollset allocate poller size pool timeout server pollset size 1024 server pollset allocate poller size pool timeout server pollset server pollset allocate poller size pool timeout add new long size process socket add socket status stop destroy socket add close all sockets still poller int rv poll pollset server pollset desc rv int rv comet process socket desc socket status stop else destroy socket desc private void close pollset long pollset int rv poll pollset pollset desc rv int rv comet process socket desc socket status stop else destroy socket desc public void add long socket add count add length add add count socket int rv poll add server pollset add poll apr pollin process socket add socket status error destroy socket add pool specified interval int rv poll poll server pollset poll time desc true rv keep alive count rv int rv check failed sockets hand socket off worker desc poll apr pollhup poll apr pollhup desc poll apr pollerr poll apr pollerr comet process socket desc socket status open comet process socket desc close socket clear pool comet process socket desc socket status disconnect else destroy socket desc continue else rv int errn rv any non timeup interrupted error critical errn status timeup errn status eintr errn status apr os start usererr errn status apr os start usererr log error sm get string endpoint poll fail errn error strerror errn handle poll critical failure synchronized destroy init continue socket properties get so timeout maintain time 1000000l running rv poll maintain server pollset desc true rv keep alive count rv int rv close socket clear pool comet process socket desc socket status timeout else destroy socket desc worker inner class get poller add state socket get poller add socket get socket long value
context request mapping data context log access
app base directory log error sm get string host config app base host get name app base get path host set deploy startup false host set auto deploy false
param encoding encoding use null default encoding used unsupported encoding specified parameters given string so encoding lost encoding specified let use platform default encoding null bytes data get bytes charset default charset else bytes data get bytes b2cconverter get charset encoding
buf append buf append buf append buf append buf append buf append stacktrace err msg buf append
strip off hostname contextpath context instanceof proxy dir context equals proxy dir context context get context path start file index else
code com sun jndi ldap ldap pool manager code class spawns thread when initialized system property first call loads all drivers current class loader driver manager protection driver manager get drivers attribute name driver manager protection required false first use code java sql driver manager code trigger loading jdbnc driver current class loader web application level memory leak protection can take care most cases triggering loading here has fewer side effects default code true code attribute
http11nio processor processor connections remove socket
connection connection driver connect driver url properties
catch lifecycle exception throw catch lifecycle exception throw catch lifecycle exception throw catch lifecycle exception throw
try manager find session keys null loaded true catch ioexception ioe ignore session expired
private access log element create access log element string header char pattern private access log element create access log element char pattern
catch throwable exception utils handle throwable log warn sm get string context config invalid sci handles types class name return fix bug 51586 bug expand error handling cover anything recoverable might recoverable when loading classes during handles types processing markt fix public abstract boolean parse request line boolean use available data only throws ioexception public abstract boolean parse headers throws ioexception protected abstract boolean fill boolean block throws ioexception constants constructors variables instance variables
public abstract boolean parse request line boolean use available data only throws ioexception public abstract boolean parse headers throws ioexception protected abstract boolean fill boolean block throws ioexception constants else http token char buf pos non token header detected skip line ignore header skip line start return true private void skip line int start throws ioexception boolean eol false int last real byte start pos start last real byte pos while eol read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants cr skip else buf pos constants lf eol true else last real byte pos pos log debug enabled log debug sm get string iib new string buf start last real byte start charset name iso 8859 private static final log log log factory get log internal input buffer class else http token char buf pos non token header detected skip line ignore header skip line start return true logger enum header parse position header start header name header value header multi line else http token char buf pos non token header detected skip line ignore header return skip line while header parse pos header parse position header skipline return skip line private header parse status skip line throws ioexception header parse pos header parse position header skipline boolean eol false reading bytes until end line while eol read new bytes needed pos last valid fill true false return header parse status need more data buf pos constants cr skip else buf pos constants lf eol true else header data last significant char pos pos log debug enabled log debug sm get string iib new string buf header data start header data last significant char header data start default charset header parse pos header parse position header start return header parse status have more headers test public void test bug51557no colon client new bug51557no colon client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test throws exception char http separators new char char http separators do test bug51557char tear down set up test public void test bug51557ctl throws exception int 31 do test bug51557char char tear down set up do test bug51557char char 127 test public void test client new bug 51557no colon foo simple http client crlf bar client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test start client new bug51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok test public void test end client new bug51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok private void do test bug51557char char client new bug 51557 invalid client set port get port client do request assert true client response200 assert equals abcd client get response body assert true client response body ok bug 51557 test client private class extends simple http client private string header name private string header line public string header name header name header name header line header name public string header name string header value header name header name header line header name header value private exception do request tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root bug51557 new header name root add servlet mapping test bug51557 try tomcat start open connection connect string request new string request get http localhost 8080 test http crlf header line crlf bug51557 abcd crlf connection close crlf crlf set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok get response body null return false get response body contains abcd return false return true private static class extends http servlet private static final long serial version uid 1l private string invalid header name param invalid header name header name should invalid therefore ignored header parsing code public string invalid header name invalid header name invalid header name only interested request headers from get request override protected void do get http servlet request req http servlet response resp throws servlet exception ioexception just echo header value back plain text resp set content type text plain print writer out resp get writer process headers invalid header name req out process headers bug51557 req out private void process headers string header http servlet request req print writer out enumeration string values req get headers header while values has more elements out println values next element fix bug 51557 bug ignore http headers do comply rfc 2616 use header names tokens markt fix li code threadname code current request thread name can compare later stacktraces li
move set characater encoding filter from examples web application li current request thread name can compare later stacktraces li init new initializing auto start auto auto stop initialized starting prep starting started start auto auto must stop auto auto start stopping prep stopping stopped stop auto must destroy auto destroy destroy failed destroying destroy auto todo all components may transition from stopped starting prep
state equals lifecycle state new
sm get string response base reset ise sm get string response base reset ise sm get string response base reset ise sm get string response base reset ise sm get string response base reset ise sm get string response base reset ise public static final int ssl protocol all ssl protocol sslv2 ssl protocol sslv3 ssl protocol tlsv1
-1
url include url ctxt get resource include get key
cache put key null return cache contains key key
digester add call method full prefix absolute ordering name others
socket sendbb socket ref output buffer position explicit finished
validate settings before starting get port throw new lifecycle exception sm get string coyote connector invalid port integer value get port tomcat port shutdown message box mb mb ok shutdown port may empty abort config right goto exit end tomcat port http message box mb mb ok http port may empty abort config right goto exit end tomcat port ajp message box mb mb ok ajp port may empty abort config right goto exit end fix bug 51503 bug add additional validation prevents connector from starting does have port markt fix changelog subsection subsection changelog fix bug 51503 bug add additional validation windows installer ensure shutdown port http port ajp port all specified during install process markt fix
tcn full version public static int tcn full version tcn full version tcn major version 1000 tcn minor version 100 tcn patch version int value ssl ssl protocol all sslv2 equals ignore case sslprotocol value ssl ssl protocol sslv2 else sslv3 equals ignore case sslprotocol value ssl ssl protocol sslv3 else tlsv1 equals ignore case sslprotocol value ssl ssl protocol tlsv1 else sslv2 sslv3 equals ignore case sslprotocol value ssl ssl protocol sslv2 ssl ssl protocol sslv3 else all equals ignore case sslprotocol sslprotocol null sslprotocol length noop use default defined above protocol recognized fail start safer than continuing default which might enable more than required throw new exception sm get string endpoint apr invalid ssl protocol sslprotocol library native apr connector used native library native apr connector has different settings https than all other acceptable values being sslv2 sslv3 tlsv1 sslv2 sslv3
return character set name used write log file return character set name code null code system default character set used public string get encoding return encoding set character set used write log file param encoding name character set public void set encoding string encoding encoding null encoding length encoding encoding else encoding null writer new print writer new buffered writer new file writer pathname true 128000 false
context fire request destroy event request
todo fix create growing buffer param data byte return byte byte array output stream bout new byte array output stream int length gin read tmp byte result new byte length system arraycopy tmp result length return result public void test basic throws exception byte data new byte 1024 arrays fill data byte fix me package javax removed prevent hot spot fatal internal errors
definition security set property properties fix me package javax removed prevent hot spot fatal internal errors definition package list
run
don start host already started start host specified name prevent starting our own host don stop host already stopped
auth required auth required
catch parse exception pe throw new elexception error parsing expr pe
found response found response found response acknowledge request try response send catch ioexception ioe container get logger error sm get string standard context valve acknowledge exception ioe request set attribute request dispatcher error exception ioe error response http servlet response sc internal server error return report found error specified resource fixme we private void found http servlet response response response send error http servlet response sc found acknowledge request try response send catch ioexception container get logger warn sm get string standard wrapper acknowledge exception wrapper get name throwable exception request response catch throwable exception utils handle throwable container get logger error sm get string standard wrapper acknowledge exception wrapper get name throwable exception request response servlet null protected static final string manager sm string manager get manager constants package
check check check check check check check check check check context null dispatch null event null has original request response true instance manager null listeners clear request null has original request response true context null event null check check check private void check request null async context has been recycled should being used throw new illegal state exception sm get string async context impl request ended
string manager sm client throws ioexception cn null cn get path starts cn get path equals string path null cn null path cn get path throw new illegal argument exception sm client get string manager servlet invalid path request util filter path context ctxt context host find child cn get name null ctxt throw new illegal argument exception sm client get string manager servlet context request util filter cn get display name session session ctxt get manager find session id return session private map string list string user roles new hash map string list string private map string principal user principals new hash map string principal
return listener provides required items jsp processing from standard tomcat global web xml pass link context add lifecycle listener lifecycle listener pass result link default web xml path link context config set default web xml string return listener object configures default jsp processing public lifecycle listener get default web xml listener return new default web xml listener return pathname pass link context config set default web xml string when using link get default web xml listener public string default web xml path return org apache catalin startup default xml complex accessor allows callers class obtain simple realm created default return simple memory realm created default public realm get default realm default realm null init simple auth return default realm add bug 51418 bug provide more control over context creation when embedding tomcat based patch benson margulies markt add
ignore protected set session config session config protected set login config login config protected set jsp config jsp config
session config new set session config jsp config new set jsp config login config new set login config
map string string jsp init params jsp servlet null jsp init params new hash map string string wrapper wrapper context find child jsp null string params find init parameters string param params jsp init params put param find init parameter param else jsp init params jsp servlet get parameter map convert jsp servlet def jsp servlet private void convert jsp servlet def servlet def servlet def jsp servlet def map entry string string init param jsp servlet def get parameter map entry set public void test bug51396 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp fragments app dir relative server home tomcat add webapp null test app dir get absolute path tomcat start byte chunk bc new byte chunk int rc get url http localhost get port test bug51396 jsp bc null assert equals http servlet response sc ok rc assert true bc string contains ok bug 51396 servlet servlet name bug51396 servlet name jsp file bug51396 jsp jsp file servlet licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body ok body fix bug 51396 bug correctly handle jsp file entries web xml when jsp servlet has been configured via code when embedding tomcat markt fix li format date time any format supported simple date format
org apache catalina valves access log valve size our global date format cache private static final int global cache size 300 size our thread local date format cache private static final int local cache size 60 private static class access date struct private date current date new date private string current date string null private simple date format day formatter new simple date format dd private simple date format month formatter new simple date format mm private simple date format year formatter new simple date format yyyy private simple date format time formatter new simple date format hh mm ss public access date struct time zone tz time zone get default day formatter set time zone tz month formatter set time zone tz year formatter set time zone tz time formatter set time zone tz private static final thread local access date struct current date struct new thread local access date struct protected access date struct initial value return new access date struct list our format types private static enum format type clf sec msec msec frac sdf date date get date private date get date only create new date once per second max long systime system current time millis access date struct struct current date struct get systime struct current date get time 1000 struct current date set time systime struct current date string null return struct current date date stamp file date formatter format current date struct get current date write date time common log format format prefix specifying request start time private static final string request start prefix begin format prefix specifying response end time private static final string response end prefix end separator between optional prefix rest format private static final string prefix separator special format seconds since epoch private static final string sec format sec special format milliseconds since epoch private static final string msec format msec special format millisecond part timestamp private static final string msec fraction format msec frac pattern we use replace millisecond formatting simple date format our own handling private static final string msec pattern our format description string null clf private string format null whether use begin request end response timestamp private boolean uses begin false format type private format type type format type clf whether we need postprocess adding milliseconds private boolean uses msecs false protected date time element null replace millisecond formatting character some dummy characters order make resulting formatted time stamps cacheable we replace dummy chars later actual milliseconds because relatively cheap private void tidy format boolean escape false string builder result new string builder int len format length char int len format char escape result append else result append msec pattern uses msecs true escape escape format result string protected date time element string header format header format null format equals request start prefix uses begin true format else format starts request start prefix prefix separator uses begin true format format substring else format equals response end prefix uses begin false format else format starts response end prefix prefix separator uses begin false format format substring format length type format type clf else format equals sec format type format type sec else format equals msec format type format type msec else format equals msec fraction format type format type msec frac else type format type sdf tidy format access date struct struct current date struct get struct current date string null string builder current new string builder 32 current append current append struct day formatter format date current append current append lookup struct month formatter format date current append current append struct year formatter format date current append current append struct time formatter format date current append current append get time zone date current append struct current date string current string buf append struct current date string case return new date time element header fix bug 49165 bug allow any time stamp formats supported simple date format access log valve support logging begin end request rjung fix
match false public void test check handle types throws exception context config config new context config need context loader class loader check handle types standard context context new standard context context set loader new tester loader config context context add sci has interest any type sci sci none new sci config initializer class map put sci none new hash set class add sci interest servlets sci sci servlet new sci config initializer class map put sci servlet new hash set class config type initializer map put servlet class new hash set servlet container initializer config type initializer map get servlet class add sci servlet add sci interest objects everything sci sci object new sci config initializer class map put sci object new hash set class config type initializer map put object class new hash set servlet container initializer config type initializer map get object class add sci object scan servlet filter servlet listener web xml ignore new web xml file file param class resource org apache catalina startup param servlet config process annotations file file ignore file param class resource org apache catalina startup param filter config process annotations file file ignore file param class resource org apache catalina startup tester servlet config process annotations file file ignore file param class resource org apache catalina startup test listener config process annotations file file ignore check right number classes were noted handled assert equals config initializer class map get sci none size assert equals config initializer class map get sci servlet size assert equals config initializer class map get sci object size private static final class sci implements servlet container initializer override public void startup set class servlet context ctx throws servlet exception op just need class implements sci private static final class tester loader implements loader override public void background process override public class loader get class loader return get class get class loader override public container get container return null override public void set container container container override public boolean get delegate return false override public void set delegate boolean delegate override public string get info return null override public boolean get reloadable return false override public void set reloadable boolean reloadable override public void add property change listener property change listener override public void add repository string repository override public string find repositories return null override public boolean modified return false override public void remove property change listener property change listener fix bug 51386 bug correct code processing handles types annotations so only types interest reported servlet container initializer markt fix
int val2len val2 length val2len val2 char val2 char val2len treat regular expression string expr val2 substring val2len pattern pattern pattern compile expr regular expressions only ever used equal node so return zero equal non zero equal pattern matcher val1 find return else return bug 48956 bug add regular expression support ssi markt add add td colspan class title td
args new object args sm get string html manager servlet server hostname args sm get string html manager servlet server ipaddress args new object try inet address address inet address get local host args address get host name args address get host address catch unknown host exception args args args new object args sm get string html manager servlet server hostname args sm get string html manager servlet server ipaddress args new object try inet address address inet address get local host args address get host name args address get host address catch unknown host exception args args add bug 43538 bug add host name ip address html manager application patch dennis lundberg markt add
session set max inactive interval get max inactive interval expired id null manager null
least one tokens locks must have been given token list renew tokens elements while token list has more elements string token token list next element header index token renew expires lock expires lock renew
lifecycle event support component protected lifecycle support lifecycle new lifecycle support add lifecycle event listener component param listener listener add override public void add lifecycle listener lifecycle listener listener lifecycle add lifecycle listener listener get lifecycle listeners associated lifecycle lifecycle has listeners registered zero length array returned override public lifecycle listener find lifecycle listeners return lifecycle find lifecycle listeners remove lifecycle event listener from component param listener listener remove override public void remove lifecycle listener lifecycle listener listener lifecycle remove lifecycle listener listener bug 51249 bug further improve system property replacement code class loader log manager tomcat juli cover some corner cases kkolinko
web rule set rule set rule set web fragment rule set rule set web rule set synchronized digester fragment web fragment rule set recycle else web rule set recycle
do flush false do flush true initial coyote response send headers initial false bb get length bb flush buffer do flush false properties context path web application we managing protected string path null public string get path return path public void set path string path path path public methods
path null throw new build exception must specify path attribute try execute reload path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset properties context path web application we managing protected string path null public string get path return path public void set path string path path path public methods path null throw new build exception must specify path attribute try execute sessions path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset properties context path web application we managing protected string path null public string get path return path public void set path string path path path public methods path null throw new build exception must specify path attribute try execute start path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset properties context path web application we managing protected string path null public string get path return path public void set path string path path path public methods path null throw new build exception must specify path attribute try execute stop path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset properties context path web application we managing protected string path null public string get path return path public void set path string path path path public methods path null throw new build exception must specify path attribute try execute undeploy path urlencoder encode path get charset catch unsupported encoding exception throw new build exception invalid charset attribute get charset
jar input stream jar input stream null jar jar conn jar url open connection url resource url jar conn get jar file url resource conn resource url open connection resource conn set use caches false jar input stream new jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null sci location equals entry get name break entry jar input stream get next jar entry entry null jar input stream jar input stream null try jar input stream close catch ioexception ignore jar input stream jar input stream null jar jar conn jar url open connection url resource url jar conn get jar file url resource conn resource url open connection resource conn set use caches false jar input stream new jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null meta inf resources equals entry get name break entry jar input stream get next jar entry entry null jar input stream null try jar input stream close catch ioexception ignore jar input stream jar input stream null url conn url open connection jar jar conn url conn instanceof jar should never happen sm get string context config jar url url return jar conn jar url conn jar conn set use caches false url resource url jar conn get jar file url resource conn resource url open connection jar input stream new jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null string entry name entry get name null process annotations stream jar input stream fragment finally null try close catch ioexception ioe ignore entry jar input stream get next jar entry jar input stream null try jar input stream close catch throwable exception utils handle throwable jar get jar file creates temporary copies jar underlying resource file url can slow so input stream resource used jar input stream jar input stream null resource conn resource url open connection resource conn set use caches false jar input stream new jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null fragment location equals entry get name break entry jar input stream get next jar entry entry null source set byte stream jar input stream jar input stream null jar input stream close catch throwable exception utils handle throwable fragment set url jar conn get url jar get jar file creates temporary copies jar underlying resource file url can slow so input stream resource used url resource url jar conn get jar file url non closing jar input stream jar input stream null string name null resource conn resource url open connection resource conn set use caches false jar input stream new non closing jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null name entry get name name starts meta inf name ends tld xml error handler handler tld scan stream jar input stream handler log findings log jar conn get url name entry jar input stream get next jar entry log warn sm get string tld config jar fail jar conn get url name ioe jar input stream null try jar input stream really close catch throwable exception utils handle throwable jar get jar file creates temporary copies jar underlying resource file url can slow so input stream resource used non closing jar input stream jar input stream null boolean found tld false resource conn resource url open connection resource conn set use caches false jar input stream new non closing jar input stream resource conn get input stream jar entry entry jar input stream get next jar entry while entry null string name entry get name name starts meta inf name ends tld found tld true tld scan stream resource path name jar input stream entry jar input stream get next jar entry jar input stream null try jar input stream really close catch throwable exception utils handle throwable licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link jar optimised file based jar urls urls form jar file private jar file jar file private enumeration jar entry entries private jar entry entry null public file url jar url url throws ioexception jar jar conn jar url open connection jar file jar conn get jar file override public boolean entry exists string name zip entry entry jar file get entry name return entry null override public input stream get input stream string name throws ioexception zip entry entry jar file get entry name entry null return null else return jar file get input stream entry override public void close jar file null try jar file close catch ioexception ignore override public void next entry entries null entries jar file entries entries has more elements entry entries next element else entry null override public string get entry name entry null return null else return entry get name override public input stream get entry input stream throws ioexception entry null return null else return jar file get input stream entry override public void reset throws ioexception entries null entry null licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provides abstraction use various classes need scan jars classes provided jre accessing jars link jar file link jar input stream have different performance depending form url used access jar file based jar link url link jar file faster non file based link url link jar file creates copy jar temporary directory so link jar input stream faster determines specific entry exists within jar param name entry look return code true code specified entry exists else code false code boolean entry exists string name throws ioexception obtain link input stream given entry jar caller responsible closing stream param name entry obtain link input stream return link input stream specified entry null entry does exist input stream get input stream string name throws ioexception close any resources associated jar void close moves internal pointer next entry jar void next entry obtains name current entry return entry name string get entry name obtains input stream current entry return input stream throws ioexception stream cannot obtained input stream get entry input stream throws ioexception resets internal pointer used track jar entries beginning jar throws ioexception pointer cannot reset void reset throws ioexception licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license provide mechanism obtain objects implement link jar private jar factory factory class hide public constructor public static jar new instance url url throws ioexception string jar url url string jar url starts jar file return new file url jar url else return new url jar url licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license link jar optimised non file based jar urls jndi based urls form jar jndi private non closing jar input stream jar input stream null private url url null private jar entry entry null public url jar url url throws ioexception url url jar input stream create jar input stream override public boolean entry exists string name throws ioexception jar entry entry jar input stream get next jar entry while entry null name equals entry get name break entry jar input stream get next jar entry return entry null override public input stream get input stream string name throws ioexception jar entry entry jar input stream get next jar entry while entry null name equals entry get name break entry jar input stream get next jar entry entry null return null else return jar input stream override public void close jar input stream null try jar input stream really close catch ioexception ioe ignore private non closing jar input stream create jar input stream throws ioexception jar jar conn jar url open connection url resource url jar conn get jar file url resource conn resource url open connection resource conn set use caches false return new non closing jar input stream resource conn get input stream override public void next entry try entry jar input stream get next jar entry catch ioexception ioe entry null override public string get entry name entry null return null else return entry get name override public input stream get entry input stream throws ioexception return jar input stream override public void reset throws ioexception close jar input stream create jar input stream bug 51276 bug provide abstraction accessing content jars so most efficient method can selected depending type url used identify jar improves startup time when jars located catalina base lib mark fix fix
string login page config get login page login page null login page length string msg sm get string form login page context get name log warn msg response send error http servlet response sc internal server error msg return context get servlet context get request dispatcher config get login page string error page config get error page error page null error page length string msg sm get string form error page context get name log warn msg response send error http servlet response sc internal server error msg return fix bug 51277 bug improve error message application deployed incomplete form markt fix private volatile counter latch connection counter latch null
public void set max connections int max con max connections max con protected counter latch initialize connection latch connection counter latch null connection counter latch new counter latch get max connections return connection counter latch counter latch latch connection counter latch connection counter latch null protected void await connection throws interrupted exception counter latch latch connection counter latch latch null latch await protected long count up connection counter latch latch connection counter latch latch null return latch count up else return counter latch latch connection counter latch await connection increment socket count count up connection await connection else count up connection await connection else count up connection licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license simple counter latch allows code keep up down counter waits while latch holds certain wait value threads using latch wait count has reached certain value counter latch can used keep track atomic counter since operations link count down link count up atomic when latch reaches wait value threads block counter latch can hence act like count down latch count up latch while letting you keep track counter well counter latch works opposite java util concurrent count down latch since counter latch only blocks single value releases threads all other values author fhanik see href http download oracle com javase docs api java util concurrent count down latch html count down latch private class sync extends abstract queued synchronizer private static final long serial version uid 1l public sync override protected int try acquire shared int arg return released count get signal override protected boolean try release shared int arg return true private final sync sync private final atomic long count private volatile long signal private volatile boolean released false instantiates counter latch object initial value wait value param initial initial value counter param wait value when counter holds value threads calling link await link await long time unit wait until counter changes value until interrupted public counter latch long initial long wait value signal wait value count new atomic long initial sync new sync causes calling thread wait counter holds wait value counter holds any other value thread return thread interrupted becomes interrupted interrupted exception thrown throws interrupted exception public void await throws interrupted exception sync acquire shared causes calling thread wait counter holds wait value counter holds any other value thread return thread interrupted becomes interrupted interrupted exception thrown return true value changed false timeout has elapsed throws interrupted exception public boolean await long timeout time unit unit throws interrupted exception return sync try acquire shared nanos unit nanos timeout increments counter return previous counter value public long count up long previous count get increment previous signal sync release shared return previous decrements counter return previous counter value public long count down long previous count get decrement previous signal sync release shared return previous returns current counter value return current counter value public long get count return count get performs atomic update counter operation successful code expect wait value expect update waiting threads released param expect expected counter value param update new counter value return code true code successful code false code current value wasn expected public boolean compare set long expect long update boolean result count compare set expect update result expect signal expect update sync release shared return result returns true threads blocked latch return true threads blocked latch public boolean has queued threads return sync has queued threads returns collection blocked threads return collection blocked threads public collection thread get queued threads return sync get queued threads releases all waiting threads operation permanent threads block even counter hits code wait value until link reset long has been called return code true code release shared mode may permit waiting acquire shared exclusive succeed code false code otherwise public boolean release all released true return sync release shared resets latch initializes counter new value param value new counter value see release all public void reset long value count set value released false licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private volatile counter latch latch null override public void tear down counter latch temp latch temp null temp release all latch null public void test threads throws exception latch new counter latch assert equals threads should waiting false latch has queued threads public void test one thread wait throws exception latch new counter latch assert equals threads should waiting false latch has queued threads thread test thread new thread override public void run try latch await catch interrupted exception print stack trace test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch count up thread sleep 50 assert equals threads should waiting false latch has queued threads public void test one thread wait count up throws exception latch new counter latch assert equals threads should waiting false latch has queued threads thread test thread new thread override public void run try latch await catch interrupted exception print stack trace latch count up test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch count up thread sleep 50 assert equals threads should waiting false latch has queued threads public void test one thread wait count down throws exception latch new counter latch assert equals threads should waiting false latch has queued threads thread test thread new thread override public void run try system out println entering thread current thread get name latch await catch interrupted exception print stack trace system out println exiting thread current thread get name latch count down test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch count down thread sleep 50 assert equals threads should waiting false latch has queued threads public void test one release throws exception latch new counter latch assert equals threads should waiting false latch has queued threads thread test thread new thread override public void run try latch await catch interrupted exception print stack trace latch count down test thread start thread sleep 50 assert equals threads should waiting latch get queued threads size latch release all thread sleep 50 assert equals threads should waiting false latch has queued threads licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license ant task implements code findleaks code command supported tomcat manager application private boolean status line true sets status line parameter controls response includes status line public void set status line boolean status line status line status line returns status line parameter controls response includes status line public boolean get status line return status line execute requested operation exception build exception error occurs override public void execute throws build exception super execute execute findleaks status line boolean string status line
super findleaks print writer sm client string writer get buffer length msg append sm client get string html manager servlet findleaks list msg append string writer string boolean status line false true equals request get parameter status line status line true findleaks writer sm client protected void findleaks print writer writer string manager sm client string result results equals result result writer println result
ie protected boolean secure pages pragma true fixme disabled mozilla form support over ssl improper caching issue request secure fixme cause problems downloading office docs from ie under ssl may needed newer mozilla clients set default value code true code used set default value code true code used set default value code true code used set default value code true code used set default value code true code used
public synchronized connection pool create pool throws sqlexception
dirs exists dirs mkdirs private static final boolean pool tags extends boolean get boolean org apache jasper compiler generator var
page info get extends false null fix bug 51229 bug fix bugs servlet asynchronous examples patch provided eiji takahashi markt fix
req get async context complete href response encode url examples async stock stock ticker
private int nr invocations private long max invocation time long min value private long max invocation date private long min invocation time long max value private long min invocation date private long total invocation time private long failures private int prepare count private long prepare time
definitions add property new interceptor property prop name prop value
td class row left bgcolor 13 rowspan tr tr tr deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated
-1
-1
add delta request delta request null delta request set attribute name value add delta request delta request null delta request remove attribute name
lc new login context login config name gssmanager manager gssmanager get instance gss context manager create context manager create credential null default lifetime new oid accept only store delegated credential response send error http servlet response sc unauthorized return false catch privileged action exception log error sm get string spnego service login fail response set header www authenticate negotiate fix bug 51099 bug correctly implement non default login configured via login config name attribute spnego fhanik markt fix protected string login module name null
login module name system get property com sun management jmxremote login config env put jmx remote login config login module name bug 51119 bug add jaas support jmxremote lifecycle listener patch provided neil laurance markt add add
buffer size constants default tag buffer size cb new char buffer size buffer size constants default tag buffer size cb new char buffer size buffer size cb length len char tmp new char buffer size tmp null
return add context host context path context path dir public context add context host host string context path string context name string dir ctx set path context path return add webapp host url url path public context add webapp host host string url string name string path ctx set path url
return fix bug 51095 bug don apos trigger null pointer exception when ssl handshake fails http apr connector patch provided mike glazer markt fix
else all equals ignore case sslprotocol sslprotocol null sslprotocol length noop use default defined above else protocol recognized fail start safer than continuing default which might enable more than required throw new exception sm get string endpoint apr invalid ssl protocol sslprotocol fix bug 51073 bug throw exception do start apr connector configured ssl invalid value provided sslprotocol markt fix set session identifier session
notify session listeners replication session set id msg get session id else session set id internal msg get session id add session notify session listeners replication session set id new session id else session set id internal new session id add session set session identifier session without notify listeners param id new session identifier public void set id internal string id id id fixme set id trigger session listener only chance register manager correct id catalina session set id new session id public void set id string id boolean notify session id id ignore notify override session set id generate session id set id id true inherit doc override public void set id string id boolean notify tell new
context request get mapping data context log access request response system current time millis req get start time false time request process need allow threads start etc private static final long request time 500 timeout thread where used checks timeout every second private static final long timeout margin 1000 tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries assert equals 200 entry get status assert true entry string entry get time async start complete servlet async timeout assert true entry string entry get time async start complete servlet async timeout timeout margin request time tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time request time public static final long thread sleep time 1000 thread sleep 1000 public static final long thread sleep time 1000 thread sleep 1000 public static final long async timeout 1000 actxt set timeout 1000 tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time timeout servlet async timeout assert true entry string entry get time timeout servlet async timeout timeout margin request time public static final long async timeout 3000 ac set timeout 3000 tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time assert true entry string entry get time request time tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time timeout servlet async timeout assert true entry string entry get time timeout servlet async timeout timeout margin request time tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time assert true entry string entry get time request time error servlet error new error servlet tomcat add servlet ctx error error ctx add servlet mapping stage2 error check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time async start runnable thread sleep time assert true entry string entry get time async start runnable thread sleep time request time public static final long thread sleep time 3000 thread sleep 1000 tester access log valve alv new tester access log valve ctx get pipeline add valve alv check access log list entry entries alv get entries assert equals entries size entry entry entries get assert equals 200 entry get status assert true entry string entry get time thread sleep time assert true entry string entry get time thread sleep time request time public static final long thread sleep time 5000 thread sleep 5000
web xml fragment null fragment new web xml fragment null fragments put file uri url string fragment else fragment set url file uri url fragment get name null fragment set name fragment get url string fragments put fragment get name fragment fragments put fragment get name fragment else scan all directories int start path last index name path substring start fix bug 50997 bug relax requirement directories must have name ending code jar code treated expanded jar file default jar scanner based patch rodion zhitomirsky markt fix
file null required throw new exception sm get string endpoint apr ssl cert file bug 50927 bug improve error message when file specified when using apr ssl based patch provided sebb markt fix fix
throw new illegal argument exception get message throw new illegal argument exception get message throw new runtime exception get message throw new runtime exception get message throw new runtime exception get message throw new runtime exception get message throw new runtime exception get message throw new sqlexception get message throw new sqlexception get message throw new ioexception get message throw new saxexception get message throw new saxexception get message throw new saxexception get message throw new saxexception get message fix make root cause exception available jsse ssl fails patch provided sebb markt fix
endpoint paused 503 service unavailable response set status 503 adapter log request response error true break request set start time system current time millis kept alive true disable upload timeout socket timeout set socket ref connection upload timeout 1000 input buffer parse headers break kept alive true input buffer parse headers we ve read part request don recycle instead associate socket open socket true recycle false break request set start time system current time millis disable upload timeout only body request headers socket get iochannel socket set so timeout connection upload timeout request set start time system current time millis kept alive true disable upload timeout socket get socket set so timeout so timeout socket get socket set so timeout connection upload timeout input buffer parse headers return get url path out 1000000 req head res head public static int get url string path byte chunk out int read timeout map string list string req head map string list string res head throws ioexception connection set read timeout 1000000 private static final log log log factory get log sslvalve class
string provider name string request get connector get property client cert provider certificate factory cf certificate factory get instance 509 catch provider exception log error sm get string ssl valve invalid provider provider name when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider certificate factory cf certificate factory get instance 509 catch provider exception get log error sm get string ajpprocessor certs fail return processor set client cert provider proto get client cert provider processor set client cert provider proto get client cert provider when client certificate information presented form other than instances link java security cert needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors http apr connector link org apache catalina valves sslvalve specified default provider used protected string client cert provider null public string get client cert provider return client cert provider public void set client cert provider string client cert provider certificate factory cf certificate factory get instance 509 processor set client cert provider proto get client cert provider subsection name coyote changelog add bug 50887 bug add support configuring jsse provider used convert client certificates based patch pknopp markt add changelog subsection attribute name client cert provider required false when client certificate information presented form other than instances code java security cert code needs converted before can used property controls which jsse provider used perform conversion example used ajp connectors href http html http apr connector href valve html ssl valve org apache catalina valves sslvalve specified default provider used attribute attribute name client cert provider required false when client certificate information presented form other than instances code java security cert code needs converted before can used property controls which jsse provider used perform conversion example used href ajp html ajp connectors http apr connector href valve html ssl valve org apache catalina valves sslvalve specified default provider used attribute
clazz class name class name true tccl
currently effectively op needs called ensure naming resources follows correct lifecycle binding thread class loader old ccl bind thread clean up close those resources explicit close may help clean up faster private void clean up resources size return javax naming context ctxt try container instanceof server ctxt server container get global naming context else ctxt context bindings get class loader ctxt javax naming context ctxt lookup comp env catch naming exception log warn sm get string naming resources cleanup context container return context resource cr resources values data source class get name equals cr get type string name cr get name data source ds try ds data source ctxt lookup name catch naming exception log warn sm get string naming resources cleanup resource cr get name container continue clean up ds name fix fix fix fix
new dir context urlstream handler factory public static final string protocol handler variable java protocol handler pkgs default namespace name public static final string default namespace dav factory stream handlers jndi directory context implements urlstream handler factory constructors public dir context urlstream handler factory noop instance variables properties urlstream handler factory methods urlstream handler factory factory user factories urlstream handler handler factory create urlstream handler protocol handler null return handler licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test user supplied factory throws exception url url null initially unknown try url new url foo www apache org catch malformed urlexception ignore ignore assert null url set factory url set urlstream handler factory dir context urlstream handler factory get instance still unknown try url new url foo www apache org catch malformed urlexception ignore ignore assert null url register user factory dir context urlstream handler factory add user factory new foo urlstream handler factory now works try url new url foo www apache org catch malformed urlexception ignore ignore assert null url public static class foo urlstream handler factory implements urlstream handler factory override public urlstream handler create urlstream handler string protocol foo equals protocol good enough test actual use return new dir context urlstream handler else return null bug 26701 bug provide mechanism users register own code urlstream handler factory code objects markt fix fix
log debug enabled log debug principal get name type auth type
pooled connection pc borrow connection null null pc null return new connection future pc
throw new file found exception throw new file found exception throw new file found exception throw new file found exception
bean bean execute jmxproxy get bean att attribute string query string query null qry query execute jmxproxy set bean att attribute val value execute resources type type execute undeploy path path
system set property name value valid state transitions components support lifecycle stop must destroy get lifecycle listeners associated lifecycle lifecycle has listeners registered zero length array returned prepare beginning active use public methods component method should called before any public methods component utilized following link lifecycle event fired following order public methods may used li gracefully terminate active use public methods component once stop event fired public methods should used following link lifecycle event fired following order public methods may longer used li lifecycle interface must destroy true null
component state available use set state internal lifecycle state stopping prep null false stop internal permits stopping prep stopping state lifecycle state stopping state lifecycle state failed fix bug 50836 bug better meaning code lifecycle available code correct couple cases where could incorrectly return true markt fix
secure nio channel ssl channel secure nio channel socket sslengine engine ssl channel get ssl engine engine get need client auth engine get want client auth need re negotiate ssl connection engine set need client auth true try ssl channel rehandshake ssl support new jssefactory get sslsupport engine get session catch ioexception ioe log warn sm get string socket sslreneg ioe object ssl ssl support get peer certificate chain true public boolean init handshake complete protected boolean init handshake complete false protected handshake status init handshake status gets set begin handshake init handshake complete false init handshake status ssl engine get handshake status init handshake complete return we have done our initial handshake while init handshake complete switch init handshake status init handshake complete net out buffer has remaining return init handshake complete selection key op write init handshake status handshake status need task init handshake status tasks init handshake status handshake status need unwrap flush net out buffer init handshake status handshake status need task init handshake status tasks throw new ioexception invalid handshake status init handshake status during handshake unwrap init handshake status tasks default throw new illegal state exception invalid handshake status init handshake status return init handshake complete selection key op write selection key op read init handshake status result get handshake status init handshake status result get handshake status init handshake status tasks init handshake status handshake status need unwrap public void rehandshake throws ioexception int read buf limit get buf handler get read buffer limit try expand read buffer maximum allow handshaking take place get buf handler get read buffer limit get buf handler get read buffer capacity ssl engine get session invalidate ssl engine begin handshake handshake complete false handshake status ssl engine get handshake status while handshake complete handshake true true handshake status handshake status need unwrap handshake unwrap true finally restore pre handshak value get buf handler get read buffer limit read buf limit init handshake complete throw new illegal state exception handshake incomplete you must complete handshake before reading data public boolean init handshake complete return init handshake complete
send j2ee object deleted notification notification notification new notification j2ee object deleted get object name sequence number get increment broadcaster send notification notification thw new crawler session manager valve ensures crawlers code role base code protected message format role base format null message format object associated current
role base null role base format null else role base format new message format role base string base null role base format null name parser np context get name parser name name np parse dn string name parts new string name size int name size name parts name get base role base format format name parts results context search role base filter controls base directory entry performing role searches specified top level element directory context used when searching user roles should search performed user currently being false link connection name link connection password used specified else anonymous connection used protected boolean role search user false
naming enumeration search result results context search role base filter controls
request should have been completely read time response closed further reads input pointless really confuse ajp bug 50189 so close input buffer prevent them request req request coyote response get request get note coyote adapter adapter notes req input buffer close bug 50189 bug once application has finished writing response prevent further reads from request since causes various problems connectors which do expect markt fix fix
naming enumeration binding bindings do list bindings name bindings null return bindings list naming entry alt bindings null alt dir context instanceof base dir context bindings base dir context alt dir context do list bindings else try bindings alt dir context list bindings name catch naming exception ne ignore bindings null return bindings protected abstract naming enumeration binding do list bindings string name protected naming enumeration binding do list bindings string name return new naming context bindings enumeration list file iterator protected array list naming entry list file file array list naming entry entries new array list naming entry protected array list naming entry list file file array list naming entry entries super list file protected naming enumeration binding do list bindings string str name return new naming context bindings enumeration list entries iterator return new naming context bindings enumeration list entry iterator
state socket state open connections put socket processor
configure whether requests listeners fired forwards context public void set fire request listeners forwards boolean enable determine whether requests listeners fired forwards context public boolean get fire request listeners forwards dis int dispatcher type error state outer request set attribute application filter factory dispatcher request path attr get combined path state outer request set attribute application filter factory dispatcher type attr dispatcher type forward invoke state outer request response state else invoke state outer request response state do invoke dis int dispatcher type error state outer request set attribute application filter factory dispatcher request path attr get combined path state outer request set attribute application filter factory dispatcher type attr dispatcher type forward invoke state outer request response state else invoke state outer request response state context get fire request listeners forwards context fire request destroy event request private boolean fire request listeners forwards false override public void set fire request listeners forwards boolean enable fire request listeners forwards enable override public boolean get fire request listeners forwards return fire request listeners forwards bug 50789 bug provide option enable servlet request listeners forwards required some cdi frameworks markt fix fix attribute name fire request listeners forwards required false set code true code fire any configured servlet request listeners when tomcat forwards request primarily use users cdi frameworks use servlet request listeners configure necessary environment request specified default value code false code used attribute
get parameter types length param count base resolver invoke ctx base suffix mps get parameter types ctx mps get parameters ctx public void test bug50790a throws exception value expression ve factory create value expression context bean aa name contains bean name java lang boolean class boolean actual boolean ve get value context assert equals boolean true actual public void test bug50790b throws exception value expression ve factory create value expression context bean name contains bean aa name java lang boolean class boolean actual boolean ve get value context assert equals boolean false actual fix bug 50790 bug improve method resolution el expressions markt fix
request async comet error timeout need tell listeners request over have test first since state may change while method only required entering methos state context ctxt context request get mapping data context ctxt null ctxt fire request destroy event request don fire listener async requests dispatcher type async equals request get dispatcher type servlet request event event new servlet request event get servlet context request int instances length instances null continue instances instanceof servlet request listener continue servlet request listener listener servlet request listener instances try listener request initialized event catch throwable exception utils handle throwable get logger error sm get string standard context request listener request init instances get class get name request set attribute request dispatcher error exception return false don fire listener async requests dispatcher type async equals request get dispatcher type servlet request event event new servlet request event get servlet context request int instances length int instances length instances null continue instances instanceof servlet request listener continue servlet request listener listener servlet request listener instances try listener request destroyed event catch throwable exception utils handle throwable get logger error sm get string standard context request listener request init instances get class get name request set attribute request dispatcher error exception return false don fire listeners during async processing context fire request init event request context fire request destroy event request ctx add application listener tracking request listener class get name string builder expected new string builder expected append request destroyed ctx add application listener tracking request listener class get name string builder expected new string builder expected append request destroyed public static class tracking request listener implements servlet request listener override public void request destroyed servlet request event sre need response isn available via servlet api request request sre get servlet request try get response get writer print request destroyed catch ioexception test fail happens print stack trace override public void request initialized servlet request event sre need response isn available via servlet api request request sre get servlet request try get response get writer print request initialized catch ioexception test fail happens print stack trace ctx add application listener tracking request listener class get name string builder expected new string builder expected append error servlet get error complete licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license ant task implements code roles code command supported tomcat manager application author craig mc clanahan version id since properties public methods execute requested operation exception build exception error occurs override public void execute throws build exception super execute execute roles name roles classname org apache catalina ant roles task typedef li roles enumerate available security role names descriptions from user database connected code users code resource reference
else command equals roles roles writer sm client render list security role names descriptions from code org apache catalina user database code resource connected code users code resource reference typically global user database can adjusted you have different user databases different virtual hosts param writer writer render protected void roles print writer writer string manager sm client debug log roles list security roles from user database look up user database instance we should use user database database null try initial context ic new initial context database user database ic lookup java comp env users catch naming exception writer println sm client get string manager servlet user database error log java comp env users return database null writer println sm client get string manager servlet user database missing return enumerate available roles writer println sm client get string manager servlet roles list iterator role roles database get roles roles null while roles has next role role roles next writer print role get rolename writer print role get description null writer print role get description writer println rev 1068549 rev bug 50667 bug allow rpc callers get confirmation when sending reply lt link user database we get roles from gt lt resource link name users global user database type org apache catalina user database gt lt link user database we get roles from gt lt resource link name users global user database type org apache catalina user database gt ok listed security roles user database li creating user interfaces selecting roles li successful lookup code org apache catalina user database code resource check tomcat log files stack trace associated error li reference code users code resource points appropriate user database instance check your code manager xml code file ensure you have created appropriate code lt resource link gt code code lt resource params gt code element resource li lt taskdef name roles classname org apache catalina ant roles task gt define reference user database looking up roles resource env ref description link user database instance from which we request lists defined role names typically connected global user database resource link element server xml context file manager web application description resource env ref name users resource env ref name resource env ref type org apache catalina user database resource env ref type resource env ref
servlet context sc get servlet context sc set init parameter names find parameter names sc get init parameter params get name null sc set init parameter params get name sc set init parameter params get name params get value servlet context sc get servlet context map entry string string entry merged params entry set sc set init parameter entry get key entry get value bug 50700 bug ensure override attribute context parameters correctly followed markt fix fix public static final int type authtype public static final string name authtype set authtype
public void set auth type string auth type int action auth type null action remove action set add action type authtype action name authtype auth type case type authtype string auth type null info get action action set auth type string info get value session set auth type auth type false break case set type used authenticate our cached principal any param auth type new cached type override public void set auth type string auth type set auth type auth type true public void set auth type string auth type boolean add delta request try lock super set auth type auth type add delta request delta request null delta request set auth type auth type finally unlock subsection name cluster changelog fix bug 50771 bug ensure http servlet request get auth type returns name scheme request has already been kfujino fix changelog subsection
string char array name text map get text char array name null char array name jspx char array char array count text map put text char array name ca out printin static char ca out print char array name ca out print ca out print quote text ca out println char array set begin java line out get java line out printil out write char array name set end java line out get java line
return pool properties get validator validate connection validate action
attributes requested need look them attr ids null attr ids length return new user username dn null null bug 50751 bug when jndi realm only attempt read user attributes from directory attributes required markt fix fix
log debug initial context factory alread set value private input stream private input source ip
new byte array input stream web xml get bytes null uri open stream null uri open stream null ip new input source ip set system id system id return ip null close
ix len public void test urldecode string point response committed when writer beng used markt implements servlet context
-1
private boolean stop await false thread currently inside our await method private volatile thread await thread null server socket used wait shutdown command private volatile server socket await socket null thread await thread null server socket await socket null await socket null try close catch ioexception ignored interrupt try join 1000 catch interrupted exception ignored while true try thread sleep 10000 catch interrupted exception ex stop await return return server socket server socket null server socket new server socket port inet address get name address system exit loop waiting connection valid command while true wait next connection socket socket null input stream stream null try socket server socket accept socket set so timeout 10 1000 ten seconds stream socket get input stream catch access control exception ace log warn standard server accept security exception ace get message ace continue catch ioexception log error standard server await accept system exit read set characters from socket string builder command new string builder int expected 1024 cut off avoid do attack while expected shutdown length random null random new random expected random next int 1024 while expected int ch ch stream read catch ioexception log warn standard server await read ch ch 32 control character eof terminates loop command append char ch expected finally server socket server socket await socket await thread null await socket null close socket now we done try socket close catch ioexception ignore match against our command string boolean match command string equals shutdown match log info sm get string standard server shutdown via port break else log warn standard server await invalid command command string received close server socket return try server socket close catch ioexception ignore port get server null shutdown hook take care clean up system exit get server get server get port socket socket new socket get server get address get server get port get server stop bug 50683 bug ensure annotations scanned when upack wars set code false code host where web application deployed markt
buf new byte header buffer size maximum allowed size http request line plus headers private final int header buffer size known size nio channel read buffer private int socket read buffer size additional size we allocate buffer more effective when skipping empty lines may precede request private static final int skip blank lines size 1024 how many bytes buffer occupied skipped blank lines precede request private int skip blank lines bytes socket read buffer size socket get buf handler get read buffer capacity int buf length skip blank lines size header buffer size socket read buffer size buf null buf length buf length buf new byte buf length ignore bytes were read pos last valid parsing request line start pos parsing request line phase parsing request line phase mark current buffer position pos last valid use available data only return false do simple read short timeout read socket true false return false skip blank lines bytes pos parsing request line start pos parsing header throw new illegal argument exception sm get string iib error should happen log warn expanding buffer size old size buf length new size newsize new exception checking headers plus request line size does exceed its limit enough bytes avoid expanding buffer when reading body technically technical limitation logical limitation enforce meaning header buffer size from way how buf allocated how blank lines being read should enough check only end skip blank lines bytes header buffer size buf length end socket read buffer size throw new illegal argument exception sm get string iib error buf length end 4500 case request header really large so we allocate brand new one old one get gced when subsequent requests clear all references buf new byte buf length end pos end last valid pos static string default protocol tls static string default keystore type jks static final org apache juli logging log log org apache juli logging log factory get log jssesocket factory class
allow unsafe legacy prevent futher handshakes removing all cipher suites request specified default code false code used
else attrs set collection true fix bug 50683 bug ensure annotations scanned when upack wars set code false code host where web application deployed markt fix
return boolean value boolean value return byte value byte value return double value double value return float value float value return integer value int value return short value short value return long value long value return new byte byte return new byte return new character char return new character char return new double return new double return new float return new float return new integer return new integer return new short short return new short return new long return new long return new byte return length new character char null return new short return new integer return new float return new long return new double return new byte string return boolean value string return new short string return new integer string return new float string return new long string return new double string return new character string tmpval new character values char method invoke bean new object new integer value method invoke bean new object new short value method invoke bean new object new long value method invoke bean new object new double value method invoke bean new object new float value method invoke bean new object new character value method invoke bean new object new byte value
add tld page info add dependant jar resource get entry location get name string add tag page info add dependant jar resource get entry tag file path substring string sets deployer cluster deployer use param deployer deployer fixme public void set deployer deployer deployer members cluster specified context path context path empty string should used root application container otherwise context path must start slash param context path context path which application should param war url type jar points war file type file points unpacked directory structure containing web application installed exception illegal argument exception specified context path malformed must start slash exception illegal state exception specified context path public void install string context path url war throws ioexception path application successfully removed param context path context path application removed exception illegal argument exception specified context path malformed must start slash exception illegal argument exception specified context path does public void remove string context path boolean undeploy throws ioexception applications war form within cluster
fmsg get context path fmsg get file name string path fmsg get context path serviced path add serviced path remove path check path remove serviced path farm war deployer deploy end path farm war deployer servicing deploy path name string path umsg get context path path serviced path add serviced path remove path remove serviced path farm war deployer undeploy end path farm war deployer servicing uneploy path file tmp file new file msg get file name file write file new file get temp dir tmp file get name cluster specified context path context path empty string should used root application container otherwise context path must start slash param context path context path which application should installed param war url type jar points war file type file points unpacked directory structure containing web application installed specified context path malformed must start slash specified context path already attached existing web application public void install string context path url war throws ioexception file message factory factory file message factory get instance new file war get file false file message msg new file message local member war get file context path log debug sm get string farm war deployer send start context path war context path war members farm war deployer send end context path war path application successfully removed container event param context path context path application removed specified context path malformed must start slash specified context path does identify public void remove string context path boolean undeploy log info sm get string farm war deployer remove start context path current time millis undeploy context path system current time millis context path undeploy log debug sm get string farm war deployer remove tx msg context path serviced context path add serviced context path remove context path remove serviced context path context path context path ex string context name get context name deploy war log info sm get string farm war deployer mod install context name deploy war get absolute path remove context name false install context name deploy war uri url string context name get context name remove war context name remove context name true create context path from war param war war filename return filename war name root war context name empty string protected string get context name file war string context name war get name substring war get name last index war root equals context name context name return context name protected void remove string path throws exception context context context host find child path log debug sm get string farm war deployer undeploy local path check path private string context path string context path context path context path public string get context path return context path log warn receive message again sender act timeout too short path msg get context path log warn receive message again sender act timeout too short path msg get context path private string context path string context path context path context path public string get context path return context path public void set context path string context path context path context path
code sun net www http http client code triggered web application first call start keep alive thread thread context class loader configured web application class loader defaults code true code private boolean keep alive protection true public boolean keep alive protection return keep alive protection public void set keep alive protection boolean keep alive protection keep alive protection keep alive protection protect against memory leak caused when first call when servlet opens connection using url use sun net www http http client which keeps static reference keep alive cache which loaded using web application class loader keep alive protection try class name sun net www http http client catch class found exception system get property java vendor starts sun log error sm get string jre leak listener keep alive fail else log debug sm get string jre leak listener keep alive fail http client keep alive timer thread has been started web application still running should tomcat change context class loader from current link webapp class loader link webapp class loader parent prevent memory leak note keep alive timer thread stop its own once keep alives all expire however busy system might happen some time private boolean clear references http client keep alive thread true jvm thread group names add system http client keep alive timer thread has been started web application still running should tomcat change context class loader from current link webapp class loader link webapp class loader parent prevent memory leak note keep alive timer thread stop its own once keep alives all expire however busy system might happen some time private boolean clear references http client keep alive thread true return clear references http client keep alive thread flag context public boolean get clear references http client keep alive thread return clear references http client keep alive thread set clear references http client keep alive thread feature context param clear references http client keep alive thread new flag value public void set clear references http client keep alive thread boolean clear references http client keep alive thread clear references http client keep alive thread clear references http client keep alive thread don warn about jvm controlled threads http client keep alive threads clear references http client keep alive thread thread get name equals keep alive timer thread set context class loader parent log debug sm get string webapp class loader check threads http client don warn about remaining jvm controlled threads attribute name keep alive protection required false enables protection so keep alive thread started code sun net www http http client code does result memory leak thread started first time code http client code class used without protection web application uses class keep alive thread configured thread context class loader set web application class loader which turn trigger memory leak reload defaults code true code attribute
read message length
private methods private class loader bind thread private void unbind thread class loader old context class loader private static final log log log factory get log connector class
session end access
get servlet config get init parameter executable arg null list string args new array list string int string arg get servlet config get init parameter executable arg arg null break args add arg cgi executable args args string cmd args new string params size cmd args cgi executable cmd args command create query arguments int params size cmd args params get cmd args add command cmd args add all params proc rt exec cmd args hash string array env wd
idle offer new pooled connection pool properties pooled connection con create protected pooled connection create
obj null return false obj null return false null return false obj null return false obj null obj instanceof naming entry obj null return false
protected string url http localhost 8080 manager code http localhost 8080 manager code which corresponds standard installation tomcat property name url value http localhost 8080 manager property name manager url value http localhost 8080 manager code http localhost 8080 manager code
allocate new filter instance get filter
current status remove info get war get absolute path
context request get mapping data context log access request response system current time millis req get start time false boolean create false create true request recycle response recycle get state available get enabled final string t1name access log valve class get name t1 pass request next valve our pipeline long t1 system current time millis boolean request async dispatching request set attribute t1name long value t1 get next invoke request response we re done request request async dispatching return else request get attribute t1name null t1 long request get attribute t1name long value long t2 system current time millis long time t2 t1 log request response time else get next invoke request response log elements null condition null long length response get bytes written true public void invoke request request response response throws ioexception servlet exception log request response get state available return byte count byte count
return filter matcher uri matches
groupname null groupname length string msg sm get string memory user database null group log warn msg throw new illegal argument exception msg rolename null rolename length string msg sm get string memory user database null role log warn msg throw new illegal argument exception msg username null username length string msg sm get string memory user database null user log warn msg throw new illegal argument exception msg new memory group creation factory new memory role creation factory new memory user creation factory
system log handler systemlog new system log handler system out system set out systemlog system set err systemlog system log handler systemlog new system log handler system out system set out systemlog system set err systemlog
out printil public string get servlet info out printil private void jsp init servlet config config out printil private static final jsp factory jspx factory jsp factory get default factory out printil private static java util list string jspx dependants out printin jspx dependants new java util array list string out printil public java util list string get dependants out printin single thread model out println final http servlet request request final http servlet response response out println throws java io ioexception servlet exception out printil final page context page context out printil http session session null out printil throwable exception org apache jasper runtime jsp runtime library get throwable request out printil response set status http servlet response sc internal server error out printil final servlet context application out printil final servlet config config out printil jsp writer out null out printil final object page out printil jsp writer jspx out null out printil page context jspx page context null out printil throw new skip page exception string scopename page context page scope default page scopename page context request scope scopename page context session scope scopename page context application scope out printil catch class found exception exc out printil catch exception exc out printin throw new servlet exception out print page context jspx page context out printil throws throwable out printil page context page context jspx page context out printil jsp writer out jspx page context get out nvp boolean value omit out printil jsp context get elcontext put context jsp context class get jsp context out printil jsp context get elcontext put context jsp context class get jsp context out printil throw new skip page exception out printil catch throwable jspx exception sb append new class string scope name page context page scope default page scope name page context request scope scope name page context session scope scope name page context application scope out printil string out printil string var name out printil string var name out printil http session session jspx page context get session out printil servlet context application jspx page context get servlet context out printil http servlet request request http servlet request jspx page context get request out printil http servlet response response http servlet response jspx page context get response out printil catch throwable out printil instanceof skip page exception out printil private jsp context jsp context out printil public void do tag throws jsp exception java io ioexception out printil page context jspx page context page context jsp context out printil http servlet request request http servlet request jspx page context get request out printil http servlet response response http servlet response jspx page context get response out printil http session session jspx page context get session out printil servlet context application jspx page context get servlet context out printil servlet config config jspx page context get servlet config out printil jsp writer out jsp context get out out printil jsp context get elcontext put context jsp context class jsp context out printil catch throwable out printil instanceof skip page exception out printil throw skip page exception out printil instanceof illegal state exception out printil throw illegal state exception out printil instanceof jsp exception out printil throw jsp exception out printil throw new jsp exception out printil jsp context get elcontext put context jsp context class super get jsp context out printil public void set jsp context jsp context ctx java util map alias map out printil public void set jsp context jsp context ctx out printil public jsp context get jsp context out printil public void set dynamic attribute string uri string local name object value throws jsp exception int jsp context jsp context out println result get id jsp writer out out printil throws throwable out printil throws jsp exception out printil jsp writer out null out printil jsp context get elcontext put context jsp context class jsp context out printil catch throwable out printil instanceof skip page exception out printil throw skip page exception out printil throw new jsp exception class page context jsp ctxt return boolean org apache jasper runtime jsp runtime library coerce boolean class return new boolean false return new boolean boolean value string return byte org apache jasper runtime jsp runtime library coerce byte class return new byte byte return new byte byte byte value string return character org apache jasper runtime jsp runtime library coerce character class return new character char return new character char int ch return double org apache jasper runtime jsp runtime library coerce return new double return new double double value string return float org apache jasper runtime jsp runtime library coerce float class return new float return new float float value string return integer org apache jasper runtime jsp runtime library coerce integer class return new integer return new integer integer value string return short org apache jasper runtime jsp runtime library coerce short class return new short short return new short short value string return long org apache jasper runtime jsp runtime library coerce long class return new long return new long long value string return void type
protected int max active 100
override override override override override fix bug 21157 bug ensure cookies written before response commited cookie example patch provided stefan radzom markt fix
string cookie name request get parameter cookiename string cookie value request get parameter cookievalue cookie cookie null cookie name null cookie value null cookie new cookie cookie name cookie value response add cookie cookie string cookie name request get parameter cookiename string cookie value request get parameter cookievalue cookie name null cookie value null cookie cookie new cookie cookie name cookie value response add cookie cookie
redirect output suppress warnings unchecked override
suppress warnings unchecked override synchronized get class
pooled connection pc borrow connection null null pc null return new connection future pc volatile pooled connection pc null public connection future pooled connection pc pc pc cancelled get cancelled compare set false true pooled connection pc pc future get timeout unit return pc future cancelled cancelled get return pc future done licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license object factory resource links shared data sources author filip hanik version id resource link factory java 939311 2010 04 29 14 01 02z kkolinko implements object factory object factory methods create new data source instance param obj reference object describing data source public object get object instance object obj name name context name ctx hashtable environment throws naming exception object result super get object instance obj name name ctx environment can we process request result null reference ref reference obj ref addr user attr ref get username ref addr pass attr ref get password user attr get content null pass attr get content null result wrap data source result user attr get content string pass attr get content string return result protected object wrap data source object datasource string username string password throws naming exception try class proxy class proxy get proxy class datasource get class get class loader datasource get class get interfaces constructor proxy constructor proxy class get constructor new class invocation handler class data source handler handler new data source handler data source datasource username password return proxy constructor new instance handler catch exception instanceof naming exception throw naming exception else naming exception nx new naming exception get message nx init cause throw nx simple wrapper class allow user configure resource link data source so when link javax sql data source get connection called invoke link javax sql data source get connection string string username password public static class data source handler implements invocation handler data source ds string username string password public data source handler data source ds string username string password ds ds username username password password public object invoke object proxy method method object args throws throwable get connection equals method get name args length args new string username password else unwrap equals method get name return unwrap class args try return method invoke ds args catch throwable instanceof invocation target exception invocation target exception invocation target exception throw get cause null get cause else throw public object unwrap class iface throws sqlexception iface data source class return ds else throw new sqlexception wrapper iface get name fix bug 49543 bug allow tomcat use shared data sources per application credentials fhanik fix attribute name factory required false fully qualified java class name class creating objects class should implement code javax naming spi object factory code interface attribute when attribute code factory quot org apache naming factory data source link factory quot code resource link can used two additional attributes allow shared data source used different credentials when two additional attributes used combination code javax sql data source code type different contexts can share global data source different credentials under hood what happens call href http download oracle com javase docs api javax sql data source html get connection code get connection code simply translated call href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code get connection username password code global data source easy way get code transparent what schemas being used yet able control connections pools global attributes attribute name username required false attribute attribute name password required false attribute attributes shared data source example lt resource name quot shared data source quot global quot shared data source quot type quot javax sql data source quot username quot bar quot password quot barpass quot lt resource link name quot app data source quot global quot shared data source quot type quot javax sql data source quot factory quot org apache naming factory data source link factory quot username quot foo quot password quot foopass quot lt resource link name quot app data source quot global quot shared data source quot type quot javax sql data source quot when request code get connection code made code foo code context request translated code get connection quot foo quot quot foopass quot code while request code bar code gets passed straight through
-1
return cache unload name fix bug 50550 bug when new directory created via web dav ensure subsequent request directory does result 404 response markt fix
remote host null remote host address getip sa fix bug 47319 bug return client apos ip address rather than null calls code get remote host code when apr connector used code enable lookups quot true quot code ip address resolveable markt fix
msg set timestamp system current time millis msg set timestamp system current time millis fix bug 50547 bug add time stamp change session id message session expired message kfujino fix
string buffer concat remote ip header value new string buffer string remote ip header value comma delimited list string array request get header remote ip header request get header remote ip header original protocol header request get header remote ip header new proxies header request get header proxies header string buffer concat remote ip header value new string buffer string remote ip header value comma delimited list string array request get header remote ip header public void add header string name string value get coyote request get mime headers add value name set string value request set header forwarded 140 211 11 130 192 168 10 192 168 11 request set header forwarded 140 211 11 130 proxy1 proxy2 request get coyote request get mime headers add value forwarded set string 140 211 11 130 proxy1 proxy2
attachment access iterator remove process key sk attachment size limit also known count limit use when realm configured link user search zero limit protected long size limit time limit milliseconds use when realm configured link user search zero limit protected int time limit
public long get size limit return size limit public void set size limit long size limit size limit size limit public int get time limit return time limit public void set time limit int time limit time limit time limit constraints set count limit size limit constraints set time limit time limit add bug 50541 bug add support setting size limit time limit ldap seaches when using jndi realm code user search code markt add attribute name size limit required false specifies maximum number records return when using code user search code attribute specified default code code used which indicates limit attribute attribute name time limit required false specifies time milliseconds wait records returned when using code user search code attribute specified default code code used which indicates limit attribute
else double matches obj0 obj1 delegate double else biginteger matches obj0 obj1 delegate bigdecimal else double matches obj0 obj1 delegate double else biginteger matches obj0 obj1 else double matches obj0 obj1 delegate double else biginteger matches obj0 obj1 attribute name alternate username allowed required false boolean default jdbc pool ignore href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code data source get connection username password code call simply return previously pooled connection under globally configured properties code username code code password code performance reasons pool can however used different credentials each time connection used should you request connection credentials user1 password1 connection previously connected using user2 password2 connection closed reopened requested credentials way pool size still managed global level per schema level enable described href http download oracle com javase docs api javax sql data source html get connection java lang string 20java lang string code data source get connection username password code call simply set property code alternate username allowed code true br default value code false code br property added enhancement href https issues apache org bugzilla show bug cgi id 50025 bug 50025 attribute
pooled connection con borrow connection borrows connection from pool connection available idle queue pool has reached link pool properties max active max active connections connection returned immediately connection available pool attempt fetch connection link pool properties max wait max wait milliseconds return connection java sql connection javax sql pooled connection reflection proxy wrapping underlying object throws sqlexception wait times out failure occurs creating connection public connection get connection string username string password throws sqlexception check out connection pooled connection con borrow connection username password return setup connection con initial pool borrow connection don wait should contention private pooled connection borrow connection int wait throws sqlexception pooled connection result borrow connection now con return create connection now con protected pooled connection create connection long now pooled connection used throws sqlexception username null con get attributes put con prop user username password null con get attributes put con prop password password protected pooled connection borrow connection long now pooled connection con throws sqlexception boolean usercheck con check user username password con discarded con validate pooled connection validate borrow set timestamp con set timestamp now get pool properties log abandoned set stack trace pool con set stack trace get thread dump busy offer con log debug connection doesn fit busy array connection traceable return con either discarded validation failed pc borrow connection system current time millis pc value properties get property prop alternate username allowed value null pool properties set alternate username allowed boolean parse boolean value return get connection inherit doc public boolean alternate username allowed return get pool properties alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed get pool properties set alternate username allowed alternate username allowed returns true call link data source get connection string string get connection username password allowed used when pool used application accessing multiple schemas performance impact turning option return true link data source get connection string string get connection username password honored false ignored public boolean alternate username allowed set true call link data source get connection string string get connection username password allowed honored used when pool used application accessing multiple schemas performance impact turning option even when used due username checks param alternate username allowed set true link data source get connection string string get connection username password honored false ignored public void set alternate username allowed boolean alternate username allowed protected boolean alternate username allowed false inherit doc public boolean alternate username allowed return alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed alternate username allowed alternate username allowed public static final string prop user user public static final string prop password password public boolean check user string username string password get pool properties alternate username allowed return true username null username pool properties get username password null password pool properties get password string stored usr string get attributes get prop user string stored pwd string get attributes get prop password boolean result username null stored usr null result result username null username equals stored usr result result password null stored pwd null password null password equals stored pwd username null get attributes remove prop user else get attributes put prop user username password null get attributes remove prop password else get attributes put prop password password return result string usr null string pwd null get attributes contains key prop user usr string get attributes get prop user else usr pool properties get username get attributes put prop user usr get attributes contains key prop password pwd string get attributes get prop password else pwd pool properties get password get attributes put prop password pwd pool properties get username null pool properties get password null xa connection xds get xaconnection pool properties get username pool properties get password pool properties get username null pool properties get password null connection ds get connection pool properties get username pool properties get password pool properties get username null pool properties get password null connection ds get pooled connection pool properties get username pool properties get password get connection string usr pool properties get username string pwd pool properties get password usr null pool properties get db properties set property user usr pwd null pool properties get db properties set property password pwd connection driver connect driver url pool properties get db properties private properties clone properties properties new properties put all return inherit doc public boolean alternate username allowed return get pool properties alternate username allowed inherit doc public void set alternate username allowed boolean alternate username allowed noop licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license private static final int iterations new random system current time millis next int 100000 1000 public alternate username test string name super name public void test generic throws exception init datasource set driver class name driver class get name datasource set url jdbc tomcat test datasource set alternate username allowed true datasource get connection close int withoutuser 10 int withuser withoutuser test runner runners new test runner withuser withoutuser int withuser test runner new test runner foo bar datasource get pool properties get username datasource get pool properties get password test runner without new test runner null null datasource get pool properties get username datasource get pool properties get password runners runners withuser without executor service svc executors new fixed thread pool withuser withoutuser list future test result results svc invoke all arrays list runners int failures int total int withuser failures results get get failures total results get get iterations failures results get withuser get failures total results get withuser get iterations assert equals nr failures failures failures svc shutdown now datasource close system out println nr connect calls driver connect count get system out println nr disconnect calls driver disconnect count get system out println nr iterations total public static class test result public int iterations public int failures public string last message public class test runner implements callable test result string username string password volatile boolean done false test result result null boolean useuser true public test runner string user string pass string guser string gpass username user null guser user password pass null gpass pass useuser user null public test result call test result test new test result pooled connection pcon null int done iterations test iterations try pcon useuser pooled connection alternate username test datasource get connection username password pooled connection alternate username test datasource get connection connection con connection pcon get connection assert true username mismatch requested user username actual user con get username con get username equals username assert true password mismatch requested password password actual password con get password con get password equals password catch sqlexception test failures test last message get message done true print stack trace catch exception test failures test last message get message print stack trace finally pcon null try pcon close catch exception ignore pcon null done true result test return result properties info public connection properties info info info public string get username return info get property pooled connection prop user public string get password return info get property pooled connection prop password return new org apache tomcat jdbc test driver connection
host null host instanceof host cluster name null cluster name index fix bug 50503 bug when web application has version engine level clustering works correctly kfujino fix
constructor generate constructor class name out println http servlet request request http servlet response response out printil page context page context null out printil servlet context application null out printil servlet config config null out printil object page out printil page context jspx factory get page context request response
catch saxparse exception spe log warn catalina start using get config file spe get message return log warn catalina start using get config file locator get column number message real class name null throw new null pointer exception class name specified namespace name bug 10972 bug improve error message class name attribute missing element server xml where required markt update update
should session always used once user may offer some performance benefits since session can used cache principal hence removing need authenticate user via realm every request may help combinations basic used jndirealm data source realms however also performance cost creating gc ing session default session created protected boolean always use session false session null change session id manager manager request get context get manager manager change session id session request change session id session get id
log debug message msg data msg get data log debug msg buf pos len public static string hex string byte bytes null bytes return null string builder sb new string builder bytes length int bytes length sb append hex bytes 0xf0 append hex bytes 0x0f return sb string private static final enable exception enable dtd validation exception new enable exception jsp error enable dtd validation null
fatal error enable dtd validation exception override public synchronized throwable fill stack trace class does provide stack trace return override public synchronized throwable fill stack trace class does provide stack trace return return creation time session bypassing session validity checks public long get creation time internal
public long get creation time internal return override int time alive int time now session get creation time 1000 return time when session created milliseconds since midnight january 1970 gmt bypassing session validation checks override public long get creation time internal return creation time fix bug 50448 bug fix possible code illegal state exception code caused recent session management refactoring markt fix
resolvers instanceof scoped attribute elresolver special case since always return object class object value resolvers get value context base property value null return value get class public void test bug50408 throws exception tomcat tomcat get tomcat instance file app dir new file test webapp app dir relative server home standard context ctxt standard context tomcat add webapp null test app dir get absolute path test needs jstl libraries file lib new file webapps examples web inf lib ctxt set aliases web inf lib lib get canonical path tomcat start int rc get url http localhost get port test bug50408 jsp new byte chunk null assert equals http servlet response sc ok rc licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license body each items page context response header names var name each items page context response get headers name var value name value each each body subsection name jasper changelog fix bug 50408 bug fix code method exception code when using scoped variables el method invocation markt fix changelog subsection coyote connector tomcat
protected string parse body methods post protected hash set parse body methods set public string get parse body methods return parse body methods public void set parse body methods string methods hash set method set new hash set null methods method set add all arrays list methods split method set contains trace throw new illegal argument exception trace method must include entity see rfc 2616 section parse body methods methods parse body methods set method set public boolean parse body method string method return parse body methods set contains method make sure parse body methods set has default null parse body methods set set parse body methods get parse body methods get method equals ignore case post test case https issues apache org bugzilla show bug cgi id 48692 put requests should able fetch request parameters coming from request body when properly configured using new parse body method setting public void test bug48692 client new client set port get port make sure get works properly client do request get foo bar null null false assert true non 200 response get request client response200 assert equals incorrect response get request foo bar client get response body client reset make sure post works properly post separate get post parameters client do request post foo bar application www form urlencoded bar baz true assert true non 200 response post request client response200 assert equals incorrect response post request bar baz foo bar client get response body client reset post overlapping get post parameters client do request post foo bar bar foo application www form urlencoded bar baz foo baz true assert true non 200 response post request client response200 assert equals incorrect response post request bar baz bar foo foo bar foo baz client get response body client reset put without post style parsing client do request put foo bar bar foo application www form urlencoded bar baz foo baz false assert true non 200 response put noparse request client response200 assert equals incorrect response put request bar foo foo bar client get response body client reset put post style parsing client do request put foo bar bar foo application www form urlencoded bar baz foo baz true assert true non 200 response put request client response200 assert equals incorrect response put parse request bar baz bar foo foo bar foo baz client get response body client reset private exception do request string method string query string string content type string request body boolean allow body private static class echo parameters servlet extends http servlet private static final long serial version uid 1l only interested parameters values requests note echos parameters alphabetical order override protected void service http servlet request req http servlet response resp throws servlet exception ioexception just echo parameters values back plain text resp set content type text plain resp set character encoding utf print writer out resp get writer tree map string string parameters new tree map string string req get parameter map boolean first true string name parameters key set string values req get parameter values name java util arrays sort values int values length first first false else out print out print name values bug 48692 test client test allowing put request bodies private class extends simple http client private boolean init private synchronized void init throws exception init return tomcat tomcat get tomcat instance context root tomcat add context temp dir tomcat add servlet root echo parameters new echo parameters servlet root add servlet mapping echo echo parameters tomcat start init true private exception do request string method string query string string content type string request body boolean allow body tomcat tomcat get tomcat instance try init allow body tomcat get connector set parse body methods method else tomcat get connector set parse body methods never parse open connection connect re encode request body so bytes characters null request body request body new string request body get bytes utf ascii send specified request body using method string request method http localhost get port echo null query string query string http crlf host localhost crlf null content type content type content type crlf connection close crlf null request body content length request body length crlf crlf null request body request body set request request process request blocks until response has been read close connection disconnect catch exception return return null override public boolean response body ok return false don care author email schultz apache org christopher schultz author update bug 48692 bug provide option parse code application www form urlencoded code put requests schultz update attribute name parse body methods required false comma separated list http methods which request bodies parsed request parameters identically post useful restful applications want support post style semantics put requests note any setting other than code post code causes tomcat behave way violates servlet http method trace specifically forbidden here accordance http default code post code attribute attribute name parse body methods required false comma separated list http methods which request bodies parsed request parameters identically post useful restful applications want support post style semantics put requests note any setting other than code post code causes tomcat behave way violates servlet http method trace specifically forbidden here accordance http default code post code attribute
set state lifecycle state starting name which object being bound unbound implements http session session serializable
private static final long serial version uid 1l private static final long serial version uid 1l private static final long serial version uid 1l constructors destructors constructors extends saxparse exception extends reference extends reference extends reference extends reference extends reference extends reference public static class simple table demo extends jpanel implements action listener private static final long serial version uid 1l private static final long serial version uid 1l private static final long serial version uid 1l
ccl null ccl equals key key null key get class get class loader equals value value null value get class get class loader args key get class get canonical name args value get class get canonical name private string get pretty class name class clazz string name clazz get canonical name name null name clazz get name return name param object test return code true code has been loaded current classloader one its descendants private boolean loaded web app class loader object null return false class loader cl get class get class loader while cl null cl return true cl cl get parent return false add bug 48837 bug extend thread local memory leak detection include classes loaded subordinate class loaders web application apos class loader jasper class loader based patch sylvain laurent markt add
public int get min spare threads return endpoint get min spare threads public void set min spare threads int min spare threads endpoint set min spare threads min spare threads public int get min spare threads return endpoint get min spare threads public void set min spare threads int min spare threads endpoint set min spare threads min spare threads subsection name coyote changelog add bug 50108 bug add get set methods connector property min spare threads patch provided eiji takahashi markt add changelog subsection
state socket state long state socket state async end else state socket state async end further work required att set async true re enable timeouts log debug enabled log debug keeping processor processor add correct poller events here based comet stuff socket get poller add socket att get comet ops else ka interest ops selection key op read selection key op read else ka async
seconds buff append seconds seconds string builder buff new string builder bytes buff append bytes bytes return mbytes rest 10 rest mb
else state async state started do test timeout true do test timeout false private void do test timeout boolean complete timeout throws exception timeout servlet timeout new timeout servlet complete timeout dispatch url null non async servlet non async new non async servlet tomcat add servlet ctx nonasync non async ctx add servlet mapping dispatch url nonasync expected append complete public timeout servlet boolean complete timeout dispatch url dispatch url ac add listener new tracking listener false complete timeout new tracking listener complete error true timeout servlet timeout new timeout servlet true tracking listener listener new tracking listener false true private string dispatch url boolean complete timeout dispatch url dispatch url event get async context complete
string builder key properties new string builder web module
resolvers new elresolver
private function mapper function mapper constants security enabled function mapper new function mapper override public method resolve function string prefix string local name return null else function mapper null function mapper private final static elresolver default resolver new composite elresolver composite elresolver default resolver add new map elresolver composite elresolver default resolver add new resource bundle elresolver composite elresolver default resolver add new list elresolver composite elresolver default resolver add new array elresolver composite elresolver default resolver add new bean elresolver el resolver get default resolver return get default resolver get value context base property return get default resolver get type context base property get default resolver set value context base property value return get default resolver read only context base property return get default resolver get feature descriptors context base return get default resolver get common property type context base licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface implemented session managers do keep complete copy all sessions local node do know where every session backup manager example manager sessions can primary master copy node backup backup copy node proxy only session id node identity primary backup nodes known all sessions including proxy sessions returns total session count primary backup proxy return total session count across cluster public int get active sessions full returns list all sessions ids primary backup proxy return complete set sessions ids across cluster public set string get session ids full implements map owner distributed manager
override public string list session ids full string builder sb new string builder lazy replicated map map lazy replicated map sessions suppress warnings unchecked sessions type map string session iterator string keys map key set full iterator while keys has next sb append keys next append return sb string manager instanceof backup manager show proxy sessions backup manager manager get active sessions full manager instanceof backup manager show proxy sessions backup manager manager get session ids full
boolean singleton boolean parse boolean string resource ref entry value get singleton get content singleton entry type naming entry entry entry value obj
get executor execute task log error unable service bio socket notify awaken thread markt
fire container event add welcome file event name fire container event remove welcome file event name fire container event add mapping event mapping fire container event remove mapping event mapping
several components end up calling sun awt app context get app context those libraries components known trigger memory leaks due eventual calls get app context google web toolkit via its use javax imageio tomcat via its use java beans introspector flush caches 15 onwards others tbd trigger call sun awt app context get app context pin common class loader memory shouldn issue app context protection image io get cache directory several components end up calling sun misc gc request latency long those libraries components known trigger memory leaks due eventual calls request latency long javax management remote rmi rmiconnector server start gc daemon protection try class clazz class name sun misc gc method method clazz get declared method request latency new class long class method invoke null long value 3600000 catch class found exception system get property java vendor starts sun log error sm get string jre leak listener gc daemon fail else log debug sm get string jre leak listener gc daemon fail catch security exception log error sm get string jre leak listener gc daemon fail catch method exception log error sm get string jre leak listener gc daemon fail catch illegal argument exception log error sm get string jre leak listener gc daemon fail catch illegal access exception log error sm get string jre leak listener gc daemon fail catch invocation target exception log error sm get string jre leak listener gc daemon fail when servlet opens connection using url use sun net www http http client which keeps static reference keep alive cache which loaded using web application class loader keep alive protection try class name sun net www http http client catch class found exception system get property java vendor starts sun log error sm get string jre leak listener keep alive fail else log debug sm get string jre leak listener keep alive fail calling get policy retains static reference context class loader security policy protection try policy get policy class policy class class name javax security auth policy method method policy class get method get policy method invoke null catch class found exception ignore class deprecated catch security exception ignore don need call get policy successful just need trigger static initializer catch method exception log warn sm get string jre leak listener auth policy fail catch illegal argument exception log warn sm get string jre leak listener auth policy fail catch illegal access exception log warn sm get string jre leak listener auth policy fail catch invocation target exception log warn sm get string jre leak listener auth policy fail creating message digest during web application startup initializes java cryptography architecture under certain conditions starts token poller thread tccl equal web application class loader instead we initialize jca right now token poller protection java security security get providers several components end up opening jar without first disabling caching effectively locks file whilst more noticeable harder ignore windows affects all operating systems those libraries components known trigger issue include log4j versions 15 earlier javax xml bind jaxbcontext new instance set default url caching policy cache url cache protection try doesn matter jar doesn exist just long url well formed url url new url jar file dummy jar conn url open connection conn set default use caches false catch malformed urlexception log error sm get string jre leak listener jar url conn cache fail catch ioexception log error sm get string jre leak listener jar url conn cache fail haven got root what going leak web app first make calls below web application class loader pinned memory xml parsing protection document builder factory factory document builder factory new instance try factory new document builder catch parser exception log error sm get string jre leak listener xml parse fail haven got root what going leak web app first make calls below web application class loader pinned memory xml parsing protection document builder factory factory document builder factory new instance try factory new document builder catch parser exception log error sm get string jre leak listener xml parse fail finally thread current thread set context class loader loader add bug 50222 bug modify memory leak prevention code so pins system class loader memory rather than than common class loader which better embedded systems patch provided christopher schultz markt add
channel send new member sender rmsg public int get reply message options return reply message options public void set reply message options int reply message options reply message options reply message options fix bug 50184 bug add option rpc channel enable channel send options set reply message based patch ariel markt fix
persistent manager base manager loaded keys failed destroyed destroy lifecycle event type component destroy event public static final string destroy event destroy destroyed false lifecycle destroy event
else lifecycle destroy event equals event get type child destroy else event get type equals lifecycle destroy event lifecycle state destroyed equals state invalid transition lifecycle destroy event set state lifecycle state destroying fix bug 50168 bug separate code lifecycle destroy event code code lifecycle before destroy event code code lifecycle after destroy event code use additional state ensure code context code objects only destroyed once markt fix
op override override override override override public void set manager class name string manager class name log warn set manager class name deprecated use nested manager element inside cluster element instead request ignored override override override override override override override override override override override override override override override override override override override override override override valve set cluster valve set cluster utils call method get container remove valve new object valve new class org apache catalina valve class valve set cluster override override override override override override iterator cluster listener iter cluster listeners iterator iter has next accepted log debug enabled notify lifecycle listener failure log debug enabled log debug message message string from type message get class get name transfered listener registered log debug message message string from type message get class get name transfered listener registered override override op override
determines whether logfile rotatable private boolean rotatable true date equals ts date rotatable boolean parse boolean get property class name rotatable true prefix date suffix
engine add container listener host add lifecycle listener override child add lifecycle listener child add container listener child instanceof host register host host child else child instanceof context register context context child else child instanceof wrapper register wrapper wrapper child child instanceof host unregister host host child else child instanceof context unregister context context child else child instanceof wrapper unregister wrapper wrapper child default host host add container listener log debug sm get string mapper listener register host host get name domain domain string wrapper name wrapper get name log debug enabled log debug sm get string mapper listener unregister wrapper wrapper name context name connector context add container listener log debug sm get string mapper listener register context context name log debug sm get string mapper listener unregister context context name wrapper add container listener wrapper name context name add mapper container all child containers param container private void add listeners container container container add container listener container add lifecycle listener container child container find children add listeners child operation name find container listener names description return set container listener class names configured application impact info return type ljava lang string operation operation name find lifecycle listener names description return set lifecycle listener class names configured application impact info return type ljava lang string operation list class name each lifecycle listeners added container public string find lifecycle listener names throws mbean exception container base container null list string result new array list string try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception lifecycle listener listeners container find lifecycle listeners lifecycle listener listener listeners result add listener get class get name return result array new string result size list class name each container listeners added container public string find container listener names throws mbean exception container base container null list string result new array list string try container container base get managed resource catch instance found exception throw new mbean exception catch runtime operations exception throw new mbean exception catch invalid target object type exception throw new mbean exception container listener listeners container find container listeners container listener listener listeners result add listener get class get name return result array new string result size fix bug 50157 bug ensure mapper listener only added container object once markt fix add improve debug logging mapper listener registration markt add add expose names lifecycle listeners container listers standard context via jmx markt add
boolean web xmlservlet def servlet def null web xmlservlet def web xmlservlet def false else web xmlservlet def true url patterns set boolean web xmlfilter def filter def null web xmlfilter def web xmlfilter def false else web xmlfilter def true url patterns set url patterns null url patterns length dispatch types set dispatcher types null dispatcher types length private static hash map object method object cache new hash map object method
method methods cache null object cache contains key target object methods cache object cache get target object method null else method create method cache methods cache method name target object target type method methods cache null object cache contains key target object methods cache object cache get target object method null else method create method cache methods cache method name target object target type override fix bug 50138 bug fix threading issues code org apache catalina security security util code markt fix
host instanceof standard host standard host host destroy else engine remove child host bug 50105 bug when processing composite el expressions use code enum name code rather than code enum string code required el markt
sb append obj public void test bug50105 expression factory factory expression factory new instance elcontext context new elcontext impl tester enum test enum tester enum apple value expression var factory create value expression test enum tester enum class context get variable mapper set variable test enum var when coercing enum string name should always used value expression ve1 factory create value expression context test enum string class string result1 string ve1 get value context assert equals apple result1 value expression ve2 factory create value expression context foo test enum bar string class string result2 string ve2 get value context assert equals foo applebar result2 apple orange override public string string return name subsection name jasper changelog bug 50105 bug when processing composite el expressions use code enum name code rather than code enum string code required el markt changelog subsection
string manager sm client get string manager request do sessions path request response message sm get string manager servlet exception sm get string manager servlet post command command sm get string manager servlet unknown command command list request response message string manager sm client get string manager request message upload request message deploy internal deploy config deploy path deploy war message reload path message undeploy path message expire sessions path request message start path message stop path message findleaks list request response message protected string upload http servlet request request message sm get string html manager servlet deploy upload file message sm get string message sm get string message sm get string message sm get string protected string deploy internal string config string path string war super deploy print writer config path war false string message throws ioexception args sm get string html manager servlet title args sm get string html manager servlet message label args sm get string html manager servlet manager args sm get string html manager servlet list sm get string html manager servlet help html manager file args sm get string html manager servlet help html manager sm get string html manager servlet help manager file args sm get string html manager servlet help manager args sm get string status servlet title args sm get string html manager servlet apps title args sm get string html manager servlet apps path args sm get string html manager servlet apps name args sm get string html manager servlet apps available args sm get string html manager servlet apps sessions args sm get string html manager servlet apps tasks string apps start sm get string html manager servlet apps start string apps stop sm get string html manager servlet apps stop string apps reload sm get string html manager servlet apps reload string apps undeploy sm get string html manager servlet apps undeploy string apps expire sm get string html manager servlet apps expire args 10 sm get string html manager servlet expire explain args 11 sm get string html manager servlet manager args 12 sm get string html manager servlet expire unit args sm get string html manager servlet deploy title args sm get string html manager servlet deploy server args sm get string html manager servlet deploy path args sm get string html manager servlet deploy config args sm get string html manager servlet deploy war args sm get string html manager servlet deploy button args sm get string html manager servlet deploy upload args sm get string html manager servlet deploy upload file args sm get string html manager servlet deploy button args sm get string html manager servlet diagnostics title args sm get string html manager servlet diagnostics leak args sm get string html manager servlet diagnostics leak warning args sm get string html manager servlet diagnostics leak button args sm get string html manager servlet server title args sm get string html manager servlet server version args sm get string html manager servlet server jvmversion args sm get string html manager servlet server jvmvendor args sm get string html manager servlet server osname args sm get string html manager servlet server osversion args sm get string html manager servlet server osarch protected string reload string path super reload print writer path protected string undeploy string path super undeploy print writer path public string sessions string path int idle super sessions print writer path idle public string sessions string path return sessions path public string start string path super start print writer path protected string stop string path super stop print writer path protected string findleaks super findleaks print writer msg append sm get string html manager servlet findleaks list msg append sm get string html manager servlet findleaks none protected string expire sessions string path http servlet request req return sessions path idle protected void do sessions string path http servlet request req http servlet response resp throws servlet exception ioexception display session detail page req resp path session id int invalidate sessions path session ids boolean removed remove session attribute path session id name display sessions list page path req resp protected list session get sessions path string path throw new illegal argument exception sm get string manager servlet invalid path request util filter path throw new illegal argument exception sm get string manager servlet context request util filter path protected session get session path id string path string id throws ioexception throw new illegal argument exception sm get string manager servlet invalid path request util filter path throw new illegal argument exception sm get string manager servlet context request util filter path protected void display sessions list page string path http servlet request req http servlet response resp throws servlet exception ioexception list session sessions get sessions path path protected void display session detail page http servlet request req http servlet response resp string path string session id throws servlet exception ioexception session session get session path id path session id public int invalidate sessions string path string session ids throws ioexception http session session get session path id path session id get session public boolean remove session attribute string path string session id string attribute name throws ioexception http session session get session path id path session id get session public int set session max inactive interval string path string session id int max inactive interval throws ioexception http session session get session path id path session id get session string manager sm client get string manager request writer println sm get string manager servlet command deploy writer config path war update deploy writer path tag list writer reload writer path resources writer type roles writer save writer path serverinfo writer expire sessions writer path request expire sessions writer path request start writer path stop writer path undeploy writer path findleaks writer writer println sm get string manager servlet unknown command command string manager sm client get string manager request writer println sm get string manager servlet command deploy writer path tag update request writer println sm get string manager servlet unknown command command throw new unavailable exception sm get string manager servlet wrapper protected void findleaks print writer writer writer println sm get string manager servlet findleaks fail protected synchronized void save print writer writer string path writer println sm get string manager servlet save fail server writer println sm get string manager servlet saved writer println sm get string manager servlet exception string writer println sm get string manager servlet context path writer println sm get string manager servlet saved context path writer println sm get string manager servlet exception string string tag boolean update http servlet request request writer println sm get string manager servlet invalid path path undeploy writer display path writer println sm get string manager servlet already context display path writer println sm get string manager servlet exception string writer println sm get string manager servlet deployed display path writer println sm get string manager servlet deploy failed display path protected void deploy print writer writer string path string tag writer println sm get string manager servlet invalid path path undeploy writer display path writer println sm get string manager servlet exception string writer println sm get string manager servlet deployed display path writer println sm get string manager servlet deploy failed display path string path string war boolean update writer println sm get string manager servlet invalid path request util filter path undeploy writer display path writer println sm get string manager servlet already context writer println sm get string manager servlet deployed display path writer println sm get string manager servlet deployed started display path writer println sm get string manager servlet deploy failed display path writer println sm get string manager servlet exception protected void list print writer writer writer println sm get string manager servlet listed writer println sm get string manager servlet listitem display path running context get manager find sessions length context get doc base writer println sm get string manager servlet listitem display path stopped context get doc base protected void reload print writer writer string path writer println sm get string manager servlet invalid path request util filter path writer println sm get string manager servlet context request util filter display path writer println sm get string manager servlet self sm get string manager servlet reloaded display path writer println sm get string manager servlet exception string protected void resources print writer writer string type writer println sm get string manager servlet global writer println sm get string manager servlet resources type type writer println sm get string manager servlet resources all writer println sm get string manager servlet exception string print resources writer global type clazz string type class clazz javax naming context item get object type clazz writer println sm get string manager servlet exception string protected void roles print writer writer writer println sm get string manager servlet user database error writer println sm get string manager servlet user database missing writer println sm get string manager servlet roles list protected void serverinfo print writer writer writer println sm get string manager servlet exception string protected void sessions print writer writer string path int idle writer println sm get string manager servlet invalid path request util filter path writer println sm get string manager servlet context request util filter display path writer println sm get string manager servlet manager writer println sm get string manager servlet sessions display path writer println sm get string manager servlet max inactive interval writer println sm get string manager servlet histo interval timeout writer println sm get string manager servlet histo interval histo interval timeout writer println sm get string manager servlet max count histo interval timeout max count writer println sm get string manager servlet unlimited notimeout writer println sm get string manager servlet expired idle expired writer println sm get string manager servlet exception string protected void sessions print writer writer string path sessions writer path protected void expire sessions print writer writer string path http servlet request req sessions writer path idle protected void start print writer writer string path writer println sm get string manager servlet invalid path request util filter path writer println sm get string manager servlet context request util filter display path writer println sm get string manager servlet started display path writer println sm get string manager servlet start failed display path get servlet context log sm get string manager servlet start failed display path writer println sm get string manager servlet start failed display path writer println sm get string manager servlet exception string protected void stop print writer writer string path writer println sm get string manager servlet invalid path request util filter path writer println sm get string manager servlet context request util filter display path writer println sm get string manager servlet self writer println sm get string manager servlet stopped display path writer println sm get string manager servlet exception string protected void undeploy print writer writer string path writer println sm get string manager servlet invalid path request util filter path writer println sm get string manager servlet context request util filter display path writer println sm get string manager servlet deployed writer println sm get string manager servlet undeployed display path writer println sm get string manager servlet exception string private string manager string package name bnd resource bundle get bundle bundle name locale get default bnd resource bundle get bundle bundle name locale get default cl locale bundle get locale locale null str cannot find message associated key key due mre identify locale string manager associated public locale get locale return locale private static final hashtable string string manager managers new hashtable string string manager public synchronized static final string manager get manager string package name string manager mgr managers get package name mgr new string manager package name managers put package name mgr
catch class format error log warn sm get string context config invalid sci handles types class name return fix bug 50087 bug catch class format errors when scanning annotations markt fix
use same classloader classpath compiling tag files temp wrapper get jsp engine context set class loader ctxt get class loader temp wrapper get jsp engine context set class path ctxt get class path fix bug 50066 bug fix building recursive tag files when file depends jar file patch provided sylvain laurent markt fix
web xml configure context context fix bug 500063 bug correct regression fix bug 50059 bug causes applications marked meta data complete return 404s all requests patch provided heyoulin markt fix
unregister oname naming resources oname naming resources register naming resources type naming resources get object key properties name only
web xml version web xml metadata complete step order fragments set web xml ordered fragments web xml order web fragments web xml fragments step look servlet container initializer ok process servlet container initializers ordered fragments step process web inf classes annotations add any matching classes type initializer map ok url webinf classes try webinf classes context get servlet context get resource web inf classes process annotations url webinf classes web xml catch malformed urlexception log error sm get string context config webinf classes url step process jars annotations only need process those fragments we going use add any matching classes type initializer map ok process annotations ordered fragments step merge web fragment xml files main web xml file ok ok web xml merge ordered fragments step convert explicitly mentioned jsps servlets false convert jsps web xml step apply merged web xml context ok web xml configure context context step 7a make merged web xml available other components specifically jasper save those components from having re generate todo use servlet container initializer jasper string merged web xml web xml xml context get servlet context set attribute org apache tomcat util scan constants merged web xml merged web xml context get log effective web xml log info web xml merged web xml step merge web fragment xml files main web xml file ok ok web xml merge ordered fragments step convert explicitly mentioned jsps servlets false convert jsps web xml step apply merged web xml context ok web xml configure context context step 7a make merged web xml available other components specifically jasper save those components from having re generate todo use servlet container initializer jasper string merged web xml web xml xml context get servlet context set attribute org apache tomcat util scan constants merged web xml merged web xml context get log effective web xml log info web xml merged web xml else ok true always need look static resources web xml fragment ordered fragments resource jars add fragment step apply servlet container initializer config context ok map entry servlet container initializer set class entry initializer class map entry set entry get value empty context add servlet container initializer entry get key null else context add servlet container initializer entry get key entry get value private object base private object property private async context context private servlet request request private servlet response response private throwable throwable
request null response null throwable null throwable null private empty role semantic empty role semantic empty role semantic permit private transport guarantee transport guarantee transport guarantee none private string roles allowed new string empty role semantic empty role semantic permit transport guarantee transport guarantee none roles allowed new string transport guarantee transport guarantee none roles allowed new string private string method name private string location private long max file size private long max request size private int file size threshold else location max file size max request size file size threshold private string name private object value private string name private object value private servlet request request private map string http method constraint element method constraints private servlet servlet what unavailable private boolean permanent needs admin action private int seconds estimate seconds seconds servlet null private string name private object value private throwable throwable private int status code private string uri private string servlet name private jsp writer enclosing writer private string name private string function class private string function signature name name required required type type req time req time name required type req time fragment fragment name required type req time fragment private string name private string type private boolean req time private boolean required private boolean fragment private string description private boolean deferred value private boolean deferred method private string expected type name private string method signature private hashtable string object attributes tagname value map private tag info tag info private string name private string path private tag info tag info private string name given name given private string name from attribute name from attribute private string class name class private boolean declare declare private int scope scope private string id private string message private string var name private string class name private boolean declare private int scope
register principal type our request current session one our single sign valve one set appropriate cookie returned passing null principal de register any sso sessions param request servlet request we processing param response servlet response we populating param principal principal registered param auth type type registered param username username used authenticate any param password password used authenticate any public void register request request http servlet response response principal principal string auth type string username string password param wrapper wrapper context evaluating role public boolean has role principal principal string role public void login string username string password request request throws servlet exception principal principal do login request username password register request request get response principal get auth method username password protected abstract string get auth method protected principal do login request request string username string password throws servlet exception principal context get realm authenticate username password null throw new servlet exception sm get string login fail return public void logout request request throws servlet exception register request request get response null null null null override protected string get auth method return constants basic method override protected string get auth method return constants digest method override protected string get auth method return constants form method override protected string get auth method return none override protected string get auth method return constants cert method check role alias defined security role ref element wrapper null string real role wrapper find security reference role real role null realm has role user principal real role return true return realm has role user principal role login config config context get login config config null throw new servlet exception sm get string coyote request login config string auth method config get auth method basic auth equals auth method form auth equals auth method digest auth equals auth method methods support user name password realm realm context get realm principal principal realm authenticate username password principal null throw new servlet exception sm get string coyote request auth fail username assume we have non null login config we must have context get register get response principal auth method username password else throw new servlet exception coyote request password login context get register get response null null null null has role principal roles public boolean has role principal principal string role public boolean has role principal principal string role return super has role principal role
private map string string parameters null merge parameters merge parameters merge parameters private methods merge context parameters specified application deployment descriptor application parameters described server respecting code override code property application parameters private void merge parameters parameters null return map string string results new concurrent hash map string string string names context find parameters int names length results put names context find parameter names application parameter params context find application parameters int params length params get override results get params get name null results put params get name params get value else results put params get name params get value parameters results set up context init params merge parameters merge context parameters specified application deployment descriptor application parameters described server respecting code override code property application parameters private void merge parameters servlet context sc get servlet context string names find parameters int names length sc set init parameter names find parameter names application parameter params find application parameters int params length params get override sc get init parameter params get name null sc set init parameter params get name params get value else sc set init parameter params get name params get value fix bug 49987 bug fix thread safety issue population servlet context parameters markt fix private boolean reload true private long servlet class last modified time
dcl reload requires reload volatile also forces read memory barrier ensuring new servlet object read consistently servlet servlet null volatile reload forces order write servlet new servlet object dcl requires servlet class last modified time volatile force read write barriers access set get atomic write long protected static final int cache size protected static final simple date format format protected static final simple date format formats protected final static time zone gmt zone time zone get time zone gmt protected static long current date generated 0l protected static string current date null protected static final concurrent hash map long string format cache protected static final concurrent hash map string long parse cache
current date generated now current date generated now implements protocol handler mbean registration string manager package protected static final string manager sm string manager get manager constants package
endpoint new apr endpoint protected object name tp oname protected object name rg oname associated apr endpoint protected apr endpoint endpoint new apr endpoint attributes protected hashtable string object attributes new hashtable string object adapter which process requests received endpoint private adapter adapter pass config info override public void set attribute string name object value log trace enabled log trace sm get string ajpprotocol setattribute name value attributes put name value override public object get attribute string key log trace enabled log trace sm get string ajpprotocol getattribute key return attributes get key override public iterator string get attribute names return attributes key set iterator adapter used call connector override public void set adapter adapter adapter adapter adapter override public adapter get adapter return adapter endpoint set handler handler endpoint set use sendfile false override public void pause throws exception try endpoint pause catch exception ex log error sm get string ajpprotocol endpoint pauseerror ex throw ex log info enabled log info sm get string ajpprotocol pause get name override public void resume throws exception try endpoint resume catch exception ex log error sm get string ajpprotocol endpoint resumeerror ex throw ex log info enabled log info sm get string ajpprotocol resume get name override public void stop throws exception try endpoint stop catch exception ex log error sm get string ajpprotocol endpoint stoperror ex throw ex log info enabled log info sm get string ajpprotocol stop get name override public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name endpoint destroy tp oname null registry get registry null null unregister component tp oname rg oname null registry get registry null null unregister component rg oname public string get name string encoded addr get address null encoded addr get address encoded addr starts encoded addr encoded addr substring encoded addr urlencoder encode encoded addr return ajp encoded addr endpoint get port processor cache protected int processor cache public int get processor cache return processor cache public void set processor cache int processor cache processor cache processor cache override public executor get executor return endpoint get executor public void set executor executor executor endpoint set executor executor public int get max threads return endpoint get max threads public void set max threads int max threads endpoint set max threads max threads public int get thread priority return endpoint get thread priority public void set thread priority int thread priority endpoint set thread priority thread priority public int get backlog return endpoint get backlog public void set backlog int backlog endpoint set backlog backlog public int get port return endpoint get port public void set port int port endpoint set port port public inet address get address return endpoint get address public void set address inet address ia endpoint set address ia public boolean get tcp delay return endpoint get tcp delay public void set tcp delay boolean tcp delay endpoint set tcp delay tcp delay public int get so linger return endpoint get so linger public void set so linger int so linger endpoint set so linger so linger public int get so timeout return endpoint get so timeout public void set so timeout int so timeout endpoint set so timeout so timeout should done native webserver layer servlet container protected boolean tomcat true public boolean get tomcat return tomcat public void set tomcat boolean tomcat tomcat tomcat required secret protected string required secret null public void set required secret string required secret required secret required secret ajp packet size protected int packet size constants max packet size public int get packet size return packet size public void set packet size int packet size packet size constants max packet size packet size constants max packet size else packet size packet size number seconds tomcat wait subsequent request before closing connection public int get keep alive timeout return endpoint get keep alive timeout public void set keep alive timeout int timeout endpoint set keep alive timeout timeout public int get poll time return endpoint get poll time public void set poll time int poll time endpoint set poll time poll time public void set poller size int poller size endpoint set poller size poller size public int get poller size return endpoint get poller size proto endpoint get poller add socket get socket long value ajp apr processor processor new ajp apr processor proto packet size proto endpoint various classes protected string domain protected object name oname protected mbean server mserver public object name get object name return oname public string get domain return domain override public object name pre register mbean server server object name name throws exception oname name mserver server domain name get domain return name override public void post register boolean registration done noop override public void pre deregister throws exception noop override public void post deregister noop implements protocol handler mbean registration string manager package protected static final string manager sm string manager get manager constants package endpoint new jio endpoint protected object name tp oname protected object name rg oname associated java io endpoint protected jio endpoint endpoint new jio endpoint attributes protected hashtable string object attributes new hashtable string object adapter which process requests received endpoint private adapter adapter pass config info override public void set attribute string name object value log trace enabled log trace sm get string ajpprotocol setattribute name value attributes put name value override public object get attribute string key log trace enabled log trace sm get string ajpprotocol getattribute key return attributes get key override public iterator string get attribute names return attributes key set iterator adapter used call connector override public void set adapter adapter adapter adapter adapter override public adapter get adapter return adapter endpoint set handler handler override public void pause throws exception try endpoint pause catch exception ex log error sm get string ajpprotocol endpoint pauseerror ex throw ex log info enabled log info sm get string ajpprotocol pause get name override public void resume throws exception try endpoint resume catch exception ex log error sm get string ajpprotocol endpoint resumeerror ex throw ex log info enabled log info sm get string ajpprotocol resume get name override public void stop throws exception try endpoint stop catch exception ex log error sm get string ajpprotocol endpoint stoperror ex throw ex log info enabled log info sm get string ajpprotocol stop get name override public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name endpoint destroy tp oname null registry get registry null null unregister component tp oname rg oname null registry get registry null null unregister component rg oname public string get name string encoded addr get address null encoded addr get address encoded addr starts encoded addr encoded addr substring encoded addr urlencoder encode encoded addr return ajp encoded addr endpoint get port processor cache protected int processor cache public int get processor cache return processor cache public void set processor cache int processor cache processor cache processor cache override public executor get executor return endpoint get executor public void set executor executor executor endpoint set executor executor public int get max threads return endpoint get max threads public void set max threads int max threads endpoint set max threads max threads public int get thread priority return endpoint get thread priority public void set thread priority int thread priority endpoint set thread priority thread priority public int get backlog return endpoint get backlog public void set backlog int backlog endpoint set backlog backlog public int get port return endpoint get port public void set port int port endpoint set port port public inet address get address return endpoint get address public void set address inet address ia endpoint set address ia public boolean get tcp delay return endpoint get tcp delay public void set tcp delay boolean tcp delay endpoint set tcp delay tcp delay public int get so linger return endpoint get so linger public void set so linger int so linger endpoint set so linger so linger public int get so timeout return endpoint get so timeout public void set so timeout int so timeout endpoint set so timeout so timeout should done native webserver layer servlet container protected boolean tomcat true public boolean get tomcat return tomcat public void set tomcat boolean tomcat tomcat tomcat required secret protected string required secret null public void set required secret string required secret required secret required secret ajp packet size protected int packet size constants max packet size public int get packet size return packet size public void set packet size int packet size packet size constants max packet size packet size constants max packet size else packet size packet size number seconds tomcat wait subsequent request before closing connection protected int keep alive timeout public int get keep alive timeout return keep alive timeout public void set keep alive timeout int timeout keep alive timeout timeout ajp processor processor new ajp processor proto packet size proto endpoint various classes protected string domain protected object name oname protected mbean server mserver public object name get object name return oname public string get domain return domain override public object name pre register mbean server server object name name throws exception oname name mserver server domain name get domain return name override public void post register boolean registration done noop override public void pre deregister throws exception noop override public void post deregister noop
name null name length lookedup resource context lookup name name null name length lookedup resource context lookup name private static string normalize string jndi name jndi name null jndi name starts java comp env return jndi name substring 14 return jndi name fix bug 49956 bug handle case when resource annotation uses full jndi name resource based patch gurkan erdogdu markt fix
listeners may have been added servlet context initializers put them after ones we know about object event listener get application event listeners event listeners add event listener object lifecycle listener get application lifecycle listeners lifecycle listeners add lifecycle listener licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license check servlet container initializer can install link servlet context listener gets initialized throws exception public void test servlet container initializer throws exception tomcat tomcat get tomcat instance context context tomcat add context system get property java io tmpdir context add servlet container initializer new sci null tomcat start assert true scl initialized check link servlet context listener cannot install link servlet context initializer throws exception public void test servlet context listener throws exception tomcat tomcat get tomcat instance context context tomcat add context system get property java io tmpdir scl2 pretends web xml tries install servlet context initializer context add application listener scl2 class get name tomcat start check servlet context initializer wasn initialized assert false scl3 initialized public static class sci implements servlet container initializer override public void startup set class servlet context ctx throws servlet exception ctx add listener new scl public static class scl implements servlet context listener static boolean initialized false override public void context initialized servlet context event sce initialized true override public void context destroyed servlet context event sce noop public static class scl2 implements servlet context listener override public void context initialized servlet context event sce servlet context sc sce get servlet context sc add listener scl3 class get name override public void context destroyed servlet context event sce noop public static class scl3 implements servlet context listener static boolean initialized false override public void context initialized servlet context event sce initialized true override public void context destroyed servlet context event sce noop fix bug 49952 bug allow servlet container initializers add listeners web application patch provided david jencks markt fix
suppress warnings unchecked listener clazz new instance catch invocation target exception servlet exception se new servlet exception throw se catch naming exception servlet exception se new servlet exception throw se catch class found exception servlet exception se new servlet exception throw se filter matches more than one url pattern servlet name
private number number private number number private string string
exception javax management instance found exception managed resource object cannot found exception javax management mbean exception initializer object throws exception persistence supported exception javax management runtime operations exception exception reported persistence mechanism object name sname null try sname new object name catalina type store config mserver registered sname mserver invoke sname store config null null else log error store config mbean registered sname catch throwable exception utils handle throwable log error
executor new thread pool executor max spare threads max threads keep alive time time unit milliseconds
private static final int jvm bug threshold 16 private volatile int jvm bug count long before system current time millis sylvain laurent
integer value rmi registry port integer value rmi server port server name list all drivers visible class loader driver names add driver get class get canonical name
-1
public string get executor name object obj protocol handler get executor obj instanceof org apache catalina executor return org apache catalina executor obj get name return internal attribute name executor name description name executor any associated connector type java lang string writeable false bug 49856 bug add executor name attribute connectors so possible trace thread pool connector executor via jmx interface markt fix fix
parent get active count parent get pool size return super offer get active count method used properly handle work queue private final atomic integer active count new atomic integer active count decrement get override protected void before execute thread runnable active count increment get override public int get active count return active count get submitted count increment get submitted count decrement get submitted count decrement get submitted count decrement get bug 49730 bug fix race condition standard thread exector can cause requests experience large delays patch provided sylvain laurent markt fix fix
exception utils handle throwable exception utils handle throwable exception utils handle throwable copied from exception utils since class visible during start private static void handle throwable throwable instanceof thread death throw thread death instanceof virtual machine error throw virtual machine error all other instances throwable silently swallowed fix bug 50021 bug correct regression fix bug 46844 bug may have caused additional problems during failure start up markt fix
param jar file url jar file from which read included resource param tag file jar url location tag file param jar file jar file from which read jsp page tag file param tag file jar url url jar containing tag file
else server object already present must running service shutdown hook take care clean up system exit bug 49195 bug don report error when shutting down windows service tomcat instance has disabled shutdown port markt fix fix
string builder msg new string builder jsp get property bean name err page info prefix uri location err public tag library info impl jsp compilation context ctxt parser controller pc page info pi string prefix string uri tld location location error dispatcher err err jsp error jsp error file found tld name err jsp error jsp error tld unable read jar resource get url
check compression protected boolean compressable nope compression could works http also cf mod deflate compression only since http http11 return false check content already gzipped message bytes content encoding mb response get mime headers get value content encoding content encoding mb null content encoding mb index gzip return false check sufficient length trigger compression long content length response get content length long content length content length compression min size check compatible mime type compressable mime types null return starts string array compressable mime types response get content type return false boolean compressable false use compression compressable might compressed set vary header compressable bug 49625 bug ensure vary header set response may compressed rather than only setting compressed markt fix fix
class bytes offset
string method name constants method trans array method code name constants header trans array id string method name constants method trans array method code name constants header trans array id public static final string method trans array public static final string header trans array public static final string response trans array response trans hash put response trans array
classes from j2se java classes servlet api name null name starts java name starts javax servlet
session set primary session true entry get value null entry get value instanceof replicated map entry replicated map entry val replicated map entry entry get value val set owner get map owner get map owner object made primay key entry get value entry get value null entry get value instanceof replicated map entry replicated map entry val replicated map entry entry get value hack somehow being set above val set owner get map owner return parent class loader public class loader get parent class loader return outer catalina startup shutdown component present public catalina get catalina set outer catalina startup shutdown component present public void set catalina catalina catalina return parent class loader public class loader get parent class loader
return parent class loader component override public class loader get parent class loader parent class loader null return parent class loader service null return service get parent class loader return class loader get system class loader private catalina catalina null return outer catalina startup shutdown component present override public catalina get catalina return catalina set outer catalina startup shutdown component present override public void set catalina catalina catalina catalina catalina return parent class loader component override public class loader get parent class loader catalina null return catalina get parent class loader return class loader get system class loader type org apache catalina core standard context parameter name valve description new valve added type org apache catalina valve operation name remove valve description remove valve from context parameter name valve description new valve removed type org apache catalina valve operation name add lifecycle listener description add lifecycle listener context description new lifecycle listener added type org apache catalina lifecycle listener operation name remove lifecycle listener description remove lifecycle listener from context description new lifecycle listener removed type org apache catalina lifecycle listener operation name reload description reload operation name destroy description destroy context operation name find mapping object description return object which may utilized mapping component impact info return type org apache catalina context operation operation name find static resources description return naming resources associated web application impact info return type javax naming directory dir context group engine writeable false parameter name child description host object type org apache catalina container operation name start description start impact action return type void operation name stop description stop impact action return type void type org apache catalina core standard host type boolean operation name add child description add context impact action parameter name child description context added type org apache catalina container operation operation name start description start impact action return type void operation name stop description stop impact action return type void operation name init description init impact action return type void operation name destroy description destroy impact action return type void operation name find reloaded context memory leaks description provide list contexts have leaked memory reload attempt force full garbage collection use extreme caution production systems return type ljava lang string type org apache catalina core standard service attribute name managed resource description managed resource mbean associated type java lang object attribute name name description unique name service type java lang string attribute name container description servlet engine process requests type org apache catalina container parameter name connector description connector object type org apache catalina connector connector operation name start description start impact action return type void operation name stop description stop impact action return type void type org apache catalina core standard wrapper operation name add lifecycle listener description add lifecycle listener context parameter name listener description new lifecycle listener added type org apache catalina lifecycle listener operation name remove lifecycle listener description remove lifecycle listener from context description new lifecycle listener removed type org apache catalina lifecycle listener public class loader get parent class loader return parent class loader get server set catalina fix gsoc 2010 enable creation services engines connectors hosts contexts via jmx from minimal server xml contains only server element based patch chamith buddhika markt fix
method get name length clazz get name method get name substring public static string get name method setter string builder name new string builder setter get name remove set name delete lowercase first char name set char character lower case name char return name string
connection close descriptive information about realm protected static final string name combined realm
method should never called stack trace show where called from unsupported operation exception uoe new unsupported operation exception sm get string combined realm get name log error sm get string combined realm unexpected method uoe throw uoe
try protocol handler stop catch exception throw new lifecycle exception sm get string coyote connector protocol handler stop failed param name string public executor get executor string name name equals executor get name stop our defined connectors first heuristic sleep while ensure pause connector try thread sleep 1000 catch interrupted exception ignore fixme pero why container stop first keep alive connections can send request stop our defined connectors first lifecycle state initialized equals service fails start connectors may have been started while started error error async error public void destroy throws exception public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name while started error async error public void destroy throws exception public void destroy throws exception log info enabled log info sm get string ajpprotocol destroy get name public void destroy throws exception override public void destroy throws exception get log info enabled get log info sm get string destroy get name while error keep alive comet async comet async error input buffer next request output buffer next request recycle return socket state closed else return socket state long while error keep alive comet async comet async error recycle return socket state closed else return socket state long recycle while started error keep alive error public abstract void pause public abstract void resume pause endpoint which stop accepting new connections public void pause running paused paused true unlock accept heuristic sleep while ensure pause endpoint try thread sleep 1000 catch interrupted exception ignore resume endpoint which make start accepting new connections again public void resume running paused false public abstract void stop throws exception public abstract void init throws exception pause endpoint which make stop accepting new sockets override public void pause running paused paused true unlock accept resume endpoint which make start accepting new sockets again override public void resume running paused false paused pause get executor execute new socket options processor socket public void pause running paused paused true unlock accept override public void resume running paused false paused pause get executor execute new socket processor wrapper return state endpoint return true endpoint running false otherwise override public boolean running return running return state endpoint return true endpoint paused false otherwise override public boolean paused return paused pause endpoint which make stop accepting new sockets override public void pause running paused paused true unlock accept resume endpoint which make start accepting new sockets again override public void resume running paused false paused pause fix bug 49802 bug re factor connector pause stop destroy methods so calling any those methods has expected results markt fix private list element value pairs
annotation entry element value pairs new array list return element value pair element value pairs array new element value pair element value pairs size element value pair envp element value pair element value pairs get private static final map readers new hash map attribute reader attribute reader readers get name list accumulated annotations new array list annotations annotation entry accumulated annotations array new annotation entry accumulated annotations size public int compare object obj return get class name compare java class obj get class name private static final map unknown attributes new hash map private static int unwrap thread local tl return integer tl get int value private static void wrap thread local tl int value private static thread local consumed chars new thread local protected object initial value
construct new class loader defined repositories param parent our parent class loader name system property containing tomcat product installation path public static final string catalina home prop catalina home name system property containing tomcat instance installation path public static final string catalina base prop catalina base
system get property catalina base string base system get property catalina base new file system get property catalina base conf config base new file system get property catalina base conf file new file system get property catalina base host deployed new file system get property catalina base config base new file system get property catalina base conf file new file system get property catalina base file new file system get property catalina base file get path new file system get property catalina base conf file new file system get property catalina base pathname file new file system get property catalina base pathname protected static final string catalina home token catalina home protected static final string catalina base token catalina base system set property catalina home system set property catalina base system get property catalina base null system get property catalina home null system set property catalina base system get property catalina home system set property catalina base system get property catalina home null catalina home system set property catalina home system set property catalina home return system get property catalina home return system get property catalina base get catalina home file new file system get property catalina base config file string catalina home system get property catalina home else system get property catalina base null catalina home system get property catalina base catalina home catalina base catalina jar tomcat install catalina home tomcat jar system set property catalina home catalina home system get property catalina base null system set property catalina base string catalina base system get property catalina base system set property catalina base catalina base class loader cl catalina properties class get class loader system err println catalina proprties cl cl string cl cl get parent null system err println catalina proprties parent cl cl string return system get property catalina home return system get property catalina base get catalina home public void set catalina home string system set property catalina home public void set catalina base string system set property catalina base return system get property catalina home return system get property catalina base string catalina home system get property catalina home else system get property catalina base null catalina home system get property catalina base catalina home catalina base catalina jar tomcat install catalina home tomcat jar system set property catalina home catalina home system get property catalina base null system set property catalina base string catalina base system get property catalina base system set property catalina base catalina base app base new file system get property catalina base app base new file system get property catalina base file base new file system get property catalina base basedir system get property catalina base basedir system get property catalina home system set property catalina home basedir system set property catalina base basedir private static string catalina home system get property catalina home log error must set catalina home system property file new file system get property catalina base file new file system get property catalina base new file system get property catalina base pathname new new file system get property catalina base pathname old new file system get property catalina base pathname dir new file system get property catalina base directory system get property catalina home null project set basedir system get property catalina home string file adjust relative path system get property catalina base string file adjust relative path system get property catalina base key store file new file system get property catalina base crl file new file system get property catalina base crlf
bug 47950 bug align code webapp class loader validate code logger protected static org apache juli logging log log org apache juli logging log factory get log abstract output buffer class
go through filters gzip filter invoke flush int last active filter active filters instanceof gzip output filter log debug enabled log debug flushing gzip filter position filter chain gzip output filter active filters flush break licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license extension link gzipoutput stream workaround couple long standing jdk bugs href http bugs sun com bugdatabase view bug do bug id 4255743 bug 4255743 href http bugs sun com bugdatabase view bug do bug id 4813885 bug 4813885 so gzip output can flushed public flushable gzipoutput stream output stream os throws ioexception super os private static final byte new byte private boolean has data false here we make sure we have received data so header has been sure written output stream already override public synchronized void write byte bytes int int i1 throws ioexception super write bytes i1 has data true override public synchronized void write int throws ioexception super write has data true override public synchronized void write byte bytes throws ioexception super write bytes has data true override public synchronized void flush throws ioexception has data return do allow gzip header flushed its own trick deflater flush now tricky we force deflater flush its data switching compression level yet perplexingly simple workaround http developer java sun com developer bug parade bugs 4255743 html def finished def set input def set level deflater compression deflate def set level deflater default compression deflate out flush has data false more data flush keep calling deflate until runs dry default only does once can therefore hold onto data when need flushed out override protected void deflate throws ioexception int len do len def deflate buf buf length len out write buf len while len logger protected static org apache juli logging log log org apache juli logging log factory get log gzip output filter class compression stream new gzipoutput stream fake output stream added allow flushing happen gzip ed outputstream public void flush compression stream null try log debug enabled log debug flushing compression stream compression stream flush catch ioexception log debug enabled log debug ignored exception while flushing gzip filter compression stream new gzipoutput stream fake output stream
parent instanceof pipeline parent parent get parent continue valve valves pipeline parent get valves
process resource jars ordered fragments
jsp property get default content type null page info set content type jsp property get default content type leave until now since can only set once bug 49726 page info get content type null jsp property get default content type null page info set content type jsp property get default content type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public void test bug49726a throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk map string list string headers new hash map string list string get url http localhost get port test bug49726a jsp res headers check request completed string result res string assert echo result ok check content type assert true headers get content type get starts text html public void test bug49726b throws exception tomcat tomcat get tomcat instance file app dir new file test webapp tomcat add webapp null test app dir get absolute path tomcat start byte chunk res new byte chunk map string list string headers new hash map string list string get url http localhost get port test bug49726b jsp res headers check request completed string result res string assert echo result ok check content type assert true headers get content type get starts text plain assertion text printed tags echo private static void assert echo string result string expected assert true result index expected jsp config jsp property group default content type text plain default content type url pattern bug49726a jsp url pattern url pattern bug49726b jsp url pattern jsp property group jsp config licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license head title bug 49726 test case title head body ok body licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license head title bug 49726 test case title head body ok body subsection name jasper changelog fix bug 49726 bug specifying default content type via jsp property group should prevent page from setting some other content type markt fix changelog subsection
name starts javax servlet return false bug 47950 bug align code webapp class loader validate code javadoc ensure code javax servlet code classes can loaded code webapp class loader code instance patch provided pid markt fix fix suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match
public suppress warnings unchecked class get property type public object get context suppress warnings unchecked class key public void put context suppress warnings unchecked class key public suppress warnings unchecked iterator get feature descriptors public boolean wrapper class wrapped type public boolean wrapper class wrapped type suppress warnings unchecked tck signature fails generics suppress warnings unchecked tck signature fails generics suppress warnings unchecked tck signature test fails generics suppress warnings unchecked suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match public object get context suppress warnings unchecked class key public void put context suppress warnings unchecked class key suppress warnings unchecked class param types suppress warnings unchecked class param types suppress warnings unchecked can use class because api needs match super class suppress warnings unchecked can use class because api needs match super class suppress warnings unchecked api does use generics suppress warnings unchecked api does use generics suppress warnings unchecked overridden method uses raw type class instance variables public methods
class value get class override override override override override override override public static class map entry implements map entry override override override fix bug 49757 bug correct some generics warnings based patch provided gbor markt fix
impact annotations set true fix bug 49714 bug annotation process jar doesn influence element web xml kfujino fix
also tested implicitly numerous places elsewhere class public void test bug49655 throws exception call failed method expression me factory create method expression context bean set name new value null null rest check worked correctly me invoke context null value expression ve factory create value expression context bean name java lang string class assert equals new value ve get value context
int size sessions size sessions size max active sessions entry null entry primary value equals entry get value return true entry null entry primary entry null entry primary set add key entry null entry primary entry get value null counter entry null entry primary entry get value null values add entry get value return proxy backup public boolean active return proxy bug 49407 bug change backup manager so consistent delta manager reports both primary backup sessions when active sessions requested markt fix fix
flag indicates ssl attributes have been parsed improve performance applications usually frameworks make multiple calls link request get attribute names protected boolean ssl attributes parsed false ssl attributes parsed false ssl attributes parsed true secure
status socket status error status socket status stop status socket status disconnect async context get state async context impl async state dispatching runnable started started dispatching dispatching runnable dispatched completing completing runnable timing out error dispatching else state compare set async state dispatching runnable async state completing runnable do nothing state compare set async state started async state dispatching runnable state compare set async state dispatched async state dispatching runnable todo servlet3 async final servlet context sctx get servlet request get servlet context runnable new runnable public void run todo servlet3 async set context class loader when running task try run run catch exception log error unable run async task dispatch atomic boolean dispatched new atomic boolean false request get coyote request action action code action async dispatch dispatched dispatched get try do internal dispatch catch servlet exception sx throw new runtime exception sx catch ioexception ix throw new runtime exception ix state get async state dispatching state get async state dispatching runnable listener invoked http servlet response servlet response set status 500 do internal complete true else state get async state dispatching runnable dispatch null try dispatch run catch runtime exception do internal complete true get cause instanceof servlet exception throw servlet exception get cause get cause instanceof ioexception throw ioexception get cause else throw new servlet exception finally dispatch null state compare set async state completing runnable async state completing do internal complete false else state get async state dispatching runnable do internal complete true throw new illegal state exception failed call dispatch complete after start recycle recycle get url http localhost get port public void test async start complete throws exception setup tomcat instance tomcat tomcat get tomcat instance minimise pauses during test tomcat get connector set attribute connection timeout integer value 3000 must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async start complete servlet servlet new async start complete servlet wrapper wrapper tomcat add servlet ctx servlet servlet wrapper set async supported true ctx add servlet mapping servlet tomcat start call servlet first time byte chunk bc1 get url http localhost get port echo run1 assert equals ok run1 bc1 string call servlet second time request parameter byte chunk bc2 get url http localhost get port echo run2 assert equals ok run2 bc2 string public void test async start complete throws exception setup tomcat instance tomcat tomcat get tomcat instance must have real doc base just use temp context ctx tomcat add context system get property java io tmpdir async start complete servlet servlet new async start complete servlet wrapper wrapper tomcat add servlet ctx servlet servlet wrapper set async supported true ctx add servlet mapping servlet tomcat start call servlet once byte chunk bc get url http localhost get port assert equals ok bc string resp set content type text plain resp get writer print ok todo auto generated catch block print stack trace bug 49528 bug ensure async context async started returns correct value after async context start tomcat implements using internal dispatch requires slightly different treatment from standard dispatch ensure correct value returned markt h2 parameters h2 h3 tt expires active tt h3 directive enables disables generation tt expires tt tt cache control tt headers tt expires filter tt set tt off tt headers generated any http response set tt tt tt true tt headers added served http responses according criteria defined tt expires type lt content type gt tt tt expires default tt directives note directive does guarantee tt expires tt tt cache control tt header generated criteria aren x27 met header sent effect though directive wasn x27 even specified parameter optional default value tt true tt enable filter code pre lt init param gt lt supports case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt lt param value gt lt init param gt pre code disable filter code pre lt init param gt lt supports anything different from case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt off lt param value gt lt init param gt pre code li tt content type tt response matches one types active true
filter def add init parameter expires active off bug 48998 bug add expires filter port httpd mod expires module patch provided cyrille le clerc markt li tt content type tt response matches one types note directive only has effect tt expires active tt has been specified overrides specified mime type only any sample log message active true expiration date expiration date copyright 2008 2009 original author authors licensed under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license expires filter java servlet api port href http httpd apache org docs mod mod expires html apache mod expires add tt expires tt tt cache control max age tt headers http response according its tt content type tt following inspired tt mod expires tt h1 summary h1 filter controls setting tt expires tt http header tt max age tt directive tt cache control tt http header server responses expiration date can set relative either time source file last modified time client access http headers instruction client about document x27 validity persistence cached document may fetched from cache rather than from source until time has passed after cache copy considered quot expired quot invalid new copy must obtained from source modify tt cache control tt directives other than tt max age tt see href http www w3 org protocols rfc2616 rfc2616 sec14 html sec14 rfc 2616 section 14 you can use other servlet filters href http httpd apache org docs mod mod headers html apache httpd mod headers module h1 filter h1 h2 basic add x27 tt expires tt x27 x27 tt cache control max age tt x27 headers images css javascript h2 code pre lt web app gt lt filter gt lt filter name gt expires filter lt filter name gt lt filter class gt org apache catalina filters expires filter lt filter class gt lt init param gt lt param name gt expires type image lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text css lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text javascript lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt filter gt lt filter mapping gt lt filter name gt expires filter lt filter name gt lt url pattern gt lt url pattern gt lt dispatcher gt request lt dispatcher gt lt filter mapping gt lt web app gt pre code h2 parameters h2 h3 tt expires active tt h3 directive enables disables generation tt expires tt tt cache control tt headers tt expires filter tt set tt off tt headers generated any http response set tt tt tt true tt headers added served http responses according criteria defined tt expires type lt content type gt tt tt expires default tt directives note directive does guarantee tt expires tt tt cache control tt header generated criteria aren x27 met header sent effect though directive wasn x27 even specified parameter optional default value tt true tt enable filter code pre lt init param gt lt supports case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt lt param value gt lt init param gt pre code disable filter code pre lt init param gt lt supports anything different from case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt off lt param value gt lt init param gt pre code h3 tt expires type lt content type gt tt h3 directive defines value tt expires tt header tt max age tt directive tt cache control tt header generated documents specified type tt text html tt second argument sets number seconds added base time construct expiration date tt cache control max age tt calculated subtracting request time from expiration date expressing result seconds base time either last modification time file time client x27 access document which should used specified tt lt code gt tt field tt tt means file x27 last modification time should used base time tt tt means client x27 access time should used duration expressed seconds tt a2592000 tt stands tt access plus 30 days tt alternate syntax difference effect subtle tt tt tt modification tt alternate syntax used all current copies document all caches expire same time which can good something like weekly notice x27 always found same url tt tt tt access tt tt now tt alternate syntax used date expiration different each client can good image files don x27 change very often particularly set related documents all refer same images images accessed repeatedly within relatively short timespan strong example strong code pre lt init param gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt init param gt lt init param gt lt 2592000 seconds 30 days gt lt param name gt expires type image gif lt param name gt lt param value gt a2592000 lt param value gt lt init param gt pre code note directive only has effect tt expires active tt has been specified overrides specified mime type only any expiration date set tt expires default tt directive you can also specify expiration time calculation using alternate syntax described earlier document h3 tt expires excluded response status codes tt h3 directive defines http response status codes which tt expires filter tt generate expiration headers default tt 304 tt status code quot tt modified tt quot skipped value comma separated list http status codes directive useful ease usage tt expires default tt directive indeed behavior tt 304 modified tt which does specify tt content type tt header combined tt expires tt tt cache control max age tt headers can tricky understand sample code pre lt init param gt lt param name gt expires excluded response status codes lt param name gt lt param value gt 302 500 503 lt param value gt lt init param gt pre code h3 expires default h3 directive sets default algorithm calculating expiration time all documents affected realm can overridden type type basis tt expires type tt directive see description directive details about syntax argument alternate syntax description well h1 alternate syntax h1 tt expires default tt tt expires type tt directives can also defined more readable syntax form code pre lt init param gt lt param name gt expires default lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt init param gt lt init param gt lt param name gt expires type type encoding lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt init param gt pre code where tt lt base gt tt one ul li tt access tt li li tt now tt equivalent x27 tt access tt x27 li li tt modification tt li ul tt plus tt keyword optional tt lt num gt tt should integer value acceptable tt integer parse int tt tt lt type gt tt one ul li tt years tt li li tt months tt li li tt weeks tt li li tt days tt li li tt hours tt li li tt minutes tt li li tt seconds tt li ul example any following directives can used make documents expire month after being accessed default code pre lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus month lt param value gt lt init param gt lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus weeks lt param value gt lt init param gt lt init param gt lt param name gt expires default lt param name gt lt param value gt access plus 30 days lt param value gt lt init param gt pre code expiry time can fine tuned adding several x27 tt lt num gt lt type gt tt x27 clauses code pre lt init param gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt init param gt lt init param gt lt param name gt expires type image gif lt param name gt lt param value gt modification plus hours minutes lt param value gt lt init param gt pre code note you use modification date based setting tt expires tt header strong strong added content does come from file disk due fact modification time content h1 expiration headers generation eligibility h1 response eligible enriched tt expires filter tt ol li expiration header defined tt expires tt header tt max age tt directive tt cache control tt header li li response status code excluded directive tt expires excluded response status codes tt li li tt content type tt response matches one types defined tt expires type tt directives tt expires default tt directive defined li ol note ul li tt cache control tt header contains other directives than tt max age tt concatenated tt max age tt directive added tt expires filter tt li ul h1 expiration selection h1 expiration elected according following algorithm ol li tt expires type tt matching exact content type returned tt http servlet response get content type tt possibly including charset x27 tt text xml charset utf tt x27 li li tt expires type tt matching content type without charset tt http servlet response get content type tt contains charset x27 tt text xml charset utf tt x27 gt x27 tt text xml tt x27 li li tt expires type tt matching major type substring before x27 tt tt x27 tt http servlet response get content type tt x27 tt text xml charset utf tt x27 gt x27 tt text tt x27 li li tt expires default tt li ol h1 details h1 h2 when write expiration headers h2 tt expires filter tt traps x27 before write response body x27 event decide whether should generate expiration headers trap x27 before write response body x27 event tt expires filter tt wraps http servlet response x27 writer output stream intercept calls methods tt write tt tt print tt tt close tt tt flush tt empty response body empty files tt write tt tt print tt tt close tt tt flush tt methods called handle case tt expires filter tt end its tt do filter tt method manually triggers tt before write response body tt method h2 syntax h2 tt expires filter tt supports same syntax apache httpd mod expires challenge has been choose name tt lt param name gt tt associated tt expires type tt tt lt filter gt tt declaration indeed several tt expires type tt directives can declared when tt web xml tt syntax does allow declare several tt lt init param gt tt same name workaround has been declare content type tt lt param name gt tt rather than tt lt param value gt tt h2 designed extension open close principle h2 tt expires filter tt has been designed extension following open close principle key methods override extension ul li link eligible expiration header generation http servlet request xhttp servlet response li li link get expiration date http servlet request xhttp servlet response li ul h1 h1 troubleshoot enable logging tt org apache catalina filters expires filter tt extract logging properties code pre org apache catalina filters expires filter level fine pre code sample log message code pre mar 26 2010 01 41 pm org apache catalina filters expires filter init fine filter initialized expires filter active true excluded response status code 304 default null type image expires starting point access time duration 10 minute text css expires starting point access time duration 10 minute text javascript expires starting point access time duration 10 minute pre code sample per request log message where tt expires filter tt adds expiration date code pre mar 26 2010 09 47 pm org apache catalina filters expires filter before write response body fine request tomcat gif response status 200 content type image gif set expiration date 26 10 19 pm pre code sample per request log message where tt expires filter tt does add expiration date code pre mar 26 2010 10 27 pm org apache catalina filters expires filter before write response body fine request docs config manager html response status 200 content type text html expiration configured pre code duration composed link amount link unit protected static class duration public static duration minutes int amount return new duration amount duration unit minute public static duration seconds int amount return new duration amount duration unit second final protected int amount final protected duration unit unit public duration int amount duration unit unit super amount amount unit unit public int get amount return amount public duration unit get unit return unit override public string string return amount unit duration unit protected enum duration unit day calendar day year hour calendar hour minute calendar minute month calendar month second calendar second week calendar week year year calendar year private final int calendard field private duration unit int calendard field calendard field calendard field public int get calendard field return calendard field main piece filter can expressed like tt access plus month 15 days hours tt protected static class expires list duration elements private list duration durations starting point elaspse set response private starting point starting point public expires starting point starting point duration durations starting point arrays list durations public expires starting point starting point list duration durations super starting point starting point durations durations public list duration get durations return durations public starting point get starting point return starting point override public string string return expires starting point starting point duration durations expiration starting point either time html page servlet response served link starting point access time last time html page servlet response modified link starting point last modification time protected enum starting point access time last modification time wrapping extension link http servlet response yrap start write response body event performance optimization extended response holds link last modified header link cache control header values access slow link get header string spare tt string tt tt date tt tt long tt conversion public class xhttp servlet response extends http servlet response wrapper value tt cache control tt http response header has been set private string cache control header value tt last modified tt http response header has been set private long last modified header private boolean last modified header set private print writer print writer private http servlet request request private servlet output stream servlet output stream indicates whether calls write methods tt write tt tt print tt etc response body have been called private boolean write response body started public xhttp servlet response http servlet request request http servlet response response super response request request override public void add date header string name long date super add date header name date last modified header set last modified header date last modified header set true override public void add header string name string value super add header name value header cache control equals ignore case name cache control header null cache control header value public string get cache control header return cache control header public long get last modified header return last modified header override public servlet output stream get output stream throws ioexception servlet output stream null servlet output stream new xservlet output stream super get output stream request return servlet output stream override public print writer get writer throws ioexception print writer null print writer new xprint writer super get writer request return print writer public boolean last modified header set return last modified header set public boolean write response body started return write response body started override public void reset super reset last modified header last modified header set false cache control header null override public void set date header string name long date super set date header name date header last modified equals ignore case name last modified header date last modified header set true override public void set header string name string value super set header name value header cache control equals ignore case name cache control header value public void set write response body started boolean write response body started write response body started write response body started wrapping extension link print writer trap start write response body event public class xprint writer extends print writer private print writer out private http servlet request request private xhttp servlet response response public xprint writer print writer out http servlet request request xhttp servlet response response super out out out request request response response override public print writer append char fire before write response body event return out append override public print writer append char sequence csq fire before write response body event return out append csq override public print writer append char sequence csq int start int end fire before write response body event return out append csq start end override public void close fire before write response body event out close private void fire before write response body event response write response body started response set write response body started true before write response body request response override public void flush fire before write response body event out flush override public void print boolean fire before write response body event out print override public void print char fire before write response body event out print override public void print char fire before write response body event out print override public void print double fire before write response body event out print override public void print float fire before write response body event out print override public void print int fire before write response body event out print override public void print long fire before write response body event out print override public void print object obj fire before write response body event out print obj override public void print string fire before write response body event out print override public print writer printf locale string format object args fire before write response body event return out printf format args override public print writer printf string format object args fire before write response body event return out printf format args override public void println fire before write response body event out println override public void println boolean fire before write response body event out println override public void println char fire before write response body event out println override public void println char fire before write response body event out println override public void println double fire before write response body event out println override public void println float fire before write response body event out println override public void println int fire before write response body event out println override public void println long fire before write response body event out println override public void println object fire before write response body event out println override public void println string fire before write response body event out println override public void write char buf fire before write response body event out write buf override public void write char buf int off int len fire before write response body event out write buf off len override public void write int fire before write response body event out write override public void write string fire before write response body event out write override public void write string int off int len fire before write response body event out write off len wrapping extension link servlet output stream trap start write response body event public class xservlet output stream extends servlet output stream private http servlet request request private xhttp servlet response response private servlet output stream servlet output stream public xservlet output stream servlet output stream servlet output stream http servlet request request xhttp servlet response response super servlet output stream servlet output stream response response request request override public void close throws ioexception fire before write response body event servlet output stream close private void fire before write response body event response write response body started response set write response body started true before write response body request response override public void flush throws ioexception fire before write response body event servlet output stream flush override public void print boolean throws ioexception fire before write response body event servlet output stream print override public void print char throws ioexception fire before write response body event servlet output stream print override public void print double throws ioexception fire before write response body event servlet output stream print override public void print float throws ioexception fire before write response body event servlet output stream print override public void print int throws ioexception fire before write response body event servlet output stream print override public void print long throws ioexception fire before write response body event servlet output stream print override public void print string throws ioexception fire before write response body event servlet output stream print override public void println throws ioexception fire before write response body event servlet output stream println override public void println boolean throws ioexception fire before write response body event servlet output stream println override public void println char throws ioexception fire before write response body event servlet output stream println override public void println double throws ioexception fire before write response body event servlet output stream println override public void println float throws ioexception fire before write response body event servlet output stream println override public void println int throws ioexception fire before write response body event servlet output stream println override public void println long throws ioexception fire before write response body event servlet output stream println override public void println string throws ioexception fire before write response body event servlet output stream println override public void write byte throws ioexception fire before write response body event servlet output stream write override public void write byte int off int len throws ioexception fire before write response body event servlet output stream write off len override public void write int throws ioexception fire before write response body event servlet output stream write link pattern comma delimited string support whitespace characters private static final pattern comma separated values pattern pattern compile private static final string header cache control cache control private static final string header expires expires private static final string header last modified last modified private static final log log log factory get log expires filter class private static final string parameter expires active expires active private static final string parameter expires type expires type private static final string parameter expires default expires default private static final string parameter expires excluded response status codes expires excluded response status codes convert comma delimited list numbers tt int tt param comma delimited ints can code null code return never code null code array protected static int comma delimited list int array string comma delimited ints string ints strings comma delimited list string array comma delimited ints int ints new int ints strings length int ints strings length string int string ints strings try ints integer parse int int string catch number format exception throw new runtime exception exception parsing number zero based comma delimited list comma delimited ints return ints convert given comma delimited list strings array string return array patterns non code null code protected static string comma delimited list string array string comma delimited strings return comma delimited strings null comma delimited strings length new string comma separated values pattern split comma delimited strings return code true code given code str code contains given code search str code protected static boolean contains string str string search str str null search str null return false return str index search str convert array ints comma delimited string protected static string ints comma delimited string int ints ints null return string builder result new string builder int ints length result append ints ints length result append return result string return code true code given code str code code null code has zero characters length protected static boolean empty string str return str null str length return code true code given code str code has least one character can withespace protected static boolean empty string str return empty str return code true code given code string code starts given code prefix code ignoring case param string can code null code param prefix can code null code protected static boolean starts ignore case string string string prefix string null prefix null return string null prefix null prefix length string length return false return string region matches true prefix prefix length return subset given code str code before first occurence given code separator code return code null code given code str code given code separator code null return empty string code separator code empty param str can code null code param separator can code null code return protected static string substring before string str string separator str null str empty separator null return null separator empty return int separator index str index separator separator index return str return str substring separator index see active private boolean active true default expires private expires default expires list response status code which link expires filter generate expiration headers private int excluded response status codes new int http servlet response sc modified expires content type visible test private map string expires expires content type new linked hash map string expires public void do filter servlet request request servlet response response filter chain chain throws ioexception servlet exception request instanceof http servlet request response instanceof http servlet response http servlet request http request http servlet request request http servlet response http response http servlet response response response committed log debug enabled log debug sm get string expires filter response already commited http request get request url chain do filter request response else active xhttp servlet response response new xhttp servlet response http request http response chain do filter request response response write response body started empty response manually trigger before write response body before write response body http request response else log debug enabled log debug sm get string expires filter filter active http request get request url chain do filter request response else chain do filter request response public expires get default expires return default expires public string get excluded response status codes return ints comma delimited string excluded response status codes public int get excluded response status codes ints return excluded response status codes returns expiration date given link xhttp servlet response code null code expiration date has been configured declared content type code protected code extension see http servlet response get content type protected date get expiration date xhttp servlet response response string content type response get content type lookup exact content type match text html charset iso 8859 expires expires content type get content type null date result get expiration date response log error enabled log error sm get string expires filter use matching content type content type result return result contains content type lookup content type without charset match text html string content type without charset substring before content type trim expires content type get content type without charset null date result get expiration date response log error enabled log error sm get string expires filter use matching content type without charset content type result return result contains content type lookup major type match text string major type substring before content type expires content type get major type null date result get expiration date response log error enabled log error sm get string expires filter use matching major type content type result return result default expires null date result get expiration date default expires response log error enabled log error sm get string expires filter use default default expires content type result return result log error enabled log error sm get string expires filter expiration configured content type content type return null returns expiration date given link expires link http servlet request link xhttp servlet response code protected code extension protected date get expiration date expires xhttp servlet response response calendar calendar switch get starting point case access time calendar calendar get instance break case last modification time response last modified header set try long last modified response get last modified header calendar calendar get instance calendar set time millis last modified catch number format exception default now calendar calendar get instance else last modified header found use now calendar calendar get instance break default throw new illegal state exception sm get string expires filter unsupported starting point get starting point duration duration get durations calendar add duration get unit get calendard field duration get amount return calendar get time public map string expires get expires content type return expires content type override protected log get logger return log override public void init filter config filter config throws servlet exception enumeration string names filter config get init parameter names names has more elements string name names next element string value filter config get init parameter name try name starts parameter expires type string content type name substring parameter expires type length trim expires expires parse expires value expires content type put content type expires else name equals ignore case parameter expires default expires expires parse expires value default expires expires else name equals ignore case parameter expires active active equals ignore case value boolean value value boolean value else name equals ignore case parameter expires excluded response status codes excluded response status codes comma delimited list int array value else log warn sm get string expires filter unknown parameter ignored name value catch runtime exception throw new servlet exception sm get string expires filter exception processing parameter name value log debug sm get string expires filter filter initialized string indicates filter active code false code filter pass through default code true code public boolean active return active code protected code extension protected boolean eligible expiration header generation http servlet request request xhttp servlet response response boolean expiration header has been set response contains header header expires contains response get cache control header max age expiration header has been set log debug enabled log debug sm get string expires filter expiration header already defined request get request uri integer value response get status response get content type return false int skipped status code excluded response status codes response get status skipped status code log debug enabled log debug sm get string expires filter skipped status code request get request uri integer value response get status response get content type return false return true expiration header has been set servlet expiration has been defined link expires filter sets tt expires tt header attribute tt max age tt tt cache control tt header must called start write response body event invocations tt logger debug tt guarded link logger debug enabled because link http servlet request get request uri link http servlet response get content type costs tt string tt objects tomcat public void before write response body http servlet request request xhttp servlet response response eligible expiration header generation request response return date expiration date get expiration date response expiration date null log debug enabled log debug sm get string expires filter expiration configured request get request uri integer value response get status response get content type else log debug enabled log debug sm get string expires filter set expiration date request get request uri integer value response get status response get content type expiration date string max age directive max age expiration date get time system current time millis 1000 string cache control header response get cache control header string new cache control header cache control header null max age directive cache control header max age directive response set header header cache control new cache control header response set date header header expires expiration date get time parse lines like tt access plus month 15 days hours tt tt modification day hours seconds tt param input line protected expires parse expires string input line string line input line trim string tokenizer tokenizer new string tokenizer line string current token try current token tokenizer next token catch element exception throw new illegal state exception sm get string expires filter starting point found line starting point starting point access equals ignore case current token now equals ignore case current token starting point starting point access time else modification equals ignore case current token starting point starting point last modification time else tokenizer has more tokens starts ignore case current token starting point starting point access time trick convert duration from old new style tokenizer new string tokenizer current token substring seconds else tokenizer has more tokens starts ignore case current token starting point starting point last modification time trick convert duration from old new style tokenizer new string tokenizer current token substring seconds else throw new illegal state exception sm get string expires filter starting point invalid current token line try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration found directive line plus equals ignore case current token skip try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration found directive line list duration durations new array list duration while current token null int amount try amount integer parse int current token catch number format exception throw new illegal state exception sm get string invalid duration number directive current token line try current token tokenizer next token catch element exception throw new illegal state exception sm get string duration unit found after amount directive integer value amount line duration unit duration unit years equals ignore case current token duration unit duration unit year else month equals ignore case current token months equals ignore case current token duration unit duration unit month else week equals ignore case current token weeks equals ignore case current token duration unit duration unit week else day equals ignore case current token days equals ignore case current token duration unit duration unit day else hour equals ignore case current token hours equals ignore case current token duration unit duration unit hour else minute equals ignore case current token minutes equals ignore case current token duration unit duration unit minute else second equals ignore case current token seconds equals ignore case current token duration unit duration unit second else throw new illegal state exception sm get string invalid duration unit years months weeks days hours minutes seconds directive current token line duration duration new duration amount duration unit durations add duration tokenizer has more tokens current token tokenizer next token else current token null return new expires starting point durations public void set active boolean active active active public void set default expires expires default expires default expires default expires public void set excluded response status codes int excluded response status codes excluded response status codes excluded response status codes public void set expires content type map string expires expires content type expires content type expires content type override public string string return get class get simple name active active excluded response status code ints comma delimited string excluded response status codes default default expires type expires content type licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final string temp dir system get property java io tmpdir public void test throws exception tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def add init parameter expires default access plus month filter def add init parameter expires type text html access plus month 15 days hours filter def add init parameter expires type image gif modification plus hours minutes filter def add init parameter expires type image jpg a10000 filter def add init parameter expires type video mpeg m20000 filter def add init parameter expires active off filter def add init parameter expires excluded response status codes 304 503 expires filter expires filter new expires filter filter def set filter expires filter filter def set filter class expires filter class get name filter def set filter name expires filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name expires filter class get name filter map add urlpattern tomcat start try assert assert equals false expires filter active verify excluded response status codes int excluded response status codes expires filter get excluded response status codes ints assert assert equals excluded response status codes length assert assert equals 304 excluded response status codes assert assert equals 503 excluded response status codes verify default expires expires expires filter get default expires assert assert equals starting point access time expires get starting point assert assert equals expires get durations size assert assert equals duration unit month expires get durations get get unit assert assert equals expires get durations get get amount verify text html expires expires expires filter get expires content type get text html assert assert equals starting point access time expires get starting point assert assert equals expires get durations size duration one month expires get durations get assert assert equals duration unit month one month get unit assert assert equals one month get amount duration fifteen days expires get durations get assert assert equals duration unit day fifteen days get unit assert assert equals 15 fifteen days get amount duration two hours expires get durations get assert assert equals duration unit hour two hours get unit assert assert equals two hours get amount verify image gif expires expires expires filter get expires content type get image gif assert assert equals starting point last modification time expires get starting point assert assert equals expires get durations size duration five hours expires get durations get assert assert equals duration unit hour five hours get unit assert assert equals five hours get amount duration three minutes expires get durations get assert assert equals duration unit minute three minutes get unit assert assert equals three minutes get amount verify image jpg expires expires expires filter get expires content type get image jpg assert assert equals starting point access time expires get starting point assert assert equals expires get durations size duration ten thousand seconds expires get durations get assert assert equals duration unit second ten thousand seconds get unit assert assert equals 10000 ten thousand seconds get amount verify video mpeg expires expires expires filter get expires content type get video mpeg assert assert equals starting point last modification time expires get starting point assert assert equals expires get durations size duration twenty thousand seconds expires get durations get assert assert equals duration unit second twenty thousand seconds get unit assert assert equals 20000 twenty thousand seconds get amount finally tomcat stop test resource empty content also processed public void test empty content throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text plain content written response validate servlet integer value 60 public void test parse expires combined duration expires filter expires filter new expires filter expires actual expires filter parse expires access plus month 15 days hours assert assert equals starting point access time actual get starting point assert assert equals actual get durations size public void test parse expires mono duration expires filter expires filter new expires filter expires actual expires filter parse expires access plus hours assert assert equals starting point access time actual get starting point assert assert equals actual get durations size assert assert equals actual get durations get get amount assert assert equals duration unit hour actual get durations get get unit public void test skip because cache control max age defined throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response add header cache control private max age 232 response get writer print hello world validate servlet integer value 232 public void test excluded response status code throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set status http servlet response sc modified response add header etag 1934 response add date header date system current time millis validate servlet null http servlet response sc modified public void test null content type throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type null validate servlet integer value 60 public void test skip because expires defined throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response add date header expires system current time millis response get writer print hello world validate servlet null public void test use content type expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset utf response get writer print hello world validate servlet integer value 60 public void test use content type without charset expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text xml charset iso 8859 response get writer print hello world validate servlet integer value 60 public void test use default throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type image jpeg response get writer print hello world validate servlet integer value 60 public void test use default throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type image jpeg response add header cache control private response get writer print hello world validate servlet integer value 60 public void test use major type expires throws exception http servlet servlet new http servlet private static final long serial version uid 1l override protected void service http servlet request request http servlet response response throws servlet exception ioexception response set content type text json charset iso 8859 response get writer print hello world validate servlet integer value 60 protected void validate http servlet servlet integer expected max age seconds throws exception validate servlet expected max age seconds http http ok protected void validate http servlet servlet integer expected max age seconds int expected response status code throws exception setup tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def add init parameter expires default access plus minute filter def add init parameter expires type text xml charset utf access plus minutes filter def add init parameter expires type text xml access plus minutes filter def add init parameter expires type text access plus minutes filter def add init parameter expires excluded response status codes 304 503 filter def set filter class expires filter class get name filter def set filter name expires filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name expires filter class get name filter map add urlpattern root add filter map filter map tomcat add servlet root servlet get class get name servlet root add servlet mapping test servlet get class get name tomcat start try calendar get instance time zone get time zone gmt long time before millis system current time millis test http http http new url http localhost tomcat get connector get port test open connection validate assert assert equals expected response status code http get response code string builder msg new string builder entry string list string field http get header fields entry set string value field get value msg append field get key null field get key value system out println msg integer actual max age seconds string cache control header http get header field cache control cache control header null actual max age seconds null else actual max age seconds null string tokenizer cache control tokenizer new string tokenizer cache control header while cache control tokenizer has more tokens actual max age seconds null string cache directive cache control tokenizer next token string tokenizer cache directive tokenizer new string tokenizer cache directive cache directive tokenizer count tokens string key cache directive tokenizer next token trim string value cache directive tokenizer next token trim key equals ignore case max age actual max age seconds integer value value expected max age seconds null assert assert null actual max age seconds actual max age seconds should null actual max age seconds return assert assert null actual max age seconds suppress warnings null int delta seconds math abs actual max age seconds int value expected max age seconds int value assert assert true actual max age seconds actual max age seconds expected max age seconds expected max age seconds request time time before millis content type http get content type delta seconds finally tomcat stop public void test ints comma delimited string string actual expires filter ints comma delimited string new int 500 503 string expected 500 503 assert assert equals expected actual add bug 48998 bug add expires filter port httpd mod expires module patch provided cyrille le clerc markt add subsection name introduction expires filter java servlet api port href http httpd apache org docs mod mod expires html apache mod expires filter controls setting tt expires tt http header tt max age tt directive tt cache control tt http header server responses expiration date can set relative either time source file last modified time client access http headers instruction client about document x27 validity persistence cached document may fetched from cache rather than from source until time has passed after cache copy considered quot expired quot invalid new copy must obtained from source modify tt cache control tt directives other than tt max age tt see href http www w3 org protocols rfc2616 rfc2616 sec14 html sec14 rfc 2616 section 14 you can use other servlet filters href http httpd apache org docs mod mod headers html apache httpd mod headers module subsection subsection name basic sample basic add tt expires tt tt cache control max age tt headers images css javascript source lt filter name gt expires filter lt filter name gt lt filter class gt org apache catalina filters expires filter lt filter class gt lt init param gt lt param name gt expires type image lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text css lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt init param gt lt param name gt expires type text javascript lt param name gt lt param value gt access plus 10 minutes lt param value gt lt init param gt lt filter name gt expires filter lt filter name gt lt url pattern gt lt url pattern gt lt dispatcher gt request lt dispatcher gt source subsection subsection name alternate syntax tt expires default tt tt expires type tt directives can also defined more readable syntax form source lt param name gt expires default lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt param name gt expires type type lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt lt param name gt expires type type encoding lt param name gt lt param value gt lt base gt plus lt num gt lt type gt lt param value gt source where tt lt base gt tt one ul li tt access tt li li tt now tt equivalent x27 tt access tt x27 li li tt modification tt li ul tt plus tt keyword optional tt lt num gt tt should integer value acceptable tt integer parse int tt tt lt type gt tt one ul li tt years tt li li tt months tt li li tt weeks tt li li tt days tt li li tt hours tt li li tt minutes tt li li tt seconds tt li ul example any following directives can used make documents expire month after being accessed default source lt param name gt expires default lt param name gt lt param value gt access plus month lt param value gt lt param name gt expires default lt param name gt lt param value gt access plus weeks lt param value gt lt param name gt expires default lt param name gt lt param value gt access plus 30 days lt param value gt lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt param name gt expires type image gif lt param name gt lt param value gt modification plus hours minutes lt param value gt source note you use modification date based setting tt expires tt header strong strong added content does come from file disk due fact modification time content subsection subsection name expiration headers generation eligibility response eligible enriched tt expires filter tt ol li expiration header defined tt expires tt header tt max age tt directive tt cache control tt header li li response status code excluded directive tt expires excluded response status codes tt li li tt content type tt response matches one types defined tt expires type tt directives tt expires default tt directive defined li ol note tt cache control tt header contains other directives than tt max age tt concatenated tt max age tt directive added tt expires filter tt subsection subsection name expiration selection expiration elected according following algorithm ol li tt expires type tt matching exact content type returned tt http servlet response get content type tt possibly including charset x27 tt text xml charset utf tt x27 li li tt expires type tt matching content type without charset tt http servlet response get content type tt contains charset x27 tt text xml charset utf tt x27 gt x27 tt text xml tt x27 li li tt expires type tt matching major type substring before x27 tt tt x27 tt http servlet response get content type tt x27 tt text xml charset utf tt x27 gt x27 tt text tt x27 li li tt expires default tt li ol subsection subsection name filter class name filter class name expires filter strong code org apache catalina filters expires filter code strong subsection subsection name parameters strong expires filter strong supports following parameters attributes attribute name expires active required false directive enables disables generation tt expires tt tt cache control tt headers tt expires filter tt set tt off tt headers generated any http response set tt tt tt true tt headers added served http responses according criteria defined tt expires type lt content type gt tt tt expires default tt directives note directive does guarantee tt expires tt tt cache control tt header generated criteria aren x27 met header sent effect though directive wasn x27 even specified default value tt true tt sample enable filter source lt supports case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt lt param value gt source sample disable filter source lt supports anything different from case insensitive x27 x27 x27 true x27 gt lt param name gt expires active lt param name gt lt param value gt off lt param value gt source attribute attribute name expires excluded response status codes required false directive defines http response status codes which tt expires filter tt generate expiration headers default tt 304 tt status code quot tt modified tt quot skipped value comma separated list http status codes directive useful ease usage tt expires default tt directive indeed behavior tt 304 modified tt which does specify tt content type tt header combined tt expires tt tt cache control max age tt headers can tricky understand sample exclude response status codes 302 500 503 source lt param name gt expires excluded response status codes lt param name gt lt param value gt 302 500 503 lt param value gt source attribute attribute name expires type lt content type gt required false directive defines value tt expires tt header tt max age tt directive tt cache control tt header generated documents specified type tt text html tt second argument sets number seconds added base time construct expiration date tt cache control max age tt calculated subtracting request time from expiration date expressing result seconds base time either last modification time file time client x27 access document which should used specified tt lt code gt tt field tt tt means file x27 last modification time should used base time tt tt means client x27 access time should used duration expressed seconds tt a2592000 tt stands tt access plus 30 days tt alternate syntax difference effect subtle tt tt tt modification tt alternate syntax used all current copies document all caches expire same time which can good something like weekly notice x27 always found same url tt tt tt access tt tt now tt alternate syntax used date expiration different each client can good image files don x27 change very often particularly set related documents all refer same images images accessed repeatedly within relatively short timespan strong note strong when content type includes charset tt expires type text xml charset utf tt tomcat removes blank chars between tt tt tt charset tt keyword due expiration charset must strong strong include space character sample source lt param name gt expires type text html lt param name gt lt param value gt access plus month 15 days hours lt param value gt lt 2592000 seconds 30 days gt lt param name gt expires type image gif lt param name gt lt param value gt a2592000 lt param value gt source note directive only has effect tt expires active tt has been specified overrides specified mime type only any expiration date set tt expires default tt directive you can also specify expiration time calculation using alternate syntax described earlier document attribute attribute name expires default required false directive sets default algorithm calculating expiration time all documents affected realm can overridden type type basis tt expires type tt directive see description directive details about syntax argument alternate syntax description well attribute attributes subsection subsection name troubleshoot enable logging tt org apache catalina filters expires filter tt extract logging properties source source sample log message source active true excluded response status code 304 default null type image expires starting point access time duration 10 minute text css expires starting point access time duration 10 minute text javascript expires starting point access time duration 10 minute source sample per request log message where tt expires filter tt adds expiration date source source sample per request log message where tt expires filter tt does add expiration date source source subsection
-1
catch exception sleep
catch exception allow exec use exec command enabled false allow exec use exec command enabled false
allow exec boolean parse boolean config get init parameter allow exec debug public ssiprocessor ssiexternal resolver ssi external resolver int debug allow exec allow exec add command exec new ssiexec allow exec boolean parse boolean get servlet config get init parameter allow exec debug private resource bundle bundle private locale locale
resource bundle bnd null bundle resource bundle get bundle bundle name locale get default bundle resource bundle get bundle bundle bnd else locale null private static hashtable string string manager managers text type iso 8859 rfc2616 explicitly states browsers must use iso 8859 however browsers may attempt browsers have option enable public void destroy noop
new response wrapper http servlet response response public void init filter config filter config throws servlet exception noop wrapper adds default character set text media types character set specified public class response wrapper extends http servlet response wrapper ct null ct starts text ct index charset use get character encoding case charset has already been set separate call super set content type ct charset get character encoding public response wrapper http servlet response response super response add default character set filter does support any parameters fix bug 49570 bug when using example compression filter set vary header compressed responses markt fix
string vary response get header vary vary null add new vary header response set header vary accept encoding else vary equals action required else merge current header response set header vary vary accept encoding
try protocol handler init catch exception throw new lifecycle exception sm get string coyote connector protocol handler failed protocol handlers do follow lifecycle conventions protocol handler init needs wait until connector start try protocol handler init catch exception throw new lifecycle exception sm get string coyote connector protocol handler failed mapper listener doesn follow lifecycle conventions either protocol handlers do follow lifecycle conventions protocol handler destroy needs called connector stop try protocol handler destroy catch exception throw new lifecycle exception sm get string coyote connector protocol handler destroy failed mapper listener doesn follow lifecycle conventions either try protocol handler destroy catch exception throw new lifecycle exception sm get string coyote connector protocol handler destroy failed bug 49503 bug make sure connectors bind associated ports sufficiently early allow jsvc org apache catalina startup exit init failure system property operate correctly markt fix fix
open default web xml file exists file default context file new file get base dir default context xml
suppress warnings deprecation space deprecated cannot replaced white space space deprecated cannot replaced white space fix bug 49550 bug supress deprecation warning where deprecated code required used functional change patch provided sebb markt fix
get state available try child get state available child stop catch lifecycle exception log error container base remove child stop catch lifecycle exception log error container base remove child stop bug 49530 bug contexts servlets stopped when tomcat shut down markt fix fix
context point likely root context has been deployed request get context null res set status 404 res set message found context so use host request get host log access request response true return false mapper add host host get name aliases host get object name string host name context get parent get name mapper add context host name context name context welcome files resources get context null return null return host get context get parent return host mapping data host param host host object string host name string path object context add host host name new string host host hosts pos host name equals host name synchronized host context contexts host context list contexts slash count host context list nesting host context list nesting slash count host context list contexts new contexts
handle special case root context where cookies require path servlet spec uses empty string context path length context path fix bug 49525 bug ensure cookies root context have path rather than empty string markt fix
type naming resources get object name key properties new string builder j2ee type web module name string host name get parent get name host name null key properties append default key properties append host name key properties append key properties append path name key properties append key properties append get key properties append j2eeserver key properties append get j2eeserver return key properties string private final int nonce cache size
suppress warnings unchecked lru cache string nonce cache lru cache string req get session true get attribute constants csrf nonce session attr name string expected nonce string req get session true get attribute constants csrf nonce session attr name expected nonce null expected nonce equals previous nonce nonce cache null nonce cache new lru cache string nonce cache size req get session set attribute constants csrf nonce session attr name nonce cache req get session true set attribute constants csrf nonce session attr name new nonce protected static final string nonce session org apache catalina manager nonce protected static final string nonce request nonce string request nonce request get parameter nonce request check nonce must nonce session before any post processed http session session request get session string session nonce string session get attribute nonce session session nonce null message sm get string html manager servlet nonce command reset command command null else session nonce equals request nonce nonce mis match message sm get string html manager servlet nonce mismatch command reset command command null string new nonce generate nonce request get session set attribute nonce session new nonce context context context host find child context path context null args context get display name args new boolean context get available context get manager null context get manager get active sessions args new object 15 manager manager context get manager context get manager get max inactive interval 60 args 14 new nonce context get path equals context get path else context get available deployed else context get available deployed else context get available deployed args new object args new nonce args new object args new nonce args new object args new nonce args sm get string html manager servlet diagnostics leak warning args sm get string html manager servlet diagnostics leak button context context context host find child search path null context session sessions context get manager find sessions context context context host find child search path null context session session context get manager find session id get servlet context get request dispatcher session detail jsp path include req resp small href target blank small td input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value 14 input type hidden name nonce request value input type hidden name nonce request value input type hidden name nonce request value input type submit value small small you authorized view page you have changed string submit url http servlet request page context get request get request url string string attribute name string attribute names enumeration next element string submit url http servlet request page context get request get request uri path path header named code remote ipheader code default value code forwarded code values processed right left order li td remote ipheader td code remote ipheader code td lt param name gt remote ipheader lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipproxies header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipheader lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipproxies header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipheader lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipproxies header lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipheader lt param name gt lt param value gt forwarded lt param value gt lt param name gt remote ipproxies header lt param name gt lt param value gt forwarded lt param value gt
protected static final string remote ip header parameter remote ipheader see set remote ipheader string private string remote ipheader forwarded string remote ipheader value comma delimited list string array request get header remote ipheader loop remote ipheader value find first trusted remote ip build proxies chain idx remote ipheader value length idx idx string current remote ip remote ipheader value idx continue loop remote ipheader value build new value remote ipheader string current remote ip remote ipheader value idx request remove header remote ipheader request set header remote ipheader comma delimited remote ip header value original scheme request get scheme original remote ipheader request get header remote ipheader original protocol header request get scheme new secure request secure new remote ipheader request get header remote ipheader new proxies header request get header proxies header public string get remote ipheader return remote ipheader set remote ipheader filter config get init parameter remote ip header parameter public void set remote ipheader string remote ipheader remote ipheader remote ipheader comma delimited list proxies trusted when appear link remote ipheader header can expressed header named code remote ipheader code default value code forwarded code values processed right left order li td remote ipheader td code remote ipheader code td remote ipheader forwarded remote ipproxies header forwarded remote ipheader forwarded remote ipproxies header forwarded remote ipheader forwarded remote ipproxies header forwarded remote ipheader forwarded remote ipproxies header forwarded string remote ipheader value comma delimited list string array request get header remote ip header loop remote ipheader value find first trusted remote ip build proxies chain idx remote ipheader value length idx idx string current remote ip remote ipheader value idx continue loop remote ipheader value build new value remote ipheader string current remote ip remote ipheader value idx lt param name gt remote ipheader lt param name gt lt param name gt remote ipproxies header lt param name gt lt param name gt remote ipheader lt param name gt lt param name gt remote ipproxies header lt param name gt lt param name gt remote ipheader lt param name gt lt param name gt remote ipproxies header lt param name gt lt param name gt remote ipheader lt param name gt lt param name gt remote ipproxies header lt param name gt attribute name remote ipheader required false attribute name remote ipheader required false private long counter send evt all session data private int counter receive evt all session
return returns counter receive evt change session id public long get counter receive evt change session id return counter receive evt change session id change session id current session new randomly generated session id param session session change session id override public void change session id session session change session id session true public void change session id session session boolean notify original session id string org session id session get id super change session id session notify changed session id string new session id session get id try serialize session id byte data serialize session id new session id notify change session id session message msg new session message impl get name session message evt change session id data org session id org session id system current time millis counter send evt change session id send msg catch ioexception log error sm get string delta manager unable serialize session id new session id serialize session id throws ioexception input output error occurs protected byte serialize session id string session id throws ioexception byte array output stream bos new byte array output stream object output stream oos new object output stream bos oos write utf session id oos flush oos close return bos byte array load session id throws ioexception input output error occurs protected string deserialize session id byte data throws ioexception replication stream ois get replication stream data string session id ois read utf ois close return session id case session message evt session delta counter receive evt change session id counter send evt change session id case session message evt change session id handle change session id msg sender break li pre public static final int evt attribute added pre li li pre public static final int evt attribute removed pre li li pre public static final int evt session expired wonotify pre li li pre public static final int evt session expired wnotify pre li li pre public static final int evt set user principal pre li li pre public static final int evt set session note pre li li pre public static final int evt remove session note pre li evt session expired xxxx br parameters session id must set br evt change session id br send original session id new session id br case evt change session id return session id changed name counter receive evt change session id description count receive evt change session id messages type long writeable false attribute name counter send evt change session id description count send evt change session id messages type long writeable false attribute org apache catalina cluster cluster single sign protected static final string info org apache catalina session cluster single sign listener protected static final string info org apache catalina session cluster session listener
-1
code false code used should tomcat attempt terminate any link java util timer thread have been started web application specified default value code false code used private boolean clear references stop timer threads false return clear references stop timer threads flag context public boolean get clear references stop timer threads return clear references stop timer threads set clear references stop timer threads feature context param clear references stop timer threads new flag value public void set clear references stop timer threads boolean clear references stop timer threads boolean old clear references stop timer threads clear references stop timer threads clear references stop timer threads clear references stop timer threads support fire property change clear references stop timer threads old clear references stop timer threads clear references stop timer threads code false code used note instances java util timer thread always terminate since safe method exists do so should tomcat attempt terminate any link java util timer thread have been started web application specified default value code false code used private boolean clear references stop timer threads false return clear references stop timer threads flag context public boolean get clear references stop timer threads return clear references stop timer threads set clear references stop timer threads feature context param clear references stop timer threads new flag value public void set clear references stop timer threads boolean clear references stop timer threads clear references stop timer threads clear references stop timer threads set clear references log factory release feature context param clear references log factory release new flag value public void set clear references log factory release boolean clear references log factory release clear references log factory release clear references log factory release set clear references log factory release feature context param clear references log factory release new flag value public void set clear references log factory release boolean clear references log factory release clear references log factory release clear references log factory release timer thread normally visible java util timer thread class loader set clear references stop timer threads standard context container get clear references stop timer threads attribute name clear references stop timer threads required false code true code tomcat attempts terminate code java util timer code threads have been started web application unlike standard threads timer threads can stopped safely although may still side effects application specified default value code false code used attribute
set state lifecycle state must destroy set state lifecycle state must destroy set state lifecycle state must destroy
child add container listener child remove lifecycle listener remove listeners host remove listeners wrapper remove listeners context name cookie used pass session identifier back forth client public static final string session cookie name jsessionid name path parameter used pass session identifier back forth client public static final string session parameter name system get property org apache catalina session parameter name jsessionid
match string identifying session id parameter private static final string match globals session parameter name parse session id before decoding removal path params parse session id req request uri decoding decoded uri get type message bytes bytes remove any path parameters byte chunk uri bb decoded uri get byte chunk int semicolon uri bb index semicolon decoded uri set bytes uri bb get buffer uri bb get start semicolon xx decoding url try req get urldecoder convert decoded uri false catch ioexception ioe res set status 400 res set message invalid uri ioe get message return false normalize req decoded uri res set status 400 res set message invalid uri return false character decoding convert uri decoded uri request check uri still normalized check normalize req decoded uri res set status 400 res set message invalid uri character encoding return false else url chars string has been sent using memory protocol handler we have assume url has been properly decoded already decoded uri chars remove any path parameters char chunk uri cc decoded uri get char chunk int semicolon uri cc index semicolon decoded uri set chars uri cc get buffer uri cc get start semicolon redirect path redirect path globals session parameter name request get requested session id request get servlet context get effective session tracking modes we saw id url disabled remove can handle when we parse url we don have context point request set requested session id null request set requested session url false extract path parameters from request assumes parameters form path name value name2 value2 etc currently only really interested session id form other parameters can safely ignored param req param request protected void parse path parameters org apache coyote request req request request process bytes default format so normally op req decoded uri bytes byte chunk uri bc req decoded uri get byte chunk int semicolon uri bc index string enc null while semicolon enc null what encoding use some platforms eg os use default encoding doesn give expected result so explicit enc connector get uriencoding enc null enc iso 8859 parse path param extract from decoded request uri int start uri bc get start int end uri bc get end int path param start semicolon int path param end byte chunk find chars uri bc get buffer uri bc get start path param start uri bc get end new byte string pv null boolean warned encoding false path param end try pv new string uri bc get buffer start path param start path param end path param start enc catch unsupported encoding exception warned encoding log warn sm get string coyote adapter parse path param enc warned encoding true extract path param from decoded request uri byte buf uri bc get buffer int end start path param end buf start semicolon buf start path param end uri bc set bytes buf start end start path param end semicolon else try pv new string uri bc get buffer start path param start end start path param start enc catch unsupported encoding exception warned encoding log warn sm get string coyote adapter parse path param enc warned encoding true uri bc set end start semicolon pv null int equals pv index equals request add path parameter pv substring equals pv substring equals semicolon uri bc index semicolon protected void parse session id org apache coyote request req request request byte chunk uri bc req request uri get byte chunk int semicolon uri bc index match match length semicolon what encoding use some platforms eg os use default encoding doesn give expected result so explicit string enc connector get uriencoding enc null enc iso 8859 parse session id extract from decoded request uri int start uri bc get start int end uri bc get end int session id start semicolon match length int semicolon2 uri bc index session id start try semicolon2 request set requested session id new string uri bc get buffer start session id start semicolon2 session id start enc extract session id from request uri byte buf uri bc get buffer int end start semicolon2 buf start semicolon buf start semicolon2 uri bc set bytes buf start end start semicolon2 semicolon else request set requested session id new string uri bc get buffer start session id start end start session id start enc uri bc set end start semicolon request set requested session url true catch unsupported encoding exception uee make sure session id returned request set requested session id null request set requested session url false log warn sm get string coyote adapter parse session enc uee else request set requested session id null request set requested session url false parse session id url path parameters protected map string string path parameters new hash map string string protected void add path parameter string name string value path parameters put name value protected string get path parameter string name return path parameters get name path parameters clear string tok globals session parameter name session get id internal sb append globals session parameter name determine name use session cookie provided context param context public static string get session cookie name context context return null determine name use session cookie provided context param context public static string get session cookie name context context string result get configured session cookie name context result null result default session cookie name return result determine name use session cookie provided context param context public static string get session uri param name context context string result get configured session cookie name context result null result default session parameter name return globals session cookie name server digest equals client digest else return null else log debug enabled log debug passing all access status true log debug enabled log debug passing all access status true file append globals session parameter name property name org apache catalina session parameter name alternative name session path parameter defaults code jsessionid code note servlet requires code jsessionid code you should rely being able change property private static final string sci location meta inf services javax servlet servlet container initializer
url jar url fragment get url jar conn jar jar url open connection jar file conn get jar file zip entry entry jar file get entry meta inf services javax servlet servlet container initializer entry null jar file get input stream entry context config servlet container initializer fail jar url url jar url fragment get url jar conn jar jar url open connection jar file conn get jar file zip entry entry jar file get entry meta inf resources entry null context add resource jar url jar url log error sm get string context config resource jar fail jar url
-1
pool properties get db properties set property user usr pool properties get db properties set property password pwd
string cdl cd lower case default host host lower case name name lower case internally all names lower case alias alias lower case alias alias lower case string dispatcher dispatcher string upper case filename lower case ends war filename lower case index war string cdl cd lower case obj session get attribute locale test attributes lower case obj session get attribute locale test attributes upper case obj http session get attribute user test attributes lower case obj http session get attribute user test attributes upper case header headers next element upper case path upper case starts web inf path upper case starts meta inf path upper case starts web inf path upper case starts meta inf destination path upper case starts web inf destination path upper case starts meta inf path upper case starts web inf path upper case starts meta inf path upper case starts web inf path upper case starts meta inf path upper case starts web inf path upper case starts meta inf path upper case starts web inf path upper case starts meta inf path upper case starts web inf path upper case starts meta inf string lname name lower case string lname name lower case string lname name lower case string lname name lower case string lower case variable name variable name lower case variable name variable name upper case commands get str cmd lower case path null path upper case starts web inf path upper case starts meta inf string name parts name upper case split string filename filenames lower case string filename filenames lower case doc base lower case ends war file directory unpack wars else doc base lower case ends war doc base lower case ends war files lower case ends xml doc base get absolute path lower case ends war files lower case ends war dir file doc base get absolute path lower case ends war classpath item lower case ends jar binding get name upper case equals manifest mf binding get name lower case ends jar files get name lower case ends jar return enchash get mime charset name upper case return revhash get encoding upper case value str value str trim lower case string name lower name lower case string name lower name lower case content type lower case starts multipart string cdl content disposition lower case content disposition lower case starts form data content type lower case starts multipart sub content type lower case param name param name lower case post equals request get method lower case content type lower case starts multipart impact impact upper case string spec substring start lower case alias alias lower case jsp file upper case index web inf jsp file upper case index meta inf return text upper case
start pos comma pos lower case trim lower case trim start pos comma pos lower case trim lower case trim start pos comma pos lower case trim lower case trim
string page dir enc page dir enc upper case config enc config enc upper case string page enc root get page encoding upper case string page dir enc page dir enc upper case string page enc root get page encoding upper case int index input upper case index name upper case
super class needs checked match link handles types clazz annotation skip return boolean match false entry get key assignable from clazz private static final string get class name string internal form internal form starts return internal form assume starts ends uses rather than return internal form substring internal form length replace
clazz class name class name true context get loader get class loader return protected int max idle integer max value protected static final string prop suspect timeout suspect timeout
-1
value properties get property prop suspect timeout value null pool properties set suspect timeout integer parse int value
public static string path separator system get property path separator
-1
filter maps length filter map insert point protected map string url tag file jar urls protected url tag file jar url
tag file jar urls new hash map string url url tag file jar url tag file jar url tag file jar url tag file jar url null url jar url tag file jar urls get res jar url null jar url tag file jar url jar url null result new url jar url external form res substring public url get tag file jar url string tag file public void set tag file jar url string tag file url tag file url tag file jar urls put tag file tag file url public url get tag file jar url return tag file jar url public string get tld location string uri throws jasper exception string location pc get jsp compilation context get tag file jar url path string location ctxt get tld location uri private url jar file url boolean directives only url jar file url jar file url jar file url url jar file url string page enc string jsp config page enc jar file url parser controller parse file parent jar file url string location ctxt get tld location uri ctxt set tag file jar url info get path ctxt get tag file jar url return do parse file name null ctxt get tag file jar url return do parse file name null ctxt get tag file jar url url jar file url return do parse file name parent jar file url url tag file jar url node nodes page do parse file name null tag file jar url url jar file url jar file jar file get jar file jar file url jar file url external form abs file name substring directive only jar file url string name string path url tag file jar url tag library info tag lib info page pc parse tag file directives path tag file jar url url tag file jar url null try tag file jar url new url jar compiler get compilation context get tld location tag info get tag library get uri catch malformed urlexception ignore tag file jar url null string tag file jar path tag file jar url null tag file jar path tag file jar path tag file jar url string string wrapper uri tag file jar path tag file path get runtime context tag file jar url ctxt get tag file jar url tag file path string location jar resource jar resource location get jar resource page info add dependant jar location location page info add dependant jar location tag file path string prefix string uri string location error dispatcher err jar file jar file null string tld name location get name jar resource jar resource location get jar resource location null get resource stream location throw new file found exception location err jsp error jsp error file found location parse tld location null page info add dependant location url jar file url new url jar location jar conn jar jar file url open connection conn set use caches false conn connect jar file conn get jar file zip entry jar entry jar file get entry location jar file get input stream jar entry parse tld location jar file url err jsp error jsp error tld unable read location location ex string jar file null try jar file close catch throwable private void parse tld string uri input stream url jar file url jar file url private string generate tldlocation string uri jsp compilation context ctxt string location new string location uri location ends jar url ctxt get resource location err jsp error jsp error tld unable get jar location ex err jsp error jsp error tld missing jar location location url string location meta inf taglib tld return location private tag file info create tag file info tree node elem url jar file url ctxt set tag file jar url path jar file url parser controller name path jar file url private hashtable string string mappings mappings new hashtable string string public string get location string uri throws jasper exception string tag loc2 null tag loc ctxt get resource tag loc string tag loc2 meta inf taglib tld mappings put tag uri new string tag loc tag loc2 mappings put uri new string resource path entry name url tag file jar url tag file jar url
iterator double keys locales key set iterator while keys has next double key keys next array list locale list locales get key iterator locale values list iterator while values has next locale locale values next iterator string keys orig key set iterator while keys has next string key keys next dest put key orig get key iterator integer keys map key set iterator while keys has next integer key keys next array list wrapper list map get key iterator wrapper wrappers list iterator while wrappers has next wrapper wrapper wrappers next java util iterator string managers key set iterator while has next string key next cluster manager mgr managers get key mgr null session mgr find session session id key iterator string managers key set iterator while has next string key next cluster manager mgr managers get key mgr null mgr message data received msg key string param name init params key set servlet def add init parameter param name init params get param name string param name init params key set filter def add init parameter param name init params get param name protected static message digest md5helper
protected static http session context session context null stream write object new long creation time stream write object new long last accessed time stream write object new integer max inactive interval stream write object new boolean new stream write object new boolean valid stream write object new long accessed time stream write object new integer private static set string tld jars null private static array list extension container available extensions null protected static digester digester null
param values new boolean await daemon new bootstrap daemon init daemon bootstrap
final queue exception exception queue new concurrent linked queue exception print stack trace assert equals true false exception queue empty fail exception while sending threads exception queue remove string
klass assignable from tag get class
int len current sessions length get send all sessions size current sessions length get send all sessions size session send sessions new session len len get send all sessions size current sessions length current sessions length get send all sessions size prestart threads protected boolean prestartmin spare threads false
prestartmin spare threads executor prestart all core threads public boolean prestartmin spare threads return prestartmin spare threads public void set prestartmin spare threads boolean prestartmin spare threads prestartmin spare threads prestartmin spare threads add bug 43642 bug add prestartmin spare threads attribute executor jfclere add attribute name prestartmin spare threads required false boolean whether min spare threads should started when starting executor default code false code attribute
-1
lazy replicated map map lazy replicated map sessions map null map breakdown
initialized init force random number generator generate session id super start internal super stop internal random null initialized destroy
protected static message digest md5helper
string response string trace req get request uri req get protocol response string crlf header name req get header header name response string crlf response length response string length out print response string
protected final class page context pool return principal associated specified username credentials one otherwise return code null code param username username principal look up param credentials password other credentials use username public principal authenticate string username byte credentials
return principal associated specified username credentials one otherwise return code null code param username username principal look up param credentials password other credentials use username override public principal authenticate string username byte credentials principal user null realm realm realms log debug enabled log debug sm get string combined realm auth start username realm get info user realm authenticate username credentials user null log debug enabled log debug sm get string combined realm auth fail username realm get info else log debug enabled log debug sm get string combined realm auth sucess username realm get info break return user return principal associated specified username credentials one otherwise return code null code param username username principal look up param credentials password other credentials use username override public principal authenticate string username byte credentials locked username trying authenticate locked user automatic failure register auth failure username log warn sm get string lock out realm auth locked user username return null principal user super authenticate username credentials user null register auth failure username else register auth success username return user return principal associated specified username credentials one otherwise return code null code param username username principal look up param credentials password other credentials use username public principal authenticate string username byte credentials return authenticate username credentials string
-1
return param properties return convenience constructor link empty role semantic deny link session tracking mode ssl param jsp wild card true name identifies jsp servlet return component soon link start exits see get accessed time see get last accessed time link http servlet response send error int string link http servlet response send error int string param session session change session id param conetxt context web application digester should use link get pipeline add valve valve case set clear references stop threads feature context param clear references stop threads new flag value see get accessed time see get last accessed time see object hash code int param options int first reply majority reply all reply since el return false string literals rtexprvalues should add specified socket associated pool poller socket added temporary array polled first after maximum amount time equal poll time most cases latency much lower however param socket add poller param result servlet response we creating param result servlet response we creating
protected concurrent hash map socket wrapper ajp processor connections new concurrent hash map socket wrapper ajp processor protected concurrent hash map socket wrapper connections new concurrent hash map socket wrapper iterator socket wrapper sockets waiting requests iterator socket wrapper socket sockets next protected concurrent linked queue socket wrapper waiting requests new concurrent linked queue socket wrapper override override
override override override override override override override override override override override
xxx backward remove once supported admin return create standard context parent path doc base false false false false creates new standard service standard engine param domain domain name container instance param default host name default host used engine param base dir base directory value engine exception exception mbean cannot created registered public string create standard service engine string domain string default host string base dir throws exception container instanceof server throw new exception standard engine engine new standard engine engine set domain domain engine set name domain engine set default host default host engine set base dir base dir service service new standard service service set container engine service set name domain server container add service service return engine get jmx name string class name org apache catalina mbeans mbean factory operation name create file logger description create new file logger impact action return type java lang string parameter name parent description mbean name associated parent component type java lang string operation operation name create standard engine description create new standard engine parameter name parent description mbean name associated parent component type java lang string parameter name name description unique name engine type java lang string parameter name default host description default host name engine type java lang string operation operation name create standard engine service description create new standard engine standard service impact action return type java lang string parameter name parent description mbean name associated parent service type java lang string parameter name engine name description unique name engine description default host name engine parameter name service name description unique name service operation name create standard service description create new standard service impact action return type java lang string parameter name parent description mbean name associated parent component type java lang string parameter name name description unique name service type java lang string parameter name domain description domain service type java lang string operation operation name create system err logger description create new system error logger impact action return type java lang string parameter name parent description mbean name associated parent component type java lang string operation operation name create system out logger description create new system output logger impact action return type java lang string parameter name parent description mbean name associated parent component type java lang string operation operation name remove logger description remove existing logger impact action return type void parameter name name description mbean name component removed type java lang string operation public static final boolean use secure random uuid false
-1
session valid internal session already invalid expire session prevent memory leak session set valid true session expire todo servlet3 add comments todo servlet3 add comments todo servlet3 add comments todo servlet3 add comments todo servlet3 add comments since servlet todo servlet3 add comments todo servlet3 add comments todo servlet3 add comments since servlet todo servlet3 add comments public static char special characters new char highest special
-1
-1
final private list string roles roles collections unmodifiable list roles
idle writer println sm get string manager servlet unlimited notimeout writer println sm get string manager servlet idle expired expired
timeout licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license mock link filter chain keep handle passed link servlet request public static class mock filter chain implements filter chain private http servlet request request override public void do filter servlet request request servlet response response throws ioexception servlet exception request http servlet request request public http servlet request get request return request public static class mock http servlet extends http servlet private static final long serial version uid 1l http servlet request request public http servlet request get request return request override public void service http servlet request request http servlet response response throws servlet exception ioexception request request print writer writer response get writer writer println request remote addr request get remote addr writer println request remote host request get remote host writer println request secure request secure writer println request scheme request get scheme writer println request server port request get server port writer println enumeration string headers request get header names headers has more elements string name headers next element string writer println request header name collections list request get headers name enhanced link request ease testing public static class mock http servlet request extends request public mock http servlet request super set coyote request new org apache coyote request set connector new connector public void set header string name string value get coyote request get mime headers set value name set string value public void set scheme string scheme get coyote request scheme set string scheme public static final string temp dir system get property java io tmpdir public void test comma delimited list string array list string elements arrays list element1 element2 element3 string actual remote ip filter list comma delimited string elements assert equals element1 element2 element3 actual public void test comma delimited list string array empty list list string elements new array list string string actual remote ip filter list comma delimited string elements assert equals actual public void test comma delimited list string array null list string actual remote ip filter list comma delimited string null assert equals actual public void test header names case remote ip filter xforwarded request request new remote ip filter xforwarded request new mock http servlet request request set header myheader lower case request set header myheader upper case request set header my header camel case assert equals request headers size assert equals camel case request get header myheader public void test incoming request secured protocol header says custom values throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto filter def add init parameter remote ipheader my forwarded filter def add init parameter http server port 8080 mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set secure true request set scheme https request set header my forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify boolean actual secure actual request secure assert equals request must unsecured header forwarded proto said http false actual secure string actual scheme actual request get scheme assert equals scheme must http header forwarded proto said http http actual scheme int actual server port actual request get server port assert equals wrong http server port 8080 actual server port string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test incoming request secured protocol header says default values throws exception prepare filter def filter def new filter def filter def add init parameter protocol header forwarded proto mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set secure true request set scheme https request set header forwarded 140 211 11 130 request set header forwarded proto http test http servlet request actual request test remote ip filter filter def request verify boolean actual secure actual request secure assert equals request must unsecured header forwarded proto said http false actual secure string actual scheme actual request get scheme assert equals scheme must http header forwarded proto said http http actual scheme string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke allowed remote addr null remote ip header throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded request get header forwarded assert null forwarded must null actual xforwarded string actual xforwarded request get header forwarded assert null forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 192 168 10 actual remote addr string actual remote host actual request get remote host assert equals remote host remote host original value actual remote host public void test invoke all proxies internal throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 192 168 10 192 168 11 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies internal forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert null all proxies internal forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted throws exception prepare remote ip filter remote ip filter new remote ip filter filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded filter def set filter remote ip filter mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted remote addr match regexp throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 127 192 168 another internal proxy filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke all proxies trusted internal throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 proxy2 192 168 10 192 168 11 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert null all proxies trusted forwarded must null actual xforwarded string actual xforwarded actual request get header forwarded assert equals all proxies trusted must appear forwarded proxy1 proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr 140 211 11 130 actual remote addr string actual remote host actual request get remote host assert equals remote host 140 211 11 130 actual remote host public void test invoke allowed remote addr throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr allowed internal proxy request set remote host allowed internal proxy host request set header forwarded 140 211 11 130 proxy1 proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert equals forwarded must unchanged 140 211 11 130 proxy1 proxy2 actual xforwarded string actual xforwarded actual request get header forwarded assert null forwarded must null actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr allowed internal proxy actual remote addr string actual remote host actual request get remote host assert equals remote host allowed internal proxy host actual remote host public void test invoke untrusted proxy chain throws exception prepare filter def filter def new filter def filter def add init parameter internal proxies 192 168 10 192 168 11 filter def add init parameter trusted proxies proxy1 proxy2 proxy3 filter def add init parameter remote ipheader forwarded filter def add init parameter proxies header forwarded mock http servlet request request new mock http servlet request request set remote addr 192 168 10 request set remote host remote host original value request set header forwarded 140 211 11 130 proxy1 untrusted proxy proxy2 test http servlet request actual request test remote ip filter filter def request verify string actual xforwarded actual request get header forwarded assert equals ip host before untrusted proxy must appear forwarded 140 211 11 130 proxy1 actual xforwarded string actual xforwarded actual request get header forwarded assert equals ip host after untrusted proxy must appear forwarded proxy2 actual xforwarded string actual remote addr actual request get remote addr assert equals remote addr untrusted proxy actual remote addr string actual remote host actual request get remote host assert equals remote host untrusted proxy actual remote host public void test list comma delimited string string actual remote ip filter comma delimited list string array element1 element2 element3 string expected new string element1 element2 element3 assert equals expected length actual length int actual length assert equals expected actual public void test list comma delimited string mixed space chars string actual remote ip filter comma delimited list string array element1 element2 element3 string expected new string element1 element2 element3 assert equals expected length actual length int actual length assert equals expected actual private http servlet request test remote ip filter filter def filter def request request throws lifecycle exception ioexception servlet exception tomcat tomcat get tomcat instance context root tomcat add context temp dir remote ip filter remote ip filter new remote ip filter filter def set filter class remote ip filter class get name filter def set filter remote ip filter filter def set filter name remote ip filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name remote ip filter class get name filter map add urlpattern root add filter map filter map get tomcat instance start mock filter chain filter chain new mock filter chain test remote ip filter do filter request new response filter chain return filter chain get request test link remote ip filter tomcat standalone server public void test tomcat server throws exception mostly default enable forwarded proto map string string remote ip filter parameter new hash map string string remote ip filter parameter put protocol header forwarded proto setup tomcat tomcat get tomcat instance context root tomcat add context temp dir filter def filter def new filter def filter def get parameter map put all remote ip filter parameter filter def set filter class remote ip filter class get name filter def set filter name remote ip filter class get name root add filter def filter def filter map filter map new filter map filter map set filter name remote ip filter class get name filter map add urlpattern root add filter map filter map mock http servlet mock servlet new mock http servlet tomcat add servlet root mock servlet get class get name mock servlet root add servlet mapping test mock servlet get class get name get tomcat instance start test http http http new url http localhost tomcat get connector get port test open connection string expected remote addr my remote addr http add request property forwarded expected remote addr http add request property forwarded proto https validate assert assert equals http http ok http get response code http servlet request request mock servlet get request assert assert null request validate fowarded assert assert equals expected remote addr request get remote addr assert assert equals expected remote addr request get remote host validate forwarded proto assert assert true request secure assert assert equals https request get scheme assert assert equals 443 request get server port
-1
log debug enabled log debug skip remote ip filter request request get request uri original remote addr request get remote addr else log debug enabled log debug skip remote ip valve request request get request uri original remote addr request get remote addr
should tomcat attempt clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload disabled default since clearing thread local objects performed thread safe manner private boolean clear references thread locals false return clear references thread locals flag context public boolean get clear references thread locals return clear references thread locals set clear references stop threads feature context param clear references stop threads new flag value public void set clear references thread locals boolean clear references thread locals boolean old clear references thread locals clear references thread locals clear references thread locals clear references thread locals support fire property change clear references stop threads old clear references thread locals clear references thread locals should tomcat attempt clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload disabled default since clearing thread local objects performed thread safe manner private boolean clear references thread locals false return clear references thread locals flag context public boolean get clear references thread locals return clear references thread locals set clear references thread locals feature context param clear references thread locals new flag value public void set clear references thread locals boolean clear references thread locals clear references thread locals clear references thread locals clear references thread locals log debug sm get string webapp class loader clear thread local debug clear clear references thread locals log info sm get string webapp class loader clear thread local clear key null stale entries count else map remove invoke map key class loader set clear references thread locals standard context container get clear references thread locals attribute name clear references thread locals required false code true code tomcat attempts clear any thread local objects instances classes loaded class loader failure remove any objects result memory leak web application stop undeploy reload specified default value code false code used since clearing thread local objects performed thread safe manner attribute
notify session listeners replication session tell new return path file save context information public string get config file set path file save context information param config file path file save context information public void set config file string config file
path file save context information private string config file null return path file save context information public string get config file set path file save context information param config file path file save context information public void set config file string config file should xml files copied catalina base conf engine host default when web application deployed private boolean copy xml false return copy xml config file flag component public boolean copy xml return copy xml set copy xml config file flag component param copy xml new copy xml flag public void set copy xml boolean copy xml copy xml copy xml context set config file config file get absolute path process context config new file get base dir default context xml process context config get config base get host config path constants host context xml process context config new file context get config file null protected void process context config file base dir string resource name file base dir resource name file file base dir resource name null file new file base dir resource name file exists resource name null use get resource get resource stream stream get class get class loader get resource stream resource name stream null source new input source get class get class loader get resource resource name string else source new input source file file get absolute path stream new file input stream file add watched resource so cascade reload occurs default config file modified added removed context add watched resource file get absolute path resource name file file base dir resource name return copy xml config file flag component public boolean copy xml return copy xml set copy xml config file flag component param copy xml new copy xml flag public void set copy xml boolean copy xml copy xml copy xml set copy xml standard host host copy xml context set config file context xml get absolute path boolean xml war false xml war true copy xml context set config file xml get absolute path only do initial deployment subsequent deployments copied xml file means we ll use deploy descriptor instead xml copy new file config base file xml input stream null output stream os null try new file input stream xml os new file output stream xml copy iotools flow os don catch ioe let outer try catch handle finally try null close catch ioexception ignore os null os close catch ioexception ignore context set config file xml copy uri url else context set config file xml uri url context set config file xml copy get absolute path absolute pathname directory pathname relative code catalina base code directory see deployment web applications deployed specified default code webapps code used pathname directory may contain context xml descriptors deployed virtual host you may specify deployment web applications deployed set true tomcat attempt create directories defined attributes code app base code code xml base code during startup phase default value code true code set true directory creation fails error message printed out halt startup sequence flag value indicates new web applications dropped code app base code directory while tomcat running should deployed flag value defaults true see deployed host configurator flag value defaults true see set code false code you want disable parsing context xml file embedded inside application located code meta inf context xml code security conscious environments should set code false code prevent applications from interacting container responsible providing external context file put code catalina base conf enginename hostname code unless attribute code xml base code specified flag value defaults code true code from war file see code org apache catalina core container base enginename hostname code li any xml file code catalina base conf engine name host name code directory assumed contain subelements single web application code doc base code attribute code lt context gt code element typically absolute pathname web application directory absolute pathname web application archive war file which expanded path attribute set defined href context html context li li any web application archive file within application base app base directory does have directory same name without war extension expanded unless code unpack wars code property set code false code you redeploy updated war file sure delete expanded directory when restarting tomcat so updated war file re expanded note auto deployer enabled expand updated war file once previously expanded directory removed multi level contexts may defined using use war named code foo bar war code context path code foo bar code li li any subdirectory within em application base directory em receive generated href context html context element even directory mentioned code conf server xml code file context path deployed context slash character followed directory name unless directory name root which case context path empty string multi level contexts may defined using use directory named code foo bar code context path code foo bar code li dropped code app base code code catalina base conf engine name host name code case xml file directory while tomcat running deployed according rules described above auto deployer also track web applications following changes finally note you defining contexts explicitly you should probably turn off automatic application deployment otherwise your context deployed twice each may cause problems your app
try sender send message destination message catch channel exception sender disconnect throw catch channel exception sender disconnect throw connected disconnect connected disconnect
private int min int int
specialized resource avoids opening iput stream input stream new file input stream file input stream base get input stream entry
else may jar some ide environments result context get resource canonical uri res
return new array list string group map values
reset response keeping real error code message response reset buffer true rd forward request get request response get response we forward response suspended again response set suspended false
return config get servlet context
trigger loading class reading property security util package protection enabled
jsp lines length jsp begin line num avoid array index out bounds exception probably bug 48494 could some other cause jsp extract localizer get message jsp error bug48494 return global xslt file null protected string local xslt file null protected string global xslt file null
context xslt file get servlet config get init parameter context xslt file cache entry name trimmed equals context xslt file continue return null can disabled per webapp also declaring default servlet your local webapp web xml format xml shown below overrides code global xslt file code value present file does exist protected static final string insert before web app servlet mapping session config mime mapping welcome file list error page taglib resource env ref resource ref security constraint login config security role env entry ejb ref ejb local ref
int pos string line null while true line reader read line line null break skip anything previously generated jspc line index insert start marker while true line reader read line line null return line index insert end marker line reader read line line reader read line return break writer println insert end marker writer println writer write element else element contains insert start marker skip previous auto generated content while element contains insert end marker element get element reader else writer write element int insert before length pos line index insert before pos break pos writer print line substring pos break writer println line writer println insert start marker while true string line2 fragment reader read line line2 null writer println break writer println line2 writer println insert end marker writer println int pos writer print writer println line substring pos while true line reader read line line null break writer println line assumes valid xml private string get element reader reader throws ioexception string builder result new string builder result append boolean done false while done int current reader read while current result append char current current reader read result append char current int len result length len result substring equals comment make sure we end result substring len len equals done true else done true return result string
cache entry exists file directory listing doesn appear exist broken symlink odd permission settings return
hconn set fixed length streaming mode content length stream new buffered input stream new file input stream war 1024 private static jsp factory deflt null
public static synchronized void set default factory jsp factory deflt public static synchronized jsp factory get default factory
open jars return null entry null jar files length jar entry jar files get jar entry path jar entry null entry new resource entry try entry code base get url jar real files false string jar fake url get uri jar real files string jar fake url jar jar fake url path entry source new url jar fake url entry last modified jar real files last modified catch malformed urlexception return null content length int jar entry get size try entry manifest jar files get manifest binary stream jar files get input stream jar entry catch ioexception return null extract resources contained jar workdir anti jarlocking path ends class byte buf new byte 1024 file resource file new file loader dir jar entry get name resource file exists enumeration jar entry entries jar files entries while entries has more elements jar entry jar entry2 entries next element jar entry2 directory jar entry2 get name ends class resource file new file loader dir jar entry2 get name try resource file get canonical path starts canonical loader dir throw new illegal argument exception sm get string webapp class loader illegal jar path jar entry2 get name catch ioexception ioe throw new illegal argument exception sm get string webapp class loader validation error jar path jar entry2 get name ioe resource file get parent file mkdirs file output stream os null input stream null try jar files get input stream jar entry2 os new file output stream resource file while true int read buf break os write buf catch ioexception ignore finally null close catch ioexception os null os close ignore finally try null close catch ioexception try os null os close catch ioexception entry null synchronized found resources found resources put name name return null binary stream null byte binary content new byte content length int pos try while true int binary stream read binary content pos binary content length pos break pos catch ioexception log error sm get string webapp class loader read error name finally try binary stream close catch ioexception file need convert workaround certain files platforms use ebcdic encoding when read through file input stream see commit message rev 303915 details http svn apache org viewvc view revision revision 303915 string str new string binary content pos binary content str get bytes utf catch exception file need convert workaround certain files platforms use ebcdic encoding when read through file input stream see commit message rev 303915 details http svn apache org viewvc view revision revision 303915 string str new string binary content pos try binary content str get bytes utf catch exception return null entry binary content binary content certificates only available after jar entry associated input stream has been fully read jar entry null entry certificates jar entry get certificates entry binary content binary content certificates only available after jar entry associated input stream has been fully read jar entry null entry certificates jar entry get certificates class name org apache catalina connector remote ip valve class name org apache catalina connector remote ip valve class name org apache catalina connector remote ip valve class name org apache catalina connector remote ip valve private static final string info org apache catalina connector remote ip valve
-1
buffered input stream bis null buffered input stream bis new buffered input stream fis ois null ois close ois null ois null try ois close catch ioexception ignore oos null oos close buffered input stream bis null buffered input stream bis new buffered input stream fis ois null ois close ois null ois null try ois close catch ioexception ignore ois null ois null try ois close catch ioexception ignore ois null ois null ois close oos null oos close oos null oos null try oos close catch ioexception ignore oos null oos close oos null catch ioexception oos null try oos close catch ioexception ignore oos null throw server component we starting stopping protected server server null
set server instance we configuring param server new server override public void set server server server server server server null server get port socket socket new socket server get address server get port string shutdown server get shutdown server instanceof lifecycle server initialize server null server null server instanceof lifecycle lifecycle server start server instanceof lifecycle lifecycle server stop server await server null
string context param context params key set context add parameter context param context params get context param string locale locale encoding mappings key set context add locale encoding mapping parameter locale locale encoding mappings get locale string extension mime mappings key set context add mime mapping extension mime mappings get extension string param params key set wrapper add init parameter param params get param string pattern servlet mappings key set context add servlet mapping pattern servlet mappings get pattern string uri taglibs key set context add taglib uri taglibs get uri string key fragment map key set value fragment map get key string name fragments key set requested order contains name web xml fragment fragments get name iterator byte entry entries bc stats key set iterator while entries has next byte entry entry entries next int count bc stats get entry iterator char entry entries cc stats key set iterator while entries has next char entry entry entries next int count cc stats get entry td http server port td td value returned link servlet request get server port when code protocol header code indicates code http code protocol td td td td integer td td 80 td tr tr td https server port td td value returned link servlet request get server port when code protocol header code indicates code https code protocol td td td td integer td td 443 td tr
see set http server port int private int http server port 80 public int get http server port return http server port protocol header value null protocol header https value equals ignore case protocol header value else request set secure false use request coyote request scheme instead request set scheme because request set scheme op tomcat request get coyote request scheme set string http request set server port http server port attribute name remote ip hedaer public string get scheme return scheme public int get server port return server port public boolean secure return secure scheme request get scheme secure request secure server port request get server port http https server port scheme presented proxy load balancer via request header quot forwarded proto quot td http server port td td value returned link servlet request get server port when code protocol header code indicates code http code protocol td td td td integer td td 80 td tr tr td https server port td td value returned link servlet request get server port when code protocol header code indicates code https code protocol td td td td integer td td 443 td tr
protected static final string http server port parameter http server port see set http server port int private int http server port 80 protocol header value null protocol header https value equals ignore case protocol header value else request set secure false request set scheme http request set server port http server port filter config get init parameter http server port parameter null try set http server port integer parse int filter config get init parameter http server port parameter catch number format exception throw new number format exception illegal http server port parameter get message throw new number format exception illegal server port get message http https server port scheme presented proxy load balancer via request header quot forwarded proto quot
return urldecode bytes null false
return new generic principal user username user password get roles context user
always overrides anything app might set else always overrides anything app might set else always overrides anything app might set else server header http response unless you paranoid you won need feature private final class cleaner extends thread override public void run jvm us being shutdown make sure all loggers all class loaders shutdown class loader log info cl log info class loader loggers values logger logger cl log info loggers values reset logger logger private void reset logger logger logger handler handlers logger get handlers handler handler handlers logger remove handler handler try handler close catch exception ignore constructors public class loader log manager super try runtime get runtime add shutdown hook new cleaner catch illegal state exception ise we probably already being shutdown ignore error
need override reset so loggers loaded web applications can shutdown override public void reset super reset class loader log info class loader log info class loader loggers values logger logger class loader log info loggers values reset logger logger private void reset logger logger logger handler handlers logger get handlers handler handler handlers logger remove handler handler try handler close catch exception ignore public static void release class loader class loader nothing we don use any class loaders
sm get string context config jndi url url
public class get property type suppress warnings unchecked can use class because api needs match public object get context class key suppress warnings unchecked can use class because api needs match public void put context class key object context object throws null pointer exception suppress warnings unchecked can use iterator feature descriptor because api needs match public iterator get feature descriptors elcontext context object base suppress warnings unchecked suppress warnings unchecked suppress warnings deprecation suppress warnings unchecked suppress warnings unchecked suppress warnings unchecked can use class because api needs match super class public object get context class key suppress warnings unchecked can use class because api needs match super class public void put context class key object context object suppress warnings unchecked public object invoke evaluation context ctx class param types suppress warnings unchecked public method info get method info evaluation context ctx class param types suppress warnings unchecked public method info get method info evaluation context ctx class param types suppress warnings unchecked public object invoke evaluation context ctx class param types suppress warnings unchecked public object invoke evaluation context ctx class param types suppress warnings unchecked class param types throws elexception suppress warnings unchecked protected array list list file file array list entries super list file
public void test parser function bug 48112 assert equals world evaluate expression fn trim world ctx set function mapper new fmapper public static class fmapper extends function mapper override public method resolve function string prefix string local name trim equals local name method try get class get method trim string class return catch security exception ignore catch method exception ignore return null public static string trim string input return input trim
string encoded addr null get property address null encoded addr urlencoder encode get property address string string add suffix get property address null address encoded addr object name oname new object name domain type type port get port add suffix string address string utils get property connector address sb append port port address null address length sb append address address implements adapter
response add header powered servlet private static final string service resource name meta inf services javax el expression factory private static final string sep system get property file separator private static final string property file system get property java home jre sep lib sep el properties private static final string property name javax el expression factory
create new link expression factory passing provided link properties search order same link new instance param properties return todo private static expression evaluator impl expression evaluator new expression evaluator impl private expression factory expression factory new expression factory impl private static final expression factory expression factory expression factory new instance elsupport check type attrs get value expected class
session valid remove session get id internal private string parameter encoding system get property file encoding utf
get servlet config get init parameter stderr timeout null stderr timeout long parse long get servlet config get init parameter stderr timeout thread err reader thread null new thread start make sure error stream reader has finished err reader thread null try err reader thread join stderr timeout catch interrupted exception log interupted waiting stderr reader thread
form hostname contextpath file name int start file index file index protected lock diff lock new reentrant read write lock write lock reentrant read write lock lock new reentrant read write lock true reentrant read write lock out lock new reentrant read write lock true
final reentrant lock locks new reentrant lock lock count
sessions currently being swapped associated locks private map string object session swap locks new hash map string object session session null try security util package protection enabled try session access controller do privileged new privileged store load id catch privileged action exception ex exception exception ex get exception log error exception store during swap exception exception instanceof ioexception throw ioexception exception else exception instanceof class found exception throw class found exception exception else session store load id catch class found exception log error sm get string persistent manager deserialize error id throw new illegal state exception sm get string persistent manager deserialize error id session null return null session valid log error session swapped invalid expired session expire remove session id return null log debug enabled log debug sm get string persistent manager swap id session set manager make sure listeners know about standard session session tell new add session standard session session activate end access ensure timeouts happen correctly access keep access count correct end up negative session access session end access code 192 168 16 code configure code remote ipinternal proxy code code remote iptrusted proxy code jvm doesnt have href http apr apache org docs apr group apr network io html apr ipsubnet test
protected static final string protocol header ssl value parameter protocol header ssl value private string protocol header ssl value https protocol header value null protocol header ssl value equals ignore case protocol header value public string get protocol header ssl value return protocol header ssl value filter config get init parameter protocol header ssl value parameter null set protocol header ssl value filter config get init parameter protocol header ssl value parameter case insensitive value protocol header indicate incoming http request uses ssl default value code https code public void set protocol header ssl value string protocol header ssl value protocol header ssl value protocol header ssl value private static final map sslsession integer key size cache new weak hash map sslsession integer
integer key size integer session get value key size key session put value key size key key size
throws ioexception forward login page fails call link http servlet response send error int string throws link ioexception http servlet response response login config config log warn unexpected error forwarding login page throws ioexception forward error page fails call link http servlet response send error int string throws link ioexception http servlet response response login config config log warn unexpected error forwarding error page
return java util arrays list clients entry set array new client jsonobject msg data null
override override
names return only those attributes set via li link globals dispatcher type attr li li link globals dispatcher request path attr li li link globals async supported attr li li link globals certificates attr ssl connections only li li link globals cipher suite attr ssl connections only li li link globals key size attr ssl connections only li li link globals ssl session id attr ssl connections only li li link globals ssl session mgr attr ssl connections only li return return
value null
iterator object iter1 list object key iterator iter1 has next clone map hash map member impl mbr entry map clone return true member new cluster false otherwise return false member local member updated return collections empty map suppress warnings unchecked overridden method uses raw type class
initialized try init catch exception ex throw new lifecycle exception error ex
param obj0 param obj1 return throws evaluation exception obj0 instanceof comparable return obj1 null comparable obj0 compare obj1 obj1 instanceof comparable return obj0 null comparable obj1 compare obj0 param obj0 param obj1 return throws evaluation exception return enum obj param obj return coerce object string return else obj instanceof enum return enum obj name param obj return private void compare both string msg int expected object o1 object o2 int i1 elsupport compare o1 o2 int i2 elsupport compare o2 o1 assert equals msg expected i1 assert equals msg expected i2 public void test el support compare compare both nulls should compare equal null null compare both null should compare equal null compare both null should less than file null new file compare both null should less than date null new date compare both date should less than date new date new date try compare both should compare new date new file fail expecting class cast exception catch class cast exception expected expected assert true null null
suppress warnings unchecked can use class because api needs match super class suppress warnings unchecked can use class because api needs match super class suppress warnings unchecked can use class because api needs match super class suppress warnings unchecked can use class because api needs match super class
suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type suppress warnings unchecked do privileged returns correct type
case async filter map get dispatcher mapping filter map async return true break public static final int async 16 representing state when filters should applied error forward forward error include include error include error forward request request error request error include request error forward include request include request forward request forward include else dispatcher equals dispatcher type async name apply error global dispatcher mapping dispatcher mapping async
group null item get group null results add item get name else source instanceof class suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match
public class get property type suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use iterator feature descriptor because api needs match suppress warnings unchecked can use class because api needs match suppress warnings unchecked can use class because api needs match
type instanceof simple type type instanceof simple type set set bean server query mbeans object name null suppress warnings unchecked sessions type map string session object sessions cross context sessions get sessions null sessions instanceof list list session sessions size iterator session iter list session sessions iterator iter has next object sessions cross context sessions get sessions null sessions instanceof list list session sessions size iterator session iter list session sessions iterator suppress warnings unchecked map members has correct type iterator super entry set iterator map entry map entry next array list list array list msg get value iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator entry set iterator map entry entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next iterator super entry set iterator map entry map entry next suppress warnings unchecked bio senders type hash map member bio sender
taglibs new hash map string string ignore other event types nothing do
int char value hex utils dec value value int char value hex utils dec value value int char value hex utils dec value value int char value hex utils dec value value int char value hex utils dec value value hex utils dec buf pos result hex utils dec buf pos chunk length pos hex utils hex digit public static final int dec public static final byte hex public static int get dec int index return dec index public static byte get hex int index return hex index buf end hex utils hex digit buf end hex utils hex digit
protected boolean do run true protected boolean run false protected boolean running true protected boolean do run sender false protected boolean do run receiver false static boolean running false
protected boolean run true
context entry value unbind name get suffix
public void set domain string domain domain null return domain starts set domain org apache catalina tribes util arrays from string domain set domain org apache catalina tribes util arrays convert domain public void set domain string domain domain null return domain starts set domain arrays from string domain else set domain arrays convert domain
else false equals value webxml set metadata complete false
naming resources add property change listener naming resources add property change listener process property change events currently only listens events code naming resources code instance global naming resources process property change global naming resources making note seems context global jndi resources left read write mode so we do have change here
random null try random close catch ioexception ioe log warn failed close random random null
return set property name value true public static boolean set property object string name string value boolean invoke set property return utils set property name value
return logger which container associated associated logger return logger associated our parent container any otherwise return code null code private int jsp reload count
parent class loader thread current thread get context class loader parent class loader null parent class loader get class get class loader parent class loader null parent class loader string init class path code source null permission collection null init security private servlet context context private options options private class loader parent class loader private permission collection permission collection private code source code source private string classpath private long last check 1l public synchronized void increment jsp reload count jsp reload count public synchronized void set jsp reload count int count jsp reload count count return jsp reload count private void init class path classpath cpath string cp log debug compilation classpath initialized get class path return path helper class allow init security return two items private static class security holder private final code source cs private final permission collection pc private security holder code source cs permission collection pc cs cs pc pc private void init security code source source null permission collection permissions null code source new code source url certificate null permission collection policy get permissions code source permission collection add permission collection add permission collection add new file permission doc base read permission collection add permission collection add new file permission permission collection add new runtime permission permission collection add permission collection add permission collection add return new security holder source permissions public static final org apache juli logging log log public static final byte start data 70 76 84 50 48 48 50 public static final byte end data 84 76 70 50 48 48 51
converts byte array entry boolean param byte array param offset within byte array return true byte array entry non zero false otherwise public static atomic integer invokecount new atomic integer protected static org apache juli logging log log org apache juli logging log factory get log abstract class
-1
override override protected static final org apache juli logging log log protected static final org apache juli logging log log override override
public static final string default mime mappings public static final byte start data new byte 113 58 34 60 75 78 101 12 32 29 32 111 40 public static final byte end data new byte 54 13 90 110 47 31 75 24 81 29 36 52 58 77 110 56 public static final int dec public static int default pool size 100 1024 1024 100mb public static int tab width public static string spaces public static hashtable string string default map private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log protected static org apache juli logging log log public static org apache juli logging log log org apache juli logging log factory get log cluster listener class public static org apache juli logging log log org apache juli logging log factory get log replicated context class public static org apache juli logging log log org apache juli logging log factory public static org apache juli logging log log org apache juli logging log factory public static org apache juli logging log log org apache juli logging log factory public static org apache juli logging log log org apache juli logging log factory get log backup manager class public static org apache juli logging log log org apache juli logging log factory get log delta manager class public static org apache juli logging log log public static org apache juli logging log log org apache juli logging log factory get log delta session class public static org apache juli logging log log org apache juli logging log factory protected static org apache juli logging log log public static org apache juli logging log log org apache juli logging log factory get log simple tcp replication manager class private static org apache juli logging log log protected static org apache juli logging log log
-1
private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log protected static org apache juli logging log log private static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log protected static org apache juli logging log log org apache juli logging log factory get log protected static org apache juli logging log log org apache juli logging log factory get log heartbeat thread class protected static org apache juli logging log log org apache juli logging log factory get log rpc channel class private static org apache juli logging log log org apache juli logging log factory get log interceptor class protected static org apache juli logging log log org apache juli logging log factory get log message dispatch interceptor class private static org apache juli logging log log org apache juli logging log factory get log tcp failure detector class protected static org apache juli logging log log protected static org apache juli logging log log org apache juli logging log factory get log throughput interceptor class private static org apache juli logging log log org apache juli logging log factory get log two phase commit interceptor class protected static org apache juli logging log log org apache juli logging log factory get log object reader class public static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log protected static org apache juli logging log log org apache juli logging log factory get log lazy replicated map class protected static org apache juli logging log log org apache juli logging log factory get log replicated map class protected static org apache juli logging log log org apache juli logging log factory get log bio receiver class protected static org apache juli logging log log org apache juli logging log factory get log bio replication task class private static org apache juli logging log log org apache juli logging log factory get log bio sender class private static org apache juli logging log log org apache juli logging log factory get log fast queue class protected static org apache juli logging log log org apache juli logging log factory get log nio receiver class private static org apache juli logging log log org apache juli logging log factory get log nio replication task class protected static org apache juli logging log log org apache juli logging log factory get log nio sender class protected static org apache juli logging log log org apache juli logging log factory get log parallel nio sender class public static log messages log factory get log org apache catalina tribes messages private static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected static org apache juli logging log log protected org apache juli logging log log private org apache juli logging log log private static org apache juli logging log log private org apache juli logging log log private org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log logger private static org apache juli logging log logger static org apache juli logging log logger static org apache juli logging log log private static org apache juli logging log log private static org apache juli logging log logger private static org apache juli logging log log static public string apr anyaddr public static channel data empty data array new channel data
-1
-1
-1
contains uses return headers clien throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing throws java io ioexception error occured while writing method kept backwards compatiblity reasons newly pagein case where one tag invokes another can throws javax servlet jsp jsp exception thrown error occured when being pased tag library validator instance stream encoded utf recall tht xml view addititional constraint can exploited tag library imported more than once bound different prefices jsp container reponsible locating appropriate addititional constraint can exploited
action id useable switches table indexes main interface implemented coyoute connector adapter main interface impleneted coyote servlet container time request usefull avoid repeated calls system current time get instance id jvm route curently ajp sending each negociated config time so both tomcat apache share same name currently used only jmx artifact agregate data about requests beeing processed usefull long running requests only called explicitely user set content language param charset string containing name chararacter encoding hardcoded byte marshalling overhead adapter which process requests recieved endpoint hardcoded byte marshalling overhead adapter which process requests recieved endpoint content delimitator request false connection minimum contentsize make compression add mime type which compressable set compressable mime type list method best when used check content allready gzipped force mode allways compress test purposes only check suffisant len trig compression throws ioexception undelying error occured throws ioexception undelying error occured throws ioexception undelying error occured throws ioexception undelying error occured method write contents specyfied message bytes method write contents specyfied message bytes method write contents specyfied char method write contents specyfied byte method write contents specyfied string content delimitator request false connection minimum contentsize make compression add mime type which compressable set compressable mime type list method best when used set compressable mime type list acknowlege request default what socket tells us overriden host check content allready gzipped force mode allways compress test purposes only check suffisant len trig compression acknowlege request default what socket tells us overriden host acknowlege request default what socket tells us overriden host throws ioexception undelying error occured read operations given buffer big enough accomodate fill internal buffer using data from undelying input stream throws ioexception undelying error occured throws ioexception undelying error occured send throws ioexception undelying error occured throws ioexception undelying error occured method write contents specyfied message bytes method write contents specyfied message bytes method write contents specyfied char method write contents specyfied byte method write contents specyfied string read operations given buffer big enough accomodate read operations given buffer big enough accomodate fill true false reques line parsing throws ioexception undelying error occured throws ioexception undelying error occured send throws ioexception undelying error occured send throws ioexception undelying error occured set associated reauest our base null we know more properites evaluate followng token therefore first error token default urls download pluging netscape ie generation smap info jsr45 debuggin suppressed
background jsp compile thread check intervall generation smap info jsr45 debuggin suppressed convienient catch just top level generation smap info jsr45 debuggin suppressed obtain jsp informantion specified web xml acceptible candidate uri root strip basde slash since combined root directory deperator char derived package name directly mirrors file heirachy jsp page tag library exposed either explicitely web xml implicitely via uri tag tld obtain jsp informantion specified web xml collect info about page nodes make them availabe through has dependencies check also extended its dependeants so method can overidden subclasses compiler instead global mapper mapper used ecah call el generation static initializers preamble example dependant check bean alredy initilaize local variables used method int src line relative starting srouce line short name endcoded make resultant string valid java obtain link jar scanner associated specificed link url patterns follwoing flag set delay incrmenting tag dependent nesting until jsp body gets uniq identifier which index array source set null just convience maybe used dependent upon dpendent file changes jsp page applicaiton context process destory event web application context replacment binary name would work internal data jsp page jsp docuement xml also included here visitor class tranversing nodes page bom mandatary attribute name checked validator postion source line relative line auxillary classes used node perform miscellean checks after nodes visited url jar containign tag file dependency exists circularily dependant tag add dependants tag file its parent dependant list only reliable dependency information assumed have been proccessed encapsulated tag file info return tag info correspoding tag file directives following directis ignored text constructor some page global value those from page direcitves stored bodyconet simple tag cannot jsp string litteral must castable what declared type interface allows plugin author make inqueries about used declare innter class method class variable generate codesto evaluate value attribute custom tag deemed too compilicated optimization mehtod throw ioexception buffer has already been param request servlet requset we processing when compiling tag files circular dependencies prototpe assign appropriate value tp charset constructors provided easliy create wrappers error signalling error next block read we invocation when read method inovked uses throws ioexception errot easier grep logs only excpetion stacktraces which always preceeded whitespace make simple skip them also possible user modifed jre lib logging properties bad design comitee can really bad impact performance implemention should ensure though ordering behaves note just wrapper arround jdk logging like example running following ant scriplet specified object class has overidden string method
type instance variable used avoid unsing rtti when doing retruns catalina component name retruns jndi component name param auth resource param auth resource crete new ejb instance crete new ejb instance using open ejb crete new resource env instance object factory user trasactions crete new user transaction instance return enumeration search results objects satisy connect dir context retrive bound object well return enumeration search results objects satisy return vector containg naming entry objects retriving object encapsultes contents resource find map elemnt given its name sorted array map elements return enumeration search results objects satisy param buf containg bytes write return string up len bytes readed param perm permissions new direcoty param perm permissions new direcoty
write data from aray byte arrays specified file write data from aray byte arrays specified file return readed character function should used preference explict manipulation param file file retrive flags number instances unlimite get name system default characer set data can retreved system public static final int apr pollnval 0x040 descriptior invalid descriptor signalled apr pollset poll param descriptors array signalled descriptors output parameter desctiptor array must two times size pollset return number signalled descriptors output parameter param descriptors array signalled descriptors output parameter desctiptor array must size pollset return number signalled descriptors output parameter desctiptor array must two times size pollset object attached pool globaly referenced untill pool cleared data set called null data restart occuring perform any necessary cleanup including health check occuring most maintainence functions allocate apr proc stucture from pool hardware accellerator card crypto operations close bio derefrence callback object param file file contatining dh params asssociate biocallback input output data capture warn varning messages renegotation reconfigured cipher suite after http request encrypted password prompt dispayed established per directory context forces ssl renegotation create make accessable shared memory segment all plaforms support anonymous shared memory segments some cases prefered over other types shared memory elapsess data read written private method geting socket struct members param socket soocket use return stucture member address number miliseconds per microsecond number microseconds since 00 00 00 january 1970 utc return apr success apr uid strutures identify same user return apr success apr gid strutures identify same group get trimed text content node null text param parent lookup direct childs check overriden uses standard jdk mechansim reader provides mechanisms overriden do nothing reset internal state input interface used when buffer emptiy set buffer grow undefinitely you can also call explicitely force data written safer use clasical new string uses standard jdk mechansim writer provides mechanisms special writer class where close overritten default would set byte outputter null writter can recycled stream flush close overriden overriden do nothing reset internal state utilities manipluate char chunks while string designed imutable secure objects grow undefinitely set buffer grow undefinitely while waiting fot lock just return string value utility funtion re encode url create new unitialized entry each next element comparation less frequesnt than add we allways string unique namespace uri assoicate subsequent code rule code zero single argument from body ths element you wish use primitive type specify corresonding zero single argument from body ths element you wish use primitive type specify corresonding zero single argument from body ths element you wish use primitive type specify corresonding zero single argument from body ths element you wish use primitive type specify corresonding properties only affect saxparser emtpy constructor set publid id current file being parse you wish use primitive type specify corresonding you wish use primitive type specify corresonding you wish use primitive type specify corresonding you wish use primitive type specify corresonding needed before object can created common senario create code saxparser code configured support xml scheman dtd only xml content under element rule trigged li class imlements interface order were orginally registered you wish use primitive type specify corresonding you wish use primitive type specify corresonding introspect relevent objects so right method can called constructor allows attribute property mapping overriden property name indicates attibute should ignored have writeable property specified name you wish use primitive type specify corresonding you wish use primitive type specify corresonding introspect relevent objects so right method can called you wish use primitive type specify corresonding you wish use primitive type specify corresonding introspect relevent objects so right method can called sets digeseter using rules usefull methods content type processing register new unitialized cookie cookies recycled last qoute must dealt get token returns position delimeter given starting position after initial quote chracter gets input headers possible use message byte fileds so gc each next element comparation less frequesnt than add storing contensts file close delimiter boudary br index last valid characer buffer we prepend cr lf boundary chop trailng cr lf from read boundary succeded stream contains find map elemnt given its name sorted array map elements find map elemnt given its name sorted array map elements find map elemnt given its name sorted array map elements find map elemnt given its name sorted array map elements attribute writeable management applications some gratuituous flexibility removed instead more predictive supportd li list managed byeans keyed class name method should used explicitely load metadata same pacakge param get att map readable attributess map use endfile sending static files exit otherwise parallel descturction sockets which still 62 reocmpiling apr necessary remove limitation exit otherwise parallel descturction sockets which still param data containing reference data which should snet close socket reponse would incomplete close socket reponse would incomplete plain ol server sockets invokations both read write separate threads reg key ka avoid multiple calls gets reregistered after invokation note prefered mechanism gets intialized trust managers param max age
param class loader class loader set invoke next filter chain passing specified request response more filters chain invoke code service code method servlet itself param request servlet request we processing param response servlet response we creating param valve context valve context used forward next valve param valve context valve context used forward next valve param valve context valve context used forward next valve param valve context valve context used forward next valve param valve context valve context used forward next valve param valve context valve context used forward next valve param valve context valve context used forward next valve param send cluster domain only flag value public delta session null param message process get request specified resource param request servlet request we processing param response servlet response we creating exception ioexception input output error occurs exception servlet exception servlet specified error occurs param once unique supposedly unique token which has been used param realm realm name string once string nc string cnonce string qop user realm authenticate username client digest once param once unique supposedly unique token which has been used param realm realm name string once string nc string cnonce string qop once nc cnonce qop realm name md5a2 enables disables naming support param use naming new use naming value param body text body text element param body text body text element param options int sender options see class return cluster message replies from members any param sets message options param byte param off offset return number messages sent callback param class loader class loader used instantiate objects param off offset extract data from param indata message data contained within package param compressed compression flag indata buffer converts integer four bytes param integer return four bytes array param any long return use param compress boolean return param disable loopback mode disable loopback mode throws exception number milliseconds since members param name name member cluster unique param domain cluster domain name member param alive time number milliseconds since member created throws exception param name has name local member used filter local member from cluster membership param key key throws exception param pathname new pathname param remote ipheader comma delimited list proxies trusted when appear link remote ipheader header can expressed param socket socket from which http requests read param jar file jar file from which read included resource param tagfile param redeploy mode true compiler allow redeploying tag library from same jar expense slowing down server bit note may only work jdk 01a later because jdk bug 4211817 fixed release redeploy mode false faster less capable mode used service reference param service class service class service reference param service class service class service reference param service class service class service reference param service class service class param path path desired resource param fileset fileset converted param build exception thrown error occurs during execution param name local name parser namespace aware just param name local name parser namespace aware just instantiates mbean instance from data found persistent store data loaded could include attribute operation values method should called during construction instance before mbean registered code mbean server code strong note strong does support persistence exception instance found exception managed resource object cannot found exception mbean exception initializer object throws exception exception runtime operations exception exception reported persistence mechanism capture current state mbean instance write out persistent store state stored could include attribute operation values one methods persistence supported service found exception thrown strong note strong does support persistence exception instance found exception managed resource object cannot found exception mbean exception initializer object throws exception persistence supported exception runtime operations exception exception reported persistence mechanism set type mbean used key locate description registry param type type classname modeled object set type mbean used key locate description registry param type type classname modeled object set type mbean used key locate description registry create return default code model mbean info code object specified code model mbean info code instance valid strong note strong does check anything method can overridden required param info code model mbean info object check param selector selector selector use blocking null busy read initiated invalidate specified ssl session param session id id session invalidate
noop return param host null default host param dir base dir context static files must exist static version link add servlet string string string static version link add servlet string string servlet see add user host get host host add child ctx string url string path throws servlet exception host get host host add child ctx static version link init webapp defaults string cluster mananger cluster note response object depedent output stream writer still request servlet should perform any needed cleanup had recieved asynchronous io recieving events when data available reading remove tag library location forthe specified tag library uri return true namespace awarenes enabled return true namespace awarenes enabled host child webapps should discovred host child webapps should discovred return true namespace awarenes enabled valve pipeline any prioer setting basic valve exception illegal argument exception specifie valve refuses always sent log default otput sent only
prevent we attempt reuse previuosly pritorities output stream pritorities output stream flushes stream check correct lb worker pararmeter poperty manager lenght show size result manager lenght name em true em you can save all attributes from all found objects get mbean attriute from mbean server option you delemit your result delimiter so can ommitted environments do require we signalled after successful browser isn expecting conditional reposponse now web application propogated other web applications same server port which we should pretent requests connector look ssl sesison id required only look ssl session id which would permantely disable us coyote buffred reader coyote mostly processor preferred locales assocaited request param uriconverter new uri connverter error valve pick execption up display user error valve pick execption up display user set set cookies recieved request identify realm we use checking role assignmenets place so performance won suffer nonsecure case place so performance won suffer nonsecure case param charset string containing name chararacter encoding from append cookie value invokation handler have done li cancelling first dialog box trying one web application propogated other web applications send muticast merssage using format send muticast merssage using format modifcation from watch dir war detected war remvoe from watch dir number last message procssed message ids based check modification send notifcation listener set maximum number actives sessions allowed limit fixme replace currently sessions same id without notifcation exipre all find sessions request executed actions translate invokations methods last time session replicatd used distributed expiring nodes after all session stickyness work directly get name failed reqeust session attribute handle jvm route stickyness after tomcat instance failed after session id change propage other cluster nodes fixme set id trigger session listener only chance registiert manager correct id now sending change all other clusternode set orginal sessionid request allow application detect return event type string useful debugging reset active statitics param request current request after responce generated emitt failure event lifecylce listener receveived message code url code refering code null code resource validate classname per srv we must restict loading param path context path application undeployd limited number subsitutions message format can process maximium 10 can null thinl param idle expire all sessions idle time ge idle context limited number subsitutions message format can process maximium 10 jsf check browser meta tag accept languages choose what langage display cannot use side efects removed added back each time cannot use side efects removed added back each time cannot use side efects removed added back each time param context name mbean name comonent remove param name mbean name comonent remove param name mbean name comonent remove param name mbean name comonent remove param name mbean name comonent remove param name mbean name comonent remove semicolon separated list paths containing mbean desciptor resources create mbean connnector itself column user table holds user credintials param qop quality protection aplied message quality protection aplied message link text input callback ued pass various additional catalina base system property absolute pahtname code null code validation falied return code true code all cases because thie realm users via em java li realm iterates over code princpals code returned param qop quality protection aplied message column user table holds user credintials number tries numebr attempts connect database needs rewritten wuth better pooling support existing code number tries numebr attempts connect database needs rewritten wuth better pooling support existing code number tries numebr attempts connect database directory context timeout try one more associated user storage mecahisms achieves recording all failed should overriten jaasrealm avoid pretty inefficient conversions param target type code class code array used instanciate param target type code class code array used instanciate param target type code class code array used instanciate param target type code class code array used instanciate param target type code class code array used instanciate metavariable values according cgi specificion supplied script preceisely supplied client script relies heavliy servlet api methods find cgi invokation passed constuctor paramters strings param path path which has rewiten propfind helper method dispays properties lock null resource one colides http 207 parital update ok one colides http one colides http http tatus code return code connection code connection suceeded persistence even onlyfor restarts set maximum number actives sessions allowed set maximum number actives sessions allowed similar stategy eq above except similar stategy eq above except we try mimick apache here we do everywhere cut off file namee commands used mimick apache behavior set invalid code membership listener code br send options byte message message pure byte message marshalling processed above application just received forgot about featuer required heartbeat invokation resources cleanup etc return listen port member its listening unsecure port title represents globabally unique id first interceptor inteceptor stack sleep between invokations code channel heartbeat code except ues atomic long current size calculation return number messages sended callback some plattforms linux possible bind op senders created upon demans send reply after successfull sending update stats warning subclasses must very carefull only one thread call push message once wait from other server fixme please wait only three charcters better control wait ack message correct length when you have strange producer thread problemes limit queue legnth default unlimited weve written everything we starting new package timeout has occured clean up any cancelled keys relative absolute pathname ot file which we write encodes hex octects base64 decodes base64 data octects us locale all http dates english ensures all extension dependies resolved web application applicaiton validates those extensions runtime validation web applicaiton find manifest web applicaiton method should also provide static validation web applicaiton check applicaion itself extension param buf char array use bufferx convienience method check code manifest resource code param map map whose contents dupliated new map convert byte character value hexidecimal digit value disgester instance which class entity resolver all remote dtds schema locat destination translate put seconds since ecpoch translate put week year first sunday first day translate put week year first monday first day performing conditional loggging null every enounter closing ignore list current coment connections track conection webapp reload private hashtable port component ref null
class class class args iterator ports service get ports ports has next qname port name qname ports next public void set port component ref hashtable port component ref class class class args qname portname qname port component ref get class get name hashtable environment hashtable port component ref new hashtable class service interface class null map ports wsdlservice get ports iterator ports key set iterator has next string port name string next class interfaces null class service interfaces service interface class get interfaces service interface class null interfaces new class service interfaces length int service interfaces length interfaces service interfaces else interfaces new class array list soaproles new array list class handler class null array list headers new array list hashtable config new hashtable array list port names new array list handlerref set headers qname headers array new qname headers size iterator iter port names iterator init handler chain new qname string iter next handler registry enumeration port component ref elements init handler chain qname next element handler registry list extensions port get elements iterator extensions iterator has next element ext element next handler info handlerref array list soaproles add soaproles string soaproles add get
called servlet propogated caller servlet srv resquest response may have been wrapped called servlet propogated caller factory creation caching filters creationg prevent outside get instance method return fqctory instance convienience method which returns true dispatcher type request cross context since changes session accesss exception illegal argument exception specifie valve refuses valve pipeline any prioer setting basic valve return abbreviated name container logging messsages before mappings deploymenmt descriptor must inserted param doc base orginal document root allow base dir specified explicitely can overriden engine context host level consistency we probably embeded mode attribute value used turn off xml namespace awarenes host child webapps should discovred return true namespace awarenes enabled return mbean names valves assoicated host valve pipeline any prioer setting basic valve exception illegal argument exception specifie valve refuses unregister removed valave fixme pero why container stop first keep alive connetions can send request backward compat nobody should bother load explicitely service shouldn used embeded so doesn matter create new facede around standard wrapper some jmx statistics vavle associated standard wrapper deprecated deprecated deprecated deprecated deprecated
deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated public void set status int sc string sm deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated public int get column public int get line deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated deprecated matching pattern prefix default fargment setting
rule check code login config code occuring rule check code jsp config code occuring rule check code session config code occuring
attribute value used turn off tld namespace awarenes return true namespace awarenes enabled you wish use primitive type specify corresonding
-1
removing sercurity role segemnts read attribute value used turn off xml namespace awarenes
return true namespace awarenes enabled set namespace aware feature xml parser used when code false code applciation has been deployed does entry point admin webapp other jmx context controlers entry point admin webapp other jmx context controlers
return true redirction standard streams enabled tomcat embeded application already defines those
project null project log wrong object reference ref id version revision date string remote host empty string user empty request null user request get remote user string query request null query request get request uri pattern equals combined request null sk null sk cancel boostrap loader catalina application constructs class loader
stop standlone server stop standlone server li help display usage information li stop stop currently running instance catalina
nonaming start stop
args start args stop
jsp allowed template text string value attrs get value page info deferred syntax allowed literal contains deferred syntax value err jsp error jsp error el template deferred attrs get uri attrs get local name attrs get value false look sequence isn preceded private boolean contains deferred syntax string value value null return false int int len value length boolean prev char escape false while value length char value char len value char prev char escape return true else prev char escape true else prev char escape false return false string litteral must castable what declared type
name null name length return name null name length value null return name null name length return name null name length return name null name length value null return name null name length return
empty code enumeration code none
chance resource only missing temporarily eg renamed during text editor save try thread sleep 500 catch interrupted exception e1 ignore recheck resource see really deleted resource exists continue
parse comment parent else reader matches declaration reader skip until else reader matches expression reader skip until else reader matches scriptlet reader skip until org apache catalina util tomcat css tomcat css table cellspacing width 100 border table cellspacing width 100 border
string deploy path request get parameter deploy path string deploy config request get parameter deploy config string deploy war request get parameter deploy war else command equals deploy message deploy internal deploy config deploy path deploy war else command equals reload message reload path else command equals undeploy message undeploy path else command equals expire message expire sessions path request else command equals start message start path else command equals stop message stop path command null command equals upload do get request response return string message upload request small nbsp nbsp nbsp href onclick return confirm you sure nbsp nbsp href onclick return confirm you sure nbsp nbsp href onclick return confirm you sure nbsp small small nbsp href onclick return confirm you sure nbsp nbsp nbsp nbsp nbsp nbsp href onclick return confirm you sure delete application nbsp small small nbsp nbsp nbsp href onclick return confirm you sure nbsp nbsp href onclick return confirm you sure nbsp nbsp nbsp small small nbsp href onclick return confirm you sure nbsp nbsp nbsp nbsp nbsp nbsp nbsp small
what encoding use some platforms eg os use default encoding doesn give expected result so explicit string enc connector get uriencoding enc null enc iso 8859 semicolon2 request set requested session id new string uri bc get buffer start session id start semicolon2 session id start extract session id from request uri byte buf uri bc get buffer int end start semicolon2 buf start semicolon buf start semicolon2 uri bc set bytes buf start end start semicolon2 semicolon else request set requested session id new string uri bc get buffer start session id start end start session id start uri bc set end start semicolon request set requested session url true
catch bind exception throw new bind exception get message null get port throw new bind exception get message get address string get port
simple servlet test jndi servlet tries obtain url web inf web xml public static class get resource extends http servlet private static final long serial version uid 1l public void do get http servlet request req http servlet response res throws ioexception url url req get servlet context get resource web inf web xml res get writer write url obtained web inf web xml url null res get writer write null else res get writer write url string assert equals res string hello world currently sandbox tomcat lite assert equals res string hello tomcat user test https issues apache org bugzilla show bug cgi id 47866 public void test get resource throws exception tomcat tomcat get tomcat instance must have real doc base just use temp standard context ctx tomcat add context system get property java io tmpdir you can customize context calling its api tomcat add servlet ctx my servlet new get resource ctx add servlet mapping my servlet tomcat start int rc get url http localhost get port new byte chunk null assert equals http servlet response sc ok rc
path get buffer path offset path end
public int get max threads return max threads protected static final int tcn required patch protected static final int tcn recommended pv 16
cert length indicates error client cert null consume buffer request body so does interfere client handshake messages renegociate certificates sslsocket renegotiate socket get client certificate certificate chain present int cert length sslsocket get info socket ssl ssl info client cert chain byte client cert sslsocket get info socket ssl ssl info client cert certs null client cert null certs new cert length certificate factory cf certificate factory get instance 509 certs cf generate certificate new byte array input stream client cert int cert length byte data sslsocket get info socket ssl ssl info client cert chain certs cf generate certificate new byte array input stream data certs null request set attribute apr endpoint certificate key certs usually step between headers retrun ssl info parameter byte array retrun ssl info parameter string retrun ssl info parameter integer
sets log level warn loggers log information tomcat start up prevents usual startup information being logged console public void set silent logger get logger set level level warning
public standard wrapper add servlet string context path string servlet name string servlet class container ctx get host find child context path return add servlet standard context ctx servlet name servlet class param context path context add servlet param servlet name servlet name used mappings param servlet class class used servlet return wrapper servlet public standard wrapper add servlet string context path string servlet name string servlet class container ctx get host find child context path return add servlet standard context ctx servlet name servlet class static version link add servlet string string string param ctx context add servlet param servlet name servlet name used mappings param servlet class class used servlet return wrapper servlet use existing servlet class name performed param context path context set defaults public void init webapp defaults string context path container ctx get host find child context path init webapp defaults standard context ctx static version link init webapp defaults string param ctx context set defaults fix startup sequence required you don use web xml start method context set configured false expects listener set back true helper class wrapping existing servlets disables servlet
log debug expanded before replace
histo interval histo interval
welcome file processing take now we have looked welcome files physical backing now look extension mapping listed may have physical backing case index jsf index do etc watered down version rule mapping data wrapper null boolean check welcome files check jsp welcome files check welcome files char buf path get buffer check welcome files buf path end check welcome files int context welcome resources length mapping data wrapper null path set offset path offset path set end path end path append context welcome resources context welcome resources length path set offset servlet path internal map extension wrapper extension wrappers path mapping data path set offset servlet path path set end path end public static final string statements create statement prepare statement prepare call public static final string executes execute execute query execute update execute batch
process process statements method process param method method called one methods defined link statements new constructor abstract create statement interceptor statements length sql null compare executes name sql null compare executes name sql null compare executes name compare statements name constructor get constructor statement class else compare statements name constructor get constructor prepared statement class else compare statements name constructor get constructor callable statement class process process executes method process
driver reset driver reset assert equals size comparison 10 ds get pool get size
throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported throws unsupported operation operation supported override public void set up throws exception super set up override public void tear down throws exception super tear down
client set port get port private static final long serial version uid 1l private static class extends simple http client tomcat tomcat new tomcat standard context root tomcat add context temp dir tomcat add servlet root bug37794 new root add servlet mapping test bug37794 tomcat start finally try tomcat stop catch exception ignore private int port 8080 public void set port int port port port socket new socket localhost 8080 tomcat tomcat you run eclipse tomcat src dir string base file temp dir static int port 8001 long t0 public void set up throws exception t0 system current time millis temp dir new file base output tmp temp dir mkdir tomcat new tomcat tomcat set base dir temp dir get absolute path tomcat get host set app base temp dir get absolute path webapps each test running same port may interfere each other unix least port tomcat set port port public void tear down throws exception tomcat stop system err println test time system current time millis t0 expand war delete temp dir tomcat tomcat get tomcat instance must have real doc base just use temp tomcat add context temp dir get absolute path byte chunk res get url http localhost port tomcat tomcat get tomcat instance new file base output build webapps examples byte chunk res get url http localhost port examples servlets servlet hello world example tomcat add context null base
temp dir new file output tmp tomcat get host set app base temp dir get absolute path tomcat get host set app base temp dir get absolute path webapps expand war delete temp dir
string target type expected type get name
log debug request params enumeration string request get parameter names while has more elements string name next element log debug name request get parameter name executing code context invoke next code code invoke next code method has returned specified response after code invoke next code method has
-1
iterator resource entry loaded classes hash map string resource entry resource entries clone values iterator
get cluster null manager null manager instanceof cluster manager get cluster get manager cluster manager manager get name null now sending change all other clusternode cluster manager manager cluster manager catalina session get manager send session idcluster backup manager request session id new session id cluster null throw new runtime exception clustering support container container get name log info enabled cluster null log info sm get string jvm route cluster
msg null session set last time replicated system current time millis
protected transient boolean expiring false protected boolean valid false mark session being expired needed expiring check again now we inside sync so code only runs once double check locking expiring valid need volatile expiring valid return mark session being expired protected executor service executor new thread pool executor 0l time unit milliseconds new linked blocking queue runnable
task queue taskqueue new task queue executor new thread pool executor min threads max threads max idle time time unit milliseconds taskqueue tf taskqueue set parent thread pool executor executor task queue inner class class task queue extends linked blocking queue runnable thread pool executor parent null public task queue super public task queue int initial capacity super initial capacity public task queue collection extends runnable super public void set parent thread pool executor tp parent tp public boolean force runnable parent shutdown throw new rejected execution exception executor running can force command queue return super offer forces item onto queue used task rejected public boolean offer runnable we can do any checks parent null return super offer we maxed out threads simply queue object parent get pool size parent get maximum pool size return super offer we have idle threads just add queue so could use some tuning parent get active count parent get pool size return super offer we have less threads than maximum force creation new thread parent get pool size parent get maximum pool size return false we reached here we need add queue return super offer
realm name password roles user principal null construct new principal associated specified realm specified username password specified role names strings param realm realm owns principal param name username user represented principal param password credentials used authenticate user param roles list roles must strings possessed user param user principal principal returned from request get user principal call null null returned param login context provided used log out user appropriate time public generic principal realm realm string name string password list string roles principal user principal login context login context login context login context jaas login context any used authenticate principal kept so we can call logout protected login context login context null public login context get login context return login context principal principal create principal username subject param login context associated th princpal so link login context logout can called later protected principal create principal string username subject subject return new generic principal username null roles user principal call jaas logout method necessary principal instanceof generic principal generic principal gp generic principal principal gp get login context null try gp get login context logout catch login exception manager get container get logger error sm get string standard session
get delta request execute private set string var info names
else object could custom action associated jspx page context get attribute page context page scope else string builder msg new string builder jsp get property bean name msg append name msg append name previously introduced per jsp throw new jasper exception msg string add named objects lits introduced names enable later test per jsp variable info infos get variable infos infos null infos length int infos length variable info info infos info null info get var name null page info get var info names add info get var name var info names page info get var info names private set string var info names var info names new hash set string public set string get var info names return var info names
planet support values starts sha1 password starts sha
datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select datasource get pool properties set validation query select url jdbc mysql localhost 3306 mysql auto reconnect true driver class name com mysql jdbc driver password password username root validation query select string slow sql select result set rs st execute query slow sql
connection null throw new sqlexception driver driver returned null url driver url
create file read permission web app tempdir work directory new file permission work dir read permission collection add new file permission work dir read
public void set local loopback disabled boolean local loopback disabled properties set property local loopback disabled string value local loopback disabled message listener msgservice local loopback disabled local loopback disabled socket set loopback mode true hint we don need loop back messages
notify session listeners replication else add session
rentry reset diff
deployed app redeploy resources put xml get absolute path new long xml last modified deploy xml xml exists deployed app redeploy resources put xml get absolute path new long xml last modified file xml copy null file xml copy new file config base file xml deployed app redeploy resources put xml copy get absolute path new long xml copy last modified xml copy null deployed app redeploy resources put xml copy get absolute path new long xml copy last modified
code java lang method code code fire container event code method code org apache catalina core standard context code method our context class value computed dynamically first time needed after session reload since declared transient protected transient method container event method null method signature code fire container event code method protected static final class container event types string class object class org apache catalina core standard context equals context get class get name return container events supported note race condition harmless so do synchronize container event method null container event method context get class get method fire container event container event types object container event params new object container event params type container event params data container event method invoke context container event params private string date stamp private long current millis
current date new date system current time millis date stamp file date formatter format current date we need new current date current date new date systime string ts date file date formatter format current date current date new date system current time millis date stamp file date formatter format current date
public void parse host message bytes value mb when service started protected long service start time system current time millis
service start time system current time millis service start time long max value return service start time
package name locale get default private string manager string package name locale loc bundle resource bundle get bundle bundle name loc private string manager resource bundle bundle bundle bundle locale bundle get locale get string manager particular package manager package already exists reused else new string manager created returned param bundle resource bundle public synchronized static string manager get manager resource bundle bundle return new string manager bundle get string manager particular package locale manager package already exists reused else new string manager created locale returned param package name package name param loc locale public synchronized static string manager get manager string package name locale loc string manager mgr managers get package name loc string mgr null mgr new string manager package name loc managers put package name loc string mgr return mgr
string message request util filter response get message
host remove container listener connector get class get name index coyote connector try string address string utils get property connector address integer port integer utils get property connector port string buffer sb new string buffer domain sb append type connector sb append port port address null address length sb append address address name new object name sb string return name catch exception throw new malformed object name exception cannot create object name connector else cannot create object name connector connector set service service string mname create managed name connector managed bean managed registry find managed bean mname managed null return string domain managed get domain unregister associated request processor string worker null protocol handler handler connector get protocol handler handler instanceof worker handler get name else handler instanceof http11nio protocol worker http11nio protocol handler get name else handler instanceof http11apr protocol worker http11apr protocol handler get name else handler instanceof ajp protocol worker ajp protocol handler get name else handler instanceof ajp apr protocol worker ajp apr protocol handler get name object name query new object name domain type request processor worker worker set object name results mserver query names query null object name result results mserver unregister mbean result string mname create managed name context managed bean managed registry find managed bean mname managed null return string domain managed get domain user database resource need destroy groups roles users user database mbean org apache catalina user database equals resource get type destroy mbean user database resource get name string mname create managed name engine managed bean managed registry find managed bean mname managed null return string domain managed get domain string mname create managed name host managed bean managed registry find managed bean mname managed null return string domain managed get domain mserver registered oname global string cache fixed name oname new object name catalina type string cache mserver registered oname mserver unregister mbean oname mbean factory fixed name oname new object name catalina type mbean factory mserver registered oname mserver unregister mbean oname deregister mbean code user database code object name param user database user database managed exception exception mbean cannot deregistered static void destroy mbean user database string user database throws exception object name query null set object name results null groups query new object name users type group database user database results mserver query names query null object name result results mserver unregister mbean result roles query new object name users type role database user database results mserver query names query null object name result results mserver unregister mbean result users query new object name users type user database user database results mserver query names query null object name result results mserver unregister mbean result database itself object name db new object name users type user database database user database mserver unregister mbean db else lifecycle stop event equals event get type create mbean service itself log debug enabled log debug creating mbean service service mbean utils create mbean service deregister mbean connector itself log debug enabled log debug destroying mbean connector connector mbean utils destroy mbean connector service mbean utils destroy mbean context mbean utils destroy mbean engine mbean utils destroy mbean host mbean utils destroy mbean server destroy mbeans engine deregister mbean service itself log debug enabled log debug destroying mbean service service mbean utils destroy mbean service li directory server contains nested roles you can search roles recursively setting code role recursion limit code some positive value default value code code so role searches do recurse li maximum recursion depth when resolving roles recursively default we don resolve roles recursively protected int role recursion limit
return maximum recursion depth role searches public int get role recursion limit return role recursion limit set maximum recursion depth role searches param role recursion limit new recursion limit public void set role recursion limit int role recursion limit role recursion limit role recursion limit return nested group search flag flag public boolean get role nested return role nested set search subtree roles flag param role nested nested group search flag public void set role nested boolean role nested role nested role nested add roles user search other roles containing them themselves we search recursively limited depth default depth we only use direct roles search needs use role names return role names param depth recursion depth starting zero param context directory context we searching param recursive map cumulative result map role names dns param recursive set cumulative result set role names param group name role name add list param group dname name role exception naming exception directory server error occurs private void get roles recursive int depth dir context context map string string recursive map set string recursive set string group name string group dname throws naming exception container log trace enabled container log trace recursive search depth depth group group dname group name adding given group result set already found recursive set contains group dname recursive set add group dname recursive map put group dname group name depth role recursion limit role recursion limit container log warn terminating recursive role search because recursion limit role recursion limit results might incomplete return prepare parameters searching groups string filter role format format new string group dname search controls controls new search controls controls set search scope role subtree search controls subtree scope search controls onelevel scope controls set returning attributes new string role name container log trace enabled container log trace recursive search role base role base attribute role name filter expression filter searching groups assign given group naming enumeration search result results context search role base filter controls results null iterate over resulting groups try while results has more search result result results next attributes attrs result get attributes attrs null continue string dname get name context role base result string name get attribute value role name attrs name null dname null get roles recursive depth context recursive map recursive set name dname catch partial result exception ex ad compat throw ex iterator string keys iterator has next object next container log trace found direct role group map get hash set string recursive set new hash set string hash map string string recursive map new hash map string string iterator string keys iterator has next string next get roles recursive context recursive map recursive set group map get hash set string result set new hash set string list result set add all recursive map values container log trace enabled container log trace returning result set size roles iterator string result set iterator has next container log trace found role next return new array list string result set session attribute mturk
public static final string precompile system get property org apache jasper constants precompile jsp precompile
req set query string jsp precompile true
protected string get name dir context context string base search result result throws naming exception get entry name name parser parser context get name parser name context name parser parse context get name namespace name base name parser parse base bugzilla 32269 name entry name parser parse new composite name result get name get name name context name add all base name name name add all entry name return name string see comment set writer private int buffer size save
method returns size buffer used jsp writer return size buffer bytes unbuffered public int get buffer size according spec jsp writer returned jsp context push body java io writer writer must behave though were unbuffered means its get buffer size must always return return writer null buffer size writer null according spec jsp writer returned jsp context push body java io writer writer must behave though were unbuffered means its get buffer size must always return jsp writer get buffer size returns value jsp writer buffer size field which inherited class therefore we simply save current buffer size so we can later restore should body content impl ever reused call page context push body before setting buffer size buffer size save buffer size buffer size else buffer size buffer size save
setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true setting up filters parse some request headers rp set stage org apache coyote constants stage prepare try prepare request catch throwable log debug enabled log debug sm get string request prepare 400 internal server error response set status 400 error true spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib spec says cr lf method name buf pos constants cr buf pos constants lf throw new illegal argument exception sm get string iib
clazz loader load class name clazz loader load class name jreversion null version jreversion null version
-1
buffered reader close final thread group group final atomic integer thread number new atomic integer final string name prefix final boolean daemon final int thread priority thread pool executor parent null
-1
we can do any checks parent null return super offer we maxed out threads simply queue object parent get pool size parent get maximum pool size return super offer we have idle threads just add queue parent get active count parent get pool size return super offer we have less threads than maximum force creation new thread parent get pool size parent get maximum pool size return false we reached here we need add queue return super offer
req recycle req recycle
private final object application listeners lock new object private final object application parameters lock new object private final object constraints lock new object private final object filter maps lock new object private final object instance listeners lock new object private final object security roles lock new object private final object servlet mappings lock new object private final object watched resources lock new object private final object welcome files lock new object private final object wrapper lifecycles lock new object private final object wrapper listeners lock new object synchronized application listeners synchronized application parameters synchronized constraints synchronized filter maps synchronized filter maps synchronized instance listeners synchronized security roles synchronized servlet mappings synchronized watched resources synchronized welcome files synchronized wrapper lifecycles synchronized wrapper listeners synchronized instance listeners synchronized wrapper lifecycles synchronized wrapper listeners return application parameters return instance listeners synchronized security roles return security roles synchronized servlet mappings synchronized servlet mappings synchronized welcome files return watched resources return welcome files return wrapper lifecycles return wrapper listeners synchronized application listeners synchronized application parameters synchronized constraints synchronized filter maps synchronized instance listeners synchronized security roles synchronized servlet mappings synchronized watched resources synchronized welcome files synchronized wrapper lifecycles synchronized wrapper listeners instance listeners new string private final object aliases lock new object skip duplicate aliases int aliases length aliases equals alias return add alias list string new aliases new string aliases length int aliases length new aliases aliases new aliases aliases length alias aliases new aliases return aliases synchronized aliases return aliases synchronized members synchronized members synchronized members private final object listeners lock new object lock object changes listeners synchronized listeners synchronized listeners private final object listeners lock new object lock object changes listeners synchronized listeners synchronized listeners instance variables public static string jmx service prefix service jmx rmi jndi rmi public static string jmx service suffix jmxrmi public static final string standard imports public static final string cached dtd public ids public static final string cached dtd resource paths int constants standard imports length imports add constants standard imports
-1
int constants cached dtd public ids length string cached dtd public id constants cached dtd public ids string resource path constants cached dtd resource paths public data input stream run
log warn error reading dev random source ex random null try random close catch exception log warn failed close random dev random source null random null hack you can use static file genarate same random access controller do privileged new privileged set random file try random close catch exception log warn failed close random xml stylesheet type text xsl href manager xform xsl
-1
public string get string string key object args string string null check runtime exception some pre vm don do automatic string passed objects barf out try ensure arguments null so pre vm don barf args null args new object object non null args args int args length args null non null args args non null args args clone non null args null value null value key mf set locale locale string mf format non null args new string buffer null string catch illegal argument exception iae string buffer buf new string buffer buf append value int args length buf append arg args string buf string return string get string from underlying resource bundle format given object argument argument can course string object param key param arg public string get string string key object arg get string from underlying resource bundle format given object arguments arguments can course string objects param key param arg1 param arg2 public string get string string key object arg1 object arg2 get string from underlying resource bundle format given object arguments arguments can course string objects param key param arg1 param arg2 param arg3 public string get string string key object arg1 object arg2 get string from underlying resource bundle format given object arguments arguments can course string objects param key param arg1 param arg2 param arg3 param arg4 public string get string string key object arg1 object arg2
calendar calendar calendar get instance timezone int offset calendar get calendar dst offset
fix bugzilla 41606 set jsp servlet wrapper servlet class last modified time after successful compile string target file name ctxt get class file name target file name null file target file new file target file name target file exists jsw null jsw set servlet class last modified time target file last modified
support fire property change delegate new boolean old delegate new boolean delegate new boolean old anti jarlocking new boolean anti jarlocking new boolean old anti resource locking new boolean anti resource locking new boolean old available new boolean available new boolean old configured new boolean configured new boolean old cookies new boolean cookies new boolean old use http only new boolean use http only new boolean old cross context new boolean cross context new boolean old new boolean support fire property change ignore annotations boolean value old ignore annotations boolean value ignore annotations new boolean old privileged new boolean privileged new boolean old reloadable new boolean reloadable new boolean old override new boolean override new boolean old replace welcome files new boolean replace welcome files new integer old session timeout new integer session timeout new boolean old swallow output new boolean swallow output new long old unload delay new long unload delay status pages put new integer error page get error code return status pages get new integer error code error page error page status pages get new integer status status pages remove new integer error page get error code integer key new integer load startup
random new random system current time millis protected static random rand new random system current time millis public static random new random system current time millis public static random random new random system current time millis public static random new random system current time millis public static random new random system current time millis public static random new random system current time millis public static random new random system current time millis static random new random system current time millis
request reqs request session get attribute comet requests attribute session set attribute comet requests attribute new connection infos session remove attribute comet requests attribute
disable upload timeout kept alive licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
-1
public boolean get allow trace return request get connector get allow trace override default ensure trace correctly handled param req link http servlet request object contains request client made servlet param resp link http servlet response object contains response servlet returns client exception ioexception input output error occurs while servlet handling options request exception servlet exception request options cannot handled protected void do options http servlet request req http servlet response resp throws servlet exception ioexception string buffer allow new string buffer do get method allow append get head do post allow append post do put allow append put do delete allow append post trace assume disabled unless we can prove otherwise req instanceof request facade request facade req get allow trace allow append trace always allow options allow append options resp set header allow allow string
doc base starts canonical app base get path
response send error http servlet response sc bad request
get local name get attributes has empty body string short name attributes attrs boolean has empty body string attr names new string attrs get length int named attrs size attr names attrs get length named attribute named attrs get node get qname default depth infite private static final int infinity limit tree browsing bit
get servlet config get init parameter max depth null max depth integer parse int get servlet config get init parameter max depth int depth infinity depth infinity depth infinity lock depth infinity lock depth infinity lock depth infinity depth infinity
param page dir enc value page encoding attribute page private void compare tag encodings string page dir enc string page dir enc page dir enc upper case string page enc root get page encoding
pc get jsp compilation context get tag file jar url path deprecated use link get tag handler class name string string error dispatcher see https issues apache org bugzilla show bug cgi id 46471 return get tag handler class name path null err gets fully qualified class name tag handler given tag file path param path tag file path param err error dispatcher return fully qualified class name tag handler given tag file path public static string get tag handler class name string path string urn error dispatcher err throws jasper exception class name org apache jsp tag meta private static string get class name base string urn string buffer base new string buffer org apache jsp tag meta urn null base append make java package urn base append return base string deprecated use link parse tag file directives string url see https issues apache org bugzilla show bug cgi id 46471 return parse tag file directives file name ctxt get tag file jar url file name extracts tag file directive information from given tag file invoked compiler param file name name tag file parsed param tag file jar url location tag file public node nodes parse tag file directives string file name url tag file jar url throws file found exception jasper exception ioexception node nodes page do parse file name null ctxt get tag file jar url file name string tag class name jsp util get tag handler class name path err deprecated use link tag file processor parse tag file directives parser controller string string url tag library info see https issues apache org bugzilla show bug cgi id 46471 return parse tag file directives pc name path pc get jsp compilation context get tag file jar url path tag lib info parses tag file collects information directives included method used obtain info tag file when handler represents referenced tag file compiled here param pc current parser controller used compilation param name tag name specified tld param tagfile path tagfile param tag file jar url url jar containign tag file param tag lib info tag library info object associated tag info return tag info object assembled from directives tag file public static tag info parse tag file directives parser controller pc string name string path url tag file jar url tag library info tag lib info throws jasper exception page pc parse tag file directives path url tag file jar url null tag file path starts meta inf try tag file jar url new url jar compiler get compilation context get tld location tag info get tag library get uri catch malformed urlexception print stack trace string tag file jar path tag file jar url null tag file jar path else tag file jar path tag file jar url string jsp servlet wrapper wrapper rctxt get wrapper tag file path get runtime context ctxt get tag file jar url tag file path rctxt add wrapper tag file path wrapper see https issues apache org bugzilla show bug cgi id 46471 needs removed once all broken code depends has been removed parser controller name path do nothing
name starts constants jsp package name
db connection null throw new sqlexception sm get string jdbc realm open invalidurl driver name connection url
set name request util urldecode path args new object args display path args context get display name args null args nbsp args new boolean context get available args response encode url html sessions path display path args new integer args new integer args highlight color html start path display path html stop path display path html reload path display path html undeploy path display path html expire path display path td class row left bgcolor rowspan small href td class row left bgcolor rowspan small small td td class row center bgcolor rowspan small small td td class row center bgcolor rowspan small href target new small td
class type expected type composite expression must coerce string type string class composite expression must coerce string type string class tx substring mark expected type
econtainer null econtainer instanceof engine
pooling enabled set false we don use ie6 max age expires work around public static final boolean always add expires boolean value system get property org apache tomcat util http server cookie always add expires true boolean value
version else buf append max age buf append max age
catch privileged action exception pe throwable invocation target exception pe get exception else pe licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface represents server side api bayeux messaging protocol bayeux simple subscribe publish receive methodology far from jms much simplified br used both actual server side clients br server side clients use create retrieve subscribe channels server side clients represented just like remote clients through client interface br bayeux intended thread safe multiple threads may call bayeux methods br bayeux object starting point any cometd application relying bayeux object dependent container bayeux object stored code javax servlet servlet context code object attribute under name code bayeux dojox cometd bayeux code br retrieve object one would simply call br code bayeux bx bayeux get servlet context get attribute bayeux dojox cometd bayeux br br bayeux protocol pretty straight forward includes bunch messaging needed known clients both server side remote clients object gets initialized container dependent servlet servlet handles all bayeux from client remote messsages delivered channels server side clients using code listener code interface br br code bayeux session code active long webapp hosting bayeux object active br when shuts down bayeux object unsubscribe all clients remove all active channels author greg wilkins author filip hanik meta definitions channels public static final string meta meta meta definitions channels public static final string meta slash meta meta definitions channels connect message public static final string meta connect meta connect meta definitions channels client messsage public static final string meta client meta client meta definitions channels disconnect messsage public static final string meta disconnect meta disconnect meta definitions channels handshake messsage public static final string meta handshake meta handshake meta definitions channels ping messsage public static final string meta ping meta ping meta definitions channels reconnect messsage deprecated public static final string meta reconnect meta reconnect meta definitions channels status messsage public static final string meta status meta status meta definitions channels subscribe messsage public static final string meta subscribe meta subscribe meta definitions channels unsubscribe messsage public static final string meta unsubscribe meta unsubscribe field names inside bayeux messages field names inside bayeux messages client id field public static final string client field client id field names inside bayeux messages data field public static final string data field data field names inside bayeux messages channel field public static final string channel field channel field names inside bayeux messages id field public static final string id field id field names inside bayeux messages error field public static final string error field error field names inside bayeux messages timestamp field public static final string timestamp field timestamp field names inside bayeux messages transport field public static final string transport field transport field names inside bayeux messages advice field public static final string advice field advice field names inside bayeux messages successful field public static final string successful field successful field names inside bayeux messages subscription field public static final string subscription field subscription field names inside bayeux messages ext field public static final string ext field ext field names inside bayeux messages connection type field public static final string connection type field connection type field names inside bayeux messages version field public static final string version field version field names inside bayeux messages minimum version field public static final string min version field minimum version field names inside bayeux messages supported connection types field public static final string supp connection type field supported connection types field names inside bayeux messages json comment filtered field public static final string json comment filtered field json comment filtered field names inside bayeux messages reconnect field public static final string reconnect field reconnect field names inside bayeux messages interval field public static final string interval field interval field values inside bayeux messages retry response public static final string retry response retry field values inside bayeux messages handshake response public static final string handshake response handshake field values inside bayeux messages none response public static final string none response none service channel names starts public static final string service service service channel names trailing slash public static final string service slash service transport types transport types long polling public static final string transport long poll long polling transport types callback polling public static final string transport callback poll callback polling transport types iframe public static final string transport iframe iframe transport types flash public static final string transport flash flash servlet context attribute name used obtain bayeux object public static final string dojox cometd bayeux dojox cometd bayeux http field names http helpers text json content type public static final string json content type text json http helpers parameter name json message public static final string message parameter message http helpers name jsonp parameter public static final string jsonp parameter jsonp http helpers default name jsonp callback function public static final string jsonp default name client creates new server side client method invoked server side objects only you cannot create remote client using method client represents entity can subscribe channels publish receive messages through channels param idprefix string prefix string id generated can null param listener listener callback object called when messages delivered new client return client returns client interface public client new client string idprefix listener listener retrieve client based id return null client doesn exist param clientid string return client null client doesn exist returns client does public client get client string clientid returns non modifiable list all clients currently active bayeux session return list client list containing all clients list can modified public list client get clients returns true client given id exists br same executing code get client id null code param client id string return boolean true client exists public boolean has client string client id removes client all together unsubscribe client any channels may subscribed remove from list param client client return client returns client removed null client removed public client remove client client channel returns channel given channel id channel doesn exist code create code parameter set true channel created added list active channels br code create code set false channel doesn exist null returned param channel id string id channel retrieved created param create boolean true bayeux impl should create channel return channel null code create code set false channel doesn exist otherwise returns channel object public channel get channel string channel id boolean create returns list currently active channels bayeux session return list channel public list channel get channels removes channel from bayeux object also unsubscribe all clients currently subscribed channel param channel channel channel removed return channel returns channel removed null channel removed public channel remove channel channel returns true channel given channel id exists br same executing code bayeux get channel channel id false null code param channel id string return boolean true channel exists public boolean has channel string channel id message creates new message sent server side client return message returns new message object has unique id public message new message client from security policy returns security policy associated bayeux session return security policy public security policy get security policy sets security policy used bayeux session param security policy security policy public void set security policy security policy security policy licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux channel represents channel used receive messages from publish messages order publish messages receive messages from one must subscribe channel easily done invoking code subscribe code method channel created calling code bayeux get channel channel id true code method channel can created either server side invoking get channel client side using meta subscribe message without wildcard author greg wilkins author filip hanik returns id channel id unique within bayeux session return string never null public string get id publishes message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msg publishes more than one message all subscribers channel code from code contained within message calling code msg get client code param data message published can null public void publish message msgs non persistent channels removed when last subscription removed persistent channels survive periods without any subscribers return true channel persist without any subscription public boolean persistent param persistent true channel persist without any subscription see persistent public void set persistent boolean persistent subscribes client channel param subscriber client subscribed client already subscribed call create duplicate subscription public void subscribe client subscriber unsubscribes client from channel param subscriber client subscribed return returns client unsubscribed null client wasn subscribed public client unsubscribe client subscriber returns non modifiable list all subscribers channel return list subscribers public list client get subscribers adds data filter channel all messages received channel run through filter param filter filter public void add filter data filter filter removes filter from channel returns filter removed null filter wasn channel param filter filter return filter null filter removed otherwise returns filter removed public data filter remove filter data filter filter licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license client may subscribe channels publish messages channels client instances should directly created uses should obtained via link bayeux get client string link bayeux new client string listener methods three types client may represented interface nl li server remote client connected via http created bayeux server when connect message comes li li server side client created application using link bayeux new client string listener method li li java client connected remote bayeux server implemented li nl author greg wilkins author filip hanik returns unique id client id unique within bayeux session return string null public string get id returns true client holding messages delivered remote client method always returns false local clients since messages delivered instantly using listener callback object return boolean public boolean has messages deliver message client only deliver message directly client message filtered published channel param message public void deliver message message deliver batch messages client only deliver batch messages directly client messages filtered published channel param message public void deliver message message return true client local false client either remote http client java client remote server public boolean local starts batch messages delivered until end batch called batches can nested messages only delivered after last end batch has been called public void start batch ends batch since batches can nested messages only delivered after end batch has been called many times start batch has public void end batch licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license data filter br data filters used transform data sent channel messages filtered message published channel invoking link channel publish message method br method gets invoked two different scenarios first being when message received from remote client bayeux invokes publish method directly second scenario when local client invokes link channel publish message directly local jvm author greg wilkins author filip hanik runs message through filter filtering can only modify existing object can replace param data message message filtered may null public void filter message data licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license cometd listener interface br local clients order receive messages pass callback object when local client created using link bayeux new client string listener method callback object implementing listener interface used deliver messages local jvm clients author greg wilkins author filip hanik method called when client removed explicitly from timeout param timeout true client removed from timeout false removed explicitly public void removed boolean timeout invoked when message delivered client message contains message itself well what channel message came through who sender someone invoked link client deliver message channel reference null param msg public void deliver message msg licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license bayeux message br bayeux message map string object key value pairs representing data message message contains information about channel published through who sender author greg wilkins author filip hanik returns reference client sent message return client may null public client get client returns reference channel message published throuhg return channel may null public channel get channel returns unique id message return string public string get id sets time live milliseconds message hasn been delivered when time passed after creation time longer than ttl message expire removed from any delivery queues param ttl long public void set ttl long ttl returns time live milliseconds message return long public long get ttl returns timestamp milliseconds system current time millis when message created return long public long get creation time licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author greg wilkins boolean can handshake message message boolean can create client client string channel message message boolean can subscribe client client string channel message messsage boolean can publish client client string channel message messsage licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version public bayeux exception super public bayeux exception string message super message public bayeux exception string message throwable cause super message cause public bayeux exception throwable cause super cause licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interface defines methods managing bayeux request meta messages author guy molinari author filip hanik version public static final string last req attr org apache cometd bayeux last request public static final string current req attr org apache cometd bayeux current request public static final string json msg array org apache cometd bayeux json msg array validates specific request method must called prior process request can do pre processing validate method br should validation fail error object returned containing error message potentially stack trace exception generated return http error null error detected http error object containing information about error public http error validate processes remote client bayeux message param prevops operation requested previous request case chained requests return int returns interest operation comet event currently used throws bayeux exception error detected appropriate error response couldn delivered client public int process int prevops throws bayeux exception licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik author guy molinari version attribute hold tomcat bayeux object servlet context public static final string tomcat bayeux attr bayeux dojox cometd bayeux logger object protected static log log log factory get log bayeux servlet class servlet config future use protected servlet config servlet config reference global tomcat bayeux object protected tomcat bayeux tb upon servlet destruction servlet clean up tomcat bayeux object terminate any outstanding events public void destroy servlet config null do close all outstanding comet events tb destroy tb null do close everything down returns connection timeout timeout has been configured servlet init parameter named code timeout code default 2min used return int timeout connection milliseconds protected int get timeout string timeout servlet config get init parameter timeout int timeout 120 1000 min try timeout integer parse int timeout catch number format exception nfe ignore we have default value return timeout protected int get reconnect interval string rs servlet config get init parameter reconnect interval int rct 1000 seconds try rct integer parse int rs catch number format exception nfe ignore we have default value return rct public void event comet event comet event throws ioexception servlet exception comet event event type type comet event get event type log debug enabled log debug thread current thread get name received comet event type type subtype comet event get event sub type synchronized comet event type comet event event type begin begin event set timeout comet event set timeout get timeout check bayeux comet event read event should always come else type comet event event type read check bayeux comet event else type comet event event type error tb remove comet event comet event close else type comet event event type end tb remove comet event comet event close end synchronized event param comet event comet event return boolean true we comet event stays open throws ioexception throws unsupported operation exception protected void check bayeux comet event comet event throws ioexception unsupported operation exception we actually have data data can text json bayeux json content type equals comet event get http servlet request get content type read decode bytes according content length log warn thread current thread get name json encoding supported throw exception abort request int comet event get http servlet request get content length throw new unsupported operation exception decoding bayeux json content type yet implemented else get method application www form urlencoded string message comet event get http servlet request get parameter bayeux message parameter log trace enabled log trace thread current thread get name received json message message try int action handle bayeux message comet event log debug enabled log debug thread current thread get name bayeux handling complete action result action action comet event close catch exception print stack trace tb remove comet event log error comet event close protected int handle bayeux string message comet event event throws ioexception servlet exception int result message null message length return result try bayeux request request null message can array messages jsonarray js array new jsonarray message int js array length jsonobject msg js array get jsonobject log debug enabled log debug thread current thread get name processing bayeux message msg request request factory get request tb event msg log debug enabled log debug thread current thread get name processing bayeux message using request request result request process result log debug enabled log debug thread current thread get name processing bayeux message result result result request null event get http servlet request set attribute bayeux request last req attr request client impl ci client impl tb get client request base request get client id ci add comet event event log debug enabled log debug thread current thread get name done bayeux message added request attribute else result request null request base deliver event client impl tb get client request base request get client id log debug enabled log debug thread current thread get name done bayeux message delivered client catch log error do impl error handling result catch bayeux exception log error do impl error handling result return result public servlet config get servlet config return servlet config public string get servlet info return tomcat bayeux servlet public void init servlet config servlet config throws servlet exception servlet config servlet config servlet context ctx servlet config get servlet context ctx get attribute tomcat bayeux attr null ctx set attribute tomcat bayeux attr new tomcat bayeux tb tomcat bayeux ctx get attribute tomcat bayeux attr tb set reconnect interval get reconnect interval public void service servlet request servlet request servlet response servlet response throws servlet exception ioexception servlet response instanceof http servlet response http servlet response servlet response send error 500 tomcat server must configured support comet operations else throw new servlet exception tomcat server must configured support comet operations bayeux protocol licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected static log log log factory get log channel impl class unique id channel protected string id null list current subscribers protected linked list client subscribers new linked list client list current filters protected linked list data filter filters new linked list data filter channel persistent default value true protected boolean persistent true creates new channel param id string id channel can null protected channel impl string id assert id null id id returns id channel return string public string get id return id returns true channel matches pattern its id channel pattern can complete name like code service mychannel code can wild card pattern like code service app2 code param pattern string according bayeux section channel globbing can null return boolean true id channel matches pattern public boolean matches string pattern pattern null throw new null pointer exception channel pattern must null get id equals pattern return true int wildcard pos pattern index wildcard pos return false boolean multi segment pattern index string lead substring pattern substring wildcard pos lead substring null return false multi segment return get id starts lead substring else get id length wildcard pos return false return get id substring wildcard pos contains return returns non modifiable list subscribers channel public list client get subscribers return collections unmodifiable list subscribers return true channel persist without any subscription public boolean persistent return persistent public void publish message msg publish new message msg public void publish message msgs msgs null return message impl imsgs new message impl msgs length int msgs null msgs length message data msgs data instanceof message impl throw new illegal argument exception invalid message class you can only publish messages created through bayeux new message method log debug enabled log debug publishing message data channel clone so we can set channel reference message impl msg message impl message impl data clone channel delivered through msg set channel pass through filters iterator data filter filters iterator has next next filter msg imsgs msg deliver clients iterator client subscribers iterator has next client impl client impl next deliver internal imsgs public void set persistent boolean persistent persistent persistent public void subscribe client subscriber subscribers contains subscriber subscribers add last subscriber client impl subscriber subscribed public client unsubscribe client subscriber subscribers remove subscriber client impl subscriber unsubscribed return subscriber else return null public void add filter data filter filter filters contains filter filters add last filter public data filter remove filter data filter filter filters remove filter return filter else return null public string string string buffer buf new string buffer super string buf append channel id append get id return buf string licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static final int support callback poll 0x1 public static final int support long poll 0x2 public static final string comet event attr org apache cometd bayeux client protected static log log log factory get log client impl class protected static linked list message empty list new linked list message queued message remote clients protected linked list message messages null protected queue comet event events new linked list comet event unique id representing client protected string id supported connection types defaults long polling protected int supported conn types support long poll support callback poll desired connection type protected int desirect conn type support long poll does client use json comment filtered messages protected boolean use json filtered false same jvm clients get local true protected boolean local callback object local clients protected listener listener protected atomic integer new atomic integer protected client impl string id boolean local id id local local local messages new linked list message protected client impl string id comet event event id false events new concurrent linked queue comet event add comet event event public synchronized void deliver message message deliver internal null new message impl message impl message public synchronized void deliver message message deliver internal null message protected synchronized void deliver internal channel impl channel message impl message deliver internal channel new message impl message protected synchronized void deliver internal channel impl channel message msgs local local clients must have listener array list message list new array list message int msgs null msgs length dont deliver ourselves msgs get client list add msgs get listener null list size get listener deliver list array new message else int msgs null msgs length message impl message message impl msgs message get client dont deliver ourself continue we implementing forever responses client connected we fire off message first we check see we have any existing connections we can piggy back comet event event events poll boolean delivered false todo todo check thread safety writing getting last request event null synchronized event request base rq request base event get http servlet request get attribute request base last req attr rq null map map new hash map try map put bayeux channel field message get channel get id map put bayeux data field message jsonobject json new jsonobject map log debug enabled log debug message instantly delivered remote client message json rq add delivery queue json deliver batch msgs length rq deliver event event close todo figure out better way means only one message gets delivered remove comet event event delivered instantly delivered true catch exception log error delivered log debug enabled log debug message added queue remote client message message queue message next round messages add message public string get id return id protected listener get listener return listener public boolean has messages local return false else return messages size public boolean local return local public int get supported conn types return supported conn types public int get desirect conn type return desirect conn type public boolean use json filtered return use json filtered public void set listener listener listener listener listener public void set supported conn types int supported conn types supported conn types supported conn types public void set use json filtered boolean use json filtered use json filtered use json filtered public void set desirect conn type int desirect conn type desirect conn type desirect conn type public boolean supports callback poll return supported conn types support callback poll support callback poll public boolean supports long poll return supported conn types support long poll support long poll public synchronized list message take messages local return null messages size return empty list list result new linked list messages messages clear return result public string string string buffer buf new string buffer super string buf append id append get id return buf string public boolean subscribed return get protected synchronized boolean add comet event comet event event boolean result false events contains event events add event result true event get http servlet request set attribute comet event attr return result protected synchronized boolean remove comet event comet event event boolean result events remove event event get http servlet request remove attribute comet event attr return result protected void subscribed channel impl ch add get protected void unsubscribed channel impl ch add get public void start batch noop until improved public void end batch noop until improved private int code private string status private throwable cause public http error int code string status throwable cause code code status status cause cause public void set code int code code code public void set status string status status status public void set cause throwable exception cause exception public int get code return code public string get status return status public throwable get cause return cause public string string cause null return code status cause else return code status licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license protected channel channel protected client client protected string id private long ttl 1000 60 5min default ttl message protected long creation time system current time millis public object clone message impl copy new message impl id copy put all copy channel channel copy client client copy id id copy creation time creation time copy ttl ttl return copy protected message impl string id assert id null id id public channel get channel return channel public client get client return client public long get creation time return creation time public long get ttl return ttl public string get id return id protected void set channel channel channel channel channel protected void set client client client client client public void set ttl long ttl ttl ttl licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license common member variables all bayeux requests author guy molinari author filip hanik version protected static final simple date format timestamp fmt new simple date format yyyy mm dd hh mm ss sssz static timestamp fmt set time zone time zone get time zone gmt message properties combined all messages protected tomcat bayeux tomcat bayeux protected string channel protected string id protected string client id protected string version null protected string supp conn types null protected int supp conn types flag protected int desired conn type flag protected string min version null protected string subscription null protected string data null protected string con type null protected linked hash map string object ext new linked hash map string object protected comet event event protected hash map string object response null protected static log log log factory get log request base class protected int reconnect interval 1000 protected request base tomcat bayeux tb comet event event jsonobject js req throws tomcat bayeux tb event event channel js req opt string bayeux channel field id js req opt string bayeux id field client id js req opt string bayeux client field version js req opt string bayeux version field min version js req opt string bayeux min version field con type js req opt string bayeux connection type field subscription js req opt string bayeux subscription field data js req opt string bayeux data field reconnect interval tb get reconnect interval js req has bayeux ext field jsonobject jext js req get jsonobject bayeux ext field iterator string jext keys has next string key next ext put key jext get key end js req has bayeux supp connection type field jsonarray types js req get jsonarray bayeux supp connection type field supp conn types new string types length int types length supp conn types types get string bayeux transport callback poll equals supp conn types supp conn types flag supp conn types flag client impl support callback poll else bayeux transport long poll equals supp conn types supp conn types flag supp conn types flag client impl support long poll end con type null bayeux transport callback poll equals con type desired conn type flag client impl support callback poll else bayeux transport long poll equals con type desired conn type flag client impl support long poll end due fact javascript doesn send up required field we have fake supp conn types flag client impl support callback poll client impl support long poll public http error validate http error result null return result public tomcat bayeux get tomcat bayeux return tomcat bayeux public string get channel return channel public string get id return id public string get client id return client id public linked hash map get ext return ext public comet event get event return event protected static void deliver comet event event client impl throws ioexception servlet exception bayeux exception jsonarray jarray get jsonarray event true jarray null throw new bayeux exception message send string jsonstring jarray string log debug enabled log debug thread current thread get name delivering message message jsonstring null use json filtered event get http servlet response committed event get http servlet response set content type text json comment filtered else event get http servlet response committed event get http servlet response set content type text json print writer out event get http servlet response get writer null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll string jsonp event get http servlet request get parameter bayeux jsonp parameter jsonp null jsonp bayeux jsonp default name out print jsonp out print else throw new bayeux exception client doesn support any appropriate connection type out print jsonstring null do nothing else get desirect conn type supports long poll get desirect conn type client impl support long poll use json filtered out print else get desirect conn type supports callback poll get desirect conn type client impl support callback poll out print out flush event get http servlet response flush buffer protected static jsonarray get jsonarray comet event event boolean nullok synchronized event jsonarray jarray jsonarray event get http servlet request get attribute json msg array jarray null nullok jarray new jsonarray event get http servlet request set attribute json msg array jarray return jarray protected jsonarray get jsonarray return get jsonarray event false protected void add delivery queue client impl jsonobject msg throws ioexception servlet exception bayeux exception synchronized event get jsonarray put msg protected void flush messages client impl client throws bayeux exception list message msgs client take messages synchronized event try iterator message msgs iterator has next message impl msg message impl next map map new hash map map put bayeux channel field msg get channel get id msg get client null map put bayeux client field msg get client get id map put bayeux data field msg jsonobject obj new jsonobject map add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception public int process int prevops throws bayeux exception event get http servlet request set attribute current req attr return prevops public int get reconnect interval return reconnect interval public string get time stamp return timestamp fmt format new date system current time millis licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license public static bayeux request get request tomcat bayeux tomcat bayeux comet event event jsonobject msg throws string channel msg opt string bayeux channel field bayeux meta handshake equals channel return new meta handshake request tomcat bayeux event msg else bayeux meta connect equals channel return new meta connect request tomcat bayeux event msg else bayeux meta disconnect equals channel return new meta disconnect request tomcat bayeux event msg else bayeux meta subscribe equals channel return new meta subscribe request tomcat bayeux event msg else bayeux meta unsubscribe equals channel return new meta unsubscribe request tomcat bayeux event msg else return new publish request tomcat bayeux event msg licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected int reconnect interval 5000 list all active clients protected hash map string client clients new hash map string client list all active channels protected linked hash map string channel channels new linked hash map string channel security policy used protected security policy security policy null default client use when we need send error message don have client valid reference protected static client impl error client new client impl error client false returns default error client return client impl public static client impl get error client return error client protected tomcat bayeux should invoked when servlet destroyed when context shuts down public void destroy throw new unsupported operation exception tomcat bayeux destroy yet implemented public channel get channel string channel id boolean create channel result channels get channel id result null create result new channel impl channel id channels put channel id result return result public channel remove channel channel return channels remove channel get id public client remove client client client null return null channel ch get channels ch unsubscribe client return clients remove client get id public client get client string client id return clients get client id public boolean has client string client id return clients contains key client id public list client get clients return java util arrays list clients entry set array new client public security policy get security policy return security policy public int get reconnect interval return reconnect interval public boolean has channel string channel return channels contains key channel public client new client string idprefix listener listener boolean local comet event event string id create uuid idprefix client impl client new client impl id local client set listener listener clients put id client return client public client new client string idprefix listener listener assert listener null method gets called someone using api inside jvm local client return new client idprefix listener true null protected client impl get client impl comet event event return client impl event get http servlet request get attribute client impl comet event attr protected void remove comet event event client impl client get client impl event client null client remove comet event event public string create uuid string idprefix idprefix null idprefix return idprefix arrays string random uuid false public list channel get channels return java util arrays list channels entry set array new channel protected message new message string id create uuid msg return new message impl id public message new message client from message impl msg message impl new message msg set client from return msg public void set security policy security policy security policy security policy security policy public void set reconnect interval int reconnect timeout reconnect interval reconnect timeout licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta connect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta connect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req client id null get tomcat bayeux has client client id event get http servlet request set attribute client get tomcat bayeux get client client id check client request validity per section bayuex spec connect request must contain meta connect channel identifier client id returned server after handshake desired connection type must one server supported types returned handshake response return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null bayeux transport long poll equals con type bayeux transport callback poll equals con type return new http error 400 unsupported connection type null return null error transition connected state flushing pending messages available pending messages flush connection held until pending publish event delivered client section spec public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id boolean success false http error error validate error null client set desirect conn type desired conn type flag hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval success true else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return immediately so we can process next message int result client subscribed success client null client has messages send out messages flush messages client result flush out messages return result licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta disconnect response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta disconnect request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta disconnect channel identifier client id return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error disconnect client session public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else get tomcat bayeux remove client response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect none client null client tomcat bayeux get error client response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta handshake response template put bayeux version field response template put bayeux supp connection type field new string bayeux transport long poll bayeux transport callback poll response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta handshake request tomcat bayeux tomcat bayeux comet event event jsonobject js req throws super tomcat bayeux event js req public string get version return version public string get minimum version return min version check client request validity per section bayuex spec handshake request must contain meta handshake channel identifier version protocol supported client client supported connection types return http error method returns null errors were found public http error validate boolean error version null version length error error supp conn types flag error return new http error 400 invalid handshake request supported connection type field missing null else return null generate return client identifier return list supported connection types must subset identical list types supported client see section bayuex public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client null http error error validate error null client client impl get tomcat bayeux new client http null false get event client id client get id client set supported conn types supp conn types flag client set use json filtered get ext get bayeux json comment filtered field null response put bayeux client field client get id hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string client tomcat bayeux get error client hash map response get bayeux advice field put bayeux reconnect field bayeux none response try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta subscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta subscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta subscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error register interest one more channels per section bayeux spec pattern may specified assign client matching channels inverse client channel reference public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean subscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch subscribe client subscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch subscribe client subscribed true response put bayeux successful field boolean value subscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version protected static hash map string object response template new hash map string object static response template put bayeux channel field bayeux meta unsubscribe response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public meta unsubscribe request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain meta unsubscribe channel identifier client id subscription name channel interest pattern return http error method returns null errors were found public http error validate client id null get tomcat bayeux has client client id return new http error 400 client id valid null subscription null subscription length return new http error 400 subscription missing null return null error de register interest one more channels per section bayeux spec pattern may specified sever public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client impl get tomcat bayeux get client client id http error error validate error null boolean wildcard subscription index boolean unsubscribed false wildcard list channel channels get tomcat bayeux get channels iterator channel channels iterator while has next channel impl ch channel impl next ch matches subscription ch unsubscribe client unsubscribed true else channel impl ch channel impl get tomcat bayeux get channel subscription true ch unsubscribe client unsubscribed true response put bayeux successful field boolean value unsubscribed response put bayeux subscription field subscription hash map response get bayeux advice field put reconnect retry hash map response get bayeux advice field put interval get reconnect interval else response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put reconnect handshake client null client tomcat bayeux get error client response put bayeux client field client get id response put bayeux timestamp field get time stamp try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception return licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license handshake request bayeux message author guy molinari author filip hanik version jsonobject msg data null protected static hash map string object response template new hash map string object static response template put bayeux successful field boolean true response template put bayeux advice field new hash map string object public publish request tomcat bayeux tb comet event event jsonobject js req throws super tb event js req check client request validity per section bayuex spec connect request must contain channel identifier channel publication data send return http error method returns null errors were found public http error validate channel null get tomcat bayeux has channel channel return new http error 400 channel id valid null data null data length return new http error 400 message data missing null try msg data new jsonobject data catch return new http error 400 invalid json object data attribute client id null get tomcat bayeux has client client id return new http error 400 client id valid null return null error send event message all registered subscribers public int process int prevops throws bayeux exception super process prevops response hash map string object response template clone client impl client client id null client impl get tomcat bayeux get client client id client impl event get http servlet request get attribute client boolean success false http error error validate error null channel impl chimpl channel impl get tomcat bayeux get channel channel false message impl mimpl message impl get tomcat bayeux new message client try string keys jsonobject get names msg data int keys length mimpl put keys msg data get keys success true hash map response get bayeux advice field put bayeux reconnect field bayeux retry response hash map response get bayeux advice field put bayeux interval field get reconnect interval catch log error enabled log error unable parse msg data throw new bayeux exception chimpl publish mimpl success response put bayeux successful field boolean false response put bayeux error field error string hash map response get bayeux advice field put bayeux reconnect field bayeux handshake response client null client tomcat bayeux get error client response put bayeux channel field channel response put bayeux client field client get id try jsonobject obj new jsonobject response add delivery queue client obj catch servlet exception throw new bayeux exception catch ioexception throw new bayeux exception success client null client has messages send out messages flush messages client return servlet context attribute listener listener static atomic integer counter new atomic integer protected int id protected bayeux protected client protected boolean alive true protected boolean initialized false protected ticker thread tt new ticker thread public bayeux stock ticker id counter increment get system out println new listener created id id public void context destroyed servlet context event servlet context event alive false tt run false tt interrupt public void context initialized servlet context event servlet context event public void attribute added servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux initialized return initialized true system out println starting stock ticker server client bayeux scae get value new client stock ticker tt start public void attribute removed servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux initialized false bayeux scae get value list channel chs get channels channel ch chs ch unsubscribe public void attribute replaced servlet context attribute event servlet context attribute event public void removed boolean timeout system out println client removed public void deliver message msgs int msgs null msgs length message msg msgs system out println stock ticker server client received message msg public class ticker thread extends thread public boolean run true public ticker thread set name ticker thread public void run try stock stocks new stock new stock goog 435 43 new stock yhoo 27 88 new stock sprg 1015 55 stock stocks channel ch get channel stock get symbol true ch subscribe random new random system current time millis while run int int next int stock stock stocks double change next double boolean plus next boolean plus stock set value stock get value change else stock set value stock get value change channel ch get channel stock stock get symbol true message new message put stock stock string put symbol stock get symbol put price stock get value string put change stock get last change string ch publish system out println stock stock get symbol price stock get value string change stock get last change string thread sleep 850 catch interrupted exception ix catch exception print stack trace public static class stock protected static decimal format df new decimal format 00 protected string symbol protected double value 0d protected double lastchange 0d protected int cnt public stock string symbol double initvalue symbol symbol value initvalue public void set cnt int cnt public int get cnt return cnt public string get symbol return symbol public double get value return value public void set value double value double old value value value lastchange value old public string get value string return df format value public double get last change return lastchange public void set last change double lastchange lastchange lastchange public string get last change string return df format lastchange public int hash code return symbol hash code public boolean equals object other other instanceof stock return symbol equals stock other symbol else return false public string string string buffer buf new string buffer stock buf append get symbol buf append buf append get value string buf append buf append get last change string buf append buf append string value get cnt return buf string public object clone stock new stock get symbol get value set last change get last change set cnt cnt return static atomic integer counter new atomic integer protected int id protected bayeux protected client protected boolean alive true protected timestamp thread tt new timestamp thread public echo chat client id counter increment get system out println new listener created id id public void context destroyed servlet context event servlet context event alive false tt interrupt public void context initialized servlet context event servlet context event public void attribute added servlet context attribute event scae scae get name equals bayeux dojox cometd bayeux system out println starting echo chat client bayeux scae get value new client echochat channel ch get channel chat demo true ch subscribe tt start public void attribute removed servlet context attribute event servlet context attribute event public void attribute replaced servlet context attribute event servlet context attribute event public void removed boolean timeout system out println client removed public void deliver message msgs int msgs null msgs length message msg msgs system out println received message msg message new message put all msg echo same message put user contains key msg simple chat demo string chat string get msg put msg received your message chat substring chat index system out println sending message msg get channel publish public class timestamp thread extends thread public timestamp thread set daemon true public void run while alive try sleep 5000 channel ch get channel chat demo false ch get subscribers size continue message new message put user put chat time new java sql date system current time millis locale string put join false ch publish catch interrupted exception ignore thread current thread interrupted catch exception print stack trace xmlns http java sun com xml ns javaee xmlns xsi http www w3 org 2001 xmlschema instance xsi schema location http java sun com xml ns javaee http java sun com xml ns javaee web app xsd version display name cometd test web app display name servlet servlet name cometd servlet name servlet class org apache tomcat bayeux bayeux servlet servlet class init param param name timeout param name param value 120000000 param value init param init param param name reconnect interval param name param value 250 param value init param load startup load startup servlet servlet mapping servlet name cometd servlet name url pattern cometd url pattern servlet mapping listener listener class org apache cometd bayeux samples echo chat client listener class listener listener listener class org apache cometd bayeux samples bayeux stock ticker listener class listener dojox cometd init cometd cometd dojox cometd start batch dojox cometd subscribe stock goog msg event dojox cometd subscribe stock yhoo msg event dojox cometd subscribe stock sprg msg event dojox cometd end batch node undefined node null return var len node child nodes length break apart text string screen name message parts var symbol event data symbol var price event data price var pricechange event data change alert symbol symbol price price change pricechange var pricenode dojo id price symbol var changenode dojo id change symbol remove children from node pricenode remove children from node changenode var pricelabel document create text node price pricelabel value price var changelabel document create text node pricechange changelabel value pricechange pricenode append child pricelabel changenode append child changelabel var table dojo id stocktable var rows table get elements tag name tr rows length manipulate rows var row current dojo id row symbol pricechange row current bg color red else tr id row header td symbol td td price td td last change td td subscribe td tr tr id row sprg td sprg td td id price sprg td td id change sprg td td id check sprg input type checkbox id check sprg checked click subscribe sprg td tr tr id row goog td goog td td id price goog td td id change goog td td id check goog input type checkbox id check goog checked click subscribe goog td tr tr id row yhoo td yhoo td td id price yhoo td td id change yhoo td td id check yhoo input type checkbox id check goog checked click subscribe yhoo td tr licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license interceptor keep track connection state avoid roundtrips database author fhanik protected static log log log factory get log connection state class protected final string read state get auto commit get transaction isolation read only get catalog protected final string write state set auto commit set transaction isolation set read only set catalog protected boolean auto commit null protected integer transaction isolation null protected boolean read only null protected string catalog null public void reset connection pool parent pooled connection con pool properties pool properties parent get pool properties pool properties get default read only null try read only null read only boolean value pool properties get default read only boolean value con get connection set read only pool properties get default read only boolean value read only pool properties get default read only catch sqlexception read only null log error unable reset readonly state connection pool properties get default auto commit null try auto commit null auto commit boolean value pool properties get default auto commit boolean value con get connection set auto commit pool properties get default auto commit boolean value auto commit pool properties get default auto commit catch sqlexception auto commit null log error unable reset autocommit state connection pool properties get default catalog null try catalog null catalog equals pool properties get default catalog con get connection set catalog pool properties get default catalog catalog pool properties get default catalog catch sqlexception catalog null log error unable reset default catalog state connection pool properties get default transaction isolation data source factory unknown try transaction isolation null transaction isolation int value pool properties get default transaction isolation con get connection set transaction isolation pool properties get default transaction isolation transaction isolation pool properties get default transaction isolation catch sqlexception transaction isolation null log error unable reset transaction isolation state connection override public object invoke object proxy method method object args throws throwable string name method get name boolean read false int index int read read state length read compare name read state read index boolean write false int write read write state length write compare name write state write index object result null read switch index case result auto commit break case result transaction isolation break case result read only break case result catalog break default result null return cached result we have result null return result result super invoke proxy method args read write switch index case auto commit boolean read result args break case transaction isolation integer read result args break case read only boolean read result args break case catalog string read result args break return result licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license author filip hanik version protected final string statements create statement prepare statement prepare call protected final string executes execute execute query execute update execute batch protected static identity hash map connection pool hash map string query stats per pool stats new identity hash map connection pool hash map string query stats protected hash map string query stats queries null protected long threshold 100 don report queries less than protected int max queries 1000 don store more than amount queries public slow query report super public long get threshold return threshold public void set threshold long threshold threshold threshold override public void close invoked todo auto generated method stub override public object create statement object proxy method method object args object statement todo auto generated method stub string sql null method get name starts prepare sql args length args instanceof string string args null return new statement proxy statement sql protected boolean process final string names method method boolean process int process names length process compare method get name names return process protected class query stats private final string query private int nr invocations private long max invocation time private long max invocation date private long min invocation time private long min invocation date private long total invocation time public query stats string query query query public void add long invocation time long now thread safe don sacrifice performance kind stuff max invocation time math max invocation time max invocation time max invocation time invocation time now system current time millis max invocation date now min invocation time math min invocation time min invocation time min invocation time invocation time now now system current time millis now min invocation date now nr invocations total invocation time invocation time public string get query return query public int get nr invocations return nr invocations public long get max invocation time return max invocation time public long get max invocation date return max invocation date public long get min invocation time return min invocation time public long get min invocation date return min invocation date public long get total invocation time return total invocation time public int hash code return query hash code public boolean equals object other other instanceof query stats query stats qs query stats other return slow query report compare qs query query return false protected class statement proxy implements invocation handler protected boolean closed false protected object delegate protected final string query public statement proxy object parent string query delegate parent query query public object invoke object proxy method method object args throws throwable final string name method get name boolean close compare jdbc interceptor close val name close closed return null allow close called multiple times closed throw new sqlexception statement closed boolean process false process process executes method process long start process system current time millis execute query object result method invoke delegate args long delta process system current time millis start delta threshold string sql null todo query stats qs slow query report queries get sql qs null qs new query stats sql slow query report queries put string sql qs qs add delta return qs close closed true delegate null return result public void reset connection pool parent pooled connection con queries null slow query report per pool stats get parent null queries new linked hash map string query stats override protected boolean remove eldest entry entry string query stats eldest return size max queries apache license version january 2004 http www apache org licenses terms conditions use reproduction distribution definitions license shall mean terms conditions use reproduction distribution defined sections through document licensor shall mean copyright owner entity authorized copyright owner granting license legal entity shall mean union acting entity all other entities control controlled under common control entity purposes definition control means power direct indirect cause direction management entity whether contract otherwise ii ownership fifty percent 50 more outstanding shares iii beneficial ownership entity you your shall mean individual legal entity exercising permissions granted license source form shall mean preferred form making including limited software source code source files object form shall mean any form resulting from mechanical translation source form including limited compiled object code generated conversions other media types work shall mean work authorship whether source object form made available under license indicated copyright notice included attached work example provided appendix below derivative works shall mean any work whether source object form based derived from work which editorial revisions annotations elaborations other represent whole original work authorship purposes license derivative works shall include works remain separable from merely link bind name interfaces work derivative works thereof contribution shall mean any work authorship including original version work any additions work derivative works thereof submitted licensor inclusion work copyright owner individual legal entity authorized submit behalf copyright owner purposes definition submitted means any form electronic verbal written sent licensor its including limited electronic mailing lists source code control systems issue tracking systems managed behalf licensor purpose discussing improving work excluding marked otherwise designated writing copyright owner contribution contributor shall mean licensor any individual legal entity behalf whom contribution has been received licensor subsequently incorporated within work grant copyright license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable copyright license reproduce prepare derivative works publicly display publicly perform sublicense distribute work derivative works source object form grant patent license subject terms conditions license each contributor hereby grants you perpetual worldwide non exclusive charge royalty free irrevocable except stated section patent license make have made use offer sell sell import otherwise transfer work where license applies only those patent claims licensable contributor necessarily infringed contribution alone combination contribution work which contribution submitted you institute patent litigation against any entity including cross claim counterclaim lawsuit alleging work contribution incorporated within work constitutes direct contributory patent infringement any patent licenses granted you under license work shall terminate date litigation filed you may reproduce distribute copies work derivative works thereof any medium without source object form provided you meet following conditions you must give any other recipients work derivative works copy license you must cause any modified files carry prominent notices stating you changed files you must retain source form any derivative works you distribute all copyright patent trademark attribution notices from source form work excluding those notices do pertain any part derivative works work includes notice text file part its distribution any derivative works you distribute must include readable copy attribution notices contained within notice file excluding those notices do pertain any part derivative works least one following places within notice text file distributed part derivative works within source form provided along derivative works within display generated derivative works wherever third party notices normally appear contents notice file purposes only do modify license you may add your own attribution notices within derivative works you distribute alongside addendum notice text from work provided additional attribution notices cannot construed modifying license you may add your own copyright statement your may provide additional different license terms conditions use reproduction distribution your any derivative works whole provided your use reproduction distribution work otherwise complies conditions stated license submission unless you explicitly state otherwise any contribution submitted inclusion work you licensor shall under terms conditions license without any additional terms conditions above nothing herein shall supersede modify terms any separate license agreement you may have executed licensor regarding trademarks license does grant permission use trade names trademarks service marks product names licensor except required reasonable customary use describing origin work reproducing content notice file disclaimer warranty unless required applicable law agreed writing licensor provides work each contributor provides its basis without warranties conditions any kind either express implied including without limitation any warranties conditions title non infringement fitness particular purpose you solely responsible determining using work assume any risks associated your exercise permissions under license limitation liability event under legal theory whether tort including negligence contract otherwise unless required applicable law deliberate grossly negligent acts agreed writing shall any contributor liable you damages including any direct indirect special incidental damages any character arising result license out use inability use work including limited damages loss goodwill work stoppage computer failure malfunction any all other commercial damages losses even contributor has been advised possibility damages accepting warranty additional liability while work derivative works thereof you may choose offer charge fee acceptance support warranty indemnity other liability obligations rights consistent license however accepting obligations you may act only your own behalf your sole behalf any other contributor only you agree indemnify defend hold each contributor harmless any liability incurred claims asserted against contributor reason your accepting any warranty additional liability end terms conditions appendix how apply apache license your work apply apache license your work attach following boilerplate notice fields enclosed brackets replaced your own identifying information don include brackets text should enclosed appropriate comment syntax file format we also recommend file class name description purpose included same printed page copyright notice easier within third party archives copyright yyyy name copyright owner licensed under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license
-1
private iterator itr private feature descriptor next public boolean has next return itr null object result null itr null itr has next result itr next itr has next itr null guarantee iterator return feature descriptor result
tfp null implements notification listener
container listener methods public void container event container event event event get type host add alias event mapper add host alias host event get source get name event get data string else event get type host remove alias event mapper remove host alias event get data string should probablt called later string aliases string bean server invoke object name find aliases null null host add container listener mapper remove host name log debug enabled log debug sm get string mapper listener unregister host name domain add alias existing host param name name host param alias alias add public synchronized void add host alias string name string alias int pos find hosts name pos should adding alias host doesn exist just case return host real host hosts pos host new hosts new host hosts length host new host new host new host name alias new host context list real host context list new host object real host insert map hosts new hosts new host hosts new hosts remove host alias param alias alias remove public synchronized void remove host alias string alias find remove alias int pos find hosts alias pos return host new hosts new host hosts length remove map hosts new hosts alias hosts new hosts find map elemnt given its name sorted array map elements
protected string get path without context string servlet path string ret val null int second slash servlet path index second slash cut off context ret val servlet path substring second slash return ret val string context get path without context normalized
do filter filter class type args perform work particular code subject code here work do privilege method name target object target type target arguments null perform work particular code subject code here work granted code null code subject param method name method apply security restriction param target object code filter code which method called param target type code class code array used instanciate code method code object param target arguments code object code array contains runtime parameters instance param principal code principal code which security privilege apply public static void do privilege final string method name final filter target object final class target type final object target arguments principal principal throws java lang exception execute method target object target arguments null
compiler get page info add dependant abs file name
class clazz exception get class reset response possible else illegal state exception hres reset integer status code obj integer request get attribute globals status code attr int status code status code obj int value string message string request get attribute globals error message attr response reset status code message private static final char line sep
-1
-1
memory output stream new byte array output stream threshold
protected long last accessed time creation time protected long accessed time creation time
protected void post construct object instance class clazz method methods clazz get declared methods field fields clazz get declared fields method methods clazz get declared methods
return strong etag available else weak etag string result null attributes null attribute attribute attributes get etag attribute null try result attribute get string catch naming exception value attribute result null strong etag null strong etag must always calculated resources result strong etag else weak etag content length last modified weak etag null long content length get content length long last modified get last modified content length last modified weak etag content length last modified result weak etag return strong etag else weak etag content lenght last modified weak etag null weak etag get content length get last modified return weak etag return result
xxx processor needs set correct scheme port prior point ajp13 protocols dont make sense get port from connector public static final string session cookie name jsessionid public static final string session parameter name jsessionid public static final string single sign cookie public static final string session parameter name jsessionid
-1
get process tlds process tlds processes tlds throws lifecycle exception error occurs protected void process tlds throws lifecycle exception tld config tld config new tld config tld config set context check attribute has been defined context element tld config set tld validation tld validation tld config set tld namespace aware tld namespace aware attribute wasn defined context try host tld validation tld config set tld validation standard host get parent get xml validation tld namespace aware tld config set tld namespace aware standard host get parent get xml namespace aware try tld config execute catch exception ex log error error reading tld listeners ex string ex startup event listener context configures properties context associated defined servlets create necessary return digester configured process tag library descriptor looking additional listener classes registered private static digester create tld digester return digester factory new digester tld validation tld namespace aware new tld rule set tld digester null tld digester create tld digester public void lifecycle event lifecycle event event identify context we associated try context context event get lifecycle catch class cast exception log error sm get string tld config cce event get lifecycle return event get type equals lifecycle init event init else event get type equals lifecycle start event try execute catch exception log error sm get string tld config execute context get path ignore other event types nothing do private void init tld digester null check attribute has been defined context element set tld validation context get tld validation set tld namespace aware context get tld namespace aware attribute wasn defined context try host tld validation set tld validation standard host context get parent get xml validation tld namespace aware set tld namespace aware standard host context get parent get xml namespace aware tld digester digester factory new digester tld validation tld namespace aware new tld rule set tld digester get parser
number messages we have read written out null out write msg get data msg get data length nr messages processed msg get message number msg get total nr msgs end else log warn enabled log warn receive message again sender act timeout short path msg get context path war msg get file name data msg get data data length msg get data length msg buffer clear last message processed null
message null mod jk httpd fails null status message bug 45026 message integer string res get status
get servlet config get init parameter use accept ranges null use accept ranges boolean parse boolean get servlet config get init parameter use accept ranges use accept ranges accept ranges header response set header accept ranges bytes tr th valign top use accept ranges th td valign top true accept ranges header set when appropriate response true td tr
servlet path servlet path servlet path
buf append request get header header
try selector close catch exception ignore licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license excluding svn org apache naming factory webservices kind src path java target name extras depends prepare commons logging webservices
-1
return false
-1
jjtn000 set prefix t0 image substring t0 image length
reset temporary variable counter generator jsp util reset temporary variable name private static int temp sequence number resets temporary variable name thread safe public static void reset temporary variable name temp sequence number generates new temporary variable name thread safe public static string next temporary variable name return constants temp variable name prefix temp sequence number sequence number temporary variables private int temp sequence number generates new temporary variable name public string next temporary variable name parent root null return constants temp variable name prefix temp sequence number else return parent root next temporary variable name temporary variable name jsp util next temporary variable name return jsp util next temporary variable name
public void set poller thread count int poller thread count endpoint set poller thread count poller thread count public int get poller thread count return endpoint get poller thread count public void set sendfile thread count int sendfile thread count endpoint set sendfile thread count sendfile thread count public int get sendfile thread count return endpoint get sendfile thread count fix bug 45074 bug add parameters http11apr protocol fix
log debug sm get string apr listener ssl init
server sock socket create family socket sock stream
info class loader log info class loader loggers get current handler handler info handlers get handler name return logger get class loader info class loader loggers get name string prefix string prefix get info class loader log info class loader loggers get current class loader log info info class loader log info class loader loggers get class loader info class loader log info class loader loggers get class loader class loader log info info class loader log info class loader loggers get class loader log node child node log node current node children get next name
protected int count allocated return count allocated count allocated count allocated while count allocated instances count allocated count allocated count allocated count allocated while retries 21 count allocated new integer count allocated
param realm our associated jaasrealm instance param username username param password password param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest param auth method mehtod use string md5a2 auth method auth method methdod used null assume basic form protected string auth method else cb get prompt equals auth method cb set text auth method callback callbacks new callback callbacks new text input callback auth method string auth method null auth method text input callback callbacks get text md5a2 null using digest else must using digest else auth method equals constants cert method principal super get principal username else throw new login exception unknown method param auth method scheme use nc cnonce qop realm name md5a2 return null
construct callback handler digest param realm our associated jaasrealm instance param username username param password password param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest md5 method uri public jaascallback handler jaasrealm realm string username string password string nonce string nc string cnonce string qop string realm name string md5a2 realm username password nonce nonce nc nc cnonce cnonce qop qop realm name realm name md5a2 md5a2 server generated nonce protected string nonce null nonce count protected string nc null client generated nonce protected string cnonce null quality protection aplied message protected string qop realm name protected string realm name second md5 digest protected string md5a2 only recognizes code name callback code code password callback code instances else callbacks instanceof text input callback text input callback cb text input callback callbacks cb get prompt equals nonce cb set text nonce else cb get prompt equals nc cb set text nc else cb get prompt equals cnonce cb set text cnonce else cb get prompt equals qop cb set text qop else cb get prompt equals realm name cb set text realm name else cb get prompt equals md5a2 cb set text md5a2 else throw new unsupported callback exception callbacks callback callbacks new callback callbacks new text input callback nonce callbacks new text input callback nc callbacks new text input callback cnonce callbacks new text input callback qop callbacks new text input callback realm name callbacks new text input callback md5a2 string nonce null string nc null string cnonce null string qop null string realm name null string md5a2 null nonce text input callback callbacks get text nc text input callback callbacks get text cnonce text input callback callbacks get text qop text input callback callbacks get text realm name text input callback callbacks get text md5a2 text input callback callbacks get text principal super authenticate username password return code principal code associated specified username credentials one otherwise return code null code any errors jdbc connection executing query anything we return null don authenticate event also logged connection closed so subsequent request re open return authenticate username new jaascallback handler username credentials return code principal code associated specified username digest one otherwise return code null code param username username code principal code look up param client digest digest use username param nonce server generated nonce param nc nonce count param cnonce client generated nonce param qop quality protection aplied message param realm name realm name param md5a2 second md5 digest used calculate digest md5 method uri public principal authenticate string username string client digest string nonce string nc string cnonce string qop string realm name string md5a2 return authenticate username new jaascallback handler username client digest nonce nc cnonce qop realm name md5a2 package methods protected methods perform actual jaas protected principal authenticate string username callback handler callback handler login context new login context app name new jaascallback handler username credentials package methods protected methods return password associated given principal user name
int env get handler count env get handler null env get handler pause
protected principal get principal string username
catch illegal access exception iae get logger error sm get string standard context application listener iae listeners iae ok false
pos
close output stream used cgi output close
doc base get canonical path starts app base get absolute path
log warn enabled log warn sm get string delta manager wait session state get name mbr
mb get char chunk recycle valid anymore
try socket close catch exception ignore
protected string get header value string object header value header value null return null header value instanceof date return date strings ie last modified http format rather than java format return fast http date format format date date header value get time null return header value string attribute value list add attribute values next string return attribute get attribute size string
buf pos constants sp spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false space false buf pos constants sp spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false buf pos constants sp spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false space false buf pos constants sp spec says single sp also says tolerant multiple ht while space read new bytes needed pos last valid fill throw new eofexception sm get string iib eof error buf pos constants sp buf pos constants ht pos else space false buf pos constants sp spec says single sp also tolerant multiple ht boolean space true while space read new bytes needed pos last valid fill true false request line parsing return false buf pos constants sp buf pos constants ht pos else space false boolean space false buf pos constants sp spec says single sp also tolerant multiple ht boolean space true while space read new bytes needed pos last valid fill true false request line parsing return false buf pos constants sp buf pos constants ht pos else space false
private string compare page encodings string page dir enc string config enc root get jsp config page encoding string page enc root get page encoding
start manager manager null manager instanceof lifecycle lifecycle get manager start start container background processor thread super thread start configure call application event listeners filters try start manager manager null manager instanceof lifecycle lifecycle get manager start start container background processor thread super thread start catch exception log error error manager start ok false configure call application filters
string current prefix get prefix current get qname jsp uri equals uri text action equals current get local name string prefix int colon name index colon prefix name substring colon int index name index index string prefix name substring index private string get prefix string name int index name index index return name substring index return
url pattern index else url pattern index else private static log log log factory get log security collection class bugzilla 34805 add friendly warning pattern ends pattern char pattern length log debug enabled log warn suspicious url pattern pattern see http java sun com about java first jsr053 servlet23 pfd pdf section 11
compressable mime types null compressable mime types null compressable mime types null
url url file url url url file url url url directory url url url file url url url file url path tag name replace path get servlet package name replace base url options get scratch dir url string out url string base url string path url out url new url out url string output dir out url get file file separator
files lower case ends war li sessions deprecated use expire
else command equals sessions expire sessions writer path request
attr names length pool name pool name string description default persistence property properties default licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license string name string value
-1
endorsed arg set line djava endorsed dirs endorsed info append endorsed dir endorsed
web digester null web digester create web digester web digester null web digester create web digester context digester null context digester create context digester web digester null web digester create web digester web digester get parser context digester null context digester create context digester context digester get parser
expect file urls xx encoded depending class loader check url using file protocol else ignore file equals urls get protocol continue
private final class dispatch data
idx escaped quotes quotes
long last modified string original value null string variable value ssi mediator get variable value param value encoding variable value null variable value missing variable value writer write variable value last modified system current time millis return last modified has variable references work val index return val int char start sb index while char start int char end sb index char start char end char char integer parse int sb substring char start char end sb delete char start char end sb insert char start char start sb index else break sure how really different than none ret val value
final expression factory expr factory jsp factory get default factory get jsp application context page context get servlet context get expression factory
make sure isn null get method
public int get queue size return executor null executor get queue size
break return true status false else denyfromall all roles mode all roles mode strict mode status principal null string manager package protected static string manager sm string manager get manager constants package
closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed closed throw new ioexception sm get string input buffer stream closed connection list protected concurrent hash map string connection info connections new concurrent hash map string connection info
webapp getting stopped so all current connections should closed close all comet connections associated session note only done container context otherwise needs done before stop servlet would deallocated already iterator connection info iterator connections values iterator while iterator has next connection info connection infos iterator next connection infos null int connection infos length connection info connection info connection infos try connection info event close catch exception container get logger warn sm get string comet connection manager valve event connections clear webapp getting stopped so all current connections should closed close all comet connections associated session iterator connection info iterator connections values iterator connection info connection infos iterator next connection infos null int connection infos length connection info connection info connection infos try comet event impl connection info event set event type comet event event type end comet event impl connection info event set event sub type comet event event sub type webapp reload get next event connection info request connection info response connection info event connection info event close catch exception container get logger warn sm get string comet connection manager valve event connections clear connection info new connection info new connection info new connection info request request new connection info response response new connection info event request get event string id session get id connection info connection infos connections get id connection infos null connection infos new connection info connection infos new connection info connections put id connection infos connection info new connection infos new connection info connection infos length int connection infos length new connection infos connection infos new connection infos connection infos length new connection info connections put id new connection infos event get event sub type comet event event sub type timeout remove from tracked list connection done http session session request get session true synchronized session connection info connection infos connections get session get id connection infos null boolean found false int found connection infos length found connection infos request request found connection info new connection infos new connection info connection infos length int pos int connection infos length connection infos request request new connection infos pos connection infos connections put session get id new connection infos connection info connection infos connections remove se get session get id connection infos null int connection infos length connection info connection info connection infos comet event impl connection info event set event type comet event event type end comet event impl connection info event set event sub type comet event event sub type session end get next event connection info request connection info response connection info event connection info event close container get logger warn sm get string comet connection manager valve event connection info inner class protected class connection info public comet event event public request request public response response
throw new bind exception get message port
response includes body use dumb head support content length all other methods delegate directly http servlet response object used construct one private http servlet response resp resp resp set content length body get content length resp set content length len public void set character encoding string charset resp set character encoding charset public void set content type string type resp set content type type public string get content type return resp get content type public servlet output stream get output stream throws ioexception return body public string get character encoding return resp get character encoding public print writer get writer throws unsupported encoding exception output stream writer public void set buffer size int size throws illegal state exception resp set buffer size size public int get buffer size return resp get buffer size public void reset throws illegal state exception resp reset public void reset buffer throws illegal state exception resp reset buffer public boolean committed return resp committed public void flush buffer throws ioexception resp flush buffer public void set locale locale loc resp set locale loc public locale get locale return resp get locale http servlet response interface methods public void add cookie cookie cookie resp add cookie cookie public boolean contains header string name return resp contains header name deprecated public void set status int sc string sm resp set status sc sm public void set status int sc resp set status sc public void set header string name string value resp set header name value public void set int header string name int value resp set int header name value public void set date header string name long date resp set date header name date public void send error int sc string msg throws ioexception resp send error sc msg public void send error int sc throws ioexception resp send error sc public void send redirect string location throws ioexception resp send redirect location public string encode url string url return resp encode url url public string encode redirect url string url return resp encode redirect url url public void add header string name string value resp add header name value public void add date header string name long value resp add date header name value public void add int header string name int value resp add int header name value deprecated version replaced link http servlet response encode url public string encode url string url return encode url url deprecated version replaced link http servlet response encode redirect url public string encode redirect url string url return encode redirect url url
throw new servlet exception error opening readme resource throw new servlet exception error opening xslt resource
start poller thread poller new poller thread poller thread new thread poller get name client poller poller thread set priority thread priority poller thread set daemon true poller thread start start poller thread poller new poller thread poller thread new thread poller get name client poller poller thread set priority thread priority poller thread set daemon true poller thread start
protected final class privileged get class loader implements privileged action class loader public class clazz public privileged get class loader class clazz clazz clazz public class loader run return clazz get class loader log trace enabled clazz null log debug loaded clazz get class loader
listener equals application listeners
truststore type null truststore type system get property javax net ssl trust store type
args 11 new integer context get manager get max inactive interval 60
need crlfparse true boolean crfound false crfound throw new ioexception invalid crlf two cr characters encountered crfound true crfound throw new ioexception invalid crlf cr character encountered
else current compilation context needs location cached tag files tag file info info impl get tag files ctxt set tag file jar url info get path ctxt get tag file jar url
ret null body null string buffer buf new string buffer int body size buf append body get node get text ret buf string
object object
ctx get elresolver set value ctx base property value
get creation get last modified creation file last modified creation file last modified last modified file last modified
encoder location url http redirects protected static urlencoder url encoder static initializer safe character set static url encoder new urlencoder url encoder add safe character url encoder add safe character url encoder add safe character url encoder add safe character url encoder add safe character string redirect path redirect path mb string
public locale get locale return el context get locale public void set locale locale locale el context set locale locale
throw new illegal argument exception message factory get el convert obj obj type
nbsp input type submit value nbsp 10 nbsp input type text name expire size value 11 nbsp 12 nbsp nbsp input type submit value nbsp 10 nbsp input type text name expire size value 11 nbsp 12 nbsp
sets list comma delimited classes represent roles classes list must implement code java security principal code when accessor called example code digester code instance parsing file parse class names store resulting string code array list code field code role classes code parse class names role class names role classes provided list each class must implement codejava security principal code class principal class class name class names sets list comma delimited classes represent individual users classes list must implement code java security principal code when accessor called example code digester code instance parsing file parse class names store resulting string code array list code field code user classes code parse class names user class names user classes use context class loader ocl thread current thread get context class loader thread current thread set context class loader get class get class loader use context class loader iterator principals subject get principals iterator principal principal principal principals next need called after loading case use context class loader appears after them xml config parse class names user class names user classes parse class names role class names role classes
using output stream false using writer false character encoding set false
path null normalize slashes add leading slash necessary
host find child path null deployed path message sm get string html manager servlet deploy upload server xml war break
processor set compression proto compression processor set compression proto compression processor set compression proto compression processor set compression proto compression processor set compression proto compression processor set compression proto compression
javac error new javac error detail fname line num err node get start get file err node get start get line number err msg buf ctxt
copy successful resp set status webdav status sc created
log info error registering servlet jmx instance handled default servlet
http issues apache org bugzilla attachment cgi id 20883 remm pero funkman http issues apache org bugzilla attachment cgi id 20930 remm pero funkman jfclere
sendfile data remove data long maintain time reset maintain time maintain time maintain time poll time todo see we need call maintain sendfile poller
return string status pages get new integer status patch tuomas kiviaho tuomas kiviahos ikis fi
removed log debug enabled log debug member member disappeared present map return member part our map bug 43435 bug don iterate relocate sessions part map fix fix
public boolean get client auth return ep get client auth public void set client auth boolean ep set client auth public void set truststore file string ep set truststore file public string get truststore file return ep get truststore file public void set truststore pass string ep set truststore pass public string get truststore pass return ep get truststore pass public void set truststore type string ep set truststore type public string get truststore type return ep get truststore type public string adjust relative path string path string relative file new file path absolute path relative file separator path new file path exists log warn configured file path does exist return path public string default null string val string default value val null return default value else return val protected string truststore file system get property javax net ssl trust store public void set truststore file string adjust relative path system get property catalina base truststore file public string get truststore file return truststore file protected string truststore pass system get property javax net ssl trust store password public void set truststore pass string truststore pass truststore pass truststore pass public string get truststore pass return truststore pass protected string truststore type system get property javax net ssl trust store type public void set truststore type string truststore type truststore type truststore type public string get truststore type return truststore type public void set keystore file string keystore file public void set keystore string set keystore file public string get keystore return get keystore file protected boolean client auth false public boolean get client auth return client auth public void set client auth boolean client auth key store ts key store get instance get keystore type ts load new file input stream get keystore file passphrase char tpassphrase get truststore pass null get truststore pass char array passphrase string ttype get truststore type null get truststore type get keystore type key store ts null get truststore file null ts key store get instance get keystore type ts load new file input stream get keystore file passphrase else ts key store get instance ttype ts load new file input stream get truststore file tpassphrase engine set need client auth get client auth wrequest recycle unwrap request state wrequest recycle unwrap request state wrequest recycle wrequest recycle
recycle request necessary also bz 30949 recycle request wrapper state private void recycle request wrapper state state state wrap request instanceof application http request application http request state wrap request recycle bug 30949 bug improve previous fix ensure requests re cycled cross context includes forwards when exception occurs target page markt fix fix
session end access
servers decode return specified url encoded string return urldecode str enc false decode return specified url encoded string param str url encoded string param enc encoding use null default encoding used param query query string being processed exception illegal argument exception character followed valid digit hexadecimal number public static string urldecode string str string enc boolean query return urldecode bytes enc decode return specified url encoded byte array decode return specified url encoded byte array return urldecode bytes null false decode return specified url encoded byte array param bytes url encoded byte array param enc encoding use null default encoding used param query query string being processed exception illegal argument exception character followed valid digit hexadecimal number public static string urldecode byte bytes string enc boolean query
public void process request http servlet request request submit null add item item submit equals add
comet req comet comet req set filter chain filter chain comet req comet licensed apache software foundation asf under one more contributor license agreements see notice file distributed work additional information regarding copyright ownership asf licenses file you under apache license version license you may use file except compliance license you may obtain copy license http www apache org licenses license unless required applicable law agreed writing software distributed under license distributed basis without warranties conditions any kind either express implied see license specific language governing permissions limitations under license security role reference web application represented code lt security role ref gt code element deployment descriptor author mark thomas version revision date since tomcat properties required role name private string name null public string get name return name public void set name string name name name optional role link private string link null public string get link return link public void set link string link link link public methods return string object public string string string buffer sb new string buffer security role ref sb append name sb append name link null sb append link sb append link sb append return sb string
digester add call method prefix web app servlet security role ref add security reference digester add call param prefix web app servlet security role ref role link digester add call param prefix web app servlet security role ref role name context context context digester peek digester get count override env entry web xml
input stream null file input stream fis null string jsp lines read file ctxt get resource stream jsp file name string java lines read file new file input stream ctxt get servlet java file name finally null try close catch ioexception ioe ignore fis null try fis close catch ioexception ioe ignore
find environment environment get name get override remove environment environment get name exists isn env res link fix bug 42547 bug fix npe when resource link context xml tries override env entry web xml fix static private int curr func private error dispatcher err
throws jasper exception elfunction mapper map new elfunction mapper map ds new string buffer map ss new string buffer page visit map new elfunction visitor append declarations root node string ds map ds string ds length node root page get root new node declaration map ss string null root new node declaration static ds null root use global name map facilitate reuse function maps key used prefix function uri private hash map string string map new hash map string string public void visit node param action throws jasper exception do map get value visit body public void visit node include action throws jasper exception do map get page visit body public void visit node forward action throws jasper exception do map get page visit body do map get value visit body do map get bean name visit body do map get height do map get width visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs do map get name attribute visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs visit body node jsp attribute attrs get jsp attributes int attrs null attrs length do map attrs visit body do map get el private void do map node jsp attribute attr throws jasper exception attr null do map attr get el private void do map elnode nodes el throws jasper exception class fvisitor extends elnode visitor array list elnode function funcs new array list elnode function hash map string string key map new hash map string string public void visit elnode function throws jasper exception string key get prefix get name key map contains key key key map put key funcs add el null return first locate all unique functions el fvisitor fv new fvisitor el visit fv array list functions fv funcs functions size return reuse previous map possible string dec name match map functions dec name null el set map name dec name return generate declaration map statically dec name get map name ss append static private org apache jasper runtime protected function mapper dec name ds append dec name ds append org apache jasper runtime protected function mapper special case only one function map string func method null functions size func method get map function else ds append get instance func method dec name map function int functions size elnode function elnode function functions get function info func info get function info string key get prefix get name ds append func method key func info get function class class get method name new class string params get parameters int params length ds append int array params index array ds append params class else string base type params substring array ds append java lang reflect array new instance ds append base type ds append class count number array dimension int count int jj array jj params length jj params char jj count count ds append get class else ds append new int count get class ds append put current name global function map map put get prefix get name get uri dec name el set map name dec name private string match map array list functions string map name null int functions size elnode function elnode function functions get string tem name string map get get prefix get name get uri tem name null return null map name null map name tem name else tem name equals map name all previous match match return null return map name private string get map name return jspx fnmap curr func fix fix xss security cve 2007 2450 manager host manager reported daiki fukumori markt fix fix bug 42643 bug prevent creation duplicate jsp function mapper variables markt fix fix fix xss security cve 2007 2449 examples reported toshiharu sugiyama markt fix
array list result new array list response set header etag get etag resource attributes bug 42449 bug jndirealm does catch null pointer exception sun ldap provider see bug details funkman fix fix bug 42444 bug prevent npe access log valve patch provided nils hammar funkman bug 39875 bug fix bpe realm base init port yoavs fix from tomcat markt
response app committed
array list results null results new array list results new array list results new array list results new array list private security constraint results array array list results container log container get logger we want logger soon possible container null container log container get logger fix bug 39875 bug fix bpe realm base init port yoavs fix from tomcat markt fix
temporary variable name jsp util next temporary variable name temporary variable name null temporary variable name jsp util next temporary variable name subsection name jasper changelog fix bug 42438 bug duplicate temporary variables were created when jsp attribute used conjunction custom tags patch provided brian lenz markt fix changelog subsection
tr tr tr
buf append request get protocol
content type set string application www form urlencoded saved set content type request get content type content type request used post private string content type null public string get content type return content type public void set content type string content type content type content type subsection name catalina changelog fix bug 42361 bug handle multi part forms when saving requests during form process patch provided peter runge markt fix changelog subsection
connector set property sslenabled true else connector new connector protocol
comet next request input buffer next request output buffer next request next request input buffer next request output buffer next request comet next request input buffer next request output buffer next request next request input buffer next request output buffer next request system out println lv pos last valid pos
file file new file url get file file file get canonical file expect file urls file file new file urls get file
response set date header retry after available response send error http servlet response sc service unavailable localizer get message jsp error unavailable private static log log log factory get log standard wrapper valve class
container get logger error sm get string standard wrapper allocate exception wrapper get name basically return everything after charset charset specified use http default ascii character set public static string get charset from content type string type type null return null int semi type index semi return null int charset location type index charset semi charset location return null charset value content type header allowed quoted charset values can contain quotes just convert any quote chars spaces let trim clean things up after charset after charset replace string encoding after charset trim return encoding
-1
add handlers root logger any defined using handlers property root handlers null string tokenizer tok2 new string tokenizer root handlers while tok2 has more tokens string handler name tok2 next token trim handler handler handler info handlers get handler name handler null local root logger add handler handler
servlet servlet null servlet servlet servlet class new instance annotation processor process annotations servlet annotation processor post construct servlet servlet init config servlet servlet fix bug 42072 bug don call destroy associated init fails patch provided kawasima kazuh markt fix
config base mkdirs
bug 41703 bug single sign message invalid setter patch provided nils hammar fhanik fix fix
delta manager manager get name
protected standard context get context return context protected map get readonly attributes return read only attributes void clear attributes context null context new repl appl context get base path get alt ddname null context set attribute globals alt dd attr get alt ddname public void remove attribute string name do nothing super remove attribute name public void set attribute string name object value do nothing super set attribute name value return remove key true public object remove object key boolean notify get map members length only delete active keys iterator keys key set iterator while keys has next remove keys next map entry entry map entry get value entry primary set add entry map entry entry map entry get value entry primary set add entry get key value serializable value key serializable key
log debug enabled log debug sm get string request prepare unsupported http version protocol mb log debug enabled log debug sm get string request prepare unsupported transfer encoding encoding name log debug enabled log debug sm get string request prepare host header missing add bug 41675 bug add couple debug level logging statements when sending error responses patch ralf hauser yoavs add protected list role classes new array list protected list user classes new array list
comma delimited list code java security principal code classes represent security roles protected string role class names null public string get role class names return role class names role classes clear string temp role class names temp null return while true int comma temp index comma break role classes add temp substring comma trim temp temp substring comma temp temp trim temp length role classes add temp comma delimited list code java security principal code classes represent individual users protected string user class names null public string get user class names return user class names user classes clear string temp user class names temp null return while true int comma temp index comma break user classes add temp substring comma trim temp temp substring comma temp temp trim temp length user classes add temp list roles new array list
file input stream null input stream reader reader new input stream reader new file input stream source file ctxt get options get java encoding reader reader new buffered reader reader finally null try close catch ioexception exc ignore
throw new lifecycle exception memory realm read xml
last modified header value 1000 last modified header value 1000
load startup arbitrarily put them last load startup integer max value
container get logger warn sm get string standard wrapper service exception container get logger warn sm get string standard wrapper service exception container get logger warn sm get string standard wrapper service exception container get logger warn sm get string standard wrapper service exception private static final boolean thread local pool boolean value system get property org apache jasper runtime jsp factory impl thread local pool true boolean value private simple pool pool new simple pool 100
use pool pc page context pool get pc null pool put pc protected final class page context pool private page context pool private int current public page context pool pool new page context pool size public void put page context current pool size current pool current public page context get page context item null current item pool current current return item
out print jsp factory get default factory get jsp application context out printil private static final jsp factory jspx factory jsp factory get default factory out println out printil jsp factory jspx factory null out printil jspx factory jsp factory get default factory printil jspx factory null jspx factory release page context jspx page context static jsp factory get default factory null jsp factory impl factory new jsp factory impl system get security manager null string base package org apache jasper try factory get class get class loader load class base package runtime jsp factory impl privileged get page context factory get class get class loader load class base package runtime jsp factory impl privileged release page context factory get class get class loader load class base package runtime jsp runtime library factory get class get class loader load class base package runtime jsp runtime library privileged introspect helper factory get class get class loader load class base package runtime servlet response wrapper include factory get class get class loader load class base package servlet jsp servlet wrapper catch class found exception ex org apache juli logging log factory get log http jsp base class error jasper jsp runtime context preload class failed ex get message ex jsp factory set default factory factory
filter map get all match check specific special servlet name else filter map get match all servlet names return true string results new string servlet names length system arraycopy servlet names results servlet names length results servlet names length servlet name servlet names results flag indicates mapping match all private boolean all match false public boolean get all match return all match flag indicates mapping match all servlet names private boolean match all servlet names false public boolean get match all servlet names return match all servlet names all match true
socket get buf handler get write buffer buf socket get buf handler get write buffer put buf buf socket get buf handler get write buffer fix bug 39572 bug improvements compression filter example provided eric hedstrm markt fix
protected gzipoutput stream gzipstream null response add header content encoding gzip gzipstream new gzipoutput stream output returns character from content type method taken from tomcat author rajo private static string get charset from content type string type type null return null int semi type index semi return null string after semi type substring semi int charset location after semi index charset charset location return null else string after charset after semi substring charset location string encoding after charset trim return encoding
check interval check interval 300 log warn enabled log warn localizer get message jsp warning check interval public static final string cert method client cert return basic client cert digest form code null code
basic form which less secure than client cert auth type following digest client cert updated param auth type type used basic client cert param auth type type used basic client cert return basic client cert digest form none param auth type type used basic client cert
bugzilla 41217 cookie set secure request secure fix bug 41217 bug set secure attribute sso cookie when cookie created during secure request patch provided chris halstead markt fix
jsp uri
get class get class loader load class org apache jasper compiler jsp runtime context out println param name blah out printil out write param name object string s0 object param java code s0 param name java code make attr value code param java codebase s0 param name java codebase param java archive s0 param name java archive param type s0 param name type generate param each jsp param plugin body out printil out write quote comment out printil out write quote noembed out printil out write quote noembed out printil out write quote comment out printil out write quote object
-1
configure open configure open log manager manager log manager get log manager directory get property class name directory logs prefix get property class name prefix juli suffix get property class name suffix log private static final string jsp version private static final string jsp version
version equals version equals
byte enabled char enabled
request head get query string does contain unencoded indexed query parsed query string forms command line parameters cgi command get equals req get method head equals req get method return string qs req get query string qs null qs index return int delim index int last delim index delim index qs index while delim index cmd line parameters add urldecoder decode qs substring last delim index delim index parameter encoding last delim index delim index delim index qs index last delim index cmd line parameters add urldecoder decode qs substring last delim index parameter encoding
sb append trimmed sb append trimmed subclass java net urlclass loader knows how load classes from disk directories well local remote jar files also implements code reloader code interface provide automatic reloading support associated loader all cases urls must conform contract specified code urlclass loader code any url ends character assumed represent directory all other urls assumed address jar file strong note strong local repositories searched order added via initial constructor any subsequent calls code add repository code strong note strong present dependencies from class any other catalina class so could used bug 37509 bug do remove whitespace from end values defined logging properties files markt
-1
ignore log warn parameters invalid chunk ignored xxx log log warn parameters character decoding failed parameter skipped fix bug 40860 bug log exceptions other problems during parameter processing markt fix
string result str trim
protected string get password string username protected prepared statement roles connection db connection string username
deferred tld attrs deferred method tld attrs deferred value
globals strict servlet compliance check srv srv 14 compliance check same objects globals strict servlet compliance check srv srv 14 compliance check same objects private void check same objects throws servlet exception servlet request original request application filter chain get last serviced request servlet response original response application filter chain get last serviced response some forwards eg from valves set original values original request null original response null return boolean same false servlet request dispatched request app request while same original request equals dispatched request same true same dispatched request instanceof servlet request wrapper dispatched request servlet request wrapper dispatched request get request else break same throw new servlet exception sm get string application dispatcher spec violation request same false servlet response dispatched response app response while same original response equals dispatched response same true same dispatched response instanceof servlet response wrapper dispatched response servlet response wrapper dispatched response get response else break same throw new servlet exception sm get string application dispatcher spec violation response used enforce requirements srv srv 14 private final static thread local last serviced request private final static thread local last serviced response static globals strict servlet compliance last serviced request new thread local last serviced response new thread local else last serviced request null last serviced response null globals strict servlet compliance last serviced request set request last serviced response set response finally globals strict servlet compliance last serviced request set null last serviced response set null last request passed servlet servicing from current thread return last request serviced public static servlet request get last serviced request return servlet request last serviced request get last response passed servlet servicing from current thread return last response serviced public static servlet response get last serviced response return servlet response last serviced response get
cginame current location get parent substring web app root dir length file separator name envp put script filename command php
synchronized looking up package string package name null int pos name last index pos package name name substring pos package pkg null package name null pkg get package package name define package null pkg null entry manifest null define package package name null null null null null null null else define package package name entry manifest entry code base create code source object code source code source new code source entry code base entry certificates security manager null checking sealing pkg null boolean seal check true pkg sealed seal check pkg sealed entry code base else seal check entry manifest null package sealed package name entry manifest seal check throw new security exception sealing violation loading name package package name sealed synchronized code source ts timestamp null index ts
-1
input get offset input get end return
first basic first null
return else entries put environment get name environment get type entries put environment get name environment get type
throw new ioexception string
container get logger error sm get string request listener valve request init container get logger error sm get string request listener valve request destroy report bad request error specified resource fixme we should really using error reporting settings web application currently code runs wrapper level rather than context level param request uri request uri requested resource param response response we creating private void bad request string request uri http servlet response response try response send error http servlet response sc bad request request uri catch illegal state exception catch ioexception report forbidden error specified resource param request uri request uri requested resource param response response we creating private void forbidden string request uri http servlet response response try response send error http servlet response sc forbidden request uri catch illegal state exception catch ioexception
boolean deployed true try deployed deployed context path catch exception assume false failure safety deployed false else context get available started apps row button section args stopped apps row button section args private static final string started apps row button section private static final string stopped apps row button section private static final string started nondeployed apps row button section td class row left bgcolor small nbsp nbsp nbsp href onclick return confirm you sure nbsp nbsp href onclick return confirm you sure nbsp nbsp nbsp small td tr private static final string stopped nondeployed apps row button section td class row left bgcolor small nbsp href onclick return confirm you sure nbsp nbsp nbsp nbsp nbsp nbsp nbsp small td tr deployed path writer println sm get string manager servlet deployed request util filter display path return invoke deployed method deployer protected boolean deployed string name throws exception string params name string signature java lang string boolean result boolean bean server invoke oname deployed params signature return result boolean value invoke check method deployer invoke check method deployer invoke check method deployer has specified application been deployed note applications defined server xml have been deployed return code true code application has been deployed code false code applciation has been deployed does exist public boolean deployed string name deployed application app deployed application deployed get name app null return false else return true boolean check additional deployments false
return jsp util make xml java identifier pool name return jsp util make xml java identifier var name
prev
simple tag copyright 1999 2004 apache software foundation private string base output dir
removed jsp compiler remove generated files rctxt null rctxt remove wrapper jsp uri jsp compiler remove generated files ex print stack trace copyright 1999 2004 2005 apache software foundation print stack trace print stack trace copyright 1999 2004 2005 apache software foundation catch file found exception ex ctxt increment removed string include request uri string request get attribute javax servlet include request uri include request uri null file included throw exception response send error ignored servlet engine throw new servlet exception ex else try response send error http servlet response sc found ex get message catch illegal state exception ise log error localizer get message jsp error file found ex get message ex catch servlet exception ex options get development throw handle jsp exception ex else throw ex catch ioexception ex options get development throw handle jsp exception ex else throw ex catch illegal state exception ex options get development throw handle jsp exception ex else throw ex catch exception ex options get development throw handle jsp exception ex else throw new jasper exception ex try catch file found exception ex ctxt increment removed string include request uri string request get attribute javax servlet include request uri include request uri null file included throw exception response send error ignored servlet engine throw new servlet exception ex else try response send error http servlet response sc found ex get message catch illegal state exception ise log error localizer get message jsp error file found
request set content length reset content length req set content length reset content length
else obj0 get class enum return obj0 equals coerce enum obj1 obj0 get class else obj1 get class enum return obj1 equals coerce enum obj0 obj1 get class param obj param type return public final static enum coerce enum final object obj class type obj null equals obj return null obj get class enum return enum obj return enum value type obj string else obj instanceof enum return enum obj name type enum return coerce enum obj type reload false try object target tag file reload false return java util list jsp source dependent target get dependants
ret val equals
char end quote while idx cmd length cmd char idx end quote cmd char idx escaped break protected boolean quote char return
rt runtime get runtime proc rt exec cmd args string hash string array env wd string content length string env get content length equals content length commands std new buffered output stream proc get output stream iotools flow stdin commands std commands std flush commands std close we want wait process exit process wait useless our situation see http developer java sun com developer bug parade bugs 4223650 html boolean running true commands std err new buffered reader new input stream reader proc get error stream final buffered reader std err rdr commands std err new thread public void run send log std err rdr start input stream cgi header stream new httpheader input stream proc get input stream buffered reader cgi header reader new buffered reader new input stream reader cgi header stream while running try set headers string line null while line cgi header reader read line null equals line debug log run cgi add header line line starts http response set status get scfrom http status line line else line index string header line substring line index trim string value line substring line index trim header equals ignore case status response set status get scfrom cgistatus header value response add header header value else log run cgi bad header line line write output byte buf new byte 2048 output stream out response get output stream cgi output proc get input stream try while buf read cgi output read buf debug log run cgi output buf read bytes data out write buf buf read finally attempt consume any leftover byte something bad happens socket disconnect servlet side otherwise external process could hang buf read while buf read cgi output read buf replacement process wait proc exit value throws exception alive running false catch illegal thread state exception try thread sleep 500 catch interrupted exception ignored replacement process wait close output stream used cgi output close
-1
class loader old ctx class loader thread current thread get context class loader class loader class loader instance get class get class loader thread current thread set context class loader class loader restore context class loader thread current thread set context class loader old ctx class loader thread current thread set context class loader class loader finally restore context class loader thread current thread set context class loader old ctx class loader
acquire clustered manager manager context manager null manager null get cluster null try context manager get cluster create manager get name catch exception ex log error standard context cluster fail ex ok false else context manager new standard manager manager null get cluster null try set manager get cluster create manager get name catch exception ex log error standard context cluster fail ex ok false else set manager new standard manager
